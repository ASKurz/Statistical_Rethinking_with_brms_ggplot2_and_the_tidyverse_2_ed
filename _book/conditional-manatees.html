<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Conditional Manatees | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Conditional Manatees | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Conditional Manatees | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-06-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ulysses-compass.html"/>
<link rel="next" href="markov-chain-monte-carlo.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summarybonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del>Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.1</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>9.4.2</b> Estimation.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="conditional-manatees" class="section level1">
<h1><span class="header-section-number">8</span> Conditional Manatees</h1>
<blockquote>
<p>Every model so far in this [McElreath’s text] has assumed that each predictor has an independent association with the mean of the outcome. What if we want to allow the association to be conditional?…</p>
<p>To model deeper conditionality–where the importance of one predictor depends upon another predictor–we need <strong>interaction</strong> (also known as <strong>moderation</strong>). Interaction is a kind of conditioning, a way of allowing parameters (really their posterior distributions) to be conditional on further aspects of the data. The simplest kind of interaction, a linear interaction, is built by extending the linear modeling strategy to parameters within the linear model. So it is akin to placing epicycles on epicycles in the Ptolemaic and Kopernikan models. It is descriptive, but very powerful.</p>
<p>More generally, interactions are central to most statistical models beyond the cozy world of Gaussian outcomes and linear models of the mean. In generalized linear models (GLMs, Chapter 10 and onwards), even when one does not explicitly define variables as interacting, they will always interact to some degree. Multilevel models induce similar effects. <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020">a</a>, p. 238, <strong>emphasis</strong> in the original)</span></p>
</blockquote>
<div id="building-an-interaction." class="section level2">
<h2><span class="header-section-number">8.1</span> Building an interaction.</h2>
<p>“Africa is special” (p. 238). Let’s load the <code>rugged</code> data <span class="citation">(Nunn &amp; Puga, <a href="#ref-nunn2012ruggedness">2012</a>)</span> to see one of the reasons why.</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb913-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb913-2" data-line-number="2"><span class="kw">data</span>(rugged)</a>
<a class="sourceLine" id="cb913-3" data-line-number="3">d &lt;-<span class="st"> </span>rugged</a></code></pre></div>
<p>And here we switch out rethinking for <strong>brms</strong>.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" data-line-number="1"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb914-2" data-line-number="2"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb914-3" data-line-number="3"><span class="kw">rm</span>(rugged)</a></code></pre></div>
<p>For this chapter, we’ll take our plot theme from the <a href="https://cran.r-project.org/package=ggthemes"><strong>ggthemes</strong> package</a> <span class="citation">(Arnold, <a href="#ref-R-ggthemes">2019</a>)</span>.</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb915-1" data-line-number="1"><span class="co"># install.packages(&quot;ggthemes&quot;, dependencies = T)</span></a>
<a class="sourceLine" id="cb915-2" data-line-number="2"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb915-3" data-line-number="3"></a>
<a class="sourceLine" id="cb915-4" data-line-number="4"><span class="kw">theme_set</span>(</a>
<a class="sourceLine" id="cb915-5" data-line-number="5">  <span class="kw">theme_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb915-6" data-line-number="6"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb915-7" data-line-number="7">          <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)) </a>
<a class="sourceLine" id="cb915-8" data-line-number="8">)</a></code></pre></div>
<p>We’ll use the <code>pander</code> color scheme to help us make our first DAG.</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb916-2" data-line-number="2"><span class="kw">library</span>(ggdag)</a>
<a class="sourceLine" id="cb916-3" data-line-number="3"></a>
<a class="sourceLine" id="cb916-4" data-line-number="4">dag_coords &lt;-</a>
<a class="sourceLine" id="cb916-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb916-6" data-line-number="6">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb916-7" data-line-number="7">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb916-8" data-line-number="8"></a>
<a class="sourceLine" id="cb916-9" data-line-number="9"><span class="kw">dagify</span>(R <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb916-10" data-line-number="10">       G <span class="op">~</span><span class="st"> </span>R <span class="op">+</span><span class="st"> </span>U <span class="op">+</span><span class="st"> </span>C,</a>
<a class="sourceLine" id="cb916-11" data-line-number="11">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb916-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb916-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name <span class="op">==</span><span class="st"> &quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb916-15" data-line-number="15">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb916-17" data-line-number="17">             <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">stroke =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb916-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb916-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb916-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_dag</span>()</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-5-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Let’s ignore <span class="math inline">\(U\)</span> for now…. Focus instead on the implication that <span class="math inline">\(R\)</span> and <span class="math inline">\(C\)</span> both influence <span class="math inline">\(G\)</span>. This could mean that they are independent influences or rather that they interact (one moderates the influence of the other). The DAG does not display an interaction. That’s because DAGs do not specify how variables combine to influence other variables. The DAG above implies only that there is some function that uses <span class="math inline">\(R\)</span> and <span class="math inline">\(C\)</span> to generate <span class="math inline">\(G\)</span>. In typical notation, <span class="math inline">\(G = f(R, C)\)</span>. (p. 240)</p>
</blockquote>
<p>It’s generally not a good idea to split up your data and run separate analyses when examining an interaction. McElreath listed four reasons why:</p>
<ol style="list-style-type: decimal">
<li>“There are usually some parameters, such as <span class="math inline">\(\sigma\)</span>, that the model says do not depend in any way upon continent. By splitting the data table, you are hurting the accuracy of the estimates for these parameters” (p. 241).</li>
<li>“In order to acquire probability statements about the variable you used to split the data, <code>cont_africa</code>, in this case, you need to include it in the model” (p. 241).</li>
<li>“We many want to use information criteria or another method to compare models” (p. 241).</li>
<li>“Once you begin using multilevel models (Chapter 13), you’ll see that there are advantages to borrowing information across categories like ‘Africa’ and ‘not Africa’” (p. 241).</li>
</ol>
<div id="overthinking-not-so-simple-causation." class="section level4">
<h4><span class="header-section-number">8.1.0.1</span> Overthinking: Not so simple causation.</h4>
<p>Here’s the DAG for a fuller model for the data.</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb917-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb917-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;H&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb917-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb917-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb917-5" data-line-number="5"></a>
<a class="sourceLine" id="cb917-6" data-line-number="6"><span class="kw">dagify</span>(G <span class="op">~</span><span class="st"> </span>R <span class="op">+</span><span class="st"> </span>U <span class="op">+</span><span class="st"> </span>H,</a>
<a class="sourceLine" id="cb917-7" data-line-number="7">       R <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb917-8" data-line-number="8">       H <span class="op">~</span><span class="st"> </span>R <span class="op">+</span><span class="st"> </span>U <span class="op">+</span><span class="st"> </span>C,</a>
<a class="sourceLine" id="cb917-9" data-line-number="9">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb917-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb917-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name <span class="op">==</span><span class="st"> &quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb917-13" data-line-number="13">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb917-15" data-line-number="15">             <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">stroke =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb917-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb917-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb917-19" data-line-number="19"><span class="st">  </span><span class="kw">theme_dag</span>()</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-6-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>“The data contain a large number of potential confounds that you might consider. Natural systems like this are terrifyingly complex” (p. 241).</p>
</div>
<div id="making-a-rugged-model." class="section level3">
<h3><span class="header-section-number">8.1.1</span> Making a rugged model.</h3>
<p>We’ll continue to use <strong>tidyverse</strong>-style syntax to wrangle the data.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" data-line-number="1"><span class="co"># make the log version of criterion</span></a>
<a class="sourceLine" id="cb918-2" data-line-number="2">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb918-3" data-line-number="3"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb918-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_gdp =</span> <span class="kw">log</span>(rgdppc_<span class="dv">2000</span>))</a>
<a class="sourceLine" id="cb918-5" data-line-number="5"></a>
<a class="sourceLine" id="cb918-6" data-line-number="6"><span class="co"># extract countries with GDP data</span></a>
<a class="sourceLine" id="cb918-7" data-line-number="7">dd &lt;-</a>
<a class="sourceLine" id="cb918-8" data-line-number="8"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb918-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(rgdppc_<span class="dv">2000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-10" data-line-number="10"><span class="st">  </span><span class="co"># rescale variables</span></a>
<a class="sourceLine" id="cb918-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_gdp_std =</span> log_gdp <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(log_gdp), </a>
<a class="sourceLine" id="cb918-12" data-line-number="12">         <span class="dt">rugged_std  =</span> rugged <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(rugged))</a></code></pre></div>
<p>Before we fit our first Bayesian models, let’s back track a bit and make our version of Figure 8.2. In the title, McElreath indicated it was a depiction of two linear regressions separated by whether the nations were African. A fairly simple way to make those plots is to simultaneously fit and plot the two regression models using OLS via the <code>geom_smooth()</code> function using the <code>method = &quot;lm&quot;</code> argument. After dividing the data with <code>cont_africa</code>, make each plot separately and then combine them with <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb919-1" data-line-number="1"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb919-2" data-line-number="2"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb919-3" data-line-number="3"></a>
<a class="sourceLine" id="cb919-4" data-line-number="4"><span class="co"># African nations</span></a>
<a class="sourceLine" id="cb919-5" data-line-number="5">p1 &lt;-</a>
<a class="sourceLine" id="cb919-6" data-line-number="6"><span class="st">  </span>dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> log_gdp_std)) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb919-10" data-line-number="10">              <span class="dt">fill =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb919-11" data-line-number="11">              <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-14" data-line-number="14"><span class="st">                    </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Lesotho&quot;</span>, <span class="st">&quot;Seychelles&quot;</span>)),  </a>
<a class="sourceLine" id="cb919-15" data-line-number="15">                  <span class="kw">aes</span>(<span class="dt">label =</span> country), </a>
<a class="sourceLine" id="cb919-16" data-line-number="16">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">seed =</span> <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;African nations&quot;</span>,</a>
<a class="sourceLine" id="cb919-18" data-line-number="18">       <span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb919-19" data-line-number="19">       <span class="dt">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>)</a>
<a class="sourceLine" id="cb919-20" data-line-number="20"></a>
<a class="sourceLine" id="cb919-21" data-line-number="21"><span class="co"># Non-African nations</span></a>
<a class="sourceLine" id="cb919-22" data-line-number="22">p2 &lt;-</a>
<a class="sourceLine" id="cb919-23" data-line-number="23"><span class="st">  </span>dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-24" data-line-number="24"><span class="st">  </span><span class="kw">filter</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-25" data-line-number="25"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> log_gdp_std)) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb919-27" data-line-number="27">              <span class="dt">fill =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb919-28" data-line-number="28">              <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-29" data-line-number="29"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-30" data-line-number="30"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb919-31" data-line-number="31"><span class="st">                    </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Switzerland&quot;</span>, <span class="st">&quot;Tajikistan&quot;</span>)),  </a>
<a class="sourceLine" id="cb919-32" data-line-number="32">                  <span class="kw">aes</span>(<span class="dt">label =</span> country), </a>
<a class="sourceLine" id="cb919-33" data-line-number="33">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">seed =</span> <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-34" data-line-number="34"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-35" data-line-number="35"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Non-African nations&quot;</span>,</a>
<a class="sourceLine" id="cb919-36" data-line-number="36">       <span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb919-37" data-line-number="37">       <span class="dt">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>)</a>
<a class="sourceLine" id="cb919-38" data-line-number="38"></a>
<a class="sourceLine" id="cb919-39" data-line-number="39"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb919-40" data-line-number="40">p1 <span class="op">+</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Our first Bayesian model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{log_gdp_std}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i  &amp; = \alpha + \beta \left (\text{rugged_std}_i - \overline{\text{rugged_std}} \right ) \\
\alpha &amp; \sim \operatorname{Normal}(1, 1) \\
\beta  &amp; \sim \operatorname{Normal}(0, 1) \\
\sigma &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Here we compute <span class="math inline">\(\overline{\text{rugged_std}}\)</span>.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" data-line-number="1"><span class="kw">mean</span>(dd<span class="op">$</span>rugged_std)</a></code></pre></div>
<pre><code>## [1] 0.2149601</code></pre>
<p>A naïve translation of McElreath’s <strong>rethinking</strong> code into a <code>brms::brm()</code> <code>formula</code> argument might be <code>log_gdp_std ~ 1 + (rugged_std - 0.215 )</code>. However, this kind of syntax will not work outside of the non-linear syntax. Our approach will be to make a mean-centered version of <code>rugged_std</code>.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" data-line-number="1">dd &lt;-</a>
<a class="sourceLine" id="cb922-2" data-line-number="2"><span class="st">  </span>dd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb922-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rugged_std_c  =</span> rugged_std <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(rugged_std))</a></code></pre></div>
<p>Now fit the model.</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb923-1" data-line-number="1">b8<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb923-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dd, </a>
<a class="sourceLine" id="cb923-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb923-4" data-line-number="4">      log_gdp_std <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>rugged_std_c,</a>
<a class="sourceLine" id="cb923-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb923-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb923-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb923-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb923-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb923-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb923-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.01&quot;</span>)</a></code></pre></div>
<p>Did you notice the <code>sample_prior = T</code> argument? Because of that, we can now use the <code>prior_samples()</code> function to help us plot the prior predictive distribution for <code>m8.1</code> and make our version of the left panel of Figure 8.3.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" data-line-number="1">prior &lt;-<span class="st"> </span><span class="kw">prior_samples</span>(b8<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb924-2" data-line-number="2"></a>
<a class="sourceLine" id="cb924-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb924-4" data-line-number="4"></a>
<a class="sourceLine" id="cb924-5" data-line-number="5">p1 &lt;-</a>
<a class="sourceLine" id="cb924-6" data-line-number="6"><span class="st">  </span>prior <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb924-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb924-8" data-line-number="8"><span class="st">  </span><span class="kw">rownames_to_column</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb924-9" data-line-number="9"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(rowname, Intercept, b),</a>
<a class="sourceLine" id="cb924-10" data-line-number="10">         <span class="dt">rugged_std_c =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb924-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_gdp_std =</span> Intercept <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>rugged_std_c,</a>
<a class="sourceLine" id="cb924-12" data-line-number="12">         <span class="dt">rugged_std  =</span> rugged_std_c <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(dd<span class="op">$</span>rugged_std)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb924-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb924-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> log_gdp_std, <span class="dt">group =</span> rowname)) <span class="op">+</span></a>
<a class="sourceLine" id="cb924-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">range</span>(dd<span class="op">$</span>log_gdp_std), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb924-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb924-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="fl">1.3</span>, <span class="dt">slope =</span> <span class="fl">-0.6</span>,</a>
<a class="sourceLine" id="cb924-18" data-line-number="18">              <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb924-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(1, 1)</span><span class="ch">\n</span><span class="st">b ~ dnorm(0, 1)&quot;</span>,</a>
<a class="sourceLine" id="cb924-20" data-line-number="20">       <span class="dt">x =</span> <span class="st">&quot;ruggedness&quot;</span>,</a>
<a class="sourceLine" id="cb924-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb924-22" data-line-number="22"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb924-23" data-line-number="23">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb924-24" data-line-number="24"></a>
<a class="sourceLine" id="cb924-25" data-line-number="25">p1</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-11-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Toward the bottom of page 244, McElreath wrote: “The slope of such a line must be about <span class="math inline">\(1.3 − 0.7 = 0.6\)</span>, the difference between the maximum and minimum observed proportional log GDP.” The math appears backwards, there. Rather, the slope of our solid blue line is <span class="math inline">\(0.7 - 1.3 = -0.6\)</span>. But anyway, “under the <span class="math inline">\(\beta \sim \operatorname{Normal}(0, 1)\)</span> prior, more than half of all slopes will have absolute value greater than [<span class="math inline">\(|-0.6|\)</span>]” (p. 244).</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb925-1" data-line-number="1">prior <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb925-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">a =</span> <span class="kw">sum</span>(<span class="kw">abs</span>(b) <span class="op">&gt;</span><span class="st"> </span><span class="kw">abs</span>(<span class="op">-</span><span class="fl">0.6</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(prior))</a></code></pre></div>
<pre><code>##         a
## 1 0.54875</code></pre>
<p>Our updated model is</p>
<p><span class="math display">\[\begin{align*}
\text{log_gdp_std}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i  &amp; = \alpha + \beta \left (\text{rugged_std}_i - \overline{\text{rugged_std}} \right ) \\
\alpha &amp; \sim \operatorname{Normal}(1, 0.1) \\
\beta  &amp; \sim \operatorname{Normal}(0, 0.3) \\
\sigma &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb927-1" data-line-number="1">b8<span class="fl">.1</span>b &lt;-</a>
<a class="sourceLine" id="cb927-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dd, </a>
<a class="sourceLine" id="cb927-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb927-4" data-line-number="4">      log_gdp_std <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>rugged_std_c,</a>
<a class="sourceLine" id="cb927-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb927-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb927-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb927-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb927-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb927-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb927-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.01b&quot;</span>)</a></code></pre></div>
<p>Now we’ll use <code>prior_samples(b8.1b)</code> to make the left panel of Figure 8.3 and present both panels together with a little <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb928-2" data-line-number="2"></a>
<a class="sourceLine" id="cb928-3" data-line-number="3">p2 &lt;-</a>
<a class="sourceLine" id="cb928-4" data-line-number="4"><span class="st">  </span><span class="kw">prior_samples</span>(b8<span class="fl">.1</span>b) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-5" data-line-number="5"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-6" data-line-number="6"><span class="st">  </span><span class="kw">rownames_to_column</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-7" data-line-number="7"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(rowname, Intercept, b),</a>
<a class="sourceLine" id="cb928-8" data-line-number="8">         <span class="dt">rugged_std_c =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_gdp_std =</span> Intercept <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>rugged_std_c,</a>
<a class="sourceLine" id="cb928-10" data-line-number="10">         <span class="dt">rugged_std  =</span> rugged_std_c <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(dd<span class="op">$</span>rugged_std)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb928-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> log_gdp_std, <span class="dt">group =</span> rowname)) <span class="op">+</span></a>
<a class="sourceLine" id="cb928-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">range</span>(dd<span class="op">$</span>log_gdp_std), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb928-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb928-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;&quot;</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb928-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(1, 0.1)</span><span class="ch">\n</span><span class="st">b ~ dnorm(0, 0.3)&quot;</span>,</a>
<a class="sourceLine" id="cb928-17" data-line-number="17">       <span class="dt">x =</span> <span class="st">&quot;ruggedness&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb928-18" data-line-number="18"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb928-19" data-line-number="19">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb928-20" data-line-number="20"></a>
<a class="sourceLine" id="cb928-21" data-line-number="21">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb928-22" data-line-number="22"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Simulating in search of reasonable priors for the terrain ruggedness example.&quot;</span>,</a>
<a class="sourceLine" id="cb928-23" data-line-number="23">                  <span class="dt">theme =</span> <span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)))</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Now check the summary for <code>b8.1b</code>.</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb929-1" data-line-number="1"><span class="kw">print</span>(b8<span class="fl">.1</span>b)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 1 + rugged_std_c 
##    Data: dd (Number of observations: 170) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept        1.00      0.01     0.98     1.02 1.00     4232     2593
## rugged_std_c     0.00      0.06    -0.11     0.11 1.00     4326     2942
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.14      0.01     0.12     0.15 1.00     3711     2907
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="adding-an-indicator-variable-isnt-enough." class="section level3">
<h3><span class="header-section-number">8.1.2</span> Adding an indicator variable isn’t enough.</h3>
<p>When you’d like to allow a model intercept and slope to differ by levels of a dichotomous variable, a typical approach is to use a 0/1 coded dummy variable. In this section, McElreath opted to highlight the index variable approach, instead. We’ll follow along. But if you’d like to practice using <strong>brms</strong> to fit interaction models with dummy variables, see <a href="https://bookdown.org/content/3890/interactions.html#building-an-interaction.">Section 7.1</a> of my <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2020">2020</a><a href="#ref-kurzStatisticalRethinkingBrms2020">a</a>)</span> translation of McElreath’s <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2015">2015</a>)</span> first edition or <a href="https://bookdown.org/ajkurz/recoding_Hayes_2018/fundamentals-of-moderation-analysis.html">Chapters 7</a> and beyond in my <span class="citation">(<a href="#ref-kurzRecodingIntroductionMediation2019">2019</a>)</span> translation of Andrew Hayes’s <span class="citation">(<a href="#ref-hayes2017introduction">2017</a>)</span> text on mediation and moderation.</p>
<p>Make the index variable.</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb931-1" data-line-number="1">dd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb931-2" data-line-number="2"><span class="st">  </span>dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb931-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cid =</span> <span class="kw">if_else</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>))</a></code></pre></div>
<p>In case you were curious, here’s a plot showing how the <code>cid</code> index works.</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb932-1" data-line-number="1">dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb932-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cid =</span> <span class="kw">str_c</span>(<span class="st">&quot;cid: &quot;</span>, cid)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb932-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(cid, country) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb932-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(cid) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb932-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb932-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb932-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cid, <span class="dt">y =</span> rank, <span class="dt">label =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb932-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb932-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_reverse</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb932-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb932-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>cid, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-16-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>If you recall from the latter sections of Chapter 5, the conventional <strong>brms</strong> syntax can accommodate an index variable by simply suppressing the default intercept via the <code>0 + ...</code>. syntax. That will be our approach, here.</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb933-1" data-line-number="1">b8<span class="fl">.2</span> &lt;-</a>
<a class="sourceLine" id="cb933-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dd, </a>
<a class="sourceLine" id="cb933-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb933-4" data-line-number="4">      log_gdp_std <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid <span class="op">+</span><span class="st"> </span>rugged_std_c,</a>
<a class="sourceLine" id="cb933-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid1),</a>
<a class="sourceLine" id="cb933-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid2),</a>
<a class="sourceLine" id="cb933-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> rugged_std_c),</a>
<a class="sourceLine" id="cb933-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb933-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb933-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb933-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.02&quot;</span>)</a></code></pre></div>
<p>Use <code>add_criterion()</code> and <code>loo_compare()</code> to compare <code>b8.1b</code> and <code>b8.2</code> with the WAIC.</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" data-line-number="1">b8<span class="fl">.1</span>b &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.1</span>b, <span class="st">&quot;waic&quot;</span>)</a>
<a class="sourceLine" id="cb934-2" data-line-number="2">b8<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.2</span>, <span class="st">&quot;waic&quot;</span>)</a>
<a class="sourceLine" id="cb934-3" data-line-number="3"></a>
<a class="sourceLine" id="cb934-4" data-line-number="4"><span class="kw">loo_compare</span>(b8<span class="fl">.1</span>b, b8<span class="fl">.2</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b8.2     0.0       0.0   126.1       7.4          4.2    0.8    -252.1   14.9 
## b8.1b  -31.6       7.4    94.5       6.5          2.5    0.3    -188.9   13.0</code></pre>
<p>Here are the WAIC weights.</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" data-line-number="1"><span class="kw">model_weights</span>(b8<span class="fl">.1</span>b, b8<span class="fl">.2</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## b8.1b  b8.2 
##     0     1</code></pre>
<p>Here is the summary for the model with all the weight, <code>b8.2</code>.</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" data-line-number="1"><span class="kw">print</span>(b8<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 0 + cid + rugged_std_c 
##    Data: dd (Number of observations: 170) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## cid1             0.88      0.02     0.85     0.91 1.00     4749     3053
## cid2             1.05      0.01     1.03     1.07 1.00     4146     3134
## rugged_std_c    -0.05      0.05    -0.14     0.04 1.00     4193     3234
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.11      0.01     0.10     0.13 1.00     4332     3118
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now extract the posterior draws, make a difference score for the two intercepts, and use <code>tidybayes::qi()</code> to compute the percentile-based 89% intervals for the difference.</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb940-1" data-line-number="1">post &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb940-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(b8<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb940-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> b_cid1 <span class="op">-</span><span class="st"> </span>b_cid2)</a>
<a class="sourceLine" id="cb940-4" data-line-number="4"></a>
<a class="sourceLine" id="cb940-5" data-line-number="5"><span class="kw">library</span>(tidybayes)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidybayes&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:brms&#39;:
## 
##     dstudent_t, pstudent_t, qstudent_t, rstudent_t</code></pre>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" data-line-number="1"><span class="kw">qi</span>(post<span class="op">$</span>diff, <span class="dt">.width =</span> <span class="fl">.89</span>)</a></code></pre></div>
<pre><code>##            [,1]       [,2]
## [1,] -0.1996385 -0.1382392</code></pre>
<p>Now it’s time to use <code>fitted()</code> to prepare to plot the implications of the model in Figure 8.4.</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb945-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb945-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">cid        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb945-3" data-line-number="3">           <span class="dt">rugged_std =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-0.2</span>, <span class="dt">to =</span> <span class="fl">1.2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb945-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rugged_std_c =</span> rugged_std <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dd<span class="op">$</span>rugged_std))</a>
<a class="sourceLine" id="cb945-5" data-line-number="5"></a>
<a class="sourceLine" id="cb945-6" data-line-number="6">f &lt;-</a>
<a class="sourceLine" id="cb945-7" data-line-number="7"><span class="st">  </span><span class="kw">fitted</span>(b8<span class="fl">.2</span>, </a>
<a class="sourceLine" id="cb945-8" data-line-number="8">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb945-9" data-line-number="9">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">015</span>, <span class="fl">.985</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-10" data-line-number="10"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-11" data-line-number="11"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cid <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>))</a>
<a class="sourceLine" id="cb945-13" data-line-number="13"></a>
<a class="sourceLine" id="cb945-14" data-line-number="14"><span class="co"># what did we do?</span></a>
<a class="sourceLine" id="cb945-15" data-line-number="15"><span class="kw">head</span>(f)</a></code></pre></div>
<pre><code>##    Estimate  Est.Error      Q1.5     Q98.5 cid   rugged_std rugged_std_c cont_africa
## 1 0.8995421 0.02396262 0.8478753 0.9510474   1 -0.200000000   -0.4149601      Africa
## 2 0.8973001 0.02233856 0.8490517 0.9459253   1 -0.151724138   -0.3666842      Africa
## 3 0.8950580 0.02083117 0.8505024 0.9406853   1 -0.103448276   -0.3184083      Africa
## 4 0.8928159 0.01946758 0.8510632 0.9352752   1 -0.055172414   -0.2701325      Africa
## 5 0.8905739 0.01828000 0.8511771 0.9305795   1 -0.006896552   -0.2218566      Africa
## 6 0.8883318 0.01730470 0.8511623 0.9258231   1  0.041379310   -0.1735808      Africa</code></pre>
<p>Behold our Figure 8.4.</p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb947-1" data-line-number="1">dd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb947-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb947-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb947-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">fill =</span> cont_africa, <span class="dt">color =</span> cont_africa)) <span class="op">+</span></a>
<a class="sourceLine" id="cb947-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> f,</a>
<a class="sourceLine" id="cb947-6" data-line-number="6">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q1<span class="fl">.5</span>, <span class="dt">ymax =</span> Q98<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb947-7" data-line-number="7">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb947-8" data-line-number="8">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb947-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> log_gdp_std),</a>
<a class="sourceLine" id="cb947-10" data-line-number="10">             <span class="dt">size =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb947-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_fill_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb947-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb947-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;b8.2&quot;</span>,</a>
<a class="sourceLine" id="cb947-14" data-line-number="14">       <span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb947-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb947-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb947-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb947-18" data-line-number="18">        <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</a>
<a class="sourceLine" id="cb947-19" data-line-number="19">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">67</span>, <span class="fl">.93</span>),</a>
<a class="sourceLine" id="cb947-20" data-line-number="20">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-22-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Though adding our index variable <code>cid</code> to <code>b8.2</code> allowed us to give the African nations a different intercept than the non-African nations, it did nothing for the slope. We need a better method.</p>
<div id="rethinking-why-97" class="section level4">
<h4><span class="header-section-number">8.1.2.1</span> Rethinking: Why 97%?</h4>
<p>Did you notice the <code>probs = c(.015, .985)</code> argument in our <code>fitted()</code> code, above? This is one of those rare moments when we went along with McElreath and used intervals other than the conventional 95%.</p>
<blockquote>
<p>In the code block just above, and therefore also in Figure 8.4, I used 97% intervals of the expected mean. This is a rather non-standard percentile interval. So why use 97%? In this book, I use non-standard percents to constantly remind the reader that conventions like 95% and 5% are arbitrary. Furthermore, boundaries are meaningless. There is continuous change in probability as we move away from the expected value. So one side of the boundary is almost equally probable as the other side. (p. 247)</p>
</blockquote>
<p>Building off of McElreath’s “boundaries are meaningless” point, here we use a combination of <code>summary = F</code> within <code>fitted()</code> and a little <code>tidybayes::stat_lineribbon()</code> magic to reimagine Figure 8.4. This time we use a sequence of overlapping semitransparent credible intervals to give the posterior a 3D-like appearance.</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb948-1" data-line-number="1"><span class="kw">fitted</span>(b8<span class="fl">.2</span>, </a>
<a class="sourceLine" id="cb948-2" data-line-number="2">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb948-3" data-line-number="3">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb948-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb948-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb948-7" data-line-number="7">    <span class="kw">expand</span>(nd, </a>
<a class="sourceLine" id="cb948-8" data-line-number="8">           <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb948-9" data-line-number="9">           <span class="kw">nesting</span>(cid, rugged_std))</a>
<a class="sourceLine" id="cb948-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb948-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cid <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb948-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> value, <span class="dt">fill =</span> cont_africa, <span class="dt">color =</span> cont_africa)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-14" data-line-number="14"><span class="st">  </span><span class="kw">stat_lineribbon</span>(<span class="dt">.width =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.03</span>, <span class="dt">to =</span> <span class="fl">.99</span>, <span class="dt">by =</span> <span class="fl">.03</span>),</a>
<a class="sourceLine" id="cb948-15" data-line-number="15">                  <span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb948-17" data-line-number="17"><span class="st">               </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)),</a>
<a class="sourceLine" id="cb948-18" data-line-number="18">             <span class="kw">aes</span>(<span class="dt">y =</span> log_gdp_std),</a>
<a class="sourceLine" id="cb948-19" data-line-number="19">             <span class="dt">size =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_fill_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb948-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb948-22" data-line-number="22"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;b8.2&quot;</span>,</a>
<a class="sourceLine" id="cb948-23" data-line-number="23">       <span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb948-24" data-line-number="24">       <span class="dt">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-25" data-line-number="25"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb948-26" data-line-number="26"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb948-27" data-line-number="27">        <span class="dt">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</a>
<a class="sourceLine" id="cb948-28" data-line-number="28">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">67</span>, <span class="fl">.93</span>),</a>
<a class="sourceLine" id="cb948-29" data-line-number="29">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-23-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="adding-an-interaction-does-work." class="section level3">
<h3><span class="header-section-number">8.1.3</span> Adding an interaction does work.</h3>
<p>The <code>0 + ...</code> syntax works fine when we just want to use an index variable to fit a model with multiple intercepts, this approach will not work for fitting <strong>brms</strong> models that apply the index variable to slopes. Happily, we have alternatives. If we’d like to use the <code>cid</code> index to make intercepts and slopes as in McElreath’s <code>m8.3</code>, we can use the <strong>brms</strong> <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">non-linear syntax</a> <span class="citation">(Bürkner, <a href="#ref-Bürkner2020Non_linear">2020</a><a href="#ref-Bürkner2020Non_linear">d</a>)</span>, which we introduced at the end of Chapter 5. Here it is for <code>b8.3</code>.</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" data-line-number="1">b8<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb949-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dd, </a>
<a class="sourceLine" id="cb949-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb949-4" data-line-number="4">      <span class="kw">bf</span>(log_gdp_std <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>rugged_std_c, </a>
<a class="sourceLine" id="cb949-5" data-line-number="5">         a <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid, </a>
<a class="sourceLine" id="cb949-6" data-line-number="6">         b <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid,</a>
<a class="sourceLine" id="cb949-7" data-line-number="7">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb949-8" data-line-number="8">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid1, <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb949-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid2, <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb949-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid1, <span class="dt">nlpar =</span> b),</a>
<a class="sourceLine" id="cb949-11" data-line-number="11">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid2, <span class="dt">nlpar =</span> b),</a>
<a class="sourceLine" id="cb949-12" data-line-number="12">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb949-13" data-line-number="13">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb949-14" data-line-number="14">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb949-15" data-line-number="15">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.03&quot;</span>)</a></code></pre></div>
<p>Check the summary of the marginal distributions.</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb950-1" data-line-number="1"><span class="kw">print</span>(b8<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 0 + a + b * rugged_std_c 
##          a ~ 0 + cid
##          b ~ 0 + cid
##    Data: dd (Number of observations: 170) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_cid1     0.89      0.02     0.85     0.92 1.00     4994     2901
## a_cid2     1.05      0.01     1.03     1.07 1.00     4902     3011
## b_cid1     0.13      0.07    -0.01     0.28 1.00     4686     2868
## b_cid2    -0.14      0.06    -0.26    -0.03 1.00     5006     3028
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.11      0.01     0.10     0.12 1.00     5002     3187
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Success! Our results look just like McElreath’s. Now make haste with <code>add_criterion()</code> so we can compare the models by the PSIS-LOO-CV.</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb952-1" data-line-number="1">b8<span class="fl">.1</span>b &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.1</span>b, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb952-2" data-line-number="2">b8<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.2</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb952-3" data-line-number="3">b8<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.3</span>, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb952-4" data-line-number="4"></a>
<a class="sourceLine" id="cb952-5" data-line-number="5"><span class="kw">loo_compare</span>(b8<span class="fl">.1</span>b, b8<span class="fl">.2</span>, b8<span class="fl">.3</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b8.3     0.0       0.0   129.5      7.3         5.1    0.9   -259.0   14.7  
## b8.2    -3.4       3.3   126.1      7.4         4.2    0.8   -252.1   14.9  
## b8.1b  -35.0       7.5    94.5      6.5         2.6    0.3   -188.9   13.0</code></pre>
<p>Here are the LOO weights.</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb954-1" data-line-number="1"><span class="kw">model_weights</span>(b8<span class="fl">.1</span>b, b8<span class="fl">.2</span>, b8<span class="fl">.3</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## b8.1b  b8.2  b8.3 
##  0.00  0.03  0.97</code></pre>
<p>We can get a Pareto <span class="math inline">\(k\)</span> diagnostic plot for <code>b8.3</code> by feeding the results of the <code>loo()</code> function into <code>plot()</code>.</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb956-1" data-line-number="1"><span class="kw">loo</span>(b8<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb956-2" data-line-number="2"><span class="st">  </span><span class="kw">plot</span>(<span class="dt">label_points =</span> T)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The <code>label_points = T</code> argument is how we instructed the plot to include the row number for the influential case crossing the 0.5 threshold. We can use <code>slice()</code> to get a sense of case 145.</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" data-line-number="1">dd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-2" data-line-number="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">145</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb957-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(country, cont_africa)</a></code></pre></div>
<pre><code>##      country cont_africa
## 1 Seychelles           1</code></pre>
<p>It turns out Seychelles is our influential country.</p>
<div id="bonus-give-me-student-t." class="section level4">
<h4><span class="header-section-number">8.1.3.1</span> Bonus: Give me Student-t.</h4>
<p>McElreath remarked: “This is possibly a good context for robust regression, like the Student-t regression we did in Chapter 7” (p. 249). Let’s practice fitting the alternative model using the Student-t likelihood for which <span class="math inline">\(\nu = 2\)</span>.</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" data-line-number="1">b8<span class="fl">.3</span>t &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb959-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dd, </a>
<a class="sourceLine" id="cb959-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb959-4" data-line-number="4">      <span class="kw">bf</span>(log_gdp_std <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>rugged_std_c, </a>
<a class="sourceLine" id="cb959-5" data-line-number="5">         a <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid, </a>
<a class="sourceLine" id="cb959-6" data-line-number="6">         b <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid,</a>
<a class="sourceLine" id="cb959-7" data-line-number="7">         <span class="dt">nu =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb959-8" data-line-number="8">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb959-9" data-line-number="9">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid1, <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb959-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid2, <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb959-11" data-line-number="11">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid1, <span class="dt">nlpar =</span> b),</a>
<a class="sourceLine" id="cb959-12" data-line-number="12">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> cid2, <span class="dt">nlpar =</span> b),</a>
<a class="sourceLine" id="cb959-13" data-line-number="13">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb959-14" data-line-number="14">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb959-15" data-line-number="15">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb959-16" data-line-number="16">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.03t&quot;</span>)</a></code></pre></div>
<p>Use the LOO to compare this with the Gaussian model.</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb960-1" data-line-number="1">b8<span class="fl">.3</span>t &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b8<span class="fl">.3</span>t, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</a>
<a class="sourceLine" id="cb960-2" data-line-number="2"></a>
<a class="sourceLine" id="cb960-3" data-line-number="3"><span class="kw">loo_compare</span>(b8<span class="fl">.3</span>, b8<span class="fl">.3</span>t, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b8.3     0.0       0.0   129.5      7.3         5.1    0.9   -259.0   14.7  
## b8.3t  -19.0       2.7   110.5      8.8         6.2    0.7   -221.0   17.5</code></pre>
<p>Here we might make our own diagnostic plot to compare the two likelihoods by the Pareto <span class="math inline">\(k\)</span> values. To get a nice fine-grain sense of the distributions, we’ll employ the handy <code>tidybayes::stat_dotsh()</code> function which will display each value as an individual dot.</p>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb962-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">Normal      =</span> b8<span class="fl">.3</span><span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k,</a>
<a class="sourceLine" id="cb962-2" data-line-number="2">       <span class="st">`</span><span class="dt">Student-t</span><span class="st">`</span> =<span class="st"> </span>b8<span class="fl">.3</span>t<span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb962-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb962-4" data-line-number="4">               <span class="dt">values_to =</span> <span class="st">&quot;pareto_k&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb962-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb962-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pareto_k, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb962-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.5</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">5</span>)[<span class="dv">5</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb962-8" data-line-number="8"><span class="st">  </span><span class="kw">stat_dotsh</span>(<span class="dt">slab_fill =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">4</span>)[<span class="dv">4</span>], </a>
<a class="sourceLine" id="cb962-9" data-line-number="9">             <span class="dt">slab_color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb962-10" data-line-number="10"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb962-11" data-line-number="11">           <span class="dt">x =</span> <span class="fl">.485</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="st">&quot;threshold&quot;</span>, <span class="dt">angle =</span> <span class="dv">90</span>, </a>
<a class="sourceLine" id="cb962-12" data-line-number="12">           <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">5</span>)[<span class="dv">5</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb962-13" data-line-number="13"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb962-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.4</span>))</a></code></pre></div>
<pre><code>## Warning: &#39;stat_dotsh&#39; is deprecated.
## Use &#39;stat_dots&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="08_files/figure-gfm/unnamed-chunk-30-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>To close this exercise out, compare the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters of the two models using <code>fixef()</code>.</p>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb964-1" data-line-number="1"><span class="kw">fixef</span>(b8<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##        Estimate Est.Error  Q2.5 Q97.5
## a_cid1     0.89      0.02  0.85  0.92
## a_cid2     1.05      0.01  1.03  1.07
## b_cid1     0.13      0.07 -0.01  0.28
## b_cid2    -0.14      0.06 -0.26 -0.03</code></pre>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb966-1" data-line-number="1"><span class="kw">fixef</span>(b8<span class="fl">.3</span>t) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##        Estimate Est.Error  Q2.5 Q97.5
## a_cid1     0.87      0.02  0.83  0.90
## a_cid2     1.05      0.01  1.02  1.07
## b_cid1     0.13      0.09 -0.02  0.32
## b_cid2    -0.21      0.07 -0.32 -0.07</code></pre>
</div>
</div>
<div id="plotting-the-interaction." class="section level3">
<h3><span class="header-section-number">8.1.4</span> Plotting the interaction.</h3>
<p>The code for Figure 8.5 is a minor extension of the code we used for Figure 8.4. Other than which fit we use, the code we use for <code>fitted()</code> is the same for both plots. Two of the largest changes are the addition of labels with <code>ggrepel::geom_text_repel()</code> and using <code>facet_wrap()</code> to split the plot into two panels.</p>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb968-1" data-line-number="1">countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Equatorial Guinea&quot;</span>, <span class="st">&quot;South Africa&quot;</span>, <span class="st">&quot;Seychelles&quot;</span>, <span class="st">&quot;Swaziland&quot;</span>, <span class="st">&quot;Lesotho&quot;</span>, <span class="st">&quot;Rwanda&quot;</span>, <span class="st">&quot;Burundi&quot;</span>, <span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Greece&quot;</span>, <span class="st">&quot;Switzerland&quot;</span>, <span class="st">&quot;Lebanon&quot;</span>, <span class="st">&quot;Yemen&quot;</span>, <span class="st">&quot;Tajikistan&quot;</span>, <span class="st">&quot;Nepal&quot;</span>)</a>
<a class="sourceLine" id="cb968-2" data-line-number="2"></a>
<a class="sourceLine" id="cb968-3" data-line-number="3">f &lt;-</a>
<a class="sourceLine" id="cb968-4" data-line-number="4"><span class="st">  </span><span class="kw">fitted</span>(b8<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb968-5" data-line-number="5">         <span class="co"># we already defined `nd`, above</span></a>
<a class="sourceLine" id="cb968-6" data-line-number="6">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb968-7" data-line-number="7">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">015</span>, <span class="fl">.985</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cid <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;African nations&quot;</span>, <span class="st">&quot;Non-African nations&quot;</span>))</a>
<a class="sourceLine" id="cb968-11" data-line-number="11"></a>
<a class="sourceLine" id="cb968-12" data-line-number="12">dd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cont_africa =</span> <span class="kw">ifelse</span>(cont_africa <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;African nations&quot;</span>, <span class="st">&quot;Non-African nations&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb968-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb968-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> log_gdp_std, <span class="dt">fill =</span> cont_africa, <span class="dt">color =</span> cont_africa)) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> f,</a>
<a class="sourceLine" id="cb968-17" data-line-number="17">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q1<span class="fl">.5</span>, <span class="dt">ymax =</span> Q98<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb968-18" data-line-number="18">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb968-19" data-line-number="19">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span>countries),  </a>
<a class="sourceLine" id="cb968-21" data-line-number="21">                  <span class="kw">aes</span>(<span class="dt">label =</span> country), </a>
<a class="sourceLine" id="cb968-22" data-line-number="22">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">8</span>, </a>
<a class="sourceLine" id="cb968-23" data-line-number="23">                  <span class="dt">segment.color =</span> <span class="st">&quot;grey25&quot;</span>, <span class="dt">min.segment.length =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> log_gdp_std),</a>
<a class="sourceLine" id="cb968-25" data-line-number="25">             <span class="dt">size =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_fill_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb968-27" data-line-number="27"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb968-28" data-line-number="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb968-29" data-line-number="29">       <span class="dt">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-30" data-line-number="30"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-31" data-line-number="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb968-32" data-line-number="32"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>cont_africa)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>“Finally, the slope reverses direction inside and outside of Africa. And because we achieved this inside a single model, we could statistically evaluate the value of this reversal” (p. 250).</p>
</div>
</div>
<div id="symmetry-of-interactions" class="section level2">
<h2><span class="header-section-number">8.2</span> Symmetry of interactions</h2>
<p>If you’re unfamiliar with Buridan’s ass, here’s a <a href="https://www.youtube.com/watch?v=bOp1_LIYvmk">brief clip</a> to catch up up to speed. With Buridan’s ass still on your mind, recall the model for <span class="math inline">\(\mu_i\)</span> from the last example,</p>
<p><span class="math display">\[\mu_i  = \alpha_{\text{cid}[i]} + \beta_{\text{cid}[i]} \left (\text{rugged_std}_i - \overline{\text{rugged_std}} \right ).\]</span></p>
<p>With this model, it is equally true that that slope is conditional on the intercept as it is that the intercept is conditional on the slope. Another way to express the model is</p>
<p><span class="math display">\[\mu_i = \underbrace{(2 - \text{cid}_{i}) \left (\alpha_1 + \beta_1 \left (\text{rugged_std}_i - \overline{\text{rugged_std}} \right ) \right )}_{\text{cid}[i] = 1} + \underbrace{(\text{cid}_{i} - 1) \left (\alpha_2 + \beta_2 \left (\text{rugged_std}_i - \overline{\text{rugged_std}} \right ) \right )}_{\text{cid}[i] = 2},\]</span></p>
<p>where the first term vanishes when <span class="math inline">\(\text{cid}_i = 2\)</span> and the second term vanishes when <span class="math inline">\(\text{cid}_i = 1\)</span>. In contrast to the plots above, we can re-express this equation as saying “<em>The association of being in Africa with log GDP depends upon terrain ruggedness</em>” (p. 251, <em>emphasis</em> in the original). Here we follow McElreath and plot the difference between a nation in Africa and outside Africa, conditional on ruggedness.</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" data-line-number="1"><span class="kw">fitted</span>(b8<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb969-2" data-line-number="2">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb969-3" data-line-number="3">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb969-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb969-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">expand</span>(nd,</a>
<a class="sourceLine" id="cb969-7" data-line-number="7">                   <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb969-8" data-line-number="8">                   <span class="kw">nesting</span>(cid, rugged_std))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb969-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb969-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> cid, <span class="dt">values_from =</span> value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb969-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delta =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">2</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb969-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb969-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rugged_std, <span class="dt">y =</span> delta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb969-14" data-line-number="14"><span class="st">  </span><span class="kw">stat_lineribbon</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">fill =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">8</span>)[<span class="dv">8</span>], <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb969-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb969-16" data-line-number="16"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb969-17" data-line-number="17">           <span class="dt">x =</span> <span class="fl">.2</span>, <span class="dt">y =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb969-18" data-line-number="18">           <span class="dt">label =</span> <span class="st">&quot;Africa higher GDP</span><span class="ch">\n</span><span class="st">Africa lower GDP&quot;</span>,</a>
<a class="sourceLine" id="cb969-19" data-line-number="19">           <span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb969-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</a>
<a class="sourceLine" id="cb969-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;expected difference log GDP&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb969-22" data-line-number="22"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb969-23" data-line-number="23">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.2</span>))</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-33-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>This perspective on the GDP and terrain ruggedness is completely consistent with the previous perspective. It’s simultaneously true in these data (and with this model) that (1) the influence of ruggedness depends upon continent and (2) the influence of continent depends upon ruggedness.</p>
<p>Simple interactions are symmetric, just like the choice facing Buridan’s ass. Within the model, there’s no basis to prefer one interpretation over the other, because in fact they are the same interpretation. But when we reason causally about models, our minds tend to prefer one interpretation over the other, because it’s usually easier to imagine manipulating one of the predictor variables instead of the other. (pp. 251–252)</p>
</blockquote>
</div>
<div id="continuous-interactions" class="section level2">
<h2><span class="header-section-number">8.3</span> Continuous interactions</h2>
<blockquote>
<p>It’s one thing to make a slope conditional upon a <em>category.</em> In such a context, the model reduces to estimating a different slope for each category. But it’s quite a lot harder to understand that a slope varies in a continuous fashion with a continuous variable. Interpretation is much harder in this case, even though the mathematics of the model are essentially the same. (p. 252, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="a-winter-flower." class="section level3">
<h3><span class="header-section-number">8.3.1</span> A winter flower.</h3>
<p>Look at the <code>tulips</code> data, which were adapted from <span class="citation">Grafen &amp; Hails (<a href="#ref-grafenModernStatisticsLife2002">2002</a>)</span>.</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb970-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb970-2" data-line-number="2"><span class="kw">data</span>(tulips)</a>
<a class="sourceLine" id="cb970-3" data-line-number="3">d &lt;-<span class="st"> </span>tulips</a>
<a class="sourceLine" id="cb970-4" data-line-number="4"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<pre><code>## Rows: 27
## Columns: 4
## $ bed    &lt;fct&gt; a, a, a, a, a, a, a, a, a, b, b, b, b, b, b, b, b, b, c, c, c, c, c, c, c, c, c
## $ water  &lt;int&gt; 1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3
## $ shade  &lt;int&gt; 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3
## $ blooms &lt;dbl&gt; 0.00, 0.00, 111.04, 183.47, 59.16, 76.75, 224.97, 83.77, 134.95, 80.10, 85.95, 19.…</code></pre>
</div>
<div id="the-models." class="section level3">
<h3><span class="header-section-number">8.3.2</span> The models.</h3>
<p>Wrangle a little.</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb972-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb972-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb972-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">blooms_std =</span> blooms <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(blooms),</a>
<a class="sourceLine" id="cb972-4" data-line-number="4">         <span class="dt">water_cent =</span> water <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(water),</a>
<a class="sourceLine" id="cb972-5" data-line-number="5">         <span class="dt">shade_cent =</span> shade <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(shade))</a></code></pre></div>
<p>With the variables in hand, the basic model is <span class="math inline">\(B = f(W, S)\)</span>, where <span class="math inline">\(B\)</span> = <code>blooms</code>, <span class="math inline">\(W\)</span> = <code>water</code>, <span class="math inline">\(S\)</span> = <code>shade</code>, and <span class="math inline">\(f(\cdot)\)</span> indicates a function. We can also express this as <span class="math inline">\(W \rightarrow B \leftarrow S\)</span>. Neither expression clarifies whether the effects of <span class="math inline">\(W\)</span> and <span class="math inline">\(S\)</span> are additive or conditional on each other in some way. We might express an unconditional (additive) model as</p>
<p><span class="math display">\[\begin{align*}
\text{blooms_std}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{water_cent}_i + \beta_2 \text{shade_cent}_i \\
\alpha  &amp; \sim \operatorname{Normal} (0.5, 1) \\
\beta_1 &amp; \sim \operatorname{Normal} (0, 1) \\
\beta_2 &amp; \sim \operatorname{Normal} (0, 1) \\
\sigma  &amp; \sim \operatorname{Exponential} (1),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\text{water_cent}_i = \left (\text{water}_i - \overline{\text{water}} \right )\)</span> and <span class="math inline">\(\text{shade_cent}_i = \left (\text{shade}_i - \overline{\text{shade}} \right )\)</span>. Even though “the intercept <span class="math inline">\(\alpha\)</span> must be greater than zero and less than one,… this prior assigns most of the probability outside that range” (p. 254).</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb973-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb973-2" data-line-number="2"></a>
<a class="sourceLine" id="cb973-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="fl">1e4</span>, <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb973-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">proportion_outside_of_the_range =</span> <span class="kw">sum</span>(a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>a <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   proportion_outside_of_the_range
##                             &lt;dbl&gt;
## 1                           0.621</code></pre>
<p>Tightening up the prior to <span class="math inline">\(\operatorname{Normal}(0, 0.25)\)</span> helps.</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb975-2" data-line-number="2"></a>
<a class="sourceLine" id="cb975-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="fl">1e4</span>, <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> <span class="fl">0.25</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb975-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">proportion_outside_of_the_range =</span> <span class="kw">sum</span>(a <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>a <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   proportion_outside_of_the_range
##                             &lt;dbl&gt;
## 1                          0.0501</code></pre>
<p>Here are the ranges for our two predictors.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" data-line-number="1"><span class="kw">range</span>(d<span class="op">$</span>water_cent)</a></code></pre></div>
<pre><code>## [1] -1  1</code></pre>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb979-1" data-line-number="1"><span class="kw">range</span>(d<span class="op">$</span>shade_cent)</a></code></pre></div>
<pre><code>## [1] -1  1</code></pre>
<p>Putting the same <span class="math inline">\(\operatorname{Normal}(0, 0.25)\)</span> prior on each would indicate a .95 probability each coefficient would be within -0.5 to 0.5. Since the total range for both is <span class="math inline">\(1 - (-1) = 2\)</span>, that would imply either could account for the full range of <code>blooms_std</code> because <span class="math inline">\(0.5 \cdot 2 = 1\)</span>, which is the full range of <code>blooms_std</code>. Our first model, then, will be</p>
<p><span class="math display">\[\begin{align*}
\text{blooms_std}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{water_cent}_i + \beta_2 \text{shade_cent}_i \\
\alpha  &amp; \sim \operatorname{Normal} (0.5, 0.25) \\
\beta_1 &amp; \sim \operatorname{Normal} (0, 0.25) \\
\beta_2 &amp; \sim \operatorname{Normal} (0, 0.25) \\
\sigma  &amp; \sim \operatorname{Exponential} (1),
\end{align*}\]</span></p>
<p>Detach <strong>rethinking</strong> and reload <strong>brms</strong>.</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb981-1" data-line-number="1"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb981-2" data-line-number="2"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb981-3" data-line-number="3"><span class="kw">rm</span>(tulips)</a></code></pre></div>
<p>Now fit the model.</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb982-1" data-line-number="1">b8<span class="fl">.4</span> &lt;-</a>
<a class="sourceLine" id="cb982-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb982-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb982-4" data-line-number="4">      blooms_std <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>water_cent <span class="op">+</span><span class="st"> </span>shade_cent,</a>
<a class="sourceLine" id="cb982-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb982-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> water_cent),</a>
<a class="sourceLine" id="cb982-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> shade_cent),</a>
<a class="sourceLine" id="cb982-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb982-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb982-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb982-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.04&quot;</span>)</a></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb983-1" data-line-number="1"><span class="kw">print</span>(b8<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: blooms_std ~ 1 + water_cent + shade_cent 
##    Data: d (Number of observations: 27) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      0.36      0.03     0.29     0.43 1.00     3736     2527
## water_cent     0.20      0.04     0.12     0.28 1.00     3738     2344
## shade_cent    -0.11      0.04    -0.19    -0.03 1.00     3684     2248
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.18      0.03     0.13     0.24 1.00     3005     2622
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Using the <span class="math inline">\(\gamma\)</span> notation, we can express an interaction between <code>water_cent</code> and <code>shade_cent</code> by</p>
<p><span class="math display">\[\begin{align*}
\mu_i   &amp; = \alpha + \gamma_{1, i} \text{water_cent}_i + \beta_2 \text{shade_cent}_i \\
\gamma_{1, i} &amp; = \beta_1 + \beta_3 \text{shade_cent}_i,
\end{align*}\]</span></p>
<p>where both <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\gamma_{1, i}\)</span> get a linear model. We could do the converse by switching the positions of <code>water_cent</code> and <code>shade_cent</code>. If we substitute the equation for <span class="math inline">\(\gamma_{1, i}\)</span> into the equation for <span class="math inline">\(\mu_i\)</span>, we get</p>
<p><span class="math display">\[\begin{align*}
\mu_i   &amp; = \alpha + \underbrace{(\beta_1 + \beta_3 \text{shade_cent}_i)}_{\gamma_{1, i}} \text{water_cent}_i + \beta_2 \text{shade_cent}_i \\
        &amp; = \alpha + \beta_1  \text{water_cent}_i + (\beta_3 \text{shade_cent}_i \cdot \text{water_cent}_i) + \beta_2 \text{shade_cent}_i \\
        &amp; = \alpha + \beta_1  \text{water_cent}_i + \beta_2 \text{shade_cent}_i  + \beta_3 (\text{shade_cent}_i \cdot \text{water_cent}_i),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\beta_3\)</span> is the interaction term which makes <code>water_cent</code> and <code>shade_cent</code> conditional on each other. If we use the same priors as before, we might write the full equation for our interaction model as</p>
<p><span class="math display">\[\begin{align*}
\text{blooms_std}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{water_cent}_i + \beta_2 \text{shade_cent}_i + \beta_3 \text{shade_cent}_i \cdot \text{water_cent}_i\\
\alpha  &amp; \sim \operatorname{Normal} (0.5, 0.25) \\
\beta_1 &amp; \sim \operatorname{Normal} (0, 0.25) \\
\beta_2 &amp; \sim \operatorname{Normal} (0, 0.25) \\
\beta_3 &amp; \sim \operatorname{Normal} (0, 0.25) \\
\sigma  &amp; \sim \operatorname{Exponential} (1).
\end{align*}\]</span></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb985-1" data-line-number="1">b8<span class="fl">.5</span> &lt;-</a>
<a class="sourceLine" id="cb985-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb985-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb985-4" data-line-number="4">      blooms_std <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>water_cent <span class="op">+</span><span class="st"> </span>shade_cent <span class="op">+</span><span class="st"> </span>water_cent<span class="op">:</span>shade_cent,</a>
<a class="sourceLine" id="cb985-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb985-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> water_cent),</a>
<a class="sourceLine" id="cb985-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> shade_cent),</a>
<a class="sourceLine" id="cb985-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;water_cent:shade_cent&quot;</span>),</a>
<a class="sourceLine" id="cb985-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb985-10" data-line-number="10">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb985-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb985-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b08.05&quot;</span>)</a></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb986-1" data-line-number="1"><span class="kw">print</span>(b8<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: blooms_std ~ 1 + water_cent + shade_cent + water_cent:shade_cent 
##    Data: d (Number of observations: 27) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept                 0.36      0.03     0.30     0.41 1.00     4805     2695
## water_cent                0.21      0.03     0.14     0.27 1.00     4846     2919
## shade_cent               -0.11      0.03    -0.18    -0.04 1.00     5168     2703
## water_cent:shade_cent    -0.14      0.04    -0.22    -0.06 1.00     4423     2769
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.14      0.02     0.11     0.20 1.00     3315     2707
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The row for the interaction term, <code>water_cent:shade_cent</code>, indicates the marginal posterior is negative.</p>
</div>
<div id="plotting-posterior-predictions." class="section level3">
<h3><span class="header-section-number">8.3.3</span> Plotting posterior predictions.</h3>
<p>Now we’re ready for the top row of Figure 8.8. Here’s our variation on McElreath’s triptych loop code, adjusted for <strong>brms</strong> and <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb988-1" data-line-number="1"><span class="co"># loop over values of `water_c` and plot predictions</span></a>
<a class="sourceLine" id="cb988-2" data-line-number="2"><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb988-3" data-line-number="3">  <span class="co"># define the subset of the original data</span></a>
<a class="sourceLine" id="cb988-4" data-line-number="4">  dt &lt;-<span class="st"> </span>d[d<span class="op">$</span>shade_cent <span class="op">==</span><span class="st"> </span>s, ]</a>
<a class="sourceLine" id="cb988-5" data-line-number="5">  <span class="co"># defining our new data</span></a>
<a class="sourceLine" id="cb988-6" data-line-number="6">  nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">shade_cent =</span> s, <span class="dt">water_cent =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb988-7" data-line-number="7">  <span class="co"># use our sampling skills, like before</span></a>
<a class="sourceLine" id="cb988-8" data-line-number="8">  f &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb988-9" data-line-number="9"><span class="st">    </span><span class="kw">fitted</span>(b8<span class="fl">.4</span>, </a>
<a class="sourceLine" id="cb988-10" data-line-number="10">           <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb988-11" data-line-number="11">           <span class="dt">summary =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-12" data-line-number="12"><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-13" data-line-number="13"><span class="st">    </span><span class="kw">set_names</span>(<span class="st">&quot;-1&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-14" data-line-number="14"><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-15" data-line-number="15"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-16" data-line-number="16"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="op">-</span>row,</a>
<a class="sourceLine" id="cb988-17" data-line-number="17">                 <span class="dt">names_to =</span> <span class="st">&quot;water_cent&quot;</span>,</a>
<a class="sourceLine" id="cb988-18" data-line-number="18">                 <span class="dt">values_to =</span> <span class="st">&quot;blooms_std&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-19" data-line-number="19"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">water_cent =</span> <span class="kw">as.double</span>(water_cent))</a>
<a class="sourceLine" id="cb988-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb988-21" data-line-number="21">  <span class="co"># specify our custom plot</span></a>
<a class="sourceLine" id="cb988-22" data-line-number="22">  fig &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb988-23" data-line-number="23"><span class="st">    </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dt,</a>
<a class="sourceLine" id="cb988-24" data-line-number="24">           <span class="kw">aes</span>(<span class="dt">x =</span> water_cent, <span class="dt">y =</span> blooms_std)) <span class="op">+</span></a>
<a class="sourceLine" id="cb988-25" data-line-number="25"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data =</span> f,</a>
<a class="sourceLine" id="cb988-26" data-line-number="26">              <span class="kw">aes</span>(<span class="dt">group =</span> row),</a>
<a class="sourceLine" id="cb988-27" data-line-number="27">              <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">6</span>)[<span class="dv">6</span>], <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb988-28" data-line-number="28"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">6</span>)[<span class="dv">6</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb988-29" data-line-number="29"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Water (centered)&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb988-30" data-line-number="30"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Shade (centered) =&quot;</span>, s),</a>
<a class="sourceLine" id="cb988-31" data-line-number="31">         <span class="dt">y =</span> <span class="st">&quot;Blooms (standardized)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb988-32" data-line-number="32"><span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb988-33" data-line-number="33">                    <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb988-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb988-35" data-line-number="35">  <span class="co"># plot that joint</span></a>
<a class="sourceLine" id="cb988-36" data-line-number="36">  <span class="kw">plot</span>(fig)</a>
<a class="sourceLine" id="cb988-37" data-line-number="37">}</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-42-1.png" width="220.8" style="display: block; margin: auto;" /><img src="08_files/figure-gfm/unnamed-chunk-42-2.png" width="220.8" style="display: block; margin: auto;" /><img src="08_files/figure-gfm/unnamed-chunk-42-3.png" width="220.8" style="display: block; margin: auto;" /></p>
<p>We don’t necessarily need a loop. We can achieve all of McElreath’s Figure 8.8 with <code>fitted()</code>, some data wrangling, and a little help from <code>ggplot2::facet_grid()</code>.</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb989-1" data-line-number="1"><span class="co"># augment the data</span></a>
<a class="sourceLine" id="cb989-2" data-line-number="2">points &lt;-</a>
<a class="sourceLine" id="cb989-3" data-line-number="3"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="dt">fit =</span> <span class="kw">c</span>(<span class="st">&quot;b8.4&quot;</span>, <span class="st">&quot;b8.5&quot;</span>),</a>
<a class="sourceLine" id="cb989-5" data-line-number="5">         <span class="kw">nesting</span>(shade_cent, water_cent, blooms_std)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_grid =</span> <span class="kw">str_c</span>(<span class="st">&quot;shade_cent = &quot;</span>, shade_cent),</a>
<a class="sourceLine" id="cb989-7" data-line-number="7">         <span class="dt">y_grid =</span> fit)</a>
<a class="sourceLine" id="cb989-8" data-line-number="8"></a>
<a class="sourceLine" id="cb989-9" data-line-number="9"><span class="co"># redefine `nd`</span></a>
<a class="sourceLine" id="cb989-10" data-line-number="10">nd &lt;-<span class="st"> </span><span class="kw">crossing</span>(<span class="dt">shade_cent =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb989-11" data-line-number="11">               <span class="dt">water_cent =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb989-12" data-line-number="12"></a>
<a class="sourceLine" id="cb989-13" data-line-number="13"><span class="co"># use `fitted()`</span></a>
<a class="sourceLine" id="cb989-14" data-line-number="14"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb989-15" data-line-number="15"></a>
<a class="sourceLine" id="cb989-16" data-line-number="16"><span class="kw">rbind</span>(<span class="kw">fitted</span>(b8<span class="fl">.4</span>, <span class="dt">newdata =</span> nd, <span class="dt">summary =</span> F, <span class="dt">nsamples =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb989-17" data-line-number="17">      <span class="kw">fitted</span>(b8<span class="fl">.5</span>, <span class="dt">newdata =</span> nd, <span class="dt">summary =</span> F, <span class="dt">nsamples =</span> <span class="dv">20</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-18" data-line-number="18"><span class="st">  </span><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb989-19" data-line-number="19"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-20" data-line-number="20"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">mutate</span>(nd, <span class="dt">name =</span> <span class="kw">str_c</span>(shade_cent, water_cent, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb989-22" data-line-number="22">         <span class="dt">fit =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;b8.4&quot;</span>, <span class="st">&quot;b8.5&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-23" data-line-number="23"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(row<span class="op">:</span>fit),</a>
<a class="sourceLine" id="cb989-24" data-line-number="24">               <span class="dt">values_to =</span> <span class="st">&quot;blooms_std&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-25" data-line-number="25"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;shade_cent&quot;</span>, <span class="st">&quot;water_cent&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-26" data-line-number="26"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">shade_cent =</span> shade_cent <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb989-27" data-line-number="27">         <span class="dt">water_cent =</span> water_cent <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-28" data-line-number="28"><span class="st">  </span><span class="co"># these will come in handy for `ggplot2::facet_grid()`</span></a>
<a class="sourceLine" id="cb989-29" data-line-number="29"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_grid =</span> <span class="kw">str_c</span>(<span class="st">&quot;shade_cent = &quot;</span>, shade_cent),</a>
<a class="sourceLine" id="cb989-30" data-line-number="30">         <span class="dt">y_grid =</span> fit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb989-31" data-line-number="31"><span class="st">  </span></a>
<a class="sourceLine" id="cb989-32" data-line-number="32"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb989-33" data-line-number="33"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> water_cent, <span class="dt">y =</span> blooms_std)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-34" data-line-number="34"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> row),</a>
<a class="sourceLine" id="cb989-35" data-line-number="35">            <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">6</span>)[<span class="dv">6</span>], <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-36" data-line-number="36"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> points,</a>
<a class="sourceLine" id="cb989-37" data-line-number="37">             <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">6</span>)[<span class="dv">6</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-38" data-line-number="38"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Water (centered)&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-39" data-line-number="39"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Blooms (standardized)&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-40" data-line-number="40"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Posterior predicted blooms&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-41" data-line-number="41"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb989-42" data-line-number="42">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-43" data-line-number="43"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb989-44" data-line-number="44"><span class="st">  </span><span class="kw">facet_grid</span>(y_grid <span class="op">~</span><span class="st"> </span>x_grid)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-43-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-prior-predictions." class="section level3">
<h3><span class="header-section-number">8.3.4</span> Plotting prior predictions.</h3>
<p>In some of the earlier models in this book, we used the <code>sample_prior = T</code> argument within <code>brm()</code> to simultaneously sample from the posterior and prior distributions. As far as the priors go, we could then retrieve their draws from the <code>prior_samples()</code> function and plot as desired. And to be clear, we could use this method to remake Figure 8.8 with our <strong>brms</strong> fits.</p>
<p>However, a limitation of the <code>sample_prior = T</code> method is it will not work if you’re trying to use a <code>fitted()</code>-oriented work flow. Happily, we have an alternative. Within <code>brm()</code>, set <code>sample_prior = &quot;only&quot;</code>. The resulting fit object will be based solely on the priors. Here we’ll use this method within <code>update()</code> to refit the last two models.</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb990-1" data-line-number="1">b8<span class="fl">.4</span>p &lt;-</a>
<a class="sourceLine" id="cb990-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b8<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb990-3" data-line-number="3">         <span class="dt">sample_prior =</span> <span class="st">&quot;only&quot;</span>,</a>
<a class="sourceLine" id="cb990-4" data-line-number="4">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb990-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb990-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/b08.04p&quot;</span>)</a>
<a class="sourceLine" id="cb990-7" data-line-number="7"></a>
<a class="sourceLine" id="cb990-8" data-line-number="8">b8<span class="fl">.5</span>p &lt;-</a>
<a class="sourceLine" id="cb990-9" data-line-number="9"><span class="st">  </span><span class="kw">update</span>(b8<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb990-10" data-line-number="10">         <span class="dt">sample_prior =</span> <span class="st">&quot;only&quot;</span>,</a>
<a class="sourceLine" id="cb990-11" data-line-number="11">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb990-12" data-line-number="12">         <span class="dt">seed =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb990-13" data-line-number="13">         <span class="dt">file =</span> <span class="st">&quot;fits/b08.05p&quot;</span>)</a></code></pre></div>
<p>Now we can insert <code>b8.4p</code> and <code>b8.5p</code> into the <code>fitted()</code> function and plot the prior predictions we desire.</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb991-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb991-2" data-line-number="2"></a>
<a class="sourceLine" id="cb991-3" data-line-number="3"><span class="kw">rbind</span>(<span class="kw">fitted</span>(b8<span class="fl">.4</span>p, <span class="dt">newdata =</span> nd, <span class="dt">summary =</span> F, <span class="dt">nsamples =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb991-4" data-line-number="4">      <span class="kw">fitted</span>(b8<span class="fl">.5</span>p, <span class="dt">newdata =</span> nd, <span class="dt">summary =</span> F, <span class="dt">nsamples =</span> <span class="dv">20</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-5" data-line-number="5"><span class="st">  </span><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb991-6" data-line-number="6"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-7" data-line-number="7"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">mutate</span>(nd, <span class="dt">name =</span> <span class="kw">str_c</span>(shade_cent, water_cent, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">times =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb991-9" data-line-number="9">         <span class="dt">fit =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;b8.4&quot;</span>, <span class="st">&quot;b8.5&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(row<span class="op">:</span>fit),</a>
<a class="sourceLine" id="cb991-11" data-line-number="11">               <span class="dt">values_to =</span> <span class="st">&quot;blooms_std&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-12" data-line-number="12"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;shade_cent&quot;</span>, <span class="st">&quot;water_cent&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">shade_cent =</span> shade_cent <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb991-14" data-line-number="14">         <span class="dt">water_cent =</span> water_cent <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-15" data-line-number="15"><span class="st">  </span><span class="co"># these will come in handy for `ggplot2::facet_grid()`</span></a>
<a class="sourceLine" id="cb991-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_grid =</span> <span class="kw">str_c</span>(<span class="st">&quot;shade_cent = &quot;</span>, shade_cent),</a>
<a class="sourceLine" id="cb991-17" data-line-number="17">         <span class="dt">y_grid =</span> fit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb991-18" data-line-number="18"><span class="st">  </span></a>
<a class="sourceLine" id="cb991-19" data-line-number="19"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb991-20" data-line-number="20"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> water_cent, <span class="dt">y =</span> blooms_std, <span class="dt">group =</span> row)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> row <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">size =</span> row <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb991-23" data-line-number="23">            <span class="dt">color =</span> <span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">6</span>)[<span class="dv">6</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-25" data-line-number="25"><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Water (centered)&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-27" data-line-number="27"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Blooms (standardized)&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-28" data-line-number="28"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Prior predicted blooms&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-29" data-line-number="29"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb991-30" data-line-number="30">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-31" data-line-number="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb991-32" data-line-number="32">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">palette_pander</span>(<span class="dt">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb991-33" data-line-number="33"><span class="st">  </span><span class="kw">facet_grid</span>(y_grid <span class="op">~</span><span class="st"> </span>x_grid)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It was the <code>aes()</code> statement within <code>geom_line()</code> and the <code>scale_size_manual()</code> and <code>scale_alpha_manual()</code> lines that followed that allowed us to bold the one line in each panel. Relatedly, it was the <code>set.seed()</code> line at the top of the code block that made the results reproducible.</p>
<blockquote>
<p>What can we say about these priors, overall? They are harmless, but only weakly realistic. Most of the lines stay within the valid outcome space. But silly trends are not rare. We could do better. We could also do a lot worse, such as flat priors which would consider plausible that even a tiny increase in shade would kill all the tulips. If you displayed these priors to your colleagues, a reasonable summary might be, “These priors contain no bias towards positive or negative effects, and at the same time they very weakly bound the effects to realistic ranges.” (p. 260)</p>
</blockquote>
</div>
</div>
<div id="summary-bonus-conditional_effects" class="section level2">
<h2><span class="header-section-number">8.4</span> <del>Summary</del> Bonus: <code>conditional_effects()</code></h2>
<p>The <strong>brms</strong> package includes the <code>conditional_effects()</code> function as a convenient way to look at simple effects and two-way interactions. Recall the simple univariable model, <code>b8.1b</code>.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb992-1" data-line-number="1">b8<span class="fl">.1</span>b<span class="op">$</span>formula</a></code></pre></div>
<pre><code>## log_gdp_std ~ 1 + rugged_std_c</code></pre>
<p>We can look at the regression line and its percentile-based intervals like so.</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb994-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.1</span>b)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-46-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>If we feed the <code>conditional_effects()</code> output into the <code>plot()</code> function with a <code>points = T</code> argument, we can add the original data to the figure.</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb995-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.1</span>b) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb995-2" data-line-number="2"><span class="st">  </span><span class="kw">plot</span>(<span class="dt">points =</span> T)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-47-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>We can further customize the plot. For example, we can replace the intervals with a spaghetti plot. While we’re at it, we can use <code>point_args</code> to adjust the <code>geom_jitter()</code> parameters and <code>line_args()</code> to adjust the line marking off the posterior median.</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb996-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.1</span>b,</a>
<a class="sourceLine" id="cb996-2" data-line-number="2">                    <span class="dt">spaghetti =</span> T, </a>
<a class="sourceLine" id="cb996-3" data-line-number="3">                    <span class="dt">nsamples =</span> <span class="dv">200</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb996-4" data-line-number="4"><span class="st">  </span><span class="kw">plot</span>(<span class="dt">points =</span> T,</a>
<a class="sourceLine" id="cb996-5" data-line-number="5">       <span class="dt">point_args =</span> <span class="kw">c</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb996-6" data-line-number="6">       <span class="dt">line_args =</span> <span class="kw">c</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-48-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>With multiple predictors, things get more complicated. Consider our multivariable, non-interaction model, <code>b8.2</code>.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb997-1" data-line-number="1">b8<span class="fl">.2</span><span class="op">$</span>formula</a></code></pre></div>
<pre><code>## log_gdp_std ~ 0 + cid + rugged_std_c</code></pre>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb999-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.2</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-49-1.png" width="336" style="display: block; margin: auto;" /><img src="08_files/figure-gfm/unnamed-chunk-49-2.png" width="336" style="display: block; margin: auto;" /></p>
<p>We got one plot for each predictor, controlling the other predictor at zero. Note how the plot for <code>cid</code> treated it as a categorical variable. This is because the variable was saved as a character in the original data set.</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1000-1" data-line-number="1">b8<span class="fl">.2</span><span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1000-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 170
## Columns: 3
## $ log_gdp_std  &lt;dbl&gt; 0.8797119, 0.9647547, 1.1662705, 1.1044854, 0.9149038, 1.0816501, 1.1909183,…
## $ cid          &lt;chr&gt; &quot;1&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;2&quot;, &quot;1&quot;, &quot;2&quot;, &quot;1&quot;, &quot;1&quot;, &quot;2&quot;, &quot;2&quot;, &quot;…
## $ rugged_std_c &lt;dbl&gt; -0.07661760, 0.33760362, -0.09096781, -0.09000038, 0.21844851, -0.21399264, …</code></pre>
<p>The results would have been similar had we saved <code>cid</code> as a factor. Things get more complicated with the non-linear interaction model, <code>b8.3</code>.</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1002-1" data-line-number="1">b8<span class="fl">.3</span><span class="op">$</span>formula</a></code></pre></div>
<pre><code>## log_gdp_std ~ 0 + a + b * rugged_std_c 
## a ~ 0 + cid
## b ~ 0 + cid</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1004-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.3</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-51-1.png" width="336" style="display: block; margin: auto;" /><img src="08_files/figure-gfm/unnamed-chunk-51-2.png" width="336" style="display: block; margin: auto;" /></p>
<p>The <code>conditional_effects()</code> function correctly picked up on how we used the <code>a</code> parameter to make two intercepts according to the two levels of <code>cid</code>. However, it did not pick up our intent to use the <code>b</code> parameter as a stand-in for the two levels of the slope for <code>rugged_std_c</code>. Instead, it only showed the slope for <code>rugged_std_c == 1</code>. In GitHub <a href="https://github.com/paul-buerkner/brms/issues/925#issuecomment-641840494">issue #925</a>, Bürkner clarified this is because “brms will only display interactions by default if the interactions are explictely provided within linear formulas. brms has no way of knowing what variables in non-linear models actually interact.” However, the <code>effects</code> argument provides a workaround.</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.3</span>, <span class="dt">effects =</span> <span class="st">&quot;rugged_std_c:cid&quot;</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-52-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>The <code>conditional_effects()</code> function defaults to expressing interactions such that the first variable in the term–in this case, <code>rugged_std_c</code>–is on the <span class="math inline">\(x\)</span>-axis and the second variable in the term–<code>cid</code>, treated as an integer–is treated as a factor using different values for the <code>fill</code> and <code>color</code> of the trajectories. See what happens when we change the ordering.</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1006-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.3</span>, <span class="dt">effects =</span> <span class="st">&quot;cid:rugged_std_c&quot;</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-53-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Now our binary index variable <code>cid</code> is on the <span class="math inline">\(x\)</span>-axis and the error bars for the effects are now depicted by three levels of the continuous variable <code>rugged_std_c</code>. By default, those are the mean <span class="math inline">\(\pm\)</span> one standard deviation. We might confirm those values like this.</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" data-line-number="1">b8<span class="fl">.3</span><span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1007-2" data-line-number="2"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean          =</span> <span class="kw">mean</span>(rugged_std_c),</a>
<a class="sourceLine" id="cb1007-3" data-line-number="3">            <span class="st">`</span><span class="dt">mean + 1 sd</span><span class="st">`</span> =<span class="st"> </span><span class="kw">mean</span>(rugged_std_c) <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(rugged_std_c),</a>
<a class="sourceLine" id="cb1007-4" data-line-number="4">            <span class="st">`</span><span class="dt">mean - 1 sd</span><span class="st">`</span> =<span class="st"> </span><span class="kw">mean</span>(rugged_std_c) <span class="op">-</span><span class="st"> </span><span class="kw">sd</span>(rugged_std_c)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1007-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_all</span>(round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   mean mean + 1 sd mean - 1 sd
## 1    0        0.19       -0.19</code></pre>
<p>Now we might use <code>b8.5</code>, our interaction model with two continuous variables, to get a sense of how this behavior works in that context.</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" data-line-number="1">b8<span class="fl">.5</span><span class="op">$</span>formula</a></code></pre></div>
<pre><code>## blooms_std ~ 1 + water_cent + shade_cent + water_cent:shade_cent</code></pre>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" data-line-number="1"><span class="kw">conditional_effects</span>(b8<span class="fl">.5</span>, <span class="dt">effects =</span> <span class="st">&quot;water_cent:shade_cent&quot;</span>)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-55-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Once again, the three levels of the second variable in the interactino term, <code>shade_cent</code>, are the mean <span class="math inline">\(\pm\)</span> one standard deviation. If you’d like to set these to different values, such as -1, 0, and 1, define those within a list and feed that list into the <code>int_conditions</code> argument within <code>conditional_effects()</code>. We’ll do that in the next plot in a bit.</p>
<p>Though the paradigm of using the <code>conditional_effects()</code> and <code>plot()</code> functions allows users to augment the results with a variety of options, users to not have the full flexibility of <strong>ggplot2</strong> with this approach. If you’re picky and want to augment the plot further with other <strong>ggplot2</strong> settings, you need to:</p>
<ul>
<li>save the settings from <code>conditional_effects()</code> as an object,</li>
<li>feed that object into <code>plot()</code>,</li>
<li>set the <code>plot</code> argument to <code>FALSE</code> within the <code>plot()</code> function,</li>
<li>index using bracket, and finally</li>
<li>customize away with other <strong>ggplot2</strong> functions.</li>
</ul>
<p>Here’s an example of what that might look like.</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1012-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1012-2" data-line-number="2"><span class="st">  </span><span class="kw">conditional_effects</span>(b8<span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb1012-3" data-line-number="3">                      <span class="dt">effects =</span> <span class="st">&quot;water_cent:shade_cent&quot;</span>,</a>
<a class="sourceLine" id="cb1012-4" data-line-number="4">                      <span class="dt">int_conditions =</span> <span class="kw">list</span>(<span class="dt">shade_cent =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1012-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1012-6" data-line-number="6"><span class="kw">plot</span>(p1,</a>
<a class="sourceLine" id="cb1012-7" data-line-number="7">     <span class="dt">points =</span> T,</a>
<a class="sourceLine" id="cb1012-8" data-line-number="8">     <span class="dt">plot =</span> F)[[<span class="dv">1</span>]] <span class="op">+</span></a>
<a class="sourceLine" id="cb1012-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_fill_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1012-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_colour_pander</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1012-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">-1</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1012-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1012-13" data-line-number="13">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1012-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>shade_cent, <span class="dt">labeller =</span> label_both)</a></code></pre></div>
<p><img src="08_files/figure-gfm/unnamed-chunk-56-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>I tend to prefer using other plotting methods when visualizing models, so we won’t be seeing much more from the <code>conditional_effects()</code> function in this ebook. But if you like method, you can find more ideas by checking out the <code>conditional_effects</code> section of the <a href="https://cran.r-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(Bürkner, <a href="#ref-brms2020RM">2020</a><a href="#ref-brms2020RM">g</a>, p. 55)</span> or searching for “conditional_effects” under the <a href="https://discourse.mc-stan.org/c/interfaces/brms/36">“brms” tag on the Stan Forums</a>.</p>
</div>
<div id="session-info-7" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_2.1.1      patchwork_1.0.0      ggrepel_0.8.2        ggdag_0.2.2         
##  [5] forcats_0.5.0        stringr_1.4.0        dplyr_0.8.5          purrr_0.3.4         
##  [9] readr_1.3.1          tidyr_1.0.2          tibble_3.0.1         tidyverse_1.3.0     
## [13] ggthemes_4.2.0       brms_2.13.0          Rcpp_1.0.4.6         dagitty_0.2-2       
## [17] rstan_2.19.3         ggplot2_3.3.1        StanHeaders_2.21.0-1
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.1.7      plyr_1.8.6           igraph_1.2.5        
##   [5] svUnit_1.0.3         splines_3.6.3        crosstalk_1.1.0.1    TH.data_1.0-10      
##   [9] rstantools_2.0.0     inline_0.3.15        digest_0.6.25        htmltools_0.4.0     
##  [13] viridis_0.5.1        rsconnect_0.8.16     fansi_0.4.1          magrittr_1.5        
##  [17] graphlayouts_0.7.0   modelr_0.1.6         matrixStats_0.56.0   xts_0.12-0          
##  [21] sandwich_2.5-1       prettyunits_1.1.1    colorspace_1.4-1     rvest_0.3.5         
##  [25] ggdist_2.1.1         haven_2.2.0          xfun_0.13            callr_3.4.3         
##  [29] crayon_1.3.4         jsonlite_1.6.1       survival_3.1-12      zoo_1.8-7           
##  [33] glue_1.4.1           polyclip_1.10-0      gtable_0.3.0         emmeans_1.4.5       
##  [37] V8_3.0.2             pkgbuild_1.0.8       shape_1.4.4          abind_1.4-5         
##  [41] scales_1.1.1         mvtnorm_1.1-0        DBI_1.1.0            miniUI_0.1.1.1      
##  [45] viridisLite_0.3.0    xtable_1.8-4         stats4_3.6.3         DT_0.13             
##  [49] htmlwidgets_1.5.1    httr_1.4.1           threejs_0.3.3        arrayhelpers_1.1-0  
##  [53] ellipsis_0.3.1       pkgconfig_2.0.3      loo_2.2.0            farver_2.0.3        
##  [57] dbplyr_1.4.2         utf8_1.1.4           labeling_0.3         tidyselect_1.0.0    
##  [61] rlang_0.4.6          reshape2_1.4.4       later_1.0.0          munsell_0.5.0       
##  [65] cellranger_1.1.0     tools_3.6.3          cli_2.0.2            generics_0.0.2      
##  [69] broom_0.5.5          ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1       
##  [73] yaml_2.2.1           processx_3.4.2       knitr_1.28           fs_1.4.1            
##  [77] tidygraph_1.2.0      pander_0.6.3         ggraph_2.0.3         nlme_3.1-144        
##  [81] mime_0.9             xml2_1.3.1           compiler_3.6.3       bayesplot_1.7.1     
##  [85] shinythemes_1.1.2    rstudioapi_0.11      curl_4.3             reprex_0.3.0        
##  [89] tweenr_1.0.1         stringi_1.4.6        ps_1.3.3             Brobdingnag_1.2-6   
##  [93] lattice_0.20-38      Matrix_1.2-18        markdown_1.1         shinyjs_1.1         
##  [97] vctrs_0.3.1          pillar_1.4.4         lifecycle_0.2.0      bridgesampling_1.0-0
## [101] estimability_1.3     httpuv_1.5.2         R6_2.4.1             bookdown_0.18       
## [105] promises_1.1.0       gridExtra_2.3        codetools_0.2-16     boot_1.3-24         
## [109] colourpicker_1.0     MASS_7.3-51.5        gtools_3.8.2         assertthat_0.2.1    
## [113] withr_2.2.0          shinystan_2.5.0      multcomp_1.4-13      mgcv_1.8-31         
## [117] hms_0.5.3            grid_3.6.3           coda_0.19-3          rmarkdown_2.1       
## [121] ggforce_0.3.1        shiny_1.4.0.2        lubridate_1.7.8      base64enc_0.1-3     
## [125] dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-ggthemes">
<p>Arnold, J. B. (2019). <em>ggthemes: Extra themes, scales and geoms for ’ggplot2’</em>. <a href="https://CRAN.R-project.org/package=ggthemes">https://CRAN.R-project.org/package=ggthemes</a></p>
</div>
<div id="ref-Bürkner2020Non_linear">
<p>Bürkner, P.-C. (2020d). <em>Estimating non-linear models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html</a></p>
</div>
<div id="ref-brms2020RM">
<p>Bürkner, P.-C. (2020g). <em>brms reference manual, Version 2.12.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a></p>
</div>
<div id="ref-grafenModernStatisticsLife2002">
<p>Grafen, A., &amp; Hails, R. (2002). <em>Modern statistics for the life sciences</em>. Oxford University Press. <a href="https://global.oup.com/academic/product/modern-statistics-for-the-life-sciences-9780199252312?">https://global.oup.com/academic/product/modern-statistics-for-the-life-sciences-9780199252312?</a></p>
</div>
<div id="ref-hayes2017introduction">
<p>Hayes, A. F. (2017). <em>Introduction to mediation, moderation, and conditional process analysis: A regression-based approach</em>. Guilford publications. <a href="https://www.guilford.com/books/Introduction-to-Mediation-Moderation-and-Conditional-Process-Analysis/Andrew-Hayes/9781462534654">https://www.guilford.com/books/Introduction-to-Mediation-Moderation-and-Conditional-Process-Analysis/Andrew-Hayes/9781462534654</a></p>
</div>
<div id="ref-kurzStatisticalRethinkingBrms2020">
<p>Kurz, A. S. (2020a). <em>Statistical rethinking with brms, ggplot2, and the tidyverse</em> (version 1.1.0). <a href="https://doi.org/10.5281/zenodo.3693202">https://doi.org/10.5281/zenodo.3693202</a></p>
</div>
<div id="ref-kurzRecodingIntroductionMediation2019">
<p>Kurz, A. S. (2019). <em>Recoding Introduction to mediation, moderation, and conditional process analysis</em> (version 1.1.0). <a href="https://doi.org/10.5281/zenodo.3589999">https://doi.org/10.5281/zenodo.3589999</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020a). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2015">
<p>McElreath, R. (2015). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em>. CRC press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-nunn2012ruggedness">
<p>Nunn, N., &amp; Puga, D. (2012). Ruggedness: The blessing of bad geography in Africa. <em>Review of Economics and Statistics</em>, <em>94</em>(1), 20–36. <a href="https://doi.org/10.1162/REST_a_00161">https://doi.org/10.1162/REST_a_00161</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ulysses-compass.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="markov-chain-monte-carlo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
