<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="conditional-manatees.html"/>
<link rel="next" href="big-entropy-and-the-generalized-linear-model.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/twitter-widget-0.0.1/widgets.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.1."><i class="fa fa-check"></i>Version 0.1.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.3.0."><i class="fa fa-check"></i>Version 0.3.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.4.0."><i class="fa fa-check"></i>Version 0.4.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#were-not-done-yet-and-i-could-use-your-help."><i class="fa fa-check"></i>We’re not done yet and I could use your help.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression."><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression.</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-first-bonus-smooth-functions-with-brmss"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> First bonus: Smooth functions with <code>brms::s()</code></a></li>
<li class="chapter" data-level="4.7" data-path="geocentric-models.html"><a href="geocentric-models.html#second-bonus-group-predictors-with-matrix-columns"><i class="fa fa-check"></i><b>4.7</b> Second bonus: Group predictors with matrix columns</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#summary-bonus-we-can-model-categorical-variables-in-more-ways-than-one"><i class="fa fa-check"></i><b>5.4</b> <del>Summary</del> Bonus: We can model categorical variables in more ways than one</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#you-can-use-a-dummy."><i class="fa fa-check"></i><b>5.4.1</b> You can use a dummy.</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#consider-contrast-coding."><i class="fa fa-check"></i><b>5.4.2</b> Consider contrast coding.</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#theres-always-the-multilevel-anova-approach."><i class="fa fa-check"></i><b>5.4.3</b> There’s always the multilevel ANOVA approach.</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#would-you-like-to-learn-more"><i class="fa fa-check"></i><b>5.4.4</b> Would you like to learn more?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria."><i class="fa fa-check"></i><b>7.4.2</b> Information criteria.</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.4.3</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.5.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>7.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#another-parable."><i class="fa fa-check"></i><b>9.3.1</b> Another parable.</a></li>
<li class="chapter" data-level="9.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#particles-in-space."><i class="fa fa-check"></i><b>9.3.2</b> Particles in space.</a></li>
<li class="chapter" data-level="9.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.3</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to outcomes.</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.2</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#bonus-survival-analysis"><i class="fa fa-check"></i><b>11.5</b> Bonus: Survival analysis</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#survival-summary."><i class="fa fa-check"></i><b>11.5.1</b> Survival summary.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>15.1</b> Measurement error</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>15.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="15.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>15.1.2</b> Error on both outcome and predictor.</a></li>
<li class="chapter" data-level="15.1.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-terrors."><i class="fa fa-check"></i><b>15.1.3</b> Measurement terrors.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>15.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#dag-ate-my-homework."><i class="fa fa-check"></i><b>15.2.1</b> DAG ate my homework.</a></li>
<li class="chapter" data-level="15.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-primates."><i class="fa fa-check"></i><b>15.2.2</b> Imputing primates.</a></li>
<li class="chapter" data-level="15.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#where-is-your-god-now"><i class="fa fa-check"></i><b>15.2.3</b> Where is your god now?</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>15.3</b> Categorical errors and discrete absences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#discrete-cats."><i class="fa fa-check"></i><b>15.3.1</b> Discrete cats.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-bayesian-meta-analysis-with-odds-ratios"><i class="fa fa-check"></i><b>15.5</b> Bonus: Bayesian meta-analysis with odds ratios</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#how-do-meta-analyses-fit-into-the-picture"><i class="fa fa-check"></i><b>15.5.1</b> How do meta-analyses fit into the picture?</a></li>
<li class="chapter" data-level="15.5.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#we-need-some-data."><i class="fa fa-check"></i><b>15.5.2</b> We need some data.</a></li>
<li class="chapter" data-level="15.5.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#our-effect-size-will-be-an-odds-ratio."><i class="fa fa-check"></i><b>15.5.3</b> Our effect size will be an odds ratio.</a></li>
<li class="chapter" data-level="15.5.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#log-odds-odds-ratios-and-modeling-effect-sizes."><i class="fa fa-check"></i><b>15.5.4</b> Log-odds, odds ratios, and modeling effect sizes.</a></li>
<li class="chapter" data-level="15.5.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#compute-the-study-specific-effect-sizes."><i class="fa fa-check"></i><b>15.5.5</b> Compute the study-specific effect sizes.</a></li>
<li class="chapter" data-level="15.5.6" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-meta-analysis."><i class="fa fa-check"></i><b>15.5.6</b> Fit the Bayesian meta-analysis.</a></li>
<li class="chapter" data-level="15.5.7" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-muiltilevel-alternative."><i class="fa fa-check"></i><b>15.5.7</b> Fit the Bayesian muiltilevel alternative.</a></li>
<li class="chapter" data-level="15.5.8" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#relative-to-the-muiltilevel-model-meta-analyses-have-limitations."><i class="fa fa-check"></i><b>15.5.8</b> Relative to the muiltilevel model, meta-analyses have limitations.</a></li>
<li class="chapter" data-level="15.5.9" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#parting-thoughts."><i class="fa fa-check"></i><b>15.5.9</b> Parting thoughts.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#geometric-people"><i class="fa fa-check"></i><b>16.1</b> Geometric people</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model."><i class="fa fa-check"></i><b>16.1.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.1.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model."><i class="fa fa-check"></i><b>16.1.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.1.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#glm-in-disguise."><i class="fa fa-check"></i><b>16.1.3</b> GLM in disguise.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>16.2</b> Hidden minds and observed behavior</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-1"><i class="fa fa-check"></i><b>16.2.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.2.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-1"><i class="fa fa-check"></i><b>16.2.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.2.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#coding-the-statistical-model."><i class="fa fa-check"></i><b>16.2.3</b> Coding the statistical model.</a></li>
<li class="chapter" data-level="16.2.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#state-space-models."><i class="fa fa-check"></i><b>16.2.4</b> State space models.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>16.3</b> Ordinary differential nut cracking</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#scientific-model."><i class="fa fa-check"></i><b>16.3.1</b> Scientific model.</a></li>
<li class="chapter" data-level="16.3.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#statistical-model."><i class="fa fa-check"></i><b>16.3.2</b> Statistical model.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#population-dynamics"><i class="fa fa-check"></i><b>16.4</b> Population dynamics</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-2"><i class="fa fa-check"></i><b>16.4.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.4.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-2"><i class="fa fa-check"></i><b>16.4.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.4.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#lynx-lessons-bonus-practice-with-the-autoregressive-model."><i class="fa fa-check"></i><b>16.4.3</b> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>17</b> <del>Horoscopes</del> Insights</a>
<ul>
<li class="chapter" data-level="17.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>17.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="17.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>17.2</b> Save your model fits</a></li>
<li class="chapter" data-level="17.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>17.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="17.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>17.4</b> Look at your data</a></li>
<li class="chapter" data-level="17.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#consider-using-the-0-intercept-syntax"><i class="fa fa-check"></i><b>17.5</b> Consider using the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="17.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>17.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="17.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>17.7</b> Annotate your code</a></li>
<li class="chapter" data-level="17.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>17.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="17.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>17.9</b> Code in public</a></li>
<li class="chapter" data-level="17.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-social-media"><i class="fa fa-check"></i><b>17.10</b> Check out social media</a></li>
<li class="chapter" data-level="17.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#extra-rethinking-related-resources"><i class="fa fa-check"></i><b>17.11</b> Extra <em>Rethinking</em>-related resources</a></li>
<li class="chapter" data-level="17.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#but-like-how-do-i-do-this-for-real"><i class="fa fa-check"></i><b>17.12</b> <em>But, like, how do I do this for real?</em></a></li>
<li class="chapter" data-level="17.13" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>17.13</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="markov-chain-monte-carlo" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Markov Chain Monte Carlo<a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter introduces one commonplace example of <a href="https://en.wikipedia.org/wiki/Rota_Fortunae#/media/File:Lydgate-siege-troy-wheel-fortune-detail.jpg">Fortuna</a> and <a href="https://en.wikipedia.org/wiki/Minerva#/media/File:Minerva-Vedder-Highsmith-detail-1.jpeg">Minerva</a>’s cooperation: the estimation of posterior probability distributions using a stochastic process known as <strong>Markov chain Monte Carlo</strong> (<strong>MCMC</strong>)” <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020a, p. 263</a>, <strong>emphasis</strong> in the original)</span>. Though we’ve been using MCMC via the <strong>brms</strong> package for chapters, now, this chapter should clarify some of the questions you might have about the details.</p>
<div id="rethinking-stan-was-a-man." class="section level4 hasAnchor" number="9.0.0.1">
<h4><span class="header-section-number">9.0.0.1</span> Rethinking: Stan was a man.<a href="markov-chain-monte-carlo.html#rethinking-stan-was-a-man." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The Stan programming language is not an abbreviation or acronym. Rather, it is named after <a href="https://en.wikipedia.org/wiki/Stanislaw_Ulam">Stanisław Ulam</a>. Ulam is credited as one of the inventors of Markov chain Monte Carlo. Together with Ed Teller, Ulam applied it to designing fusion bombs. But he and others soon applied the general Monte Carlo method to diverse problems of less monstrous nature. Ulam made important contributions in pure mathematics, chaos theory, and molecular and theoretical biology, as well. (p. 264)</p>
</blockquote>
</div>
<div id="good-king-markov-and-his-island-kingdom" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Good King Markov and his island kingdom<a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we simulate King Markov’s journey. In this version of the code, we’ve added <code>set.seed()</code>, which helps make the exact results reproducible.</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="markov-chain-monte-carlo.html#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb1043-2"><a href="markov-chain-monte-carlo.html#cb1043-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-3"><a href="markov-chain-monte-carlo.html#cb1043-3" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb1043-4"><a href="markov-chain-monte-carlo.html#cb1043-4" aria-hidden="true" tabindex="-1"></a>positions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_weeks) </span>
<span id="cb1043-5"><a href="markov-chain-monte-carlo.html#cb1043-5" aria-hidden="true" tabindex="-1"></a>current   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1043-6"><a href="markov-chain-monte-carlo.html#cb1043-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-7"><a href="markov-chain-monte-carlo.html#cb1043-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_weeks) {</span>
<span id="cb1043-8"><a href="markov-chain-monte-carlo.html#cb1043-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1043-9"><a href="markov-chain-monte-carlo.html#cb1043-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># record current position </span></span>
<span id="cb1043-10"><a href="markov-chain-monte-carlo.html#cb1043-10" aria-hidden="true" tabindex="-1"></a>  positions[i] <span class="ot">&lt;-</span> current</span>
<span id="cb1043-11"><a href="markov-chain-monte-carlo.html#cb1043-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flip coin to generate proposal</span></span>
<span id="cb1043-12"><a href="markov-chain-monte-carlo.html#cb1043-12" aria-hidden="true" tabindex="-1"></a>  proposal <span class="ot">&lt;-</span> current <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb1043-13"><a href="markov-chain-monte-carlo.html#cb1043-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now make sure he loops around the archipelago </span></span>
<span id="cb1043-14"><a href="markov-chain-monte-carlo.html#cb1043-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&lt;</span> <span class="dv">1</span>) proposal <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1043-15"><a href="markov-chain-monte-carlo.html#cb1043-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&gt;</span> <span class="dv">10</span>) proposal <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1043-16"><a href="markov-chain-monte-carlo.html#cb1043-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move?</span></span>
<span id="cb1043-17"><a href="markov-chain-monte-carlo.html#cb1043-17" aria-hidden="true" tabindex="-1"></a>  prob_move <span class="ot">&lt;-</span> proposal <span class="sc">/</span> current</span>
<span id="cb1043-18"><a href="markov-chain-monte-carlo.html#cb1043-18" aria-hidden="true" tabindex="-1"></a>  current <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_move, proposal, current)</span>
<span id="cb1043-19"><a href="markov-chain-monte-carlo.html#cb1043-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1043-20"><a href="markov-chain-monte-carlo.html#cb1043-20" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<p>In this chapter, we’ll take our plotting theme from the <a href="https://github.com/gadenbuie/ggpomological"><strong>ggpomological</strong> package</a> <span class="citation">(<a href="#ref-R-ggpomological" role="doc-biblioref">Aden-Buie, 2022</a>)</span>.</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="markov-chain-monte-carlo.html#cb1044-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpomological)</span></code></pre></div>
<p>To get the full benefits from <strong>ggpomological</strong>, you may need to download some fonts. Throughout this chapter, I make extensive use of Marck Script, which you find at <a href="https://fonts.google.com/specimen/Marck+Script">https://fonts.google.com/specimen/Marck+Script</a>. Once you’ve installed the font on your computer, you may also have to execute <code>extrafont::font_import()</code>. Here we get a sense of the colors we’ll be using with our dots and lines and so on.</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="markov-chain-monte-carlo.html#cb1045-1" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">show_col</span>(ggpomological<span class="sc">:::</span>pomological_palette)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-4-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>This will make it easier to access those colors.</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="markov-chain-monte-carlo.html#cb1046-1" aria-hidden="true" tabindex="-1"></a>pomological_palette <span class="ot">&lt;-</span> ggpomological<span class="sc">:::</span>pomological_palette</span></code></pre></div>
<p>Now make Figure 9.2.a.</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="markov-chain-monte-carlo.html#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1047-2"><a href="markov-chain-monte-carlo.html#cb1047-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1047-3"><a href="markov-chain-monte-carlo.html#cb1047-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">week   =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e5</span>,</span>
<span id="cb1047-4"><a href="markov-chain-monte-carlo.html#cb1047-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">island =</span> positions) <span class="sc">%&gt;%</span></span>
<span id="cb1047-5"><a href="markov-chain-monte-carlo.html#cb1047-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> island)) <span class="sc">+</span></span>
<span id="cb1047-6"><a href="markov-chain-monte-carlo.html#cb1047-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">color =</span> pomological_palette[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb1047-7"><a href="markov-chain-monte-carlo.html#cb1047-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1047-8"><a href="markov-chain-monte-carlo.html#cb1047-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1047-9"><a href="markov-chain-monte-carlo.html#cb1047-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb1047-10"><a href="markov-chain-monte-carlo.html#cb1047-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Behold the Metropolis algorithm in action!&quot;</span>,</span>
<span id="cb1047-11"><a href="markov-chain-monte-carlo.html#cb1047-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The dots show the king&#39;s path over the first 100 weeks.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1047-12"><a href="markov-chain-monte-carlo.html#cb1047-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-6-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>Figure 9.2.b.</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="markov-chain-monte-carlo.html#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">week   =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e5</span>,</span>
<span id="cb1048-2"><a href="markov-chain-monte-carlo.html#cb1048-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">island =</span> positions) <span class="sc">%&gt;%</span></span>
<span id="cb1048-3"><a href="markov-chain-monte-carlo.html#cb1048-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">island =</span> <span class="fu">factor</span>(island)) <span class="sc">%&gt;%</span></span>
<span id="cb1048-4"><a href="markov-chain-monte-carlo.html#cb1048-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1048-5"><a href="markov-chain-monte-carlo.html#cb1048-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> island)) <span class="sc">+</span></span>
<span id="cb1048-6"><a href="markov-chain-monte-carlo.html#cb1048-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> pomological_palette[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb1048-7"><a href="markov-chain-monte-carlo.html#cb1048-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;number of weeks&quot;</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb1048-8"><a href="markov-chain-monte-carlo.html#cb1048-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Old Metropolis shines in the long run.&quot;</span>,</span>
<span id="cb1048-9"><a href="markov-chain-monte-carlo.html#cb1048-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Sure enough, the time the king spent on each island</span><span class="sc">\n</span><span class="st">was proportional to its population size.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1048-10"><a href="markov-chain-monte-carlo.html#cb1048-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-7-1.png" width="528" style="display: block; margin: auto;" /></p>
</div>
<div id="metropolis-algorithms" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Metropolis algorithms<a href="markov-chain-monte-carlo.html#metropolis-algorithms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The Metropolis algorithm is the grandparent of several different strategies for getting samples from unknown posterior distributions” (p. 267). If you’re interested, <span class="citation">Robert &amp; Casella (<a href="#ref-robertShortHistoryMarkov2011" role="doc-biblioref">2011</a>)</span> wrote a <a href="https://arxiv.org/pdf/0808.2902.pdf">good historical overview of MCMC</a>.</p>
<div id="gibbs-sampling." class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Gibbs sampling.<a href="markov-chain-monte-carlo.html#gibbs-sampling." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Gibbs sampler <span class="citation">(<a href="#ref-casellaExplainingGibbsSampler1992" role="doc-biblioref">Casella &amp; George, 1992</a>; <a href="#ref-gemanStochasticRelaxationGibbs1984" role="doc-biblioref">Geman &amp; Geman, 1984</a>)</span> uses <em>conjugate</em> pairs (i.e., pairs of priors and likelihoods that have analytic solutions for the posterior of an individual parameter) to efficiently sample from the posterior. Gibbs was the workhorse algorithm during the rise of Bayesian computation in the 1990s and it was highlighted in Bayesian software like BUGS <span class="citation">(<a href="#ref-bugs2003UM" role="doc-biblioref">D. Spiegelhalter et al., 2003</a>)</span> and JAGS <span class="citation">(<a href="#ref-plummerJAGSProgramAnalysis2003" role="doc-biblioref">Plummer, 2003</a>)</span>. We will not be using the Gibbs sampler in this project. It’s available for use in <strong>R</strong>. For an extensive applied introduction, check out Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">text</a>.</p>
</div>
<div id="high-dimensional-problems." class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> High-dimensional problems.<a href="markov-chain-monte-carlo.html#high-dimensional-problems." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Gibbs sampler is limited in that (a) you might not want to use conjugate priors and (b) it can be quite inefficient with complex hierarchical models, which we’ll be fitting soon.</p>
<p>Earlier versions of this ebook did not focus on McElreath’s example of the pathology high autocorrelations can create when using the Metropolis algorithm, which is depicted in Figure 9.3. However, <a href="https://gist.github.com/jameshenegan">James Henegan</a> kindly reached out with a <a href="https://gist.github.com/jameshenegan/2048c8cb19f54b917e4fcd740a7031b9"><strong>tidyverse</strong> workflow for reproducing this example</a>. Here is a slightly amended version of that workflow.</p>
<p>The first step is to simulate a bivariate distribution “with a strong negative correlation of -0.9” (p. 268). Henagen simulated the from a distribution where the two variables <span class="math inline">\(\text a_1\)</span> and <span class="math inline">\(\text a_2\)</span> followed the bivariate normal distribution</p>
<p><span class="math display">\[\begin{align*}
\begin{bmatrix} \text a_1 \\ \text a_2 \end{bmatrix} &amp; \sim \operatorname{MVNormal} \left (\begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf \Sigma \right) \\
\mathbf \Sigma &amp; = \mathbf{SRS} \\
\mathbf S &amp; = \begin{bmatrix} 0.22 &amp; 0 \\ 0 &amp; 0.22 \end{bmatrix} \\
\mathbf R &amp; = \begin{bmatrix} 1 &amp; -.9 \\ -.9 &amp; 1 \end{bmatrix},
\end{align*}\]</span></p>
<p>where the variance/covariance matrix is decomposed into a <span class="math inline">\(2 \times 2\)</span> matrix of standard deviations and a <span class="math inline">\(2 \times 2\)</span> correlation matrix. In this example, both variables (<span class="math inline">\(\text a_1\)</span> and <span class="math inline">\(\text a_2\)</span>) have standard deviations of 0.22. We’ll have more practice with data of this kind in <a href="adventures-in-covariance.html#adventures-in-covariance">Chapter 14</a>. For now, just go with it. Here’s how to simulate from this distribution.</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="markov-chain-monte-carlo.html#cb1049-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean vector</span></span>
<span id="cb1049-2"><a href="markov-chain-monte-carlo.html#cb1049-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1049-3"><a href="markov-chain-monte-carlo.html#cb1049-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-4"><a href="markov-chain-monte-carlo.html#cb1049-4" aria-hidden="true" tabindex="-1"></a><span class="co"># variance/covariance matrix</span></span>
<span id="cb1049-5"><a href="markov-chain-monte-carlo.html#cb1049-5" aria-hidden="true" tabindex="-1"></a>sd_a1 <span class="ot">&lt;-</span> <span class="fl">0.22</span></span>
<span id="cb1049-6"><a href="markov-chain-monte-carlo.html#cb1049-6" aria-hidden="true" tabindex="-1"></a>sd_a2 <span class="ot">&lt;-</span> <span class="fl">0.22</span></span>
<span id="cb1049-7"><a href="markov-chain-monte-carlo.html#cb1049-7" aria-hidden="true" tabindex="-1"></a>rho   <span class="ot">&lt;-</span> <span class="sc">-</span>.<span class="dv">9</span></span>
<span id="cb1049-8"><a href="markov-chain-monte-carlo.html#cb1049-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-9"><a href="markov-chain-monte-carlo.html#cb1049-9" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(sd_a1<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1049-10"><a href="markov-chain-monte-carlo.html#cb1049-10" aria-hidden="true" tabindex="-1"></a>                         rho <span class="sc">*</span> sd_a1 <span class="sc">*</span> sd_a2,</span>
<span id="cb1049-11"><a href="markov-chain-monte-carlo.html#cb1049-11" aria-hidden="true" tabindex="-1"></a>                         rho <span class="sc">*</span> sd_a1 <span class="sc">*</span> sd_a2,</span>
<span id="cb1049-12"><a href="markov-chain-monte-carlo.html#cb1049-12" aria-hidden="true" tabindex="-1"></a>                         sd_a2<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1049-13"><a href="markov-chain-monte-carlo.html#cb1049-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb1049-14"><a href="markov-chain-monte-carlo.html#cb1049-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-15"><a href="markov-chain-monte-carlo.html#cb1049-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from the distribution with the `mvtnorm::rmvnorm()` function</span></span>
<span id="cb1049-16"><a href="markov-chain-monte-carlo.html#cb1049-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb1049-17"><a href="markov-chain-monte-carlo.html#cb1049-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-18"><a href="markov-chain-monte-carlo.html#cb1049-18" aria-hidden="true" tabindex="-1"></a>my_samples <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span></code></pre></div>
<p>Check the sample correlation.</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="markov-chain-monte-carlo.html#cb1050-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(my_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb1050-2"><a href="markov-chain-monte-carlo.html#cb1050-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1050-3"><a href="markov-chain-monte-carlo.html#cb1050-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rho =</span> <span class="fu">cor</span>(a1, a2))</span></code></pre></div>
<pre><code>##          rho
## 1 -0.9106559</code></pre>
<p>We won’t actually be using the values from this simulation. Instead, we can evaluate the <em>density function</em> for this distribution using the <code>mvtnorm::dmvnorm()</code> function. But even before that, we’ll want to create a grid of values for the contour lines in Figure 9.3. Here we do so with a custom function called <code>x_y_grid()</code>.</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="markov-chain-monte-carlo.html#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the function</span></span>
<span id="cb1052-2"><a href="markov-chain-monte-carlo.html#cb1052-2" aria-hidden="true" tabindex="-1"></a>x_y_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x_start =</span> <span class="sc">-</span><span class="fl">1.6</span>,</span>
<span id="cb1052-3"><a href="markov-chain-monte-carlo.html#cb1052-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x_stop =</span> <span class="fl">1.6</span>,</span>
<span id="cb1052-4"><a href="markov-chain-monte-carlo.html#cb1052-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x_length =</span> <span class="dv">100</span>,</span>
<span id="cb1052-5"><a href="markov-chain-monte-carlo.html#cb1052-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_start =</span> <span class="sc">-</span><span class="fl">1.6</span>,</span>
<span id="cb1052-6"><a href="markov-chain-monte-carlo.html#cb1052-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_stop =</span> <span class="fl">1.6</span>,</span>
<span id="cb1052-7"><a href="markov-chain-monte-carlo.html#cb1052-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_length =</span> <span class="dv">100</span>) {</span>
<span id="cb1052-8"><a href="markov-chain-monte-carlo.html#cb1052-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1052-9"><a href="markov-chain-monte-carlo.html#cb1052-9" aria-hidden="true" tabindex="-1"></a>  x_domain <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> x_start, <span class="at">to =</span> x_stop, <span class="at">length.out =</span> x_length)</span>
<span id="cb1052-10"><a href="markov-chain-monte-carlo.html#cb1052-10" aria-hidden="true" tabindex="-1"></a>  y_domain <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> y_start, <span class="at">to =</span> y_stop, <span class="at">length.out =</span> y_length)</span>
<span id="cb1052-11"><a href="markov-chain-monte-carlo.html#cb1052-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1052-12"><a href="markov-chain-monte-carlo.html#cb1052-12" aria-hidden="true" tabindex="-1"></a>  x_y_grid_tibble <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">a1 =</span> x_domain, <span class="at">a2 =</span> y_domain)</span>
<span id="cb1052-13"><a href="markov-chain-monte-carlo.html#cb1052-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1052-14"><a href="markov-chain-monte-carlo.html#cb1052-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_y_grid_tibble)</span>
<span id="cb1052-15"><a href="markov-chain-monte-carlo.html#cb1052-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1052-16"><a href="markov-chain-monte-carlo.html#cb1052-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1052-17"><a href="markov-chain-monte-carlo.html#cb1052-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1052-18"><a href="markov-chain-monte-carlo.html#cb1052-18" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb1052-19"><a href="markov-chain-monte-carlo.html#cb1052-19" aria-hidden="true" tabindex="-1"></a>contour_plot_dat <span class="ot">&lt;-</span> <span class="fu">x_y_grid</span>()</span>
<span id="cb1052-20"><a href="markov-chain-monte-carlo.html#cb1052-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1052-21"><a href="markov-chain-monte-carlo.html#cb1052-21" aria-hidden="true" tabindex="-1"></a><span class="co"># what have we done?</span></span>
<span id="cb1052-22"><a href="markov-chain-monte-carlo.html#cb1052-22" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(contour_plot_dat)</span></code></pre></div>
<pre><code>## tibble [10,000 × 2] (S3: tbl_df/tbl/data.frame)
##  $ a1: num [1:10000] -1.6 -1.6 -1.6 -1.6 -1.6 -1.6 -1.6 -1.6 -1.6 -1.6 ...
##  $ a2: num [1:10000] -1.6 -1.57 -1.54 -1.5 -1.47 ...</code></pre>
<p>Now compute the density values for each combination of <code>a1</code> and <code>a2</code>.</p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="markov-chain-monte-carlo.html#cb1054-1" aria-hidden="true" tabindex="-1"></a>contour_plot_dat <span class="ot">&lt;-</span> </span>
<span id="cb1054-2"><a href="markov-chain-monte-carlo.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>  contour_plot_dat <span class="sc">%&gt;%</span> </span>
<span id="cb1054-3"><a href="markov-chain-monte-carlo.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">as.matrix</span>(contour_plot_dat), <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma))</span>
<span id="cb1054-4"><a href="markov-chain-monte-carlo.html#cb1054-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-5"><a href="markov-chain-monte-carlo.html#cb1054-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(contour_plot_dat)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      a1    a2         d
##   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1  -1.6 -1.6  1.47e-229
## 2  -1.6 -1.57 6.08e-225
## 3  -1.6 -1.54 2.24e-220
## 4  -1.6 -1.50 7.38e-216
## 5  -1.6 -1.47 2.17e-211
## 6  -1.6 -1.44 5.68e-207</code></pre>
<p>To get a sense of what we’ve done, here are those data as a 2D density plot.</p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="markov-chain-monte-carlo.html#cb1056-1" aria-hidden="true" tabindex="-1"></a>contour_plot_dat <span class="sc">%&gt;%</span> </span>
<span id="cb1056-2"><a href="markov-chain-monte-carlo.html#cb1056-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a1, <span class="at">y =</span> a2, <span class="at">fill =</span> d)) <span class="sc">+</span></span>
<span id="cb1056-3"><a href="markov-chain-monte-carlo.html#cb1056-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb1056-4"><a href="markov-chain-monte-carlo.html#cb1056-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> pomological_palette[<span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb1056-5"><a href="markov-chain-monte-carlo.html#cb1056-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1056-6"><a href="markov-chain-monte-carlo.html#cb1056-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1056-7"><a href="markov-chain-monte-carlo.html#cb1056-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1056-8"><a href="markov-chain-monte-carlo.html#cb1056-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-12-1.png" width="408" style="display: block; margin: auto;" /></p>
<p>But we don’t want a density plot. We want contour lines!</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="markov-chain-monte-carlo.html#cb1057-1" aria-hidden="true" tabindex="-1"></a>contour_plot <span class="ot">&lt;-</span> </span>
<span id="cb1057-2"><a href="markov-chain-monte-carlo.html#cb1057-2" aria-hidden="true" tabindex="-1"></a>  contour_plot_dat <span class="sc">%&gt;%</span> </span>
<span id="cb1057-3"><a href="markov-chain-monte-carlo.html#cb1057-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb1057-4"><a href="markov-chain-monte-carlo.html#cb1057-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> a1, <span class="at">y =</span> a2, <span class="at">z =</span> d), </span>
<span id="cb1057-5"><a href="markov-chain-monte-carlo.html#cb1057-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> pomological_palette[<span class="dv">4</span>],</span>
<span id="cb1057-6"><a href="markov-chain-monte-carlo.html#cb1057-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">breaks =</span> <span class="dv">9</span><span class="sc">^</span>(<span class="sc">-</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>))) <span class="sc">+</span></span>
<span id="cb1057-7"><a href="markov-chain-monte-carlo.html#cb1057-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1057-8"><a href="markov-chain-monte-carlo.html#cb1057-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1057-9"><a href="markov-chain-monte-carlo.html#cb1057-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span>
<span id="cb1057-10"><a href="markov-chain-monte-carlo.html#cb1057-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1057-11"><a href="markov-chain-monte-carlo.html#cb1057-11" aria-hidden="true" tabindex="-1"></a>contour_plot</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-13-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Note how we saved that plot as <code>contour_plot</code>, which will serve as the base for the two panels in our Figure 9.3. Next we use the Metropolis algorithm to sample from the posterior defined, above. Henagen’s implementation is wrapped in a custom function he called <code>metropolis()</code>, which is designed to track</p>
<ul>
<li>coordinates of candidate (i.e., proposal) points, and</li>
<li>whether or not the candidate points were accepted.</li>
</ul>
<p>Here we define <code>metropolis()</code> with slight amendments to Henagen’s original.</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="markov-chain-monte-carlo.html#cb1058-1" aria-hidden="true" tabindex="-1"></a>metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb1058-2"><a href="markov-chain-monte-carlo.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">step_size =</span> <span class="fl">0.1</span>,</span>
<span id="cb1058-3"><a href="markov-chain-monte-carlo.html#cb1058-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) {</span>
<span id="cb1058-4"><a href="markov-chain-monte-carlo.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-5"><a href="markov-chain-monte-carlo.html#cb1058-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize vectors where we will keep track of relevant</span></span>
<span id="cb1058-6"><a href="markov-chain-monte-carlo.html#cb1058-6" aria-hidden="true" tabindex="-1"></a>  candidate_x_history <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>, num_proposals)</span>
<span id="cb1058-7"><a href="markov-chain-monte-carlo.html#cb1058-7" aria-hidden="true" tabindex="-1"></a>  candidate_y_history <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>, num_proposals)</span>
<span id="cb1058-8"><a href="markov-chain-monte-carlo.html#cb1058-8" aria-hidden="true" tabindex="-1"></a>  did_move_history    <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, num_proposals)</span>
<span id="cb1058-9"><a href="markov-chain-monte-carlo.html#cb1058-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-10"><a href="markov-chain-monte-carlo.html#cb1058-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare to begin the algorithm...</span></span>
<span id="cb1058-11"><a href="markov-chain-monte-carlo.html#cb1058-11" aria-hidden="true" tabindex="-1"></a>  current_point <span class="ot">&lt;-</span> starting_point</span>
<span id="cb1058-12"><a href="markov-chain-monte-carlo.html#cb1058-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-13"><a href="markov-chain-monte-carlo.html#cb1058-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_proposals) {</span>
<span id="cb1058-14"><a href="markov-chain-monte-carlo.html#cb1058-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-15"><a href="markov-chain-monte-carlo.html#cb1058-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &quot;Proposals are generated by adding random Gaussian noise</span></span>
<span id="cb1058-16"><a href="markov-chain-monte-carlo.html#cb1058-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to each parameter&quot;</span></span>
<span id="cb1058-17"><a href="markov-chain-monte-carlo.html#cb1058-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-18"><a href="markov-chain-monte-carlo.html#cb1058-18" aria-hidden="true" tabindex="-1"></a>    noise <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> step_size)</span>
<span id="cb1058-19"><a href="markov-chain-monte-carlo.html#cb1058-19" aria-hidden="true" tabindex="-1"></a>    candidate_point <span class="ot">&lt;-</span> current_point <span class="sc">+</span> noise</span>
<span id="cb1058-20"><a href="markov-chain-monte-carlo.html#cb1058-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-21"><a href="markov-chain-monte-carlo.html#cb1058-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store coordinates of the proposal point</span></span>
<span id="cb1058-22"><a href="markov-chain-monte-carlo.html#cb1058-22" aria-hidden="true" tabindex="-1"></a>    candidate_x_history[i] <span class="ot">&lt;-</span> candidate_point[<span class="dv">1</span>]</span>
<span id="cb1058-23"><a href="markov-chain-monte-carlo.html#cb1058-23" aria-hidden="true" tabindex="-1"></a>    candidate_y_history[i] <span class="ot">&lt;-</span> candidate_point[<span class="dv">2</span>]</span>
<span id="cb1058-24"><a href="markov-chain-monte-carlo.html#cb1058-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-25"><a href="markov-chain-monte-carlo.html#cb1058-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evaluate the density of our posterior at the proposal point</span></span>
<span id="cb1058-26"><a href="markov-chain-monte-carlo.html#cb1058-26" aria-hidden="true" tabindex="-1"></a>    candidate_prob <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(candidate_point, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span>
<span id="cb1058-27"><a href="markov-chain-monte-carlo.html#cb1058-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-28"><a href="markov-chain-monte-carlo.html#cb1058-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evaluate the density of our posterior at the current point</span></span>
<span id="cb1058-29"><a href="markov-chain-monte-carlo.html#cb1058-29" aria-hidden="true" tabindex="-1"></a>    current_prob <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(current_point, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span>
<span id="cb1058-30"><a href="markov-chain-monte-carlo.html#cb1058-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-31"><a href="markov-chain-monte-carlo.html#cb1058-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decide whether or not we should move to the candidate point</span></span>
<span id="cb1058-32"><a href="markov-chain-monte-carlo.html#cb1058-32" aria-hidden="true" tabindex="-1"></a>    acceptance_ratio <span class="ot">&lt;-</span> candidate_prob <span class="sc">/</span> current_prob</span>
<span id="cb1058-33"><a href="markov-chain-monte-carlo.html#cb1058-33" aria-hidden="true" tabindex="-1"></a>    should_move <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb1058-34"><a href="markov-chain-monte-carlo.html#cb1058-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-35"><a href="markov-chain-monte-carlo.html#cb1058-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep track of the decision</span></span>
<span id="cb1058-36"><a href="markov-chain-monte-carlo.html#cb1058-36" aria-hidden="true" tabindex="-1"></a>    did_move_history[i] <span class="ot">&lt;-</span> should_move</span>
<span id="cb1058-37"><a href="markov-chain-monte-carlo.html#cb1058-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1058-38"><a href="markov-chain-monte-carlo.html#cb1058-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move if necessary</span></span>
<span id="cb1058-39"><a href="markov-chain-monte-carlo.html#cb1058-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(should_move) {</span>
<span id="cb1058-40"><a href="markov-chain-monte-carlo.html#cb1058-40" aria-hidden="true" tabindex="-1"></a>      current_point <span class="ot">&lt;-</span> candidate_point</span>
<span id="cb1058-41"><a href="markov-chain-monte-carlo.html#cb1058-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1058-42"><a href="markov-chain-monte-carlo.html#cb1058-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1058-43"><a href="markov-chain-monte-carlo.html#cb1058-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-44"><a href="markov-chain-monte-carlo.html#cb1058-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># once the loop is complete, store the relevant results in a tibble</span></span>
<span id="cb1058-45"><a href="markov-chain-monte-carlo.html#cb1058-45" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb1058-46"><a href="markov-chain-monte-carlo.html#cb1058-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">candidate_x =</span> candidate_x_history,</span>
<span id="cb1058-47"><a href="markov-chain-monte-carlo.html#cb1058-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">candidate_y =</span> candidate_y_history,</span>
<span id="cb1058-48"><a href="markov-chain-monte-carlo.html#cb1058-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">accept =</span> did_move_history</span>
<span id="cb1058-49"><a href="markov-chain-monte-carlo.html#cb1058-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1058-50"><a href="markov-chain-monte-carlo.html#cb1058-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-51"><a href="markov-chain-monte-carlo.html#cb1058-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the &quot;acceptance rate&quot; by dividing the total number of &quot;moves&quot;</span></span>
<span id="cb1058-52"><a href="markov-chain-monte-carlo.html#cb1058-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># by the total number of proposals</span></span>
<span id="cb1058-53"><a href="markov-chain-monte-carlo.html#cb1058-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-54"><a href="markov-chain-monte-carlo.html#cb1058-54" aria-hidden="true" tabindex="-1"></a>  number_of_moves <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(accept) <span class="sc">%&gt;%</span> <span class="fu">sum</span>(.)</span>
<span id="cb1058-55"><a href="markov-chain-monte-carlo.html#cb1058-55" aria-hidden="true" tabindex="-1"></a>  acceptance_rate <span class="ot">&lt;-</span> number_of_moves<span class="sc">/</span>num_proposals</span>
<span id="cb1058-56"><a href="markov-chain-monte-carlo.html#cb1058-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-57"><a href="markov-chain-monte-carlo.html#cb1058-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">results =</span> results, <span class="at">acceptance_rate =</span> acceptance_rate))</span>
<span id="cb1058-58"><a href="markov-chain-monte-carlo.html#cb1058-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1058-59"><a href="markov-chain-monte-carlo.html#cb1058-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Run the algorithm for the panel on the left, which uses a step size of 0.1.</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="markov-chain-monte-carlo.html#cb1059-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb1059-2"><a href="markov-chain-monte-carlo.html#cb1059-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-3"><a href="markov-chain-monte-carlo.html#cb1059-3" aria-hidden="true" tabindex="-1"></a>round_1 <span class="ot">&lt;-</span> <span class="fu">metropolis</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb1059-4"><a href="markov-chain-monte-carlo.html#cb1059-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">step_size =</span> <span class="fl">0.1</span>,</span>
<span id="cb1059-5"><a href="markov-chain-monte-carlo.html#cb1059-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p>Use <code>round_1</code> to make Figure 9.3a.</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="markov-chain-monte-carlo.html#cb1060-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1060-2"><a href="markov-chain-monte-carlo.html#cb1060-2" aria-hidden="true" tabindex="-1"></a>  contour_plot <span class="sc">+</span> </span>
<span id="cb1060-3"><a href="markov-chain-monte-carlo.html#cb1060-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> round_1<span class="sc">$</span>results,</span>
<span id="cb1060-4"><a href="markov-chain-monte-carlo.html#cb1060-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> candidate_x, <span class="at">y =</span> candidate_y, </span>
<span id="cb1060-5"><a href="markov-chain-monte-carlo.html#cb1060-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> accept, <span class="at">shape =</span> accept)) <span class="sc">+</span></span>
<span id="cb1060-6"><a href="markov-chain-monte-carlo.html#cb1060-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">&quot;step size 0.1,</span><span class="sc">\n</span><span class="st">accept rate &quot;</span>, round_1<span class="sc">$</span>acceptance_rate),</span>
<span id="cb1060-7"><a href="markov-chain-monte-carlo.html#cb1060-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;a1&quot;</span>,</span>
<span id="cb1060-8"><a href="markov-chain-monte-carlo.html#cb1060-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;a2&quot;</span>) <span class="sc">+</span></span>
<span id="cb1060-9"><a href="markov-chain-monte-carlo.html#cb1060-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb1060-10"><a href="markov-chain-monte-carlo.html#cb1060-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pomological_palette[<span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>]) <span class="sc">+</span></span>
<span id="cb1060-11"><a href="markov-chain-monte-carlo.html#cb1060-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span>
<span id="cb1060-12"><a href="markov-chain-monte-carlo.html#cb1060-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-13"><a href="markov-chain-monte-carlo.html#cb1060-13" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-16-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Now run the algorithm with step size set to 0.25. Then make Figure 9.3b, combine the two ggplots, and return the our full version of Figure 9.3.</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="markov-chain-monte-carlo.html#cb1061-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb1061-2"><a href="markov-chain-monte-carlo.html#cb1061-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb1061-3"><a href="markov-chain-monte-carlo.html#cb1061-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-4"><a href="markov-chain-monte-carlo.html#cb1061-4" aria-hidden="true" tabindex="-1"></a>round_2 <span class="ot">&lt;-</span> <span class="fu">metropolis</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb1061-5"><a href="markov-chain-monte-carlo.html#cb1061-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">step_size =</span> <span class="fl">0.25</span>,</span>
<span id="cb1061-6"><a href="markov-chain-monte-carlo.html#cb1061-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1061-7"><a href="markov-chain-monte-carlo.html#cb1061-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-8"><a href="markov-chain-monte-carlo.html#cb1061-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb1061-9"><a href="markov-chain-monte-carlo.html#cb1061-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1061-10"><a href="markov-chain-monte-carlo.html#cb1061-10" aria-hidden="true" tabindex="-1"></a>  contour_plot <span class="sc">+</span> </span>
<span id="cb1061-11"><a href="markov-chain-monte-carlo.html#cb1061-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> round_2<span class="sc">$</span>results,</span>
<span id="cb1061-12"><a href="markov-chain-monte-carlo.html#cb1061-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> candidate_x, <span class="at">y =</span> candidate_y, </span>
<span id="cb1061-13"><a href="markov-chain-monte-carlo.html#cb1061-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> accept, <span class="at">shape =</span> accept)) <span class="sc">+</span></span>
<span id="cb1061-14"><a href="markov-chain-monte-carlo.html#cb1061-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb1061-15"><a href="markov-chain-monte-carlo.html#cb1061-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pomological_palette[<span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>]) <span class="sc">+</span></span>
<span id="cb1061-16"><a href="markov-chain-monte-carlo.html#cb1061-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1061-17"><a href="markov-chain-monte-carlo.html#cb1061-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">&quot;step size 0.25,</span><span class="sc">\n</span><span class="st">accept rate &quot;</span>, round_2<span class="sc">$</span>acceptance_rate),</span>
<span id="cb1061-18"><a href="markov-chain-monte-carlo.html#cb1061-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;a1&quot;</span>) <span class="sc">+</span></span>
<span id="cb1061-19"><a href="markov-chain-monte-carlo.html#cb1061-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span>
<span id="cb1061-20"><a href="markov-chain-monte-carlo.html#cb1061-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-21"><a href="markov-chain-monte-carlo.html#cb1061-21" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb1061-22"><a href="markov-chain-monte-carlo.html#cb1061-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1061-23"><a href="markov-chain-monte-carlo.html#cb1061-23" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">+</span> </span>
<span id="cb1061-24"><a href="markov-chain-monte-carlo.html#cb1061-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">theme =</span> <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>),</span>
<span id="cb1061-25"><a href="markov-chain-monte-carlo.html#cb1061-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="st">&quot;Metropolis chains under high correlation&quot;</span>) <span class="sc">+</span></span>
<span id="cb1061-26"><a href="markov-chain-monte-carlo.html#cb1061-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-17-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Our acceptance rates differ from McElreath’s due to simulation variance. If you want to get a sense of stability in the acceptance rates, just simulate some more. For example, we might wrap <code>metropolis()</code> inside another function that takes a simulation seed value.</p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="markov-chain-monte-carlo.html#cb1062-1" aria-hidden="true" tabindex="-1"></a>metropolis_with_seed <span class="ot">&lt;-</span> <span class="cf">function</span>(seed, <span class="at">step_size =</span> <span class="fl">0.1</span>) {</span>
<span id="cb1062-2"><a href="markov-chain-monte-carlo.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1062-3"><a href="markov-chain-monte-carlo.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb1062-4"><a href="markov-chain-monte-carlo.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1062-5"><a href="markov-chain-monte-carlo.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>  met <span class="ot">&lt;-</span></span>
<span id="cb1062-6"><a href="markov-chain-monte-carlo.html#cb1062-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">metropolis</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb1062-7"><a href="markov-chain-monte-carlo.html#cb1062-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">step_size =</span> step_size,</span>
<span id="cb1062-8"><a href="markov-chain-monte-carlo.html#cb1062-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1062-9"><a href="markov-chain-monte-carlo.html#cb1062-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1062-10"><a href="markov-chain-monte-carlo.html#cb1062-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(met<span class="sc">$</span>acceptance_rate)</span>
<span id="cb1062-11"><a href="markov-chain-monte-carlo.html#cb1062-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1062-12"><a href="markov-chain-monte-carlo.html#cb1062-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Kick the tires and iterate 500 times.</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="markov-chain-monte-carlo.html#cb1063-1" aria-hidden="true" tabindex="-1"></a>ars <span class="ot">&lt;-</span></span>
<span id="cb1063-2"><a href="markov-chain-monte-carlo.html#cb1063-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">seed =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1063-3"><a href="markov-chain-monte-carlo.html#cb1063-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">acceptance_rate =</span> <span class="fu">map_dbl</span>(seed, metropolis_with_seed)) </span></code></pre></div>
<p>Now summarize the results in a histogram.</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="markov-chain-monte-carlo.html#cb1064-1" aria-hidden="true" tabindex="-1"></a>ars <span class="sc">%&gt;%</span> </span>
<span id="cb1064-2"><a href="markov-chain-monte-carlo.html#cb1064-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> acceptance_rate)) <span class="sc">+</span></span>
<span id="cb1064-3"><a href="markov-chain-monte-carlo.html#cb1064-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">025</span>, <span class="at">fill =</span> pomological_palette[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb1064-4"><a href="markov-chain-monte-carlo.html#cb1064-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-20-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>If you iterate with <code>step_size = 0.25</code>, instead, the resulting histogram will look very different.</p>
<p>Now we turn our focus to Figure 9.4. McElreath threw us a bone and gave us the code in his <strong>R</strong> code 9.4. Here we’ll warp his code into a function called <code>concentration_sim()</code> which adds a <code>seed</code> argument for reproducibility.</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="markov-chain-monte-carlo.html#cb1065-1" aria-hidden="true" tabindex="-1"></a>concentration_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> <span class="dv">1</span>, <span class="at">t =</span> <span class="fl">1e3</span>, <span class="at">seed =</span> <span class="dv">9</span>) {</span>
<span id="cb1065-2"><a href="markov-chain-monte-carlo.html#cb1065-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1065-3"><a href="markov-chain-monte-carlo.html#cb1065-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb1065-4"><a href="markov-chain-monte-carlo.html#cb1065-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1065-5"><a href="markov-chain-monte-carlo.html#cb1065-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> rethinking<span class="sc">::</span><span class="fu">rmvnorm</span>(t, <span class="fu">rep</span>(<span class="dv">0</span>, d), <span class="fu">diag</span>(d))</span>
<span id="cb1065-6"><a href="markov-chain-monte-carlo.html#cb1065-6" aria-hidden="true" tabindex="-1"></a>  rad_dist <span class="ot">&lt;-</span> <span class="cf">function</span>(y) <span class="fu">sqrt</span>(<span class="fu">sum</span>(y<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb1065-7"><a href="markov-chain-monte-carlo.html#cb1065-7" aria-hidden="true" tabindex="-1"></a>  rd <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>t, <span class="cf">function</span>(i) <span class="fu">rad_dist</span>( y[i, ])) </span>
<span id="cb1065-8"><a href="markov-chain-monte-carlo.html#cb1065-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1065-9"><a href="markov-chain-monte-carlo.html#cb1065-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now run the simulation four times and plot.</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="markov-chain-monte-carlo.html#cb1066-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1066-2"><a href="markov-chain-monte-carlo.html#cb1066-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">d =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-3"><a href="markov-chain-monte-carlo.html#cb1066-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">con =</span> <span class="fu">map</span>(d, concentration_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-4"><a href="markov-chain-monte-carlo.html#cb1066-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(con) <span class="sc">%&gt;%</span> </span>
<span id="cb1066-5"><a href="markov-chain-monte-carlo.html#cb1066-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"># dimensions</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>(d)) </span>
<span id="cb1066-6"><a href="markov-chain-monte-carlo.html#cb1066-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1066-7"><a href="markov-chain-monte-carlo.html#cb1066-7" aria-hidden="true" tabindex="-1"></a>d  <span class="sc">%&gt;%</span> </span>
<span id="cb1066-8"><a href="markov-chain-monte-carlo.html#cb1066-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> con, <span class="at">fill =</span> <span class="st">`</span><span class="at"># dimensions</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1066-9"><a href="markov-chain-monte-carlo.html#cb1066-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1066-10"><a href="markov-chain-monte-carlo.html#cb1066-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_pomological</span>() <span class="sc">+</span></span>
<span id="cb1066-11"><a href="markov-chain-monte-carlo.html#cb1066-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Radial distance from mode&quot;</span>) <span class="sc">+</span></span>
<span id="cb1066-12"><a href="markov-chain-monte-carlo.html#cb1066-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">+</span></span>
<span id="cb1066-13"><a href="markov-chain-monte-carlo.html#cb1066-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">625</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-22-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>With high-dimensional posteriors,</p>
<blockquote>
<p>sampled points are in a thin, high-dimensional shell very far from the mode. This shell can create very hard paths for a sampler to follow.</p>
<p>This is why we need MCMC algorithms that focus on the entire posterior at once, instead of one or a few dimensions at a time like Metropolis and Gibbs. Otherwise we get stuck in a narrow, highly curving region of parameter space. (p. 270)</p>
</blockquote>
</div>
</div>
<div id="hamiltonian-monte-carlo" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Hamiltonian Monte Carlo<a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Hamiltonian Monte Carlo (HMC) is more computationally costly and more efficient than Gibbs at sampling from the posterior. It needs fewer samples, especially when fitting models with many parameters. To learn more about how HMC works, check out McElreath’s <a href="https://youtu.be/v-j0UmWf3Us">lecture on the topic from January 2019</a>; his blog post, <a href="https://elevanth.org/blog/2017/11/28/build-a-better-markov-chain/"><em>Markov chains: Why walk when you can flow?</em></a>; or one of these lectures (<a href="https://youtu.be/jUSZboSq1zg">here</a>, <a href="https://youtu.be/_fnDz2Bz3h8">here</a>, or <a href="https://youtu.be/pHsuIaPbNbY">here</a>) by Michael Betancourt.</p>
<div id="another-parable." class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Another parable.<a href="markov-chain-monte-carlo.html#another-parable." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section is beyond the scope of this project.</p>
</div>
<div id="particles-in-space." class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Particles in space.<a href="markov-chain-monte-carlo.html#particles-in-space." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section is beyond the scope of this project.</p>
</div>
<div id="limitations." class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Limitations.<a href="markov-chain-monte-carlo.html#limitations." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>As always, there are some limitations. HMC requires continuous parameters. It can’t glide through a discrete parameter. In practice, this means that certain techniques, like the imputation of discrete missing data, have to be done differently with HMC. HMC can certainly sample from such models, often much more efficiently than a Gibbs sampler could. But you have to change how you code them. (p. 278)</p>
</blockquote>
</div>
</div>
<div id="easy-hmc-ulam-brm" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Easy HMC: <del>ulam</del> <code>brm()</code><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Much like McElreath’s <strong>rethinking</strong> package, <strong>brms</strong> provides a convenient interface to HMC via Stan. Other packages providing Stan interfaces include <a href="https://mc-stan.org/rstanarm/"><strong>rstanarm</strong></a> <span class="citation">(<a href="#ref-rstanarm2018" role="doc-biblioref">Brilleman et al., 2018</a>; <a href="#ref-R-rstanarm" role="doc-biblioref">Gabry &amp; Goodrich, 2022</a>)</span> and <a href="https://ecmerkle.github.io/blavaan/"><strong>blavaan</strong></a> <span class="citation">(<a href="#ref-blavaan2021" role="doc-biblioref">Merkle et al., 2021</a>, <a href="#ref-R-blavaan" role="doc-biblioref">2022</a>; <a href="#ref-Merkle2018blavaan" role="doc-biblioref">Merkle &amp; Rosseel, 2018</a>)</span>. I’m not aware of any up-to-date comparisons across the packages. If you’re ever inclined to make one, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">let the rest of us know</a>!</p>
<p>Here we load the <code>rugged</code> data and <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="markov-chain-monte-carlo.html#cb1067-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1067-2"><a href="markov-chain-monte-carlo.html#cb1067-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb1067-3"><a href="markov-chain-monte-carlo.html#cb1067-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> rugged</span>
<span id="cb1067-4"><a href="markov-chain-monte-carlo.html#cb1067-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(rugged)</span></code></pre></div>
<p>It takes just a sec to do a little data manipulation.</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="markov-chain-monte-carlo.html#cb1068-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1068-2"><a href="markov-chain-monte-carlo.html#cb1068-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb1068-3"><a href="markov-chain-monte-carlo.html#cb1068-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp =</span> <span class="fu">log</span>(rgdppc_2000))</span>
<span id="cb1068-4"><a href="markov-chain-monte-carlo.html#cb1068-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1068-5"><a href="markov-chain-monte-carlo.html#cb1068-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span></span>
<span id="cb1068-6"><a href="markov-chain-monte-carlo.html#cb1068-6" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb1068-7"><a href="markov-chain-monte-carlo.html#cb1068-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(rgdppc_2000) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-8"><a href="markov-chain-monte-carlo.html#cb1068-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp_std =</span> log_gdp <span class="sc">/</span> <span class="fu">mean</span>(log_gdp),</span>
<span id="cb1068-9"><a href="markov-chain-monte-carlo.html#cb1068-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std  =</span> rugged <span class="sc">/</span> <span class="fu">max</span>(rugged),</span>
<span id="cb1068-10"><a href="markov-chain-monte-carlo.html#cb1068-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid         =</span> <span class="fu">ifelse</span>(cont_africa <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-11"><a href="markov-chain-monte-carlo.html#cb1068-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rugged_std_c =</span> rugged_std <span class="sc">-</span> <span class="fu">mean</span>(rugged_std))</span></code></pre></div>
<p>In the context of this chapter, it doesn’t make sense to translate McElreath’s <code>m8.3</code> <code>quap()</code> code to <code>brm()</code> code. Below, we’ll just go directly to the <code>brm()</code> variant of his <code>m9.1</code>.</p>
<div id="preparation." class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Preparation.<a href="markov-chain-monte-carlo.html#preparation." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When working with <strong>brms</strong>, you don’t need to do the data processing McElreath did on page 280. If you wanted to, however, here’s how you might do it within the <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="markov-chain-monte-carlo.html#cb1069-1" aria-hidden="true" tabindex="-1"></a>dat_slim <span class="ot">&lt;-</span></span>
<span id="cb1069-2"><a href="markov-chain-monte-carlo.html#cb1069-2" aria-hidden="true" tabindex="-1"></a>  dd <span class="sc">%&gt;%</span></span>
<span id="cb1069-3"><a href="markov-chain-monte-carlo.html#cb1069-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cid =</span> <span class="fu">as.integer</span>(cid)) <span class="sc">%&gt;%</span> </span>
<span id="cb1069-4"><a href="markov-chain-monte-carlo.html#cb1069-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_gdp_std, rugged_std, cid, rugged_std_c) <span class="sc">%&gt;%</span> </span>
<span id="cb1069-5"><a href="markov-chain-monte-carlo.html#cb1069-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>()</span>
<span id="cb1069-6"><a href="markov-chain-monte-carlo.html#cb1069-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1069-7"><a href="markov-chain-monte-carlo.html#cb1069-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_slim)</span></code></pre></div>
</div>
<div id="sampling-from-the-posterior.-1" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Sampling from the posterior.<a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, we get to work that sweet HMC via <code>brms::brm()</code>.</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="markov-chain-monte-carlo.html#cb1070-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb1070-2"><a href="markov-chain-monte-carlo.html#cb1070-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dd, </span>
<span id="cb1070-3"><a href="markov-chain-monte-carlo.html#cb1070-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1070-4"><a href="markov-chain-monte-carlo.html#cb1070-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(log_gdp_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> (rugged_std <span class="sc">-</span> <span class="fl">0.215</span>), </span>
<span id="cb1070-5"><a href="markov-chain-monte-carlo.html#cb1070-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid, </span>
<span id="cb1070-6"><a href="markov-chain-monte-carlo.html#cb1070-6" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cid,</span>
<span id="cb1070-7"><a href="markov-chain-monte-carlo.html#cb1070-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1070-8"><a href="markov-chain-monte-carlo.html#cb1070-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cid1, <span class="at">nlpar =</span> a),</span>
<span id="cb1070-9"><a href="markov-chain-monte-carlo.html#cb1070-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cid2, <span class="at">nlpar =</span> a),</span>
<span id="cb1070-10"><a href="markov-chain-monte-carlo.html#cb1070-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cid1, <span class="at">nlpar =</span> b),</span>
<span id="cb1070-11"><a href="markov-chain-monte-carlo.html#cb1070-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cid2, <span class="at">nlpar =</span> b),</span>
<span id="cb1070-12"><a href="markov-chain-monte-carlo.html#cb1070-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1070-13"><a href="markov-chain-monte-carlo.html#cb1070-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">1</span>, <span class="at">cores =</span> <span class="dv">1</span>,</span>
<span id="cb1070-14"><a href="markov-chain-monte-carlo.html#cb1070-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1070-15"><a href="markov-chain-monte-carlo.html#cb1070-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b09.01&quot;</span>)</span></code></pre></div>
<p>This was another instance of the <strong>brms</strong> non-linear syntax, We’ve already introduced this in <a href="geocentric-models.html#overthinking-logs-and-exps-oh-my.">Section 4.4.2.1</a>, <a href="the-many-variables-the-spurious-waffles.html#many-categories.">Section 5.3.2</a>, and <a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born.">Section 6.2.1</a>. For even more details, you can always peruse Bürkner’s <span class="citation">(<a href="#ref-Bürkner2022Non_linear" role="doc-biblioref">2022e</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html"><em>Estimating non-linear models with brms</em></a>.</p>
<p>Here is a summary of the posterior.</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="markov-chain-monte-carlo.html#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 0 + a + b * (rugged_std - 0.215) 
##          a ~ 0 + cid
##          b ~ 0 + cid
##    Data: dd (Number of observations: 170) 
##   Draws: 1 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 1000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_cid1     0.89      0.02     0.86     0.92 1.00      947      560
## a_cid2     1.05      0.01     1.03     1.07 1.01     1263      657
## b_cid1     0.14      0.07    -0.01     0.28 1.00     1014      767
## b_cid2    -0.14      0.06    -0.26    -0.04 1.00     1134      684
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.11      0.01     0.10     0.12 1.00     1152      787
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Unlike McElreath’s <code>precis()</code> output, our output has an <code>Rhat</code> instead of <code>Rhat4</code>. McElreath’s documentation indicated his <code>Rhat4</code> values are based on the <span class="math inline">\(\widehat R\)</span> from <span class="citation">Gelman et al. (<a href="#ref-gelman2013bayesian" role="doc-biblioref">2013</a>)</span>. To my knowledge, <strong>brms</strong> uses the same formula. McElreath also remarked he expected to update to an <code>Rhat5</code> in the near future. I believe he was referencing <span class="citation">Vehtari et al. (<a href="#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">2019</a>)</span>. I am under the impression this will be implemented at the level of the underlying Stan code, which means <strong>brms</strong> will get the update, too. To learn more, check out the <a href="https://discourse.mc-stan.org/t/new-r-hat-and-ess/8165">New R-hat and ESS</a> thread on the Stan Forums.</p>
<p>Also of note, McElreath’s <code>rethinking::precis()</code> returns highest posterior density intervals (HPDIs) when summarizing <code>ulam()</code> models. Not so with <strong>brms</strong>. If you want HPDIs, you might use the convenience functions from the <strong>tidybayes</strong> package. Here’s an example.</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="markov-chain-monte-carlo.html#cb1073-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1073-2"><a href="markov-chain-monte-carlo.html#cb1073-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1073-3"><a href="markov-chain-monte-carlo.html#cb1073-3" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b9<span class="fl">.1</span>)</span>
<span id="cb1073-4"><a href="markov-chain-monte-carlo.html#cb1073-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1073-5"><a href="markov-chain-monte-carlo.html#cb1073-5" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1073-6"><a href="markov-chain-monte-carlo.html#cb1073-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_a_cid1<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb1073-7"><a href="markov-chain-monte-carlo.html#cb1073-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb1073-8"><a href="markov-chain-monte-carlo.html#cb1073-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>)  <span class="co"># note our rare use of 89% intervals</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   name      value  .lower  .upper .width .point .interval
##   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_a_cid1  0.887  0.860   0.912    0.89 mean   hdi      
## 2 b_a_cid2  1.05   1.03    1.07     0.89 mean   hdi      
## 3 b_b_cid1  0.136  0.0148  0.250    0.89 mean   hdi      
## 4 b_b_cid2 -0.144 -0.230  -0.0527   0.89 mean   hdi      
## 5 sigma     0.112  0.101   0.120    0.89 mean   hdi</code></pre>
<p>There’s one more important difference in our <strong>brms</strong> summary output compared to McElreath’s <code>rethinking::precis()</code> output. In the text we learn <code>precis()</code> returns <code>n_eff</code> values for each parameter. Earlier versions of <strong>brms</strong> used to have a direct analogue named <code>Eff.Sample</code>. Both were estimates of the effective number of samples (a.k.a. the effective sample size) for each parameter. As with typical sample size, the more the merrier. Starting with version 2.10.0, <strong>brms</strong> now returns two columns: <code>Bulk_ESS</code> and <code>Tail_ESS</code>. These originate from the same <span class="citation">Vehtari et al. (<a href="#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">2019</a>)</span> paper that introduced the upcoming change to the <span class="math inline">\(\widehat R\)</span>. From the paper, we read:</p>
<blockquote>
<p>If you plan to report quantile estimates or posterior intervals, we strongly suggest assessing the convergence of the chains for these quantiles. In Section 4.3 we show that convergence of Markov chains is not uniform across the parameter space and propose diagnostics and effective sample sizes specifically for extreme quantiles. This is <em>different</em> from the standard ESS estimate (which we refer to as the “bulk-ESS”), which mainly assesses how well the centre of the distribution is resolved. Instead, these “tail-ESS” measures allow the user to estimate the MCSE for interval estimates. (p. 5, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For more technical details, see the paper. In short, <code>Bulk_ESS</code> in the output from <strong>brms</strong> 2.10.0+ is what was previously referred to as <code>Eff.Sample</code> in earlier versions. It’s also what corresponds to what McElreath calls <code>n_eff</code>. This indexed the number of effective samples in ‘the center of the’ posterior distribution (i.e., the posterior mean or median). But since we also care about uncertainty in our parameters, we care about stability in the 95% intervals and such. The new <code>Tail_ESS</code> in <strong>brms</strong> output allows us to gauge the effective sample size for those intervals.</p>
</div>
<div id="sampling-again-in-parallel." class="section level3 hasAnchor" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Sampling again, in parallel.<a href="markov-chain-monte-carlo.html#sampling-again-in-parallel." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>You can easily parallelize those chains… They can all run at the same time, instead of in sequence. So as long as your computer has four cores (it probably does), it won’t take longer to run four chains than one chain. To run four independent Markov chains for the model above, and to distribute them across separate cores in your computer, just increase the number of chains and add a cores argument. (p. 281)</p>
</blockquote>
<p>If you don’t know how many cores you have on your computer, you can always check with the <code>parallel::detectCores()</code> function. My current laptop has 16.</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="markov-chain-monte-carlo.html#cb1075-1" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<p>Here we sample from four HMC chains in parallel by adding <code>cores = 4</code>.</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="markov-chain-monte-carlo.html#cb1077-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.1</span>b <span class="ot">&lt;-</span> </span>
<span id="cb1077-2"><a href="markov-chain-monte-carlo.html#cb1077-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b9<span class="fl">.1</span>, </span>
<span id="cb1077-3"><a href="markov-chain-monte-carlo.html#cb1077-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1077-4"><a href="markov-chain-monte-carlo.html#cb1077-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1077-5"><a href="markov-chain-monte-carlo.html#cb1077-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b09.01b&quot;</span>)</span></code></pre></div>
<p>This model sampled so fast that it really didn’t matter if we sampled in parallel or not. It will for others.</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="markov-chain-monte-carlo.html#cb1078-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 0 + a + b * (rugged_std - 0.215) 
##          a ~ 0 + cid
##          b ~ 0 + cid
##    Data: dd (Number of observations: 170) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_cid1     0.89      0.02     0.86     0.92 1.00     3992     2681
## a_cid2     1.05      0.01     1.03     1.07 1.00     4799     2829
## b_cid1     0.13      0.07    -0.02     0.28 1.00     4029     2959
## b_cid2    -0.14      0.06    -0.26    -0.03 1.00     4539     3023
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.11      0.01     0.10     0.12 1.00     4300     3053
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <code>show()</code> function does not work for <strong>brms</strong> models the same way it does with those from <strong>rethinking</strong>. Rather, <code>show()</code> returns the same information we’d get from <code>print()</code> or <code>summary()</code>.</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="markov-chain-monte-carlo.html#cb1080-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(b9<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp_std ~ 0 + a + b * (rugged_std - 0.215) 
##          a ~ 0 + cid
##          b ~ 0 + cid
##    Data: dd (Number of observations: 170) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_cid1     0.89      0.02     0.86     0.92 1.00     3992     2681
## a_cid2     1.05      0.01     1.03     1.07 1.00     4799     2829
## b_cid1     0.13      0.07    -0.02     0.28 1.00     4029     2959
## b_cid2    -0.14      0.06    -0.26    -0.03 1.00     4539     3023
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.11      0.01     0.10     0.12 1.00     4300     3053
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>You can get a focused look at the <code>formula</code> and prior information from a <strong>brms</strong> fit object by subsetting them directly.</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="markov-chain-monte-carlo.html#cb1082-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.1</span>b<span class="sc">$</span>formula</span></code></pre></div>
<pre><code>## log_gdp_std ~ 0 + a + b * (rugged_std - 0.215) 
## a ~ 0 + cid
## b ~ 0 + cid</code></pre>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="markov-chain-monte-carlo.html#cb1084-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.1</span>b<span class="sc">$</span>prior</span></code></pre></div>
<pre><code>##           prior class coef group resp dpar nlpar lb ub  source
##          (flat)     b                          a       default
##  normal(1, 0.1)     b cid1                     a          user
##  normal(1, 0.1)     b cid2                     a          user
##          (flat)     b                          b       default
##  normal(0, 0.3)     b cid1                     b          user
##  normal(0, 0.3)     b cid2                     b          user
##  exponential(1) sigma                             0       user</code></pre>
<p>You can get that information on the model priors with the <code>prior_summary()</code> function.</p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="markov-chain-monte-carlo.html#cb1086-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(b9<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>##           prior class coef group resp dpar nlpar lb ub  source
##          (flat)     b                          a       default
##  normal(1, 0.1)     b cid1                     a          user
##  normal(1, 0.1)     b cid2                     a          user
##          (flat)     b                          b       default
##  normal(0, 0.3)     b cid1                     b          user
##  normal(0, 0.3)     b cid2                     b          user
##  exponential(1) sigma                             0       user</code></pre>
<p>I am not aware of a convenient way to pull the information on how long each chain ran for. As to the sample size, our output is a little different than McElreath’s. The <strong>brms</strong> default is to run 4 chains, each containing 2,000 total samples, the first 1,000 of which are warmups. Since we used those defaults, we ended up with <span class="math inline">\((2{,}000 - 1{,}000) \times 4 = 4{,}000\)</span> post-warmup HMC samples. But anyways, just like all of McElreath’s <code>n_eff</code> values were above 2,000, most of our <code>Bulk_ESS</code> values were above 4,000, which is</p>
<blockquote>
<p>no mistake. The adaptive sampler that Stan uses is so good, it can actually produce sequential samples that are better than uncorrelated. They are anti-correlated. This means it can explore the posterior distribution so efficiently that it can beat random. (p. 282)</p>
</blockquote>
<p>In addition to sampling HMC chains in parallel, the Stan team have been working on within-chain parallelization, too. This is a new development and was just made available to <strong>brms</strong> users with the release of <strong>brms</strong> version 2.14.0. I don’t plan on covering within-chain parallelization in this ebook, but you can learn more in Weber and Bürkner’s <span class="citation">(<a href="#ref-Weber2022WithinChainParallelization" role="doc-biblioref">2022</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_threading.html"><em>Running brms models with within-chain parallelization</em></a>, or Weber’s guest post on Gelman’s blog, <a href="https://statmodeling.stat.columbia.edu/2020/10/14/stans-within-chain-parallelization-in-brms/"><em>Stan’s within-chain parallelization now available with brms</em></a>. If you have some large rough model that’s taking hours upon hours to fit, it might be worth your while.</p>
</div>
<div id="visualization." class="section level3 hasAnchor" number="9.4.4">
<h3><span class="header-section-number">9.4.4</span> Visualization.<a href="markov-chain-monte-carlo.html#visualization." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with McElreath’s <strong>rethinking</strong>, <strong>brms</strong> allows users to put the fit object directly into the <code>pairs()</code> function.</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="markov-chain-monte-carlo.html#cb1088-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b9<span class="fl">.1</span>b,</span>
<span id="cb1088-2"><a href="markov-chain-monte-carlo.html#cb1088-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">off_diag_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-41-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>Our output is a little different in that we don’t get a lower-triangle of Pearson’s correlation coefficients. If you’d like those values, use <code>vcov()</code>.</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="markov-chain-monte-carlo.html#cb1089-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(b9<span class="fl">.1</span>b, <span class="at">correlation =</span> T) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##        a_cid1 a_cid2 b_cid1 b_cid2
## a_cid1   1.00   0.02   0.16  -0.01
## a_cid2   0.02   1.00   0.03  -0.05
## b_cid1   0.16   0.03   1.00  -0.01
## b_cid2  -0.01  -0.05  -0.01   1.00</code></pre>
<p>Note, however, that this will only return the correlations among the ‘Population-Level Effects’. Within <strong>brms</strong>, <span class="math inline">\(\sigma\)</span> is classified among the ‘Family Specific Parameters’. We have more options still. As a first step, use the <code>brms::as_draws_df()</code> function to extract the posterior samples within a data frame.</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="markov-chain-monte-carlo.html#cb1091-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b9<span class="fl">.1</span>b)</span>
<span id="cb1091-2"><a href="markov-chain-monte-carlo.html#cb1091-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-3"><a href="markov-chain-monte-carlo.html#cb1091-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(post)</span></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 10
## $ b_a_cid1   &lt;dbl&gt; 0.8879082, 0.8607972, 0.8730508, 0.8658432, 0.8989978, 0.8989978, 0.8791088, 0.…
## $ b_a_cid2   &lt;dbl&gt; 1.038859, 1.070321, 1.069742, 1.064520, 1.050665, 1.050665, 1.049660, 1.054626,…
## $ b_b_cid1   &lt;dbl&gt; 0.09994092, 0.06458252, 0.11929941, 0.12736742, 0.10521894, 0.10521894, 0.16994…
## $ b_b_cid2   &lt;dbl&gt; -0.12240308, -0.17949738, -0.18939252, -0.10448007, -0.18944079, -0.18944079, -…
## $ sigma      &lt;dbl&gt; 0.11593941, 0.10376615, 0.10390292, 0.10966227, 0.11285064, 0.11285064, 0.10532…
## $ lprior     &lt;dbl&gt; 2.378967, 1.815306, 1.906112, 1.968887, 2.325209, 2.325209, 2.193965, 2.231290,…
## $ lp__       &lt;dbl&gt; 133.5754, 130.1896, 131.5381, 132.5992, 133.9098, 133.9098, 133.1021, 134.1696,…
## $ .chain     &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ .iteration &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, …
## $ .draw      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, …</code></pre>
<p>Another nice way to customize your pairs plot is with the <a href="https://cran.r-project.org/package=GGally"><strong>GGally</strong> package</a>. For this approach, you feed the <code>post</code> data into the <code>ggpairs()</code> function.</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="markov-chain-monte-carlo.html#cb1093-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1093-2"><a href="markov-chain-monte-carlo.html#cb1093-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1093-3"><a href="markov-chain-monte-carlo.html#cb1093-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb1093-4"><a href="markov-chain-monte-carlo.html#cb1093-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_a_cid1<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb1093-5"><a href="markov-chain-monte-carlo.html#cb1093-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-44-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Now we get the pairs plot on the lower triangle and the Pearson’s correlation coefficients in the upper. Since <code>GGally::ggpairs()</code> returns a <strong>ggplot2</strong> object, you can customize it as you please.</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="markov-chain-monte-carlo.html#cb1094-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make the custom functions</span></span>
<span id="cb1094-2"><a href="markov-chain-monte-carlo.html#cb1094-2" aria-hidden="true" tabindex="-1"></a>my_diag <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb1094-3"><a href="markov-chain-monte-carlo.html#cb1094-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb1094-4"><a href="markov-chain-monte-carlo.html#cb1094-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> pomological_palette[<span class="dv">7</span>],</span>
<span id="cb1094-5"><a href="markov-chain-monte-carlo.html#cb1094-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> pomological_palette[<span class="dv">6</span>])</span>
<span id="cb1094-6"><a href="markov-chain-monte-carlo.html#cb1094-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1094-7"><a href="markov-chain-monte-carlo.html#cb1094-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-8"><a href="markov-chain-monte-carlo.html#cb1094-8" aria-hidden="true" tabindex="-1"></a>my_upper <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb1094-9"><a href="markov-chain-monte-carlo.html#cb1094-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb1094-10"><a href="markov-chain-monte-carlo.html#cb1094-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bin2d</span>() <span class="sc">+</span></span>
<span id="cb1094-11"><a href="markov-chain-monte-carlo.html#cb1094-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> pomological_palette[<span class="dv">4</span>], </span>
<span id="cb1094-12"><a href="markov-chain-monte-carlo.html#cb1094-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">high =</span> pomological_palette[<span class="dv">1</span>])</span>
<span id="cb1094-13"><a href="markov-chain-monte-carlo.html#cb1094-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1094-14"><a href="markov-chain-monte-carlo.html#cb1094-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-15"><a href="markov-chain-monte-carlo.html#cb1094-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot!</span></span>
<span id="cb1094-16"><a href="markov-chain-monte-carlo.html#cb1094-16" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb1094-17"><a href="markov-chain-monte-carlo.html#cb1094-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_a_cid1<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb1094-18"><a href="markov-chain-monte-carlo.html#cb1094-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;cor&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Marck Script&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)),</span>
<span id="cb1094-19"><a href="markov-chain-monte-carlo.html#cb1094-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb1094-20"><a href="markov-chain-monte-carlo.html#cb1094-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper)) <span class="sc">+</span></span>
<span id="cb1094-21"><a href="markov-chain-monte-carlo.html#cb1094-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;My custom pairs plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb1094-22"><a href="markov-chain-monte-carlo.html#cb1094-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-45-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For more ideas on customizing a <code>ggpairs()</code> plot, go <a href="https://ggobi.github.io/ggally/articles/ggpairs.html">here</a>.</p>
</div>
<div id="checking-the-chain." class="section level3 hasAnchor" number="9.4.5">
<h3><span class="header-section-number">9.4.5</span> Checking the chain.<a href="markov-chain-monte-carlo.html#checking-the-chain." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using <code>plot()</code> for a <code>brm()</code> fit returns both density and trace lots for the parameters.</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="markov-chain-monte-carlo.html#cb1095-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b9<span class="fl">.1</span>b, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <a href="https://cran.r-project.org/package=bayesplot"><strong>bayesplot</strong></a> package allows a little more control. Here, we use the <code>bayesplot::mcmc_trace()</code> function to show only trace plots with our custom theme. Note that <code>mcmc_trace()</code> does not work with brmfit objects, but it will accept input from <code>as_draws_df()</code>.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="markov-chain-monte-carlo.html#cb1096-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1096-2"><a href="markov-chain-monte-carlo.html#cb1096-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1096-3"><a href="markov-chain-monte-carlo.html#cb1096-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span> </span>
<span id="cb1096-4"><a href="markov-chain-monte-carlo.html#cb1096-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a_cid1<span class="sc">:</span>sigma),</span>
<span id="cb1096-5"><a href="markov-chain-monte-carlo.html#cb1096-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">ncol =</span> <span class="dv">3</span>), </span>
<span id="cb1096-6"><a href="markov-chain-monte-carlo.html#cb1096-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1096-7"><a href="markov-chain-monte-carlo.html#cb1096-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_pomological</span>() <span class="sc">+</span></span>
<span id="cb1096-8"><a href="markov-chain-monte-carlo.html#cb1096-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots&quot;</span>) <span class="sc">+</span></span>
<span id="cb1096-9"><a href="markov-chain-monte-carlo.html#cb1096-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">+</span></span>
<span id="cb1096-10"><a href="markov-chain-monte-carlo.html#cb1096-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">2</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-47-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The <strong>bayesplot</strong> package offers a variety of diagnostic plots. Here we make autocorrelation plots for all model parameters, one for each HMC chain.</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="markov-chain-monte-carlo.html#cb1097-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span> </span>
<span id="cb1097-2"><a href="markov-chain-monte-carlo.html#cb1097-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_acf</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a_cid1<span class="sc">:</span>sigma), <span class="at">lags =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1097-3"><a href="markov-chain-monte-carlo.html#cb1097-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) </span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-48-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>That’s just what we like to see–nice L-shaped autocorrelation plots. Those are the kinds of shapes you’d expect when you have reasonably large effective samples.</p>
<p>Before we move on, there’s an important difference between the trace plots McElreath showed in the text and the ones we just made. McElreath’s trace plots include the warmup iterations. Ours did not. To my knowledge, neither the <code>brms::plot()</code> nor the <code>bayesplot::mcmc_trace()</code> functions support including warmups in their trace plots. One quick way to get them is with the <a href="https://cran.rstudio.com/package=ggmcmc"><strong>ggmcmc</strong> package</a> <span class="citation">(<a href="#ref-marinGgmcmcAnalysisMCMC2016" role="doc-biblioref">Fernández i Marín, 2016</a>, <a href="#ref-R-ggmcmc" role="doc-biblioref">2021</a>)</span>.</p>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="markov-chain-monte-carlo.html#cb1098-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span></code></pre></div>
<p>The <strong>ggmcmc</strong> package has a variety of convenience functions for working with MCMC chains. The <code>ggs()</code> function extracts the posterior draws, including <code>warmup</code>, and arranges them in a tidy tibble.</p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="markov-chain-monte-carlo.html#cb1099-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span> </span>
<span id="cb1099-2"><a href="markov-chain-monte-carlo.html#cb1099-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## tibble [48,000 × 4] (S3: tbl_df/tbl/data.frame)
##  $ Iteration: int [1:48000] 1 2 3 4 5 6 7 8 9 10 ...
##  $ Chain    : int [1:48000] 1 1 1 1 1 1 1 1 1 1 ...
##  $ Parameter: Factor w/ 6 levels &quot;b_a_cid1&quot;,&quot;b_a_cid2&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ value    : num [1:48000] 0.771 0.771 0.771 0.771 0.836 ...
##  - attr(*, &quot;nChains&quot;)= int 4
##  - attr(*, &quot;nParameters&quot;)= int 6
##  - attr(*, &quot;nIterations&quot;)= int 2000
##  - attr(*, &quot;nBurnin&quot;)= num 1000
##  - attr(*, &quot;nThin&quot;)= num 1
##  - attr(*, &quot;description&quot;)= chr &quot;920bbeee3f6e096514923a04c53077f5&quot;</code></pre>
<p>With this in hand, we can now include those warmup draws in our trace plots. Here’s how to do so without convenience functions like <code>bayesplot::mcmc_trace()</code>.</p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="markov-chain-monte-carlo.html#cb1101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span></span>
<span id="cb1101-2"><a href="markov-chain-monte-carlo.html#cb1101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-3"><a href="markov-chain-monte-carlo.html#cb1101-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1101-4"><a href="markov-chain-monte-carlo.html#cb1101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1101-5"><a href="markov-chain-monte-carlo.html#cb1101-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this marks off the warmups</span></span>
<span id="cb1101-6"><a href="markov-chain-monte-carlo.html#cb1101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb1101-7"><a href="markov-chain-monte-carlo.html#cb1101-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb1101-8"><a href="markov-chain-monte-carlo.html#cb1101-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> pomological_palette[<span class="dv">9</span>], <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1101-9"><a href="markov-chain-monte-carlo.html#cb1101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb1101-10"><a href="markov-chain-monte-carlo.html#cb1101-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1101-11"><a href="markov-chain-monte-carlo.html#cb1101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_pomological</span>() <span class="sc">+</span></span>
<span id="cb1101-12"><a href="markov-chain-monte-carlo.html#cb1101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb1101-13"><a href="markov-chain-monte-carlo.html#cb1101-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1101-14"><a href="markov-chain-monte-carlo.html#cb1101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">+</span></span>
<span id="cb1101-15"><a href="markov-chain-monte-carlo.html#cb1101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb1101-16"><a href="markov-chain-monte-carlo.html#cb1101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-51-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Following <strong>brms</strong> defaults, we won’t include warmup iterations in the trace plots for other models in this book. A nice thing about plots that do contain them, though, is they reveal how quickly our HMC chains transition away from their start values into the posterior. To get a better sense of this, let’s make those trace plots once more, but this time zooming in on the first 50 iterations.</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="markov-chain-monte-carlo.html#cb1102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span></span>
<span id="cb1102-2"><a href="markov-chain-monte-carlo.html#cb1102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1102-3"><a href="markov-chain-monte-carlo.html#cb1102-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1102-4"><a href="markov-chain-monte-carlo.html#cb1102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value, <span class="at">color =</span> chain)) <span class="sc">+</span></span>
<span id="cb1102-5"><a href="markov-chain-monte-carlo.html#cb1102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb1102-6"><a href="markov-chain-monte-carlo.html#cb1102-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb1102-7"><a href="markov-chain-monte-carlo.html#cb1102-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> pomological_palette[<span class="dv">9</span>], <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1102-8"><a href="markov-chain-monte-carlo.html#cb1102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1102-9"><a href="markov-chain-monte-carlo.html#cb1102-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_pomological</span>() <span class="sc">+</span></span>
<span id="cb1102-10"><a href="markov-chain-monte-carlo.html#cb1102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Another custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb1102-11"><a href="markov-chain-monte-carlo.html#cb1102-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1102-12"><a href="markov-chain-monte-carlo.html#cb1102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb1102-13"><a href="markov-chain-monte-carlo.html#cb1102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">+</span></span>
<span id="cb1102-14"><a href="markov-chain-monte-carlo.html#cb1102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb1102-15"><a href="markov-chain-monte-carlo.html#cb1102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-52-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>For each parameter, the all four chains had moved away from their starting values to converge on the marginal posteriors by the 30<sup>th</sup> iteration or so.</p>
<p>But anyway, we’ve veered a bit from the text. McElreath pointed out a second way to visualize the chains is by the distribution of the ranked samples, which he called a <strong>trank plot</strong> (short for trace rank plot). I’m not aware that <strong>brms</strong> has a built-in function for that. Happily, we can make them with <code>mcmc_rank_overlay()</code>.</p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="markov-chain-monte-carlo.html#cb1103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b9<span class="fl">.1</span>b) <span class="sc">%&gt;%</span>  </span>
<span id="cb1103-2"><a href="markov-chain-monte-carlo.html#cb1103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a_cid1<span class="sc">:</span>sigma)) <span class="sc">+</span></span>
<span id="cb1103-3"><a href="markov-chain-monte-carlo.html#cb1103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_pomological</span>() <span class="sc">+</span></span>
<span id="cb1103-4"><a href="markov-chain-monte-carlo.html#cb1103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trank plots&quot;</span>,</span>
<span id="cb1103-5"><a href="markov-chain-monte-carlo.html#cb1103-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1103-6"><a href="markov-chain-monte-carlo.html#cb1103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1103-7"><a href="markov-chain-monte-carlo.html#cb1103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">+</span></span>
<span id="cb1103-8"><a href="markov-chain-monte-carlo.html#cb1103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">2</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-53-1.png" width="768" style="display: block; margin: auto;" /></p>
<blockquote>
<p>What this means is to take all the samples for each individual parameter and rank them. The lowest sample gets rank 1. The largest gets the maximum rank (the number of samples across all chains). Then we draw a histogram of these ranks for each individual chain. Why do this? Because if the chains are exploring the same space efficiently, the histograms should be similar to one another and largely overlapping.</p>
<p>…The horizontal is rank, from 1 to the number of samples across all chains (2000 in this example). The vertical axis is the frequency of ranks in each bin of the histogram. This trank plot is what we hope for: Histograms that overlap and stay within the same range. (pp. 284–285)</p>
</blockquote>
<div id="overthinking-raw-stan-model-code." class="section level4 hasAnchor" number="9.4.5.1">
<h4><span class="header-section-number">9.4.5.1</span> Overthinking: Raw Stan model code.<a href="markov-chain-monte-carlo.html#overthinking-raw-stan-model-code." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>stancode()</code> function works with <strong>brms</strong> much like it does with <strong>rethinking</strong>.</p>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="markov-chain-monte-carlo.html#cb1104-1" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">stancode</span>(b9<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>## // generated with brms 2.18.0
## functions {
## }
## data {
##   int&lt;lower=1&gt; N;  // total number of observations
##   vector[N] Y;  // response variable
##   int&lt;lower=1&gt; K_a;  // number of population-level effects
##   matrix[N, K_a] X_a;  // population-level design matrix
##   int&lt;lower=1&gt; K_b;  // number of population-level effects
##   matrix[N, K_b] X_b;  // population-level design matrix
##   // covariate vectors for non-linear functions
##   vector[N] C_1;
##   int prior_only;  // should the likelihood be ignored?
## }
## transformed data {
## }
## parameters {
##   vector[K_a] b_a;  // population-level effects
##   vector[K_b] b_b;  // population-level effects
##   real&lt;lower=0&gt; sigma;  // dispersion parameter
## }
## transformed parameters {
##   real lprior = 0;  // prior contributions to the log posterior
##   lprior += normal_lpdf(b_a[1] | 1, 0.1);
##   lprior += normal_lpdf(b_a[2] | 1, 0.1);
##   lprior += normal_lpdf(b_b[1] | 0, 0.3);
##   lprior += normal_lpdf(b_b[2] | 0, 0.3);
##   lprior += exponential_lpdf(sigma | 1);
## }
## model {
##   // likelihood including constants
##   if (!prior_only) {
##     // initialize linear predictor term
##     vector[N] nlp_a = rep_vector(0.0, N);
##     // initialize linear predictor term
##     vector[N] nlp_b = rep_vector(0.0, N);
##     // initialize non-linear predictor term
##     vector[N] mu;
##     nlp_a += X_a * b_a;
##     nlp_b += X_b * b_b;
##     for (n in 1:N) {
##       // compute non-linear predictor values
##       mu[n] = 0 + nlp_a[n] + nlp_b[n] * (C_1[n] - 0.215);
##     }
##     target += normal_lpdf(Y | mu, sigma);
##   }
##   // priors including constants
##   target += lprior;
## }
## generated quantities {
## }</code></pre>
<p>You can also get that information by executing <code>b9.1b$model</code> or <code>b9.1b$fit@stanmodel</code>.</p>
</div>
</div>
</div>
<div id="care-and-feeding-of-your-markov-chain" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Care and feeding of your Markov chain<a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Markov chain Monte Carlo is a highly technical and usually automated procedure. You might write your own MCMC code, for the sake of learning. But it is very easy to introduce subtle biases. A package like Stan, in contrast, is continuously tested against expected output. Most people who use Stan don’t really understand what it is doing, under the hood. That’s okay. Science requires division of labor, and if every one of us had to write our own Markov chains from scratch, a lot less research would get done in the aggregate. (p. 287)</p>
</blockquote>
<p>If you do want to learn more about HMC, McElreath has some nice introductory lectures on the topic (see <a href="https://youtu.be/v-j0UmWf3Us">here</a> and <a href="https://youtu.be/BWEtS3HuU5A">here</a>). To dive even deeper, <a href="https://betanalpha.github.io/">Michael Betancourt</a> from the Stan team has given many lectures on the topic (e.g., <a href="https://youtu.be/_fnDz2Bz3h8">here</a> and <a href="https://youtu.be/jUSZboSq1zg">here</a>).</p>
<div id="how-many-samples-do-you-need" class="section level3 hasAnchor" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> How many samples do you need?<a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>brms</strong> defaults are <code>iter = 2000</code> and <code>warmup = 1000</code>, which are twice the number as in McElreath’s <strong>rethinking</strong> package.</p>
<blockquote>
<p>If all you want are posterior means, it doesn’t take many samples at all to get very good estimates. Even a couple hundred samples will do. But if you care about the exact shape in the extreme tails of the posterior, the 99th percentile or so, then you’ll need many more. So there is no universally useful number of samples to aim for. In most typical regression applications, you can get a very good estimate of the posterior mean with as few as 200 effective samples. And if the posterior is approximately Gaussian, then all you need in addition is a good estimate of the variance, which can be had with one order of magnitude more, in most cases. For highly skewed posteriors, you’ll have to think more about which region of the distribution interests you. Stan will sometimes warn you about “tail ESS,” the effective sample size (similar to <code>n_eff</code>) in the tails of the posterior. In those cases, it is nervous about the quality of extreme intervals, like 95%. Sampling more usually helps. (pp. 287-288)</p>
</blockquote>
<p>And remember, with changes from <strong>brms</strong> version 2.10.0, we now have both <code>Bulk_ESS</code> and <code>Tail_ESS</code> to consult when thinking about the effective sample size. What McElreath referred to as <code>n_eff</code> is what we now think of as <code>Bulk_ESS</code> when using <strong>brms</strong>. When McElreath referred to the “tail ESS” in the end of that block quote, that’s our <strong>brms</strong> <code>Tail_ESS</code> number.</p>
<div id="rethinking-warmup-is-not-burn-in." class="section level4 hasAnchor" number="9.5.1.1">
<h4><span class="header-section-number">9.5.1.1</span> Rethinking: Warmup is not burn-in.<a href="markov-chain-monte-carlo.html#rethinking-warmup-is-not-burn-in." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Other MCMC algorithms and software often discuss <strong>burn-in</strong>….</p>
<p>But Stan’s sampling algorithms use a different approach. What Stan does during warmup is quite different from what it does after warmup. The warmup samples are used to adapt sampling, to find good values for the step size and the number of steps. Warmup samples are not representative of the target posterior distribution, no matter how long warmup continues. They are not burning in, but rather more like cycling the motor to heat things up and get ready for sampling. When real sampling begins, the samples will be immediately from the target distribution, assuming adaptation was successful. (p. 288)</p>
</blockquote>
</div>
</div>
<div id="how-many-chains-do-you-need" class="section level3 hasAnchor" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> How many chains do you need?<a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>It is very common to run more than one Markov chain, when estimating a single model. To do this with [<strong>brms</strong>], the <code>chains</code> argument specifies the number of independent Markov chains to sample from. And the optional <code>cores</code> argument lets you distribute the chains across different processors, so they can run simultaneously, rather than sequentially….</p>
<p>for typical regression models, you can live by the motto <em>one short chain to debug, four chains for verification and inference</em>. (pp. 288–289, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="rethinking-convergence-diagnostics." class="section level4 hasAnchor" number="9.5.2.1">
<h4><span class="header-section-number">9.5.2.1</span> Rethinking: Convergence diagnostics.<a href="markov-chain-monte-carlo.html#rethinking-convergence-diagnostics." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ve already covered how <strong>brms</strong> has expanded the traditional notion of effective samples (i.e., <code>n_eff</code>) to <code>Bulk_ESS</code> and <code>Tail_ESS</code>. Times are changing for the <span class="math inline">\(\widehat R\)</span>, too. However, it turns out the Stan team has found some deficiencies with the <span class="math inline">\(\widehat R\)</span>, for which they’ve made recommendations that will be implemented in the Stan ecosystem sometime soon (see <a href="https://discourse.mc-stan.org/t/new-r-hat-and-ess/8165">here</a> for a related thread on the Stan Forums). In the meantime, you can read all about it in <span class="citation">Vehtari et al. (<a href="#ref-vehtariRanknormalizationFoldingLocalization2019" role="doc-biblioref">2019</a>)</span> and in one of Dan Simpson’s <a href="https://statmodeling.stat.columbia.edu/2019/03/19/maybe-its-time-to-let-the-old-ways-die-or-we-broke-r-hat-so-now-we-have-to-fix-it/">blog posts</a>.</p>
<p>For more on these topics, you might also check out Gabry and Modrák’s <span class="citation">(<a href="#ref-gabryVisualMCMCDiagnostics2022" role="doc-biblioref">2022</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/visual-mcmc-diagnostics.html"><em>Visual MCMC diagnostics using the bayesplot package</em></a>.</p>
</div>
</div>
<div id="taming-a-wild-chain." class="section level3 hasAnchor" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Taming a wild chain.<a href="markov-chain-monte-carlo.html#taming-a-wild-chain." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with <strong>rethinking</strong>, <strong>brms</strong> can take data in the form of a list. Recall however, that in order to specify starting values, you need to specify a list of lists with an <code>inits</code> argument rather than with <code>start</code>.</p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="markov-chain-monte-carlo.html#cb1106-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb1106-2"><a href="markov-chain-monte-carlo.html#cb1106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb1106-3"><a href="markov-chain-monte-carlo.html#cb1106-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1106-4"><a href="markov-chain-monte-carlo.html#cb1106-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1106-5"><a href="markov-chain-monte-carlo.html#cb1106-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1000</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1106-6"><a href="markov-chain-monte-carlo.html#cb1106-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.0001</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1106-7"><a href="markov-chain-monte-carlo.html#cb1106-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1106-8"><a href="markov-chain-monte-carlo.html#cb1106-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1106-9"><a href="markov-chain-monte-carlo.html#cb1106-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b09.02&quot;</span>)</span></code></pre></div>
<p>Let’s peek at the summary.</p>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="markov-chain-monte-carlo.html#cb1107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning: There were 399 divergent transitions after warmup. Increasing adapt_delta above 0.8 may
## help. See http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 1 
##    Data: list(y = c(-1, 1)) (Number of observations: 2) 
##   Draws: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 3000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    21.66    351.90  -735.92   910.02 1.02      638      533
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma   655.70   1331.87    16.50  4239.17 1.04       68       24
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Much like in the text, this summary is a disaster. Note the warning about <span style="color: red;">divergent transitions</span>. The <code>brms::nuts_params()</code> function allows use to pull a wealth of diagnostic information for the chains from a <strong>brms</strong> fit. The different kinds of diagnostics are listed in the <code>Parameter</code> column.</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="markov-chain-monte-carlo.html#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nuts_params</span>(b9<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-2"><a href="markov-chain-monte-carlo.html#cb1110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Parameter)</span></code></pre></div>
<pre><code>##       Parameter
## 1 accept_stat__
## 2    stepsize__
## 3   treedepth__
## 4  n_leapfrog__
## 5   divergent__
## 6      energy__</code></pre>
<p>Our interest is for when <code>Parameter == "divergent__"</code>.</p>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="markov-chain-monte-carlo.html#cb1112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nuts_params</span>(b9<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1112-2"><a href="markov-chain-monte-carlo.html#cb1112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">&quot;divergent__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1112-3"><a href="markov-chain-monte-carlo.html#cb1112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Value)</span></code></pre></div>
<pre><code>##   Value    n
## 1     0 2601
## 2     1  399</code></pre>
<p>This indicates that among the 3,000 post-warmup draws, 393 were classified as divergent transitions. We can use the <code>np</code> argument within <code>brms::pairs()</code> to include this information in the <code>pairs()</code> plot.</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="markov-chain-monte-carlo.html#cb1114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b9<span class="fl">.2</span>, </span>
<span id="cb1114-2"><a href="markov-chain-monte-carlo.html#cb1114-2" aria-hidden="true" tabindex="-1"></a>      <span class="co"># currently not working with bayesplot 1.10.0</span></span>
<span id="cb1114-3"><a href="markov-chain-monte-carlo.html#cb1114-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># see https://github.com/stan-dev/bayesplot/issues/298</span></span>
<span id="cb1114-4"><a href="markov-chain-monte-carlo.html#cb1114-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># np = nuts_params(b9.2),</span></span>
<span id="cb1114-5"><a href="markov-chain-monte-carlo.html#cb1114-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">off_diag_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-58-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>That <code>np = nuts_params(b9.2)</code> trick will work in a similar way with <strong>bayesplot</strong> functions like <code>mcmc_pairs()</code> and <code>mcmc_trace()</code>. The red x marks show us where the divergent transitions are within the bivariate posterior. To my eye, the pattern in this plot isn’t very strong. Sometimes the pattern of divergent transitions can give you clear clues about where the problems are in the model.</p>
<p>Let’s further inspect the damage by making the top two rows of Figure 9.9.</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="markov-chain-monte-carlo.html#cb1115-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1115-2"><a href="markov-chain-monte-carlo.html#cb1115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(b9<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1115-3"><a href="markov-chain-monte-carlo.html#cb1115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb1115-4"><a href="markov-chain-monte-carlo.html#cb1115-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.25</span>)</span>
<span id="cb1115-5"><a href="markov-chain-monte-carlo.html#cb1115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1115-6"><a href="markov-chain-monte-carlo.html#cb1115-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1115-7"><a href="markov-chain-monte-carlo.html#cb1115-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(b9<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1115-8"><a href="markov-chain-monte-carlo.html#cb1115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma))</span>
<span id="cb1115-9"><a href="markov-chain-monte-carlo.html#cb1115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1115-10"><a href="markov-chain-monte-carlo.html#cb1115-10" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb1115-11"><a href="markov-chain-monte-carlo.html#cb1115-11" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb1115-12"><a href="markov-chain-monte-carlo.html#cb1115-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_pomological</span>() <span class="sc">&amp;</span></span>
<span id="cb1115-13"><a href="markov-chain-monte-carlo.html#cb1115-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1115-14"><a href="markov-chain-monte-carlo.html#cb1115-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1115-15"><a href="markov-chain-monte-carlo.html#cb1115-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb1115-16"><a href="markov-chain-monte-carlo.html#cb1115-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;These chains are not healthy&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-59-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Okay, that’s enough disaster. Let’s try a model that adds just a little information by way of weakly-regularizing priors:</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; \sim \operatorname{Normal}(\mu, \sigma) \\
\mu    &amp; = \alpha \\
\alpha &amp; \sim \operatorname{Normal}(1, 10) \\
\sigma &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Watch our new priors save the day.</p>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="markov-chain-monte-carlo.html#cb1116-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb1116-2"><a href="markov-chain-monte-carlo.html#cb1116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb1116-3"><a href="markov-chain-monte-carlo.html#cb1116-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1116-4"><a href="markov-chain-monte-carlo.html#cb1116-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1116-5"><a href="markov-chain-monte-carlo.html#cb1116-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1116-6"><a href="markov-chain-monte-carlo.html#cb1116-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1116-7"><a href="markov-chain-monte-carlo.html#cb1116-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1116-8"><a href="markov-chain-monte-carlo.html#cb1116-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1116-9"><a href="markov-chain-monte-carlo.html#cb1116-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b09.03&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="markov-chain-monte-carlo.html#cb1117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 1 
##    Data: list(y = c(-1, 1)) (Number of observations: 2) 
##   Draws: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 3000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.12      1.19    -2.13     2.70 1.00     1047      886
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.55      0.82     0.59     3.70 1.00      919     1021
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As in the text, no more warning signs and no more silly estimates. The trace and trank plots look better, too.</p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="markov-chain-monte-carlo.html#cb1119-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1119-2"><a href="markov-chain-monte-carlo.html#cb1119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(b9<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1119-3"><a href="markov-chain-monte-carlo.html#cb1119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb1119-4"><a href="markov-chain-monte-carlo.html#cb1119-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.25</span>)</span>
<span id="cb1119-5"><a href="markov-chain-monte-carlo.html#cb1119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1119-6"><a href="markov-chain-monte-carlo.html#cb1119-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1119-7"><a href="markov-chain-monte-carlo.html#cb1119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(b9<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1119-8"><a href="markov-chain-monte-carlo.html#cb1119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma)) <span class="sc">+</span></span>
<span id="cb1119-9"><a href="markov-chain-monte-carlo.html#cb1119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">35</span>, <span class="cn">NA</span>)</span>
<span id="cb1119-10"><a href="markov-chain-monte-carlo.html#cb1119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1119-11"><a href="markov-chain-monte-carlo.html#cb1119-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb1119-12"><a href="markov-chain-monte-carlo.html#cb1119-12" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb1119-13"><a href="markov-chain-monte-carlo.html#cb1119-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_pomological</span>() <span class="sc">&amp;</span></span>
<span id="cb1119-14"><a href="markov-chain-monte-carlo.html#cb1119-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1119-15"><a href="markov-chain-monte-carlo.html#cb1119-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1119-16"><a href="markov-chain-monte-carlo.html#cb1119-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb1119-17"><a href="markov-chain-monte-carlo.html#cb1119-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;Weakly informative priors cleared up the condition right away&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-61-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Now behold our version of Figure 9.10.</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="markov-chain-monte-carlo.html#cb1120-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b9<span class="fl">.3</span>)</span>
<span id="cb1120-2"><a href="markov-chain-monte-carlo.html#cb1120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-3"><a href="markov-chain-monte-carlo.html#cb1120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb1120-4"><a href="markov-chain-monte-carlo.html#cb1120-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1120-5"><a href="markov-chain-monte-carlo.html#cb1120-5" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span></span>
<span id="cb1120-6"><a href="markov-chain-monte-carlo.html#cb1120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb1120-7"><a href="markov-chain-monte-carlo.html#cb1120-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1120-8"><a href="markov-chain-monte-carlo.html#cb1120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept)) <span class="sc">+</span></span>
<span id="cb1120-9"><a href="markov-chain-monte-carlo.html#cb1120-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">trim =</span> T) <span class="sc">+</span></span>
<span id="cb1120-10"><a href="markov-chain-monte-carlo.html#cb1120-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">15</span>, <span class="at">to =</span> <span class="dv">15</span>, <span class="at">length.out =</span> <span class="dv">50</span>)),</span>
<span id="cb1120-11"><a href="markov-chain-monte-carlo.html#cb1120-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)),</span>
<span id="cb1120-12"><a href="markov-chain-monte-carlo.html#cb1120-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> pomological_palette[<span class="dv">5</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1120-13"><a href="markov-chain-monte-carlo.html#cb1120-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(alpha))</span>
<span id="cb1120-14"><a href="markov-chain-monte-carlo.html#cb1120-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-15"><a href="markov-chain-monte-carlo.html#cb1120-15" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb1120-16"><a href="markov-chain-monte-carlo.html#cb1120-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1120-17"><a href="markov-chain-monte-carlo.html#cb1120-17" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span></span>
<span id="cb1120-18"><a href="markov-chain-monte-carlo.html#cb1120-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sigma) <span class="sc">%&gt;%</span></span>
<span id="cb1120-19"><a href="markov-chain-monte-carlo.html#cb1120-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1120-20"><a href="markov-chain-monte-carlo.html#cb1120-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma)) <span class="sc">+</span></span>
<span id="cb1120-21"><a href="markov-chain-monte-carlo.html#cb1120-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">trim =</span> T) <span class="sc">+</span></span>
<span id="cb1120-22"><a href="markov-chain-monte-carlo.html#cb1120-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">50</span>)),</span>
<span id="cb1120-23"><a href="markov-chain-monte-carlo.html#cb1120-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dexp</span>(<span class="at">x =</span> x, <span class="at">rate =</span> <span class="dv">1</span>)),</span>
<span id="cb1120-24"><a href="markov-chain-monte-carlo.html#cb1120-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> pomological_palette[<span class="dv">9</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1120-25"><a href="markov-chain-monte-carlo.html#cb1120-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(sigma),</span>
<span id="cb1120-26"><a href="markov-chain-monte-carlo.html#cb1120-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1120-27"><a href="markov-chain-monte-carlo.html#cb1120-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1120-28"><a href="markov-chain-monte-carlo.html#cb1120-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.7</span>))</span>
<span id="cb1120-29"><a href="markov-chain-monte-carlo.html#cb1120-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-30"><a href="markov-chain-monte-carlo.html#cb1120-30" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb1120-31"><a href="markov-chain-monte-carlo.html#cb1120-31" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb1120-32"><a href="markov-chain-monte-carlo.html#cb1120-32" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">+</span> p2) <span class="sc">&amp;</span></span>
<span id="cb1120-33"><a href="markov-chain-monte-carlo.html#cb1120-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>)</span>
<span id="cb1120-34"><a href="markov-chain-monte-carlo.html#cb1120-34" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;Prior (dashed) and posterior (solid) distributions for the</span><span class="sc">\n</span><span class="st">model with weakly-informative priors, b9.3&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-62-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>These weakly informative priors have helped by providing a very gentle nudge towards reasonable values of the parameters. Now values like 30 million are no longer equally plausible as small values like 1 or 2. Lots of problematic chains want subtle priors like these, designed to tune estimation by assuming a tiny bit of prior information about each parameter. And even though the priors end up getting washed out right away–two observations were enough here–they still have a big effect on inference, by allowing us to get an answer. (pp. 292–293)</p>
</blockquote>
<div id="rethinking-the-folk-theorem-of-statistical-computing." class="section level4 hasAnchor" number="9.5.3.1">
<h4><span class="header-section-number">9.5.3.1</span> Rethinking: The folk theorem of statistical computing.<a href="markov-chain-monte-carlo.html#rethinking-the-folk-theorem-of-statistical-computing." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The example above illustrates <a href="https://statmodeling.stat.columbia.edu/2008/05/13/the_folk_theore/">Andrew Gelman’s <strong>folk theorem of statistical computing</strong></a>: When you have computational problems, often there’s a problem with your model. Before we begin to tune the software and pour more computer power into a problem, it can be useful to go over the model specification again, and the data itself, to make sure the problem isn’t in the pre-sampling stage. (p. 293)</p>
</blockquote>
</div>
<div id="overthinking-divergent-transitions-are-your-friend." class="section level4 hasAnchor" number="9.5.3.2">
<h4><span class="header-section-number">9.5.3.2</span> Overthinking: Divergent transitions are your friend.<a href="markov-chain-monte-carlo.html#overthinking-divergent-transitions-are-your-friend." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>You’ll see divergent transition warnings often in using [<code>brms::brm()</code>] and Stan. They are your friend, providing a helpful warning. These warnings arise when the numerical simulation that HMC uses is inaccurate. HMC can detect these inaccuracies. That is one of its major advantages over other sampling approaches, most of which provide few automatic ways to discover bad chains. (p. 293)</p>
</blockquote>
<p>This is an issue that comes up frequently on the Stan Forums (here’s a link to the <a href="https://discourse.mc-stan.org/c/interfaces/brms/36"><strong>brms</strong> section</a>). It’s a good idea to take divergent transitions seriously. Reaching out to others in the community is a great way to get guidance. But before you start a new post, make sure you look through the previous threads to keep from posting redundant questions.</p>
</div>
</div>
<div id="non-identifiable-parameters." class="section level3 hasAnchor" number="9.5.4">
<h3><span class="header-section-number">9.5.4</span> Non-identifiable parameters.<a href="markov-chain-monte-carlo.html#non-identifiable-parameters." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It appears that the <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues/3">only way</a> to get a <strong>brms</strong> version of McElreath’s <code>m9.4</code> and <code>m9.5</code> is to augment the data. In addition to the Gaussian <code>y</code> vector, we’ll add two constants to the data, <code>intercept_1 = 1</code> and <code>intercept_2 = 1</code>.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="markov-chain-monte-carlo.html#cb1121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb1121-2"><a href="markov-chain-monte-carlo.html#cb1121-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="markov-chain-monte-carlo.html#cb1122-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.4</span> <span class="ot">&lt;-</span></span>
<span id="cb1122-2"><a href="markov-chain-monte-carlo.html#cb1122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y  =</span> y,</span>
<span id="cb1122-3"><a href="markov-chain-monte-carlo.html#cb1122-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">a1 =</span> <span class="dv">1</span>,</span>
<span id="cb1122-4"><a href="markov-chain-monte-carlo.html#cb1122-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">a2 =</span> <span class="dv">1</span>), </span>
<span id="cb1122-5"><a href="markov-chain-monte-carlo.html#cb1122-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1122-6"><a href="markov-chain-monte-carlo.html#cb1122-6" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a1 <span class="sc">+</span> a2,</span>
<span id="cb1122-7"><a href="markov-chain-monte-carlo.html#cb1122-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1000</span>), <span class="at">class =</span> b),</span>
<span id="cb1122-8"><a href="markov-chain-monte-carlo.html#cb1122-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1122-9"><a href="markov-chain-monte-carlo.html#cb1122-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1122-10"><a href="markov-chain-monte-carlo.html#cb1122-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1122-11"><a href="markov-chain-monte-carlo.html#cb1122-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b09.04&quot;</span>)</span></code></pre></div>
<p>Our model results don’t perfectly mirror McElreath’s, but they’re identical in spirit.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="markov-chain-monte-carlo.html#cb1123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be careful when analysing
## the results! We recommend running more iterations and/or setting stronger priors.</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 0 + a1 + a2 
##    Data: list(y = y, a1 = 1, a2 = 1) (Number of observations: 100) 
##   Draws: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 3000
## 
## Population-Level Effects: 
##    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a1   261.16    337.05  -401.63   800.02 1.35        8       26
## a2  -261.22    337.05  -799.99   401.53 1.35        8       26
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.07     0.81     1.08 1.15       25       31
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Note the frightening warning message. Those results are a mess! Let’s try again.</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="markov-chain-monte-carlo.html#cb1126-1" aria-hidden="true" tabindex="-1"></a>b9<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb1126-2"><a href="markov-chain-monte-carlo.html#cb1126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y  =</span> y,</span>
<span id="cb1126-3"><a href="markov-chain-monte-carlo.html#cb1126-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">a1 =</span> <span class="dv">1</span>,</span>
<span id="cb1126-4"><a href="markov-chain-monte-carlo.html#cb1126-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">a2 =</span> <span class="dv">1</span>), </span>
<span id="cb1126-5"><a href="markov-chain-monte-carlo.html#cb1126-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1126-6"><a href="markov-chain-monte-carlo.html#cb1126-6" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a1 <span class="sc">+</span> a2,</span>
<span id="cb1126-7"><a href="markov-chain-monte-carlo.html#cb1126-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb1126-8"><a href="markov-chain-monte-carlo.html#cb1126-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1126-9"><a href="markov-chain-monte-carlo.html#cb1126-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1126-10"><a href="markov-chain-monte-carlo.html#cb1126-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb1126-11"><a href="markov-chain-monte-carlo.html#cb1126-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b09.05&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="markov-chain-monte-carlo.html#cb1127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b9<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 0 + a1 + a2 
##    Data: list(y = y, a1 = 1, a2 = 1) (Number of observations: 100) 
##   Draws: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 3000
## 
## Population-Level Effects: 
##    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a1    -0.20      7.38   -13.90    14.32 1.00      738     1058
## a2     0.14      7.38   -14.43    13.85 1.00      738     1066
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.97      0.07     0.84     1.10 1.00     1379     1313
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>“The estimates for <code>a1</code> and <code>a2</code> are better identified now. Well, they still aren’t individually identified. But their sum is identified” (p. 296). Now it’s time to make our version of Figure 9.11. Before we do, one of the challenges we’ll have to overcome is the <code>bayesplot::mcmc_rank_overlay()</code> doesn’t seem to give users an easy way to control the faceting behavior of the plotting function. If you try to simultaneously plot all three model parameters with <code>mcmc_rank_overlay()</code>, you’ll end up with the one row and three columns. But I want the reverse. One solution is to make a custom plotting function. Since we’re juggling both <code>mcmc_trace()</code> and <code>mcmc_rank_overlay()</code>, we’ll make the function do both at once. The trick will be to set the function and workflow up so that we only enter in one parameter at a time. Here’s the function.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="markov-chain-monte-carlo.html#cb1129-1" aria-hidden="true" tabindex="-1"></a>trace_rank <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, <span class="at">subtitle =</span> <span class="cn">NULL</span>, <span class="at">ymin =</span> <span class="cn">NA</span>) {</span>
<span id="cb1129-2"><a href="markov-chain-monte-carlo.html#cb1129-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1129-3"><a href="markov-chain-monte-carlo.html#cb1129-3" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span></span>
<span id="cb1129-4"><a href="markov-chain-monte-carlo.html#cb1129-4" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">%&gt;%</span> </span>
<span id="cb1129-5"><a href="markov-chain-monte-carlo.html#cb1129-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> var,</span>
<span id="cb1129-6"><a href="markov-chain-monte-carlo.html#cb1129-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.25</span>,</span>
<span id="cb1129-7"><a href="markov-chain-monte-carlo.html#cb1129-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">ncol =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1129-8"><a href="markov-chain-monte-carlo.html#cb1129-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> subtitle,</span>
<span id="cb1129-9"><a href="markov-chain-monte-carlo.html#cb1129-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1129-10"><a href="markov-chain-monte-carlo.html#cb1129-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter)</span>
<span id="cb1129-11"><a href="markov-chain-monte-carlo.html#cb1129-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1129-12"><a href="markov-chain-monte-carlo.html#cb1129-12" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span></span>
<span id="cb1129-13"><a href="markov-chain-monte-carlo.html#cb1129-13" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb1129-14"><a href="markov-chain-monte-carlo.html#cb1129-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> var) <span class="sc">+</span></span>
<span id="cb1129-15"><a href="markov-chain-monte-carlo.html#cb1129-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(ymin, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1129-16"><a href="markov-chain-monte-carlo.html#cb1129-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb1129-17"><a href="markov-chain-monte-carlo.html#cb1129-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1129-18"><a href="markov-chain-monte-carlo.html#cb1129-18" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> p1 <span class="sc">+</span> p2</span>
<span id="cb1129-19"><a href="markov-chain-monte-carlo.html#cb1129-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1129-20"><a href="markov-chain-monte-carlo.html#cb1129-20" aria-hidden="true" tabindex="-1"></a>  tr</span>
<span id="cb1129-21"><a href="markov-chain-monte-carlo.html#cb1129-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1129-22"><a href="markov-chain-monte-carlo.html#cb1129-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now use our custom <code>trace_rank()</code> function to make the six rows one at a time and then combine them with a little <strong>patchwork</strong> at the end to make our version of Figure 9.11.</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="markov-chain-monte-carlo.html#cb1130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># b9.4</span></span>
<span id="cb1130-2"><a href="markov-chain-monte-carlo.html#cb1130-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b9<span class="fl">.4</span>)</span>
<span id="cb1130-3"><a href="markov-chain-monte-carlo.html#cb1130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-4"><a href="markov-chain-monte-carlo.html#cb1130-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;b_a1&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;b9.4 (bad priors)&quot;</span>)</span>
<span id="cb1130-5"><a href="markov-chain-monte-carlo.html#cb1130-5" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;b_a2&quot;</span>)</span>
<span id="cb1130-6"><a href="markov-chain-monte-carlo.html#cb1130-6" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;sigma&quot;</span>)</span>
<span id="cb1130-7"><a href="markov-chain-monte-carlo.html#cb1130-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-8"><a href="markov-chain-monte-carlo.html#cb1130-8" aria-hidden="true" tabindex="-1"></a><span class="co"># b9.5</span></span>
<span id="cb1130-9"><a href="markov-chain-monte-carlo.html#cb1130-9" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b9<span class="fl">.5</span>)</span>
<span id="cb1130-10"><a href="markov-chain-monte-carlo.html#cb1130-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-11"><a href="markov-chain-monte-carlo.html#cb1130-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;b_a1&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;b9.5 (good priors)&quot;</span>, <span class="at">ymin =</span> <span class="dv">30</span>)</span>
<span id="cb1130-12"><a href="markov-chain-monte-carlo.html#cb1130-12" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;b_a2&quot;</span>, <span class="at">ymin =</span> <span class="dv">30</span>)</span>
<span id="cb1130-13"><a href="markov-chain-monte-carlo.html#cb1130-13" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">trace_rank</span>(<span class="at">data =</span> post, <span class="at">var =</span> <span class="st">&quot;sigma&quot;</span>, <span class="at">ymin =</span> <span class="dv">30</span>)</span>
<span id="cb1130-14"><a href="markov-chain-monte-carlo.html#cb1130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1130-15"><a href="markov-chain-monte-carlo.html#cb1130-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combine!</span></span>
<span id="cb1130-16"><a href="markov-chain-monte-carlo.html#cb1130-16" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3 <span class="sc">/</span> p4 <span class="sc">/</span> p5 <span class="sc">/</span> p6) <span class="sc">&amp;</span></span>
<span id="cb1130-17"><a href="markov-chain-monte-carlo.html#cb1130-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_pomological</span>() <span class="sc">&amp;</span></span>
<span id="cb1130-18"><a href="markov-chain-monte-carlo.html#cb1130-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pomological_fancy</span>(<span class="at">base_family =</span> <span class="st">&quot;Marck Script&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1130-19"><a href="markov-chain-monte-carlo.html#cb1130-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="09_files/figure-html/unnamed-chunk-67-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The central message in the text, default to weakly-regularizing priors, holds for <strong>brms</strong> just as it does for <strong>rethinking</strong>. For more on the topic, see the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">recommendations from the Stan team</a>. If you want to dive deeper, check out Simpson’s post on Gelman’s blog, <a href="https://statmodeling.stat.columbia.edu/2017/09/05/never-total-eclipse-prior/"><em>(It’s never a) total eclipse of the prior</em></a> and their corresponding <span class="citation">(<a href="#ref-gelmanPriorCanOften2017" role="doc-biblioref">2017</a>)</span> paper with Betancourt, <a href="https://doi.org/10.3390/e19100555"><em>The prior can often only be understood in the context of the likelihood</em></a>.</p>
</div>
</div>
<div id="session-info-8" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="markov-chain-monte-carlo.html#session-info-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="markov-chain-monte-carlo.html#cb1131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggmcmc_1.5.1.1      bayesplot_1.10.0    GGally_2.1.2        tidybayes_3.0.2    
##  [5] brms_2.18.0         Rcpp_1.0.9          patchwork_1.1.2     forcats_0.5.1      
##  [9] stringr_1.4.1       dplyr_1.0.10        purrr_1.0.1         readr_2.1.2        
## [13] tidyr_1.2.1         tibble_3.1.8        tidyverse_1.3.2     ggpomological_0.1.2
## [17] ggplot2_3.4.0      
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      plyr_1.8.7           igraph_1.3.4        
##   [5] svUnit_1.0.6         splines_4.2.2        crosstalk_1.2.0      TH.data_1.1-1       
##   [9] rstantools_2.2.0     inline_0.3.19        digest_0.6.31        htmltools_0.5.3     
##  [13] rethinking_2.21      fansi_1.0.3          magrittr_2.0.3       checkmate_2.1.0     
##  [17] googlesheets4_1.0.1  tzdb_0.3.0           modelr_0.1.8         extrafont_0.18      
##  [21] RcppParallel_5.1.5   matrixStats_0.63.0   xts_0.12.1           sandwich_3.0-2      
##  [25] extrafontdb_1.0      prettyunits_1.1.1    colorspace_2.0-3     rvest_1.0.2         
##  [29] ggdist_3.2.1         haven_2.5.1          xfun_0.35            callr_3.7.3         
##  [33] crayon_1.5.2         jsonlite_1.8.4       lme4_1.1-31          survival_3.4-0      
##  [37] zoo_1.8-10           glue_1.6.2           gtable_0.3.1         gargle_1.2.0        
##  [41] emmeans_1.8.0        distributional_0.3.1 pkgbuild_1.3.1       Rttf2pt1_1.3.10     
##  [45] rstan_2.21.8         shape_1.4.6          abind_1.4-5          scales_1.2.1        
##  [49] mvtnorm_1.1-3        DBI_1.1.3            miniUI_0.1.1.1       isoband_0.2.7       
##  [53] xtable_1.8-4         HDInterval_0.2.4     stats4_4.2.2         StanHeaders_2.21.0-7
##  [57] DT_0.24              htmlwidgets_1.5.4    httr_1.4.4           threejs_0.3.3       
##  [61] RColorBrewer_1.1-3   arrayhelpers_1.1-0   posterior_1.3.1      ellipsis_0.3.2      
##  [65] reshape_0.8.9        pkgconfig_2.0.3      loo_2.5.1            farver_2.1.1        
##  [69] sass_0.4.2           dbplyr_2.2.1         utf8_1.2.2           tidyselect_1.2.0    
##  [73] labeling_0.4.2       rlang_1.0.6          reshape2_1.4.4       later_1.3.0         
##  [77] munsell_0.5.0        cellranger_1.1.0     tools_4.2.2          cachem_1.0.6        
##  [81] cli_3.6.0            generics_0.1.3       broom_1.0.2          evaluate_0.18       
##  [85] fastmap_1.1.0        processx_3.8.0       knitr_1.40           fs_1.5.2            
##  [89] nlme_3.1-160         projpred_2.2.1       mime_0.12            xml2_1.3.3          
##  [93] compiler_4.2.2       shinythemes_1.2.0    rstudioapi_0.13      gamm4_0.2-6         
##  [97] reprex_2.0.2         bslib_0.4.0          stringi_1.7.8        highr_0.9           
## [101] ps_1.7.2             Brobdingnag_1.2-8    lattice_0.20-45      Matrix_1.5-1        
## [105] nloptr_2.0.3         markdown_1.1         shinyjs_2.1.0        tensorA_0.36.2      
## [109] vctrs_0.5.1          pillar_1.8.1         lifecycle_1.0.3      jquerylib_0.1.4     
## [113] bridgesampling_1.1-2 estimability_1.4.1   httpuv_1.6.5         R6_2.5.1            
## [117] bookdown_0.28        promises_1.2.0.1     gridExtra_2.3        codetools_0.2-18    
## [121] boot_1.3-28          colourpicker_1.1.1   MASS_7.3-58.1        gtools_3.9.4        
## [125] assertthat_0.2.1     withr_2.5.0          shinystan_2.6.0      multcomp_1.4-20     
## [129] mgcv_1.8-41          parallel_4.2.2       hms_1.1.1            grid_4.2.2          
## [133] minqa_1.2.5          coda_0.19-4          rmarkdown_2.16       cmdstanr_0.5.3      
## [137] googledrive_2.0.0    shiny_1.7.2          lubridate_1.8.0      base64enc_0.1-3     
## [141] dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-R-ggpomological" class="csl-entry">
Aden-Buie, G. (2022). <em><span class="nocase">ggpomological</span>: <span>Pomological</span> plot theme for <span class="nocase">ggplot2</span></em> [Manual]. <a href="https://github.com/gadenbuie/ggpomological">https://github.com/gadenbuie/ggpomological</a>
</div>
<div id="ref-rstanarm2018" class="csl-entry">
Brilleman, S., Crowther, M., Moreno-Betancur, M., Buros Novik, J., &amp; Wolfe, R. (2018). <em>Joint longitudinal and time-to-event models via <span>Stan</span>.</em> <a href="https://github.com/stan-dev/stancon_talks/">https://github.com/stan-dev/stancon_talks/</a>
</div>
<div id="ref-Bürkner2022Non_linear" class="csl-entry">
Bürkner, P.-C. (2022e). <em>Estimating non-linear models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html</a>
</div>
<div id="ref-casellaExplainingGibbsSampler1992" class="csl-entry">
Casella, G., &amp; George, E. I. (1992). Explaining the <span>Gibbs</span> sampler. <em>The American Statistician</em>, <em>46</em>(3), 167–174. <a href="https://doi.org/10.1080/00031305.1992.10475878">https://doi.org/10.1080/00031305.1992.10475878</a>
</div>
<div id="ref-marinGgmcmcAnalysisMCMC2016" class="csl-entry">
Fernández i Marín, X. (2016). <span class="nocase">ggmcmc</span>: <span>Analysis</span> of <span>MCMC</span> samples and <span>Bayesian</span> inference. <em>Journal of Statistical Software</em>, <em>70</em>(9), 1–20. <a href="https://doi.org/10.18637/jss.v070.i09">https://doi.org/10.18637/jss.v070.i09</a>
</div>
<div id="ref-R-ggmcmc" class="csl-entry">
Fernández i Marín, X. (2021). <em><span class="nocase">ggmcmc</span>: <span>Tools</span> for analyzing <span>MCMC</span> simulations from <span>Bayesian</span> inference</em> [Manual]. <a href="https://CRAN.R-project.org/package=ggmcmc">https://CRAN.R-project.org/package=ggmcmc</a>
</div>
<div id="ref-R-rstanarm" class="csl-entry">
Gabry, J., &amp; Goodrich, B. (2022). <em><span class="nocase">rstanarm</span>: <span>Bayesian</span> applied regression modeling via stan</em> [Manual]. <a href="https://CRAN.R-project.org/package=rstanarm">https://CRAN.R-project.org/package=rstanarm</a>
</div>
<div id="ref-gabryVisualMCMCDiagnostics2022" class="csl-entry">
Gabry, J., &amp; Modrák, M. (2022). <em>Visual <span>MCMC</span> diagnostics using the bayesplot package</em>. <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/visual-mcmc-diagnostics.html">https://CRAN.R-project.org/package=bayesplot/vignettes/visual-mcmc-diagnostics.html</a>
</div>
<div id="ref-gelman2013bayesian" class="csl-entry">
Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. (2013). <em>Bayesian data analysis</em> (Third Edition). <span>CRC press</span>. <a href="https://stat.columbia.edu/~gelman/book/">https://stat.columbia.edu/~gelman/book/</a>
</div>
<div id="ref-gelmanPriorCanOften2017" class="csl-entry">
Gelman, A., Simpson, D., &amp; Betancourt, M. (2017). The prior can often only be understood in the context of the likelihood. <em>Entropy</em>, <em>19</em>(10, 10), 555. <a href="https://doi.org/10.3390/e19100555">https://doi.org/10.3390/e19100555</a>
</div>
<div id="ref-gemanStochasticRelaxationGibbs1984" class="csl-entry">
Geman, S., &amp; Geman, D. (1984). Stochastic relaxation, <span>Gibbs</span> distributions, and the <span>Bayesian</span> restoration of images. <em>IEEE Transactions on Pattern Analysis and Machine Intelligence</em>, <em>PAMI-6</em>(6), 721–741. <a href="https://doi.org/10.1109/TPAMI.1984.4767596">https://doi.org/10.1109/TPAMI.1984.4767596</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, R. (2020a). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-blavaan2021" class="csl-entry">
Merkle, E. C., Fitzsimmons, E., Uanhoro, J., &amp; Goodrich, B. (2021). Efficient <span>Bayesian</span> structural equation modeling in <span>Stan</span>. <em>Journal of Statistical Software</em>, <em>100</em>(6), 1–22. <a href="https://doi.org/10.18637/jss.v100.i06">https://doi.org/10.18637/jss.v100.i06</a>
</div>
<div id="ref-Merkle2018blavaan" class="csl-entry">
Merkle, E. C., &amp; Rosseel, Y. (2018). <span class="nocase">blavaan</span>: <span>Bayesian</span> structural equation models via parameter expansion. <em>Journal of Statistical Software</em>, <em>85</em>(4), 1–30. <a href="https://doi.org/10.18637/jss.v085.i04">https://doi.org/10.18637/jss.v085.i04</a>
</div>
<div id="ref-R-blavaan" class="csl-entry">
Merkle, E. C., Rosseel, Y., &amp; Goodrich, B. (2022). <em><span class="nocase">blavaan</span>: <span>Bayesian</span> latent variable analysis</em>. <a href="https://CRAN.R-project.org/package=blavaan">https://CRAN.R-project.org/package=blavaan</a>
</div>
<div id="ref-plummerJAGSProgramAnalysis2003" class="csl-entry">
Plummer, M. (2003). <span>JAGS</span>: <span>A</span> program for analysis of <span>Bayesian</span> graphical models using <span>Gibbs</span> sampling. <em>Working Papers</em>, 8. <a href="http://www.ci.tuwien.ac.at/Conferences/DSC-2003/Drafts/Plummer.pdf">http://www.ci.tuwien.ac.at/Conferences/DSC-2003/Drafts/Plummer.pdf</a>
</div>
<div id="ref-robertShortHistoryMarkov2011" class="csl-entry">
Robert, C., &amp; Casella, G. (2011). A short history of <span>Markov</span> chain <span>Monte Carlo</span>: <span>Subjective</span> recollections from incomplete data. <em>Statistical Science</em>, <em>26</em>(1), 102–115. <a href="https://arxiv.org/pdf/0808.2902.pdf">https://arxiv.org/pdf/0808.2902.pdf</a>
</div>
<div id="ref-bugs2003UM" class="csl-entry">
Spiegelhalter, D., Thomas, A., Best, N., &amp; Lunn, D. (2003). <em><span>WinBUGS</span> user manual</em>. <a href="https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/manual14.pdf">https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/manual14.pdf</a>
</div>
<div id="ref-vehtariRanknormalizationFoldingLocalization2019" class="csl-entry">
Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner, P.-C. (2019). <em>Rank-normalization, folding, and localization: <span>An</span> improved <span><span class="math inline">\(\widehat{R}\)</span></span> for assessing convergence of <span>MCMC</span></em>. <a href="https://arxiv.org/abs/1903.08008?">https://arxiv.org/abs/1903.08008?</a>
</div>
<div id="ref-Weber2022WithinChainParallelization" class="csl-entry">
Weber, S., &amp; Bürkner, P.-C. (2022). <em>Running brms models with within-chain parallelization</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_threading.html">https://CRAN.R-project.org/package=brms/vignettes/brms_threading.html</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="conditional-manatees.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big-entropy-and-the-generalized-linear-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
