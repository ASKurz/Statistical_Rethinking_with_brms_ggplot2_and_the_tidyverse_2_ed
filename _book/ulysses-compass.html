<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-11-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-haunted-dag-the-causal-terror.html"/>
<link rel="next" href="conditional-manatees.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression."><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression.</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#summary-bonus-we-can-model-categorical-variables-in-more-ways-than-one"><i class="fa fa-check"></i><b>5.4</b> <del>Summary</del> Bonus: We can model categorical variables in more ways than one</a><ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#you-can-use-a-dummy."><i class="fa fa-check"></i><b>5.4.1</b> You can use a dummy.</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#consider-contrast-coding."><i class="fa fa-check"></i><b>5.4.2</b> Consider contrast coding.</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#theres-always-the-multilevel-anova-approach."><i class="fa fa-check"></i><b>5.4.3</b> There’s always the multilevel ANOVA approach.</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#would-you-like-to-learn-more"><i class="fa fa-check"></i><b>5.4.4</b> Would you like to learn more?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#another-parable."><i class="fa fa-check"></i><b>9.3.1</b> Another parable.</a></li>
<li class="chapter" data-level="9.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#particles-in-space."><i class="fa fa-check"></i><b>9.3.2</b> Particles in space.</a></li>
<li class="chapter" data-level="9.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.3</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to outcomes.</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.2</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#bonus-survival-analysis"><i class="fa fa-check"></i><b>11.5</b> Bonus: Survival analysis</a><ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#survival-summary."><i class="fa fa-check"></i><b>11.5.1</b> Survival summary.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a><ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a><ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a><ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a><ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a><ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a><ul>
<li class="chapter" data-level="15.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>15.1</b> Measurement error</a><ul>
<li class="chapter" data-level="15.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>15.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="15.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>15.1.2</b> Error on both outcome and predictor.</a></li>
<li class="chapter" data-level="15.1.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-terrors."><i class="fa fa-check"></i><b>15.1.3</b> Measurement terrors.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>15.2</b> Missing data</a><ul>
<li class="chapter" data-level="15.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#dag-ate-my-homework."><i class="fa fa-check"></i><b>15.2.1</b> DAG ate my homework.</a></li>
<li class="chapter" data-level="15.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-primates."><i class="fa fa-check"></i><b>15.2.2</b> Imputing primates.</a></li>
<li class="chapter" data-level="15.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#where-is-your-god-now"><i class="fa fa-check"></i><b>15.2.3</b> Where is your god now?</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>15.3</b> Categorical errors and discrete absences</a><ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#discrete-cats."><i class="fa fa-check"></i><b>15.3.1</b> Discrete cats.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-bayesian-meta-analysis-with-odds-ratios"><i class="fa fa-check"></i><b>15.5</b> Bonus: Bayesian meta-analysis with odds ratios</a><ul>
<li class="chapter" data-level="15.5.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#how-do-meta-analyses-fit-into-the-picture"><i class="fa fa-check"></i><b>15.5.1</b> How do meta-analyses fit into the picture?</a></li>
<li class="chapter" data-level="15.5.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#we-need-some-data."><i class="fa fa-check"></i><b>15.5.2</b> We need some data.</a></li>
<li class="chapter" data-level="15.5.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#our-effect-size-will-be-an-odds-ratio."><i class="fa fa-check"></i><b>15.5.3</b> Our effect size will be an odds ratio.</a></li>
<li class="chapter" data-level="15.5.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#log-odds-odds-ratios-and-modeling-effect-sizes."><i class="fa fa-check"></i><b>15.5.4</b> Log-odds, odds ratios, and modeling effect sizes.</a></li>
<li class="chapter" data-level="15.5.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#compute-the-study-specific-effect-sizes."><i class="fa fa-check"></i><b>15.5.5</b> Compute the study-specific effect sizes.</a></li>
<li class="chapter" data-level="15.5.6" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-meta-analysis."><i class="fa fa-check"></i><b>15.5.6</b> Fit the Bayesian meta-analysis.</a></li>
<li class="chapter" data-level="15.5.7" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-muiltilevel-alternative."><i class="fa fa-check"></i><b>15.5.7</b> Fit the Bayesian muiltilevel alternative.</a></li>
<li class="chapter" data-level="15.5.8" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#parting-thoughts."><i class="fa fa-check"></i><b>15.5.8</b> Parting thoughts.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a><ul>
<li class="chapter" data-level="16.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#geometric-people"><i class="fa fa-check"></i><b>16.1</b> Geometric people</a><ul>
<li class="chapter" data-level="16.1.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model."><i class="fa fa-check"></i><b>16.1.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.1.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model."><i class="fa fa-check"></i><b>16.1.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.1.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#glm-in-disguise."><i class="fa fa-check"></i><b>16.1.3</b> GLM in disguise.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>16.2</b> Hidden minds and observed behavior</a><ul>
<li class="chapter" data-level="16.2.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-1"><i class="fa fa-check"></i><b>16.2.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.2.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-1"><i class="fa fa-check"></i><b>16.2.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.2.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#coding-the-statistical-model."><i class="fa fa-check"></i><b>16.2.3</b> Coding the statistical model.</a></li>
<li class="chapter" data-level="16.2.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#state-space-models."><i class="fa fa-check"></i><b>16.2.4</b> State space models.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>16.3</b> Ordinary differential nut cracking</a><ul>
<li class="chapter" data-level="16.3.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#scientific-model."><i class="fa fa-check"></i><b>16.3.1</b> Scientific model.</a></li>
<li class="chapter" data-level="16.3.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#statistical-model."><i class="fa fa-check"></i><b>16.3.2</b> Statistical model.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#population-dynamics"><i class="fa fa-check"></i><b>16.4</b> Population dynamics</a><ul>
<li class="chapter" data-level="16.4.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-2"><i class="fa fa-check"></i><b>16.4.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.4.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-2"><i class="fa fa-check"></i><b>16.4.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.4.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#lynx-lessons-bonus-practice-with-the-autoregressive-model."><i class="fa fa-check"></i><b>16.4.3</b> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>17</b> <del>Horoscopes</del> Insights</a><ul>
<li class="chapter" data-level="17.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>17.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="17.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>17.2</b> Save your model fits</a></li>
<li class="chapter" data-level="17.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>17.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="17.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>17.4</b> Look at your data</a></li>
<li class="chapter" data-level="17.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#consider-using-the-0-intercept-syntax"><i class="fa fa-check"></i><b>17.5</b> Consider using the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="17.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>17.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="17.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>17.7</b> Annotate your code</a></li>
<li class="chapter" data-level="17.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>17.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="17.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>17.9</b> Code in public</a></li>
<li class="chapter" data-level="17.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-social-media"><i class="fa fa-check"></i><b>17.10</b> Check out social media</a></li>
<li class="chapter" data-level="17.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>17.11</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ulysses-compass" class="section level1">
<h1><span class="header-section-number">7</span> Ulysses’ Compass</h1>
<p>In this chapter we contend with two contrasting kinds of statistical error:</p>
<ul>
<li>overfitting, “which leads to poor prediction by learning too <em>much</em> from the data”</li>
<li>underfitting, “which leads to poor prediction by learning too <em>little</em> from the data” <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">b</a>, p. 192, <em>emphasis</em> added)</span></li>
</ul>
<blockquote>
<p>Our job is to carefully navigate among these monsters. There are two common families of approaches. The first approach is to use a <strong>regularizing prior</strong> to tell the model not to get too excited by the data. This is the same device that non-Bayesian methods refer to as “penalized likelihood.” The second approach is to use some scoring device, like <strong>information criteria</strong> or <strong>cross-validation</strong>, to model the prediction task and estimate predictive accuracy. Both families of approaches are routinely used in the natural and social sciences. Furthermore, they can be–maybe should be–used in combination. So it’s worth understanding both, as you’re going to need both at some point. (p. 192, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>There’s a lot going on in this chapter. More more practice with these ideas, check out <span class="citation">Yarkoni &amp; Westfall (<a href="#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6603289/"><em>Choosing prediction over explanation in psychology: Lessons from machine learning</em></a>.</p>
<div id="rethinking-stargazing." class="section level4">
<h4><span class="header-section-number">7.0.0.1</span> Rethinking stargazing.</h4>
<blockquote>
<p>The most common form of model selection among practicing scientists is to search for a model in which every coefficient is statistically significant. Statisticians sometimes call this <strong>stargazing</strong>, as it is embodied by scanning for asterisks (<span class="math inline">\(^{\star \star}\)</span>) trailing after estimates….</p>
<p>Whatever you think about null hypothesis significance testing in general, using it to select among structurally different models is a mistake–<span class="math inline">\(p\)</span>-values are not designed to help you navigate between underfitting and overfitting. (p. 193, <strong>emphasis</strong> in the original).</p>
</blockquote>
<p>McElreath spent little time discussing <span class="math inline">\(p\)</span>-values and null hypothesis testing in the text. If you’d like to learn more from a Bayesian perspective, you might check out the first several chapters (particularly 10–13) in Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">text</a> and my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">2020</a><a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">c</a>)</span> <a href="https://bookdown.org/content/3686/">ebook translating it to <strong>brms</strong> and the tidyverse</a>. The great <a href="https://twitter.com/f2harrell">Frank Harrell</a> has complied <a href="https://www.fharrell.com/post/pval-litany/"><em>A Litany of Problems With p-values</em></a>.
Also, don’t miss the statement on <span class="math inline">\(p\)</span>-values released by the <a href="https://www.amstat.org/">American Statistical Association</a> <span class="citation">(Wasserstein &amp; Lazar, <a href="#ref-wassersteinASAStatementPvalues2016" role="doc-biblioref">2016</a>)</span>.</p>
</div>
<div id="the-problem-with-parameters" class="section level2">
<h2><span class="header-section-number">7.1</span> The problem with parameters</h2>
<p>The <span class="math inline">\(R^2\)</span> is a popular way to measure how well you can retrodict the data. It traditionally follows the form</p>
<p><span class="math display">\[R^2 = \frac{\text{var(outcome)} - \text{var(residuals)}}{\text{var(outcome)}} = 1 - \frac{\text{var(residuals)}}{\text{var(outcome)}}.\]</span></p>
<p>By <span class="math inline">\(\operatorname{var}()\)</span>, of course, we meant variance (i.e., what you get from the <code>var()</code> function in <strong>R</strong>). McElreath is not a fan of the <span class="math inline">\(R^2\)</span>. But it’s important in my field, so instead of a summary at the end of the chapter, we will cover the Bayesian version of <span class="math inline">\(R^2\)</span> and how to use it in <strong>brms</strong>.</p>
<div id="more-parameters-almost-always-improve-fit." class="section level3">
<h3><span class="header-section-number">7.1.1</span> More parameters (almost) always improve fit.</h3>
<p>We’ll start off by making the data with brain size and body size for seven <code>species</code>.</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="ulysses-compass.html#cb751-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb751-2"><a href="ulysses-compass.html#cb751-2"></a></span>
<span id="cb751-3"><a href="ulysses-compass.html#cb751-3"></a>(</span>
<span id="cb751-4"><a href="ulysses-compass.html#cb751-4"></a>  d &lt;-<span class="st"> </span></span>
<span id="cb751-5"><a href="ulysses-compass.html#cb751-5"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">species =</span> <span class="kw">c</span>(<span class="st">&quot;afarensis&quot;</span>, <span class="st">&quot;africanus&quot;</span>, <span class="st">&quot;habilis&quot;</span>, <span class="st">&quot;boisei&quot;</span>, <span class="st">&quot;rudolfensis&quot;</span>, <span class="st">&quot;ergaster&quot;</span>, <span class="st">&quot;sapiens&quot;</span>), </span>
<span id="cb751-6"><a href="ulysses-compass.html#cb751-6"></a>         <span class="dt">brain   =</span> <span class="kw">c</span>(<span class="dv">438</span>, <span class="dv">452</span>, <span class="dv">612</span>, <span class="dv">521</span>, <span class="dv">752</span>, <span class="dv">871</span>, <span class="dv">1350</span>), </span>
<span id="cb751-7"><a href="ulysses-compass.html#cb751-7"></a>         <span class="dt">mass    =</span> <span class="kw">c</span>(<span class="fl">37.0</span>, <span class="fl">35.5</span>, <span class="fl">34.5</span>, <span class="fl">41.5</span>, <span class="fl">55.5</span>, <span class="fl">61.0</span>, <span class="fl">53.5</span>))</span>
<span id="cb751-8"><a href="ulysses-compass.html#cb751-8"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   species     brain  mass
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 afarensis     438  37  
## 2 africanus     452  35.5
## 3 habilis       612  34.5
## 4 boisei        521  41.5
## 5 rudolfensis   752  55.5
## 6 ergaster      871  61  
## 7 sapiens      1350  53.5</code></pre>
<p>Let’s get ready for Figure 7.2. The plots in this chapter will be characterized by <code>theme_classic() + theme(text = element_text(family = "Courier"))</code>. Our color palette will come from the <a href="https://CRAN.R-project.org/package=rcartocolor"><strong>rcartocolor</strong> package</a> <span class="citation">(Nowosad, <a href="#ref-R-rcartocolor" role="doc-biblioref">2019</a>)</span>, which provides color schemes <a href="https://carto.com/carto-colors/">designed by ‘CARTO’</a>.</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="ulysses-compass.html#cb753-1"></a><span class="co"># install.packages(&quot;rcartocolor&quot;, dependencies = T)</span></span>
<span id="cb753-2"><a href="ulysses-compass.html#cb753-2"></a><span class="kw">library</span>(rcartocolor)</span></code></pre></div>
<p>The specific palette we’ll be using is “BurgYl.” In addition to palettes, the <strong>rcartocolor</strong> package offers a few convenience functions which make it easier to use their palettes. The <code>carto_pal()</code> function will return the HEX numbers associated with a given palette’s colors and the <code>display_carto_pal()</code> function will display the actual colors.</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="ulysses-compass.html#cb754-1"></a><span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#fbe6c5&quot; &quot;#f5ba98&quot; &quot;#ee8a82&quot; &quot;#dc7176&quot; &quot;#c8586c&quot; &quot;#9c3f5d&quot; &quot;#70284a&quot;</code></pre>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="ulysses-compass.html#cb756-1"></a><span class="kw">display_carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We’ll be using a diluted version of the third color for the panel background (i.e., <code>theme(panel.background = element_rect(fill = alpha(carto_pal(7, "BurgYl")[3], 1/4)))</code>) and the darker purples for other plot elements. Here’s the plot.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="ulysses-compass.html#cb757-1"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb757-2"><a href="ulysses-compass.html#cb757-2"></a></span>
<span id="cb757-3"><a href="ulysses-compass.html#cb757-3"></a><span class="kw">theme_set</span>(</span>
<span id="cb757-4"><a href="ulysses-compass.html#cb757-4"></a>  <span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb757-5"><a href="ulysses-compass.html#cb757-5"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Courier&quot;</span>),</span>
<span id="cb757-6"><a href="ulysses-compass.html#cb757-6"></a>          <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">3</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)))</span>
<span id="cb757-7"><a href="ulysses-compass.html#cb757-7"></a>)</span>
<span id="cb757-8"><a href="ulysses-compass.html#cb757-8"></a></span>
<span id="cb757-9"><a href="ulysses-compass.html#cb757-9"></a>d <span class="op">%&gt;%</span></span>
<span id="cb757-10"><a href="ulysses-compass.html#cb757-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span>  mass, <span class="dt">y =</span> brain, <span class="dt">label =</span> species)) <span class="op">+</span></span>
<span id="cb757-11"><a href="ulysses-compass.html#cb757-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>]) <span class="op">+</span></span>
<span id="cb757-12"><a href="ulysses-compass.html#cb757-12"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="dt">seed =</span> <span class="dv">438</span>) <span class="op">+</span></span>
<span id="cb757-13"><a href="ulysses-compass.html#cb757-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Average brain volume by body</span><span class="ch">\n</span><span class="st">mass for six hominin species&quot;</span>,</span>
<span id="cb757-14"><a href="ulysses-compass.html#cb757-14"></a>       <span class="dt">x =</span> <span class="st">&quot;body mass (kg)&quot;</span>,</span>
<span id="cb757-15"><a href="ulysses-compass.html#cb757-15"></a>       <span class="dt">y =</span> <span class="st">&quot;brain volume (cc)&quot;</span>) <span class="op">+</span></span>
<span id="cb757-16"><a href="ulysses-compass.html#cb757-16"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">30</span>, <span class="dv">65</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-5-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Before fitting our models,</p>
<blockquote>
<p>we want to standardize body mass–give it mean zero and standard deviation one–and rescale the outcome, brain volume, so that the largest observed value is 1. Why not standardize brain volume as well? Because we want to preserve zero as a reference point: No brain at all. You can’t have negative brain. I don’t think. (p. 195)</p>
</blockquote>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="ulysses-compass.html#cb758-1"></a>d &lt;-</span>
<span id="cb758-2"><a href="ulysses-compass.html#cb758-2"></a><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb758-3"><a href="ulysses-compass.html#cb758-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_std  =</span> (mass <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mass)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(mass),</span>
<span id="cb758-4"><a href="ulysses-compass.html#cb758-4"></a>         <span class="dt">brain_std =</span> brain <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(brain))</span></code></pre></div>
<p>Our first statistical model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{brain_std}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i              &amp; = \alpha + \beta \text{mass_std}_i \\
\alpha             &amp; \sim \operatorname{Normal}(0.5, 1) \\
\beta              &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma             &amp; \sim \operatorname{Log-Normal}(0, 1).
\end{align*}\]</span></p>
<blockquote>
<p>This simply says that the average brain volume <span class="math inline">\(b_i\)</span> of species <span class="math inline">\(i\)</span> is a linear function of its body mass <span class="math inline">\(m_i\)</span>. Now consider what the priors imply. The prior for <span class="math inline">\(\alpha\)</span> is just centered on the mean brain volume (rescaled) in the data. So it says that the average species with an average body mass has a brain volume with an 89% credible interval from about −1 to 2. That is ridiculously wide and includes impossible (negative) values. The prior for <span class="math inline">\(\beta\)</span> is very flat and centered on zero. It allows for absurdly large positive and negative relationships. These priors allow for absurd inferences, especially as the model gets more complex. And that’s part of the lesson. (p. 196)</p>
</blockquote>
<p>Instead of jumping into <strong>brms</strong>, we’re going to practice fitting these initial models with <strong>rethinking</strong>. <strong>brms</strong> does fine with the first five models (<code>m7.1</code> through <code>m7.5</code>), but has major issues with the sixth-order polynomial model, <code>m7.6</code>. Given that I <del>suspect</del> hope you would not want to fit such a model for a real-world application, it’s not worth the effort to try to fight <strong>brms</strong> to make it work. However, if any of my readers are actually able to get <code>m7.6</code> to work with <strong>brms</strong>, I’d be grateful if you <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">shared your code on GitHub</a>.</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="ulysses-compass.html#cb759-1"></a><span class="kw">library</span>(rethinking)</span>
<span id="cb759-2"><a href="ulysses-compass.html#cb759-2"></a></span>
<span id="cb759-3"><a href="ulysses-compass.html#cb759-3"></a>m7<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb759-4"><a href="ulysses-compass.html#cb759-4"></a>  <span class="kw">alist</span>(</span>
<span id="cb759-5"><a href="ulysses-compass.html#cb759-5"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="kw">exp</span>(log_sigma)), </span>
<span id="cb759-6"><a href="ulysses-compass.html#cb759-6"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>mass_std,</span>
<span id="cb759-7"><a href="ulysses-compass.html#cb759-7"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb759-8"><a href="ulysses-compass.html#cb759-8"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb759-9"><a href="ulysses-compass.html#cb759-9"></a>    log_sigma <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb759-10"><a href="ulysses-compass.html#cb759-10"></a>  ), </span>
<span id="cb759-11"><a href="ulysses-compass.html#cb759-11"></a>  <span class="dt">data =</span> d)</span></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="ulysses-compass.html#cb760-1"></a><span class="kw">precis</span>(m7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##                 mean         sd       5.5%      94.5%
## a          0.5285430 0.06842565  0.4191856  0.6379004
## b          0.1671092 0.07407970  0.0487155  0.2855028
## log_sigma -1.7067065 0.29378011 -2.1762239 -1.2371892</code></pre>
<p>Although <strong>rethinking</strong> does not contain a convenience function for computing the <span class="math inline">\(R^2\)</span> directly, McElreath showed us how to make a function for that purpose ourselves. Because part of his <code>R2_is_bad()</code> function contains the <code>rethinking:sim()</code> function, I’m going to add a <code>seed</code> argument to make the results more reproducible.</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="ulysses-compass.html#cb762-1"></a>R2_is_bad &lt;-<span class="st"> </span><span class="cf">function</span>(quap_fit, <span class="dt">seed =</span> <span class="dv">7</span>, ...) {</span>
<span id="cb762-2"><a href="ulysses-compass.html#cb762-2"></a>  <span class="kw">set.seed</span>(seed)</span>
<span id="cb762-3"><a href="ulysses-compass.html#cb762-3"></a>  s &lt;-<span class="st"> </span><span class="kw">sim</span>(quap_fit, <span class="dt">refresh =</span> <span class="dv">0</span>, ...)</span>
<span id="cb762-4"><a href="ulysses-compass.html#cb762-4"></a>  r &lt;-<span class="st"> </span><span class="kw">apply</span>(s, <span class="dv">2</span>, mean) <span class="op">-</span><span class="st"> </span>d<span class="op">$</span>brain_std</span>
<span id="cb762-5"><a href="ulysses-compass.html#cb762-5"></a>  <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">var2</span>(r) <span class="op">/</span><span class="st"> </span><span class="kw">var2</span>(d<span class="op">$</span>brain_std)</span>
<span id="cb762-6"><a href="ulysses-compass.html#cb762-6"></a>}</span></code></pre></div>
<p>Here’s the estimate for our <span class="math inline">\(R^2\)</span>.</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="ulysses-compass.html#cb763-1"></a><span class="kw">R2_is_bad</span>(m7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## [1] 0.4616474</code></pre>
<p>Do note that,</p>
<blockquote>
<p>in principle, the Bayesian approach mandates that we do this for each sample from the posterior. But <span class="math inline">\(R^2\)</span> is traditionally computed only at the mean prediction. So we’ll do that as well here. Later in the chapter you’ll learn a properly Bayesian score that uses the entire posterior distribution. (p. 197)</p>
</blockquote>
<p>Now fit the quadratic through sixth-order polynomial models.</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="ulysses-compass.html#cb765-1"></a><span class="co"># quadratic</span></span>
<span id="cb765-2"><a href="ulysses-compass.html#cb765-2"></a>m7<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb765-3"><a href="ulysses-compass.html#cb765-3"></a>  <span class="kw">alist</span>(</span>
<span id="cb765-4"><a href="ulysses-compass.html#cb765-4"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="kw">exp</span>(log_sigma)), </span>
<span id="cb765-5"><a href="ulysses-compass.html#cb765-5"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>mass_std <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">2</span>,</span>
<span id="cb765-6"><a href="ulysses-compass.html#cb765-6"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb765-7"><a href="ulysses-compass.html#cb765-7"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb765-8"><a href="ulysses-compass.html#cb765-8"></a>    log_sigma <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb765-9"><a href="ulysses-compass.html#cb765-9"></a>  ), </span>
<span id="cb765-10"><a href="ulysses-compass.html#cb765-10"></a>  <span class="dt">data =</span> d, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)))</span>
<span id="cb765-11"><a href="ulysses-compass.html#cb765-11"></a></span>
<span id="cb765-12"><a href="ulysses-compass.html#cb765-12"></a><span class="co"># cubic</span></span>
<span id="cb765-13"><a href="ulysses-compass.html#cb765-13"></a>m7<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb765-14"><a href="ulysses-compass.html#cb765-14"></a>  <span class="kw">alist</span>(</span>
<span id="cb765-15"><a href="ulysses-compass.html#cb765-15"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="kw">exp</span>(log_sigma)), </span>
<span id="cb765-16"><a href="ulysses-compass.html#cb765-16"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>mass_std <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">3</span>,</span>
<span id="cb765-17"><a href="ulysses-compass.html#cb765-17"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb765-18"><a href="ulysses-compass.html#cb765-18"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb765-19"><a href="ulysses-compass.html#cb765-19"></a>    log_sigma <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb765-20"><a href="ulysses-compass.html#cb765-20"></a>  ), </span>
<span id="cb765-21"><a href="ulysses-compass.html#cb765-21"></a>  <span class="dt">data =</span> d, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)))</span>
<span id="cb765-22"><a href="ulysses-compass.html#cb765-22"></a></span>
<span id="cb765-23"><a href="ulysses-compass.html#cb765-23"></a><span class="co"># fourth-order</span></span>
<span id="cb765-24"><a href="ulysses-compass.html#cb765-24"></a>m7<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb765-25"><a href="ulysses-compass.html#cb765-25"></a>  <span class="kw">alist</span>(</span>
<span id="cb765-26"><a href="ulysses-compass.html#cb765-26"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="kw">exp</span>(log_sigma)), </span>
<span id="cb765-27"><a href="ulysses-compass.html#cb765-27"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>mass_std <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">4</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">4</span>,</span>
<span id="cb765-28"><a href="ulysses-compass.html#cb765-28"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb765-29"><a href="ulysses-compass.html#cb765-29"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb765-30"><a href="ulysses-compass.html#cb765-30"></a>    log_sigma <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb765-31"><a href="ulysses-compass.html#cb765-31"></a>  ), </span>
<span id="cb765-32"><a href="ulysses-compass.html#cb765-32"></a>  <span class="dt">data =</span> d, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>)))</span>
<span id="cb765-33"><a href="ulysses-compass.html#cb765-33"></a></span>
<span id="cb765-34"><a href="ulysses-compass.html#cb765-34"></a><span class="co"># fifth-order</span></span>
<span id="cb765-35"><a href="ulysses-compass.html#cb765-35"></a>m7<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb765-36"><a href="ulysses-compass.html#cb765-36"></a>  <span class="kw">alist</span>(</span>
<span id="cb765-37"><a href="ulysses-compass.html#cb765-37"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="kw">exp</span>(log_sigma)), </span>
<span id="cb765-38"><a href="ulysses-compass.html#cb765-38"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>mass_std <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">4</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">4</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">5</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">5</span>,</span>
<span id="cb765-39"><a href="ulysses-compass.html#cb765-39"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb765-40"><a href="ulysses-compass.html#cb765-40"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb765-41"><a href="ulysses-compass.html#cb765-41"></a>    log_sigma <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb765-42"><a href="ulysses-compass.html#cb765-42"></a>  ), </span>
<span id="cb765-43"><a href="ulysses-compass.html#cb765-43"></a>  <span class="dt">data =</span> d, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>)))</span>
<span id="cb765-44"><a href="ulysses-compass.html#cb765-44"></a></span>
<span id="cb765-45"><a href="ulysses-compass.html#cb765-45"></a><span class="co"># sixth-order</span></span>
<span id="cb765-46"><a href="ulysses-compass.html#cb765-46"></a>m7<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </span>
<span id="cb765-47"><a href="ulysses-compass.html#cb765-47"></a>  <span class="kw">alist</span>(</span>
<span id="cb765-48"><a href="ulysses-compass.html#cb765-48"></a>    brain_std <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="fl">0.001</span>), </span>
<span id="cb765-49"><a href="ulysses-compass.html#cb765-49"></a>    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>mass_std <span class="op">+</span><span class="st"> </span>b[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">4</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">4</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">5</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span>b[<span class="dv">6</span>] <span class="op">*</span><span class="st"> </span>mass_std<span class="op">^</span><span class="dv">6</span>,</span>
<span id="cb765-50"><a href="ulysses-compass.html#cb765-50"></a>    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb765-51"><a href="ulysses-compass.html#cb765-51"></a>    b <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb765-52"><a href="ulysses-compass.html#cb765-52"></a>  ), </span>
<span id="cb765-53"><a href="ulysses-compass.html#cb765-53"></a>  <span class="dt">data =</span> d, <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">6</span>)))</span></code></pre></div>
<p>Here’s how we might plot the result for the first model, <code>m7.1</code>.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="ulysses-compass.html#cb766-1"></a><span class="kw">library</span>(tidybayes)</span>
<span id="cb766-2"><a href="ulysses-compass.html#cb766-2"></a></span>
<span id="cb766-3"><a href="ulysses-compass.html#cb766-3"></a>mass_seq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">100</span>) </span>
<span id="cb766-4"><a href="ulysses-compass.html#cb766-4"></a></span>
<span id="cb766-5"><a href="ulysses-compass.html#cb766-5"></a><span class="kw">link</span>(m7<span class="fl">.1</span>, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">mass_std =</span> mass_seq)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-6"><a href="ulysses-compass.html#cb766-6"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-7"><a href="ulysses-compass.html#cb766-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-8"><a href="ulysses-compass.html#cb766-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_std =</span> <span class="kw">rep</span>(mass_seq, <span class="dt">times =</span> <span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-9"><a href="ulysses-compass.html#cb766-9"></a><span class="st">  </span><span class="kw">group_by</span>(mass_std) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-10"><a href="ulysses-compass.html#cb766-10"></a><span class="st">  </span><span class="kw">mean_qi</span>(value, <span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb766-11"><a href="ulysses-compass.html#cb766-11"></a><span class="st">  </span></span>
<span id="cb766-12"><a href="ulysses-compass.html#cb766-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_std, <span class="dt">y =</span> value)) <span class="op">+</span></span>
<span id="cb766-13"><a href="ulysses-compass.html#cb766-13"></a><span class="st">  </span><span class="kw">geom_lineribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper),</span>
<span id="cb766-14"><a href="ulysses-compass.html#cb766-14"></a>                  <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb766-15"><a href="ulysses-compass.html#cb766-15"></a>                  <span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)) <span class="op">+</span></span>
<span id="cb766-16"><a href="ulysses-compass.html#cb766-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d,</span>
<span id="cb766-17"><a href="ulysses-compass.html#cb766-17"></a>             <span class="kw">aes</span>(<span class="dt">y =</span> brain_std),</span>
<span id="cb766-18"><a href="ulysses-compass.html#cb766-18"></a>             <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb766-19"><a href="ulysses-compass.html#cb766-19"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">bquote</span>(<span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span><span class="op">==</span>.(<span class="kw">round</span>(<span class="kw">R2_is_bad</span>(m7<span class="fl">.1</span>), <span class="dt">digits =</span> <span class="dv">2</span>))),</span>
<span id="cb766-20"><a href="ulysses-compass.html#cb766-20"></a>       <span class="dt">x =</span> <span class="st">&quot;body mass (standardized)&quot;</span>,</span>
<span id="cb766-21"><a href="ulysses-compass.html#cb766-21"></a>       <span class="dt">y =</span> <span class="st">&quot;brain volume (standardized)&quot;</span>) <span class="op">+</span></span>
<span id="cb766-22"><a href="ulysses-compass.html#cb766-22"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>mass_std))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-11-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>To slightly repurpose a quote from McElreath:</p>
<blockquote>
<p>We’ll want to do this for the next several models, so let’s write a function to make it repeatable. If you find yourself writing code more than once, it is usually saner to write a function and call the function more than once instead. (p. 197)</p>
</blockquote>
<p>Our <code>make_figure7.3()</code> function will wrap the simulation, data wrangling, and plotting code all in one. It takes two arguments, the first of which defines which fit object we’d like to plot. If you look closely at Figure 7.3 in the text, you’ll notice that the range of the <span class="math inline">\(y\)</span>-axis changes in the last three plots. Our second argument, <code>ylim</code>, will allow us to vary those parameters across subplots.</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="ulysses-compass.html#cb767-1"></a>make_figure7<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="cf">function</span>(quap_fit, <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>brain_std)) {</span>
<span id="cb767-2"><a href="ulysses-compass.html#cb767-2"></a>  </span>
<span id="cb767-3"><a href="ulysses-compass.html#cb767-3"></a>  <span class="co"># compute the R2</span></span>
<span id="cb767-4"><a href="ulysses-compass.html#cb767-4"></a>  r2 &lt;-<span class="st"> </span><span class="kw">R2_is_bad</span>(quap_fit)</span>
<span id="cb767-5"><a href="ulysses-compass.html#cb767-5"></a>  </span>
<span id="cb767-6"><a href="ulysses-compass.html#cb767-6"></a>  <span class="co"># define the mass_seq </span></span>
<span id="cb767-7"><a href="ulysses-compass.html#cb767-7"></a>  mass_seq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">100</span>) </span>
<span id="cb767-8"><a href="ulysses-compass.html#cb767-8"></a>  </span>
<span id="cb767-9"><a href="ulysses-compass.html#cb767-9"></a>  <span class="co"># simulate and wrangle</span></span>
<span id="cb767-10"><a href="ulysses-compass.html#cb767-10"></a>  <span class="kw">link</span>(quap_fit, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">mass_std =</span> mass_seq)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-11"><a href="ulysses-compass.html#cb767-11"></a><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-12"><a href="ulysses-compass.html#cb767-12"></a><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-13"><a href="ulysses-compass.html#cb767-13"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mass_std =</span> <span class="kw">rep</span>(mass_seq, <span class="dt">times =</span> <span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-14"><a href="ulysses-compass.html#cb767-14"></a><span class="st">    </span><span class="kw">group_by</span>(mass_std) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-15"><a href="ulysses-compass.html#cb767-15"></a><span class="st">    </span><span class="kw">mean_qi</span>(value, <span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb767-16"><a href="ulysses-compass.html#cb767-16"></a><span class="st">    </span></span>
<span id="cb767-17"><a href="ulysses-compass.html#cb767-17"></a><span class="st">    </span><span class="co"># plot!  </span></span>
<span id="cb767-18"><a href="ulysses-compass.html#cb767-18"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_std, <span class="dt">y =</span> value)) <span class="op">+</span></span>
<span id="cb767-19"><a href="ulysses-compass.html#cb767-19"></a><span class="st">    </span><span class="kw">geom_lineribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper),</span>
<span id="cb767-20"><a href="ulysses-compass.html#cb767-20"></a>                    <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb767-21"><a href="ulysses-compass.html#cb767-21"></a>                    <span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)) <span class="op">+</span></span>
<span id="cb767-22"><a href="ulysses-compass.html#cb767-22"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d,</span>
<span id="cb767-23"><a href="ulysses-compass.html#cb767-23"></a>               <span class="kw">aes</span>(<span class="dt">y =</span> brain_std),</span>
<span id="cb767-24"><a href="ulysses-compass.html#cb767-24"></a>               <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb767-25"><a href="ulysses-compass.html#cb767-25"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">bquote</span>(<span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span><span class="op">==</span>.(<span class="kw">round</span>(r2, <span class="dt">digits =</span> <span class="dv">2</span>))),</span>
<span id="cb767-26"><a href="ulysses-compass.html#cb767-26"></a>         <span class="dt">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb767-27"><a href="ulysses-compass.html#cb767-27"></a>         <span class="dt">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="op">+</span></span>
<span id="cb767-28"><a href="ulysses-compass.html#cb767-28"></a><span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1.5</span>),</span>
<span id="cb767-29"><a href="ulysses-compass.html#cb767-29"></a>                    <span class="dt">ylim =</span> ylim)</span>
<span id="cb767-30"><a href="ulysses-compass.html#cb767-30"></a>}</span></code></pre></div>
<p>Here we make and save the six subplots in bulk.</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="ulysses-compass.html#cb768-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.1</span>)</span>
<span id="cb768-2"><a href="ulysses-compass.html#cb768-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.2</span>)</span>
<span id="cb768-3"><a href="ulysses-compass.html#cb768-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.3</span>)</span>
<span id="cb768-4"><a href="ulysses-compass.html#cb768-4"></a>p4 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.4</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">1.1</span>))</span>
<span id="cb768-5"><a href="ulysses-compass.html#cb768-5"></a>p5 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.5</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">1.4</span>))</span>
<span id="cb768-6"><a href="ulysses-compass.html#cb768-6"></a>p6 &lt;-<span class="st"> </span><span class="kw">make_figure7.3</span>(m7<span class="fl">.6</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="fl">1.5</span>)) <span class="op">+</span></span>
<span id="cb768-7"><a href="ulysses-compass.html#cb768-7"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="dt">linetype =</span> <span class="dv">2</span>) </span></code></pre></div>
<p>Now use <strong>patchwork</strong> syntax to bundle them all together.</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="ulysses-compass.html#cb769-1"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb769-2"><a href="ulysses-compass.html#cb769-2"></a></span>
<span id="cb769-3"><a href="ulysses-compass.html#cb769-3"></a>((p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">/</span><span class="st"> </span>(p3 <span class="op">|</span><span class="st"> </span>p4) <span class="op">/</span><span class="st"> </span>(p5 <span class="op">|</span><span class="st"> </span>p6)) <span class="op">+</span></span>
<span id="cb769-4"><a href="ulysses-compass.html#cb769-4"></a><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Figure7.3. Polynomial linear models of increasing</span><span class="ch">\n</span><span class="st">degree for the hominin data.&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If you really what the axes scaled in the original metrics of the variables rather than their standardized form, you can use the re-scaling techniques from back in <a href="geocentric-models.html#overthinking-converting-back-to-natural-scale.">Section 4.5.1.0.1</a>.</p>
<p>“This is a general phenomenon: If you adopt a model family with enough parameters, you can fit the data exactly. But such a model will make rather absurd predictions for yet-to-be-observed cases” (pp. 199–201).</p>
<div id="rethinking-model-fitting-as-compression." class="section level4">
<h4><span class="header-section-number">7.1.1.1</span> Rethinking: Model fitting as compression.</h4>
<blockquote>
<p>Another perspective on the absurd model just above is to consider that model fitting can be considered a form of <strong>data compression</strong>. Parameters summarize relationships among the data. These summaries compress the data into a simpler form, although with loss of information (“lossy” compression) about the sample. The parameters can then be used to generate new data, effectively decompressing the data. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
</div>
</div>
<div id="too-few-parameters-hurts-too." class="section level3">
<h3><span class="header-section-number">7.1.2</span> Too few parameters hurts, too.</h3>
<blockquote>
<p>The overfit polynomial models fit the data extremely well, but they suffer for this within-sample accuracy by making nonsensical out-of-sample predictions. In contrast, <strong>underfitting</strong> produces models that are inaccurate both within and out of sample. They learn too little, failing to recover regular features of the sample. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>To explore the distinctions between overfitting and underfitting, we’ll need to refit <code>m7.1</code> and <code>m7.4</code> several times after serially dropping one of the rows in the data. You can <code>filter()</code> by <code>row_number()</code> to drop rows in a <a href="https://dplyr.tidyverse.org/reference/slice.html"><strong>tidyverse</strong> kind of way</a>. For example, we can drop the second row of <code>d</code> like this.</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="ulysses-compass.html#cb770-1"></a> d <span class="op">%&gt;%</span></span>
<span id="cb770-2"><a href="ulysses-compass.html#cb770-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb770-3"><a href="ulysses-compass.html#cb770-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">!=</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   species     brain  mass mass_std brain_std   row
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
## 1 afarensis     438  37     -0.779     0.324     1
## 2 habilis       612  34.5   -1.01      0.453     3
## 3 boisei        521  41.5   -0.367     0.386     4
## 4 rudolfensis   752  55.5    0.917     0.557     5
## 5 ergaster      871  61      1.42      0.645     6
## 6 sapiens      1350  53.5    0.734     1         7</code></pre>
<p>In his <strong>Overthinking: Dropping rows</strong> box (p. 202), McElreath encouraged us to take a look at the <code>brain_loo_plot()</code> function to get a sense of how he made his Figure 7.4. Here it is.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="ulysses-compass.html#cb772-1"></a>brain_loo_plot</span></code></pre></div>
<pre><code>## function (fit, atx = c(35, 47, 60), aty = c(450, 900, 1300), 
##     xlim, ylim, npts = 100) 
## {
##     post &lt;- extract.samples(fit)
##     n &lt;- dim(post$b)[2]
##     if (is.null(n)) 
##         n &lt;- 1
##     if (missing(xlim)) 
##         xlim &lt;- range(d$mass_std)
##     else xlim &lt;- (xlim - mean(d$mass))/sd(d$mass)
##     if (missing(ylim)) 
##         ylim &lt;- range(d$brain_std)
##     else ylim &lt;- ylim/max(d$brain)
##     plot(d$brain_std ~ d$mass_std, xaxt = &quot;n&quot;, yaxt = &quot;n&quot;, xlab = &quot;body mass (kg)&quot;, 
##         ylab = &quot;brain volume (cc)&quot;, col = rangi2, pch = 16, xlim = xlim, 
##         ylim = ylim)
##     axis_unscale(1, atx, d$mass)
##     axis_unscale(2, at = aty, factor = max(d$brain))
##     d &lt;- as.data.frame(fit@data)
##     for (i in 1:nrow(d)) {
##         di &lt;- d[-i, ]
##         m_temp &lt;- quap(fit@formula, data = di, start = list(b = rep(0, 
##             n)))
##         xseq &lt;- seq(from = xlim[1] - 0.2, to = xlim[2] + 0.2, 
##             length.out = npts)
##         l &lt;- link(m_temp, data = list(mass_std = xseq), refresh = 0)
##         mu &lt;- apply(l, 2, mean)
##         lines(xseq, mu, lwd = 2, col = col.alpha(&quot;black&quot;, 0.3))
##     }
##     model_name &lt;- deparse(match.call()[[2]])
##     mtext(model_name, adj = 0)
## }
## &lt;bytecode: 0x7fa7ad384c48&gt;
## &lt;environment: namespace:rethinking&gt;</code></pre>
<p>Though we’ll be taking a slightly different route than the one outlined in McElreath’s <code>brain_loo_plot()</code> function, we can glean some great insights. For example, here’s a tricky way to update a <code>quap()</code> model.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="ulysses-compass.html#cb774-1"></a>m7.<span class="fl">1.1</span> &lt;-<span class="st"> </span><span class="kw">quap</span>(m7<span class="fl">.1</span><span class="op">@</span>formula,</span>
<span id="cb774-2"><a href="ulysses-compass.html#cb774-2"></a>               <span class="dt">data =</span> <span class="kw">filter</span>(d, <span class="kw">row_number</span>() <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb774-3"><a href="ulysses-compass.html#cb774-3"></a></span>
<span id="cb774-4"><a href="ulysses-compass.html#cb774-4"></a><span class="kw">precis</span>(m7.<span class="fl">1.1</span>)</span></code></pre></div>
<pre><code>##                 mean         sd        5.5%      94.5%
## a          0.5423856 0.08033785  0.41399022  0.6707810
## b          0.1544354 0.08500937  0.01857405  0.2902968
## log_sigma -1.6318773 0.32047814 -2.14406327 -1.1196914</code></pre>
<p>You can see by the <code>data</code> statement that <code>m7.1.1</code> is fit on the <code>d</code> data after dropping the first row. Here’s how we might amend out plotting strategy from before to visualize the posterior mean for the model-implied trajectory.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="ulysses-compass.html#cb776-1"></a><span class="kw">link</span>(m7.<span class="fl">1.1</span>, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">mass_std =</span> mass_seq)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-2"><a href="ulysses-compass.html#cb776-2"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-3"><a href="ulysses-compass.html#cb776-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-4"><a href="ulysses-compass.html#cb776-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_std =</span> <span class="kw">rep</span>(mass_seq, <span class="dt">times =</span> <span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-5"><a href="ulysses-compass.html#cb776-5"></a><span class="st">  </span><span class="kw">group_by</span>(mass_std) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-6"><a href="ulysses-compass.html#cb776-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb776-7"><a href="ulysses-compass.html#cb776-7"></a><span class="st">  </span></span>
<span id="cb776-8"><a href="ulysses-compass.html#cb776-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_std, <span class="dt">y =</span> mean)) <span class="op">+</span></span>
<span id="cb776-9"><a href="ulysses-compass.html#cb776-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb776-10"><a href="ulysses-compass.html#cb776-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d,</span>
<span id="cb776-11"><a href="ulysses-compass.html#cb776-11"></a>             <span class="kw">aes</span>(<span class="dt">y =</span> brain_std),</span>
<span id="cb776-12"><a href="ulysses-compass.html#cb776-12"></a>             <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb776-13"><a href="ulysses-compass.html#cb776-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;m7.1.1&quot;</span>,</span>
<span id="cb776-14"><a href="ulysses-compass.html#cb776-14"></a>       <span class="dt">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb776-15"><a href="ulysses-compass.html#cb776-15"></a>       <span class="dt">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="op">+</span></span>
<span id="cb776-16"><a href="ulysses-compass.html#cb776-16"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>mass_std),</span>
<span id="cb776-17"><a href="ulysses-compass.html#cb776-17"></a>                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>brain_std))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-18-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Now we can build off of those sensibilities to make an alternative to McElreath’s <code>brain_loo_plot</code>. Our <code>brain_loo_lines()</code> function will refit a model after dropping the row we define in the <code>row</code> argument. After fitting the model, it then extracts the fitted line over the previously-defined values of <code>mass_seq</code>.</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="ulysses-compass.html#cb777-1"></a>brain_loo_lines &lt;-<span class="st"> </span><span class="cf">function</span>(quap_fit, row) {</span>
<span id="cb777-2"><a href="ulysses-compass.html#cb777-2"></a>  </span>
<span id="cb777-3"><a href="ulysses-compass.html#cb777-3"></a>  <span class="co"># determine the order of the polynomial</span></span>
<span id="cb777-4"><a href="ulysses-compass.html#cb777-4"></a>  n &lt;-<span class="st"> </span><span class="kw">extract.samples</span>(quap_fit)<span class="op">$</span>b <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ncol</span>()</span>
<span id="cb777-5"><a href="ulysses-compass.html#cb777-5"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(n)) </span>
<span id="cb777-6"><a href="ulysses-compass.html#cb777-6"></a>    n &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb777-7"><a href="ulysses-compass.html#cb777-7"></a>  </span>
<span id="cb777-8"><a href="ulysses-compass.html#cb777-8"></a>  <span class="co"># refit the model</span></span>
<span id="cb777-9"><a href="ulysses-compass.html#cb777-9"></a>  fit &lt;-<span class="st"> </span><span class="kw">quap</span>(quap_fit<span class="op">@</span>formula,</span>
<span id="cb777-10"><a href="ulysses-compass.html#cb777-10"></a>              <span class="dt">data =</span> <span class="kw">filter</span>(d, <span class="kw">row_number</span>() <span class="op">!=</span><span class="st"> </span>row),</span>
<span id="cb777-11"><a href="ulysses-compass.html#cb777-11"></a>              <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dt">times =</span> n)))</span>
<span id="cb777-12"><a href="ulysses-compass.html#cb777-12"></a>  </span>
<span id="cb777-13"><a href="ulysses-compass.html#cb777-13"></a>  <span class="co"># pull the lines values</span></span>
<span id="cb777-14"><a href="ulysses-compass.html#cb777-14"></a>  <span class="kw">link</span>(fit, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">mass_std =</span> mass_seq)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb777-15"><a href="ulysses-compass.html#cb777-15"></a><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb777-16"><a href="ulysses-compass.html#cb777-16"></a><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb777-17"><a href="ulysses-compass.html#cb777-17"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mass_std =</span> <span class="kw">rep</span>(mass_seq, <span class="dt">times =</span> <span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb777-18"><a href="ulysses-compass.html#cb777-18"></a><span class="st">    </span><span class="kw">group_by</span>(mass_std) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb777-19"><a href="ulysses-compass.html#cb777-19"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value))</span>
<span id="cb777-20"><a href="ulysses-compass.html#cb777-20"></a>  </span>
<span id="cb777-21"><a href="ulysses-compass.html#cb777-21"></a>}</span></code></pre></div>
<p>Here’s how <code>brain_loo_lines()</code> works.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="ulysses-compass.html#cb778-1"></a><span class="kw">brain_loo_lines</span>(m7<span class="fl">.1</span>, <span class="dt">row =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb778-2"><a href="ulysses-compass.html#cb778-2"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 100
## Columns: 2
## $ mass_std &lt;dbl&gt; -2.0000000, -1.9595960, -1.9191919, -1.8787879, -1.8383838, -1.7979798, -1.75757…
## $ mean     &lt;dbl&gt; 0.2303865, 0.2366386, 0.2428908, 0.2491429, 0.2553951, 0.2616472, 0.2678994, 0.2…</code></pre>
<p>Working within the <strong>tidyverse</strong> paradigm, we’ll make a tibble with the predefined <code>row</code> values. We will then use <code>purrr::map()</code> to plug those <code>row</code> values into <code>brain_loo_lines()</code>, which will return the desired posterior <code>mean</code> values for each corresponding value of <code>mass_std</code>. Then we pump those values into <code>ggplot()</code> and customize the appearance of our plots from there.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="ulysses-compass.html#cb780-1"></a>p1 &lt;-</span>
<span id="cb780-2"><a href="ulysses-compass.html#cb780-2"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb780-3"><a href="ulysses-compass.html#cb780-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">post =</span> purrr<span class="op">::</span><span class="kw">map</span>(row, <span class="op">~</span><span class="kw">brain_loo_lines</span>(<span class="dt">quap_fit =</span> m7<span class="fl">.1</span>, <span class="dt">row =</span> .))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb780-4"><a href="ulysses-compass.html#cb780-4"></a><span class="st">  </span><span class="kw">unnest</span>(post) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb780-5"><a href="ulysses-compass.html#cb780-5"></a><span class="st">  </span></span>
<span id="cb780-6"><a href="ulysses-compass.html#cb780-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_std, <span class="dt">y =</span> mean)) <span class="op">+</span></span>
<span id="cb780-7"><a href="ulysses-compass.html#cb780-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> row),</span>
<span id="cb780-8"><a href="ulysses-compass.html#cb780-8"></a>            <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb780-9"><a href="ulysses-compass.html#cb780-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d,</span>
<span id="cb780-10"><a href="ulysses-compass.html#cb780-10"></a>             <span class="kw">aes</span>(<span class="dt">y =</span> brain_std),</span>
<span id="cb780-11"><a href="ulysses-compass.html#cb780-11"></a>             <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb780-12"><a href="ulysses-compass.html#cb780-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;m7.1&quot;</span>,</span>
<span id="cb780-13"><a href="ulysses-compass.html#cb780-13"></a>       <span class="dt">x =</span> <span class="st">&quot;body mass (standardized)&quot;</span>,</span>
<span id="cb780-14"><a href="ulysses-compass.html#cb780-14"></a>       <span class="dt">y =</span> <span class="st">&quot;brain volume (standardized)&quot;</span>) <span class="op">+</span></span>
<span id="cb780-15"><a href="ulysses-compass.html#cb780-15"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>mass_std),</span>
<span id="cb780-16"><a href="ulysses-compass.html#cb780-16"></a>                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>brain_std))</span>
<span id="cb780-17"><a href="ulysses-compass.html#cb780-17"></a></span>
<span id="cb780-18"><a href="ulysses-compass.html#cb780-18"></a>p2 &lt;-</span>
<span id="cb780-19"><a href="ulysses-compass.html#cb780-19"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb780-20"><a href="ulysses-compass.html#cb780-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">post =</span> purrr<span class="op">::</span><span class="kw">map</span>(row, <span class="op">~</span><span class="kw">brain_loo_lines</span>(<span class="dt">quap_fit =</span> m7<span class="fl">.4</span>, <span class="dt">row =</span> .))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb780-21"><a href="ulysses-compass.html#cb780-21"></a><span class="st">  </span><span class="kw">unnest</span>(post) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb780-22"><a href="ulysses-compass.html#cb780-22"></a><span class="st">  </span></span>
<span id="cb780-23"><a href="ulysses-compass.html#cb780-23"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_std, <span class="dt">y =</span> mean)) <span class="op">+</span></span>
<span id="cb780-24"><a href="ulysses-compass.html#cb780-24"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> row),</span>
<span id="cb780-25"><a href="ulysses-compass.html#cb780-25"></a>            <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb780-26"><a href="ulysses-compass.html#cb780-26"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d,</span>
<span id="cb780-27"><a href="ulysses-compass.html#cb780-27"></a>             <span class="kw">aes</span>(<span class="dt">y =</span> brain_std),</span>
<span id="cb780-28"><a href="ulysses-compass.html#cb780-28"></a>             <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb780-29"><a href="ulysses-compass.html#cb780-29"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;m7.4&quot;</span>,</span>
<span id="cb780-30"><a href="ulysses-compass.html#cb780-30"></a>       <span class="dt">x =</span> <span class="st">&quot;body mass (standardized)&quot;</span>,</span>
<span id="cb780-31"><a href="ulysses-compass.html#cb780-31"></a>       <span class="dt">y =</span> <span class="st">&quot;brain volume (standardized)&quot;</span>) <span class="op">+</span></span>
<span id="cb780-32"><a href="ulysses-compass.html#cb780-32"></a><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>mass_std),</span>
<span id="cb780-33"><a href="ulysses-compass.html#cb780-33"></a>                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.6</span>))</span>
<span id="cb780-34"><a href="ulysses-compass.html#cb780-34"></a></span>
<span id="cb780-35"><a href="ulysses-compass.html#cb780-35"></a>p1 <span class="op">+</span><span class="st"> </span>p2</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>“Notice that the straight lines hardly vary, while the curves fly about wildly. This is a general contrast between underfit and overfit models: sensitivity to the exact composition of the sample used to fit the model” (p. 201).</p>
<div id="rethinking-bias-and-variance." class="section level4">
<h4><span class="header-section-number">7.1.2.1</span> Rethinking: Bias and variance.</h4>
<blockquote>
<p>The underfitting/overfitting dichotomy is often described as the <strong>bias-variance trade-off</strong>. While not exactly the same distinction, the bias-variance trade-off addresses the same problem. “Bias” is related to underfitting, while “variance” is related to overfitting. These terms are confusing, because they are used in many different ways in different contexts, even within statistics. The term “bias” also sounds like a bad thing, even though increasing bias often leads
to better predictions. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Take a look at <span class="citation">Yarkoni &amp; Westfall (<a href="#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span> for more on the bias-variance trade-off. As McElreath indicated in his endnote #104 (p. 563), Hastie, Tibshirani and Friedman <span class="citation">(<a href="#ref-hastie2009elements" role="doc-biblioref">2009</a>)</span> broadly cover these ideas in their freely-downloadable text, <a href="https://link.springer.com/book/10.1007%2F978-0-387-84858-7"><em>The elements of statistical learning</em></a>.</p>
</div>
</div>
</div>
<div id="entropy-and-accuracy" class="section level2">
<h2><span class="header-section-number">7.2</span> Entropy and accuracy</h2>
<blockquote>
<p>So how do we navigate between the hydra of overfitting and the vortex of underfitting? Whether you end up using regularization or information criteria or both, the first thing you must do is pick a criterion of model performance. What do you want the model to do well at? We’ll call this criterion the <em>target</em>, and in this section you’ll see how information theory provides a common and useful target. (p. 202, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="firing-the-weatherperson." class="section level3">
<h3><span class="header-section-number">7.2.1</span> Firing the weatherperson.</h3>
<p>If you let rain = 1 and sun = 0, here’s a way to make a plot of the first table of page 203, the weatherperson’s predictions.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="ulysses-compass.html#cb781-1"></a>weatherperson &lt;-</span>
<span id="cb781-2"><a href="ulysses-compass.html#cb781-2"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">day        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb781-3"><a href="ulysses-compass.html#cb781-3"></a>         <span class="dt">prediction =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.6</span>), <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)),</span>
<span id="cb781-4"><a href="ulysses-compass.html#cb781-4"></a>         <span class="dt">observed   =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>))) </span>
<span id="cb781-5"><a href="ulysses-compass.html#cb781-5"></a></span>
<span id="cb781-6"><a href="ulysses-compass.html#cb781-6"></a>weatherperson <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb781-7"><a href="ulysses-compass.html#cb781-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>day) <span class="op">%&gt;%</span></span>
<span id="cb781-8"><a href="ulysses-compass.html#cb781-8"></a><span class="st">  </span></span>
<span id="cb781-9"><a href="ulysses-compass.html#cb781-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span></span>
<span id="cb781-10"><a href="ulysses-compass.html#cb781-10"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb781-11"><a href="ulysses-compass.html#cb781-11"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value, <span class="dt">color =</span> value <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb781-12"><a href="ulysses-compass.html#cb781-12"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb781-13"><a href="ulysses-compass.html#cb781-13"></a><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb781-14"><a href="ulysses-compass.html#cb781-14"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></span>
<span id="cb781-15"><a href="ulysses-compass.html#cb781-15"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></span>
<span id="cb781-16"><a href="ulysses-compass.html#cb781-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb781-17"><a href="ulysses-compass.html#cb781-17"></a>        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-22-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s how the newcomer fared:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="ulysses-compass.html#cb782-1"></a>newcomer &lt;-</span>
<span id="cb782-2"><a href="ulysses-compass.html#cb782-2"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">day        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb782-3"><a href="ulysses-compass.html#cb782-3"></a>         <span class="dt">prediction =</span> <span class="dv">0</span>,</span>
<span id="cb782-4"><a href="ulysses-compass.html#cb782-4"></a>         <span class="dt">observed   =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)))</span>
<span id="cb782-5"><a href="ulysses-compass.html#cb782-5"></a></span>
<span id="cb782-6"><a href="ulysses-compass.html#cb782-6"></a>newcomer <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb782-7"><a href="ulysses-compass.html#cb782-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>day) <span class="op">%&gt;%</span></span>
<span id="cb782-8"><a href="ulysses-compass.html#cb782-8"></a><span class="st">  </span></span>
<span id="cb782-9"><a href="ulysses-compass.html#cb782-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> name, <span class="dt">fill =</span> value)) <span class="op">+</span></span>
<span id="cb782-10"><a href="ulysses-compass.html#cb782-10"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb782-11"><a href="ulysses-compass.html#cb782-11"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value, <span class="dt">color =</span> value <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb782-12"><a href="ulysses-compass.html#cb782-12"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb782-13"><a href="ulysses-compass.html#cb782-13"></a><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb782-14"><a href="ulysses-compass.html#cb782-14"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">direction =</span> <span class="dv">-1</span>) <span class="op">+</span></span>
<span id="cb782-15"><a href="ulysses-compass.html#cb782-15"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></span>
<span id="cb782-16"><a href="ulysses-compass.html#cb782-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb782-17"><a href="ulysses-compass.html#cb782-17"></a>        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If we do the math entailed in the tibbles, we’ll see why the newcomer could boast “I’m the best person for the job” (p. 203).</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="ulysses-compass.html#cb783-1"></a>weatherperson <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb783-2"><a href="ulysses-compass.html#cb783-2"></a><span class="st">  </span><span class="kw">bind_rows</span>(newcomer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb783-3"><a href="ulysses-compass.html#cb783-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>()<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb783-4"><a href="ulysses-compass.html#cb783-4"></a>         <span class="dt">hit    =</span> <span class="kw">ifelse</span>(prediction <span class="op">==</span><span class="st"> </span>observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prediction <span class="op">-</span><span class="st"> </span>observed)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb783-5"><a href="ulysses-compass.html#cb783-5"></a><span class="st">  </span><span class="kw">group_by</span>(person) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb783-6"><a href="ulysses-compass.html#cb783-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">hit_rate =</span> <span class="kw">mean</span>(hit))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   person        hit_rate
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 newcomer          0.7 
## 2 weatherperson     0.58</code></pre>
<div id="costs-and-benefits." class="section level4">
<h4><span class="header-section-number">7.2.1.1</span> Costs and benefits.</h4>
<p>Our new <code>points</code> variable doesn’t fit into the nice color-based <code>geom_tile()</code> plots from above, but we can still do the math.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="ulysses-compass.html#cb785-1"></a><span class="kw">bind_rows</span>(weatherperson,</span>
<span id="cb785-2"><a href="ulysses-compass.html#cb785-2"></a>          newcomer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb785-3"><a href="ulysses-compass.html#cb785-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>()<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb785-4"><a href="ulysses-compass.html#cb785-4"></a>         <span class="dt">points =</span> <span class="kw">ifelse</span>(observed <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>prediction <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">-5</span>,</span>
<span id="cb785-5"><a href="ulysses-compass.html#cb785-5"></a>                         <span class="kw">ifelse</span>(observed <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>prediction <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">-1</span>,</span>
<span id="cb785-6"><a href="ulysses-compass.html#cb785-6"></a>                                <span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>prediction))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb785-7"><a href="ulysses-compass.html#cb785-7"></a><span class="st">  </span><span class="kw">group_by</span>(person) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb785-8"><a href="ulysses-compass.html#cb785-8"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">happiness =</span> <span class="kw">sum</span>(points))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   person        happiness
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 newcomer          -15  
## 2 weatherperson      -7.2</code></pre>
</div>
<div id="measuring-accuracy." class="section level4">
<h4><span class="header-section-number">7.2.1.2</span> Measuring accuracy.</h4>
<blockquote>
<p>Consider computing the probability of predicting the exact sequence of days. This means computing the probability of a correct prediction for each day. Then multiply all of these probabilities together to get the joint probability of correctly predicting the observed sequence. This is the same thing as the joint likelihood, which you’ve been using up to this point to fit models with Bayes’ theorem. This is the definition of accuracy that is maximized by the correct model.</p>
<p>In this light, the newcomer looks even worse. (p. 204)</p>
</blockquote>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="ulysses-compass.html#cb787-1"></a><span class="kw">bind_rows</span>(weatherperson,</span>
<span id="cb787-2"><a href="ulysses-compass.html#cb787-2"></a>          newcomer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-3"><a href="ulysses-compass.html#cb787-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">person =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</span>
<span id="cb787-4"><a href="ulysses-compass.html#cb787-4"></a>         <span class="dt">hit    =</span> <span class="kw">ifelse</span>(prediction <span class="op">==</span><span class="st"> </span>observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prediction <span class="op">-</span><span class="st"> </span>observed)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-5"><a href="ulysses-compass.html#cb787-5"></a><span class="st">  </span><span class="kw">count</span>(person, hit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-6"><a href="ulysses-compass.html#cb787-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">power =</span> hit <span class="op">^</span><span class="st"> </span>n,</span>
<span id="cb787-7"><a href="ulysses-compass.html#cb787-7"></a>         <span class="dt">term  =</span> <span class="kw">rep</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">times =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-8"><a href="ulysses-compass.html#cb787-8"></a><span class="st">  </span><span class="kw">select</span>(person, term, power) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-9"><a href="ulysses-compass.html#cb787-9"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> term,</span>
<span id="cb787-10"><a href="ulysses-compass.html#cb787-10"></a>              <span class="dt">values_from =</span> power) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb787-11"><a href="ulysses-compass.html#cb787-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability_correct_sequence =</span> a <span class="op">*</span><span class="st"> </span>b)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   person              a     b probability_correct_sequence
##   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;                        &lt;dbl&gt;
## 1 newcomer      0           1                      0      
## 2 weatherperson 0.00164     1                      0.00164</code></pre>
</div>
</div>
<div id="information-and-uncertainty." class="section level3">
<h3><span class="header-section-number">7.2.2</span> Information and uncertainty.</h3>
<p>Within the context of information theory <span class="citation">(Shannon, <a href="#ref-shannonMathematicalTheoryCommunication1948" role="doc-biblioref">1948</a>; also Cover &amp; Thomas, <a href="#ref-cover2006elements" role="doc-biblioref">2006</a>)</span>, information is “the reduction in uncertainty when we learn an outcome” (p. 205). <strong>Information entropy</strong> is a way of measuring that uncertainty in a way that is (a) continuous, (b) increases as the number of possible events increases, and (c) is additive. The formula for information entropy is:</p>
<p><span class="math display">\[H(p) = - \text E \log (p_i) = - \sum_{i = 1}^n p_i \log (p_i)\]</span></p>
<p>McElreath put it in words as: “The uncertainty contained in a probability distribution is the average log-probability of an event.” (p. 206). We’ll compute the information entropy for weather at the first unnamed location, which we’ll call <code>McElreath's house</code>, and <code>Abu Dhabi</code> at once.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="ulysses-compass.html#cb789-1"></a><span class="kw">tibble</span>(<span class="dt">place  =</span> <span class="kw">c</span>(<span class="st">&quot;McElreath&#39;s house&quot;</span>, <span class="st">&quot;Abu Dhabi&quot;</span>),</span>
<span id="cb789-2"><a href="ulysses-compass.html#cb789-2"></a>       <span class="dt">p_rain =</span> <span class="kw">c</span>(.<span class="dv">3</span>, <span class="fl">.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb789-3"><a href="ulysses-compass.html#cb789-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_shine =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_rain) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb789-4"><a href="ulysses-compass.html#cb789-4"></a><span class="st">  </span><span class="kw">group_by</span>(place) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb789-5"><a href="ulysses-compass.html#cb789-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">h_p =</span> (p_rain <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_rain) <span class="op">+</span><span class="st"> </span>p_shine <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_shine)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>() <span class="op">*</span><span class="st"> </span><span class="dv">-1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
## # Groups:   place [2]
##   place             p_rain p_shine    h_p
##   &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 McElreath&#39;s house   0.3     0.7  0.611 
## 2 Abu Dhabi           0.01    0.99 0.0560</code></pre>
<p>Did you catch how we used the equation <span class="math inline">\(H(p) = - \sum_{i = 1}^n p_i \log (p_i)\)</span> in our <code>mutate()</code> code, there? Our computation indicated the uncertainty is less in Abu Dhabi because it rarely rains, there. If you have sun, rain and snow, the entropy for weather is:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="ulysses-compass.html#cb791-1"></a>p &lt;-<span class="st"> </span><span class="kw">c</span>(.<span class="dv">7</span>, <span class="fl">.15</span>, <span class="fl">.15</span>)</span>
<span id="cb791-2"><a href="ulysses-compass.html#cb791-2"></a><span class="op">-</span><span class="kw">sum</span>(p <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p))</span></code></pre></div>
<pre><code>## [1] 0.8188085</code></pre>
<p>“These entropy values by themselves don’t mean much to us, though. Instead we can use them to build a measure of accuracy. That comes next” (p. 206).</p>
</div>
<div id="from-entropy-to-accuracy." class="section level3">
<h3><span class="header-section-number">7.2.3</span> From entropy to accuracy.</h3>
<blockquote>
<p>How can we use information entropy to say how far a model is from the target? The key lies in <strong>divergence</strong>:</p>
<blockquote>
<p><strong>Divergence</strong>: The additional uncertainty induced by using probabilities from one distribution to describe another distribution.</p>
</blockquote>
<p>This is often known as <em>Kullback-Leibler divergence</em> or simply KL divergence. <span class="citation">(p. 207, <strong>emphasis</strong> in the original, see Kullback &amp; Leibler, <a href="#ref-kullbackInformationSufficiency1951" role="doc-biblioref">1951</a>)</span></p>
</blockquote>
<p>The formula for the KL divergence is</p>
<p><span class="math display">\[D_\text{KL} (p, q) = \sum_i p_i \big ( \log (p_i) - \log (q_i) \big ) = \sum_i p_i \log \left ( \frac{p_i}{q_i} \right ),\]</span></p>
<p>which is what McElreath described in plainer language as “the average difference in log probability between the target (<span class="math inline">\(p\)</span>) and model (<span class="math inline">\(q\)</span>)” (p. 207).</p>
<p>In McElreath’s initial example</p>
<ul>
<li><span class="math inline">\(p_1 = .3\)</span>,</li>
<li><span class="math inline">\(p_2 = .7\)</span>,</li>
<li><span class="math inline">\(q_1 = .25\)</span>, and</li>
<li><span class="math inline">\(q_2 = .75\)</span>.</li>
</ul>
<p>With those values, we can compute <span class="math inline">\(D_\text{KL} (p, q)\)</span> within a tibble like so:</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="ulysses-compass.html#cb793-1"></a><span class="kw">tibble</span>(<span class="dt">p_1 =</span> <span class="fl">.3</span>,</span>
<span id="cb793-2"><a href="ulysses-compass.html#cb793-2"></a>       <span class="dt">p_2 =</span> <span class="fl">.7</span>,</span>
<span id="cb793-3"><a href="ulysses-compass.html#cb793-3"></a>       <span class="dt">q_1 =</span> <span class="fl">.25</span>,</span>
<span id="cb793-4"><a href="ulysses-compass.html#cb793-4"></a>       <span class="dt">q_2 =</span> <span class="fl">.75</span>) <span class="op">%&gt;%</span></span>
<span id="cb793-5"><a href="ulysses-compass.html#cb793-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_kl =</span> (p_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>(p_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">2</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##     p_1   p_2   q_1   q_2    d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1   0.3   0.7  0.25  0.75 0.00640</code></pre>
<p>Our systems in this section are binary (e.g., <span class="math inline">\(q = \{ q_i, q_2 \}\)</span>). Thus if you know <span class="math inline">\(q_1 = .3\)</span> you know of a necessity <span class="math inline">\(q_2 = 1 - q_1\)</span>. Therefore we can code the tibble for the next example, for when <span class="math inline">\(p = q\)</span>, like this.</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="ulysses-compass.html#cb795-1"></a><span class="kw">tibble</span>(<span class="dt">p_1 =</span> <span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb795-2"><a href="ulysses-compass.html#cb795-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_2 =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_<span class="dv">1</span>,</span>
<span id="cb795-3"><a href="ulysses-compass.html#cb795-3"></a>         <span class="dt">q_1 =</span> p_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb795-4"><a href="ulysses-compass.html#cb795-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">q_2 =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>q_<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb795-5"><a href="ulysses-compass.html#cb795-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_kl =</span> (p_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>(p_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">2</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##     p_1   p_2   q_1   q_2  d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0.3   0.7   0.3   0.7     0</code></pre>
<p>Building off of that, you can make the data required for Figure 7.6 like this.</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="ulysses-compass.html#cb797-1"></a>t &lt;-<span class="st"> </span></span>
<span id="cb797-2"><a href="ulysses-compass.html#cb797-2"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">p_1 =</span> <span class="fl">.3</span>,</span>
<span id="cb797-3"><a href="ulysses-compass.html#cb797-3"></a>         <span class="dt">p_2 =</span> <span class="fl">.7</span>,</span>
<span id="cb797-4"><a href="ulysses-compass.html#cb797-4"></a>         <span class="dt">q_1 =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.01</span>, <span class="dt">to =</span> <span class="fl">.99</span>, <span class="dt">by =</span> <span class="fl">.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb797-5"><a href="ulysses-compass.html#cb797-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">q_2 =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>q_<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb797-6"><a href="ulysses-compass.html#cb797-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_kl =</span> (p_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>(p_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">2</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">2</span>)))</span>
<span id="cb797-7"><a href="ulysses-compass.html#cb797-7"></a></span>
<span id="cb797-8"><a href="ulysses-compass.html#cb797-8"></a><span class="kw">head</span>(t)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##     p_1   p_2   q_1   q_2  d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0.3   0.7  0.01  0.99 0.778
## 2   0.3   0.7  0.02  0.98 0.577
## 3   0.3   0.7  0.03  0.97 0.462
## 4   0.3   0.7  0.04  0.96 0.383
## 5   0.3   0.7  0.05  0.95 0.324
## 6   0.3   0.7  0.06  0.94 0.276</code></pre>
<p>Now we have the data, plotting Figure 7.6 is a just <code>geom_line()</code> with stylistic flourishes.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="ulysses-compass.html#cb799-1"></a>t <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb799-2"><a href="ulysses-compass.html#cb799-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> q_<span class="dv">1</span>, <span class="dt">y =</span> d_kl)) <span class="op">+</span></span>
<span id="cb799-3"><a href="ulysses-compass.html#cb799-3"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.3</span>, <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb799-4"><a href="ulysses-compass.html#cb799-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb799-5"><a href="ulysses-compass.html#cb799-5"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">.4</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">label =</span> <span class="st">&quot;q = p&quot;</span>,</span>
<span id="cb799-6"><a href="ulysses-compass.html#cb799-6"></a>           <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="dt">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="dt">size =</span> <span class="fl">3.5</span>) <span class="op">+</span></span>
<span id="cb799-7"><a href="ulysses-compass.html#cb799-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;q[1]&quot;</span>,</span>
<span id="cb799-8"><a href="ulysses-compass.html#cb799-8"></a>       <span class="dt">y =</span> <span class="st">&quot;Divergence of q from p&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-32-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>What divergence can do for us now is help us contrast different approximations to <span class="math inline">\(p\)</span>. As an approximating function <span class="math inline">\(q\)</span> becomes more accurate, <span class="math inline">\(D_\text{KL} (p, q)\)</span> will shrink. So if we have a pair of candidate distributions, then the candidate that minimizes the divergence will be closest to the target. Since predictive models specify probabilities of events (observations), we can use divergence to compare the accuracy of models. (p. 208)</p>
</blockquote>
<div id="rethinking-divergence-depends-upon-direction." class="section level4">
<h4><span class="header-section-number">7.2.3.1</span> Rethinking: Divergence depends upon direction.</h4>
<p>Here we see <span class="math inline">\(H(p, q) \neq H(q, p)\)</span>. That is, direction matters.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="ulysses-compass.html#cb800-1"></a><span class="kw">tibble</span>(<span class="dt">direction =</span> <span class="kw">c</span>(<span class="st">&quot;Earth to Mars&quot;</span>, <span class="st">&quot;Mars to Earth&quot;</span>),</span>
<span id="cb800-2"><a href="ulysses-compass.html#cb800-2"></a>       <span class="dt">p_1       =</span> <span class="kw">c</span>(.<span class="dv">01</span>, <span class="fl">.7</span>),</span>
<span id="cb800-3"><a href="ulysses-compass.html#cb800-3"></a>       <span class="dt">q_1       =</span> <span class="kw">c</span>(.<span class="dv">7</span>, <span class="fl">.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb800-4"><a href="ulysses-compass.html#cb800-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_2 =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_<span class="dv">1</span>,</span>
<span id="cb800-5"><a href="ulysses-compass.html#cb800-5"></a>         <span class="dt">q_2 =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>q_<span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb800-6"><a href="ulysses-compass.html#cb800-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_kl =</span> (p_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>(p_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(p_<span class="dv">2</span> <span class="op">/</span><span class="st"> </span>q_<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   direction       p_1   q_1   p_2   q_2  d_kl
##   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Earth to Mars  0.01  0.7   0.99  0.3   1.14
## 2 Mars to Earth  0.7   0.01  0.3   0.99  2.62</code></pre>
<p>The <span class="math inline">\(D_\text{KL}\)</span> was double when applying Martian estimates to Terran estimates.</p>
<blockquote>
<p>An important practical consequence of this asymmetry, in a model fitting context, is that if we use a distribution with high entropy to approximate an unknown true distribution of events, we will reduce the distance to the truth and therefore the error. This fact will help us build generalized linear models, later on in <a href="big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model">Chapter 10</a>. (p. 209)</p>
</blockquote>
</div>
</div>
<div id="estimating-divergence." class="section level3">
<h3><span class="header-section-number">7.2.4</span> Estimating divergence.</h3>
<blockquote>
<p>The point of all the preceding material about information theory and divergence is to establish both:</p>
<ol style="list-style-type: decimal">
<li><p>How to measure the distance of a model from our target. Information theory gives us the distance measure we need, the KL divergence.</p></li>
<li><p>How to estimate the divergence. Having identified the right measure of distance, we now need a way to estimate it in real statistical modeling tasks. (p. 209)</p></li>
</ol>
</blockquote>
<p>Now we’ll start working on item #2.</p>
<p>Within the context of science, say we’ve labeled the true model for our topic of interest as <span class="math inline">\(p\)</span>. We don’t actually know what <span class="math inline">\(p\)</span> is–we wouldn’t need the scientific method if we did. But say what we do have are two candidate models <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span>. We would at least like to know which is closer to <span class="math inline">\(p\)</span>. It turns out we don’t even need to know the absolute value of <span class="math inline">\(p\)</span> to achieve this. Just the relative values of <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> will suffice. We express model <span class="math inline">\(q\)</span>’s average log-probability as <span class="math inline">\(\text E \log (q_i)\)</span>. Extrapolating, the difference <span class="math inline">\(\text E \log (q_i) - \text E \log (r_i)\)</span> gives us a sense about the divergence of both <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> from the target <span class="math inline">\(p\)</span>. That is, “we can compare the average log-probability from each model to get an estimate of the relative distance of each model from the target” (p. 210). <strong>Deviance</strong> and related statistics can help us towards this end. We define deviance as</p>
<p><span class="math display">\[D(q) = -2 \sum_i \log (q_i),\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes each case and <span class="math inline">\(q_i\)</span> is the likelihood for each case. Here’s the deviance from the OLS version of model <code>m7.1</code>.</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="ulysses-compass.html#cb802-1"></a><span class="kw">lm</span>(<span class="dt">data =</span> d, brain_std <span class="op">~</span><span class="st"> </span>mass_std) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb802-2"><a href="ulysses-compass.html#cb802-2"></a><span class="st">  </span><span class="kw">logLik</span>() <span class="op">*</span><span class="st"> </span><span class="dv">-2</span></span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; -5.985049 (df=3)</code></pre>
<p>In our <span class="math inline">\(D(q)\)</span> formula, did you notice how we ended up multiplying <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span>? Frequentists and Bayesians alike make use of information theory, KL divergence, and deviance. It turns out that the differences between two <span class="math inline">\(D(q)\)</span> values follows a <span class="math inline">\(\chi^2\)</span> distribution <span class="citation">(Wilks, <a href="#ref-wilksLargesampleDistributionLikelihood1938" role="doc-biblioref">1938</a>)</span>, which frequentists like to reference for the purpose of null-hypothesis significance testing. Many Bayesians, however, are not into all that significance-testing stuff and they aren’t as inclined to multiply <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span> for the simple purpose of scaling the associated difference distribution to follow the <span class="math inline">\(\chi^2\)</span>. If we leave that part out of the equation, we end up with</p>
<p><span class="math display">\[S(q) = \sum_i \log (q_i),\]</span></p>
<p>which we can think of as a log-probability score which is “the gold standard way to compare the predictive accuracy of different models. It is an estimate of <span class="math inline">\(\text E \log (q_i)\)</span>, just without the final step of dividing by the number of observations” (p. 210). When Bayesians compute <span class="math inline">\(S(q)\)</span>, they do so over the entire posterior distribution. “Doing this calculation correctly requires a little subtlety. The <strong>rethinking</strong> package has a function called <code>lppd</code>–<strong>log-pointwise-predictive-density</strong>–to do this calculation for quap models” (p. 210, <strong>emhasis</strong> in the original for the second time, but not the first). Here’s the <code>rethinking::lppd()</code> function in action for <code>m7.1</code>.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="ulysses-compass.html#cb804-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb804-2"><a href="ulysses-compass.html#cb804-2"></a>l &lt;-<span class="st"> </span><span class="kw">lppd</span>(m7<span class="fl">.1</span>, <span class="dt">n =</span> <span class="fl">1e4</span>)</span>
<span id="cb804-3"><a href="ulysses-compass.html#cb804-3"></a>l</span></code></pre></div>
<pre><code>## [1]  0.6098668  0.6483438  0.5496093  0.6234934  0.4648143  0.4347605 -0.8444632</code></pre>
<p>Our <code>l</code> object contained the seven case-specific values for <span class="math inline">\(\log(q_i)\)</span>. Here we sum them up to compute <span class="math inline">\(S(q)\)</span>.</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="ulysses-compass.html#cb806-1"></a><span class="kw">sum</span>(l)</span></code></pre></div>
<pre><code>## [1] 2.486425</code></pre>
<p>Here’s how to take the last step if you would like to express that as <span class="math inline">\(D(q)\)</span>.</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="ulysses-compass.html#cb808-1"></a><span class="dv">-2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(l)</span></code></pre></div>
<pre><code>## [1] -4.97285</code></pre>
<div id="overthinking-computing-the-lppd." class="section level4">
<h4><span class="header-section-number">7.2.4.1</span> Overthinking: Computing the lppd.</h4>
<p>We can follow along with both our <strong>rethinking</strong> model <code>m7.1</code> and a counterpart fit with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="ulysses-compass.html#cb810-1"></a><span class="kw">library</span>(brms)</span>
<span id="cb810-2"><a href="ulysses-compass.html#cb810-2"></a></span>
<span id="cb810-3"><a href="ulysses-compass.html#cb810-3"></a>b7<span class="fl">.1</span> &lt;-<span class="st"> </span></span>
<span id="cb810-4"><a href="ulysses-compass.html#cb810-4"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb810-5"><a href="ulysses-compass.html#cb810-5"></a>      <span class="dt">family =</span> <span class="kw">gaussian</span>(),</span>
<span id="cb810-6"><a href="ulysses-compass.html#cb810-6"></a>      brain_std <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mass_std,</span>
<span id="cb810-7"><a href="ulysses-compass.html#cb810-7"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb810-8"><a href="ulysses-compass.html#cb810-8"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</span>
<span id="cb810-9"><a href="ulysses-compass.html#cb810-9"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="fl">4.189324</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb810-10"><a href="ulysses-compass.html#cb810-10"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb810-11"><a href="ulysses-compass.html#cb810-11"></a>      <span class="dt">seed =</span> <span class="dv">7</span>,</span>
<span id="cb810-12"><a href="ulysses-compass.html#cb810-12"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b07.01&quot;</span>)</span></code></pre></div>
<p>Before we move on, we should clarify where that <code>exponential(4.189324)</code> prior on <span class="math inline">\(\sigma\)</span> came from. Recall that the parameter in the exponential distribution is the rate, <span class="math inline">\(\lambda\)</span>. To get the mean of the exponential distribution, you take the reciprocal of the rate.</p>
<p><span class="math display">\[\mu_y = \frac{1}{\lambda}\]</span></p>
<p>Since I wanted a diffuse prior for sigma with the mean centered around <code>sd(d$brain_std)</code>, a quick computation revealed that the appropriate <span class="math inline">\(\lambda\)</span> would be about 4.2.</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="ulysses-compass.html#cb811-1"></a><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>brain_std)</span></code></pre></div>
<pre><code>## [1] 4.189324</code></pre>
<p>Anyway, here’s our summary for <code>b7.1</code>.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="ulysses-compass.html#cb813-1"></a><span class="kw">print</span>(b7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: brain_std ~ 1 + mass_std 
##    Data: d (Number of observations: 7) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.53      0.09     0.34     0.70 1.00     2392     1187
## mass_std      0.17      0.09    -0.04     0.34 1.00     2611     1787
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.22      0.08     0.12     0.43 1.00     1339     1584
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <strong>brms</strong> package contains a <code>log_lik()</code> function, which returns a matrix. Each occasion gets a column and each HMC chain iteration gets a row.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="ulysses-compass.html#cb815-1"></a><span class="kw">log_lik</span>(b7<span class="fl">.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb815-2"><a href="ulysses-compass.html#cb815-2"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>##  num [1:4000, 1:7] 0.586 1.161 0.742 0.877 0.442 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>In just a bit, we’ll see that this output is very similar to what we get from <strong>rethinking</strong>. For now, focus back to the text. On page 210, McElreath clarified that the Bayesian version of the log-probability score, what we’ve been calling the lppd, has to account for the data and the posterior distribution. It follows the form</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i | \Theta_s),\]</span></p>
<blockquote>
<p>where <span class="math inline">\(S\)</span> is the number of samples and <span class="math inline">\(\Theta_s\)</span> is the <span class="math inline">\(s\)</span>-th set of sampled parameter values in the posterior distribution. While in principle this is easy–you just need to compute the probability (density) of each observation <span class="math inline">\(i\)</span> for each sample <span class="math inline">\(s\)</span>, take the average, and then the logarithm–in practice it is not so easy. The reason is that doing arithmetic in a computer often requires some tricks to retain precision. (p. 210)</p>
</blockquote>
<p>We can wrap a mild reworking of McElreath’s <strong>R</strong> code 7.14 code into a custom <code>lppd_r()</code> function.</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="ulysses-compass.html#cb817-1"></a>lppd_r &lt;-<span class="st"> </span><span class="cf">function</span>(quap_fit, <span class="dt">seed =</span> <span class="dv">1</span>, <span class="dt">n =</span> <span class="fl">1e4</span>) {</span>
<span id="cb817-2"><a href="ulysses-compass.html#cb817-2"></a>  </span>
<span id="cb817-3"><a href="ulysses-compass.html#cb817-3"></a>  <span class="kw">set.seed</span>(seed)</span>
<span id="cb817-4"><a href="ulysses-compass.html#cb817-4"></a>  </span>
<span id="cb817-5"><a href="ulysses-compass.html#cb817-5"></a>  lp &lt;-<span class="st"> </span><span class="kw">sim</span>(quap_fit, <span class="dt">ll =</span> <span class="ot">TRUE</span>, <span class="dt">n =</span> n)</span>
<span id="cb817-6"><a href="ulysses-compass.html#cb817-6"></a>  ni &lt;-<span class="st"> </span><span class="kw">ncol</span>(lp)</span>
<span id="cb817-7"><a href="ulysses-compass.html#cb817-7"></a>  ns &lt;-<span class="st"> </span><span class="kw">nrow</span>(lp)</span>
<span id="cb817-8"><a href="ulysses-compass.html#cb817-8"></a>  </span>
<span id="cb817-9"><a href="ulysses-compass.html#cb817-9"></a>  f &lt;-<span class="st"> </span><span class="cf">function</span>(i) {<span class="kw">log_sum_exp</span>(lp[, i]) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(ns)}</span>
<span id="cb817-10"><a href="ulysses-compass.html#cb817-10"></a>  </span>
<span id="cb817-11"><a href="ulysses-compass.html#cb817-11"></a>  <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>ni, f)</span>
<span id="cb817-12"><a href="ulysses-compass.html#cb817-12"></a>  </span>
<span id="cb817-13"><a href="ulysses-compass.html#cb817-13"></a>}</span></code></pre></div>
<p>The <code>lppd_r()</code> function is designed to work with models fit with <code>rethinking::quap()</code>. It works like this.</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="ulysses-compass.html#cb818-1"></a><span class="kw">lppd_r</span>(m7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## [1]  0.6098668  0.6483438  0.5496093  0.6234934  0.4648143  0.4347605 -0.8444632</code></pre>
<p>Happily, it returned the same results as McElreath’s <strong>R</strong> code 7.13 (p. 210). Our <strong>brms</strong> analogue to the output from <code>sim(quap_fit, ll = TRUE, n = 1e4)</code> is to inset a <code>brm()</code> model fit into the <code>log_lik()</code> function. Although the way those two functions compute their output differs, the format is largely the same. With that in mind, here’s a mild reworking of our <code>lppd_r()</code> function designed to work with <strong>brms</strong> fits.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="ulysses-compass.html#cb820-1"></a>lppd_b &lt;-<span class="st"> </span><span class="cf">function</span>(brm_fit) {</span>
<span id="cb820-2"><a href="ulysses-compass.html#cb820-2"></a>  </span>
<span id="cb820-3"><a href="ulysses-compass.html#cb820-3"></a>  lp &lt;-<span class="st"> </span><span class="kw">log_lik</span>(brm_fit)</span>
<span id="cb820-4"><a href="ulysses-compass.html#cb820-4"></a>  </span>
<span id="cb820-5"><a href="ulysses-compass.html#cb820-5"></a>  ni &lt;-<span class="st"> </span><span class="kw">ncol</span>(lp)</span>
<span id="cb820-6"><a href="ulysses-compass.html#cb820-6"></a>  ns &lt;-<span class="st"> </span><span class="kw">nrow</span>(lp)</span>
<span id="cb820-7"><a href="ulysses-compass.html#cb820-7"></a>  </span>
<span id="cb820-8"><a href="ulysses-compass.html#cb820-8"></a>  f &lt;-<span class="st"> </span><span class="cf">function</span>(i) {<span class="kw">log_sum_exp</span>(lp[, i]) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(ns)}</span>
<span id="cb820-9"><a href="ulysses-compass.html#cb820-9"></a>  </span>
<span id="cb820-10"><a href="ulysses-compass.html#cb820-10"></a>  <span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>ni, f)</span>
<span id="cb820-11"><a href="ulysses-compass.html#cb820-11"></a>  </span>
<span id="cb820-12"><a href="ulysses-compass.html#cb820-12"></a>}</span></code></pre></div>
<p>Here’s what it returns for <code>b7.1</code>.</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="ulysses-compass.html#cb821-1"></a><span class="kw">lppd_b</span>(b7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## [1]  0.5261533  0.5627924  0.4642181  0.5349419  0.3768194  0.3423058 -0.7249722</code></pre>
<p>Given we fit the model with a different prior on <span class="math inline">\(\sigma\)</span> and with a different algorithm (HMC versus using the quadratic approximation), we might expect the results would differ a bit. Happily, the overall pattern is very similar. Here we compare the results from the two packages in a plot.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="ulysses-compass.html#cb823-1"></a><span class="kw">tibble</span>(<span class="dt">rethinking =</span> <span class="kw">lppd_r</span>(m7<span class="fl">.1</span>),</span>
<span id="cb823-2"><a href="ulysses-compass.html#cb823-2"></a>       <span class="dt">brms       =</span> <span class="kw">lppd_b</span>(b7<span class="fl">.1</span>),</span>
<span id="cb823-3"><a href="ulysses-compass.html#cb823-3"></a>       <span class="dt">i          =</span> <span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb823-4"><a href="ulysses-compass.html#cb823-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>i) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb823-5"><a href="ulysses-compass.html#cb823-5"></a><span class="st">  </span></span>
<span id="cb823-6"><a href="ulysses-compass.html#cb823-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> i)) <span class="op">+</span></span>
<span id="cb823-7"><a href="ulysses-compass.html#cb823-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> i),</span>
<span id="cb823-8"><a href="ulysses-compass.html#cb823-8"></a>            <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb823-9"><a href="ulysses-compass.html#cb823-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name),</span>
<span id="cb823-10"><a href="ulysses-compass.html#cb823-10"></a>             <span class="dt">size =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb823-11"><a href="ulysses-compass.html#cb823-11"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="st">&quot;package&quot;</span>, <span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb823-12"><a href="ulysses-compass.html#cb823-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;lppd&quot;</span>,</span>
<span id="cb823-13"><a href="ulysses-compass.html#cb823-13"></a>       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">italic</span>(i)))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-45-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="scoring-the-right-data." class="section level3">
<h3><span class="header-section-number">7.2.5</span> Scoring the right data.</h3>
<p>Here’s a <strong>tidyverse</strong>-style approach for computing the lppd for each of our six <strong>rethinking</strong> models.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="ulysses-compass.html#cb824-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb824-2"><a href="ulysses-compass.html#cb824-2"></a></span>
<span id="cb824-3"><a href="ulysses-compass.html#cb824-3"></a><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">str_c</span>(<span class="st">&quot;m7.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb824-4"><a href="ulysses-compass.html#cb824-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> purrr<span class="op">::</span><span class="kw">map</span>(name, get)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb824-5"><a href="ulysses-compass.html#cb824-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lppd =</span> purrr<span class="op">::</span><span class="kw">map_dbl</span>(fit, <span class="op">~</span><span class="kw">sum</span>(<span class="kw">lppd</span>(.))))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   name  fit     lppd
##   &lt;chr&gt; &lt;list&gt; &lt;dbl&gt;
## 1 m7.1  &lt;map&gt;   2.49
## 2 m7.2  &lt;map&gt;   2.57
## 3 m7.3  &lt;map&gt;   3.71
## 4 m7.4  &lt;map&gt;   5.33
## 5 m7.5  &lt;map&gt;  14.1 
## 6 m7.6  &lt;map&gt;  39.4</code></pre>
<blockquote>
<p>When we usually have data and use it to fit a statistical model, the data comprise a <strong>training sample</strong>. Parameters are estimated from it, and then we can imagine using those estimates to predict outcomes in a new sample, called the <strong>test sample</strong>. R is going to do all of this for you. But here’s the full procedure, in outline:</p>
<ol style="list-style-type: decimal">
<li>Suppose there’s a training sample of size <span class="math inline">\(N\)</span>.</li>
<li>Compute the posterior distribution of a model for the training sample, and compute the score on the training sample. Call this score <span class="math inline">\(D_\text{train}\)</span>.</li>
<li>Suppose another sample of size <span class="math inline">\(N\)</span> from the same process. This is the test sample.</li>
<li>Compute the score on the test sample, using the posterior trained on the training
sample. Call this new score <span class="math inline">\(D_\text{test}\)</span>.</li>
</ol>
<p>The above is a thought experiment. It allows us to explore the distinction between accuracy measured in and out of sample, using a simple prediction scenario. (p. 211, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>We’ll see how to carry out such a thought experiment in the next section.</p>
<div id="overthinking-simulated-training-and-testing." class="section level4">
<h4><span class="header-section-number">7.2.5.1</span> Overthinking: Simulated training and testing.</h4>
<p>McElreath plotted the results of such a thought experiment in implemented in <strong>R</strong> with the aid of his <code>sim_train_test()</code> function. If you’re interested in how the function pulls this off, execute the code below.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="ulysses-compass.html#cb826-1"></a>sim_train_test</span></code></pre></div>
<p>For the sake of brevity, I am going to show the results of a simulation based on 1,000 simulations rather than McElreath’s 10,000.</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="ulysses-compass.html#cb827-1"></a><span class="co"># I&#39;ve reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb827-2"><a href="ulysses-compass.html#cb827-2"></a>n_sim   &lt;-<span class="st"> </span><span class="fl">1e3</span></span>
<span id="cb827-3"><a href="ulysses-compass.html#cb827-3"></a>n_cores &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb827-4"><a href="ulysses-compass.html#cb827-4"></a>kseq    &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb827-5"><a href="ulysses-compass.html#cb827-5"></a></span>
<span id="cb827-6"><a href="ulysses-compass.html#cb827-6"></a><span class="co"># define the simulation function</span></span>
<span id="cb827-7"><a href="ulysses-compass.html#cb827-7"></a>my_sim &lt;-<span class="st"> </span><span class="cf">function</span>(k) {</span>
<span id="cb827-8"><a href="ulysses-compass.html#cb827-8"></a>  </span>
<span id="cb827-9"><a href="ulysses-compass.html#cb827-9"></a>  <span class="kw">print</span>(k);</span>
<span id="cb827-10"><a href="ulysses-compass.html#cb827-10"></a>  r &lt;-<span class="st"> </span><span class="kw">mcreplicate</span>(n_sim, <span class="kw">sim_train_test</span>(<span class="dt">N =</span> n, <span class="dt">k =</span> k), <span class="dt">mc.cores =</span> n_cores);</span>
<span id="cb827-11"><a href="ulysses-compass.html#cb827-11"></a>  <span class="kw">c</span>(<span class="kw">mean</span>(r[<span class="dv">1</span>, ]), <span class="kw">mean</span>(r[<span class="dv">2</span>, ]), <span class="kw">sd</span>(r[<span class="dv">1</span>, ]), <span class="kw">sd</span>(r[<span class="dv">2</span>, ]))</span>
<span id="cb827-12"><a href="ulysses-compass.html#cb827-12"></a>  </span>
<span id="cb827-13"><a href="ulysses-compass.html#cb827-13"></a>}</span>
<span id="cb827-14"><a href="ulysses-compass.html#cb827-14"></a></span>
<span id="cb827-15"><a href="ulysses-compass.html#cb827-15"></a><span class="co"># here&#39;s our dev object based on `N &lt;- 20`</span></span>
<span id="cb827-16"><a href="ulysses-compass.html#cb827-16"></a>n      &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb827-17"><a href="ulysses-compass.html#cb827-17"></a>dev_<span class="dv">20</span> &lt;-</span>
<span id="cb827-18"><a href="ulysses-compass.html#cb827-18"></a><span class="st">  </span><span class="kw">sapply</span>(kseq, my_sim)</span>
<span id="cb827-19"><a href="ulysses-compass.html#cb827-19"></a></span>
<span id="cb827-20"><a href="ulysses-compass.html#cb827-20"></a><span class="co"># here&#39;s our dev object based on N &lt;- 100</span></span>
<span id="cb827-21"><a href="ulysses-compass.html#cb827-21"></a>n       &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb827-22"><a href="ulysses-compass.html#cb827-22"></a>dev_<span class="dv">100</span> &lt;-<span class="st"> </span></span>
<span id="cb827-23"><a href="ulysses-compass.html#cb827-23"></a><span class="st">  </span><span class="kw">sapply</span>(kseq, my_sim)</span></code></pre></div>
<p>If you didn’t quite catch it, the simulation yields <code>dev_20</code> and <code>dev_100</code>. We’ll want to convert them to tibbles, bind them together, and wrangle extensively before we’re ready to plot.</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="ulysses-compass.html#cb828-1"></a>dev_tibble &lt;-</span>
<span id="cb828-2"><a href="ulysses-compass.html#cb828-2"></a><span class="st">  </span><span class="kw">rbind</span>(dev_<span class="dv">20</span>, dev_<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb828-3"><a href="ulysses-compass.html#cb828-3"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb828-4"><a href="ulysses-compass.html#cb828-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>), <span class="dt">each =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">2</span>),</span>
<span id="cb828-5"><a href="ulysses-compass.html#cb828-5"></a>         <span class="dt">sample    =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;out&quot;</span>), <span class="dt">times =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">2</span>),</span>
<span id="cb828-6"><a href="ulysses-compass.html#cb828-6"></a>         <span class="dt">n         =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>), <span class="dt">each =</span> <span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb828-7"><a href="ulysses-compass.html#cb828-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(statistic<span class="op">:</span>n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb828-8"><a href="ulysses-compass.html#cb828-8"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> statistic,</span>
<span id="cb828-9"><a href="ulysses-compass.html#cb828-9"></a>              <span class="dt">values_from =</span> value) <span class="op">%&gt;%</span></span>
<span id="cb828-10"><a href="ulysses-compass.html#cb828-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n     =</span> <span class="kw">factor</span>(n, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>)),</span>
<span id="cb828-11"><a href="ulysses-compass.html#cb828-11"></a>         <span class="dt">n_par =</span> <span class="kw">str_extract</span>(name, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb828-12"><a href="ulysses-compass.html#cb828-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_par =</span> <span class="kw">ifelse</span>(sample <span class="op">==</span><span class="st"> &quot;in&quot;</span>, n_par <span class="op">-</span><span class="st"> </span><span class="fl">.075</span>, n_par <span class="op">+</span><span class="st"> </span><span class="fl">.075</span>))</span>
<span id="cb828-13"><a href="ulysses-compass.html#cb828-13"></a></span>
<span id="cb828-14"><a href="ulysses-compass.html#cb828-14"></a><span class="kw">head</span>(dev_tibble)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   sample n      name   mean    sd n_par
##   &lt;chr&gt;  &lt;fct&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 in     n = 20 X1     55.8  5.77 0.925
## 2 in     n = 20 X2     54.7  5.50 1.92 
## 3 in     n = 20 X3     51.6  4.24 2.92 
## 4 in     n = 20 X4     51.2  3.87 3.92 
## 5 in     n = 20 X5     51.1  3.54 4.92 
## 6 out    n = 20 X1     57.5  6.79 1.08</code></pre>
<p>Now we’re ready to make Figure 7.6.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="ulysses-compass.html#cb830-1"></a><span class="co"># for the annotation</span></span>
<span id="cb830-2"><a href="ulysses-compass.html#cb830-2"></a>text &lt;-</span>
<span id="cb830-3"><a href="ulysses-compass.html#cb830-3"></a><span class="st">  </span>dev_tibble <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb830-4"><a href="ulysses-compass.html#cb830-4"></a><span class="st">  </span><span class="kw">filter</span>(n_par <span class="op">&gt;</span><span class="st"> </span><span class="fl">1.5</span>, </span>
<span id="cb830-5"><a href="ulysses-compass.html#cb830-5"></a>         n_par <span class="op">&lt;</span><span class="st"> </span><span class="fl">2.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb830-6"><a href="ulysses-compass.html#cb830-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_par =</span> <span class="kw">ifelse</span>(sample <span class="op">==</span><span class="st"> &quot;in&quot;</span>, n_par <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>, n_par <span class="op">+</span><span class="st"> </span><span class="fl">0.29</span>))</span>
<span id="cb830-7"><a href="ulysses-compass.html#cb830-7"></a>  </span>
<span id="cb830-8"><a href="ulysses-compass.html#cb830-8"></a><span class="co"># plot!</span></span>
<span id="cb830-9"><a href="ulysses-compass.html#cb830-9"></a>dev_tibble <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb830-10"><a href="ulysses-compass.html#cb830-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> n_par, <span class="dt">y =</span> mean,</span>
<span id="cb830-11"><a href="ulysses-compass.html#cb830-11"></a>             <span class="dt">ymin =</span> mean <span class="op">-</span><span class="st"> </span>sd, <span class="dt">ymax =</span> mean <span class="op">+</span><span class="st"> </span>sd,</span>
<span id="cb830-12"><a href="ulysses-compass.html#cb830-12"></a>             <span class="dt">group =</span> sample, <span class="dt">color =</span> sample, <span class="dt">fill  =</span> sample)) <span class="op">+</span></span>
<span id="cb830-13"><a href="ulysses-compass.html#cb830-13"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb830-14"><a href="ulysses-compass.html#cb830-14"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</span>
<span id="cb830-15"><a href="ulysses-compass.html#cb830-15"></a>            <span class="kw">aes</span>(<span class="dt">label =</span> sample)) <span class="op">+</span></span>
<span id="cb830-16"><a href="ulysses-compass.html#cb830-16"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values  =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb830-17"><a href="ulysses-compass.html#cb830-17"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="op">+</span></span>
<span id="cb830-18"><a href="ulysses-compass.html#cb830-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Figure 7.6. Deviance in and out of sample.&quot;</span>,</span>
<span id="cb830-19"><a href="ulysses-compass.html#cb830-19"></a>       <span class="dt">x =</span> <span class="st">&quot;number of parameters&quot;</span>,</span>
<span id="cb830-20"><a href="ulysses-compass.html#cb830-20"></a>       <span class="dt">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="op">+</span></span>
<span id="cb830-21"><a href="ulysses-compass.html#cb830-21"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb830-22"><a href="ulysses-compass.html#cb830-22"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></span>
<span id="cb830-23"><a href="ulysses-compass.html#cb830-23"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>n, <span class="dt">scale =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Even with a substantially smaller <span class="math inline">\(N\)</span>, our simulation results matched up well with those in the text.</p>
<blockquote>
<p>Deviance is an assessment of predictive accuracy, not of truth. The true model, in terms of which predictors are included, is not guaranteed to produce the best predictions. Likewise a false model, in terms of which predictors are included, is not guaranteed to produce poor predictions.</p>
<p>The point of this thought experiment is to demonstrate how deviance behaves, in theory. While deviance on training data always improves with additional predictor variables, deviance on future data may or may not, depending upon both the true data-generating process and how much data is available to precisely estimate the parameters. These facts form the basis for understanding both regularizing priors and information criteria. (p. 213)</p>
</blockquote>
</div>
</div>
</div>
<div id="golem-taming-regularization" class="section level2">
<h2><span class="header-section-number">7.3</span> Golem taming: regularization</h2>
<blockquote>
<p>The root of overfitting is a model’s tendency to get overexcited by the training sample. When the priors are flat or nearly flat, the machine interprets this to mean that every parameter value is equally plausible. As a result, the model returns a posterior that encodes as much of the training sample–as represented by the likelihood function–as possible.</p>
<p>One way to prevent a model from getting too excited by the training sample is to use a skeptical prior. By “skeptical,” I mean a prior that slows the rate of learning from the sample. The most common skeptical prior is a <strong>regularizing prior</strong>. Such a prior, when tuned properly, reduces overfitting while still allowing the model to learn the regular features of a sample. (p. 214, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>In case you were curious, here’s how you might make a version Figure 7.7 with <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="ulysses-compass.html#cb831-1"></a><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="st"> </span><span class="fl">3.5</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="op">%&gt;%</span></span>
<span id="cb831-2"><a href="ulysses-compass.html#cb831-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">a =</span> <span class="kw">dnorm</span>(x, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.2</span>),</span>
<span id="cb831-3"><a href="ulysses-compass.html#cb831-3"></a>         <span class="dt">b =</span> <span class="kw">dnorm</span>(x, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb831-4"><a href="ulysses-compass.html#cb831-4"></a>         <span class="dt">c =</span> <span class="kw">dnorm</span>(x, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">1.0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb831-5"><a href="ulysses-compass.html#cb831-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>x) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb831-6"><a href="ulysses-compass.html#cb831-6"></a><span class="st">  </span></span>
<span id="cb831-7"><a href="ulysses-compass.html#cb831-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></span>
<span id="cb831-8"><a href="ulysses-compass.html#cb831-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> value, <span class="dt">color =</span> name, <span class="dt">linetype =</span> name), </span>
<span id="cb831-9"><a href="ulysses-compass.html#cb831-9"></a>            <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb831-10"><a href="ulysses-compass.html#cb831-10"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> value, <span class="dt">fill =</span> name),</span>
<span id="cb831-11"><a href="ulysses-compass.html#cb831-11"></a>              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb831-12"><a href="ulysses-compass.html#cb831-12"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span><span class="op">:</span><span class="dv">5</span>]) <span class="op">+</span></span>
<span id="cb831-13"><a href="ulysses-compass.html#cb831-13"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span><span class="op">:</span><span class="dv">5</span>]) <span class="op">+</span></span>
<span id="cb831-14"><a href="ulysses-compass.html#cb831-14"></a><span class="st">  </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb831-15"><a href="ulysses-compass.html#cb831-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;parameter value&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-3</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb831-16"><a href="ulysses-compass.html#cb831-16"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb831-17"><a href="ulysses-compass.html#cb831-17"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-52-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>In our version of the plot, darker purple = more regularizing.</p>
<p>To prepare for Figure 7.8, we need to simulate. This time we’ll wrap the basic simulation code we used before into a function we’ll call <code>make_sim()</code>. Our <code>make_sim()</code> function has two parameters, <code>n</code> and <code>b_sigma</code>, both of which come from McElreath’s simulation code. So you’ll note that instead of hard coding the values for <code>n</code> and <code>b_sigma</code> within the simulation, we’re leaving them adjustable (i.e., <code>sim_train_test(N = n, k = k, b_sigma = b_sigma)</code>). Also notice that instead of saving the simulation results as objects, like before, we’re just converting them to a data frame with the <code>data.frame()</code> function at the bottom. Our goal is to use <code>make_sim()</code> within a <code>purrr::map2()</code> statement. The result will be a nested data frame into which we’ve saved the results of 6 simulations based off of two sample sizes (i.e., <code>n = c(20, 100)</code>) and three values of <span class="math inline">\(\sigma\)</span> for our Gaussian <span class="math inline">\(\beta\)</span> prior (i.e., <code>b_sigma = c(1, .5, .2)</code>).</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="ulysses-compass.html#cb832-1"></a><span class="kw">library</span>(rethinking)</span>
<span id="cb832-2"><a href="ulysses-compass.html#cb832-2"></a></span>
<span id="cb832-3"><a href="ulysses-compass.html#cb832-3"></a><span class="co"># I&#39;ve reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb832-4"><a href="ulysses-compass.html#cb832-4"></a>n_sim   &lt;-<span class="st"> </span><span class="fl">1e3</span></span>
<span id="cb832-5"><a href="ulysses-compass.html#cb832-5"></a>n_cores &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb832-6"><a href="ulysses-compass.html#cb832-6"></a></span>
<span id="cb832-7"><a href="ulysses-compass.html#cb832-7"></a>make_sim &lt;-<span class="st"> </span><span class="cf">function</span>(n, b_sigma) {</span>
<span id="cb832-8"><a href="ulysses-compass.html#cb832-8"></a>  <span class="kw">sapply</span>(kseq, <span class="cf">function</span>(k) {</span>
<span id="cb832-9"><a href="ulysses-compass.html#cb832-9"></a>    <span class="kw">print</span>(k);</span>
<span id="cb832-10"><a href="ulysses-compass.html#cb832-10"></a>    r &lt;-<span class="st"> </span><span class="kw">mcreplicate</span>(n_sim, <span class="kw">sim_train_test</span>(<span class="dt">N =</span> n, <span class="dt">k =</span> k, <span class="dt">b_sigma =</span> b_sigma),  <span class="co"># this is an augmented line of code</span></span>
<span id="cb832-11"><a href="ulysses-compass.html#cb832-11"></a>                     <span class="dt">mc.cores =</span> n_cores);</span>
<span id="cb832-12"><a href="ulysses-compass.html#cb832-12"></a>    <span class="kw">c</span>(<span class="kw">mean</span>(r[<span class="dv">1</span>, ]), <span class="kw">mean</span>(r[<span class="dv">2</span>, ]), <span class="kw">sd</span>(r[<span class="dv">1</span>, ]), <span class="kw">sd</span>(r[<span class="dv">2</span>, ])) </span>
<span id="cb832-13"><a href="ulysses-compass.html#cb832-13"></a>    }</span>
<span id="cb832-14"><a href="ulysses-compass.html#cb832-14"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb832-15"><a href="ulysses-compass.html#cb832-15"></a><span class="st">    </span></span>
<span id="cb832-16"><a href="ulysses-compass.html#cb832-16"></a><span class="st">    </span><span class="co"># this is a new line of code</span></span>
<span id="cb832-17"><a href="ulysses-compass.html#cb832-17"></a><span class="st">    </span><span class="kw">data.frame</span>()</span>
<span id="cb832-18"><a href="ulysses-compass.html#cb832-18"></a>}</span>
<span id="cb832-19"><a href="ulysses-compass.html#cb832-19"></a></span>
<span id="cb832-20"><a href="ulysses-compass.html#cb832-20"></a>s &lt;-</span>
<span id="cb832-21"><a href="ulysses-compass.html#cb832-21"></a><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">n       =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb832-22"><a href="ulysses-compass.html#cb832-22"></a>           <span class="dt">b_sigma =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb832-23"><a href="ulysses-compass.html#cb832-23"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sim =</span> <span class="kw">map2</span>(n, b_sigma, make_sim)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb832-24"><a href="ulysses-compass.html#cb832-24"></a><span class="st">  </span><span class="kw">unnest</span>(sim)</span></code></pre></div>
<p>We’ll follow the same principles for wrangling these data as we did those from the previous simulation, <code>dev_tibble</code>. After wrangling, we’ll feed the data directly into the code for our version of Figure 7.8.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="ulysses-compass.html#cb833-1"></a><span class="co"># wrangle the simulation data</span></span>
<span id="cb833-2"><a href="ulysses-compass.html#cb833-2"></a>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb833-3"><a href="ulysses-compass.html#cb833-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>), <span class="dt">each =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span>),</span>
<span id="cb833-4"><a href="ulysses-compass.html#cb833-4"></a>         <span class="dt">sample    =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;out&quot;</span>), <span class="dt">times =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb833-5"><a href="ulysses-compass.html#cb833-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(n<span class="op">:</span>b_sigma, statistic<span class="op">:</span>sample)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb833-6"><a href="ulysses-compass.html#cb833-6"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> statistic,</span>
<span id="cb833-7"><a href="ulysses-compass.html#cb833-7"></a>              <span class="dt">values_from =</span> value) <span class="op">%&gt;%</span></span>
<span id="cb833-8"><a href="ulysses-compass.html#cb833-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n     =</span> <span class="kw">str_c</span>(<span class="st">&quot;n = &quot;</span>, n) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>(., <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>)),</span>
<span id="cb833-9"><a href="ulysses-compass.html#cb833-9"></a>         <span class="dt">n_par =</span> <span class="kw">str_extract</span>(name, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb833-10"><a href="ulysses-compass.html#cb833-10"></a><span class="st">  </span></span>
<span id="cb833-11"><a href="ulysses-compass.html#cb833-11"></a><span class="st">  </span><span class="co"># plot</span></span>
<span id="cb833-12"><a href="ulysses-compass.html#cb833-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> n_par, <span class="dt">y =</span> mean,</span>
<span id="cb833-13"><a href="ulysses-compass.html#cb833-13"></a>             <span class="dt">group =</span> <span class="kw">interaction</span>(sample, b_sigma))) <span class="op">+</span></span>
<span id="cb833-14"><a href="ulysses-compass.html#cb833-14"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sample, <span class="dt">size =</span> b_sigma <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>())) <span class="op">+</span></span>
<span id="cb833-15"><a href="ulysses-compass.html#cb833-15"></a><span class="st">  </span><span class="co"># this function contains the data from the previous simulation</span></span>
<span id="cb833-16"><a href="ulysses-compass.html#cb833-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dev_tibble, </span>
<span id="cb833-17"><a href="ulysses-compass.html#cb833-17"></a>             <span class="kw">aes</span>(<span class="dt">group =</span> sample, <span class="dt">fill =</span> sample),</span>
<span id="cb833-18"><a href="ulysses-compass.html#cb833-18"></a>             <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="fl">.1</span>) <span class="op">+</span></span>
<span id="cb833-19"><a href="ulysses-compass.html#cb833-19"></a><span class="st">  </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="op">+</span></span>
<span id="cb833-20"><a href="ulysses-compass.html#cb833-20"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="op">+</span></span>
<span id="cb833-21"><a href="ulysses-compass.html#cb833-21"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="op">+</span></span>
<span id="cb833-22"><a href="ulysses-compass.html#cb833-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;number of parameters&quot;</span>,</span>
<span id="cb833-23"><a href="ulysses-compass.html#cb833-23"></a>       <span class="dt">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="op">+</span></span>
<span id="cb833-24"><a href="ulysses-compass.html#cb833-24"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position  =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb833-25"><a href="ulysses-compass.html#cb833-25"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), </span>
<span id="cb833-26"><a href="ulysses-compass.html#cb833-26"></a>                                        <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></span>
<span id="cb833-27"><a href="ulysses-compass.html#cb833-27"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>n, <span class="dt">scale =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-55-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Our results don’t perfectly align with those in the text. I suspect his is because we used <code>1e3</code> iterations, rather than the <code>1e4</code> of the text. If you’d like to wait all night long for the simulation to yield more stable results, be my guest.</p>
<blockquote>
<p>Regularizing priors are great, because they reduce overfitting. But if they are too skeptical, they prevent the model from learning from the data. When you encounter multilevel models in <a href="models-with-memory.html#models-with-memory">Chapter 13</a>, you’ll see that their central device is to learn the strength of the prior from the data itself. So you can think of multilevel models as adaptive regularization, where the model itself tries to learn how skeptical it should be. (p. 216)</p>
</blockquote>
<p>I found this connection difficult to grasp for a long time. Practice now and hopefully it’ll sink in for you faster than it did me.</p>
<div id="rethinking-ridge-regression." class="section level4">
<h4><span class="header-section-number">7.3.0.1</span> Rethinking: Ridge regression.</h4>
<p>Within the <strong>brms</strong> framework, you can do something like this with the horseshoe prior via the <code>horseshoe()</code> function. You can learn all about it from the <code>horseshoe</code> section of the <a href="https://cran.r-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(Bürkner, <a href="#ref-brms2020RM" role="doc-biblioref">2020</a><a href="#ref-brms2020RM" role="doc-biblioref">b</a>)</span>. Here’s an extract from the section:</p>
<blockquote>
<p>The horseshoe prior is a special shrinkage prior initially proposed by <span class="citation">Carvalho et al. (<a href="#ref-carvalho2009handling" role="doc-biblioref">2009</a>)</span>. It is symmetric around zero with fat tails and an infinitely large spike at zero. This makes it ideal for sparse models that have many regression coefficients, although only a minority of them is non-zero. The horseshoe prior can be applied on all population-level effects at once (excluding the intercept) by using <code>set_prior("horseshoe(1)")</code>. (p. 93)</p>
</blockquote>
<p>To dive even deeper into the horseshoe prior, check out Michael Betancourt’s <span class="citation">(<a href="#ref-betancourtBayesSparse2018" role="doc-biblioref">2018</a>)</span> tutorial, <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html#35_the_horseshoe"><em>Bayes sparse regression</em></a>. I also have an example of the horseshoe prior (<code>fit18.5</code>) in <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients">Section 18.3</a> of my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">2020</a><a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">c</a>)</span> ebook translation of Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> text.</p>
</div>
</div>
<div id="predicting-predictive-accuracy" class="section level2">
<h2><span class="header-section-number">7.4</span> Predicting predictive accuracy</h2>
<blockquote>
<p>All of the preceding suggests one way to navigate overfitting and underfitting: Evaluate our models out-of-sample. But we do not have the out-of-sample, by definition, so how can we evaluate our models on it? There are two families of strategies: <strong>cross-validation</strong> and <strong>information criteria</strong>. These strategies try to guess how well models will perform, on average, in predicting new data. (p. 217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<div id="cross-validation." class="section level3">
<h3><span class="header-section-number">7.4.1</span> Cross-validation.</h3>
<blockquote>
<p>A popular strategy for estimating predictive accuracy is to actually test the model’s predictive accuracy on another sample. This is known as <strong>cross-validation</strong>, leaving out a small chunk of observations from our sample and evaluating the model on the observations that were left out. Of course we don’t want to leave out data. So what is usually done is to divide the sample in a number of chunks, called “folds.” The model is asked to predict each fold, after training on all the others. We then average over the score for each fold to get an estimate of out-of-sample accuracy. The minimum number of folds is 2. At the other extreme, you could make each point observation a fold and fit as many models as you have individual observations. (p. 217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Folds are typically equivalent in size and we often denote the total number of folds by <span class="math inline">\(k\)</span>, which means that the number of cases will get smaller as <span class="math inline">\(k\)</span> increases. In the extreme <span class="math inline">\(k = N\)</span>. <strong>Leave-one-out cross-validation</strong> (LOO-CV) is the name for this popular type of cross-validation which uses the largest number of folds possible by including a single case in each fold <span class="citation">(see Zhang &amp; Yang, <a href="#ref-zhangCrossvalidationSelectingModel2015" role="doc-biblioref">2015</a>; de Rooij &amp; Weeda, <a href="#ref-derooijCrossvalidationMethodEvery2020" role="doc-biblioref">2020</a>)</span>. This will be our approach.</p>
<p>A practical difficulty with LOO-CV is it’s costly in terms of the time and memory required to refit the model <span class="math inline">\(k = N\)</span> times. Happily, we have an approximation to pure LOO-CV. Vehtari, Gelman, and Gabry <span class="citation">(<a href="#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">2017</a>)</span> proposed Pareto smoothed importance-sampling leave-one-out cross-validation (PSIS-LOO-CV) as an efficient way to approximate true LOO-CV.</p>
</div>
</div>
<div id="information-criteria" class="section level2">
<h2><span class="header-section-number">7.5</span> Information criteria</h2>
<blockquote>
<p>The second approach is the use of <strong>information criteria</strong> to compute an expected score out of sample. Information criteria construct a theoretical estimate of the relative out-of-sample KL divergence. (p. 219, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>The frequentist Akaike information criterion <span class="citation">(AIC, Akaike, <a href="#ref-akaike1998information" role="doc-biblioref">1998</a>)</span> is the oldest and most restrictive. Among Bayesians, the deviance information criterion <span class="citation">(DIC, Spiegelhalter et al., <a href="#ref-spiegelhalterBayesianMeasuresModel2002" role="doc-biblioref">2002</a>)</span> has been widely used for some time, now. For a great talk on the DIC, check out the authoritative David Spiegelhalter’s <a href="https://www.youtube.com/watch?v=H-59eqmHuuQ&amp;frags=pl%2Cwn"><em>Retrospective read paper: Bayesian measure of model complexity and fit</em></a>. However, the DIC is limited in that it presumes the posterior is multivariate Gaussian, which is not always the case.</p>
<p>In this book, our focus will be on the widely applicable information criterion <span class="citation">(WAIC, Watanabe, <a href="#ref-watanabeAsymptoticEquivalenceBayes2010" role="doc-biblioref">2010</a>)</span>, which does not impose assumptions on the shape of the posterior distribution. The WAIC both provides an estimate of out-of-sample deviance and converges with LOO-CV as <span class="math inline">\(N \rightarrow \infty\)</span>. The WAIC follows the formula</p>
<p><span class="math display">\[\text{WAIC}(y, \Theta) = -2 \big (\text{lppd} - \underbrace{\sum_i \operatorname{var}_\theta \log p(y_i | \theta)}_\text{penalty term} \big),\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the data, <span class="math inline">\(\Theta\)</span> is the posterior distribution, and <span class="math inline">\(\text{lppd}\)</span> is the log-posterior-predictive-density from before. The penalty term is also referred to at the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. There are a few ways to compute the WAIC with <strong>brms</strong>, including with the <code>waic()</code> function.</p>
<div id="overthinking-waic-calculation." class="section level4">
<h4><span class="header-section-number">7.5.0.1</span> Overthinking: WAIC calculation.</h4>
<p>Here is how to fit the pre-WAIC model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="ulysses-compass.html#cb834-1"></a><span class="kw">data</span>(cars)</span>
<span id="cb834-2"><a href="ulysses-compass.html#cb834-2"></a></span>
<span id="cb834-3"><a href="ulysses-compass.html#cb834-3"></a>b7.m &lt;-<span class="st"> </span></span>
<span id="cb834-4"><a href="ulysses-compass.html#cb834-4"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> cars, </span>
<span id="cb834-5"><a href="ulysses-compass.html#cb834-5"></a>      <span class="dt">family =</span> gaussian,</span>
<span id="cb834-6"><a href="ulysses-compass.html#cb834-6"></a>      dist <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>speed,</span>
<span id="cb834-7"><a href="ulysses-compass.html#cb834-7"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb834-8"><a href="ulysses-compass.html#cb834-8"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</span>
<span id="cb834-9"><a href="ulysses-compass.html#cb834-9"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb834-10"><a href="ulysses-compass.html#cb834-10"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb834-11"><a href="ulysses-compass.html#cb834-11"></a>      <span class="dt">seed =</span> <span class="dv">7</span>,</span>
<span id="cb834-12"><a href="ulysses-compass.html#cb834-12"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b07.0m&quot;</span>)</span></code></pre></div>
<p>Behold the posterior summary.</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="ulysses-compass.html#cb835-1"></a><span class="kw">print</span>(b7.m)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: dist ~ 1 + speed 
##    Data: cars (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   -17.54      6.14   -29.45    -5.13 1.00     3878     2503
## speed         3.93      0.38     3.16     4.67 1.00     3872     2895
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    13.82      1.22    11.66    16.40 1.00     3662     2650
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now use the <code>brms::log_lik()</code> function to return the log-likelihood for each observation <span class="math inline">\(i\)</span> at each posterior draw <span class="math inline">\(s\)</span>, where <span class="math inline">\(S = 4,000\)</span>.</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="ulysses-compass.html#cb837-1"></a>n_cases &lt;-<span class="st"> </span><span class="kw">nrow</span>(cars)</span>
<span id="cb837-2"><a href="ulysses-compass.html#cb837-2"></a></span>
<span id="cb837-3"><a href="ulysses-compass.html#cb837-3"></a>ll &lt;-</span>
<span id="cb837-4"><a href="ulysses-compass.html#cb837-4"></a><span class="st">  </span><span class="kw">log_lik</span>(b7.m) <span class="op">%&gt;%</span></span>
<span id="cb837-5"><a href="ulysses-compass.html#cb837-5"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb837-6"><a href="ulysses-compass.html#cb837-6"></a><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="op">:</span>n_cases))</span>
<span id="cb837-7"><a href="ulysses-compass.html#cb837-7"></a></span>
<span id="cb837-8"><a href="ulysses-compass.html#cb837-8"></a><span class="kw">dim</span>(ll)</span></code></pre></div>
<p>We have a <span class="math inline">\(4,000 \times 50\)</span> (i.e., <span class="math inline">\(S \times N\)</span>) data frame with posterior draws in rows and cases in columns. Computing the <span class="math inline">\(\text{lppd}\)</span>, the “Bayesian deviance”, takes a bit of leg work. Recall the formula for <span class="math inline">\(\text{lppd}\)</span>,</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i | \Theta_s),\]</span></p>
<p>where <span class="math inline">\(p (y_i | \Theta_s)\)</span> is the likelihood of case <span class="math inline">\(i\)</span> on posterior draw <span class="math inline">\(s\)</span>. Since <code>log_lik()</code> returns the pointwise log-likelihood, our first step is to exponentiate those values. For each case <span class="math inline">\(i\)</span> (i.e., <span class="math inline">\(\sum_i\)</span>), we then take the average likelihood value [i.e., <span class="math inline">\(\frac{1}{S} \sum_s p (y_i | \Theta_s)\)</span>] and transform the result by taking its log [i.e., <span class="math inline">\(\log \left (\frac{1}{S} \sum_s p (y_i | \Theta_s) \right )\)</span>]. Here we’ll save the pointwise solution as <code>log_mu_l</code>.</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="ulysses-compass.html#cb838-1"></a>log_mu_l &lt;-</span>
<span id="cb838-2"><a href="ulysses-compass.html#cb838-2"></a><span class="st">  </span>ll <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-3"><a href="ulysses-compass.html#cb838-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</span>
<span id="cb838-4"><a href="ulysses-compass.html#cb838-4"></a>               <span class="dt">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb838-5"><a href="ulysses-compass.html#cb838-5"></a>               <span class="dt">values_to =</span> <span class="st">&quot;loglikelihood&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-6"><a href="ulysses-compass.html#cb838-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> <span class="kw">exp</span>(loglikelihood)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-7"><a href="ulysses-compass.html#cb838-7"></a><span class="st">  </span><span class="kw">group_by</span>(i) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-8"><a href="ulysses-compass.html#cb838-8"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">log_mean_likelihood =</span> <span class="kw">mean</span>(likelihood) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log</span>())</span>
<span id="cb838-9"><a href="ulysses-compass.html#cb838-9"></a></span>
<span id="cb838-10"><a href="ulysses-compass.html#cb838-10"></a>(</span>
<span id="cb838-11"><a href="ulysses-compass.html#cb838-11"></a>  lppd &lt;-</span>
<span id="cb838-12"><a href="ulysses-compass.html#cb838-12"></a><span class="st">  </span>log_mu_l <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-13"><a href="ulysses-compass.html#cb838-13"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lppd =</span> <span class="kw">sum</span>(log_mean_likelihood)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb838-14"><a href="ulysses-compass.html#cb838-14"></a><span class="st">  </span><span class="kw">pull</span>(lppd) </span>
<span id="cb838-15"><a href="ulysses-compass.html#cb838-15"></a>)</span></code></pre></div>
<pre><code>## [1] -206.6265</code></pre>
<p>It’s a little easier to compute the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. First, let’s use a shorthand notation and define <span class="math inline">\(V(y_i)\)</span> as the variance in log-likelihood for the <span class="math inline">\(i^\text{th}\)</span> case across all <span class="math inline">\(S\)</span> samples. We define <span class="math inline">\(p_\text{WAIC}\)</span> as their sum</p>
<p><span class="math display">\[p_\text{WAIC} = \sum_{i=1}^N V (y_i).\]</span></p>
<p>We’ll save the pointwise results [i.e., <span class="math inline">\(V (y_i)\)</span>] as <code>v_i</code> and their sum [i.e., <span class="math inline">\(\sum_{i=1}^N V (y_i)\)</span>] as <code>pwaic</code>.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="ulysses-compass.html#cb840-1"></a>v_i &lt;-</span>
<span id="cb840-2"><a href="ulysses-compass.html#cb840-2"></a><span class="st">  </span>ll <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb840-3"><a href="ulysses-compass.html#cb840-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</span>
<span id="cb840-4"><a href="ulysses-compass.html#cb840-4"></a>               <span class="dt">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb840-5"><a href="ulysses-compass.html#cb840-5"></a>               <span class="dt">values_to =</span> <span class="st">&quot;loglikelihood&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb840-6"><a href="ulysses-compass.html#cb840-6"></a><span class="st">  </span><span class="kw">group_by</span>(i) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb840-7"><a href="ulysses-compass.html#cb840-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">var_loglikelihood =</span> <span class="kw">var</span>(loglikelihood))</span>
<span id="cb840-8"><a href="ulysses-compass.html#cb840-8"></a></span>
<span id="cb840-9"><a href="ulysses-compass.html#cb840-9"></a>pwaic &lt;-</span>
<span id="cb840-10"><a href="ulysses-compass.html#cb840-10"></a><span class="st">  </span>v_i <span class="op">%&gt;%</span></span>
<span id="cb840-11"><a href="ulysses-compass.html#cb840-11"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pwaic =</span> <span class="kw">sum</span>(var_loglikelihood)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb840-12"><a href="ulysses-compass.html#cb840-12"></a><span class="st">  </span><span class="kw">pull</span>()</span>
<span id="cb840-13"><a href="ulysses-compass.html#cb840-13"></a></span>
<span id="cb840-14"><a href="ulysses-compass.html#cb840-14"></a>pwaic</span></code></pre></div>
<pre><code>## [1] 4.111924</code></pre>
<p>Now we can finally plug our hand-made <code>lppd</code> and <code>pwaic</code> values into the formula <span class="math inline">\(-2 (\text{lppd} - p_\text{WAIC})\)</span> to compute the WAIC. Compare it to the value returned by the <strong>brms</strong> <code>waic()</code> function.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="ulysses-compass.html#cb842-1"></a><span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>(lppd <span class="op">-</span><span class="st"> </span>pwaic)</span></code></pre></div>
<pre><code>## [1] 421.4769</code></pre>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="ulysses-compass.html#cb844-1"></a><span class="kw">waic</span>(b7.m)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -210.7  8.2
## p_waic         4.1  1.6
## waic         421.5 16.4
## 
## 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>Before we move on, did you notice the <code>elpd_waic</code> row in the tibble returned by the<code>waic()</code> function? That value is the <code>lppd</code> minus the <code>pwaic</code>, but without multiplying the result by -2. E.g.,</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="ulysses-compass.html#cb846-1"></a>(lppd <span class="op">-</span><span class="st"> </span>pwaic)</span></code></pre></div>
<pre><code>## [1] -210.7384</code></pre>
<p>Finally, here’s how we compute the WAIC standard error.</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="ulysses-compass.html#cb848-1"></a><span class="kw">tibble</span>(<span class="dt">lppd   =</span> <span class="kw">pull</span>(log_mu_l, log_mean_likelihood),</span>
<span id="cb848-2"><a href="ulysses-compass.html#cb848-2"></a>       <span class="dt">p_waic =</span> <span class="kw">pull</span>(v_i, var_loglikelihood)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb848-3"><a href="ulysses-compass.html#cb848-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">waic_vec =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>(lppd <span class="op">-</span><span class="st"> </span>p_waic)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb848-4"><a href="ulysses-compass.html#cb848-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">waic_se =</span> <span class="kw">sqrt</span>(n_cases <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(waic_vec)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   waic_se
##     &lt;dbl&gt;
## 1    16.4</code></pre>
<p>If you’d like the pointwise values from <code>brms::waic()</code>, just index.</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="ulysses-compass.html#cb850-1"></a><span class="kw">waic</span>(b7.m)<span class="op">$</span>pointwise <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb850-2"><a href="ulysses-compass.html#cb850-2"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##      elpd_waic     p_waic     waic
## [1,] -3.649870 0.02182091 7.299741
## [2,] -4.023347 0.09214764 8.046694
## [3,] -3.684137 0.02150916 7.368275
## [4,] -3.995993 0.05840990 7.991986
## [5,] -3.588907 0.01056900 7.177814
## [6,] -3.741526 0.02125830 7.483051</code></pre>
</div>
<div id="comparing-cv-psis-and-waic." class="section level3">
<h3><span class="header-section-number">7.5.1</span> Comparing CV, PSIS, and WAIC.</h3>
<p>Here we update our <code>make_sim()</code> to accommodate the simulation for Figure 7.9.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="ulysses-compass.html#cb852-1"></a>make_sim &lt;-<span class="st"> </span><span class="cf">function</span>(n, k, b_sigma) {</span>
<span id="cb852-2"><a href="ulysses-compass.html#cb852-2"></a>  </span>
<span id="cb852-3"><a href="ulysses-compass.html#cb852-3"></a>  r &lt;-<span class="st"> </span><span class="kw">mcreplicate</span>(n_sim, </span>
<span id="cb852-4"><a href="ulysses-compass.html#cb852-4"></a>                   <span class="kw">sim_train_test</span>(<span class="dt">N       =</span> n,</span>
<span id="cb852-5"><a href="ulysses-compass.html#cb852-5"></a>                                  <span class="dt">k       =</span> k,</span>
<span id="cb852-6"><a href="ulysses-compass.html#cb852-6"></a>                                  <span class="dt">b_sigma =</span> b_sigma,</span>
<span id="cb852-7"><a href="ulysses-compass.html#cb852-7"></a>                                  <span class="dt">WAIC    =</span> T,</span>
<span id="cb852-8"><a href="ulysses-compass.html#cb852-8"></a>                                  <span class="dt">LOOCV   =</span> T, </span>
<span id="cb852-9"><a href="ulysses-compass.html#cb852-9"></a>                                  <span class="dt">LOOIC   =</span> T),</span>
<span id="cb852-10"><a href="ulysses-compass.html#cb852-10"></a>                   <span class="dt">mc.cores =</span> n_cores)</span>
<span id="cb852-11"><a href="ulysses-compass.html#cb852-11"></a>  </span>
<span id="cb852-12"><a href="ulysses-compass.html#cb852-12"></a>  t &lt;-<span class="st"> </span></span>
<span id="cb852-13"><a href="ulysses-compass.html#cb852-13"></a><span class="st">    </span><span class="kw">tibble</span>(</span>
<span id="cb852-14"><a href="ulysses-compass.html#cb852-14"></a>      <span class="dt">deviance_os =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">2</span>, ])),</span>
<span id="cb852-15"><a href="ulysses-compass.html#cb852-15"></a>      <span class="dt">deviance_w  =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">3</span>, ])),</span>
<span id="cb852-16"><a href="ulysses-compass.html#cb852-16"></a>      <span class="dt">deviance_p  =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">11</span>, ])),</span>
<span id="cb852-17"><a href="ulysses-compass.html#cb852-17"></a>      <span class="dt">deviance_c  =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">19</span>, ])),</span>
<span id="cb852-18"><a href="ulysses-compass.html#cb852-18"></a>      <span class="dt">error_w     =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">7</span>, ])),</span>
<span id="cb852-19"><a href="ulysses-compass.html#cb852-19"></a>      <span class="dt">error_p     =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">15</span>, ])),</span>
<span id="cb852-20"><a href="ulysses-compass.html#cb852-20"></a>      <span class="dt">error_c     =</span> <span class="kw">mean</span>(<span class="kw">unlist</span>(r[<span class="dv">20</span>, ]))</span>
<span id="cb852-21"><a href="ulysses-compass.html#cb852-21"></a>      )</span>
<span id="cb852-22"><a href="ulysses-compass.html#cb852-22"></a>  </span>
<span id="cb852-23"><a href="ulysses-compass.html#cb852-23"></a>  <span class="kw">return</span>(t)</span>
<span id="cb852-24"><a href="ulysses-compass.html#cb852-24"></a></span>
<span id="cb852-25"><a href="ulysses-compass.html#cb852-25"></a>}</span></code></pre></div>
<p>Computing all three WAIC, PSIS-LOO-CV, and actual LOO-CV for many models across multiple combinations of <code>k</code> and <code>b_sigma</code> takes a long time–many hours. If you plan on running this code to replicate the figure on your own, take it for a spin first with <code>n_sim</code> set to something small like <code>10</code> to get a sense of the speed of your machine and the nature of the output. Alternatively, consider running the simulation for one combination of <code>k</code> and <code>b_sigma</code> at a time.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="ulysses-compass.html#cb853-1"></a>n_sim &lt;-<span class="st"> </span><span class="fl">1e3</span></span>
<span id="cb853-2"><a href="ulysses-compass.html#cb853-2"></a>n_cores &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb853-3"><a href="ulysses-compass.html#cb853-3"></a></span>
<span id="cb853-4"><a href="ulysses-compass.html#cb853-4"></a>s &lt;-</span>
<span id="cb853-5"><a href="ulysses-compass.html#cb853-5"></a><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">n       =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb853-6"><a href="ulysses-compass.html#cb853-6"></a>           <span class="dt">k       =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</span>
<span id="cb853-7"><a href="ulysses-compass.html#cb853-7"></a>           <span class="dt">b_sigma =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>)) <span class="op">%&gt;%</span></span>
<span id="cb853-8"><a href="ulysses-compass.html#cb853-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sim =</span> <span class="kw">pmap</span>(<span class="kw">list</span>(n, k, b_sigma), make_sim)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb853-9"><a href="ulysses-compass.html#cb853-9"></a><span class="st">  </span><span class="kw">unnest</span>(sim)</span></code></pre></div>
<p>Now we have our results saved as <code>s</code>, we’re ready to make our version of Figure 7.9. I’m going to deviate from McElreath’s version a bit and express the two average deviance plots on the left column into two columns. To my eyes, the reduced clutter makes it easier to track what I’m looking at.</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="ulysses-compass.html#cb854-1"></a>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb854-2"><a href="ulysses-compass.html#cb854-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(deviance_w<span class="op">:</span>deviance_c) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb854-3"><a href="ulysses-compass.html#cb854-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">criteria =</span> <span class="kw">ifelse</span>(name <span class="op">==</span><span class="st"> &quot;deviance_w&quot;</span>, <span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb854-4"><a href="ulysses-compass.html#cb854-4"></a>                           <span class="kw">ifelse</span>(name <span class="op">==</span><span class="st"> &quot;deviance_p&quot;</span>, <span class="st">&quot;PSIS&quot;</span>, <span class="st">&quot;CV&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb854-5"><a href="ulysses-compass.html#cb854-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n       =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;N = &quot;</span>, n), </span>
<span id="cb854-6"><a href="ulysses-compass.html#cb854-6"></a>                          <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;N = &quot;</span>, <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb854-7"><a href="ulysses-compass.html#cb854-7"></a>         <span class="dt">b_sigma =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, b_sigma),</span>
<span id="cb854-8"><a href="ulysses-compass.html#cb854-8"></a>                          <span class="dt">levels =</span> (<span class="kw">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb854-9"><a href="ulysses-compass.html#cb854-9"></a><span class="st">  </span></span>
<span id="cb854-10"><a href="ulysses-compass.html#cb854-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k)) <span class="op">+</span></span>
<span id="cb854-11"><a href="ulysses-compass.html#cb854-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> deviance_os, <span class="dt">shape =</span> b_sigma),</span>
<span id="cb854-12"><a href="ulysses-compass.html#cb854-12"></a>             <span class="dt">show.legend =</span> F) <span class="op">+</span></span>
<span id="cb854-13"><a href="ulysses-compass.html#cb854-13"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> value, <span class="dt">color =</span> criteria)) <span class="op">+</span></span>
<span id="cb854-14"><a href="ulysses-compass.html#cb854-14"></a><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb854-15"><a href="ulysses-compass.html#cb854-15"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb854-16"><a href="ulysses-compass.html#cb854-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;number of parameters (k)&quot;</span>,</span>
<span id="cb854-17"><a href="ulysses-compass.html#cb854-17"></a>       <span class="dt">y =</span> <span class="st">&quot;average deviance&quot;</span>) <span class="op">+</span></span>
<span id="cb854-18"><a href="ulysses-compass.html#cb854-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></span>
<span id="cb854-19"><a href="ulysses-compass.html#cb854-19"></a><span class="st">  </span><span class="kw">facet_grid</span>(n<span class="op">~</span>b_sigma, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Although our specific values vary, the overall patterns in our simulations are well aligned with those in the text. The CV, PSIS, and WAIC all did a reasonable job approximating out-of-sample deviance. Now we’ll follow the same sensibilities to make our version of the right column of McElreath’s Figure 7.9.</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="ulysses-compass.html#cb855-1"></a>s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb855-2"><a href="ulysses-compass.html#cb855-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(error_w<span class="op">:</span>error_c) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb855-3"><a href="ulysses-compass.html#cb855-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">criteria =</span> <span class="kw">ifelse</span>(name <span class="op">==</span><span class="st"> &quot;error_w&quot;</span>, <span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb855-4"><a href="ulysses-compass.html#cb855-4"></a>                           <span class="kw">ifelse</span>(name <span class="op">==</span><span class="st"> &quot;error_p&quot;</span>, <span class="st">&quot;PSIS&quot;</span>, <span class="st">&quot;CV&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb855-5"><a href="ulysses-compass.html#cb855-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n       =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;N = &quot;</span>, n),</span>
<span id="cb855-6"><a href="ulysses-compass.html#cb855-6"></a>                          <span class="dt">levels =</span> <span class="kw">str_c</span>(<span class="st">&quot;N = &quot;</span>, <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb855-7"><a href="ulysses-compass.html#cb855-7"></a>         <span class="dt">b_sigma =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, b_sigma),</span>
<span id="cb855-8"><a href="ulysses-compass.html#cb855-8"></a>                          <span class="dt">levels =</span> (<span class="kw">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb855-9"><a href="ulysses-compass.html#cb855-9"></a><span class="st">  </span></span>
<span id="cb855-10"><a href="ulysses-compass.html#cb855-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k)) <span class="op">+</span></span>
<span id="cb855-11"><a href="ulysses-compass.html#cb855-11"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> value, <span class="dt">color =</span> criteria)) <span class="op">+</span></span>
<span id="cb855-12"><a href="ulysses-compass.html#cb855-12"></a><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb855-13"><a href="ulysses-compass.html#cb855-13"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb855-14"><a href="ulysses-compass.html#cb855-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;number of parameters (k)&quot;</span>,</span>
<span id="cb855-15"><a href="ulysses-compass.html#cb855-15"></a>       <span class="dt">y =</span> <span class="st">&quot;average error (test deviance)&quot;</span>) <span class="op">+</span></span>
<span id="cb855-16"><a href="ulysses-compass.html#cb855-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></span>
<span id="cb855-17"><a href="ulysses-compass.html#cb855-17"></a><span class="st">  </span><span class="kw">facet_grid</span>(n<span class="op">~</span>b_sigma, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-67-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As in the text, the mean error was very similar across the three criteria. When <span class="math inline">\(N = 100\)</span>, they were nearly identical. When <span class="math inline">\(N = 20\)</span>, the WAIC was slightly better than the PSIS, which was slightly better than the CV. As we will see, the PSIS-LOO-CV has the advantage of a built-in diagnostic.</p>
</div>
</div>
<div id="model-comparison" class="section level2">
<h2><span class="header-section-number">7.6</span> Model comparison</h2>
<p>In the sections to follow, we’ll practice the model comparison approach, as opposed to the widely-used model selection approach.</p>
<div id="model-mis-selection." class="section level3">
<h3><span class="header-section-number">7.6.1</span> Model mis-selection.</h3>
<blockquote>
<p>We must keep in mind the lessons of the previous chapters: Inferring cause and making predictions are different tasks. Cross-validation and WAIC aim to find models that make good predictions. They don’t solve any causal inference problem. If you select a model based only on expected predictive accuracy, you could easily be confounded. The reason is that backdoor paths do give us valid information about statistical associations in the data. So they can improve prediction, as long as we don’t intervene in the system and the future is like the past. But recall that our working definition of knowing a cause is that we can predict the consequences of an intervention. So a good PSIS or WAIC score does not in general indicate a good causal model. (p. 226)</p>
</blockquote>
<p>If you have been following along and fitting the model on your own and saving them as external <code>.rds</code> files the way I have, you can use the <code>readRDS()</code> to retrieve them.</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="ulysses-compass.html#cb856-1"></a>b6<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;fits/b06.06.rds&quot;</span>)</span>
<span id="cb856-2"><a href="ulysses-compass.html#cb856-2"></a>b6<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;fits/b06.07.rds&quot;</span>)</span>
<span id="cb856-3"><a href="ulysses-compass.html#cb856-3"></a>b6<span class="fl">.8</span> &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;fits/b06.08.rds&quot;</span>)</span></code></pre></div>
<p>With our <strong>brms</strong> paradigm, we also use the <code>waic()</code> function. Both the <strong>rethinking</strong> and <strong>brms</strong> packages get their functionality for the <code>waic()</code> and related functions from the <a href="https://CRAN.R-project.org/package=loo"><strong>loo</strong> package</a> <span class="citation">(Vehtari, Gabry, et al., <a href="#ref-R-loo" role="doc-biblioref">2019</a>; Vehtari et al., <a href="#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">2017</a>; Yao et al., <a href="#ref-yaoUsingStackingAverage2018" role="doc-biblioref">2018</a>)</span>. Since the <code>brms::brm()</code> function fits the models with HMC, we don’t need to set a seed before calling <code>waic()</code> the way McElreath did with his <code>rethinking::quap()</code> model. We’re already drawn from the posterior.</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="ulysses-compass.html#cb857-1"></a><span class="kw">waic</span>(b6<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 100 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -180.7  6.7
## p_waic         3.5  0.5
## waic         361.5 13.4</code></pre>
<p>The WAIC estimate and its standard error are on the bottom row. The <span class="math inline">\(p_\text{WAIC}\)</span>–what McElreath’s output called the <code>penalty</code>–and its SE are stacked atop that. And look there on the top row. Remember how we pointed out, above, that we get the WAIC by multiplying <code>(lppd - pwaic)</code> by -2? Well, if you just do the subtraction without multiplying the result by -2, you get the <code>elpd_waic</code>. File that away. It’ll become important in a bit. In McElreath’s output, that was called the <code>lppd</code>.</p>
<p>Following the version 2.8.0 update, part of the suggested workflow for using information criteria with <strong>brms</strong> (i.e., execute <code>?loo.brmsfit</code>) is to add the estimates to the <code>brm()</code> fit object itself. You do that with the <code>add_criterion()</code> function. Here’s how we’d do so with <code>b6.7</code>.</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="ulysses-compass.html#cb859-1"></a>b6<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.7</span>, <span class="st">&quot;waic&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.07.rds&quot;</span>) </span></code></pre></div>
<p>With that in place, here’s how you’d extract the WAIC information from the fit object.</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="ulysses-compass.html#cb860-1"></a>b6<span class="fl">.7</span><span class="op">$</span>criteria<span class="op">$</span>waic</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 100 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -180.7  6.7
## p_waic         3.5  0.5
## waic         361.5 13.4</code></pre>
<p><em>Why would I go through all that trouble?</em>, you might ask. Well, two reasons. First, now your WAIC information is saved with all the rest of your fit output, which can be convenient. But second, it sets you up to use the <code>loo_compare()</code> function to compare models by their information criteria. To get a sense of that workflow, here we use <code>add_criterion()</code> for the next three models. Then we’ll use <code>loo_compare()</code>.</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="ulysses-compass.html#cb862-1"></a><span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb862-2"><a href="ulysses-compass.html#cb862-2"></a>b6<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.6</span>, <span class="st">&quot;waic&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.06.rds&quot;</span>)</span>
<span id="cb862-3"><a href="ulysses-compass.html#cb862-3"></a>b6<span class="fl">.8</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.8</span>, <span class="st">&quot;waic&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.08.rds&quot;</span>)</span>
<span id="cb862-4"><a href="ulysses-compass.html#cb862-4"></a></span>
<span id="cb862-5"><a href="ulysses-compass.html#cb862-5"></a><span class="co"># compare the WAIC estimates</span></span>
<span id="cb862-6"><a href="ulysses-compass.html#cb862-6"></a>w &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>,</span>
<span id="cb862-7"><a href="ulysses-compass.html#cb862-7"></a>                 <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb862-8"><a href="ulysses-compass.html#cb862-8"></a></span>
<span id="cb862-9"><a href="ulysses-compass.html#cb862-9"></a><span class="kw">print</span>(w)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff
## b6.7   0.0       0.0  
## b6.8 -20.5       4.9  
## b6.6 -22.1       5.8</code></pre>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="ulysses-compass.html#cb864-1"></a><span class="kw">print</span>(w, <span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b6.7    0.0       0.0  -180.7       6.7          3.5    0.5     361.5   13.4 
## b6.8  -20.5       4.9  -201.2       5.4          2.5    0.3     402.5   10.8 
## b6.6  -22.1       5.8  -202.9       5.7          1.5    0.2     405.7   11.3</code></pre>
<p>You don’t have to save those results as an object like we just did with <code>w</code>. But that’ll serve some pedagogical purposes in just a bit. With respect to the output, notice the <code>elpd_diff</code> column and the adjacent <code>se_diff</code> column. Those are our WAIC differences in the elpd metric. The models have been rank ordered from the highest (i.e., <code>b6.7</code>) to the highest (i.e., <code>b6.6</code>). The scores listed are the differences of <code>b6.7</code> minus the comparison model. Since <code>b6.7</code> is the comparison model in the top row, the values are naturally 0 (i.e., <span class="math inline">\(x - x = 0\)</span>). But now here’s another critical thing to understand: Since the <strong>brms</strong> version 2.8.0 update, WAIC and LOO differences are no longer reported in the <span class="math inline">\(-2 \times x\)</span> metric. Remember how multiplying <code>(lppd - pwaic)</code> by -2 is a historic artifact associated with the frequentist <span class="math inline">\(\chi^2\)</span> test? We’ll, the makers of the <strong>loo</strong> package aren’t fans and they no longer support the conversion.</p>
<p>So here’s the deal. The substantive interpretations of the differences presented in an <code>elpd_diff</code> metric will be the same as if presented in a WAIC metric. But if we want to compare our <code>elpd_diff</code> results to those in the text, we will have to multiply them by -2. And also, if we want the associated standard error in the same metric, we’ll need to multiply the <code>se_diff</code> column by 2. You wouldn’t multiply by -2 because that would return a negative standard error, which would be silly. Here’s a quick way to do those conversions.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="ulysses-compass.html#cb866-1"></a><span class="kw">cbind</span>(<span class="dt">waic_diff =</span> w[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>,</span>
<span id="cb866-2"><a href="ulysses-compass.html#cb866-2"></a>      <span class="dt">se        =</span> w[, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      waic_diff        se
## b6.7   0.00000  0.000000
## b6.8  41.03941  9.832777
## b6.6  44.28358 11.564703</code></pre>
<p>Now those match up reasonably well with the values in McElreath’s <code>dWAIC</code> and <code>dSE</code> columns.</p>
<p>One more thing. On page 227, and on many other pages to follow in the text, McElreath used the <code>rethinking::compare()</code> function to return a rich table of information about the WAIC information for several models. If we’re tricky, we can do something similar with <code>loo_compare</code>. To learn how, let’s peer further into the structure of our <code>w</code> object.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="ulysses-compass.html#cb868-1"></a><span class="kw">str</span>(w)</span></code></pre></div>
<pre><code>##  &#39;compare.loo&#39; num [1:3, 1:8] 0 -20.52 -22.14 0 4.92 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:3] &quot;b6.7&quot; &quot;b6.8&quot; &quot;b6.6&quot;
##   ..$ : chr [1:8] &quot;elpd_diff&quot; &quot;se_diff&quot; &quot;elpd_waic&quot; &quot;se_elpd_waic&quot; ...</code></pre>
<p>When we used <code>print(w)</code>, a few code blocks earlier, it only returned two columns. It appears we actually have eight. We can see the full output with the <code>simplify = F</code> argument.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="ulysses-compass.html#cb870-1"></a><span class="kw">print</span>(w, <span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b6.7    0.0       0.0  -180.7       6.7          3.5    0.5     361.5   13.4 
## b6.8  -20.5       4.9  -201.2       5.4          2.5    0.3     402.5   10.8 
## b6.6  -22.1       5.8  -202.9       5.7          1.5    0.2     405.7   11.3</code></pre>
<p>The results are quite analogous to those from <code>rethinking::compare()</code>. Again, the difference estimates are in the metric of the <span class="math inline">\(\text{elpd}\)</span>. But the interpretation is the same and we can convert them to the traditional information criteria metric with simple multiplication. As we’ll see later, this basic workflow also applies to the PSIS-LOO.</p>
<p>Okay, we’ve deviated a bit from the text. Let’s reign things back in and note that right after McElreath’s <strong>R</strong> code 7.26, he wrote: “PSIS will give you almost identical values. You can add <code>func=PSIS</code> to the <code>compare</code> call to check” (p. 227). Our <code>brms::loo_compare()</code> function has a similar argument, but it’s called <code>criterion</code>. We set it to <code>criterion = "waic"</code> to compare the models by the WAIC. What McElreath is calling <code>func=PSIS</code>, we’d call <code>criterion = "loo"</code>. Either way, we’re asking the software the compare the models using leave-one-out cross-validation with Pareto-smoothed importance sampling.</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="ulysses-compass.html#cb872-1"></a>b6<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.6</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.06.rds&quot;</span>)</span>
<span id="cb872-2"><a href="ulysses-compass.html#cb872-2"></a>b6<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.7</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.07.rds&quot;</span>)</span>
<span id="cb872-3"><a href="ulysses-compass.html#cb872-3"></a>b6<span class="fl">.8</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b6<span class="fl">.8</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b06.08.rds&quot;</span>)</span>
<span id="cb872-4"><a href="ulysses-compass.html#cb872-4"></a></span>
<span id="cb872-5"><a href="ulysses-compass.html#cb872-5"></a><span class="co"># compare the WAIC estimates</span></span>
<span id="cb872-6"><a href="ulysses-compass.html#cb872-6"></a><span class="kw">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb872-7"><a href="ulysses-compass.html#cb872-7"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b6.7    0.0       0.0  -180.7      6.7         3.5    0.5    361.5   13.4  
## b6.8  -20.5       4.9  -201.3      5.4         2.5    0.3    402.5   10.8  
## b6.6  -22.1       5.8  -202.9      5.7         1.5    0.2    405.7   11.3</code></pre>
<p>Yep, the LOO values are very similar to those from the WAIC. Anyway, at the bottom of page 227, McElreath showed how to compute the standard error of the WAIC difference for models <code>m6.7</code> and <code>m6.8</code>. Here’s the procedure for us.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="ulysses-compass.html#cb874-1"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(b6<span class="fl">.7</span><span class="op">$</span>criteria<span class="op">$</span>waic<span class="op">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>])</span>
<span id="cb874-2"><a href="ulysses-compass.html#cb874-2"></a></span>
<span id="cb874-3"><a href="ulysses-compass.html#cb874-3"></a><span class="kw">tibble</span>(<span class="dt">waic_b6.7 =</span> b6<span class="fl">.7</span><span class="op">$</span>criteria<span class="op">$</span>waic<span class="op">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>],</span>
<span id="cb874-4"><a href="ulysses-compass.html#cb874-4"></a>       <span class="dt">waic_b6.8 =</span> b6<span class="fl">.8</span><span class="op">$</span>criteria<span class="op">$</span>waic<span class="op">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb874-5"><a href="ulysses-compass.html#cb874-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> waic_b6<span class="fl">.7</span> <span class="op">-</span><span class="st"> </span>waic_b6<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb874-6"><a href="ulysses-compass.html#cb874-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">diff_se =</span> <span class="kw">sqrt</span>(n <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(diff)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   diff_se
##     &lt;dbl&gt;
## 1    9.83</code></pre>
<p>Since we used different estimation methods (HMC versus the quadratic approximation) via different software (<code>brms::brm()</code> versus <code>rethinking::quap()</code>), we shouldn’t be surprised our values are a little different from those in the text. But we’re in the ballpark, for sure. For us, this value was in the second row of the second column in our <code>w</code> object. But remember we have to multiply that value by 2 to convert it from the <span class="math inline">\(\text{elpd}\)</span> metric to that of the WAIC.</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="ulysses-compass.html#cb876-1"></a>w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 9.832777</code></pre>
<p>Presuming the difference is Gaussian distributed, here’s our 99% interval.</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="ulysses-compass.html#cb878-1"></a>(w[<span class="dv">2</span>, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="fl">2.6</span></span></code></pre></div>
<pre><code>## [1] 15.47419 66.60463</code></pre>
<p>With our <strong>brms</strong> paradigm, we won’t get a comparison plot by inserting <code>loo_compare(b6.6, b6.7, b6.8, criterion = "waic")</code> within <code>plot()</code>. But with a little <code>[]</code> subsetting and light wrangling, we can convert the contents of our <code>w</code> object to a format suitable for plotting the WAIC estimates with <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="ulysses-compass.html#cb880-1"></a>w[, <span class="dv">7</span><span class="op">:</span><span class="dv">8</span>] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb880-2"><a href="ulysses-compass.html#cb880-2"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb880-3"><a href="ulysses-compass.html#cb880-3"></a><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;model_name&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb880-4"><a href="ulysses-compass.html#cb880-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model_name =</span> <span class="kw">fct_reorder</span>(model_name, waic, <span class="dt">.desc =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb880-5"><a href="ulysses-compass.html#cb880-5"></a><span class="st">  </span></span>
<span id="cb880-6"><a href="ulysses-compass.html#cb880-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> waic, <span class="dt">y =</span> model_name, </span>
<span id="cb880-7"><a href="ulysses-compass.html#cb880-7"></a>             <span class="dt">xmin =</span> waic <span class="op">-</span><span class="st"> </span>se_waic, </span>
<span id="cb880-8"><a href="ulysses-compass.html#cb880-8"></a>             <span class="dt">xmax =</span> waic <span class="op">+</span><span class="st"> </span>se_waic)) <span class="op">+</span></span>
<span id="cb880-9"><a href="ulysses-compass.html#cb880-9"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], </span>
<span id="cb880-10"><a href="ulysses-compass.html#cb880-10"></a>                  <span class="dt">fill =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb880-11"><a href="ulysses-compass.html#cb880-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My custom WAIC plot&quot;</span>,</span>
<span id="cb880-12"><a href="ulysses-compass.html#cb880-12"></a>       <span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb880-13"><a href="ulysses-compass.html#cb880-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-79-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>We don’t get the deviance points with this method, but that’s okay. Our primary focus is on the WAIC and its standard errors. Here’s how to hand-compute the standard error for the difference between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="ulysses-compass.html#cb881-1"></a><span class="kw">tibble</span>(<span class="dt">waic_b6.6 =</span> <span class="kw">waic</span>(b6<span class="fl">.6</span>)<span class="op">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>],</span>
<span id="cb881-2"><a href="ulysses-compass.html#cb881-2"></a>       <span class="dt">waic_b6.8 =</span> <span class="kw">waic</span>(b6<span class="fl">.8</span>)<span class="op">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>]) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb881-3"><a href="ulysses-compass.html#cb881-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> waic_b6<span class="fl">.6</span> <span class="op">-</span><span class="st"> </span>waic_b6<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb881-4"><a href="ulysses-compass.html#cb881-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">diff_se =</span> <span class="kw">sqrt</span>(n <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(diff)))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   diff_se
##     &lt;dbl&gt;
## 1    4.74</code></pre>
<p>Unlike <code>rethinking::compare()</code>, the <code>loo_compare()</code> function will not allow us to so easily pull this value by indexing with <code>@dSE</code>.</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="ulysses-compass.html#cb883-1"></a><span class="kw">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>,</span>
<span id="cb883-2"><a href="ulysses-compass.html#cb883-2"></a>                 <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span></code></pre></div>
<pre><code>##  &#39;compare.loo&#39; num [1:3, 1:8] 0 -20.52 -22.14 0 4.92 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:3] &quot;b6.7&quot; &quot;b6.8&quot; &quot;b6.6&quot;
##   ..$ : chr [1:8] &quot;elpd_diff&quot; &quot;se_diff&quot; &quot;elpd_waic&quot; &quot;se_elpd_waic&quot; ...</code></pre>
<p>However, if you really want that value, make a simple WAIC comparison between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="ulysses-compass.html#cb885-1"></a><span class="kw">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff
## b6.8  0.0       0.0   
## b6.6 -1.6       2.4</code></pre>
<p>The value we’re looking for is in the second row of the <code>se_diff</code> column. But remember this is in the <span class="math inline">\(\text{elpd}\)</span> metric. Here’s the conversion.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="ulysses-compass.html#cb887-1"></a><span class="kw">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)[<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 4.743149</code></pre>
<p>Unlike <code>rethinking::compare()</code>, our <code>brms::loo_compare()</code> (even when we <code>print(simplify = T)</code>) does not contain a <code>weight</code> column. Don’t worry; we can still compute them. We’ll just have to do so with a different function. Before we do, here’s the equation they’re based on:</p>
<p><span class="math display">\[w_i = \frac{\exp(-0.5 \Delta_i)}{\sum_j \exp(-0.5 \Delta_j)},\]</span></p>
<p>where <span class="math inline">\(w_i\)</span> is the weight for the <span class="math inline">\(i^\text{th}\)</span> model and <span class="math inline">\(\Delta_i\)</span> is the difference between that model and the WAIC for the best one in the comparison set. If you want to get those WAIC weights, you can use the <code>brms::model_weights()</code> function like so.</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="ulysses-compass.html#cb889-1"></a><span class="kw">model_weights</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, </span>
<span id="cb889-2"><a href="ulysses-compass.html#cb889-2"></a>              <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb889-3"><a href="ulysses-compass.html#cb889-3"></a><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## b6.6 b6.7 b6.8 
##    0    1    0</code></pre>
<p>In his endnote #130, McElreath discussed how these WAIC weights can be used for model averaging. From the endnote, we read:</p>
<blockquote>
<p>The first edition had a section on model averaging, but the topic has been dropped in this edition to save space. The approach is really focused on prediction, not inference, and so it doesn’t fit the flow of the second edition. But it is an important approach. (p. 565)</p>
</blockquote>
<p>A variety of approaches to model averaging are available with <strong>brms</strong> and I covered them in my <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2020" role="doc-biblioref">2020</a><a href="#ref-kurzStatisticalRethinkingBrms2020" role="doc-biblioref">a</a>)</span> ebook translation of the first edition of McElreath’s text.</p>
<div id="rethinking-waic-metaphors." class="section level4">
<h4><span class="header-section-number">7.6.1.1</span> Rethinking: WAIC metaphors.</h4>
<blockquote>
<p>Think of models as race horses. In any particular race, the best horse may not win. But it’s more likely to win than is the worst horse. And when the winning horse finishes in half the time of the second-place horse, you can be pretty sure the winning horse is also the best. But if instead it’s a photo-finish, with a near tie between first and second place, then it is much harder to be confident about which is the best horse. (p. 230)</p>
</blockquote>
</div>
</div>
<div id="outliers-and-other-illusions." class="section level3">
<h3><span class="header-section-number">7.6.2</span> Outliers and other illusions.</h3>
<p>Time to bring back the <code>WaffleDivorce</code> data.</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="ulysses-compass.html#cb891-1"></a><span class="kw">data</span>(WaffleDivorce, <span class="dt">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb891-2"><a href="ulysses-compass.html#cb891-2"></a></span>
<span id="cb891-3"><a href="ulysses-compass.html#cb891-3"></a>d &lt;-</span>
<span id="cb891-4"><a href="ulysses-compass.html#cb891-4"></a><span class="st">  </span>WaffleDivorce <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb891-5"><a href="ulysses-compass.html#cb891-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d =</span> rethinking<span class="op">::</span><span class="kw">standardize</span>(Divorce),</span>
<span id="cb891-6"><a href="ulysses-compass.html#cb891-6"></a>         <span class="dt">m =</span> rethinking<span class="op">::</span><span class="kw">standardize</span>(Marriage),</span>
<span id="cb891-7"><a href="ulysses-compass.html#cb891-7"></a>         <span class="dt">a =</span> rethinking<span class="op">::</span><span class="kw">standardize</span>(MedianAgeMarriage))</span>
<span id="cb891-8"><a href="ulysses-compass.html#cb891-8"></a></span>
<span id="cb891-9"><a href="ulysses-compass.html#cb891-9"></a><span class="kw">rm</span>(WaffleDivorce)</span></code></pre></div>
<p>Refit the divorce models from <a href="the-many-variables-the-spurious-waffles.html#spurious-associations">Section 5.1</a>.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="ulysses-compass.html#cb892-1"></a>b5<span class="fl">.1</span> &lt;-<span class="st"> </span></span>
<span id="cb892-2"><a href="ulysses-compass.html#cb892-2"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb892-3"><a href="ulysses-compass.html#cb892-3"></a>      <span class="dt">family =</span> gaussian,</span>
<span id="cb892-4"><a href="ulysses-compass.html#cb892-4"></a>      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>a,</span>
<span id="cb892-5"><a href="ulysses-compass.html#cb892-5"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb892-6"><a href="ulysses-compass.html#cb892-6"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</span>
<span id="cb892-7"><a href="ulysses-compass.html#cb892-7"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb892-8"><a href="ulysses-compass.html#cb892-8"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb892-9"><a href="ulysses-compass.html#cb892-9"></a>      <span class="dt">seed =</span> <span class="dv">5</span>,</span>
<span id="cb892-10"><a href="ulysses-compass.html#cb892-10"></a>      <span class="dt">sample_prior =</span> T,</span>
<span id="cb892-11"><a href="ulysses-compass.html#cb892-11"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b05.01&quot;</span>)</span>
<span id="cb892-12"><a href="ulysses-compass.html#cb892-12"></a></span>
<span id="cb892-13"><a href="ulysses-compass.html#cb892-13"></a>b5<span class="fl">.2</span> &lt;-<span class="st"> </span></span>
<span id="cb892-14"><a href="ulysses-compass.html#cb892-14"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb892-15"><a href="ulysses-compass.html#cb892-15"></a>      <span class="dt">family =</span> gaussian,</span>
<span id="cb892-16"><a href="ulysses-compass.html#cb892-16"></a>      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m,</span>
<span id="cb892-17"><a href="ulysses-compass.html#cb892-17"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb892-18"><a href="ulysses-compass.html#cb892-18"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</span>
<span id="cb892-19"><a href="ulysses-compass.html#cb892-19"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb892-20"><a href="ulysses-compass.html#cb892-20"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb892-21"><a href="ulysses-compass.html#cb892-21"></a>      <span class="dt">seed =</span> <span class="dv">5</span>,</span>
<span id="cb892-22"><a href="ulysses-compass.html#cb892-22"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b05.02&quot;</span>)</span>
<span id="cb892-23"><a href="ulysses-compass.html#cb892-23"></a></span>
<span id="cb892-24"><a href="ulysses-compass.html#cb892-24"></a>b5<span class="fl">.3</span> &lt;-<span class="st"> </span></span>
<span id="cb892-25"><a href="ulysses-compass.html#cb892-25"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb892-26"><a href="ulysses-compass.html#cb892-26"></a>      <span class="dt">family =</span> gaussian,</span>
<span id="cb892-27"><a href="ulysses-compass.html#cb892-27"></a>      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m <span class="op">+</span><span class="st"> </span>a,</span>
<span id="cb892-28"><a href="ulysses-compass.html#cb892-28"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb892-29"><a href="ulysses-compass.html#cb892-29"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</span>
<span id="cb892-30"><a href="ulysses-compass.html#cb892-30"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb892-31"><a href="ulysses-compass.html#cb892-31"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb892-32"><a href="ulysses-compass.html#cb892-32"></a>      <span class="dt">seed =</span> <span class="dv">5</span>,</span>
<span id="cb892-33"><a href="ulysses-compass.html#cb892-33"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</span></code></pre></div>
<p>Compute and save the LOO estimates for each.</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="ulysses-compass.html#cb893-1"></a>b5<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b5<span class="fl">.1</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b05.01&quot;</span>)</span>
<span id="cb893-2"><a href="ulysses-compass.html#cb893-2"></a>b5<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b5<span class="fl">.2</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b05.02&quot;</span>)</span>
<span id="cb893-3"><a href="ulysses-compass.html#cb893-3"></a>b5<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b5<span class="fl">.3</span>, <span class="st">&quot;loo&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</span></code></pre></div>
<p>Now compare the models by the PSIS-LOO-CV.</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="ulysses-compass.html#cb894-1"></a><span class="kw">loo_compare</span>(b5<span class="fl">.1</span>, b5<span class="fl">.2</span>, b5<span class="fl">.3</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb894-2"><a href="ulysses-compass.html#cb894-2"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b5.1   0.0       0.0   -62.9      6.4         3.6   1.8    125.7  12.8   
## b5.3  -1.0       0.4   -63.8      6.4         4.8   1.9    127.7  12.9   
## b5.2  -6.8       4.6   -69.7      4.9         3.0   0.9    139.3   9.9</code></pre>
<p>Like in the text, our <code>b5.1</code> has the best LOO estimate, but only by a little bit when compared to <code>b5.3</code>. Unlike McElreath reported in the text, we did not get a warning message from <code>loo_compare()</code>. Let’s investigate more carefully with the <code>loo()</code> function.</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="ulysses-compass.html#cb896-1"></a><span class="kw">loo</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo    -63.8  6.4
## p_loo         4.8  1.9
## looic       127.7 12.9
## ------
## Monte Carlo SE of elpd_loo is 0.1.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     49    98.0%   901       
##  (0.5, 0.7]   (ok)        1     2.0%   127       
##    (0.7, 1]   (bad)       0     0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>One of the observations was in the <code>(ok)</code> range, but none were in the <code>(bad)</code> or <code>(very bad)</code> ranges. By opening the <strong>loo</strong> package directly, we gain access to the <code>pareto_k_ids()</code> function, which will help us identify which observation crossed out of the <code>(good)</code> range into the <code>(ok)</code>.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="ulysses-compass.html#cb898-1"></a><span class="kw">library</span>(loo)</span>
<span id="cb898-2"><a href="ulysses-compass.html#cb898-2"></a></span>
<span id="cb898-3"><a href="ulysses-compass.html#cb898-3"></a><span class="kw">loo</span>(b5<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb898-4"><a href="ulysses-compass.html#cb898-4"></a><span class="st">  </span><span class="kw">pareto_k_ids</span>(<span class="dt">threshold =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p>The number <code>13</code> refers to the corresponding row in the data used to fit the model. We can access that row directly with the <code>dplyr::slice()</code> function.</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="ulysses-compass.html#cb900-1"></a>d <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb900-2"><a href="ulysses-compass.html#cb900-2"></a><span class="st">  </span><span class="kw">slice</span>(<span class="dv">13</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb900-3"><a href="ulysses-compass.html#cb900-3"></a><span class="st">  </span><span class="kw">select</span>(Location<span class="op">:</span>Loc)</span></code></pre></div>
<pre><code>##   Location Loc
## 1    Idaho  ID</code></pre>
<p>Here we subset the 13<sup>th</sup> cell in the <code>loo::pareto_k_values()</code> output to see what that value was.</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="ulysses-compass.html#cb902-1"></a><span class="kw">pareto_k_values</span>(<span class="kw">loo</span>(b5<span class="fl">.3</span>))[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1] 0.6813662</code></pre>
<p>Alternatively, we could have extracted that value from our <code>b5.3</code> fit object like so.</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="ulysses-compass.html#cb904-1"></a>b5<span class="fl">.3</span><span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1] 0.6813662</code></pre>
<p>0.68 is a little high, but not high enough to cause <code>loo()</code> to return a warning message. Once a Pareto <span class="math inline">\(k\)</span> value crosses the 0.7 threshold, though, the <strong>loo</strong> package will bark. Before we make our version of Figure 7.10, we’ll want to compute the WAIC for <code>b5.3</code>. That will give us access to the <span class="math inline">\(p_\text{WAIC}\)</span>.</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="ulysses-compass.html#cb906-1"></a>b5<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b5<span class="fl">.3</span>, <span class="st">&quot;waic&quot;</span>, <span class="dt">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</span></code></pre></div>
<p>We’re ready to make our version of Figure 7.10.</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="ulysses-compass.html#cb907-1"></a><span class="kw">tibble</span>(<span class="dt">pareto_k =</span> b5<span class="fl">.3</span><span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k,</span>
<span id="cb907-2"><a href="ulysses-compass.html#cb907-2"></a>       <span class="dt">p_waic   =</span> b5<span class="fl">.3</span><span class="op">$</span>criteria<span class="op">$</span>waic<span class="op">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb907-3"><a href="ulysses-compass.html#cb907-3"></a>       <span class="dt">Loc      =</span> <span class="kw">pull</span>(d, Loc)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb907-4"><a href="ulysses-compass.html#cb907-4"></a><span class="st">  </span></span>
<span id="cb907-5"><a href="ulysses-compass.html#cb907-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pareto_k, <span class="dt">y =</span> p_waic, <span class="dt">color =</span> Loc <span class="op">==</span><span class="st"> &quot;ID&quot;</span>)) <span class="op">+</span></span>
<span id="cb907-6"><a href="ulysses-compass.html#cb907-6"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.5</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb907-7"><a href="ulysses-compass.html#cb907-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Loc <span class="op">==</span><span class="st"> &quot;ID&quot;</span>)) <span class="op">+</span></span>
<span id="cb907-8"><a href="ulysses-compass.html#cb907-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(p_waic <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>),</span>
<span id="cb907-9"><a href="ulysses-compass.html#cb907-9"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> pareto_k <span class="op">-</span><span class="st"> </span><span class="fl">0.03</span>, <span class="dt">label =</span> Loc),</span>
<span id="cb907-10"><a href="ulysses-compass.html#cb907-10"></a>            <span class="dt">hjust =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb907-11"><a href="ulysses-compass.html#cb907-11"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb907-12"><a href="ulysses-compass.html#cb907-12"></a><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="op">+</span></span>
<span id="cb907-13"><a href="ulysses-compass.html#cb907-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Gaussian model (b5.3)&quot;</span>) <span class="op">+</span></span>
<span id="cb907-14"><a href="ulysses-compass.html#cb907-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-94-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>For both the Pareto <span class="math inline">\(k\)</span> and the <span class="math inline">\(p_\text{WAIC}\)</span>, our values are not as extreme as those McElreath reported in the text. I’m not sure if this is a consequence of us using HMC or due to recent algorithmic changes for the Stan/<strong>loo</strong> teams. But at least the overall pattern is the same. Idaho is the most extreme/influential case.</p>
<p>In the text (p. 232), McElreath reported the effective number of parameters for <code>b5.3</code> was nearly 6. We can look at this with the <code>waic()</code> function.</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="ulysses-compass.html#cb908-1"></a><span class="kw">waic</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic    -63.7  6.3
## p_waic         4.6  1.8
## waic         127.3 12.7
## 
## 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>Our <span class="math inline">\(p_\text{WAIC}\)</span> was about 4.6, which is still a little high due to Idaho but not quite as high as in the text. There is some concern that Idaho is putting us at risk of overfitting due to the large influence it has on the posterior.</p>
<blockquote>
<p>What can be done about this? There is a tradition of dropping outliers. People sometimes drop outliers even before a model is fit, based only on standard deviations from the mean outcome value. You should never do that–a point can only be unexpected and highly influential in light of a model. After you fit a model, the picture changes. If there are only a few outliers, and you are sure to report results both with and without them, dropping outliers might be okay. But if there are several outliers and we really need to model them, what then?</p>
<p>A basic problem here is that the Gaussian error model is easily surprised. (p. 232)</p>
</blockquote>
<p>This surprise has to do with the thinness of its tails relative to those of the Student’s <span class="math inline">\(t\)</span>-distribution. We can get a sense of this with Figure 7.11.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="ulysses-compass.html#cb910-1"></a><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-6</span>, <span class="dt">to =</span> <span class="dv">6</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb910-2"><a href="ulysses-compass.html#cb910-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Gaussian    =</span> <span class="kw">dnorm</span>(x),</span>
<span id="cb910-3"><a href="ulysses-compass.html#cb910-3"></a>         <span class="st">`</span><span class="dt">Student-t</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dstudent</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb910-4"><a href="ulysses-compass.html#cb910-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>x,</span>
<span id="cb910-5"><a href="ulysses-compass.html#cb910-5"></a>               <span class="dt">names_to =</span> <span class="st">&quot;likelihood&quot;</span>,</span>
<span id="cb910-6"><a href="ulysses-compass.html#cb910-6"></a>               <span class="dt">values_to =</span> <span class="st">&quot;density&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb910-7"><a href="ulysses-compass.html#cb910-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">minus log density</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="kw">log</span>(density)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb910-8"><a href="ulysses-compass.html#cb910-8"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">contains</span>(<span class="st">&quot;density&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb910-9"><a href="ulysses-compass.html#cb910-9"></a><span class="st">  </span></span>
<span id="cb910-10"><a href="ulysses-compass.html#cb910-10"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> value, <span class="dt">group =</span> likelihood, <span class="dt">color =</span> likelihood)) <span class="op">+</span></span>
<span id="cb910-11"><a href="ulysses-compass.html#cb910-11"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb910-12"><a href="ulysses-compass.html#cb910-12"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></span>
<span id="cb910-13"><a href="ulysses-compass.html#cb910-13"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb910-14"><a href="ulysses-compass.html#cb910-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;value&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb910-15"><a href="ulysses-compass.html#cb910-15"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></span>
<span id="cb910-16"><a href="ulysses-compass.html#cb910-16"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-96-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>I’m a little baffled as to why our curves don’t quite match up with those in the text. The Gaussian curves were made using the <code>dnorm()</code> function with the default settings, which are <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span>. The Student-<span class="math inline">\(t\)</span> curves were made with McElreath’s <code>rethinking::dstudent()</code>function with the default settings, which are <span class="math inline">\(\operatorname{Student-t}(2, 0, 1)\)</span>–you get the same results is you use <code>dt(x, df = 2)</code>. Discrepancies aside, the main point in the text still stands. The <span class="math inline">\(t\)</span> distribution, especially as <span class="math inline">\(\nu \rightarrow 1\)</span>, has thicker tails than the Gaussian. As a consequence, it is more robust to extreme values.</p>
<p>The <strong>brms</strong> package will allow us to fit a Student <span class="math inline">\(t\)</span> model. Just set <code>family = student</code>. We are at liberty to estimate <span class="math inline">\(nu\)</span> along with the other parameters in the model or to set it to a constant. We’ll follow McElreath and fix <code>nu = 2</code>. Note that <strong>brms</strong> syntax requires we do so within a <code>bf()</code> statement.</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="ulysses-compass.html#cb911-1"></a>b5<span class="fl">.3</span>t &lt;-<span class="st"> </span></span>
<span id="cb911-2"><a href="ulysses-compass.html#cb911-2"></a><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </span>
<span id="cb911-3"><a href="ulysses-compass.html#cb911-3"></a>      <span class="dt">family =</span> student,</span>
<span id="cb911-4"><a href="ulysses-compass.html#cb911-4"></a>      <span class="kw">bf</span>(d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m <span class="op">+</span><span class="st"> </span>a, <span class="dt">nu =</span> <span class="dv">2</span>),</span>
<span id="cb911-5"><a href="ulysses-compass.html#cb911-5"></a>      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</span>
<span id="cb911-6"><a href="ulysses-compass.html#cb911-6"></a>                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</span>
<span id="cb911-7"><a href="ulysses-compass.html#cb911-7"></a>                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</span>
<span id="cb911-8"><a href="ulysses-compass.html#cb911-8"></a>      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</span>
<span id="cb911-9"><a href="ulysses-compass.html#cb911-9"></a>      <span class="dt">seed =</span> <span class="dv">5</span>,</span>
<span id="cb911-10"><a href="ulysses-compass.html#cb911-10"></a>      <span class="dt">file =</span> <span class="st">&quot;fits/b05.03t&quot;</span>)</span></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="ulysses-compass.html#cb912-1"></a><span class="kw">print</span>(b5<span class="fl">.3</span>t)</span></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: d ~ 1 + m + a 
##          nu = 2
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.02      0.10    -0.17     0.22 1.00     4082     3105
## m             0.05      0.21    -0.33     0.47 1.00     3413     2675
## a            -0.70      0.15    -0.99    -0.41 1.00     3531     3041
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.58      0.09     0.43     0.77 1.00     4379     2728
## nu        2.00      0.00     2.00     2.00 1.00     4000     4000
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we use the <code>add_criterion()</code> function compute both the LOO-CV and the WAIC and add them to the model fit object.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="ulysses-compass.html#cb914-1"></a>b5<span class="fl">.3</span>t &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b5<span class="fl">.3</span>t, <span class="kw">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>), <span class="dt">file =</span> <span class="st">&quot;fits/b05.03t&quot;</span>)</span></code></pre></div>
<p>Now we might remake the plot from Figure 7.10, this time based on the <span class="math inline">\(t\)</span> model.</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="ulysses-compass.html#cb915-1"></a><span class="kw">tibble</span>(<span class="dt">pareto_k =</span> b5<span class="fl">.3</span>t<span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k,</span>
<span id="cb915-2"><a href="ulysses-compass.html#cb915-2"></a>       <span class="dt">p_waic   =</span> b5<span class="fl">.3</span>t<span class="op">$</span>criteria<span class="op">$</span>waic<span class="op">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb915-3"><a href="ulysses-compass.html#cb915-3"></a>       <span class="dt">Loc      =</span> <span class="kw">pull</span>(d, Loc)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb915-4"><a href="ulysses-compass.html#cb915-4"></a><span class="st">  </span></span>
<span id="cb915-5"><a href="ulysses-compass.html#cb915-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pareto_k, <span class="dt">y =</span> p_waic, <span class="dt">color =</span> Loc <span class="op">==</span><span class="st"> &quot;ID&quot;</span>)) <span class="op">+</span></span>
<span id="cb915-6"><a href="ulysses-compass.html#cb915-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> Loc <span class="op">==</span><span class="st"> &quot;ID&quot;</span>)) <span class="op">+</span></span>
<span id="cb915-7"><a href="ulysses-compass.html#cb915-7"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;ME&quot;</span>)),</span>
<span id="cb915-8"><a href="ulysses-compass.html#cb915-8"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> pareto_k <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span>, <span class="dt">label =</span> Loc),</span>
<span id="cb915-9"><a href="ulysses-compass.html#cb915-9"></a>            <span class="dt">hjust =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb915-10"><a href="ulysses-compass.html#cb915-10"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="op">+</span></span>
<span id="cb915-11"><a href="ulysses-compass.html#cb915-11"></a><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="op">+</span></span>
<span id="cb915-12"><a href="ulysses-compass.html#cb915-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Student-t model (b5.3t)&quot;</span>) <span class="op">+</span></span>
<span id="cb915-13"><a href="ulysses-compass.html#cb915-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-99-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>The high points in both the Pareto <span class="math inline">\(k\)</span> and <span class="math inline">\(p_\text{WAIC}\)</span> are much smaller and both ID and ME are now closer to the center of the bivariate distribution. We can formally compare the models with the WAIC and the LOO.</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="ulysses-compass.html#cb916-1"></a><span class="kw">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic  se_waic
## b5.3    0.0       0.0   -63.7       6.3          4.6    1.8     127.3  12.7  
## b5.3t  -2.8       2.9   -66.5       5.8          6.3    1.0     133.0  11.6</code></pre>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="ulysses-compass.html#cb918-1"></a><span class="kw">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b5.3    0.0       0.0   -63.8      6.4         4.8   1.9    127.7  12.9   
## b5.3t  -2.6       3.0   -66.5      5.8         6.2   1.0    132.9  11.6</code></pre>
<p>For both criteria, the standard error for the difference was about the same size as the difference itself. This suggests the models were close and hard to distinguish with respect to their fit to the data. This will not always be the case.</p>
<p>Just for kicks and giggles, let’s compare the parameter summaries for the two models in a coefficient plot.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="ulysses-compass.html#cb920-1"></a><span class="kw">bind_rows</span>(<span class="kw">posterior_samples</span>(b5<span class="fl">.3</span>),</span>
<span id="cb920-2"><a href="ulysses-compass.html#cb920-2"></a>          <span class="kw">posterior_samples</span>(b5<span class="fl">.3</span>t)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb920-3"><a href="ulysses-compass.html#cb920-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Gaussian (b5.3)&quot;</span>, <span class="st">&quot;Student-t (b5.3t)&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb920-4"><a href="ulysses-compass.html#cb920-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(b_Intercept<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb920-5"><a href="ulysses-compass.html#cb920-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name,</span>
<span id="cb920-6"><a href="ulysses-compass.html#cb920-6"></a>                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_a&quot;</span>, <span class="st">&quot;b_m&quot;</span>, <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb920-7"><a href="ulysses-compass.html#cb920-7"></a>                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta[a]&quot;</span>, <span class="st">&quot;beta[m]&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb920-8"><a href="ulysses-compass.html#cb920-8"></a><span class="st">  </span></span>
<span id="cb920-9"><a href="ulysses-compass.html#cb920-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> fit, <span class="dt">color =</span> fit)) <span class="op">+</span></span>
<span id="cb920-10"><a href="ulysses-compass.html#cb920-10"></a><span class="st">  </span><span class="kw">stat_pointinterval</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb920-11"><a href="ulysses-compass.html#cb920-11"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></span>
<span id="cb920-12"><a href="ulysses-compass.html#cb920-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb920-13"><a href="ulysses-compass.html#cb920-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb920-14"><a href="ulysses-compass.html#cb920-14"></a>        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb920-15"><a href="ulysses-compass.html#cb920-15"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb920-16"><a href="ulysses-compass.html#cb920-16"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb920-17"><a href="ulysses-compass.html#cb920-17"></a>        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)) <span class="op">+</span></span>
<span id="cb920-18"><a href="ulysses-compass.html#cb920-18"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-101-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>Overall, the coefficients are very similar between the two models. The most notable difference is in <span class="math inline">\(\sigma\)</span>. This is, in part, because <span class="math inline">\(\sigma\)</span> has a slightly different meaning for Student-<span class="math inline">\(t\)</span> models than it does for the Gaussian. For both, we can refer to <span class="math inline">\(\sigma\)</span> as the <em>scale</em> parameter, with is a measure of spread or variability around the mean. However, the scale is the same thing as the standard deviation only for the Gaussian. Kruschke walked this out nicely:</p>
<blockquote>
<p>It is important to understand that the scale parameter <span class="math inline">\(\sigma\)</span> in the <span class="math inline">\(t\)</span> distribution is not the standard deviation of the distribution. (Recall that the standard deviation is the square root of the variance, which is the expected value of the squared deviation from the mean, as defined back in Equation 4.8, p. 86.) The standard deviation is actually larger than <span class="math inline">\(\sigma\)</span> because of the heavy tails. In fact, when <span class="math inline">\(\nu\)</span>drops below 2 (but is still <span class="math inline">\(\geq 1\)</span>), the standard deviation of the mathematical <span class="math inline">\(t\)</span> distribution goes to infinity. <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>, p. 159)</span></p>
</blockquote>
<p>The variance for <span class="math inline">\(\operatorname{Student-t}(\nu, 0, 1)\)</span> is</p>
<p><span class="math display">\[\frac{\nu}{\nu-2} \text{ for }  \nu &gt;2, \;\;\; \infty \text{ for } 1 &lt; \nu \leq 2,\]</span></p>
<p>and the standard deviation is the square of that. To give a sense of how that formula works, here are the standard deviation values when <span class="math inline">\(\nu\)</span> ranges from 2.1 to 20.</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="ulysses-compass.html#cb921-1"></a><span class="co"># for the annotation</span></span>
<span id="cb921-2"><a href="ulysses-compass.html#cb921-2"></a>text &lt;-</span>
<span id="cb921-3"><a href="ulysses-compass.html#cb921-3"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">nu =</span> <span class="kw">c</span>(<span class="fl">1.35</span>, <span class="dv">20</span>),</span>
<span id="cb921-4"><a href="ulysses-compass.html#cb921-4"></a>         <span class="dt">sd =</span> <span class="kw">c</span>(<span class="kw">sqrt</span>(<span class="fl">2.1</span> <span class="op">/</span><span class="st"> </span>(<span class="fl">2.1</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)), <span class="fl">0.875</span>),</span>
<span id="cb921-5"><a href="ulysses-compass.html#cb921-5"></a>         <span class="dt">angle =</span> <span class="kw">c</span>(<span class="dv">90</span>, <span class="dv">0</span>),</span>
<span id="cb921-6"><a href="ulysses-compass.html#cb921-6"></a>         <span class="dt">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb921-7"><a href="ulysses-compass.html#cb921-7"></a>         <span class="dt">label =</span> <span class="st">&quot;asymptote&quot;</span>)</span>
<span id="cb921-8"><a href="ulysses-compass.html#cb921-8"></a></span>
<span id="cb921-9"><a href="ulysses-compass.html#cb921-9"></a><span class="co"># wrangle</span></span>
<span id="cb921-10"><a href="ulysses-compass.html#cb921-10"></a><span class="kw">tibble</span>(<span class="dt">nu =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">2.1</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb921-11"><a href="ulysses-compass.html#cb921-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">var =</span> nu <span class="op">/</span><span class="st"> </span>(nu <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb921-12"><a href="ulysses-compass.html#cb921-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sd =</span> <span class="kw">sqrt</span>(var)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb921-13"><a href="ulysses-compass.html#cb921-13"></a><span class="st">  </span></span>
<span id="cb921-14"><a href="ulysses-compass.html#cb921-14"></a><span class="st">  </span><span class="co"># plot</span></span>
<span id="cb921-15"><a href="ulysses-compass.html#cb921-15"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> nu, <span class="dt">y =</span> sd)) <span class="op">+</span></span>
<span id="cb921-16"><a href="ulysses-compass.html#cb921-16"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb921-17"><a href="ulysses-compass.html#cb921-17"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb921-18"><a href="ulysses-compass.html#cb921-18"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</span>
<span id="cb921-19"><a href="ulysses-compass.html#cb921-19"></a>            <span class="kw">aes</span>(<span class="dt">label =</span> label, <span class="dt">angle =</span> angle, <span class="dt">hjust =</span> hjust),</span>
<span id="cb921-20"><a href="ulysses-compass.html#cb921-20"></a>            <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">3</span>]) <span class="op">+</span></span>
<span id="cb921-21"><a href="ulysses-compass.html#cb921-21"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb921-22"><a href="ulysses-compass.html#cb921-22"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(nu), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb921-23"><a href="ulysses-compass.html#cb921-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">expression</span>(Student<span class="op">-</span><span class="kw">t</span>(nu<span class="op">*</span><span class="st">&#39;, &#39;</span><span class="op">*</span><span class="dv">0</span><span class="op">*</span><span class="st">&#39;, &#39;</span><span class="op">*</span><span class="dv">1</span>)),</span>
<span id="cb921-24"><a href="ulysses-compass.html#cb921-24"></a>       <span class="dt">y =</span> <span class="kw">expression</span>(standard<span class="op">~</span>deviation<span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="er">~</span><span class="kw">sqrt</span>(nu<span class="op">/</span>(nu<span class="dv">-2</span>))))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-102-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>As <span class="math inline">\(\nu \rightarrow \infty\)</span>, the standard deviation approaches the scale, <span class="math inline">\(\sigma\)</span>. We’ll have more practice with robust Student’s <span class="math inline">\(t\)</span> regression later on. In the mean time, you might check out chapters <a href="https://bookdown.org/content/3686/metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution">16</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression">17</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation.">18</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-one-nominal-predictor.html#the-two-group-case.">19</a>, and <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-nominal-predictors.html#heterogeneous-variances-and-robustness-against-outliers-1">20</a> from my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">2020</a><a href="#ref-kurzDoingBayesianData2020" role="doc-biblioref">c</a>)</span> ebook translation of Kruschke’s text. I’ve also blogged on using the robust Student’s <span class="math inline">\(t\)</span> for <a href="https://solomonkurz.netlify.app/post/robust-linear-regression-with-the-robust-student-s-t-distribution/">regression</a> and <a href="https://solomonkurz.netlify.app/post/bayesian-robust-correlations-with-brms-and-why-you-should-love-student-s-t/">correlations</a>.</p>
<div id="rethinking-the-curse-of-tippecanoe." class="section level4">
<h4><span class="header-section-number">7.6.2.1</span> Rethinking: The Curse of Tippecanoe.</h4>
<blockquote>
<p>One concern with model comparison is, if we try enough combinations and transformations of predictors, we might eventually find a model that fits any sample very well. But this fit will be badly overfit, unlikely to generalize….</p>
<p>Fiddling with and constructing many predictor variables is a great way to find coincidences, but not necessarily a great way to evaluate hypotheses. However, fitting many possible models isn’t always a dangerous idea, provided some judgment is exercised in weeding down the list of variables at the start. There are two scenarios in which this strategy appears defensible. First, sometimes all one wants to do is explore a set of data, because there are no clear hypotheses to evaluate. This is rightly labeled pejoratively as <strong>data dredging</strong>, when one does not admit to it. But when used together with model averaging, and freely admitted, it can be a way to stimulate future investigation. Second, sometimes we need to convince an audience that we have tried all of the combinations of predictors, because none of the variables seem to help much in prediction. (p. 234, <strong>emphasis</strong> in the original)</p>
</blockquote>
</div>
</div>
</div>
<div id="summary-bonus-r2-talk" class="section level2">
<h2><span class="header-section-number">7.7</span> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</h2>
<p>At the beginning of the chapter (pp. 193–201), McElreath introduced <span class="math inline">\(R^2\)</span> as a popular way to assess the variance explained in a model. He pooh-poohed it because of its tendency to overfit. It’s also limited in that it doesn’t generalize well outside of the single-level Gaussian framework, which will be a big deal for us starting in <a href="big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model">Chapter 10</a>. However, if you should find yourself in a situation where <span class="math inline">\(R^2\)</span> suits your purposes, the <strong>brms</strong> <code>bayes_R2()</code> function might be of use. Simply feeding a model <code>brm()</code> fit object into <code>bayes_R2()</code> will return the posterior mean, <span class="math inline">\(SD\)</span>, and 95% intervals. For example:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="ulysses-compass.html#cb922-1"></a><span class="kw">bayes_R2</span>(b5<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    Estimate Est.Error  Q2.5 Q97.5
## R2    0.332     0.088 0.147 0.481</code></pre>
<p>With just a little data processing, you can get a tibble table of each of models’ <span class="math inline">\(R^2\)</span> ‘Estimate’.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="ulysses-compass.html#cb924-1"></a><span class="kw">rbind</span>(<span class="kw">bayes_R2</span>(b5<span class="fl">.1</span>), </span>
<span id="cb924-2"><a href="ulysses-compass.html#cb924-2"></a>      <span class="kw">bayes_R2</span>(b5<span class="fl">.2</span>), </span>
<span id="cb924-3"><a href="ulysses-compass.html#cb924-3"></a>      <span class="kw">bayes_R2</span>(b5<span class="fl">.3</span>)) <span class="op">%&gt;%</span></span>
<span id="cb924-4"><a href="ulysses-compass.html#cb924-4"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb924-5"><a href="ulysses-compass.html#cb924-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model                   =</span> <span class="kw">c</span>(<span class="st">&quot;b5.1&quot;</span>, <span class="st">&quot;b5.2&quot;</span>, <span class="st">&quot;b5.3&quot;</span>),</span>
<span id="cb924-6"><a href="ulysses-compass.html#cb924-6"></a>         <span class="dt">r_square_posterior_mean =</span> <span class="kw">round</span>(Estimate, <span class="dt">digits =</span> <span class="dv">3</span>)) <span class="op">%&gt;%</span></span>
<span id="cb924-7"><a href="ulysses-compass.html#cb924-7"></a><span class="st">  </span><span class="kw">select</span>(model, r_square_posterior_mean)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   model r_square_posterior_mean
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 b5.1                    0.327
## 2 b5.2                    0.129
## 3 b5.3                    0.332</code></pre>
<p>If you want the full distribution of the <span class="math inline">\(R^2\)</span>, you’ll need to add a <code>summary = F</code> argument. Note how this returns a numeric vector.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="ulysses-compass.html#cb926-1"></a>r2_b5<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="dt">summary =</span> F)</span>
<span id="cb926-2"><a href="ulysses-compass.html#cb926-2"></a></span>
<span id="cb926-3"><a href="ulysses-compass.html#cb926-3"></a>r2_b5<span class="fl">.1</span> <span class="op">%&gt;%</span></span>
<span id="cb926-4"><a href="ulysses-compass.html#cb926-4"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>##  num [1:4000, 1] 0.258 0.281 0.217 0.225 0.463 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr &quot;R2&quot;</code></pre>
<p>If you want to use these in <strong>ggplot2</strong>, you’ll need to put them in tibbles or data frames. Here we do so for two of our model fits.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="ulysses-compass.html#cb928-1"></a>r2 &lt;-</span>
<span id="cb928-2"><a href="ulysses-compass.html#cb928-2"></a><span class="st">  </span><span class="kw">cbind</span>(<span class="kw">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="dt">summary =</span> F),</span>
<span id="cb928-3"><a href="ulysses-compass.html#cb928-3"></a>        <span class="kw">bayes_R2</span>(b5<span class="fl">.2</span>, <span class="dt">summary =</span> F)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb928-4"><a href="ulysses-compass.html#cb928-4"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb928-5"><a href="ulysses-compass.html#cb928-5"></a><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="st">&quot;b5.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) </span>
<span id="cb928-6"><a href="ulysses-compass.html#cb928-6"></a>  </span>
<span id="cb928-7"><a href="ulysses-compass.html#cb928-7"></a>r2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb928-8"><a href="ulysses-compass.html#cb928-8"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb928-9"><a href="ulysses-compass.html#cb928-9"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b5<span class="fl">.1</span>),</span>
<span id="cb928-10"><a href="ulysses-compass.html#cb928-10"></a>               <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">4</span>]) <span class="op">+</span></span>
<span id="cb928-11"><a href="ulysses-compass.html#cb928-11"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b5<span class="fl">.2</span>),</span>
<span id="cb928-12"><a href="ulysses-compass.html#cb928-12"></a>               <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>]) <span class="op">+</span></span>
<span id="cb928-13"><a href="ulysses-compass.html#cb928-13"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb928-14"><a href="ulysses-compass.html#cb928-14"></a>           <span class="dt">x =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.34</span>), <span class="dt">y =</span> <span class="fl">3.5</span>, </span>
<span id="cb928-15"><a href="ulysses-compass.html#cb928-15"></a>           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;b5.2&quot;</span>, <span class="st">&quot;b5.1&quot;</span>), </span>
<span id="cb928-16"><a href="ulysses-compass.html#cb928-16"></a>           <span class="dt">color =</span> <span class="kw">alpha</span>(<span class="st">&quot;white&quot;</span>, <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="op">+</span></span>
<span id="cb928-17"><a href="ulysses-compass.html#cb928-17"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb928-18"><a href="ulysses-compass.html#cb928-18"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb928-19"><a href="ulysses-compass.html#cb928-19"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span><span class="op">~</span>distributions))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-106-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>If you do your work in a field where folks use <span class="math inline">\(R^2\)</span> change, you might do that with a simple difference score. Here’s the <span class="math inline">\(\Delta R^2\)</span> plot.</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="ulysses-compass.html#cb929-1"></a>r2 <span class="op">%&gt;%</span></span>
<span id="cb929-2"><a href="ulysses-compass.html#cb929-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> b5<span class="fl">.2</span> <span class="op">-</span><span class="st"> </span>b5<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb929-3"><a href="ulysses-compass.html#cb929-3"></a><span class="st">  </span></span>
<span id="cb929-4"><a href="ulysses-compass.html#cb929-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> diff, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb929-5"><a href="ulysses-compass.html#cb929-5"></a><span class="st">  </span><span class="kw">stat_halfeye</span>(<span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> <span class="fl">.95</span>,</span>
<span id="cb929-6"><a href="ulysses-compass.html#cb929-6"></a>               <span class="dt">fill =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], </span>
<span id="cb929-7"><a href="ulysses-compass.html#cb929-7"></a>               <span class="dt">color =</span> <span class="kw">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="op">+</span></span>
<span id="cb929-8"><a href="ulysses-compass.html#cb929-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb929-9"><a href="ulysses-compass.html#cb929-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">expression</span>(Turns<span class="op">~</span>out<span class="op">~</span>b5<span class="fl">.2</span><span class="op">~</span>had<span class="op">~</span>a<span class="op">~</span>lower<span class="op">~</span><span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span><span class="op">~</span>than<span class="op">~</span>b5<span class="fl">.1</span>),</span>
<span id="cb929-10"><a href="ulysses-compass.html#cb929-10"></a>       <span class="dt">x =</span> <span class="kw">expression</span>(Delta<span class="op">*</span><span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span>))</span></code></pre></div>
<p><img src="07_files/figure-gfm/unnamed-chunk-107-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>The <strong>brms</strong> package did not get these <span class="math inline">\(R^2\)</span> values by traditional method used in, say, ordinary least squares estimation. To learn more about how the Bayesian <span class="math inline">\(R^2\)</span> sausage is made, check out the paper by <span class="citation">Gelman, Goodrich, et al. (<a href="#ref-gelmanRsquaredBayesianRegression2019" role="doc-biblioref">2019</a>)</span>, <a href="https://www.tandfonline.com/doi/abs/10.1080/00031305.2018.1549100?journalCode=utas20"><em>R-squared for Bayesian regression models</em></a>.</p>
</div>
<div id="session-info-6" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="ulysses-compass.html#cb930-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] loo_2.3.1            brms_2.14.4          Rcpp_1.0.5           patchwork_1.0.1.9000
##  [5] tidybayes_2.1.1      rethinking_2.01      dagitty_0.2-2        rstan_2.21.2        
##  [9] StanHeaders_2.21.0-6 ggrepel_0.8.2        rcartocolor_2.0.0    forcats_0.5.0       
## [13] stringr_1.4.0        dplyr_1.0.2          purrr_0.3.4          readr_1.3.1         
## [17] tidyr_1.1.1          tibble_3.0.4         ggplot2_3.3.2        tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.2.0      plyr_1.8.6           igraph_1.2.5        
##   [5] splines_3.6.3        svUnit_1.0.3         crosstalk_1.1.0.1    TH.data_1.0-10      
##   [9] rstantools_2.1.1     inline_0.3.16        digest_0.6.27        htmltools_0.5.0     
##  [13] rsconnect_0.8.16     fansi_0.4.1          checkmate_2.0.0      magrittr_1.5        
##  [17] modelr_0.1.6         RcppParallel_5.0.2   matrixStats_0.57.0   sandwich_2.5-1      
##  [21] xts_0.12.1           prettyunits_1.1.1    colorspace_1.4-1     rvest_0.3.5         
##  [25] ggdist_2.1.1         haven_2.2.0          xfun_0.19            callr_3.5.1         
##  [29] crayon_1.3.4         jsonlite_1.7.1       lme4_1.1-23          survival_3.1-12     
##  [33] zoo_1.8-8            glue_1.4.2           gtable_0.3.0         emmeans_1.4.5       
##  [37] V8_3.4.0             pkgbuild_1.1.0       shape_1.4.4          abind_1.4-5         
##  [41] scales_1.1.1         mvtnorm_1.1-1        DBI_1.1.0            miniUI_0.1.1.1      
##  [45] viridisLite_0.3.0    xtable_1.8-4         stats4_3.6.3         DT_0.13             
##  [49] htmlwidgets_1.5.1    httr_1.4.1           threejs_0.3.3        arrayhelpers_1.1-0  
##  [53] ellipsis_0.3.1       pkgconfig_2.0.3      farver_2.0.3         dbplyr_1.4.2        
##  [57] utf8_1.1.4           tidyselect_1.1.0     labeling_0.4.2       rlang_0.4.8         
##  [61] reshape2_1.4.4       later_1.1.0.1        munsell_0.5.0        cellranger_1.1.0    
##  [65] tools_3.6.3          cli_2.1.0            generics_0.1.0       broom_0.5.5         
##  [69] ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1        yaml_2.2.1          
##  [73] processx_3.4.4       knitr_1.30           fs_1.4.1             nlme_3.1-144        
##  [77] mime_0.9             projpred_2.0.2       xml2_1.3.1           compiler_3.6.3      
##  [81] bayesplot_1.7.2      shinythemes_1.1.2    rstudioapi_0.11      curl_4.3            
##  [85] gamm4_0.2-6          reprex_0.3.0         statmod_1.4.34       stringi_1.5.3       
##  [89] ps_1.4.0             Brobdingnag_1.2-6    lattice_0.20-38      Matrix_1.2-18       
##  [93] nloptr_1.2.2.1       markdown_1.1         shinyjs_1.1          vctrs_0.3.4         
##  [97] pillar_1.4.6         lifecycle_0.2.0      bridgesampling_1.0-0 estimability_1.3    
## [101] httpuv_1.5.4         R6_2.5.0             bookdown_0.18        promises_1.1.1      
## [105] gridExtra_2.3        codetools_0.2-16     boot_1.3-24          colourpicker_1.0    
## [109] MASS_7.3-51.5        gtools_3.8.2         assertthat_0.2.1     withr_2.3.0         
## [113] shinystan_2.5.0      multcomp_1.4-13      mgcv_1.8-31          hms_0.5.3           
## [117] grid_3.6.3           coda_0.19-4          minqa_1.2.4          rmarkdown_2.5       
## [121] shiny_1.5.0          lubridate_1.7.8      base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-akaike1998information">
<p>Akaike, H. (1998). Information theory and an extension of the maximum likelihood principle. In <em>Selected papers of Hirotugu Akaike</em> (pp. 199–213). Springer. <a href="https://www.springer.com/gp/book/9780387983554">https://www.springer.com/gp/book/9780387983554</a></p>
</div>
<div id="ref-betancourtBayesSparse2018">
<p>Betancourt, M. (2018). <em>Bayes sparse regression</em>. <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html">https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html</a></p>
</div>
<div id="ref-brms2020RM">
<p>Bürkner, P.-C. (2020b). <em>brms reference manual, Version 2.14.4</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a></p>
</div>
<div id="ref-carvalho2009handling">
<p>Carvalho, C. M., Polson, N. G., &amp; Scott, J. G. (2009). Handling sparsity via the horseshoe. <em>Artificial Intelligence and Statistics</em>, 73–80. <a href="http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf">http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf</a></p>
</div>
<div id="ref-cover2006elements">
<p>Cover, T. M., &amp; Thomas, J. A. (2006). <em>Elements of information theory</em> (2nd Edition). John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Elements+of+Information+Theory\%2C+2nd+Edition-p-9780471241959">https://www.wiley.com/en-us/Elements+of+Information+Theory\%2C+2nd+Edition-p-9780471241959</a></p>
</div>
<div id="ref-derooijCrossvalidationMethodEvery2020">
<p>de Rooij, M., &amp; Weeda, W. (2020). Cross-validation: A method every psychologist should know. <em>Advances in Methods and Practices in Psychological Science</em>, <em>3</em>(2), 248–263. <a href="https://doi.org/10.1177/2515245919898466">https://doi.org/10.1177/2515245919898466</a></p>
</div>
<div id="ref-gelmanRsquaredBayesianRegression2019">
<p>Gelman, A., Goodrich, B., Gabry, J., &amp; Vehtari, A. (2019). R-squared for Bayesian regression models. <em>The American Statistician</em>, <em>73</em>(3), 307–309. <a href="https://doi.org/10.1080/00031305.2018.1549100">https://doi.org/10.1080/00031305.2018.1549100</a></p>
</div>
<div id="ref-hastie2009elements">
<p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The elements of statistical learning: Data mining, inference, and prediction</em>. Springer Science &amp; Business Media. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a></p>
</div>
<div id="ref-kruschkeDoingBayesianData2015">
<p>Kruschke, J. K. (2015). <em>Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan</em>. Academic Press. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a></p>
</div>
<div id="ref-kullbackInformationSufficiency1951">
<p>Kullback, S., &amp; Leibler, R. A. (1951). On information and sufficiency. <em>Annals of Mathematical Statistics</em>, <em>22</em>(1), 79–86. <a href="https://doi.org/10.1214/aoms/1177729694">https://doi.org/10.1214/aoms/1177729694</a></p>
</div>
<div id="ref-kurzStatisticalRethinkingBrms2020">
<p>Kurz, A. S. (2020a). <em>Statistical rethinking with brms, ggplot2, and the tidyverse</em> (version 1.2.0). <a href="https://doi.org/10.5281/zenodo.3693202">https://doi.org/10.5281/zenodo.3693202</a></p>
</div>
<div id="ref-kurzDoingBayesianData2020">
<p>Kurz, A. S. (2020c). <em>Doing Bayesian data analysis in brms and the tidyverse</em> (version 0.3.0). <a href="https://bookdown.org/content/3686/">https://bookdown.org/content/3686/</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020b). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second Edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-R-rcartocolor">
<p>Nowosad, J. (2019). <em>rcartocolor: ’CARTOColors’ palettes</em>. <a href="https://CRAN.R-project.org/package=rcartocolor">https://CRAN.R-project.org/package=rcartocolor</a></p>
</div>
<div id="ref-shannonMathematicalTheoryCommunication1948">
<p>Shannon, C. E. (1948). A mathematical theory of communication. <em>Bell System Technical Journal</em>, <em>27</em>(3), 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a></p>
</div>
<div id="ref-spiegelhalterBayesianMeasuresModel2002">
<p>Spiegelhalter, D. J., Best, N. G., Carlin, B. P., &amp; Linde, A. V. D. (2002). Bayesian measures of model complexity and fit. <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <em>64</em>(4), 583–639. <a href="https://doi.org/10.1111/1467-9868.00353">https://doi.org/10.1111/1467-9868.00353</a></p>
</div>
<div id="ref-R-loo">
<p>Vehtari, A., Gabry, J., Magnusson, M., Yao, Y., &amp; Gelman, A. (2019). <em>loo: Efficient leave-one-out cross-validation and WAIC for bayesian models</em>. <a href="https://CRAN.R-project.org/package=loo">https://CRAN.R-project.org/package=loo</a></p>
</div>
<div id="ref-vehtariPracticalBayesianModel2017">
<p>Vehtari, A., Gelman, A., &amp; Gabry, J. (2017). Practical Bayesian model evaluation using leave-one-out cross-validation and WAIC. <em>Statistics and Computing</em>, <em>27</em>(5), 1413–1432. <a href="https://doi.org/10.1007/s11222-016-9696-4">https://doi.org/10.1007/s11222-016-9696-4</a></p>
</div>
<div id="ref-wassersteinASAStatementPvalues2016">
<p>Wasserstein, R. L., &amp; Lazar, N. A. (2016). The ASA statement on p-values: Context, process, and purpose. <em>The American Statistician</em>, <em>70</em>(2), 129–133. <a href="https://doi.org/10.1080/00031305.2016.1154108">https://doi.org/10.1080/00031305.2016.1154108</a></p>
</div>
<div id="ref-watanabeAsymptoticEquivalenceBayes2010">
<p>Watanabe, S. (2010). Asymptotic equivalence of Bayes cross validation and widely applicable information criterion in singular learning theory. <em>Journal of Machine Learning Research</em>, <em>11</em>(116), 3571–3594. <a href="http://jmlr.org/papers/v11/watanabe10a.html">http://jmlr.org/papers/v11/watanabe10a.html</a></p>
</div>
<div id="ref-wilksLargesampleDistributionLikelihood1938">
<p>Wilks, S. S. (1938). The large-sample distribution of the likelihood ratio for testing composite hypotheses. <em>The Annals of Mathematical Statistics</em>, <em>9</em>(1), 60–62. <a href="https://doi.org/10.1214/aoms/1177732360">https://doi.org/10.1214/aoms/1177732360</a></p>
</div>
<div id="ref-yaoUsingStackingAverage2018">
<p>Yao, Y., Vehtari, A., Simpson, D., Gelman, A., &amp; others. (2018). Using stacking to average Bayesian predictive distributions (with discussion). <em>Bayesian Analysis</em>, <em>13</em>(3), 917–1007. <a href="https://doi.org/10.1214/17-BA1091">https://doi.org/10.1214/17-BA1091</a></p>
</div>
<div id="ref-yarkoniChoosingPredictionExplanation2017">
<p>Yarkoni, T., &amp; Westfall, J. (2017). Choosing prediction over explanation in psychology: Lessons from machine learning. <em>Perspectives on Psychological Science : A Journal of the Association for Psychological Science</em>, <em>12</em>(6), 1100–1122. <a href="https://doi.org/10.1177/1745691617693393">https://doi.org/10.1177/1745691617693393</a></p>
</div>
<div id="ref-zhangCrossvalidationSelectingModel2015">
<p>Zhang, Y., &amp; Yang, Y. (2015). Cross-validation for selecting a model selection procedure. <em>Journal of Econometrics</em>, <em>187</em>(1), 95–112. <a href="https://doi.org/10.1016/j.jeconom.2015.02.006">https://doi.org/10.1016/j.jeconom.2015.02.006</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-haunted-dag-the-causal-terror.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conditional-manatees.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
