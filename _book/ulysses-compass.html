<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Ulysses’ Compass | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-haunted-dag-the-causal-terror.html"/>
<link rel="next" href="conditional-manatees.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/twitter-widget-0.0.1/widgets.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.1."><i class="fa fa-check"></i>Version 0.1.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.3.0."><i class="fa fa-check"></i>Version 0.3.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.4.0."><i class="fa fa-check"></i>Version 0.4.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#were-not-done-yet-and-i-could-use-your-help."><i class="fa fa-check"></i>We’re not done yet and I could use your help.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression."><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression.</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-first-bonus-smooth-functions-with-brmss"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> First bonus: Smooth functions with <code>brms::s()</code></a></li>
<li class="chapter" data-level="4.7" data-path="geocentric-models.html"><a href="geocentric-models.html#second-bonus-group-predictors-with-matrix-columns"><i class="fa fa-check"></i><b>4.7</b> Second bonus: Group predictors with matrix columns</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#summary-bonus-we-can-model-categorical-variables-in-more-ways-than-one"><i class="fa fa-check"></i><b>5.4</b> <del>Summary</del> Bonus: We can model categorical variables in more ways than one</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#you-can-use-a-dummy."><i class="fa fa-check"></i><b>5.4.1</b> You can use a dummy.</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#consider-contrast-coding."><i class="fa fa-check"></i><b>5.4.2</b> Consider contrast coding.</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#theres-always-the-multilevel-anova-approach."><i class="fa fa-check"></i><b>5.4.3</b> There’s always the multilevel ANOVA approach.</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#would-you-like-to-learn-more"><i class="fa fa-check"></i><b>5.4.4</b> Would you like to learn more?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria."><i class="fa fa-check"></i><b>7.4.2</b> Information criteria.</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.4.3</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.5.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>7.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#another-parable."><i class="fa fa-check"></i><b>9.3.1</b> Another parable.</a></li>
<li class="chapter" data-level="9.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#particles-in-space."><i class="fa fa-check"></i><b>9.3.2</b> Particles in space.</a></li>
<li class="chapter" data-level="9.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.3</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to outcomes.</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.2</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#bonus-survival-analysis"><i class="fa fa-check"></i><b>11.5</b> Bonus: Survival analysis</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#survival-summary."><i class="fa fa-check"></i><b>11.5.1</b> Survival summary.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>15.1</b> Measurement error</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>15.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="15.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>15.1.2</b> Error on both outcome and predictor.</a></li>
<li class="chapter" data-level="15.1.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-terrors."><i class="fa fa-check"></i><b>15.1.3</b> Measurement terrors.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>15.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#dag-ate-my-homework."><i class="fa fa-check"></i><b>15.2.1</b> DAG ate my homework.</a></li>
<li class="chapter" data-level="15.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-primates."><i class="fa fa-check"></i><b>15.2.2</b> Imputing primates.</a></li>
<li class="chapter" data-level="15.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#where-is-your-god-now"><i class="fa fa-check"></i><b>15.2.3</b> Where is your god now?</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>15.3</b> Categorical errors and discrete absences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#discrete-cats."><i class="fa fa-check"></i><b>15.3.1</b> Discrete cats.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-bayesian-meta-analysis-with-odds-ratios"><i class="fa fa-check"></i><b>15.5</b> Bonus: Bayesian meta-analysis with odds ratios</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#how-do-meta-analyses-fit-into-the-picture"><i class="fa fa-check"></i><b>15.5.1</b> How do meta-analyses fit into the picture?</a></li>
<li class="chapter" data-level="15.5.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#we-need-some-data."><i class="fa fa-check"></i><b>15.5.2</b> We need some data.</a></li>
<li class="chapter" data-level="15.5.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#our-effect-size-will-be-an-odds-ratio."><i class="fa fa-check"></i><b>15.5.3</b> Our effect size will be an odds ratio.</a></li>
<li class="chapter" data-level="15.5.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#log-odds-odds-ratios-and-modeling-effect-sizes."><i class="fa fa-check"></i><b>15.5.4</b> Log-odds, odds ratios, and modeling effect sizes.</a></li>
<li class="chapter" data-level="15.5.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#compute-the-study-specific-effect-sizes."><i class="fa fa-check"></i><b>15.5.5</b> Compute the study-specific effect sizes.</a></li>
<li class="chapter" data-level="15.5.6" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-meta-analysis."><i class="fa fa-check"></i><b>15.5.6</b> Fit the Bayesian meta-analysis.</a></li>
<li class="chapter" data-level="15.5.7" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-muiltilevel-alternative."><i class="fa fa-check"></i><b>15.5.7</b> Fit the Bayesian muiltilevel alternative.</a></li>
<li class="chapter" data-level="15.5.8" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#relative-to-the-muiltilevel-model-meta-analyses-have-limitations."><i class="fa fa-check"></i><b>15.5.8</b> Relative to the muiltilevel model, meta-analyses have limitations.</a></li>
<li class="chapter" data-level="15.5.9" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#parting-thoughts."><i class="fa fa-check"></i><b>15.5.9</b> Parting thoughts.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#geometric-people"><i class="fa fa-check"></i><b>16.1</b> Geometric people</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model."><i class="fa fa-check"></i><b>16.1.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.1.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model."><i class="fa fa-check"></i><b>16.1.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.1.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#glm-in-disguise."><i class="fa fa-check"></i><b>16.1.3</b> GLM in disguise.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>16.2</b> Hidden minds and observed behavior</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-1"><i class="fa fa-check"></i><b>16.2.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.2.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-1"><i class="fa fa-check"></i><b>16.2.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.2.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#coding-the-statistical-model."><i class="fa fa-check"></i><b>16.2.3</b> Coding the statistical model.</a></li>
<li class="chapter" data-level="16.2.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#state-space-models."><i class="fa fa-check"></i><b>16.2.4</b> State space models.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>16.3</b> Ordinary differential nut cracking</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#scientific-model."><i class="fa fa-check"></i><b>16.3.1</b> Scientific model.</a></li>
<li class="chapter" data-level="16.3.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#statistical-model."><i class="fa fa-check"></i><b>16.3.2</b> Statistical model.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#population-dynamics"><i class="fa fa-check"></i><b>16.4</b> Population dynamics</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-2"><i class="fa fa-check"></i><b>16.4.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.4.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-2"><i class="fa fa-check"></i><b>16.4.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.4.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#lynx-lessons-bonus-practice-with-the-autoregressive-model."><i class="fa fa-check"></i><b>16.4.3</b> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>17</b> <del>Horoscopes</del> Insights</a>
<ul>
<li class="chapter" data-level="17.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>17.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="17.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>17.2</b> Save your model fits</a></li>
<li class="chapter" data-level="17.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>17.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="17.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>17.4</b> Look at your data</a></li>
<li class="chapter" data-level="17.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#consider-using-the-0-intercept-syntax"><i class="fa fa-check"></i><b>17.5</b> Consider using the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="17.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>17.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="17.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>17.7</b> Annotate your code</a></li>
<li class="chapter" data-level="17.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>17.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="17.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>17.9</b> Code in public</a></li>
<li class="chapter" data-level="17.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-social-media"><i class="fa fa-check"></i><b>17.10</b> Check out social media</a></li>
<li class="chapter" data-level="17.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#extra-rethinking-related-resources"><i class="fa fa-check"></i><b>17.11</b> Extra <em>Rethinking</em>-related resources</a></li>
<li class="chapter" data-level="17.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#but-like-how-do-i-do-this-for-real"><i class="fa fa-check"></i><b>17.12</b> <em>But, like, how do I do this for real?</em></a></li>
<li class="chapter" data-level="17.13" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>17.13</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ulysses-compass" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Ulysses’ Compass<a href="ulysses-compass.html#ulysses-compass" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we contend with two contrasting kinds of statistical error:</p>
<ul>
<li>overfitting, “which leads to poor prediction by learning too <em>much</em> from the data”</li>
<li>underfitting, “which leads to poor prediction by learning too <em>little</em> from the data” <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020a, p. 192</a>, <em>emphasis</em> added)</span></li>
</ul>
<blockquote>
<p>Our job is to carefully navigate among these monsters. There are two common families of approaches. The first approach is to use a <strong>regularizing prior</strong> to tell the model not to get too excited by the data. This is the same device that non-Bayesian methods refer to as “penalized likelihood.” The second approach is to use some scoring device, like <strong>information criteria</strong> or <strong>cross-validation</strong>, to model the prediction task and estimate predictive accuracy. Both families of approaches are routinely used in the natural and social sciences. Furthermore, they can be–maybe should be–used in combination. So it’s worth understanding both, as you’re going to need both at some point. (p. 192, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>There’s a lot going on in this chapter. More more practice with these ideas, check out <span class="citation">Yarkoni &amp; Westfall (<a href="#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6603289/"><em>Choosing prediction over explanation in psychology: Lessons from machine learning</em></a>.</p>
<div id="rethinking-stargazing." class="section level4 hasAnchor" number="7.0.0.1">
<h4><span class="header-section-number">7.0.0.1</span> Rethinking stargazing.<a href="ulysses-compass.html#rethinking-stargazing." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The most common form of model selection among practicing scientists is to search for a model in which every coefficient is statistically significant. Statisticians sometimes call this <strong>stargazing</strong>, as it is embodied by scanning for asterisks (<span class="math inline">\(^{\star \star}\)</span>) trailing after estimates….</p>
<p>Whatever you think about null hypothesis significance testing in general, using it to select among structurally different models is a mistake–<span class="math inline">\(p\)</span>-values are not designed to help you navigate between underfitting and overfitting. (p. 193, <strong>emphasis</strong> in the original).</p>
</blockquote>
<p>McElreath spent little time discussing <span class="math inline">\(p\)</span>-values and null hypothesis testing in the text. If you’d like to learn more from a Bayesian perspective, you might check out the first several chapters (particularly 10–13) in Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">text</a> and my <span class="citation">(<a href="#ref-kurzDoingBayesianDataAnalysis2023" role="doc-biblioref">2023a</a>)</span> <a href="https://bookdown.org/content/3686/">ebook translating it to <strong>brms</strong> and the tidyverse</a>. The great <a href="https://www.fharrell.com/">Frank Harrell</a> has complied <a href="https://www.fharrell.com/post/pval-litany/"><em>A Litany of Problems With p-values</em></a>.
Also, don’t miss the statement on <span class="math inline">\(p\)</span>-values released by the <a href="https://www.amstat.org/">American Statistical Association</a> <span class="citation">(<a href="#ref-wassersteinASAStatementPvalues2016" role="doc-biblioref">Wasserstein &amp; Lazar, 2016</a>)</span>.</p>
</div>
<div id="the-problem-with-parameters" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> The problem with parameters<a href="ulysses-compass.html#the-problem-with-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <span class="math inline">\(R^2\)</span> is a popular way to measure how well you can retrodict the data. It traditionally follows the form</p>
<p><span class="math display">\[R^2 = \frac{\text{var(outcome)} - \text{var(residuals)}}{\text{var(outcome)}} = 1 - \frac{\text{var(residuals)}}{\text{var(outcome)}}.\]</span></p>
<p>By <span class="math inline">\(\operatorname{var}()\)</span>, of course, we meant variance (i.e., what you get from the <code>var()</code> function in <strong>R</strong>). McElreath is not a fan of the <span class="math inline">\(R^2\)</span>. But it’s important in my field, so instead of a summary at the end of the chapter, we will cover the Bayesian version of <span class="math inline">\(R^2\)</span> and how to use it in <strong>brms</strong>.</p>
<div id="more-parameters-almost-always-improve-fit." class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> More parameters (almost) always improve fit.<a href="ulysses-compass.html#more-parameters-almost-always-improve-fit." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll start off by making the data with brain size and body size for seven <code>species</code>.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="ulysses-compass.html#cb766-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb766-2"><a href="ulysses-compass.html#cb766-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb766-3"><a href="ulysses-compass.html#cb766-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb766-4"><a href="ulysses-compass.html#cb766-4" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> </span>
<span id="cb766-5"><a href="ulysses-compass.html#cb766-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">&quot;afarensis&quot;</span>, <span class="st">&quot;africanus&quot;</span>, <span class="st">&quot;habilis&quot;</span>, <span class="st">&quot;boisei&quot;</span>, <span class="st">&quot;rudolfensis&quot;</span>, <span class="st">&quot;ergaster&quot;</span>, <span class="st">&quot;sapiens&quot;</span>), </span>
<span id="cb766-6"><a href="ulysses-compass.html#cb766-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain   =</span> <span class="fu">c</span>(<span class="dv">438</span>, <span class="dv">452</span>, <span class="dv">612</span>, <span class="dv">521</span>, <span class="dv">752</span>, <span class="dv">871</span>, <span class="dv">1350</span>), </span>
<span id="cb766-7"><a href="ulysses-compass.html#cb766-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">mass    =</span> <span class="fu">c</span>(<span class="fl">37.0</span>, <span class="fl">35.5</span>, <span class="fl">34.5</span>, <span class="fl">41.5</span>, <span class="fl">55.5</span>, <span class="fl">61.0</span>, <span class="fl">53.5</span>))</span>
<span id="cb766-8"><a href="ulysses-compass.html#cb766-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 3
##   species     brain  mass
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 afarensis     438  37  
## 2 africanus     452  35.5
## 3 habilis       612  34.5
## 4 boisei        521  41.5
## 5 rudolfensis   752  55.5
## 6 ergaster      871  61  
## 7 sapiens      1350  53.5</code></pre>
<p>Let’s get ready for Figure 7.2. The plots in this chapter will be characterized by <code>theme_classic() + theme(text = element_text(family = "Courier"))</code>. Our color palette will come from the <a href="https://CRAN.R-project.org/package=rcartocolor"><strong>rcartocolor</strong> package</a> <span class="citation">(<a href="#ref-R-rcartocolor" role="doc-biblioref">Nowosad, 2019</a>)</span>, which provides color schemes <a href="https://carto.com/carto-colors/">designed by ‘CARTO’</a>.</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="ulysses-compass.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rcartocolor)</span></code></pre></div>
<p>The specific palette we’ll be using is “BurgYl.” In addition to palettes, the <strong>rcartocolor</strong> package offers a few convenience functions which make it easier to use their palettes. The <code>carto_pal()</code> function will return the HEX numbers associated with a given palette’s colors and the <code>display_carto_pal()</code> function will display the actual colors.</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="ulysses-compass.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#fbe6c5&quot; &quot;#f5ba98&quot; &quot;#ee8a82&quot; &quot;#dc7176&quot; &quot;#c8586c&quot; &quot;#9c3f5d&quot; &quot;#70284a&quot;</code></pre>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="ulysses-compass.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We’ll be using a diluted version of the third color for the panel background (i.e., <code>theme(panel.background = element_rect(fill = alpha(carto_pal(7, "BurgYl")[3], 1/4)))</code>) and the darker purples for other plot elements. Here’s the plot.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="ulysses-compass.html#cb772-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb772-2"><a href="ulysses-compass.html#cb772-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb772-3"><a href="ulysses-compass.html#cb772-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb772-4"><a href="ulysses-compass.html#cb772-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb772-5"><a href="ulysses-compass.html#cb772-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>),</span>
<span id="cb772-6"><a href="ulysses-compass.html#cb772-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)))</span>
<span id="cb772-7"><a href="ulysses-compass.html#cb772-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb772-8"><a href="ulysses-compass.html#cb772-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb772-9"><a href="ulysses-compass.html#cb772-9" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb772-10"><a href="ulysses-compass.html#cb772-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>  mass, <span class="at">y =</span> brain, <span class="at">label =</span> species)) <span class="sc">+</span></span>
<span id="cb772-11"><a href="ulysses-compass.html#cb772-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb772-12"><a href="ulysses-compass.html#cb772-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="at">seed =</span> <span class="dv">438</span>) <span class="sc">+</span></span>
<span id="cb772-13"><a href="ulysses-compass.html#cb772-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Average brain volume by body</span><span class="sc">\n</span><span class="st">mass for six hominin species&quot;</span>,</span>
<span id="cb772-14"><a href="ulysses-compass.html#cb772-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (kg)&quot;</span>,</span>
<span id="cb772-15"><a href="ulysses-compass.html#cb772-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (cc)&quot;</span>) <span class="sc">+</span></span>
<span id="cb772-16"><a href="ulysses-compass.html#cb772-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">30</span>, <span class="dv">65</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-5-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Before fitting our models,</p>
<blockquote>
<p>we want to standardize body mass–give it mean zero and standard deviation one–and rescale the outcome, brain volume, so that the largest observed value is 1. Why not standardize brain volume as well? Because we want to preserve zero as a reference point: No brain at all. You can’t have negative brain. I don’t think. (p. 195)</p>
</blockquote>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="ulysses-compass.html#cb773-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb773-2"><a href="ulysses-compass.html#cb773-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb773-3"><a href="ulysses-compass.html#cb773-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mass_std  =</span> (mass <span class="sc">-</span> <span class="fu">mean</span>(mass)) <span class="sc">/</span> <span class="fu">sd</span>(mass),</span>
<span id="cb773-4"><a href="ulysses-compass.html#cb773-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain_std =</span> brain <span class="sc">/</span> <span class="fu">max</span>(brain))</span></code></pre></div>
<p>Our first statistical model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{brain_std}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i              &amp; = \alpha + \beta \text{mass_std}_i \\
\alpha             &amp; \sim \operatorname{Normal}(0.5, 1) \\
\beta              &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma             &amp; \sim \operatorname{Log-Normal}(0, 1).
\end{align*}\]</span></p>
<blockquote>
<p>This simply says that the average brain volume <span class="math inline">\(b_i\)</span> of species <span class="math inline">\(i\)</span> is a linear function of its body mass <span class="math inline">\(m_i\)</span>. Now consider what the priors imply. The prior for <span class="math inline">\(\alpha\)</span> is just centered on the mean brain volume (rescaled) in the data. So it says that the average species with an average body mass has a brain volume with an 89% credible interval from about −1 to 2. That is ridiculously wide and includes impossible (negative) values. The prior for <span class="math inline">\(\beta\)</span> is very flat and centered on zero. It allows for absurdly large positive and negative relationships. These priors allow for absurd inferences, especially as the model gets more complex. And that’s part of the lesson. (p. 196)</p>
</blockquote>
<p>Fire up <strong>brms</strong>.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="ulysses-compass.html#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<p>A careful study of McElreath’s <strong>R</strong> code 7.3 will show he is modeling <code>log_sigma</code>, rather than <span class="math inline">\(\sigma\)</span>. There are ways to do this with <strong>brms</strong> <span class="citation">(see <a href="#ref-Bürkner2022Distributional" role="doc-biblioref">Bürkner, 2022a</a>)</span>, but I’m going to keep things simple, here. Our approach will be to follow the above equation more literally and just slap the <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span> prior directly onto <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="ulysses-compass.html#cb775-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb775-2"><a href="ulysses-compass.html#cb775-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb775-3"><a href="ulysses-compass.html#cb775-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb775-4"><a href="ulysses-compass.html#cb775-4" aria-hidden="true" tabindex="-1"></a>      brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std,</span>
<span id="cb775-5"><a href="ulysses-compass.html#cb775-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb775-6"><a href="ulysses-compass.html#cb775-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb775-7"><a href="ulysses-compass.html#cb775-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb775-8"><a href="ulysses-compass.html#cb775-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb775-9"><a href="ulysses-compass.html#cb775-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb775-10"><a href="ulysses-compass.html#cb775-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b07.01&quot;</span>)</span></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="ulysses-compass.html#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: brain_std ~ 1 + mass_std 
##    Data: d (Number of observations: 7) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.53      0.11     0.29     0.75 1.00     2045     1746
## mass_std      0.17      0.12    -0.07     0.41 1.00     2595     1786
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.27      0.11     0.13     0.55 1.00     1587     2012
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As we’ll learn later on, <strong>brms</strong> already has a convenience function for computing the Bayesian <span class="math inline">\(R^2\)</span>. At this point in the chapter, we’ll follow along and make a <strong>brms</strong>-centric version of McElreath’s <code>R2_is_bad()</code>. But because part of our version of <code>R2_is_bad()</code> will contain the <code>brms::predict()</code> function, I’m going to add a <code>seed</code> argument to make the results more reproducible.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="ulysses-compass.html#cb778-1" aria-hidden="true" tabindex="-1"></a>R2_is_bad <span class="ot">&lt;-</span> <span class="cf">function</span>(brm_fit, <span class="at">seed =</span> <span class="dv">7</span>, ...) {</span>
<span id="cb778-2"><a href="ulysses-compass.html#cb778-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb778-3"><a href="ulysses-compass.html#cb778-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb778-4"><a href="ulysses-compass.html#cb778-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">predict</span>(brm_fit, <span class="at">summary =</span> F, ...)</span>
<span id="cb778-5"><a href="ulysses-compass.html#cb778-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in my experience, it&#39;s more typical to define residuals as the criterion minus the predictions</span></span>
<span id="cb778-6"><a href="ulysses-compass.html#cb778-6" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> d<span class="sc">$</span>brain_std <span class="sc">-</span> <span class="fu">apply</span>(p, <span class="dv">2</span>, mean)</span>
<span id="cb778-7"><a href="ulysses-compass.html#cb778-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(r) <span class="sc">/</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(d<span class="sc">$</span>brain_std)</span>
<span id="cb778-8"><a href="ulysses-compass.html#cb778-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb778-9"><a href="ulysses-compass.html#cb778-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here’s the estimate for our <span class="math inline">\(R^2\)</span>.</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="ulysses-compass.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="fu">R2_is_bad</span>(b7<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## [1] 0.4875197</code></pre>
<p>Do note that,</p>
<blockquote>
<p>in principle, the Bayesian approach mandates that we do this for each sample from the posterior. But <span class="math inline">\(R^2\)</span> is traditionally computed only at the mean prediction. So we’ll do that as well here. Later in the chapter you’ll learn a properly Bayesian score that uses the entire posterior distribution. (p. 197)</p>
</blockquote>
<p>Now fit the quadratic through the fifth-order polynomial models using <code>update()</code>.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="ulysses-compass.html#cb781-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic</span></span>
<span id="cb781-2"><a href="ulysses-compass.html#cb781-2" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb781-3"><a href="ulysses-compass.html#cb781-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b7<span class="fl">.1</span>,</span>
<span id="cb781-4"><a href="ulysses-compass.html#cb781-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d, </span>
<span id="cb781-5"><a href="ulysses-compass.html#cb781-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb781-6"><a href="ulysses-compass.html#cb781-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb781-7"><a href="ulysses-compass.html#cb781-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb781-8"><a href="ulysses-compass.html#cb781-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b07.02&quot;</span>)</span>
<span id="cb781-9"><a href="ulysses-compass.html#cb781-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-10"><a href="ulysses-compass.html#cb781-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cubic</span></span>
<span id="cb781-11"><a href="ulysses-compass.html#cb781-11" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb781-12"><a href="ulysses-compass.html#cb781-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b7<span class="fl">.1</span>,</span>
<span id="cb781-13"><a href="ulysses-compass.html#cb781-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d, </span>
<span id="cb781-14"><a href="ulysses-compass.html#cb781-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb781-15"><a href="ulysses-compass.html#cb781-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb781-16"><a href="ulysses-compass.html#cb781-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb781-17"><a href="ulysses-compass.html#cb781-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9</span>),</span>
<span id="cb781-18"><a href="ulysses-compass.html#cb781-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b07.03&quot;</span>)</span>
<span id="cb781-19"><a href="ulysses-compass.html#cb781-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-20"><a href="ulysses-compass.html#cb781-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-21"><a href="ulysses-compass.html#cb781-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fourth-order</span></span>
<span id="cb781-22"><a href="ulysses-compass.html#cb781-22" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb781-23"><a href="ulysses-compass.html#cb781-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b7<span class="fl">.1</span>,</span>
<span id="cb781-24"><a href="ulysses-compass.html#cb781-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d, </span>
<span id="cb781-25"><a href="ulysses-compass.html#cb781-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb781-26"><a href="ulysses-compass.html#cb781-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb781-27"><a href="ulysses-compass.html#cb781-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb781-28"><a href="ulysses-compass.html#cb781-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">995</span>),</span>
<span id="cb781-29"><a href="ulysses-compass.html#cb781-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b07.04&quot;</span>)</span>
<span id="cb781-30"><a href="ulysses-compass.html#cb781-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-31"><a href="ulysses-compass.html#cb781-31" aria-hidden="true" tabindex="-1"></a><span class="co"># fifth-order</span></span>
<span id="cb781-32"><a href="ulysses-compass.html#cb781-32" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb781-33"><a href="ulysses-compass.html#cb781-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b7<span class="fl">.1</span>,</span>
<span id="cb781-34"><a href="ulysses-compass.html#cb781-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> d, </span>
<span id="cb781-35"><a href="ulysses-compass.html#cb781-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb781-36"><a href="ulysses-compass.html#cb781-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb781-37"><a href="ulysses-compass.html#cb781-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb781-38"><a href="ulysses-compass.html#cb781-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99999</span>),</span>
<span id="cb781-39"><a href="ulysses-compass.html#cb781-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b07.05&quot;</span>)</span></code></pre></div>
<p>You may have noticed we fiddled with the <code>adapt_delta</code> setting for some of the models. When you try to fit complex models with few data points and wide priors, that can cause difficulties for Stan. I’m not going to get into the details on what <code>adapt_delta</code> does, right now. But it’ll make appearances in later chapters and we’ll more formally introduce it in <a href="models-with-memory.html#non-centered-chimpanzees.">Section 13.4.2</a>.</p>
<p>Now returning to the text,</p>
<blockquote>
<p>That last model, <code>m7.6</code>, has one trick in it. The standard deviation is replaced with a constant value 0.001. The model will not work otherwise, for a very important reason that will become clear as we plot these monsters. (p. 198)</p>
</blockquote>
<p>By “last model, <code>m7.6</code>,” McElreath was referring to the sixth-order polynomial, fit on page 199. McElreath’s <strong>rethinking</strong> package is set up so the syntax is simple to replacing <span class="math inline">\(\sigma\)</span> with a constant value. We can do this with <strong>brms</strong>, too, but it’ll take more effort. If we want to fix <span class="math inline">\(\sigma\)</span> to a constant, we’ll need to define a custom likelihood. Bürkner explained how to do so in his <span class="citation">(<a href="#ref-Bürkner2022Define" role="doc-biblioref">2022b</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define custom response distributions with brms</em></a>. I’m not going to explain this in great detail, here. In brief, first we use the <code>custom_family()</code> function to define the name and parameters of a <code>custom_normal()</code> likelihood that will set <span class="math inline">\(\sigma\)</span> to a constant value, 0.001. Second, we’ll define some functions for Stan which are not defined in Stan itself and save them as <code>stan_funs</code>. Third, we make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="ulysses-compass.html#cb782-1" aria-hidden="true" tabindex="-1"></a>custom_normal <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb782-2"><a href="ulysses-compass.html#cb782-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;custom_normal&quot;</span>, <span class="at">dpars =</span> <span class="st">&quot;mu&quot;</span>,</span>
<span id="cb782-3"><a href="ulysses-compass.html#cb782-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb782-4"><a href="ulysses-compass.html#cb782-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;real&quot;</span></span>
<span id="cb782-5"><a href="ulysses-compass.html#cb782-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb782-6"><a href="ulysses-compass.html#cb782-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb782-7"><a href="ulysses-compass.html#cb782-7" aria-hidden="true" tabindex="-1"></a>stan_funs  <span class="ot">&lt;-</span> <span class="st">&quot;real custom_normal_lpdf(real y, real mu) {</span></span>
<span id="cb782-8"><a href="ulysses-compass.html#cb782-8" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_lpdf(y | mu, 0.001);</span></span>
<span id="cb782-9"><a href="ulysses-compass.html#cb782-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb782-10"><a href="ulysses-compass.html#cb782-10" aria-hidden="true" tabindex="-1"></a><span class="st">real custom_normal_rng(real mu) {</span></span>
<span id="cb782-11"><a href="ulysses-compass.html#cb782-11" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_rng(mu, 0.001);</span></span>
<span id="cb782-12"><a href="ulysses-compass.html#cb782-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb782-13"><a href="ulysses-compass.html#cb782-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> </span>
<span id="cb782-14"><a href="ulysses-compass.html#cb782-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb782-15"><a href="ulysses-compass.html#cb782-15" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> stan_funs, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>)</span></code></pre></div>
<p>Now we can fit the model by setting <code>family = custom_normal</code>. Note that since we’ve set <span class="math inline">\(\sigma = 0.001\)</span>, we don’t need to include a prior for <span class="math inline">\(\sigma\)</span>. Also notice our <code>stanvars = stanvars</code> line.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="ulysses-compass.html#cb783-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb783-2"><a href="ulysses-compass.html#cb783-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb783-3"><a href="ulysses-compass.html#cb783-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> custom_normal,</span>
<span id="cb783-4"><a href="ulysses-compass.html#cb783-4" aria-hidden="true" tabindex="-1"></a>      brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb783-5"><a href="ulysses-compass.html#cb783-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb783-6"><a href="ulysses-compass.html#cb783-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b)),</span>
<span id="cb783-7"><a href="ulysses-compass.html#cb783-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb783-8"><a href="ulysses-compass.html#cb783-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb783-9"><a href="ulysses-compass.html#cb783-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> stanvars,</span>
<span id="cb783-10"><a href="ulysses-compass.html#cb783-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b07.06&quot;</span>)</span></code></pre></div>
<p>Before we can do our variant of Figure 7.3, we’ll need to define a few more custom functions to work with <code>b7.6</code>. The <code>posterior_epred_custom_normal()</code> function is required for <code>brms::fitted()</code> to work with our <code>family = custom_normal</code> <code>brmsfit</code> object. Same thing for <code>posterior_predict_custom_normal()</code> and <code>brms::predict()</code>. Though we won’t need it until <a href="ulysses-compass.html#scoring-the-right-data.">Section 7.2.5</a>, we’ll also define <code>log_lik_custom_normal</code> so we can use the <code>log_lik()</code> function for any models fit with <code>family = custom_normal</code>. Before all that, we need to throw in a line with the <code>expose_functions()</code> function. If you want to understand why, read up in Bürkner’s <span class="citation">(<a href="#ref-Bürkner2022Define" role="doc-biblioref">2022b</a>)</span> vignette. For now, just go with it.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="ulysses-compass.html#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(b7<span class="fl">.6</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb784-2"><a href="ulysses-compass.html#cb784-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-3"><a href="ulysses-compass.html#cb784-3" aria-hidden="true" tabindex="-1"></a>posterior_epred_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb784-4"><a href="ulysses-compass.html#cb784-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb784-5"><a href="ulysses-compass.html#cb784-5" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb784-6"><a href="ulysses-compass.html#cb784-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb784-7"><a href="ulysses-compass.html#cb784-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-8"><a href="ulysses-compass.html#cb784-8" aria-hidden="true" tabindex="-1"></a>posterior_predict_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb784-9"><a href="ulysses-compass.html#cb784-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb784-10"><a href="ulysses-compass.html#cb784-10" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb784-11"><a href="ulysses-compass.html#cb784-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_rng</span>(mu)</span>
<span id="cb784-12"><a href="ulysses-compass.html#cb784-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb784-13"><a href="ulysses-compass.html#cb784-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-14"><a href="ulysses-compass.html#cb784-14" aria-hidden="true" tabindex="-1"></a>log_lik_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb784-15"><a href="ulysses-compass.html#cb784-15" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb784-16"><a href="ulysses-compass.html#cb784-16" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb784-17"><a href="ulysses-compass.html#cb784-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_lpdf</span>(y, mu)</span>
<span id="cb784-18"><a href="ulysses-compass.html#cb784-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Okay, here’s how we might plot the result for the first model, <code>b7.1</code>.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="ulysses-compass.html#cb785-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb785-2"><a href="ulysses-compass.html#cb785-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-3"><a href="ulysses-compass.html#cb785-3" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb785-4"><a href="ulysses-compass.html#cb785-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-5"><a href="ulysses-compass.html#cb785-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b7<span class="fl">.1</span>, </span>
<span id="cb785-6"><a href="ulysses-compass.html#cb785-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd, </span>
<span id="cb785-7"><a href="ulysses-compass.html#cb785-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb785-8"><a href="ulysses-compass.html#cb785-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb785-9"><a href="ulysses-compass.html#cb785-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb785-10"><a href="ulysses-compass.html#cb785-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb785-11"><a href="ulysses-compass.html#cb785-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb785-12"><a href="ulysses-compass.html#cb785-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lineribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb785-13"><a href="ulysses-compass.html#cb785-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb785-14"><a href="ulysses-compass.html#cb785-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb785-15"><a href="ulysses-compass.html#cb785-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb785-16"><a href="ulysses-compass.html#cb785-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb785-17"><a href="ulysses-compass.html#cb785-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb785-18"><a href="ulysses-compass.html#cb785-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">==</span>.(<span class="fu">round</span>(<span class="fu">R2_is_bad</span>(b7<span class="fl">.1</span>), <span class="at">digits =</span> <span class="dv">2</span>))),</span>
<span id="cb785-19"><a href="ulysses-compass.html#cb785-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (standardized)&quot;</span>,</span>
<span id="cb785-20"><a href="ulysses-compass.html#cb785-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (standardized)&quot;</span>) <span class="sc">+</span></span>
<span id="cb785-21"><a href="ulysses-compass.html#cb785-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-13-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>To slightly repurpose a quote from McElreath:</p>
<blockquote>
<p>We’ll want to do this for the next several models, so let’s write a function to make it repeatable. If you find yourself writing code more than once, it is usually saner to write a function and call the function more than once instead. (p. 197)</p>
</blockquote>
<p>Our <code>make_figure7.3()</code> function will wrap the simulation, data wrangling, and plotting code all in one. It takes two arguments, the first of which defines which fit object we’d like to plot. If you look closely at Figure 7.3 in the text, you’ll notice that the range of the <span class="math inline">\(y\)</span>-axis changes in the last three plots. Our second argument, <code>ylim</code>, will allow us to vary those parameters across subplots.</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="ulysses-compass.html#cb786-1" aria-hidden="true" tabindex="-1"></a>make_figure7<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std)) {</span>
<span id="cb786-2"><a href="ulysses-compass.html#cb786-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb786-3"><a href="ulysses-compass.html#cb786-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the R2</span></span>
<span id="cb786-4"><a href="ulysses-compass.html#cb786-4" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="fu">R2_is_bad</span>(brms_fit)</span>
<span id="cb786-5"><a href="ulysses-compass.html#cb786-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb786-6"><a href="ulysses-compass.html#cb786-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the new data </span></span>
<span id="cb786-7"><a href="ulysses-compass.html#cb786-7" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">200</span>))</span>
<span id="cb786-8"><a href="ulysses-compass.html#cb786-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb786-9"><a href="ulysses-compass.html#cb786-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate and wrangle</span></span>
<span id="cb786-10"><a href="ulysses-compass.html#cb786-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(brms_fit, <span class="at">newdata =</span> nd, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb786-11"><a href="ulysses-compass.html#cb786-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb786-12"><a href="ulysses-compass.html#cb786-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb786-13"><a href="ulysses-compass.html#cb786-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb786-14"><a href="ulysses-compass.html#cb786-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot!  </span></span>
<span id="cb786-15"><a href="ulysses-compass.html#cb786-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb786-16"><a href="ulysses-compass.html#cb786-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_lineribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb786-17"><a href="ulysses-compass.html#cb786-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb786-18"><a href="ulysses-compass.html#cb786-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb786-19"><a href="ulysses-compass.html#cb786-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb786-20"><a href="ulysses-compass.html#cb786-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb786-21"><a href="ulysses-compass.html#cb786-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb786-22"><a href="ulysses-compass.html#cb786-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">==</span>.(<span class="fu">round</span>(r2, <span class="at">digits =</span> <span class="dv">2</span>))),</span>
<span id="cb786-23"><a href="ulysses-compass.html#cb786-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb786-24"><a href="ulysses-compass.html#cb786-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb786-25"><a href="ulysses-compass.html#cb786-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.5</span>),</span>
<span id="cb786-26"><a href="ulysses-compass.html#cb786-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> ylim)</span>
<span id="cb786-27"><a href="ulysses-compass.html#cb786-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb786-28"><a href="ulysses-compass.html#cb786-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here we make and save the six subplots in bulk.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="ulysses-compass.html#cb787-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.1</span>)</span>
<span id="cb787-2"><a href="ulysses-compass.html#cb787-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.2</span>)</span>
<span id="cb787-3"><a href="ulysses-compass.html#cb787-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.3</span>)</span>
<span id="cb787-4"><a href="ulysses-compass.html#cb787-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">25</span>, <span class="fl">1.1</span>))</span>
<span id="cb787-5"><a href="ulysses-compass.html#cb787-5" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.5</span>, <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">1</span>, <span class="fl">1.4</span>))</span>
<span id="cb787-6"><a href="ulysses-compass.html#cb787-6" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.6</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb787-7"><a href="ulysses-compass.html#cb787-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) </span></code></pre></div>
<p>Now use <strong>patchwork</strong> syntax to bundle them all together.</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="ulysses-compass.html#cb788-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb788-2"><a href="ulysses-compass.html#cb788-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb788-3"><a href="ulysses-compass.html#cb788-3" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">|</span> p2) <span class="sc">/</span> (p3 <span class="sc">|</span> p4) <span class="sc">/</span> (p5 <span class="sc">|</span> p6)) <span class="sc">+</span></span>
<span id="cb788-4"><a href="ulysses-compass.html#cb788-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Figure7.3. Polynomial linear models of increasing</span><span class="sc">\n</span><span class="st">degree for the hominin data.&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>It’s not clear, to me, why our <strong>brms</strong>-based 89% intervals are so much broader than those in the text. But if you do fit the size models with <code>rethinking::quap()</code> and compare the summaries, you’ll see our <strong>brms</strong>-based parameters are systemically less certain than those fit with <code>quap()</code>. In you have an answer or perhaps even an alternative workflow to solve the issue, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">share on GitHub</a>.</p>
<p>If you really what the axes scaled in the original metrics of the variables rather than their standardized form, you can use the re-scaling techniques from back in <a href="geocentric-models.html#overthinking-converting-back-to-natural-scale.">Section 4.5.1.0.1</a>.</p>
<p>“This is a general phenomenon: If you adopt a model family with enough parameters, you can fit the data exactly. But such a model will make rather absurd predictions for yet-to-be-observed cases” (pp. 199–201).</p>
<div id="rethinking-model-fitting-as-compression." class="section level4 hasAnchor" number="7.1.1.1">
<h4><span class="header-section-number">7.1.1.1</span> Rethinking: Model fitting as compression.<a href="ulysses-compass.html#rethinking-model-fitting-as-compression." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Another perspective on the absurd model just above is to consider that model fitting can be considered a form of <strong>data compression</strong>. Parameters summarize relationships among the data. These summaries compress the data into a simpler form, although with loss of information (“lossy” compression) about the sample. The parameters can then be used to generate new data, effectively decompressing the data. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
</div>
</div>
<div id="too-few-parameters-hurts-too." class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Too few parameters hurts, too.<a href="ulysses-compass.html#too-few-parameters-hurts-too." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The overfit polynomial models fit the data extremely well, but they suffer for this within-sample accuracy by making nonsensical out-of-sample predictions. In contrast, <strong>underfitting</strong> produces models that are inaccurate both within and out of sample. They learn too little, failing to recover regular features of the sample. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>To explore the distinctions between overfitting and underfitting, we’ll need to refit <code>b7.1</code> and <code>b7.4</code> several times after serially dropping one of the rows in the data. You can <code>filter()</code> by <code>row_number()</code> to drop rows in a <a href="https://dplyr.tidyverse.org/reference/slice.html"><strong>tidyverse</strong> kind of way</a>. For example, we can drop the second row of <code>d</code> like this.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="ulysses-compass.html#cb789-1" aria-hidden="true" tabindex="-1"></a> d <span class="sc">%&gt;%</span></span>
<span id="cb789-2"><a href="ulysses-compass.html#cb789-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb789-3"><a href="ulysses-compass.html#cb789-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   species     brain  mass mass_std brain_std   row
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
## 1 afarensis     438  37     -0.779     0.324     1
## 2 habilis       612  34.5   -1.01      0.453     3
## 3 boisei        521  41.5   -0.367     0.386     4
## 4 rudolfensis   752  55.5    0.917     0.557     5
## 5 ergaster      871  61      1.42      0.645     6
## 6 sapiens      1350  53.5    0.734     1         7</code></pre>
<p>In his <strong>Overthinking: Dropping rows</strong> box (p. 202), McElreath encouraged us to take a look at the <code>brain_loo_plot()</code> function to get a sense of how he made his Figure 7.4. Here it is.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="ulysses-compass.html#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb791-2"><a href="ulysses-compass.html#cb791-2" aria-hidden="true" tabindex="-1"></a>brain_loo_plot</span></code></pre></div>
<pre><code>## function (fit, atx = c(35, 47, 60), aty = c(450, 900, 1300), 
##     xlim, ylim, npts = 100) 
## {
##     post &lt;- extract.samples(fit)
##     n &lt;- dim(post$b)[2]
##     if (is.null(n)) 
##         n &lt;- 1
##     if (missing(xlim)) 
##         xlim &lt;- range(d$mass_std)
##     else xlim &lt;- (xlim - mean(d$mass))/sd(d$mass)
##     if (missing(ylim)) 
##         ylim &lt;- range(d$brain_std)
##     else ylim &lt;- ylim/max(d$brain)
##     plot(d$brain_std ~ d$mass_std, xaxt = &quot;n&quot;, yaxt = &quot;n&quot;, xlab = &quot;body mass (kg)&quot;, 
##         ylab = &quot;brain volume (cc)&quot;, col = rangi2, pch = 16, xlim = xlim, 
##         ylim = ylim)
##     axis_unscale(1, atx, d$mass)
##     axis_unscale(2, at = aty, factor = max(d$brain))
##     d &lt;- as.data.frame(fit@data)
##     for (i in 1:nrow(d)) {
##         di &lt;- d[-i, ]
##         m_temp &lt;- quap(fit@formula, data = di, start = list(b = rep(0, 
##             n)))
##         xseq &lt;- seq(from = xlim[1] - 0.2, to = xlim[2] + 0.2, 
##             length.out = npts)
##         l &lt;- link(m_temp, data = list(mass_std = xseq), refresh = 0)
##         mu &lt;- apply(l, 2, mean)
##         lines(xseq, mu, lwd = 2, col = col.alpha(&quot;black&quot;, 0.3))
##     }
##     model_name &lt;- deparse(match.call()[[2]])
##     mtext(model_name, adj = 0)
## }
## &lt;bytecode: 0x7fe8fe449450&gt;
## &lt;environment: namespace:rethinking&gt;</code></pre>
<p>Though we’ll be taking a slightly different route than the one outlined in McElreath’s <code>brain_loo_plot()</code> function, we can glean some great insights. For example, we’ll be refitting our <strong>brms</strong> models with <code>update()</code>.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="ulysses-compass.html#cb793-1" aria-hidden="true" tabindex="-1"></a>b7.<span class="fl">1.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb793-2"><a href="ulysses-compass.html#cb793-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b7<span class="fl">.1</span>,</span>
<span id="cb793-3"><a href="ulysses-compass.html#cb793-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> <span class="fu">filter</span>(d, <span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">1</span>), </span>
<span id="cb793-4"><a href="ulysses-compass.html#cb793-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb793-5"><a href="ulysses-compass.html#cb793-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb793-6"><a href="ulysses-compass.html#cb793-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b07.01.1&quot;</span>)</span>
<span id="cb793-7"><a href="ulysses-compass.html#cb793-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-8"><a href="ulysses-compass.html#cb793-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7.<span class="fl">1.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: brain_std ~ 1 + mass_std 
##    Data: filter(d, row_number() != 1) (Number of observations: 6) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.54      0.14     0.27     0.82 1.00     2385     1508
## mass_std      0.15      0.16    -0.16     0.46 1.00     2245     1692
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.32      0.17     0.14     0.77 1.00     1213     1479
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>You can see by the <code>newdata</code> statement that <code>b7.1.1</code> is fit on the <code>d</code> data after dropping the first row. Here’s how we might amend out plotting strategy from before to visualize the posterior mean for the model-implied trajectory.</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="ulysses-compass.html#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b7.<span class="fl">1.1</span>, </span>
<span id="cb795-2"><a href="ulysses-compass.html#cb795-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb795-3"><a href="ulysses-compass.html#cb795-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb795-4"><a href="ulysses-compass.html#cb795-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb795-5"><a href="ulysses-compass.html#cb795-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb795-6"><a href="ulysses-compass.html#cb795-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb795-7"><a href="ulysses-compass.html#cb795-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate),</span>
<span id="cb795-8"><a href="ulysses-compass.html#cb795-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb795-9"><a href="ulysses-compass.html#cb795-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb795-10"><a href="ulysses-compass.html#cb795-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb795-11"><a href="ulysses-compass.html#cb795-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb795-12"><a href="ulysses-compass.html#cb795-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b7.1.1&quot;</span>,</span>
<span id="cb795-13"><a href="ulysses-compass.html#cb795-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb795-14"><a href="ulysses-compass.html#cb795-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb795-15"><a href="ulysses-compass.html#cb795-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb795-16"><a href="ulysses-compass.html#cb795-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-19-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>Now we’ll make a <strong>brms</strong>-oriented version of McElreath’s <code>brain_loo_plot()</code> function. Our version <code>brain_loo_lines()</code> will refit the model and extract the lines information in one step. We’ll leave the plotting for a second step.</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="ulysses-compass.html#cb796-1" aria-hidden="true" tabindex="-1"></a>brain_loo_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, row, ...) {</span>
<span id="cb796-2"><a href="ulysses-compass.html#cb796-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-3"><a href="ulysses-compass.html#cb796-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the model</span></span>
<span id="cb796-4"><a href="ulysses-compass.html#cb796-4" aria-hidden="true" tabindex="-1"></a>  new_fit <span class="ot">&lt;-</span> </span>
<span id="cb796-5"><a href="ulysses-compass.html#cb796-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(brms_fit,</span>
<span id="cb796-6"><a href="ulysses-compass.html#cb796-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">newdata =</span> <span class="fu">filter</span>(d, <span class="fu">row_number</span>() <span class="sc">!=</span> row), </span>
<span id="cb796-7"><a href="ulysses-compass.html#cb796-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb796-8"><a href="ulysses-compass.html#cb796-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb796-9"><a href="ulysses-compass.html#cb796-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb796-10"><a href="ulysses-compass.html#cb796-10" aria-hidden="true" tabindex="-1"></a>           ...)</span>
<span id="cb796-11"><a href="ulysses-compass.html#cb796-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-12"><a href="ulysses-compass.html#cb796-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the lines values</span></span>
<span id="cb796-13"><a href="ulysses-compass.html#cb796-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(new_fit, </span>
<span id="cb796-14"><a href="ulysses-compass.html#cb796-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb796-15"><a href="ulysses-compass.html#cb796-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb796-16"><a href="ulysses-compass.html#cb796-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb796-17"><a href="ulysses-compass.html#cb796-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd)</span>
<span id="cb796-18"><a href="ulysses-compass.html#cb796-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-19"><a href="ulysses-compass.html#cb796-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here’s how <code>brain_loo_lines()</code> works.</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="ulysses-compass.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">brain_loo_lines</span>(b7<span class="fl">.1</span>, <span class="at">row =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb797-2"><a href="ulysses-compass.html#cb797-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 100
## Columns: 2
## $ Estimate &lt;dbl&gt; 0.2371488, 0.2433511, 0.2495535, 0.2557558, 0.2619582, 0.2681606, 0.2743629, 0.28…
## $ mass_std &lt;dbl&gt; -2.0000000, -1.9595960, -1.9191919, -1.8787879, -1.8383838, -1.7979798, -1.757575…</code></pre>
<p>Working within the <strong>tidyverse</strong> paradigm, we’ll make a tibble with the predefined <code>row</code> values. We will then use <code>purrr::map()</code> to plug those <code>row</code> values into <code>brain_loo_lines()</code>, which will return the desired posterior <code>mean</code> values for each corresponding value of <code>mass_std</code>. Here we do that for both <code>b7.1</code> and <code>b7.4</code>.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="ulysses-compass.html#cb799-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span>_fits <span class="ot">&lt;-</span></span>
<span id="cb799-2"><a href="ulysses-compass.html#cb799-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb799-3"><a href="ulysses-compass.html#cb799-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(row, <span class="sc">~</span><span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> b7<span class="fl">.1</span>, <span class="at">row =</span> .))) <span class="sc">%&gt;%</span> </span>
<span id="cb799-4"><a href="ulysses-compass.html#cb799-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span>
<span id="cb799-5"><a href="ulysses-compass.html#cb799-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-6"><a href="ulysses-compass.html#cb799-6" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span>_fits <span class="ot">&lt;-</span></span>
<span id="cb799-7"><a href="ulysses-compass.html#cb799-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb799-8"><a href="ulysses-compass.html#cb799-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(row, <span class="sc">~</span><span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> b7<span class="fl">.4</span>, </span>
<span id="cb799-9"><a href="ulysses-compass.html#cb799-9" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">row =</span> ., </span>
<span id="cb799-10"><a href="ulysses-compass.html#cb799-10" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">999</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb799-11"><a href="ulysses-compass.html#cb799-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span></code></pre></div>
<p>Now for each, pump those values into <code>ggplot()</code>, customize the settings, and combine the two ggplots to make the full Figure 7.4.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="ulysses-compass.html#cb800-1" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb800-2"><a href="ulysses-compass.html#cb800-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb800-3"><a href="ulysses-compass.html#cb800-3" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>_fits <span class="sc">%&gt;%</span>  </span>
<span id="cb800-4"><a href="ulysses-compass.html#cb800-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb800-5"><a href="ulysses-compass.html#cb800-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb800-6"><a href="ulysses-compass.html#cb800-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> row),</span>
<span id="cb800-7"><a href="ulysses-compass.html#cb800-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb800-8"><a href="ulysses-compass.html#cb800-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb800-9"><a href="ulysses-compass.html#cb800-9" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb800-10"><a href="ulysses-compass.html#cb800-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb800-11"><a href="ulysses-compass.html#cb800-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b7.1&quot;</span>,</span>
<span id="cb800-12"><a href="ulysses-compass.html#cb800-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb800-13"><a href="ulysses-compass.html#cb800-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb800-14"><a href="ulysses-compass.html#cb800-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb800-15"><a href="ulysses-compass.html#cb800-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std))</span>
<span id="cb800-16"><a href="ulysses-compass.html#cb800-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb800-17"><a href="ulysses-compass.html#cb800-17" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb800-18"><a href="ulysses-compass.html#cb800-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb800-19"><a href="ulysses-compass.html#cb800-19" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.4</span>_fits <span class="sc">%&gt;%</span>  </span>
<span id="cb800-20"><a href="ulysses-compass.html#cb800-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb800-21"><a href="ulysses-compass.html#cb800-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb800-22"><a href="ulysses-compass.html#cb800-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row),</span>
<span id="cb800-23"><a href="ulysses-compass.html#cb800-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb800-24"><a href="ulysses-compass.html#cb800-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb800-25"><a href="ulysses-compass.html#cb800-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb800-26"><a href="ulysses-compass.html#cb800-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb800-27"><a href="ulysses-compass.html#cb800-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b7.4&quot;</span>,</span>
<span id="cb800-28"><a href="ulysses-compass.html#cb800-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb800-29"><a href="ulysses-compass.html#cb800-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb800-30"><a href="ulysses-compass.html#cb800-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb800-31"><a href="ulysses-compass.html#cb800-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.4</span>))</span>
<span id="cb800-32"><a href="ulysses-compass.html#cb800-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb800-33"><a href="ulysses-compass.html#cb800-33" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb800-34"><a href="ulysses-compass.html#cb800-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>“Notice that the straight lines hardly vary, while the curves fly about wildly. This is a general contrast between underfit and overfit models: sensitivity to the exact composition of the sample used to fit the model” (p. 201).</p>
<div id="rethinking-bias-and-variance." class="section level4 hasAnchor" number="7.1.2.1">
<h4><span class="header-section-number">7.1.2.1</span> Rethinking: Bias and variance.<a href="ulysses-compass.html#rethinking-bias-and-variance." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The underfitting/overfitting dichotomy is often described as the <strong>bias-variance trade-off</strong>. While not exactly the same distinction, the bias-variance trade-off addresses the same problem. “Bias” is related to underfitting, while “variance” is related to overfitting. These terms are confusing, because they are used in many different ways in different contexts, even within statistics. The term “bias” also sounds like a bad thing, even though increasing bias often leads
to better predictions. (p. 201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Take a look at <span class="citation">Yarkoni &amp; Westfall (<a href="#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span> for more on the bias-variance trade-off. As McElreath indicated in his endnote #104 (p. 563), Hastie, Tibshirani and Friedman <span class="citation">(<a href="#ref-hastie2009elements" role="doc-biblioref">2009</a>)</span> broadly cover these ideas in their freely-downloadable text, <a href="https://link.springer.com/book/10.1007%2F978-0-387-84858-7"><em>The elements of statistical learning</em></a>.</p>
</div>
</div>
</div>
<div id="entropy-and-accuracy" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Entropy and accuracy<a href="ulysses-compass.html#entropy-and-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>So how do we navigate between the hydra of overfitting and the vortex of underfitting? Whether you end up using regularization or information criteria or both, the first thing you must do is pick a criterion of model performance. What do you want the model to do well at? We’ll call this criterion the <em>target</em>, and in this section you’ll see how information theory provides a common and useful target. (p. 202, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="firing-the-weatherperson." class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Firing the weatherperson.<a href="ulysses-compass.html#firing-the-weatherperson." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you let rain = 1 and sun = 0, here’s a way to make a plot of the first table of page 203, the weatherperson’s predictions.</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="ulysses-compass.html#cb801-1" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="ot">&lt;-</span></span>
<span id="cb801-2"><a href="ulysses-compass.html#cb801-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">day        =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb801-3"><a href="ulysses-compass.html#cb801-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">prediction =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.6</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)),</span>
<span id="cb801-4"><a href="ulysses-compass.html#cb801-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">observed   =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>))) </span>
<span id="cb801-5"><a href="ulysses-compass.html#cb801-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-6"><a href="ulysses-compass.html#cb801-6" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="sc">%&gt;%</span> </span>
<span id="cb801-7"><a href="ulysses-compass.html#cb801-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day) <span class="sc">%&gt;%</span></span>
<span id="cb801-8"><a href="ulysses-compass.html#cb801-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb801-9"><a href="ulysses-compass.html#cb801-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> name, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb801-10"><a href="ulysses-compass.html#cb801-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb801-11"><a href="ulysses-compass.html#cb801-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value, <span class="at">color =</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb801-12"><a href="ulysses-compass.html#cb801-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb801-13"><a href="ulysses-compass.html#cb801-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb801-14"><a href="ulysses-compass.html#cb801-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb801-15"><a href="ulysses-compass.html#cb801-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb801-16"><a href="ulysses-compass.html#cb801-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb801-17"><a href="ulysses-compass.html#cb801-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-25-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here’s how the newcomer fared:</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="ulysses-compass.html#cb802-1" aria-hidden="true" tabindex="-1"></a>newcomer <span class="ot">&lt;-</span></span>
<span id="cb802-2"><a href="ulysses-compass.html#cb802-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">day        =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb802-3"><a href="ulysses-compass.html#cb802-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">prediction =</span> <span class="dv">0</span>,</span>
<span id="cb802-4"><a href="ulysses-compass.html#cb802-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">observed   =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)))</span>
<span id="cb802-5"><a href="ulysses-compass.html#cb802-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb802-6"><a href="ulysses-compass.html#cb802-6" aria-hidden="true" tabindex="-1"></a>newcomer <span class="sc">%&gt;%</span> </span>
<span id="cb802-7"><a href="ulysses-compass.html#cb802-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day) <span class="sc">%&gt;%</span></span>
<span id="cb802-8"><a href="ulysses-compass.html#cb802-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb802-9"><a href="ulysses-compass.html#cb802-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> name, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb802-10"><a href="ulysses-compass.html#cb802-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb802-11"><a href="ulysses-compass.html#cb802-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value, <span class="at">color =</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb802-12"><a href="ulysses-compass.html#cb802-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb802-13"><a href="ulysses-compass.html#cb802-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb802-14"><a href="ulysses-compass.html#cb802-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb802-15"><a href="ulysses-compass.html#cb802-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb802-16"><a href="ulysses-compass.html#cb802-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb802-17"><a href="ulysses-compass.html#cb802-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If we do the math entailed in the tibbles, we’ll see why the newcomer could boast “I’m the best person for the job” (p. 203).</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="ulysses-compass.html#cb803-1" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="sc">%&gt;%</span> </span>
<span id="cb803-2"><a href="ulysses-compass.html#cb803-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(newcomer) <span class="sc">%&gt;%</span> </span>
<span id="cb803-3"><a href="ulysses-compass.html#cb803-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb803-4"><a href="ulysses-compass.html#cb803-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hit    =</span> <span class="fu">ifelse</span>(prediction <span class="sc">==</span> observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> prediction <span class="sc">-</span> observed)) <span class="sc">%&gt;%</span> </span>
<span id="cb803-5"><a href="ulysses-compass.html#cb803-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span> </span>
<span id="cb803-6"><a href="ulysses-compass.html#cb803-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hit_rate =</span> <span class="fu">mean</span>(hit))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   person        hit_rate
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 newcomer          0.7 
## 2 weatherperson     0.58</code></pre>
<div id="costs-and-benefits." class="section level4 hasAnchor" number="7.2.1.1">
<h4><span class="header-section-number">7.2.1.1</span> Costs and benefits.<a href="ulysses-compass.html#costs-and-benefits." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Our new <code>points</code> variable doesn’t fit into the nice color-based <code>geom_tile()</code> plots from above, but we can still do the math.</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="ulysses-compass.html#cb805-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(weatherperson,</span>
<span id="cb805-2"><a href="ulysses-compass.html#cb805-2" aria-hidden="true" tabindex="-1"></a>          newcomer) <span class="sc">%&gt;%</span> </span>
<span id="cb805-3"><a href="ulysses-compass.html#cb805-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb805-4"><a href="ulysses-compass.html#cb805-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">points =</span> <span class="fu">ifelse</span>(observed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> prediction <span class="sc">!=</span> <span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb805-5"><a href="ulysses-compass.html#cb805-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(observed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> prediction <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb805-6"><a href="ulysses-compass.html#cb805-6" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> prediction))) <span class="sc">%&gt;%</span> </span>
<span id="cb805-7"><a href="ulysses-compass.html#cb805-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span> </span>
<span id="cb805-8"><a href="ulysses-compass.html#cb805-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">happiness =</span> <span class="fu">sum</span>(points))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   person        happiness
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 newcomer          -15  
## 2 weatherperson      -7.2</code></pre>
</div>
<div id="measuring-accuracy." class="section level4 hasAnchor" number="7.2.1.2">
<h4><span class="header-section-number">7.2.1.2</span> Measuring accuracy.<a href="ulysses-compass.html#measuring-accuracy." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Consider computing the probability of predicting the exact sequence of days. This means computing the probability of a correct prediction for each day. Then multiply all of these probabilities together to get the joint probability of correctly predicting the observed sequence. This is the same thing as the joint likelihood, which you’ve been using up to this point to fit models with Bayes’ theorem. This is the definition of accuracy that is maximized by the correct model.</p>
<p>In this light, the newcomer looks even worse. (p. 204)</p>
</blockquote>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="ulysses-compass.html#cb807-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(weatherperson,</span>
<span id="cb807-2"><a href="ulysses-compass.html#cb807-2" aria-hidden="true" tabindex="-1"></a>          newcomer) <span class="sc">%&gt;%</span> </span>
<span id="cb807-3"><a href="ulysses-compass.html#cb807-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;weatherperson&quot;</span>, <span class="st">&quot;newcomer&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb807-4"><a href="ulysses-compass.html#cb807-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hit    =</span> <span class="fu">ifelse</span>(prediction <span class="sc">==</span> observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> prediction <span class="sc">-</span> observed)) <span class="sc">%&gt;%</span> </span>
<span id="cb807-5"><a href="ulysses-compass.html#cb807-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(person, hit) <span class="sc">%&gt;%</span> </span>
<span id="cb807-6"><a href="ulysses-compass.html#cb807-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">power =</span> hit <span class="sc">^</span> n,</span>
<span id="cb807-7"><a href="ulysses-compass.html#cb807-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">term  =</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">times =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb807-8"><a href="ulysses-compass.html#cb807-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(person, term, power) <span class="sc">%&gt;%</span> </span>
<span id="cb807-9"><a href="ulysses-compass.html#cb807-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term,</span>
<span id="cb807-10"><a href="ulysses-compass.html#cb807-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> power) <span class="sc">%&gt;%</span> </span>
<span id="cb807-11"><a href="ulysses-compass.html#cb807-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability_correct_sequence =</span> a <span class="sc">*</span> b)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   person              a     b probability_correct_sequence
##   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;                        &lt;dbl&gt;
## 1 newcomer      0           1                      0      
## 2 weatherperson 0.00164     1                      0.00164</code></pre>
</div>
</div>
<div id="information-and-uncertainty." class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Information and uncertainty.<a href="ulysses-compass.html#information-and-uncertainty." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Within the context of information theory <span class="citation">(<a href="#ref-shannonMathematicalTheoryCommunication1948" role="doc-biblioref">Shannon, 1948</a>; also <a href="#ref-cover2006elements" role="doc-biblioref">Cover &amp; Thomas, 2006</a>)</span>, information is “the reduction in uncertainty when we learn an outcome” (p. 205). <strong>Information entropy</strong> is a way of measuring that uncertainty in a way that is (a) continuous, (b) increases as the number of possible events increases, and (c) is additive. The formula for information entropy is:</p>
<p><span class="math display">\[H(p) = - \text E \log (p_i) = - \sum_{i = 1}^n p_i \log (p_i).\]</span></p>
<p>McElreath put it in words as: “The uncertainty contained in a probability distribution is the average log-probability of an event.” (p. 206). We’ll compute the information entropy for weather at the first unnamed location, which we’ll call <code>McElreath's house</code>, and <code>Abu Dhabi</code> at once.</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="ulysses-compass.html#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">place  =</span> <span class="fu">c</span>(<span class="st">&quot;McElreath&#39;s house&quot;</span>, <span class="st">&quot;Abu Dhabi&quot;</span>),</span>
<span id="cb809-2"><a href="ulysses-compass.html#cb809-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_rain =</span> <span class="fu">c</span>(.<span class="dv">3</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb809-3"><a href="ulysses-compass.html#cb809-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_shine =</span> <span class="dv">1</span> <span class="sc">-</span> p_rain) <span class="sc">%&gt;%</span> </span>
<span id="cb809-4"><a href="ulysses-compass.html#cb809-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(place) <span class="sc">%&gt;%</span> </span>
<span id="cb809-5"><a href="ulysses-compass.html#cb809-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h_p =</span> (p_rain <span class="sc">*</span> <span class="fu">log</span>(p_rain) <span class="sc">+</span> p_shine <span class="sc">*</span> <span class="fu">log</span>(p_shine)) <span class="sc">%&gt;%</span> <span class="fu">mean</span>() <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
## # Groups:   place [2]
##   place             p_rain p_shine    h_p
##   &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 McElreath&#39;s house   0.3     0.7  0.611 
## 2 Abu Dhabi           0.01    0.99 0.0560</code></pre>
<p>Did you catch how we used the equation <span class="math inline">\(H(p) = - \sum_{i = 1}^n p_i \log (p_i)\)</span> in our <code>mutate()</code> code, there? Our computation indicated the uncertainty is less in Abu Dhabi because it rarely rains, there. If you have sun, rain and snow, the entropy for weather is:</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="ulysses-compass.html#cb811-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">15</span>, .<span class="dv">15</span>)</span>
<span id="cb811-2"><a href="ulysses-compass.html#cb811-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p))</span></code></pre></div>
<pre><code>## [1] 0.8188085</code></pre>
<p>“These entropy values by themselves don’t mean much to us, though. Instead we can use them to build a measure of accuracy. That comes next” (p. 206).</p>
</div>
<div id="from-entropy-to-accuracy." class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> From entropy to accuracy.<a href="ulysses-compass.html#from-entropy-to-accuracy." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>How can we use information entropy to say how far a model is from the target? The key lies in <strong>divergence</strong>:</p>
<blockquote>
<p><strong>Divergence</strong>: The additional uncertainty induced by using probabilities from one distribution to describe another distribution.</p>
</blockquote>
<p>This is often known as <em>Kullback-Leibler divergence</em> or simply KL divergence. <span class="citation">(p. 207, <strong>emphasis</strong> in the original, see <a href="#ref-kullbackInformationSufficiency1951" role="doc-biblioref">Kullback &amp; Leibler, 1951</a>)</span></p>
</blockquote>
<p>The formula for the KL divergence is</p>
<p><span class="math display">\[D_\text{KL} (p, q) = \sum_i p_i \big ( \log (p_i) - \log (q_i) \big ) = \sum_i p_i \log \left ( \frac{p_i}{q_i} \right ),\]</span></p>
<p>which is what McElreath described in plainer language as “the average difference in log probability between the target (<span class="math inline">\(p\)</span>) and model (<span class="math inline">\(q\)</span>)” (p. 207).</p>
<p>In McElreath’s initial example</p>
<ul>
<li><span class="math inline">\(p_1 = .3\)</span>,</li>
<li><span class="math inline">\(p_2 = .7\)</span>,</li>
<li><span class="math inline">\(q_1 = .25\)</span>, and</li>
<li><span class="math inline">\(q_2 = .75\)</span>.</li>
</ul>
<p>With those values, we can compute <span class="math inline">\(D_\text{KL} (p, q)\)</span> within a tibble like so:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="ulysses-compass.html#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p_1 =</span> .<span class="dv">3</span>,</span>
<span id="cb813-2"><a href="ulysses-compass.html#cb813-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_2 =</span> .<span class="dv">7</span>,</span>
<span id="cb813-3"><a href="ulysses-compass.html#cb813-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_1 =</span> .<span class="dv">25</span>,</span>
<span id="cb813-4"><a href="ulysses-compass.html#cb813-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_2 =</span> .<span class="dv">75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb813-5"><a href="ulysses-compass.html#cb813-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##     p_1   p_2   q_1   q_2    d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1   0.3   0.7  0.25  0.75 0.00640</code></pre>
<p>Our systems in this section are binary (e.g., <span class="math inline">\(q = \{ q_i, q_2 \}\)</span>). Thus if you know <span class="math inline">\(q_1 = .3\)</span> you know of a necessity <span class="math inline">\(q_2 = 1 - q_1\)</span>. Therefore we can code the tibble for the next example, for when <span class="math inline">\(p = q\)</span>, like this.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="ulysses-compass.html#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p_1 =</span> .<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb815-2"><a href="ulysses-compass.html#cb815-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2 =</span> <span class="dv">1</span> <span class="sc">-</span> p_1,</span>
<span id="cb815-3"><a href="ulysses-compass.html#cb815-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_1 =</span> p_1) <span class="sc">%&gt;%</span> </span>
<span id="cb815-4"><a href="ulysses-compass.html#cb815-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">%&gt;%</span></span>
<span id="cb815-5"><a href="ulysses-compass.html#cb815-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##     p_1   p_2   q_1   q_2  d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0.3   0.7   0.3   0.7     0</code></pre>
<p>Building off of that, you can make the data required for Figure 7.6 like this.</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="ulysses-compass.html#cb817-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> </span>
<span id="cb817-2"><a href="ulysses-compass.html#cb817-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">p_1 =</span> .<span class="dv">3</span>,</span>
<span id="cb817-3"><a href="ulysses-compass.html#cb817-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_2 =</span> .<span class="dv">7</span>,</span>
<span id="cb817-4"><a href="ulysses-compass.html#cb817-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">01</span>, <span class="at">to =</span> .<span class="dv">99</span>, <span class="at">by =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb817-5"><a href="ulysses-compass.html#cb817-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">%&gt;%</span></span>
<span id="cb817-6"><a href="ulysses-compass.html#cb817-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span>
<span id="cb817-7"><a href="ulysses-compass.html#cb817-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb817-8"><a href="ulysses-compass.html#cb817-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##     p_1   p_2   q_1   q_2  d_kl
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   0.3   0.7  0.01  0.99 0.778
## 2   0.3   0.7  0.02  0.98 0.577
## 3   0.3   0.7  0.03  0.97 0.462
## 4   0.3   0.7  0.04  0.96 0.383
## 5   0.3   0.7  0.05  0.95 0.324
## 6   0.3   0.7  0.06  0.94 0.276</code></pre>
<p>Now we have the data, plotting Figure 7.6 is a just <code>geom_line()</code> with stylistic flourishes.</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="ulysses-compass.html#cb819-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">%&gt;%</span> </span>
<span id="cb819-2"><a href="ulysses-compass.html#cb819-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> q_1, <span class="at">y =</span> d_kl)) <span class="sc">+</span></span>
<span id="cb819-3"><a href="ulysses-compass.html#cb819-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">3</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb819-4"><a href="ulysses-compass.html#cb819-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb819-5"><a href="ulysses-compass.html#cb819-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> .<span class="dv">4</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">&quot;q = p&quot;</span>,</span>
<span id="cb819-6"><a href="ulysses-compass.html#cb819-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb819-7"><a href="ulysses-compass.html#cb819-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;q[1]&quot;</span>,</span>
<span id="cb819-8"><a href="ulysses-compass.html#cb819-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Divergence of q from p&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-35-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>What divergence can do for us now is help us contrast different approximations to <span class="math inline">\(p\)</span>. As an approximating function <span class="math inline">\(q\)</span> becomes more accurate, <span class="math inline">\(D_\text{KL} (p, q)\)</span> will shrink. So if we have a pair of candidate distributions, then the candidate that minimizes the divergence will be closest to the target. Since predictive models specify probabilities of events (observations), we can use divergence to compare the accuracy of models. (p. 208)</p>
</blockquote>
<div id="rethinking-divergence-depends-upon-direction." class="section level4 hasAnchor" number="7.2.3.1">
<h4><span class="header-section-number">7.2.3.1</span> Rethinking: Divergence depends upon direction.<a href="ulysses-compass.html#rethinking-divergence-depends-upon-direction." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here we see <span class="math inline">\(H(p, q) \neq H(q, p)\)</span>. That is, direction matters.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="ulysses-compass.html#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">direction =</span> <span class="fu">c</span>(<span class="st">&quot;Earth to Mars&quot;</span>, <span class="st">&quot;Mars to Earth&quot;</span>),</span>
<span id="cb820-2"><a href="ulysses-compass.html#cb820-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_1       =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">7</span>),</span>
<span id="cb820-3"><a href="ulysses-compass.html#cb820-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_1       =</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb820-4"><a href="ulysses-compass.html#cb820-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2 =</span> <span class="dv">1</span> <span class="sc">-</span> p_1,</span>
<span id="cb820-5"><a href="ulysses-compass.html#cb820-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">%&gt;%</span></span>
<span id="cb820-6"><a href="ulysses-compass.html#cb820-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   direction       p_1   q_1   p_2   q_2  d_kl
##   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Earth to Mars  0.01  0.7   0.99  0.3   1.14
## 2 Mars to Earth  0.7   0.01  0.3   0.99  2.62</code></pre>
<p>The <span class="math inline">\(D_\text{KL}\)</span> was double when applying Martian estimates to Terran estimates.</p>
<blockquote>
<p>An important practical consequence of this asymmetry, in a model fitting context, is that if we use a distribution with high entropy to approximate an unknown true distribution of events, we will reduce the distance to the truth and therefore the error. This fact will help us build generalized linear models, later on in <a href="big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model">Chapter 10</a>. (p. 209)</p>
</blockquote>
</div>
</div>
<div id="estimating-divergence." class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Estimating divergence.<a href="ulysses-compass.html#estimating-divergence." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The point of all the preceding material about information theory and divergence is to establish both:</p>
<ol style="list-style-type: decimal">
<li><p>How to measure the distance of a model from our target. Information theory gives us the distance measure we need, the KL divergence.</p></li>
<li><p>How to estimate the divergence. Having identified the right measure of distance, we now need a way to estimate it in real statistical modeling tasks. (p. 209)</p></li>
</ol>
</blockquote>
<p>Now we’ll start working on item #2.</p>
<p>Within the context of science, say we’ve labeled the true model for our topic of interest as <span class="math inline">\(p\)</span>. We don’t actually know what <span class="math inline">\(p\)</span> is–we wouldn’t need the scientific method if we did. But say what we do have are two candidate models <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span>. We would at least like to know which is closer to <span class="math inline">\(p\)</span>. It turns out we don’t even need to know the absolute value of <span class="math inline">\(p\)</span> to achieve this. Just the relative values of <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> will suffice. We express model <span class="math inline">\(q\)</span>’s average log-probability as <span class="math inline">\(\text E \log (q_i)\)</span>. Extrapolating, the difference <span class="math inline">\(\text E \log (q_i) - \text E \log (r_i)\)</span> gives us a sense about the divergence of both <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> from the target <span class="math inline">\(p\)</span>. That is, “we can compare the average log-probability from each model to get an estimate of the relative distance of each model from the target” (p. 210). <strong>Deviance</strong> and related statistics can help us towards this end. We define deviance as</p>
<p><span class="math display">\[D(q) = -2 \sum_i \log (q_i),\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes each case and <span class="math inline">\(q_i\)</span> is the likelihood for each case. Here’s the deviance from the OLS version of model <code>m7.1</code>.</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="ulysses-compass.html#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">data =</span> d, brain_std <span class="sc">~</span> mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb822-2"><a href="ulysses-compass.html#cb822-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logLik</span>() <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; -5.985049 (df=3)</code></pre>
<p>In our <span class="math inline">\(D(q)\)</span> formula, did you notice how we ended up multiplying <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span>? Frequentists and Bayesians alike make use of information theory, KL divergence, and deviance. It turns out that the differences between two <span class="math inline">\(D(q)\)</span> values follows a <span class="math inline">\(\chi^2\)</span> distribution <span class="citation">(<a href="#ref-wilksLargesampleDistributionLikelihood1938" role="doc-biblioref">Wilks, 1938</a>)</span>, which frequentists like to reference for the purpose of null-hypothesis significance testing. Many Bayesians, however, are not into all that significance-testing stuff and they aren’t as inclined to multiply <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span> for the simple purpose of scaling the associated difference distribution to follow the <span class="math inline">\(\chi^2\)</span>. If we leave that part out of the equation, we end up with</p>
<p><span class="math display">\[S(q) = \sum_i \log (q_i),\]</span></p>
<p>which we can think of as a log-probability score which is “the gold standard way to compare the predictive accuracy of different models. It is an estimate of <span class="math inline">\(\text E \log (q_i)\)</span>, just without the final step of dividing by the number of observations” (p. 210). When Bayesians compute <span class="math inline">\(S(q)\)</span>, they do so over the entire posterior distribution. “Doing this calculation correctly requires a little subtlety. The <strong>rethinking</strong> package has a function called <code>lppd</code>–<strong>log-pointwise-predictive-density</strong>–to do this calculation for quap models” (p. 210, <strong>emphasis</strong> in the original for the second time, but not the first). However, I’m now aware of a similar function within <strong>brms</strong>. If you’re willing to roll up your sleeves, a little, you can do it by hand. Here’s an example with <code>b7.1</code>.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="ulysses-compass.html#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(b7<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb824-2"><a href="ulysses-compass.html#cb824-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb824-3"><a href="ulysses-compass.html#cb824-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb824-4"><a href="ulysses-compass.html#cb824-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb824-5"><a href="ulysses-compass.html#cb824-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb824-6"><a href="ulysses-compass.html#cb824-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;logprob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb824-7"><a href="ulysses-compass.html#cb824-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">%&gt;%</span> </span>
<span id="cb824-8"><a href="ulysses-compass.html#cb824-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb824-9"><a href="ulysses-compass.html#cb824-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>())</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   species     log_probability_score
##   &lt;chr&gt;                       &lt;dbl&gt;
## 1 afarensis                   0.368
## 2 africanus                   0.392
## 3 boisei                      0.384
## 4 ergaster                    0.218
## 5 habilis                     0.321
## 6 rudolfensis                 0.259
## 7 sapiens                    -0.577</code></pre>
<p>“If you sum these values, you’ll have the total log-probability score for the model and data” (p. 210). Here we sum those <span class="math inline">\(\log (q_i)\)</span> values up to compute <span class="math inline">\(S(q)\)</span>.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="ulysses-compass.html#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(b7<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb826-2"><a href="ulysses-compass.html#cb826-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb826-3"><a href="ulysses-compass.html#cb826-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb826-4"><a href="ulysses-compass.html#cb826-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb826-5"><a href="ulysses-compass.html#cb826-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb826-6"><a href="ulysses-compass.html#cb826-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;logprob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb826-7"><a href="ulysses-compass.html#cb826-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">%&gt;%</span> </span>
<span id="cb826-8"><a href="ulysses-compass.html#cb826-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb826-9"><a href="ulysses-compass.html#cb826-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb826-10"><a href="ulysses-compass.html#cb826-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   total_log_probability_score
##                         &lt;dbl&gt;
## 1                        1.36</code></pre>
<div id="overthinking-computing-the-lppd." class="section level4 hasAnchor" number="7.2.4.1">
<h4><span class="header-section-number">7.2.4.1</span> Overthinking: Computing the lppd.<a href="ulysses-compass.html#overthinking-computing-the-lppd." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Bayesian version of the log-probability score, what we’ve been calling the lppd, has to account for the data and the posterior distribution. It follows the form</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i | \Theta_s),\]</span></p>
<blockquote>
<p>where <span class="math inline">\(S\)</span> is the number of samples and <span class="math inline">\(\Theta_s\)</span> is the <span class="math inline">\(s\)</span>-th set of sampled parameter values in the posterior distribution. While in principle this is easy–you just need to compute the probability (density) of each observation <span class="math inline">\(i\)</span> for each sample <span class="math inline">\(s\)</span>, take the average, and then the logarithm–in practice it is not so easy. The reason is that doing arithmetic in a computer often requires some tricks to retain precision. (p. 210)</p>
</blockquote>
<p>Our approach to McElreath’s <strong>R</strong> code 7.14 code will look very different. Going step by step, first we use the <code>brms::log_lik()</code> function.</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="ulysses-compass.html#cb828-1" aria-hidden="true" tabindex="-1"></a>log_prob <span class="ot">&lt;-</span> <span class="fu">log_lik</span>(b7<span class="fl">.1</span>) </span>
<span id="cb828-2"><a href="ulysses-compass.html#cb828-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-3"><a href="ulysses-compass.html#cb828-3" aria-hidden="true" tabindex="-1"></a>log_prob <span class="sc">%&gt;%</span></span>
<span id="cb828-4"><a href="ulysses-compass.html#cb828-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>##  num [1:4000, 1:7] -0.0543 0.8522 -0.0777 -0.3936 0.2853 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>The <code>log_lik()</code> function returned a matrix. Each occasion in the original data, <span class="math inline">\(y_i\)</span>, got a column and each HMC chain iteration gets a row. Given we used the <strong>brms</strong> default of 4,000 HMC iterations, which corresponds to <span class="math inline">\(S = 4{,}000\)</span> in the formula. Note the each of these <span class="math inline">\(7 \times 4{,}000\)</span> values is a log-probability, not a probability itself. Thus, if we want to start summing these <span class="math inline">\(s\)</span> iterations within cases, we’ll need to exponentiate them into probabilities.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="ulysses-compass.html#cb830-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span></span>
<span id="cb830-2"><a href="ulysses-compass.html#cb830-2" aria-hidden="true" tabindex="-1"></a>  log_prob <span class="sc">%&gt;%</span> </span>
<span id="cb830-3"><a href="ulysses-compass.html#cb830-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make it a data frame</span></span>
<span id="cb830-4"><a href="ulysses-compass.html#cb830-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb830-5"><a href="ulysses-compass.html#cb830-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add case names, for convenience</span></span>
<span id="cb830-6"><a href="ulysses-compass.html#cb830-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb830-7"><a href="ulysses-compass.html#cb830-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add an s iteration index, for convenience</span></span>
<span id="cb830-8"><a href="ulysses-compass.html#cb830-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb830-9"><a href="ulysses-compass.html#cb830-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make it long</span></span>
<span id="cb830-10"><a href="ulysses-compass.html#cb830-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>s,</span>
<span id="cb830-11"><a href="ulysses-compass.html#cb830-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb830-12"><a href="ulysses-compass.html#cb830-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;logprob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb830-13"><a href="ulysses-compass.html#cb830-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the probability scores</span></span>
<span id="cb830-14"><a href="ulysses-compass.html#cb830-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob))</span>
<span id="cb830-15"><a href="ulysses-compass.html#cb830-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-16"><a href="ulysses-compass.html#cb830-16" aria-hidden="true" tabindex="-1"></a>prob</span></code></pre></div>
<pre><code>## # A tibble: 28,000 × 4
##        s species      logprob  prob
##    &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
##  1     1 afarensis   -0.0543  0.947
##  2     1 africanus   -0.0255  0.975
##  3     1 habilis      0.104   1.11 
##  4     1 boisei       0.00582 1.01 
##  5     1 rudolfensis  0.104   1.11 
##  6     1 ergaster     0.123   1.13 
##  7     1 sapiens     -0.468   0.626
##  8     2 afarensis    0.852   2.34 
##  9     2 africanus    0.775   2.17 
## 10     2 habilis      0.0499  1.05 
## # … with 27,990 more rows</code></pre>
<p>Now for each case, we take the average of each of the probability sores, and then take the log of that.</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="ulysses-compass.html#cb832-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span></span>
<span id="cb832-2"><a href="ulysses-compass.html#cb832-2" aria-hidden="true" tabindex="-1"></a>  prob <span class="sc">%&gt;%</span> </span>
<span id="cb832-3"><a href="ulysses-compass.html#cb832-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb832-4"><a href="ulysses-compass.html#cb832-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>())</span>
<span id="cb832-5"><a href="ulysses-compass.html#cb832-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb832-6"><a href="ulysses-compass.html#cb832-6" aria-hidden="true" tabindex="-1"></a>prob</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   species     log_probability_score
##   &lt;chr&gt;                       &lt;dbl&gt;
## 1 afarensis                   0.368
## 2 africanus                   0.392
## 3 boisei                      0.384
## 4 ergaster                    0.218
## 5 habilis                     0.321
## 6 rudolfensis                 0.259
## 7 sapiens                    -0.577</code></pre>
<p>For our last step, we sum those values up.</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="ulysses-compass.html#cb834-1" aria-hidden="true" tabindex="-1"></a>prob <span class="sc">%&gt;%</span> </span>
<span id="cb834-2"><a href="ulysses-compass.html#cb834-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   total_log_probability_score
##                         &lt;dbl&gt;
## 1                        1.36</code></pre>
<p>That, my friends, is the log-pointwise-predictive-density, <span class="math inline">\(\text{lppd}(y, \Theta)\)</span>.</p>
</div>
</div>
<div id="scoring-the-right-data." class="section level3 hasAnchor" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Scoring the right data.<a href="ulysses-compass.html#scoring-the-right-data." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we don’t have a <code>lppd()</code> function for <strong>brms</strong>, we’ll have to turn our workflow from the last two sections into a custom function. We’ll call it <code>my_lppd()</code>.</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="ulysses-compass.html#cb836-1" aria-hidden="true" tabindex="-1"></a>my_lppd <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit) {</span>
<span id="cb836-2"><a href="ulysses-compass.html#cb836-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb836-3"><a href="ulysses-compass.html#cb836-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(brms_fit) <span class="sc">%&gt;%</span> </span>
<span id="cb836-4"><a href="ulysses-compass.html#cb836-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb836-5"><a href="ulysses-compass.html#cb836-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb836-6"><a href="ulysses-compass.html#cb836-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;logprob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb836-7"><a href="ulysses-compass.html#cb836-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">%&gt;%</span> </span>
<span id="cb836-8"><a href="ulysses-compass.html#cb836-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb836-9"><a href="ulysses-compass.html#cb836-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb836-10"><a href="ulysses-compass.html#cb836-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span>
<span id="cb836-11"><a href="ulysses-compass.html#cb836-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb836-12"><a href="ulysses-compass.html#cb836-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here’s a <strong>tidyverse</strong>-style approach for computing the lppd for each of our six <strong>brms</strong> models.</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="ulysses-compass.html#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;b7.&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb837-2"><a href="ulysses-compass.html#cb837-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brms_fit =</span> purrr<span class="sc">::</span><span class="fu">map</span>(name, get)) <span class="sc">%&gt;%</span> </span>
<span id="cb837-3"><a href="ulysses-compass.html#cb837-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lppd =</span> purrr<span class="sc">::</span><span class="fu">map</span>(brms_fit, <span class="sc">~</span> <span class="fu">my_lppd</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb837-4"><a href="ulysses-compass.html#cb837-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(lppd)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   name  brms_fit  total_log_probability_score
##   &lt;chr&gt; &lt;list&gt;                          &lt;dbl&gt;
## 1 b7.1  &lt;brmsfit&gt;                      1.36  
## 2 b7.2  &lt;brmsfit&gt;                      0.694 
## 3 b7.3  &lt;brmsfit&gt;                      0.817 
## 4 b7.4  &lt;brmsfit&gt;                      0.0687
## 5 b7.5  &lt;brmsfit&gt;                      1.14  
## 6 b7.6  &lt;brmsfit&gt;                     25.9</code></pre>
<blockquote>
<p>When we usually have data and use it to fit a statistical model, the data comprise a <strong>training sample</strong>. Parameters are estimated from it, and then we can imagine using those estimates to predict outcomes in a new sample, called the <strong>test sample</strong>. R is going to do all of this for you. But here’s the full procedure, in outline:</p>
<ol style="list-style-type: decimal">
<li>Suppose there’s a training sample of size <span class="math inline">\(N\)</span>.</li>
<li>Compute the posterior distribution of a model for the training sample, and compute the score on the training sample. Call this score <span class="math inline">\(D_\text{train}\)</span>.</li>
<li>Suppose another sample of size <span class="math inline">\(N\)</span> from the same process. This is the test sample.</li>
<li>Compute the score on the test sample, using the posterior trained on the training
sample. Call this new score <span class="math inline">\(D_\text{test}\)</span>.</li>
</ol>
<p>The above is a thought experiment. It allows us to explore the distinction between accuracy measured in and out of sample, using a simple prediction scenario. (p. 211, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>We’ll see how to carry out such a thought experiment in the next section.</p>
<div id="overthinking-simulated-training-and-testing." class="section level4 hasAnchor" number="7.2.5.1">
<h4><span class="header-section-number">7.2.5.1</span> Overthinking: Simulated training and testing.<a href="ulysses-compass.html#overthinking-simulated-training-and-testing." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>McElreath plotted the results of such a thought experiment in implemented in <strong>R</strong> with the aid of his <code>sim_train_test()</code> function. If you’re interested in how the function pulls this off, execute the code below.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="ulysses-compass.html#cb839-1" aria-hidden="true" tabindex="-1"></a>sim_train_test</span></code></pre></div>
<p>For the sake of brevity, I am going to show the results of a simulation based on 1,000 simulations rather than McElreath’s 10,000.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="ulysses-compass.html#cb840-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I&#39;ve reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb840-2"><a href="ulysses-compass.html#cb840-2" aria-hidden="true" tabindex="-1"></a>n_sim   <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb840-3"><a href="ulysses-compass.html#cb840-3" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb840-4"><a href="ulysses-compass.html#cb840-4" aria-hidden="true" tabindex="-1"></a>kseq    <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb840-5"><a href="ulysses-compass.html#cb840-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb840-6"><a href="ulysses-compass.html#cb840-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define the simulation function</span></span>
<span id="cb840-7"><a href="ulysses-compass.html#cb840-7" aria-hidden="true" tabindex="-1"></a>my_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb840-8"><a href="ulysses-compass.html#cb840-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb840-9"><a href="ulysses-compass.html#cb840-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(k);</span>
<span id="cb840-10"><a href="ulysses-compass.html#cb840-10" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(n_sim, <span class="fu">sim_train_test</span>(<span class="at">N =</span> n, <span class="at">k =</span> k), <span class="at">mc.cores =</span> n_cores);</span>
<span id="cb840-11"><a href="ulysses-compass.html#cb840-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">mean</span>(r[<span class="dv">1</span>, ]), <span class="fu">mean</span>(r[<span class="dv">2</span>, ]), <span class="fu">sd</span>(r[<span class="dv">1</span>, ]), <span class="fu">sd</span>(r[<span class="dv">2</span>, ]))</span>
<span id="cb840-12"><a href="ulysses-compass.html#cb840-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb840-13"><a href="ulysses-compass.html#cb840-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb840-14"><a href="ulysses-compass.html#cb840-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb840-15"><a href="ulysses-compass.html#cb840-15" aria-hidden="true" tabindex="-1"></a><span class="co"># here&#39;s our dev object based on `N &lt;- 20`</span></span>
<span id="cb840-16"><a href="ulysses-compass.html#cb840-16" aria-hidden="true" tabindex="-1"></a>n      <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb840-17"><a href="ulysses-compass.html#cb840-17" aria-hidden="true" tabindex="-1"></a>dev_20 <span class="ot">&lt;-</span></span>
<span id="cb840-18"><a href="ulysses-compass.html#cb840-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(kseq, my_sim)</span>
<span id="cb840-19"><a href="ulysses-compass.html#cb840-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb840-20"><a href="ulysses-compass.html#cb840-20" aria-hidden="true" tabindex="-1"></a><span class="co"># here&#39;s our dev object based on N &lt;- 100</span></span>
<span id="cb840-21"><a href="ulysses-compass.html#cb840-21" aria-hidden="true" tabindex="-1"></a>n       <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb840-22"><a href="ulysses-compass.html#cb840-22" aria-hidden="true" tabindex="-1"></a>dev_100 <span class="ot">&lt;-</span> </span>
<span id="cb840-23"><a href="ulysses-compass.html#cb840-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(kseq, my_sim)</span></code></pre></div>
<p>If you didn’t quite catch it, the simulation yields <code>dev_20</code> and <code>dev_100</code>. We’ll want to convert them to tibbles, bind them together, and wrangle extensively before we’re ready to plot.</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="ulysses-compass.html#cb841-1" aria-hidden="true" tabindex="-1"></a>dev_tibble <span class="ot">&lt;-</span></span>
<span id="cb841-2"><a href="ulysses-compass.html#cb841-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(dev_20, dev_100) <span class="sc">%&gt;%</span> </span>
<span id="cb841-3"><a href="ulysses-compass.html#cb841-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb841-4"><a href="ulysses-compass.html#cb841-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statistic =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>), <span class="at">each =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(., <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb841-5"><a href="ulysses-compass.html#cb841-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample    =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;out&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(., <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb841-6"><a href="ulysses-compass.html#cb841-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n         =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>), <span class="at">each =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb841-7"><a href="ulysses-compass.html#cb841-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(statistic<span class="sc">:</span>n)) <span class="sc">%&gt;%</span> </span>
<span id="cb841-8"><a href="ulysses-compass.html#cb841-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> statistic, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb841-9"><a href="ulysses-compass.html#cb841-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n     =</span> <span class="fu">factor</span>(n, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>)),</span>
<span id="cb841-10"><a href="ulysses-compass.html#cb841-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_par =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb841-11"><a href="ulysses-compass.html#cb841-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_par =</span> <span class="fu">ifelse</span>(sample <span class="sc">==</span> <span class="st">&quot;in&quot;</span>, n_par <span class="sc">-</span> .<span class="dv">075</span>, n_par <span class="sc">+</span> .<span class="dv">075</span>))</span>
<span id="cb841-12"><a href="ulysses-compass.html#cb841-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-13"><a href="ulysses-compass.html#cb841-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dev_tibble)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   sample n      name   mean    sd n_par
##   &lt;chr&gt;  &lt;fct&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 in     n = 20 X1     56.0  6.06 0.925
## 2 in     n = 20 X2     54.7  5.51 1.92 
## 3 in     n = 20 X3     51.7  4.13 2.92 
## 4 in     n = 20 X4     51.3  3.68 3.92 
## 5 in     n = 20 X5     51.2  3.76 4.92 
## 6 out    n = 20 X1     57.6  6.43 1.08</code></pre>
<p>Now we’re ready to make Figure 7.6.</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="ulysses-compass.html#cb843-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the annotation</span></span>
<span id="cb843-2"><a href="ulysses-compass.html#cb843-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb843-3"><a href="ulysses-compass.html#cb843-3" aria-hidden="true" tabindex="-1"></a>  dev_tibble <span class="sc">%&gt;%</span> </span>
<span id="cb843-4"><a href="ulysses-compass.html#cb843-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_par <span class="sc">&gt;</span> <span class="fl">1.5</span>, </span>
<span id="cb843-5"><a href="ulysses-compass.html#cb843-5" aria-hidden="true" tabindex="-1"></a>         n_par <span class="sc">&lt;</span> <span class="fl">2.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb843-6"><a href="ulysses-compass.html#cb843-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_par =</span> <span class="fu">ifelse</span>(sample <span class="sc">==</span> <span class="st">&quot;in&quot;</span>, n_par <span class="sc">-</span> <span class="fl">0.2</span>, n_par <span class="sc">+</span> <span class="fl">0.29</span>))</span>
<span id="cb843-7"><a href="ulysses-compass.html#cb843-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb843-8"><a href="ulysses-compass.html#cb843-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot!</span></span>
<span id="cb843-9"><a href="ulysses-compass.html#cb843-9" aria-hidden="true" tabindex="-1"></a>dev_tibble <span class="sc">%&gt;%</span> </span>
<span id="cb843-10"><a href="ulysses-compass.html#cb843-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_par, <span class="at">y =</span> mean,</span>
<span id="cb843-11"><a href="ulysses-compass.html#cb843-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd,</span>
<span id="cb843-12"><a href="ulysses-compass.html#cb843-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> sample, <span class="at">color =</span> sample, <span class="at">fill  =</span> sample)) <span class="sc">+</span></span>
<span id="cb843-13"><a href="ulysses-compass.html#cb843-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb843-14"><a href="ulysses-compass.html#cb843-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb843-15"><a href="ulysses-compass.html#cb843-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> sample)) <span class="sc">+</span></span>
<span id="cb843-16"><a href="ulysses-compass.html#cb843-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values  =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb843-17"><a href="ulysses-compass.html#cb843-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb843-18"><a href="ulysses-compass.html#cb843-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Figure 7.6. Deviance in and out of sample.&quot;</span>,</span>
<span id="cb843-19"><a href="ulysses-compass.html#cb843-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;number of parameters&quot;</span>,</span>
<span id="cb843-20"><a href="ulysses-compass.html#cb843-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb843-21"><a href="ulysses-compass.html#cb843-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb843-22"><a href="ulysses-compass.html#cb843-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb843-23"><a href="ulysses-compass.html#cb843-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> n, <span class="at">scale =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-50-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Even with a substantially smaller <span class="math inline">\(N\)</span>, our simulation results matched up well with those in the text.</p>
<blockquote>
<p>Deviance is an assessment of predictive accuracy, not of truth. The true model, in terms of which predictors are included, is not guaranteed to produce the best predictions. Likewise a false model, in terms of which predictors are included, is not guaranteed to produce poor predictions.</p>
<p>The point of this thought experiment is to demonstrate how deviance behaves, in theory. While deviance on training data always improves with additional predictor variables, deviance on future data may or may not, depending upon both the true data-generating process and how much data is available to precisely estimate the parameters. These facts form the basis for understanding both regularizing priors and information criteria. (p. 213)</p>
</blockquote>
</div>
</div>
</div>
<div id="golem-taming-regularization" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Golem taming: regularization<a href="ulysses-compass.html#golem-taming-regularization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>The root of overfitting is a model’s tendency to get overexcited by the training sample. When the priors are flat or nearly flat, the machine interprets this to mean that every parameter value is equally plausible. As a result, the model returns a posterior that encodes as much of the training sample–as represented by the likelihood function–as possible.</p>
<p>One way to prevent a model from getting too excited by the training sample is to use a skeptical prior. By “skeptical,” I mean a prior that slows the rate of learning from the sample. The most common skeptical prior is a <strong>regularizing prior</strong>. Such a prior, when tuned properly, reduces overfitting while still allowing the model to learn the regular features of a sample. (p. 214, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>In case you were curious, here’s how you might make a version Figure 7.7 with <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="ulysses-compass.html#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span> <span class="fl">3.5</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb844-2"><a href="ulysses-compass.html#cb844-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>),</span>
<span id="cb844-3"><a href="ulysses-compass.html#cb844-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb844-4"><a href="ulysses-compass.html#cb844-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">c =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">1.0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb844-5"><a href="ulysses-compass.html#cb844-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb844-6"><a href="ulysses-compass.html#cb844-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb844-7"><a href="ulysses-compass.html#cb844-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb844-8"><a href="ulysses-compass.html#cb844-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> name, <span class="at">color =</span> name, <span class="at">linetype =</span> name)) <span class="sc">+</span></span>
<span id="cb844-9"><a href="ulysses-compass.html#cb844-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb844-10"><a href="ulysses-compass.html#cb844-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb844-11"><a href="ulysses-compass.html#cb844-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb844-12"><a href="ulysses-compass.html#cb844-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb844-13"><a href="ulysses-compass.html#cb844-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;parameter value&quot;</span>, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb844-14"><a href="ulysses-compass.html#cb844-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb844-15"><a href="ulysses-compass.html#cb844-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-51-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>In our version of the plot, darker purple = more regularizing.</p>
<p>To prepare for Figure 7.8, we need to simulate. This time we’ll wrap the basic simulation code we used before into a function we’ll call <code>make_sim()</code>. Our <code>make_sim()</code> function has two parameters, <code>n</code> and <code>b_sigma</code>, both of which come from McElreath’s simulation code. So you’ll note that instead of hard coding the values for <code>n</code> and <code>b_sigma</code> within the simulation, we’re leaving them adjustable (i.e., <code>sim_train_test(N = n, k = k, b_sigma = b_sigma)</code>). Also notice that instead of saving the simulation results as objects, like before, we’re just converting them to a data frame with the <code>data.frame()</code> function at the bottom. Our goal is to use <code>make_sim()</code> within a <code>purrr::map2()</code> statement. The result will be a nested data frame into which we’ve saved the results of 6 simulations based off of two sample sizes (i.e., <code>n = c(20, 100)</code>) and three values of <span class="math inline">\(\sigma\)</span> for our Gaussian <span class="math inline">\(\beta\)</span> prior (i.e., <code>b_sigma = c(1, .5, .2)</code>).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb845-1"><a href="ulysses-compass.html#cb845-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb845-2"><a href="ulysses-compass.html#cb845-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb845-3"><a href="ulysses-compass.html#cb845-3" aria-hidden="true" tabindex="-1"></a><span class="co"># I&#39;ve reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb845-4"><a href="ulysses-compass.html#cb845-4" aria-hidden="true" tabindex="-1"></a>n_sim   <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb845-5"><a href="ulysses-compass.html#cb845-5" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb845-6"><a href="ulysses-compass.html#cb845-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb845-7"><a href="ulysses-compass.html#cb845-7" aria-hidden="true" tabindex="-1"></a>make_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, b_sigma) {</span>
<span id="cb845-8"><a href="ulysses-compass.html#cb845-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(kseq, <span class="cf">function</span>(k) {</span>
<span id="cb845-9"><a href="ulysses-compass.html#cb845-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(k);</span>
<span id="cb845-10"><a href="ulysses-compass.html#cb845-10" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(n_sim, <span class="fu">sim_train_test</span>(<span class="at">N =</span> n, <span class="at">k =</span> k, <span class="at">b_sigma =</span> b_sigma),  <span class="co"># this is an augmented line of code</span></span>
<span id="cb845-11"><a href="ulysses-compass.html#cb845-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mc.cores =</span> n_cores);</span>
<span id="cb845-12"><a href="ulysses-compass.html#cb845-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fu">mean</span>(r[<span class="dv">1</span>, ]), <span class="fu">mean</span>(r[<span class="dv">2</span>, ]), <span class="fu">sd</span>(r[<span class="dv">1</span>, ]), <span class="fu">sd</span>(r[<span class="dv">2</span>, ])) </span>
<span id="cb845-13"><a href="ulysses-compass.html#cb845-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb845-14"><a href="ulysses-compass.html#cb845-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb845-15"><a href="ulysses-compass.html#cb845-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb845-16"><a href="ulysses-compass.html#cb845-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this is a new line of code</span></span>
<span id="cb845-17"><a href="ulysses-compass.html#cb845-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>()</span>
<span id="cb845-18"><a href="ulysses-compass.html#cb845-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb845-19"><a href="ulysses-compass.html#cb845-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb845-20"><a href="ulysses-compass.html#cb845-20" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span></span>
<span id="cb845-21"><a href="ulysses-compass.html#cb845-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">n       =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb845-22"><a href="ulysses-compass.html#cb845-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb845-23"><a href="ulysses-compass.html#cb845-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">map2</span>(n, b_sigma, make_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb845-24"><a href="ulysses-compass.html#cb845-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sim)</span></code></pre></div>
<p>We’ll follow the same principles for wrangling these data as we did those from the previous simulation, <code>dev_tibble</code>. After wrangling, we’ll feed the data directly into the code for our version of Figure 7.8.</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="ulysses-compass.html#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle the simulation data</span></span>
<span id="cb846-2"><a href="ulysses-compass.html#cb846-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> </span>
<span id="cb846-3"><a href="ulysses-compass.html#cb846-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statistic =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>), <span class="at">each =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(., <span class="at">times =</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb846-4"><a href="ulysses-compass.html#cb846-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample    =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;out&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(., <span class="at">times =</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb846-5"><a href="ulysses-compass.html#cb846-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(n<span class="sc">:</span>b_sigma, statistic<span class="sc">:</span>sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb846-6"><a href="ulysses-compass.html#cb846-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> statistic, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb846-7"><a href="ulysses-compass.html#cb846-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n     =</span> <span class="fu">str_c</span>(<span class="st">&quot;n = &quot;</span>, n) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;n = 20&quot;</span>, <span class="st">&quot;n = 100&quot;</span>)),</span>
<span id="cb846-8"><a href="ulysses-compass.html#cb846-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_par =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb846-9"><a href="ulysses-compass.html#cb846-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb846-10"><a href="ulysses-compass.html#cb846-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb846-11"><a href="ulysses-compass.html#cb846-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_par, <span class="at">y =</span> mean,</span>
<span id="cb846-12"><a href="ulysses-compass.html#cb846-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> <span class="fu">interaction</span>(sample, b_sigma))) <span class="sc">+</span></span>
<span id="cb846-13"><a href="ulysses-compass.html#cb846-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> sample, <span class="at">size =</span> b_sigma <span class="sc">%&gt;%</span> <span class="fu">as.character</span>())) <span class="sc">+</span></span>
<span id="cb846-14"><a href="ulysses-compass.html#cb846-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this function contains the data from the previous simulation</span></span>
<span id="cb846-15"><a href="ulysses-compass.html#cb846-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> dev_tibble, </span>
<span id="cb846-16"><a href="ulysses-compass.html#cb846-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">group =</span> sample, <span class="at">fill =</span> sample),</span>
<span id="cb846-17"><a href="ulysses-compass.html#cb846-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">stroke =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb846-18"><a href="ulysses-compass.html#cb846-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb846-19"><a href="ulysses-compass.html#cb846-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb846-20"><a href="ulysses-compass.html#cb846-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb846-21"><a href="ulysses-compass.html#cb846-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters&quot;</span>,</span>
<span id="cb846-22"><a href="ulysses-compass.html#cb846-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb846-23"><a href="ulysses-compass.html#cb846-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb846-24"><a href="ulysses-compass.html#cb846-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb846-25"><a href="ulysses-compass.html#cb846-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb846-26"><a href="ulysses-compass.html#cb846-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> n, <span class="at">scale =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.</code></pre>
<p><img src="07_files/figure-html/unnamed-chunk-54-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Our results don’t perfectly align with those in the text. I suspect his is because we used <code>1e3</code> iterations, rather than the <code>1e4</code> of the text. If you’d like to wait all night long for the simulation to yield more stable results, be my guest.</p>
<blockquote>
<p>Regularizing priors are great, because they reduce overfitting. But if they are too skeptical, they prevent the model from learning from the data. When you encounter multilevel models in <a href="models-with-memory.html#models-with-memory">Chapter 13</a>, you’ll see that their central device is to learn the strength of the prior from the data itself. So you can think of multilevel models as adaptive regularization, where the model itself tries to learn how skeptical it should be. (p. 216)</p>
</blockquote>
<p>I found this connection difficult to grasp for a long time. Practice now and hopefully it’ll sink in for you faster than it did me.</p>
<div id="rethinking-ridge-regression." class="section level4 hasAnchor" number="7.3.0.1">
<h4><span class="header-section-number">7.3.0.1</span> Rethinking: Ridge regression.<a href="ulysses-compass.html#rethinking-ridge-regression." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Within the <strong>brms</strong> framework, you can do something like this with the horseshoe prior via the <code>horseshoe()</code> function. You can learn all about it from the <code>horseshoe</code> section of the <a href="https://cran.r-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(<a href="#ref-brms2022RM" role="doc-biblioref">Bürkner, 2022i</a>)</span>. Here’s an extract from the section:</p>
<blockquote>
<p>The horseshoe prior is a special shrinkage prior initially proposed by <span class="citation">Carvalho et al. (<a href="#ref-carvalho2009handling" role="doc-biblioref">2009</a>)</span>. It is symmetric around zero with fat tails and an infinitely large spike at zero. This makes it ideal for sparse models that have many regression coefficients, although only a minority of them is nonzero. The horseshoe prior can be applied on all population-level effects at once (excluding the intercept) by using <code>set_prior("horseshoe(1)")</code>. ()p. 105</p>
</blockquote>
<p>To dive even deeper into the horseshoe prior, check out Michael Betancourt’s <span class="citation">(<a href="#ref-betancourtBayesSparse2018" role="doc-biblioref">2018</a>)</span> tutorial, <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html#35_the_horseshoe"><em>Bayes sparse regression</em></a>. Gelman, Hill, and Vehtari cover the horseshoe prior with <strong>rstanarm</strong> in Section 12.7 of their <span class="citation">(<a href="#ref-gelmanRegressionOtherStories2020" role="doc-biblioref">2020</a>)</span> text, <a href="https://avehtari.github.io/ROS-Examples/"><em>Regression and other stories</em></a>. I also have an example of the horseshoe prior (<code>fit18.5</code>) in <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients">Section 18.3</a> of my <span class="citation">(<a href="#ref-kurzDoingBayesianDataAnalysis2023" role="doc-biblioref">2023a</a>)</span> ebook translation of Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> text.</p>
</div>
</div>
<div id="predicting-predictive-accuracy" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Predicting predictive accuracy<a href="ulysses-compass.html#predicting-predictive-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>All of the preceding suggests one way to navigate overfitting and underfitting: Evaluate our models out-of-sample. But we do not have the out-of-sample, by definition, so how can we evaluate our models on it? There are two families of strategies: <strong>cross-validation</strong> and <strong>information criteria</strong>. These strategies try to guess how well models will perform, on average, in predicting new data. (p. 217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<div id="cross-validation." class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Cross-validation.<a href="ulysses-compass.html#cross-validation." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>A popular strategy for estimating predictive accuracy is to actually test the model’s predictive accuracy on another sample. This is known as <strong>cross-validation</strong>, leaving out a small chunk of observations from our sample and evaluating the model on the observations that were left out. Of course we don’t want to leave out data. So what is usually done is to divide the sample in a number of chunks, called “folds.” The model is asked to predict each fold, after training on all the others. We then average over the score for each fold to get an estimate of out-of-sample accuracy. The minimum number of folds is 2. At the other extreme, you could make each point observation a fold and fit as many models as you have individual observations. (p. 217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Folds are typically equivalent in size and we often denote the total number of folds by <span class="math inline">\(k\)</span>, which means that the number of cases will get smaller as <span class="math inline">\(k\)</span> increases. In the extreme <span class="math inline">\(k = N\)</span>. <strong>Leave-one-out cross-validation</strong> (LOO-CV) is the name for this popular type of cross-validation which uses the largest number of folds possible by including a single case in each fold <span class="citation">(<a href="#ref-derooijCrossvalidationMethodEvery2020" role="doc-biblioref">de Rooij &amp; Weeda, 2020</a>; see <a href="#ref-zhangCrossvalidationSelectingModel2015" role="doc-biblioref">Zhang &amp; Yang, 2015</a>)</span>. This will be our approach.</p>
<p>A practical difficulty with LOO-CV is it’s costly in terms of the time and memory required to refit the model <span class="math inline">\(k = N\)</span> times. Happily, we have an approximation to pure LOO-CV. Vehtari, Gelman, and Gabry <span class="citation">(<a href="#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">2017</a>)</span> proposed Pareto smoothed importance-sampling leave-one-out cross-validation (PSIS-LOO-CV) as an efficient way to approximate true LOO-CV.</p>
</div>
<div id="information-criteria." class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Information criteria.<a href="ulysses-compass.html#information-criteria." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The second approach is the use of <strong>information criteria</strong> to compute an expected score out of sample. Information criteria construct a theoretical estimate of the relative out-of-sample KL divergence. (p. 219, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>The frequentist Akaike information criterion <span class="citation">(AIC, <a href="#ref-akaike1998information" role="doc-biblioref">Akaike, 1998</a>)</span> is the oldest and most restrictive. Among Bayesians, the deviance information criterion <span class="citation">(DIC, <a href="#ref-spiegelhalterBayesianMeasuresModel2002" role="doc-biblioref">D. J. Spiegelhalter et al., 2002</a>)</span> has been widely used for some time, now. For a great talk on the DIC, check out the authoritative David Spiegelhalter’s <a href="https://youtu.be/H-59eqmHuuQ"><em>Retrospective read paper: Bayesian measure of model complexity and fit</em></a>. However, the DIC is limited in that it presumes the posterior is multivariate Gaussian, which is not always the case.</p>
<p>In this book, our focus will be on the widely applicable information criterion <span class="citation">(WAIC, <a href="#ref-watanabeAsymptoticEquivalenceBayes2010" role="doc-biblioref">Watanabe, 2010</a>)</span>, which does not impose assumptions on the shape of the posterior distribution. The WAIC both provides an estimate of out-of-sample deviance and converges with LOO-CV as <span class="math inline">\(N \rightarrow \infty\)</span>. The WAIC follows the formula</p>
<p><span class="math display">\[\text{WAIC}(y, \Theta) = -2 \big (\text{lppd} - \underbrace{\sum_i \operatorname{var}_\theta \log p(y_i | \theta)}_\text{penalty term} \big),\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the data, <span class="math inline">\(\Theta\)</span> is the posterior distribution, and <span class="math inline">\(\text{lppd}\)</span> is the log-posterior-predictive-density from before. The penalty term is also referred to at the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. There are a few ways to compute the WAIC with <strong>brms</strong>, including with the <code>waic()</code> function.</p>
<div id="overthinking-waic-calculations." class="section level4 hasAnchor" number="7.4.2.1">
<h4><span class="header-section-number">7.4.2.1</span> Overthinking: WAIC calculations.<a href="ulysses-compass.html#overthinking-waic-calculations." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here is how to fit the pre-WAIC model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="ulysses-compass.html#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cars)</span>
<span id="cb848-2"><a href="ulysses-compass.html#cb848-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-3"><a href="ulysses-compass.html#cb848-3" aria-hidden="true" tabindex="-1"></a>b7.m <span class="ot">&lt;-</span> </span>
<span id="cb848-4"><a href="ulysses-compass.html#cb848-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> cars, </span>
<span id="cb848-5"><a href="ulysses-compass.html#cb848-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb848-6"><a href="ulysses-compass.html#cb848-6" aria-hidden="true" tabindex="-1"></a>      dist <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> speed,</span>
<span id="cb848-7"><a href="ulysses-compass.html#cb848-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb848-8"><a href="ulysses-compass.html#cb848-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb848-9"><a href="ulysses-compass.html#cb848-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb848-10"><a href="ulysses-compass.html#cb848-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb848-11"><a href="ulysses-compass.html#cb848-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb848-12"><a href="ulysses-compass.html#cb848-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b07.0m&quot;</span>)</span></code></pre></div>
<p>Behold the posterior summary.</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="ulysses-compass.html#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7.m)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: dist ~ 1 + speed 
##    Data: cars (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   -17.47      6.04   -29.16    -5.55 1.00     3326     2531
## speed         3.92      0.37     3.21     4.64 1.00     3398     2547
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    13.78      1.19    11.64    16.36 1.00     3779     2902
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now use the <code>brms::log_lik()</code> function to return the log-likelihood for each observation <span class="math inline">\(i\)</span> at each posterior draw <span class="math inline">\(s\)</span>, where <span class="math inline">\(S = 4{,}000\)</span>.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="ulysses-compass.html#cb851-1" aria-hidden="true" tabindex="-1"></a>n_cases <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cars)</span>
<span id="cb851-2"><a href="ulysses-compass.html#cb851-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-3"><a href="ulysses-compass.html#cb851-3" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span></span>
<span id="cb851-4"><a href="ulysses-compass.html#cb851-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(b7.m) <span class="sc">%&gt;%</span></span>
<span id="cb851-5"><a href="ulysses-compass.html#cb851-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb851-6"><a href="ulysses-compass.html#cb851-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="sc">:</span>n_cases))</span>
<span id="cb851-7"><a href="ulysses-compass.html#cb851-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-8"><a href="ulysses-compass.html#cb851-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ll)</span></code></pre></div>
<p>We have a <span class="math inline">\(4{,}000 \times 50\)</span> (i.e., <span class="math inline">\(S \times N\)</span>) data frame with posterior draws in rows and cases in columns. Computing the <span class="math inline">\(\text{lppd}\)</span>, the “Bayesian deviance”, takes a bit of leg work. Recall the formula for <span class="math inline">\(\text{lppd}\)</span>,</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i | \Theta_s),\]</span></p>
<p>where <span class="math inline">\(p (y_i | \Theta_s)\)</span> is the likelihood of case <span class="math inline">\(i\)</span> on posterior draw <span class="math inline">\(s\)</span>. Since <code>log_lik()</code> returns the pointwise log-likelihood, our first step is to exponentiate those values. For each case <span class="math inline">\(i\)</span> (i.e., <span class="math inline">\(\sum_i\)</span>), we then take the average likelihood value [i.e., <span class="math inline">\(\frac{1}{S} \sum_s p (y_i | \Theta_s)\)</span>] and transform the result by taking its log [i.e., <span class="math inline">\(\log \left (\frac{1}{S} \sum_s p (y_i | \Theta_s) \right )\)</span>]. Here we’ll save the pointwise solution as <code>log_mu_l</code>.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="ulysses-compass.html#cb852-1" aria-hidden="true" tabindex="-1"></a>log_mu_l <span class="ot">&lt;-</span></span>
<span id="cb852-2"><a href="ulysses-compass.html#cb852-2" aria-hidden="true" tabindex="-1"></a>  ll <span class="sc">%&gt;%</span> </span>
<span id="cb852-3"><a href="ulysses-compass.html#cb852-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb852-4"><a href="ulysses-compass.html#cb852-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb852-5"><a href="ulysses-compass.html#cb852-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;loglikelihood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb852-6"><a href="ulysses-compass.html#cb852-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">exp</span>(loglikelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb852-7"><a href="ulysses-compass.html#cb852-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb852-8"><a href="ulysses-compass.html#cb852-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_mean_likelihood =</span> <span class="fu">mean</span>(likelihood) <span class="sc">%&gt;%</span> <span class="fu">log</span>())</span>
<span id="cb852-9"><a href="ulysses-compass.html#cb852-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb852-10"><a href="ulysses-compass.html#cb852-10" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb852-11"><a href="ulysses-compass.html#cb852-11" aria-hidden="true" tabindex="-1"></a>  lppd <span class="ot">&lt;-</span></span>
<span id="cb852-12"><a href="ulysses-compass.html#cb852-12" aria-hidden="true" tabindex="-1"></a>  log_mu_l <span class="sc">%&gt;%</span> </span>
<span id="cb852-13"><a href="ulysses-compass.html#cb852-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lppd =</span> <span class="fu">sum</span>(log_mean_likelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb852-14"><a href="ulysses-compass.html#cb852-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lppd) </span>
<span id="cb852-15"><a href="ulysses-compass.html#cb852-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] -206.6608</code></pre>
<p>It’s a little easier to compute the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. First, let’s use a shorthand notation and define <span class="math inline">\(V(y_i)\)</span> as the variance in log-likelihood for the <span class="math inline">\(i^\text{th}\)</span> case across all <span class="math inline">\(S\)</span> samples. We define <span class="math inline">\(p_\text{WAIC}\)</span> as their sum</p>
<p><span class="math display">\[p_\text{WAIC} = \sum_{i=1}^N V (y_i).\]</span></p>
<p>We’ll save the pointwise results [i.e., <span class="math inline">\(V (y_i)\)</span>] as <code>v_i</code> and their sum [i.e., <span class="math inline">\(\sum_{i=1}^N V (y_i)\)</span>] as <code>pwaic</code>.</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="ulysses-compass.html#cb854-1" aria-hidden="true" tabindex="-1"></a>v_i <span class="ot">&lt;-</span></span>
<span id="cb854-2"><a href="ulysses-compass.html#cb854-2" aria-hidden="true" tabindex="-1"></a>  ll <span class="sc">%&gt;%</span> </span>
<span id="cb854-3"><a href="ulysses-compass.html#cb854-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb854-4"><a href="ulysses-compass.html#cb854-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb854-5"><a href="ulysses-compass.html#cb854-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;loglikelihood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb854-6"><a href="ulysses-compass.html#cb854-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb854-7"><a href="ulysses-compass.html#cb854-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var_loglikelihood =</span> <span class="fu">var</span>(loglikelihood))</span>
<span id="cb854-8"><a href="ulysses-compass.html#cb854-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-9"><a href="ulysses-compass.html#cb854-9" aria-hidden="true" tabindex="-1"></a>pwaic <span class="ot">&lt;-</span></span>
<span id="cb854-10"><a href="ulysses-compass.html#cb854-10" aria-hidden="true" tabindex="-1"></a>  v_i <span class="sc">%&gt;%</span></span>
<span id="cb854-11"><a href="ulysses-compass.html#cb854-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pwaic =</span> <span class="fu">sum</span>(var_loglikelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb854-12"><a href="ulysses-compass.html#cb854-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb854-13"><a href="ulysses-compass.html#cb854-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-14"><a href="ulysses-compass.html#cb854-14" aria-hidden="true" tabindex="-1"></a>pwaic</span></code></pre></div>
<pre><code>## [1] 3.955523</code></pre>
<p>Now we can finally plug our hand-made <code>lppd</code> and <code>pwaic</code> values into the formula <span class="math inline">\(-2 (\text{lppd} - p_\text{WAIC})\)</span> to compute the WAIC. Compare it to the value returned by the <strong>brms</strong> <code>waic()</code> function.</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="ulysses-compass.html#cb856-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (lppd <span class="sc">-</span> pwaic)</span></code></pre></div>
<pre><code>## [1] 421.2326</code></pre>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="ulysses-compass.html#cb858-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b7.m)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -210.6  8.2
## p_waic         4.0  1.5
## waic         421.2 16.4
## 
## 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>Before we move on, did you notice the <code>elpd_waic</code> row in the tibble returned by the<code>waic()</code> function? That value is the <code>lppd</code> minus the <code>pwaic</code>, but without multiplying the result by -2. E.g.,</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="ulysses-compass.html#cb860-1" aria-hidden="true" tabindex="-1"></a>(lppd <span class="sc">-</span> pwaic)</span></code></pre></div>
<pre><code>## [1] -210.6163</code></pre>
<p>Finally, here’s how we compute the WAIC standard error.</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="ulysses-compass.html#cb862-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">lppd   =</span> <span class="fu">pull</span>(log_mu_l, log_mean_likelihood),</span>
<span id="cb862-2"><a href="ulysses-compass.html#cb862-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic =</span> <span class="fu">pull</span>(v_i, var_loglikelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb862-3"><a href="ulysses-compass.html#cb862-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">waic_vec =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (lppd <span class="sc">-</span> p_waic)) <span class="sc">%&gt;%</span> </span>
<span id="cb862-4"><a href="ulysses-compass.html#cb862-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">waic_se =</span> <span class="fu">sqrt</span>(n_cases <span class="sc">*</span> <span class="fu">var</span>(waic_vec)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   waic_se
##     &lt;dbl&gt;
## 1    16.4</code></pre>
<p>If you’d like the pointwise values from <code>brms::waic()</code>, just index.</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="ulysses-compass.html#cb864-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b7.m)<span class="sc">$</span>pointwise <span class="sc">%&gt;%</span> </span>
<span id="cb864-2"><a href="ulysses-compass.html#cb864-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##      elpd_waic     p_waic     waic
## [1,] -3.645646 0.02166572 7.291291
## [2,] -4.019994 0.09287754 8.039989
## [3,] -3.682224 0.02126731 7.364448
## [4,] -3.993275 0.05848657 7.986549
## [5,] -3.585527 0.01021103 7.171054
## [6,] -3.740294 0.02133788 7.480587</code></pre>
</div>
</div>
<div id="comparing-cv-psis-and-waic." class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Comparing CV, PSIS, and WAIC.<a href="ulysses-compass.html#comparing-cv-psis-and-waic." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we update our <code>make_sim()</code> to accommodate the simulation for Figure 7.9.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="ulysses-compass.html#cb866-1" aria-hidden="true" tabindex="-1"></a>make_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, k, b_sigma) {</span>
<span id="cb866-2"><a href="ulysses-compass.html#cb866-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb866-3"><a href="ulysses-compass.html#cb866-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(<span class="at">n =</span> n_sim, </span>
<span id="cb866-4"><a href="ulysses-compass.html#cb866-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expr =</span> <span class="fu">sim_train_test</span>(</span>
<span id="cb866-5"><a href="ulysses-compass.html#cb866-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">N       =</span> n,</span>
<span id="cb866-6"><a href="ulysses-compass.html#cb866-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">k       =</span> k,</span>
<span id="cb866-7"><a href="ulysses-compass.html#cb866-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b_sigma =</span> b_sigma,</span>
<span id="cb866-8"><a href="ulysses-compass.html#cb866-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">WAIC    =</span> T,</span>
<span id="cb866-9"><a href="ulysses-compass.html#cb866-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">LOOCV   =</span> T, </span>
<span id="cb866-10"><a href="ulysses-compass.html#cb866-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">LOOIC   =</span> T),</span>
<span id="cb866-11"><a href="ulysses-compass.html#cb866-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mc.cores =</span> n_cores)</span>
<span id="cb866-12"><a href="ulysses-compass.html#cb866-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb866-13"><a href="ulysses-compass.html#cb866-13" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> </span>
<span id="cb866-14"><a href="ulysses-compass.html#cb866-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb866-15"><a href="ulysses-compass.html#cb866-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_os =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">2</span>, ])),</span>
<span id="cb866-16"><a href="ulysses-compass.html#cb866-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_w  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">3</span>, ])),</span>
<span id="cb866-17"><a href="ulysses-compass.html#cb866-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_p  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">11</span>, ])),</span>
<span id="cb866-18"><a href="ulysses-compass.html#cb866-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_c  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">19</span>, ])),</span>
<span id="cb866-19"><a href="ulysses-compass.html#cb866-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_w     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">7</span>, ])),</span>
<span id="cb866-20"><a href="ulysses-compass.html#cb866-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_p     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">15</span>, ])),</span>
<span id="cb866-21"><a href="ulysses-compass.html#cb866-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_c     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">20</span>, ]))</span>
<span id="cb866-22"><a href="ulysses-compass.html#cb866-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb866-23"><a href="ulysses-compass.html#cb866-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb866-24"><a href="ulysses-compass.html#cb866-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t)</span>
<span id="cb866-25"><a href="ulysses-compass.html#cb866-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb866-26"><a href="ulysses-compass.html#cb866-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Computing all three WAIC, PSIS-LOO-CV, and actual LOO-CV for many models across multiple combinations of <code>k</code> and <code>b_sigma</code> takes a long time–many hours. If you plan on running this code to replicate the figure on your own, take it for a spin first with <code>n_sim</code> set to something small like <code>10</code> to get a sense of the speed of your machine and the nature of the output. Alternatively, consider running the simulation for one combination of <code>k</code> and <code>b_sigma</code> at a time.</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="ulysses-compass.html#cb867-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb867-2"><a href="ulysses-compass.html#cb867-2" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb867-3"><a href="ulysses-compass.html#cb867-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-4"><a href="ulysses-compass.html#cb867-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span></span>
<span id="cb867-5"><a href="ulysses-compass.html#cb867-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">n       =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb867-6"><a href="ulysses-compass.html#cb867-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">k       =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb867-7"><a href="ulysses-compass.html#cb867-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb867-8"><a href="ulysses-compass.html#cb867-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(n, k, b_sigma), make_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb867-9"><a href="ulysses-compass.html#cb867-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sim)</span></code></pre></div>
<p>Now we have our results saved as <code>s</code>, we’re ready to make our version of Figure 7.9. I’m going to deviate from McElreath’s version a bit and express the two average deviance plots on the left column into two columns. To my eyes, the reduced clutter makes it easier to track what I’m looking at.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="ulysses-compass.html#cb868-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> </span>
<span id="cb868-2"><a href="ulysses-compass.html#cb868-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(deviance_w<span class="sc">:</span>deviance_c) <span class="sc">%&gt;%</span> </span>
<span id="cb868-3"><a href="ulysses-compass.html#cb868-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">criteria =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;deviance_w&quot;</span>, <span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb868-4"><a href="ulysses-compass.html#cb868-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;deviance_p&quot;</span>, <span class="st">&quot;PSIS&quot;</span>, <span class="st">&quot;CV&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb868-5"><a href="ulysses-compass.html#cb868-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n       =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;N = &quot;</span>, n), </span>
<span id="cb868-6"><a href="ulysses-compass.html#cb868-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">&quot;N = &quot;</span>, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb868-7"><a href="ulysses-compass.html#cb868-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_sigma =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, b_sigma),</span>
<span id="cb868-8"><a href="ulysses-compass.html#cb868-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> (<span class="fu">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb868-9"><a href="ulysses-compass.html#cb868-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb868-10"><a href="ulysses-compass.html#cb868-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k)) <span class="sc">+</span></span>
<span id="cb868-11"><a href="ulysses-compass.html#cb868-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> deviance_os, <span class="at">shape =</span> b_sigma),</span>
<span id="cb868-12"><a href="ulysses-compass.html#cb868-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb868-13"><a href="ulysses-compass.html#cb868-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> criteria)) <span class="sc">+</span></span>
<span id="cb868-14"><a href="ulysses-compass.html#cb868-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb868-15"><a href="ulysses-compass.html#cb868-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb868-16"><a href="ulysses-compass.html#cb868-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters (k)&quot;</span>,</span>
<span id="cb868-17"><a href="ulysses-compass.html#cb868-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;average deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb868-18"><a href="ulysses-compass.html#cb868-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb868-19"><a href="ulysses-compass.html#cb868-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(n <span class="sc">~</span> b_sigma, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Although our specific values vary, the overall patterns in our simulations are well aligned with those in the text. The CV, PSIS, and WAIC all did a reasonable job approximating out-of-sample deviance. Now we’ll follow the same sensibilities to make our version of the right column of McElreath’s Figure 7.9.</p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="ulysses-compass.html#cb869-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> </span>
<span id="cb869-2"><a href="ulysses-compass.html#cb869-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(error_w<span class="sc">:</span>error_c) <span class="sc">%&gt;%</span> </span>
<span id="cb869-3"><a href="ulysses-compass.html#cb869-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">criteria =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;error_w&quot;</span>, <span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb869-4"><a href="ulysses-compass.html#cb869-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;error_p&quot;</span>, <span class="st">&quot;PSIS&quot;</span>, <span class="st">&quot;CV&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb869-5"><a href="ulysses-compass.html#cb869-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n       =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;N = &quot;</span>, n),</span>
<span id="cb869-6"><a href="ulysses-compass.html#cb869-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">&quot;N = &quot;</span>, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb869-7"><a href="ulysses-compass.html#cb869-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_sigma =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, b_sigma),</span>
<span id="cb869-8"><a href="ulysses-compass.html#cb869-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> (<span class="fu">str_c</span>(<span class="st">&quot;sigma = &quot;</span>, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb869-9"><a href="ulysses-compass.html#cb869-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb869-10"><a href="ulysses-compass.html#cb869-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k)) <span class="sc">+</span></span>
<span id="cb869-11"><a href="ulysses-compass.html#cb869-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> criteria)) <span class="sc">+</span></span>
<span id="cb869-12"><a href="ulysses-compass.html#cb869-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb869-13"><a href="ulysses-compass.html#cb869-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb869-14"><a href="ulysses-compass.html#cb869-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters (k)&quot;</span>,</span>
<span id="cb869-15"><a href="ulysses-compass.html#cb869-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;average error (test deviance)&quot;</span>) <span class="sc">+</span></span>
<span id="cb869-16"><a href="ulysses-compass.html#cb869-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="sc">+</span></span>
<span id="cb869-17"><a href="ulysses-compass.html#cb869-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(n <span class="sc">~</span> b_sigma, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As in the text, the mean error was very similar across the three criteria. When <span class="math inline">\(N = 100\)</span>, they were nearly identical. When <span class="math inline">\(N = 20\)</span>, the WAIC was slightly better than the PSIS, which was slightly better than the CV. As we will see, the PSIS-LOO-CV has the advantage of a built-in diagnostic.</p>
</div>
</div>
<div id="model-comparison" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Model comparison<a href="ulysses-compass.html#model-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the sections to follow, we’ll practice the model comparison approach, as opposed to the widely-used model selection approach.</p>
<div id="model-mis-selection." class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Model mis-selection.<a href="ulysses-compass.html#model-mis-selection." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>We must keep in mind the lessons of the previous chapters: Inferring cause and making predictions are different tasks. Cross-validation and WAIC aim to find models that make good predictions. They don’t solve any causal inference problem. If you select a model based only on expected predictive accuracy, you could easily be confounded. The reason is that backdoor paths do give us valid information about statistical associations in the data. So they can improve prediction, as long as we don’t intervene in the system and the future is like the past. But recall that our working definition of knowing a cause is that we can predict the consequences of an intervention. So a good PSIS or WAIC score does not in general indicate a good causal model. (p. 226)</p>
</blockquote>
<p>If you have been following along and fitting the model on your own and saving them as external <code>.rds</code> files the way I have, you can use the <code>readRDS()</code> to retrieve them.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="ulysses-compass.html#cb870-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;fits/b06.06.rds&quot;</span>)</span>
<span id="cb870-2"><a href="ulysses-compass.html#cb870-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;fits/b06.07.rds&quot;</span>)</span>
<span id="cb870-3"><a href="ulysses-compass.html#cb870-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;fits/b06.08.rds&quot;</span>)</span></code></pre></div>
<p>With our <strong>brms</strong> paradigm, we also use the <code>waic()</code> function. Both the <strong>rethinking</strong> and <strong>brms</strong> packages get their functionality for the <code>waic()</code> and related functions from the <a href="https://CRAN.R-project.org/package=loo"><strong>loo</strong> package</a> <span class="citation">(<a href="#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">Vehtari et al., 2017</a>; <a href="#ref-R-loo" role="doc-biblioref">Vehtari et al., 2022</a>; <a href="#ref-yaoUsingStackingAverage2018" role="doc-biblioref">Yao et al., 2018</a>)</span>. Since the <code>brms::brm()</code> function fits the models with HMC, we don’t need to set a seed before calling <code>waic()</code> the way McElreath did with his <code>rethinking::quap()</code> model. We’re already drawing from the posterior.</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="ulysses-compass.html#cb871-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b6<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 100 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -180.5  6.7
## p_waic         3.3  0.5
## waic         361.1 13.4</code></pre>
<p>The WAIC estimate and its standard error are on the bottom row. The <span class="math inline">\(p_\text{WAIC}\)</span>–what McElreath’s output called the <code>penalty</code>–and its SE are stacked atop that. And look there on the top row. Remember how we pointed out, above, that we get the WAIC by multiplying <code>(lppd - pwaic)</code> by -2? Well, if you just do the subtraction without multiplying the result by -2, you get the <code>elpd_waic</code>. File that away. It’ll become important in a bit. In McElreath’s output, that was called the <code>lppd</code>.</p>
<p>Following the version 2.8.0 update, part of the suggested workflow for using information criteria with <strong>brms</strong> (i.e., execute <code>?loo.brmsfit</code>) is to add the estimates to the <code>brm()</code> fit object itself. You do that with the <code>add_criterion()</code> function. Here’s how we’d do so with <code>b6.7</code>.</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="ulysses-compass.html#cb873-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span></code></pre></div>
<p>With that in place, here’s how you’d extract the WAIC information from the fit object.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="ulysses-compass.html#cb874-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 100 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -180.5  6.7
## p_waic         3.3  0.5
## waic         361.1 13.4</code></pre>
<p><em>Why would I go through all that trouble?</em>, you might ask. Well, two reasons. First, now your WAIC information is saved with all the rest of your fit output, which can be convenient. But second, it sets you up to use the <code>loo_compare()</code> function to compare models by their information criteria. To get a sense of that workflow, here we use <code>add_criterion()</code> for the next three models. Then we’ll use <code>loo_compare()</code>.</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="ulysses-compass.html#cb876-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute and save the WAIC information for the next three models</span></span>
<span id="cb876-2"><a href="ulysses-compass.html#cb876-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb876-3"><a href="ulysses-compass.html#cb876-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb876-4"><a href="ulysses-compass.html#cb876-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-5"><a href="ulysses-compass.html#cb876-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the WAIC estimates</span></span>
<span id="cb876-6"><a href="ulysses-compass.html#cb876-6" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb876-7"><a href="ulysses-compass.html#cb876-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-8"><a href="ulysses-compass.html#cb876-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff
## b6.7   0.0       0.0  
## b6.8 -20.7       4.9  
## b6.6 -22.4       5.8</code></pre>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="ulysses-compass.html#cb878-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w, <span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b6.7    0.0       0.0  -180.5       6.7          3.3    0.5     361.1   13.4 
## b6.8  -20.7       4.9  -201.3       5.4          2.4    0.3     402.5   10.7 
## b6.6  -22.4       5.8  -203.0       5.7          1.6    0.2     406.0   11.4</code></pre>
<p>You don’t have to save those results as an object like we just did with <code>w</code>. But that’ll serve some pedagogical purposes in just a bit. With respect to the output, notice the <code>elpd_diff</code> column and the adjacent <code>se_diff</code> column. Those are our WAIC differences in the elpd metric. The models have been rank ordered from the highest (i.e., <code>b6.7</code>) to the highest (i.e., <code>b6.6</code>). The scores listed are the differences of <code>b6.7</code> minus the comparison model. Since <code>b6.7</code> is the comparison model in the top row, the values are naturally 0 (i.e., <span class="math inline">\(x - x = 0\)</span>). But now here’s another critical thing to understand: Since the <strong>brms</strong> version 2.8.0 update, WAIC and LOO differences are no longer reported in the <span class="math inline">\(-2 \times x\)</span> metric. Remember how multiplying <code>(lppd - pwaic)</code> by -2 is a historic artifact associated with the frequentist <span class="math inline">\(\chi^2\)</span> test? We’ll, the makers of the <strong>loo</strong> package aren’t fans and they no longer support the conversion.</p>
<p>So here’s the deal. The substantive interpretations of the differences presented in an <code>elpd_diff</code> metric will be the same as if presented in a WAIC metric. But if we want to compare our <code>elpd_diff</code> results to those in the text, we will have to multiply them by -2. And also, if we want the associated standard error in the same metric, we’ll need to multiply the <code>se_diff</code> column by 2. You wouldn’t multiply by -2 because that would return a negative standard error, which would be silly. Here’s a quick way to do those conversions.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="ulysses-compass.html#cb880-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">waic_diff =</span> w[, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb880-2"><a href="ulysses-compass.html#cb880-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">se        =</span> w[, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      waic_diff        se
## b6.7   0.00000  0.000000
## b6.8  41.44454  9.783058
## b6.6  44.89563 11.547147</code></pre>
<p>Now those match up reasonably well with the values in McElreath’s <code>dWAIC</code> and <code>dSE</code> columns.</p>
<p>One more thing. On page 227, and on many other pages to follow in the text, McElreath used the <code>rethinking::compare()</code> function to return a rich table of information about the WAIC information for several models. If we’re tricky, we can do something similar with <code>loo_compare</code>. To learn how, let’s peer further into the structure of our <code>w</code> object.</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="ulysses-compass.html#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(w)</span></code></pre></div>
<pre><code>##  &#39;compare.loo&#39; num [1:3, 1:8] 0 -20.72 -22.45 0 4.89 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:3] &quot;b6.7&quot; &quot;b6.8&quot; &quot;b6.6&quot;
##   ..$ : chr [1:8] &quot;elpd_diff&quot; &quot;se_diff&quot; &quot;elpd_waic&quot; &quot;se_elpd_waic&quot; ...</code></pre>
<p>When we used <code>print(w)</code>, a few code blocks earlier, it only returned two columns. It appears we actually have eight. We can see the full output with the <code>simplify = F</code> argument.</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="ulysses-compass.html#cb884-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w, <span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b6.7    0.0       0.0  -180.5       6.7          3.3    0.5     361.1   13.4 
## b6.8  -20.7       4.9  -201.3       5.4          2.4    0.3     402.5   10.7 
## b6.6  -22.4       5.8  -203.0       5.7          1.6    0.2     406.0   11.4</code></pre>
<p>The results are quite analogous to those from <code>rethinking::compare()</code>. Again, the difference estimates are in the metric of the <span class="math inline">\(\text{elpd}\)</span>. But the interpretation is the same and we can convert them to the traditional information criteria metric with simple multiplication. As we’ll see later, this basic workflow also applies to the PSIS-LOO.</p>
<p>Okay, we’ve deviated a bit from the text. Let’s reign things back in and note that right after McElreath’s <strong>R</strong> code 7.26, he wrote: “PSIS will give you almost identical values. You can add <code>func=PSIS</code> to the <code>compare</code> call to check” (p. 227). Our <code>brms::loo_compare()</code> function has a similar argument, but it’s called <code>criterion</code>. We set it to <code>criterion = "waic"</code> to compare the models by the WAIC. What McElreath is calling <code>func=PSIS</code>, we’d call <code>criterion = "loo"</code>. Either way, we’re asking the software the compare the models using leave-one-out cross-validation with Pareto-smoothed importance sampling.</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="ulysses-compass.html#cb886-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb886-2"><a href="ulysses-compass.html#cb886-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb886-3"><a href="ulysses-compass.html#cb886-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb886-4"><a href="ulysses-compass.html#cb886-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-5"><a href="ulysses-compass.html#cb886-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the WAIC estimates</span></span>
<span id="cb886-6"><a href="ulysses-compass.html#cb886-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb886-7"><a href="ulysses-compass.html#cb886-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
## b6.7    0.0       0.0  -180.6      6.7         3.3    0.5    361.1   13.4  
## b6.8  -20.7       4.9  -201.3      5.4         2.5    0.3    402.5   10.7  
## b6.6  -22.4       5.8  -203.0      5.7         1.6    0.2    406.0   11.4</code></pre>
<p>Yep, the LOO values are very similar to those from the WAIC. Anyway, at the bottom of page 227, McElreath showed how to compute the standard error of the WAIC difference for models <code>m6.7</code> and <code>m6.8</code>. Here’s the procedure for us.</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="ulysses-compass.html#cb888-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>])</span>
<span id="cb888-2"><a href="ulysses-compass.html#cb888-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-3"><a href="ulysses-compass.html#cb888-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">waic_b6.7 =</span> b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>],</span>
<span id="cb888-4"><a href="ulysses-compass.html#cb888-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">waic_b6.8 =</span> b6<span class="fl">.8</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb888-5"><a href="ulysses-compass.html#cb888-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> waic_b6<span class="fl">.7</span> <span class="sc">-</span> waic_b6<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb888-6"><a href="ulysses-compass.html#cb888-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_se =</span> <span class="fu">sqrt</span>(n <span class="sc">*</span> <span class="fu">var</span>(diff)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   diff_se
##     &lt;dbl&gt;
## 1    9.78</code></pre>
<p>Since we used different estimation methods (HMC versus the quadratic approximation) via different software (<code>brms::brm()</code> versus <code>rethinking::quap()</code>), we shouldn’t be surprised our values are a little different from those in the text. But we’re in the ballpark, for sure. For us, this value was in the second row of the second column in our <code>w</code> object. But remember we have to multiply that value by 2 to convert it from the <span class="math inline">\(\text{elpd}\)</span> metric to that of the WAIC.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="ulysses-compass.html#cb890-1" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 9.783058</code></pre>
<p>Presuming the difference is Gaussian distributed, here’s our 99% interval.</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="ulysses-compass.html#cb892-1" aria-hidden="true" tabindex="-1"></a>(w[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> (w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fl">2.6</span></span></code></pre></div>
<pre><code>## [1] 16.00858 66.88049</code></pre>
<p>With our <strong>brms</strong> paradigm, we won’t get a comparison plot by inserting <code>loo_compare(b6.6, b6.7, b6.8, criterion = "waic")</code> within <code>plot()</code>. But with a little <code>[]</code> subsetting and light wrangling, we can convert the contents of our <code>w</code> object to a format suitable for plotting the WAIC estimates with <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="ulysses-compass.html#cb894-1" aria-hidden="true" tabindex="-1"></a>w[, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb894-2"><a href="ulysses-compass.html#cb894-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb894-3"><a href="ulysses-compass.html#cb894-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;model_name&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb894-4"><a href="ulysses-compass.html#cb894-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_name =</span> <span class="fu">fct_reorder</span>(model_name, waic, <span class="at">.desc =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb894-5"><a href="ulysses-compass.html#cb894-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb894-6"><a href="ulysses-compass.html#cb894-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> waic, <span class="at">y =</span> model_name, </span>
<span id="cb894-7"><a href="ulysses-compass.html#cb894-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> waic <span class="sc">-</span> se_waic, </span>
<span id="cb894-8"><a href="ulysses-compass.html#cb894-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> waic <span class="sc">+</span> se_waic)) <span class="sc">+</span></span>
<span id="cb894-9"><a href="ulysses-compass.html#cb894-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>], </span>
<span id="cb894-10"><a href="ulysses-compass.html#cb894-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb894-11"><a href="ulysses-compass.html#cb894-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom WAIC plot&quot;</span>,</span>
<span id="cb894-12"><a href="ulysses-compass.html#cb894-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb894-13"><a href="ulysses-compass.html#cb894-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-78-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>We don’t get the deviance points with this method, but that’s okay. Our primary focus is on the WAIC and its standard errors. Here’s how to hand-compute the standard error for the difference between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="ulysses-compass.html#cb895-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">waic_b6.6 =</span> <span class="fu">waic</span>(b6<span class="fl">.6</span>)<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>],</span>
<span id="cb895-2"><a href="ulysses-compass.html#cb895-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">waic_b6.8 =</span> <span class="fu">waic</span>(b6<span class="fl">.8</span>)<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb895-3"><a href="ulysses-compass.html#cb895-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> waic_b6<span class="fl">.6</span> <span class="sc">-</span> waic_b6<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb895-4"><a href="ulysses-compass.html#cb895-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_se =</span> <span class="fu">sqrt</span>(n <span class="sc">*</span> <span class="fu">var</span>(diff)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   diff_se
##     &lt;dbl&gt;
## 1    4.74</code></pre>
<p>Unlike <code>rethinking::compare()</code>, the <code>loo_compare()</code> function will not allow us to so easily pull this value by indexing with <code>@dSE</code>.</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="ulysses-compass.html#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb897-2"><a href="ulysses-compass.html#cb897-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>##  &#39;compare.loo&#39; num [1:3, 1:8] 0 -20.72 -22.45 0 4.89 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:3] &quot;b6.7&quot; &quot;b6.8&quot; &quot;b6.6&quot;
##   ..$ : chr [1:8] &quot;elpd_diff&quot; &quot;se_diff&quot; &quot;elpd_waic&quot; &quot;se_elpd_waic&quot; ...</code></pre>
<p>However, if you really want that value, make a simple WAIC comparison between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="ulysses-compass.html#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff
## b6.8  0.0       0.0   
## b6.6 -1.7       2.4</code></pre>
<p>The value we’re looking for is in the second row of the <code>se_diff</code> column. But remember this is in the <span class="math inline">\(\text{elpd}\)</span> metric. Here’s the conversion.</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="ulysses-compass.html#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 4.735238</code></pre>
<p>Unlike <code>rethinking::compare()</code>, our <code>brms::loo_compare()</code> (even when we <code>print(simplify = T)</code>) does not contain a <code>weight</code> column. Don’t worry; we can still compute them. We’ll just have to do so with a different function. Before we do, here’s the equation they’re based on:</p>
<p><span class="math display">\[w_i = \frac{\exp(-0.5 \Delta_i)}{\sum_j \exp(-0.5 \Delta_j)},\]</span></p>
<p>where <span class="math inline">\(w_i\)</span> is the weight for the <span class="math inline">\(i^\text{th}\)</span> model and <span class="math inline">\(\Delta_i\)</span> is the difference between that model and the WAIC for the best one in the comparison set. If you want to get those WAIC weights, you can use the <code>brms::model_weights()</code> function like so.</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="ulysses-compass.html#cb903-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb903-2"><a href="ulysses-compass.html#cb903-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## b6.6 b6.7 b6.8 
##    0    1    0</code></pre>
<p>In his endnote #130, McElreath discussed how these WAIC weights can be used for model averaging. From the endnote, we read:</p>
<blockquote>
<p>The first edition had a section on model averaging, but the topic has been dropped in this edition to save space. The approach is really focused on prediction, not inference, and so it doesn’t fit the flow of the second edition. But it is an important approach. (p. 565)</p>
</blockquote>
<p>A variety of approaches to model averaging are available with <strong>brms</strong> and I covered them in my <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2023" role="doc-biblioref">2023b</a>)</span> ebook translation of the first edition of McElreath’s text.</p>
<div id="rethinking-waic-metaphors." class="section level4 hasAnchor" number="7.5.1.1">
<h4><span class="header-section-number">7.5.1.1</span> Rethinking: WAIC metaphors.<a href="ulysses-compass.html#rethinking-waic-metaphors." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Think of models as race horses. In any particular race, the best horse may not win. But it’s more likely to win than is the worst horse. And when the winning horse finishes in half the time of the second-place horse, you can be pretty sure the winning horse is also the best. But if instead it’s a photo-finish, with a near tie between first and second place, then it is much harder to be confident about which is the best horse. (p. 230)</p>
</blockquote>
</div>
</div>
<div id="outliers-and-other-illusions." class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Outliers and other illusions.<a href="ulysses-compass.html#outliers-and-other-illusions." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Time to bring back the <code>WaffleDivorce</code> data.</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="ulysses-compass.html#cb905-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb905-2"><a href="ulysses-compass.html#cb905-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-3"><a href="ulysses-compass.html#cb905-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb905-4"><a href="ulysses-compass.html#cb905-4" aria-hidden="true" tabindex="-1"></a>  WaffleDivorce <span class="sc">%&gt;%</span> </span>
<span id="cb905-5"><a href="ulysses-compass.html#cb905-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(Divorce),</span>
<span id="cb905-6"><a href="ulysses-compass.html#cb905-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">m =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(Marriage),</span>
<span id="cb905-7"><a href="ulysses-compass.html#cb905-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(MedianAgeMarriage))</span>
<span id="cb905-8"><a href="ulysses-compass.html#cb905-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb905-9"><a href="ulysses-compass.html#cb905-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(WaffleDivorce)</span></code></pre></div>
<p>Refit the divorce models from <a href="the-many-variables-the-spurious-waffles.html#spurious-associations">Section 5.1</a>.</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="ulysses-compass.html#cb906-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb906-2"><a href="ulysses-compass.html#cb906-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb906-3"><a href="ulysses-compass.html#cb906-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb906-4"><a href="ulysses-compass.html#cb906-4" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> a,</span>
<span id="cb906-5"><a href="ulysses-compass.html#cb906-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb906-6"><a href="ulysses-compass.html#cb906-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb906-7"><a href="ulysses-compass.html#cb906-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb906-8"><a href="ulysses-compass.html#cb906-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb906-9"><a href="ulysses-compass.html#cb906-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb906-10"><a href="ulysses-compass.html#cb906-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb906-11"><a href="ulysses-compass.html#cb906-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b05.01&quot;</span>)</span>
<span id="cb906-12"><a href="ulysses-compass.html#cb906-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-13"><a href="ulysses-compass.html#cb906-13" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb906-14"><a href="ulysses-compass.html#cb906-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb906-15"><a href="ulysses-compass.html#cb906-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb906-16"><a href="ulysses-compass.html#cb906-16" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m,</span>
<span id="cb906-17"><a href="ulysses-compass.html#cb906-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb906-18"><a href="ulysses-compass.html#cb906-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb906-19"><a href="ulysses-compass.html#cb906-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb906-20"><a href="ulysses-compass.html#cb906-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb906-21"><a href="ulysses-compass.html#cb906-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb906-22"><a href="ulysses-compass.html#cb906-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b05.02&quot;</span>)</span>
<span id="cb906-23"><a href="ulysses-compass.html#cb906-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb906-24"><a href="ulysses-compass.html#cb906-24" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb906-25"><a href="ulysses-compass.html#cb906-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb906-26"><a href="ulysses-compass.html#cb906-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb906-27"><a href="ulysses-compass.html#cb906-27" aria-hidden="true" tabindex="-1"></a>      d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> a,</span>
<span id="cb906-28"><a href="ulysses-compass.html#cb906-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb906-29"><a href="ulysses-compass.html#cb906-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb906-30"><a href="ulysses-compass.html#cb906-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb906-31"><a href="ulysses-compass.html#cb906-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb906-32"><a href="ulysses-compass.html#cb906-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb906-33"><a href="ulysses-compass.html#cb906-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</span></code></pre></div>
<p>Compute and save the LOO estimates for each.</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="ulysses-compass.html#cb907-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.1</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb907-2"><a href="ulysses-compass.html#cb907-2" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb907-3"><a href="ulysses-compass.html#cb907-3" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p>Now compare the models by the PSIS-LOO-CV.</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="ulysses-compass.html#cb908-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.1</span>, b5<span class="fl">.2</span>, b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb908-2"><a href="ulysses-compass.html#cb908-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##      elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b5.1   0.0       0.0   -63.0      6.4         3.7   1.8    125.9  12.8   
## b5.3  -0.9       0.4   -63.8      6.4         4.7   1.9    127.7  12.8   
## b5.2  -6.7       4.6   -69.7      4.9         3.0   0.9    139.4   9.9</code></pre>
<p>Like in the text, our <code>b5.1</code> has the best LOO estimate, but only by a little bit when compared to <code>b5.3</code>. Unlike McElreath reported in the text, we did not get a warning message from <code>loo_compare()</code>. Let’s investigate more carefully with the <code>loo()</code> function.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="ulysses-compass.html#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo    -63.8  6.4
## p_loo         4.7  1.9
## looic       127.7 12.8
## ------
## Monte Carlo SE of elpd_loo is 0.1.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     49    98.0%   730       
##  (0.5, 0.7]   (ok)        1     2.0%   187       
##    (0.7, 1]   (bad)       0     0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>One of the observations was in the <code>(ok)</code> range, but none were in the <code>(bad)</code> or <code>(very bad)</code> ranges. By opening the <strong>loo</strong> package directly, we gain access to the <code>pareto_k_ids()</code> function, which will help us identify which observation crossed out of the <code>(good)</code> range into the <code>(ok)</code>.</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="ulysses-compass.html#cb912-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb912-2"><a href="ulysses-compass.html#cb912-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-3"><a href="ulysses-compass.html#cb912-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb912-4"><a href="ulysses-compass.html#cb912-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p>The number <code>13</code> refers to the corresponding row in the data used to fit the model. We can access that row directly with the <code>dplyr::slice()</code> function.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="ulysses-compass.html#cb914-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb914-2"><a href="ulysses-compass.html#cb914-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb914-3"><a href="ulysses-compass.html#cb914-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Location<span class="sc">:</span>Loc)</span></code></pre></div>
<pre><code>##   Location Loc
## 1    Idaho  ID</code></pre>
<p>Here we subset the 13<sup>th</sup> cell in the <code>loo::pareto_k_values()</code> output to see what that value was.</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb916-1"><a href="ulysses-compass.html#cb916-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b5<span class="fl">.3</span>))[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1] 0.6057963</code></pre>
<p>Alternatively, we could have extracted that value from our <code>b5.3</code> fit object like so.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb918-1"><a href="ulysses-compass.html#cb918-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>## [1] 0.6057963</code></pre>
<p>0.61 is a little high, but not high enough to cause <code>loo()</code> to return a warning message. Once a Pareto <span class="math inline">\(k\)</span> value crosses the 0.7 threshold, though, the <strong>loo</strong> package will bark. Before we make our version of Figure 7.10, we’ll want to compute the WAIC for <code>b5.3</code>. That will give us access to the <span class="math inline">\(p_\text{WAIC}\)</span>.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="ulysses-compass.html#cb920-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="st">&quot;waic&quot;</span>, <span class="at">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</span></code></pre></div>
<p>We’re ready to make our version of Figure 7.10.</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="ulysses-compass.html#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">pareto_k =</span> b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb921-2"><a href="ulysses-compass.html#cb921-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic   =</span> b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb921-3"><a href="ulysses-compass.html#cb921-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc      =</span> <span class="fu">pull</span>(d, Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb921-4"><a href="ulysses-compass.html#cb921-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb921-5"><a href="ulysses-compass.html#cb921-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb921-6"><a href="ulysses-compass.html#cb921-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb921-7"><a href="ulysses-compass.html#cb921-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb921-8"><a href="ulysses-compass.html#cb921-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_waic <span class="sc">&gt;</span> <span class="fl">0.5</span>),</span>
<span id="cb921-9"><a href="ulysses-compass.html#cb921-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.03</span>, <span class="at">label =</span> Loc),</span>
<span id="cb921-10"><a href="ulysses-compass.html#cb921-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb921-11"><a href="ulysses-compass.html#cb921-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb921-12"><a href="ulysses-compass.html#cb921-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb921-13"><a href="ulysses-compass.html#cb921-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian model (b5.3)&quot;</span>) <span class="sc">+</span></span>
<span id="cb921-14"><a href="ulysses-compass.html#cb921-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-93-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>For both the Pareto <span class="math inline">\(k\)</span> and the <span class="math inline">\(p_\text{WAIC}\)</span>, our values are not as extreme as those McElreath reported in the text. I’m not sure if this is a consequence of us using HMC or due to recent algorithmic changes for the Stan/<strong>loo</strong> teams. But at least the overall pattern is the same. Idaho is the most extreme/influential case.</p>
<p>In the text (p. 232), McElreath reported the effective number of parameters for <code>b5.3</code> was nearly 6. We can look at this with the <code>waic()</code> function.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="ulysses-compass.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b5<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 50 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic    -63.7  6.3
## p_waic         4.6  1.8
## waic         127.4 12.6
## 
## 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>Our <span class="math inline">\(p_\text{WAIC}\)</span> was about 4.6, which is still a little high due to Idaho but not quite as high as in the text. There is some concern that Idaho is putting us at risk of overfitting due to the large influence it has on the posterior.</p>
<blockquote>
<p>What can be done about this? There is a tradition of dropping outliers. People sometimes drop outliers even before a model is fit, based only on standard deviations from the mean outcome value. You should never do that–a point can only be unexpected and highly influential in light of a model. After you fit a model, the picture changes. If there are only a few outliers, and you are sure to report results both with and without them, dropping outliers might be okay. But if there are several outliers and we really need to model them, what then?</p>
<p>A basic problem here is that the Gaussian error model is easily surprised. (p. 232)</p>
</blockquote>
<p>This surprise has to do with the thinness of its tails relative to those of the Student’s <span class="math inline">\(t\)</span>-distribution. We can get a sense of this with Figure 7.11.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="ulysses-compass.html#cb924-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">6</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb924-2"><a href="ulysses-compass.html#cb924-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gaussian    =</span> <span class="fu">dnorm</span>(x),</span>
<span id="cb924-3"><a href="ulysses-compass.html#cb924-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Student-t</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dstudent</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb924-4"><a href="ulysses-compass.html#cb924-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>x,</span>
<span id="cb924-5"><a href="ulysses-compass.html#cb924-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;likelihood&quot;</span>,</span>
<span id="cb924-6"><a href="ulysses-compass.html#cb924-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;density&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb924-7"><a href="ulysses-compass.html#cb924-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">minus log density</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="fu">log</span>(density)) <span class="sc">%&gt;%</span> </span>
<span id="cb924-8"><a href="ulysses-compass.html#cb924-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;density&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb924-9"><a href="ulysses-compass.html#cb924-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb924-10"><a href="ulysses-compass.html#cb924-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> likelihood, <span class="at">color =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb924-11"><a href="ulysses-compass.html#cb924-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb924-12"><a href="ulysses-compass.html#cb924-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb924-13"><a href="ulysses-compass.html#cb924-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb924-14"><a href="ulysses-compass.html#cb924-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;value&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb924-15"><a href="ulysses-compass.html#cb924-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb924-16"><a href="ulysses-compass.html#cb924-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-95-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>I’m a little baffled as to why our curves don’t quite match up with those in the text. The Gaussian curves were made using the <code>dnorm()</code> function with the default settings, which are <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span>. The Student-<span class="math inline">\(t\)</span> curves were made with McElreath’s <code>rethinking::dstudent()</code>function with the default settings, which are <span class="math inline">\(\operatorname{Student-t}(2, 0, 1)\)</span>–you get the same results is you use <code>dt(x, df = 2)</code>. Discrepancies aside, the main point in the text still stands. The <span class="math inline">\(t\)</span> distribution, especially as <span class="math inline">\(\nu \rightarrow 1\)</span>, has thicker tails than the Gaussian. As a consequence, it is more robust to extreme values.</p>
<p>The <strong>brms</strong> package will allow us to fit a Student <span class="math inline">\(t\)</span> model. Just set <code>family = student</code>. We are at liberty to estimate <span class="math inline">\(\nu\)</span> along with the other parameters in the model or to set it to a constant. We’ll follow McElreath and fix <code>nu = 2</code>. Note that <strong>brms</strong> syntax requires we do so within a <code>bf()</code> statement.</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="ulysses-compass.html#cb925-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> </span>
<span id="cb925-2"><a href="ulysses-compass.html#cb925-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb925-3"><a href="ulysses-compass.html#cb925-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> student,</span>
<span id="cb925-4"><a href="ulysses-compass.html#cb925-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> a, <span class="at">nu =</span> <span class="dv">2</span>),</span>
<span id="cb925-5"><a href="ulysses-compass.html#cb925-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb925-6"><a href="ulysses-compass.html#cb925-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb925-7"><a href="ulysses-compass.html#cb925-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb925-8"><a href="ulysses-compass.html#cb925-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb925-9"><a href="ulysses-compass.html#cb925-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb925-10"><a href="ulysses-compass.html#cb925-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b05.03t&quot;</span>)</span></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="ulysses-compass.html#cb926-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.3</span>t)</span></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: d ~ 1 + m + a 
##          nu = 2
##    Data: d (Number of observations: 50) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.03      0.10    -0.18     0.21 1.00     3716     2585
## m             0.05      0.20    -0.31     0.46 1.00     3458     2897
## a            -0.70      0.15    -0.99    -0.41 1.00     3490     2749
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.58      0.09     0.42     0.77 1.00     3664     3020
## nu        2.00      0.00     2.00     2.00   NA       NA       NA
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we use the <code>add_criterion()</code> function compute both the LOO-CV and the WAIC and add them to the model fit object.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="ulysses-compass.html#cb928-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span></code></pre></div>
<p>Now we might remake the plot from Figure 7.10, this time based on the <span class="math inline">\(t\)</span> model.</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="ulysses-compass.html#cb929-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">pareto_k =</span> b5<span class="fl">.3</span>t<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb929-2"><a href="ulysses-compass.html#cb929-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic   =</span> b5<span class="fl">.3</span>t<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb929-3"><a href="ulysses-compass.html#cb929-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc      =</span> <span class="fu">pull</span>(d, Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb929-4"><a href="ulysses-compass.html#cb929-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb929-5"><a href="ulysses-compass.html#cb929-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb929-6"><a href="ulysses-compass.html#cb929-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb929-7"><a href="ulysses-compass.html#cb929-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;ME&quot;</span>)),</span>
<span id="cb929-8"><a href="ulysses-compass.html#cb929-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.005</span>, <span class="at">label =</span> Loc),</span>
<span id="cb929-9"><a href="ulysses-compass.html#cb929-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb929-10"><a href="ulysses-compass.html#cb929-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb929-11"><a href="ulysses-compass.html#cb929-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb929-12"><a href="ulysses-compass.html#cb929-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Student-t model (b5.3t)&quot;</span>) <span class="sc">+</span></span>
<span id="cb929-13"><a href="ulysses-compass.html#cb929-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-98-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>The high points in both the Pareto <span class="math inline">\(k\)</span> and <span class="math inline">\(p_\text{WAIC}\)</span> are much smaller and both ID and ME are now closer to the center of the bivariate distribution. We can formally compare the models with the WAIC and the LOO.</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="ulysses-compass.html#cb930-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic  se_waic
## b5.3    0.0       0.0   -63.7       6.3          4.6    1.8     127.4  12.6  
## b5.3t  -2.7       2.9   -66.4       5.8          6.1    1.0     132.8  11.6</code></pre>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="ulysses-compass.html#cb932-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
## b5.3    0.0       0.0   -63.8      6.4         4.7   1.9    127.7  12.8   
## b5.3t  -2.6       3.0   -66.4      5.8         6.1   1.0    132.8  11.6</code></pre>
<p>For both criteria, the standard error for the difference was about the same size as the difference itself. This suggests the models were close and hard to distinguish with respect to their fit to the data. This will not always be the case.</p>
<p>Just for kicks and giggles, let’s compare the parameter summaries for the two models in a coefficient plot.</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="ulysses-compass.html#cb934-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">as_draws_df</span>(b5<span class="fl">.3</span>),</span>
<span id="cb934-2"><a href="ulysses-compass.html#cb934-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_draws_df</span>(b5<span class="fl">.3</span>t)) <span class="sc">%&gt;%</span> </span>
<span id="cb934-3"><a href="ulysses-compass.html#cb934-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Gaussian (b5.3)&quot;</span>, <span class="st">&quot;Student-t (b5.3t)&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb934-4"><a href="ulysses-compass.html#cb934-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb934-5"><a href="ulysses-compass.html#cb934-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb934-6"><a href="ulysses-compass.html#cb934-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_a&quot;</span>, <span class="st">&quot;b_m&quot;</span>, <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb934-7"><a href="ulysses-compass.html#cb934-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta[a]&quot;</span>, <span class="st">&quot;beta[m]&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb934-8"><a href="ulysses-compass.html#cb934-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb934-9"><a href="ulysses-compass.html#cb934-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> fit, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb934-10"><a href="ulysses-compass.html#cb934-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb934-11"><a href="ulysses-compass.html#cb934-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>], <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb934-12"><a href="ulysses-compass.html#cb934-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb934-13"><a href="ulysses-compass.html#cb934-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb934-14"><a href="ulysses-compass.html#cb934-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb934-15"><a href="ulysses-compass.html#cb934-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb934-16"><a href="ulysses-compass.html#cb934-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb934-17"><a href="ulysses-compass.html#cb934-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb934-18"><a href="ulysses-compass.html#cb934-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-100-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>Overall, the coefficients are very similar between the two models. The most notable difference is in <span class="math inline">\(\sigma\)</span>. This is, in part, because <span class="math inline">\(\sigma\)</span> has a slightly different meaning for Student-<span class="math inline">\(t\)</span> models than it does for the Gaussian. For both, we can refer to <span class="math inline">\(\sigma\)</span> as the <em>scale</em> parameter, with is a measure of spread or variability around the mean. However, the scale is the same thing as the standard deviation only for the Gaussian. Kruschke walked this out nicely:</p>
<blockquote>
<p>It is important to understand that the scale parameter <span class="math inline">\(\sigma\)</span> in the <span class="math inline">\(t\)</span> distribution is not the standard deviation of the distribution. (Recall that the standard deviation is the square root of the variance, which is the expected value of the squared deviation from the mean, as defined back in Equation 4.8, p. 86.) The standard deviation is actually larger than <span class="math inline">\(\sigma\)</span> because of the heavy tails. In fact, when <span class="math inline">\(\nu\)</span> drops below 2 (but is still <span class="math inline">\(\geq 1\)</span>), the standard deviation of the mathematical <span class="math inline">\(t\)</span> distribution goes to infinity. <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015, p. 159</a>)</span></p>
</blockquote>
<p>The variance for <span class="math inline">\(\operatorname{Student-t}(\nu, 0, 1)\)</span> is</p>
<p><span class="math display">\[\frac{\nu}{\nu-2} \text{ for }  \nu &gt;2, \;\;\; \infty \text{ for } 1 &lt; \nu \leq 2,\]</span></p>
<p>and the standard deviation is the square of that. To give a sense of how that formula works, here are the standard deviation values when <span class="math inline">\(\nu\)</span> ranges from 2.1 to 20.</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="ulysses-compass.html#cb935-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the annotation</span></span>
<span id="cb935-2"><a href="ulysses-compass.html#cb935-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb935-3"><a href="ulysses-compass.html#cb935-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">nu    =</span> <span class="fu">c</span>(<span class="fl">1.35</span>, <span class="dv">20</span>),</span>
<span id="cb935-4"><a href="ulysses-compass.html#cb935-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd    =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fl">2.1</span> <span class="sc">/</span> (<span class="fl">2.1</span> <span class="sc">-</span> <span class="dv">2</span>)), <span class="fl">0.875</span>),</span>
<span id="cb935-5"><a href="ulysses-compass.html#cb935-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">0</span>),</span>
<span id="cb935-6"><a href="ulysses-compass.html#cb935-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb935-7"><a href="ulysses-compass.html#cb935-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">&quot;asymptote&quot;</span>)</span>
<span id="cb935-8"><a href="ulysses-compass.html#cb935-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-9"><a href="ulysses-compass.html#cb935-9" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb935-10"><a href="ulysses-compass.html#cb935-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">nu =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">2.1</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb935-11"><a href="ulysses-compass.html#cb935-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var =</span> nu <span class="sc">/</span> (nu <span class="sc">-</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb935-12"><a href="ulysses-compass.html#cb935-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd =</span> <span class="fu">sqrt</span>(var)) <span class="sc">%&gt;%</span> </span>
<span id="cb935-13"><a href="ulysses-compass.html#cb935-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb935-14"><a href="ulysses-compass.html#cb935-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb935-15"><a href="ulysses-compass.html#cb935-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> nu, <span class="at">y =</span> sd)) <span class="sc">+</span></span>
<span id="cb935-16"><a href="ulysses-compass.html#cb935-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb935-17"><a href="ulysses-compass.html#cb935-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb935-18"><a href="ulysses-compass.html#cb935-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb935-19"><a href="ulysses-compass.html#cb935-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">angle =</span> angle, <span class="at">hjust =</span> hjust),</span>
<span id="cb935-20"><a href="ulysses-compass.html#cb935-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb935-21"><a href="ulysses-compass.html#cb935-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb935-22"><a href="ulysses-compass.html#cb935-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(nu), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb935-23"><a href="ulysses-compass.html#cb935-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Student<span class="sc">-</span><span class="fu">t</span>(nu<span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span><span class="dv">1</span>)),</span>
<span id="cb935-24"><a href="ulysses-compass.html#cb935-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(standard<span class="sc">~</span>deviation<span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="er">~</span><span class="fu">sqrt</span>(nu<span class="sc">/</span>(nu<span class="dv">-2</span>))))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-101-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>As <span class="math inline">\(\nu \rightarrow \infty\)</span>, the standard deviation approaches the scale, <span class="math inline">\(\sigma\)</span>. We’ll have more practice with robust Student’s <span class="math inline">\(t\)</span> regression later on. In the mean time, you might check out chapters <a href="https://bookdown.org/content/3686/metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution">16</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression">17</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation.">18</a>, <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-one-nominal-predictor.html#the-two-group-case.">19</a>, and <a href="https://bookdown.org/content/3686/metric-predicted-variable-with-multiple-nominal-predictors.html#heterogeneous-variances-and-robustness-against-outliers-1">20</a> from my <span class="citation">(<a href="#ref-kurzDoingBayesianDataAnalysis2023" role="doc-biblioref">2023a</a>)</span> ebook translation of Kruschke’s text. I’ve also blogged on using the robust Student’s <span class="math inline">\(t\)</span> for <a href="https://solomonkurz.netlify.app/blog/2019-02-02-robust-linear-regression-with-student-s-t-distribution/">regression</a> and <a href="https://solomonkurz.netlify.app/blog/2019-02-10-bayesian-robust-correlations-with-brms-and-why-you-should-love-student-s-t/">correlations</a>. <span class="citation">Gelman et al. (<a href="#ref-gelmanRegressionOtherStories2020" role="doc-biblioref">2020</a>)</span> covered robust Student’s <span class="math inline">\(t\)</span> regression in Section 15.6, too.</p>
<div id="rethinking-the-curse-of-tippecanoe." class="section level4 hasAnchor" number="7.5.2.1">
<h4><span class="header-section-number">7.5.2.1</span> Rethinking: The Curse of Tippecanoe.<a href="ulysses-compass.html#rethinking-the-curse-of-tippecanoe." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>One concern with model comparison is, if we try enough combinations and transformations of predictors, we might eventually find a model that fits any sample very well. But this fit will be badly overfit, unlikely to generalize….</p>
<p>Fiddling with and constructing many predictor variables is a great way to find coincidences, but not necessarily a great way to evaluate hypotheses. However, fitting many possible models isn’t always a dangerous idea, provided some judgment is exercised in weeding down the list of variables at the start. There are two scenarios in which this strategy appears defensible. First, sometimes all one wants to do is explore a set of data, because there are no clear hypotheses to evaluate. This is rightly labeled pejoratively as <strong>data dredging</strong>, when one does not admit to it. But when used together with model averaging, and freely admitted, it can be a way to stimulate future investigation. Second, sometimes we need to convince an audience that we have tried all of the combinations of predictors, because none of the variables seem to help much in prediction. (p. 234, <strong>emphasis</strong> in the original)</p>
</blockquote>
</div>
</div>
</div>
<div id="summary-bonus-r2-talk" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk<a href="ulysses-compass.html#summary-bonus-r2-talk" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At the beginning of the chapter (pp. 193–201), McElreath introduced <span class="math inline">\(R^2\)</span> as a popular way to assess the variance explained in a model. He pooh-poohed it because of its tendency to overfit. It’s also limited in that it doesn’t generalize well outside of the single-level Gaussian framework, which will be a big deal for us starting in <a href="big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model">Chapter 10</a>. However, if you should find yourself in a situation where <span class="math inline">\(R^2\)</span> suits your purposes, the <strong>brms</strong> <code>bayes_R2()</code> function might be of use. Simply feeding a model <code>brm()</code> fit object into <code>bayes_R2()</code> will return the posterior mean, <span class="math inline">\(\textit{SD}\)</span>, and 95% intervals. For example:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="ulysses-compass.html#cb936-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayes_R2</span>(b5<span class="fl">.3</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    Estimate Est.Error  Q2.5 Q97.5
## R2    0.331     0.086 0.145 0.482</code></pre>
<p>With just a little data processing, you can get a tibble table of each of models’ <span class="math inline">\(R^2\)</span> ‘Estimate’.</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="ulysses-compass.html#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>), </span>
<span id="cb938-2"><a href="ulysses-compass.html#cb938-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(b5<span class="fl">.2</span>), </span>
<span id="cb938-3"><a href="ulysses-compass.html#cb938-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(b5<span class="fl">.3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb938-4"><a href="ulysses-compass.html#cb938-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb938-5"><a href="ulysses-compass.html#cb938-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model                   =</span> <span class="fu">c</span>(<span class="st">&quot;b5.1&quot;</span>, <span class="st">&quot;b5.2&quot;</span>, <span class="st">&quot;b5.3&quot;</span>),</span>
<span id="cb938-6"><a href="ulysses-compass.html#cb938-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">r_square_posterior_mean =</span> <span class="fu">round</span>(Estimate, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb938-7"><a href="ulysses-compass.html#cb938-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, r_square_posterior_mean)</span></code></pre></div>
<pre><code>##      model r_square_posterior_mean
## R2    b5.1                   0.327
## R2.1  b5.2                   0.129
## R2.2  b5.3                   0.331</code></pre>
<p>If you want the full distribution of the <span class="math inline">\(R^2\)</span>, you’ll need to add a <code>summary = F</code> argument. Note how this returns a numeric vector.</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="ulysses-compass.html#cb940-1" aria-hidden="true" tabindex="-1"></a>r2_b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="at">summary =</span> F)</span>
<span id="cb940-2"><a href="ulysses-compass.html#cb940-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb940-3"><a href="ulysses-compass.html#cb940-3" aria-hidden="true" tabindex="-1"></a>r2_b5<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb940-4"><a href="ulysses-compass.html#cb940-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>##  num [1:4000, 1] 0.258 0.281 0.217 0.225 0.463 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr &quot;R2&quot;</code></pre>
<p>If you want to use these in <strong>ggplot2</strong>, you’ll need to put them in tibbles or data frames. Here we do so for two of our model fits.</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="ulysses-compass.html#cb942-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span></span>
<span id="cb942-2"><a href="ulysses-compass.html#cb942-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="at">summary =</span> F),</span>
<span id="cb942-3"><a href="ulysses-compass.html#cb942-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bayes_R2</span>(b5<span class="fl">.2</span>, <span class="at">summary =</span> F)) <span class="sc">%&gt;%</span> </span>
<span id="cb942-4"><a href="ulysses-compass.html#cb942-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb942-5"><a href="ulysses-compass.html#cb942-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;b5.&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) </span>
<span id="cb942-6"><a href="ulysses-compass.html#cb942-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb942-7"><a href="ulysses-compass.html#cb942-7" aria-hidden="true" tabindex="-1"></a>r2 <span class="sc">%&gt;%</span> </span>
<span id="cb942-8"><a href="ulysses-compass.html#cb942-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb942-9"><a href="ulysses-compass.html#cb942-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b5<span class="fl">.1</span>),</span>
<span id="cb942-10"><a href="ulysses-compass.html#cb942-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb942-11"><a href="ulysses-compass.html#cb942-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b5<span class="fl">.2</span>),</span>
<span id="cb942-12"><a href="ulysses-compass.html#cb942-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb942-13"><a href="ulysses-compass.html#cb942-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb942-14"><a href="ulysses-compass.html#cb942-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">34</span>), <span class="at">y =</span> <span class="fl">3.5</span>, </span>
<span id="cb942-15"><a href="ulysses-compass.html#cb942-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;b5.2&quot;</span>, <span class="st">&quot;b5.1&quot;</span>), </span>
<span id="cb942-16"><a href="ulysses-compass.html#cb942-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">&quot;white&quot;</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="sc">+</span></span>
<span id="cb942-17"><a href="ulysses-compass.html#cb942-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb942-18"><a href="ulysses-compass.html#cb942-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb942-19"><a href="ulysses-compass.html#cb942-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>distributions))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-105-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>If you do your work in a field where folks use <span class="math inline">\(R^2\)</span> change, you might do that with a simple difference score. Here’s the <span class="math inline">\(\Delta R^2\)</span> plot.</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="ulysses-compass.html#cb943-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="sc">%&gt;%</span></span>
<span id="cb943-2"><a href="ulysses-compass.html#cb943-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> b5<span class="fl">.2</span> <span class="sc">-</span> b5<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb943-3"><a href="ulysses-compass.html#cb943-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb943-4"><a href="ulysses-compass.html#cb943-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb943-5"><a href="ulysses-compass.html#cb943-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb943-6"><a href="ulysses-compass.html#cb943-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">5</span>], </span>
<span id="cb943-7"><a href="ulysses-compass.html#cb943-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">&quot;BurgYl&quot;</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb943-8"><a href="ulysses-compass.html#cb943-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb943-9"><a href="ulysses-compass.html#cb943-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Turns<span class="sc">~</span>out<span class="sc">~</span>b5<span class="fl">.2</span><span class="sc">~</span>had<span class="sc">~</span>a<span class="sc">~</span>lower<span class="sc">~</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>than<span class="sc">~</span>b5<span class="fl">.1</span>),</span>
<span id="cb943-10"><a href="ulysses-compass.html#cb943-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(Delta<span class="sc">*</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-106-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>The <strong>brms</strong> package did not get these <span class="math inline">\(R^2\)</span> values by traditional method used in, say, ordinary least squares estimation. To learn more about how the Bayesian <span class="math inline">\(R^2\)</span> sausage is made, check out the paper by <span class="citation">Gelman et al. (<a href="#ref-gelmanRsquaredBayesianRegression2019" role="doc-biblioref">2019</a>)</span>, <a href="https://doi.org/10.1080/00031305.2018.1549100"><em>R-squared for Bayesian regression models</em></a>.</p>
</div>
<div id="session-info-6" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="ulysses-compass.html#session-info-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="ulysses-compass.html#cb944-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] loo_2.5.1            rethinking_2.21      cmdstanr_0.5.3       rstan_2.21.8        
##  [5] StanHeaders_2.21.0-7 patchwork_1.1.2      tidybayes_3.0.2      brms_2.18.0         
##  [9] Rcpp_1.0.9           ggrepel_0.9.2        rcartocolor_2.0.0    forcats_0.5.1       
## [13] stringr_1.4.1        dplyr_1.0.10         purrr_1.0.1          readr_2.1.2         
## [17] tidyr_1.2.1          tibble_3.1.8         ggplot2_3.4.0        tidyverse_1.3.2     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      RcppEigen_0.3.3.9.3  plyr_1.8.7          
##   [5] igraph_1.3.4         svUnit_1.0.6         sp_1.5-0             splines_4.2.2       
##   [9] crosstalk_1.2.0      TH.data_1.1-1        rstantools_2.2.0     inline_0.3.19       
##  [13] digest_0.6.31        htmltools_0.5.3      fansi_1.0.3          BH_1.78.0-0         
##  [17] magrittr_2.0.3       checkmate_2.1.0      googlesheets4_1.0.1  tzdb_0.3.0          
##  [21] modelr_0.1.8         RcppParallel_5.1.5   matrixStats_0.63.0   xts_0.12.1          
##  [25] sandwich_3.0-2       prettyunits_1.1.1    colorspace_2.0-3     rvest_1.0.2         
##  [29] ggdist_3.2.1         rgdal_1.5-30         haven_2.5.1          xfun_0.35           
##  [33] callr_3.7.3          crayon_1.5.2         jsonlite_1.8.4       lme4_1.1-31         
##  [37] survival_3.4-0       zoo_1.8-10           glue_1.6.2           gtable_0.3.1        
##  [41] gargle_1.2.0         emmeans_1.8.0        distributional_0.3.1 pkgbuild_1.3.1      
##  [45] shape_1.4.6          abind_1.4-5          scales_1.2.1         mvtnorm_1.1-3       
##  [49] DBI_1.1.3            miniUI_0.1.1.1       viridisLite_0.4.1    xtable_1.8-4        
##  [53] stats4_4.2.2         DT_0.24              htmlwidgets_1.5.4    httr_1.4.4          
##  [57] threejs_0.3.3        arrayhelpers_1.1-0   posterior_1.3.1      ellipsis_0.3.2      
##  [61] pkgconfig_2.0.3      farver_2.1.1         sass_0.4.2           dbplyr_2.2.1        
##  [65] utf8_1.2.2           tidyselect_1.2.0     labeling_0.4.2       rlang_1.0.6         
##  [69] reshape2_1.4.4       later_1.3.0          munsell_0.5.0        cellranger_1.1.0    
##  [73] tools_4.2.2          cachem_1.0.6         cli_3.6.0            generics_0.1.3      
##  [77] broom_1.0.2          evaluate_0.18        fastmap_1.1.0        processx_3.8.0      
##  [81] knitr_1.40           fs_1.5.2             nlme_3.1-160         mime_0.12           
##  [85] projpred_2.2.1       xml2_1.3.3           compiler_4.2.2       bayesplot_1.10.0    
##  [89] shinythemes_1.2.0    rstudioapi_0.13      gamm4_0.2-6          reprex_2.0.2        
##  [93] bslib_0.4.0          stringi_1.7.8        highr_0.9            ps_1.7.2            
##  [97] Brobdingnag_1.2-8    lattice_0.20-45      Matrix_1.5-1         nloptr_2.0.3        
## [101] markdown_1.1         shinyjs_2.1.0        tensorA_0.36.2       vctrs_0.5.1         
## [105] pillar_1.8.1         lifecycle_1.0.3      jquerylib_0.1.4      bridgesampling_1.1-2
## [109] estimability_1.4.1   httpuv_1.6.5         R6_2.5.1             bookdown_0.28       
## [113] promises_1.2.0.1     gridExtra_2.3        codetools_0.2-18     boot_1.3-28         
## [117] colourpicker_1.1.1   MASS_7.3-58.1        gtools_3.9.4         assertthat_0.2.1    
## [121] withr_2.5.0          shinystan_2.6.0      multcomp_1.4-20      mgcv_1.8-41         
## [125] hms_1.1.1            grid_4.2.2           minqa_1.2.5          coda_0.19-4         
## [129] rmarkdown_2.16       googledrive_2.0.0    shiny_1.7.2          lubridate_1.8.0     
## [133] base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-akaike1998information" class="csl-entry">
Akaike, H. (1998). Information theory and an extension of the maximum likelihood principle. In <em>Selected papers of <span>Hirotugu Akaike</span></em> (pp. 199–213). <span>Springer</span>. <a href="https://www.springer.com/gp/book/9780387983554">https://www.springer.com/gp/book/9780387983554</a>
</div>
<div id="ref-betancourtBayesSparse2018" class="csl-entry">
Betancourt, M. (2018). <em>Bayes sparse regression</em>. <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html">https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html</a>
</div>
<div id="ref-Bürkner2022Distributional" class="csl-entry">
Bürkner, P.-C. (2022a). <em>Estimating distributional models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html">https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html</a>
</div>
<div id="ref-Bürkner2022Define" class="csl-entry">
Bürkner, P.-C. (2022b). <em>Define custom response distributions with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html">https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html</a>
</div>
<div id="ref-brms2022RM" class="csl-entry">
Bürkner, P.-C. (2022i). <em><span class="nocase">brms</span> reference manual, <span>Version</span> 2.18.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a>
</div>
<div id="ref-carvalho2009handling" class="csl-entry">
Carvalho, C. M., Polson, N. G., &amp; Scott, J. G. (2009). Handling sparsity via the horseshoe. <em>Artificial Intelligence and Statistics</em>, 73–80. <a href="http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf">http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf</a>
</div>
<div id="ref-cover2006elements" class="csl-entry">
Cover, T. M., &amp; Thomas, J. A. (2006). <em>Elements of information theory</em> (2nd Edition). <span>John Wiley &amp; Sons</span>. <a href="https://www.wiley.com/en-us/Elements+of+Information+Theory%2C+2nd+Edition-p-9780471241959">https://www.wiley.com/en-us/Elements+of+Information+Theory%2C+2nd+Edition-p-9780471241959</a>
</div>
<div id="ref-derooijCrossvalidationMethodEvery2020" class="csl-entry">
de Rooij, M., &amp; Weeda, W. (2020). Cross-validation: <span>A</span> method every psychologist should know. <em>Advances in Methods and Practices in Psychological Science</em>, <em>3</em>(2), 248–263. <a href="https://doi.org/10.1177/2515245919898466">https://doi.org/10.1177/2515245919898466</a>
</div>
<div id="ref-gelmanRsquaredBayesianRegression2019" class="csl-entry">
Gelman, A., Goodrich, B., Gabry, J., &amp; Vehtari, A. (2019). R-squared for <span>Bayesian</span> regression models. <em>The American Statistician</em>, <em>73</em>(3), 307–309. <a href="https://doi.org/10.1080/00031305.2018.1549100">https://doi.org/10.1080/00031305.2018.1549100</a>
</div>
<div id="ref-gelmanRegressionOtherStories2020" class="csl-entry">
Gelman, A., Hill, J., &amp; Vehtari, A. (2020). <em>Regression and other stories</em>. <span>Cambridge University Press</span>. <a href="https://doi.org/10.1017/9781139161879">https://doi.org/10.1017/9781139161879</a>
</div>
<div id="ref-hastie2009elements" class="csl-entry">
Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The elements of statistical learning: Data mining, inference, and prediction</em>. <span>Springer Science &amp; Business Media</span>. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-kullbackInformationSufficiency1951" class="csl-entry">
Kullback, S., &amp; Leibler, R. A. (1951). On information and sufficiency. <em>Annals of Mathematical Statistics</em>, <em>22</em>(1), 79–86. <a href="https://doi.org/10.1214/aoms/1177729694">https://doi.org/10.1214/aoms/1177729694</a>
</div>
<div id="ref-kurzDoingBayesianDataAnalysis2023" class="csl-entry">
Kurz, A. S. (2023a). <em>Doing <span>Bayesian</span> data analysis in brms and the tidyverse</em> (Version 1.1.0). <a href="https://bookdown.org/content/3686/">https://bookdown.org/content/3686/</a>
</div>
<div id="ref-kurzStatisticalRethinkingBrms2023" class="csl-entry">
Kurz, A. S. (2023b). <em>Statistical <span>Rethinking</span> with <span class="nocase">brms</span>, <span class="nocase">ggplot2</span>, and the <span class="nocase">tidyverse</span></em> (version 1.3.0). <a href="https://bookdown.org/content/3890/">https://bookdown.org/content/3890/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, R. (2020a). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-R-rcartocolor" class="csl-entry">
Nowosad, J. (2019). <em><span class="nocase">rcartocolor</span>: ’<span>CARTOColors</span>’ palettes</em>. <a href="https://CRAN.R-project.org/package=rcartocolor">https://CRAN.R-project.org/package=rcartocolor</a>
</div>
<div id="ref-shannonMathematicalTheoryCommunication1948" class="csl-entry">
Shannon, C. E. (1948). A mathematical theory of communication. <em>Bell System Technical Journal</em>, <em>27</em>(3), 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>
</div>
<div id="ref-spiegelhalterBayesianMeasuresModel2002" class="csl-entry">
Spiegelhalter, D. J., Best, N. G., Carlin, B. P., &amp; Linde, A. V. D. (2002). Bayesian measures of model complexity and fit. <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <em>64</em>(4), 583–639. <a href="https://doi.org/10.1111/1467-9868.00353">https://doi.org/10.1111/1467-9868.00353</a>
</div>
<div id="ref-R-loo" class="csl-entry">
Vehtari, A., Gabry, J., Magnusson, M., Yao, Y., &amp; Gelman, A. (2022). <em><span class="nocase">loo</span>: <span>Efficient</span> leave-one-out cross-validation and <span>WAIC</span> for bayesian models</em>. <a href="https://CRAN.R-project.org/package=loo/">https://CRAN.R-project.org/package=loo/</a>
</div>
<div id="ref-vehtariPracticalBayesianModel2017" class="csl-entry">
Vehtari, A., Gelman, A., &amp; Gabry, J. (2017). Practical <span>Bayesian</span> model evaluation using leave-one-out cross-validation and <span>WAIC</span>. <em>Statistics and Computing</em>, <em>27</em>(5), 1413–1432. <a href="https://doi.org/10.1007/s11222-016-9696-4">https://doi.org/10.1007/s11222-016-9696-4</a>
</div>
<div id="ref-wassersteinASAStatementPvalues2016" class="csl-entry">
Wasserstein, R. L., &amp; Lazar, N. A. (2016). The <span>ASA</span> statement on p-values: <span>Context</span>, process, and purpose. <em>The American Statistician</em>, <em>70</em>(2), 129–133. <a href="https://doi.org/10.1080/00031305.2016.1154108">https://doi.org/10.1080/00031305.2016.1154108</a>
</div>
<div id="ref-watanabeAsymptoticEquivalenceBayes2010" class="csl-entry">
Watanabe, S. (2010). Asymptotic equivalence of <span>Bayes</span> cross validation and widely applicable information criterion in singular learning theory. <em>Journal of Machine Learning Research</em>, <em>11</em>(116), 3571–3594. <a href="http://jmlr.org/papers/v11/watanabe10a.html">http://jmlr.org/papers/v11/watanabe10a.html</a>
</div>
<div id="ref-wilksLargesampleDistributionLikelihood1938" class="csl-entry">
Wilks, S. S. (1938). The large-sample distribution of the likelihood ratio for testing composite hypotheses. <em>The Annals of Mathematical Statistics</em>, <em>9</em>(1), 60–62. <a href="https://doi.org/10.1214/aoms/1177732360">https://doi.org/10.1214/aoms/1177732360</a>
</div>
<div id="ref-yaoUsingStackingAverage2018" class="csl-entry">
Yao, Y., Vehtari, A., Simpson, D., &amp; Gelman, A. (2018). Using stacking to average <span>Bayesian</span> predictive distributions (with discussion). <em>Bayesian Analysis</em>, <em>13</em>(3), 917–1007. <a href="https://doi.org/10.1214/17-BA1091">https://doi.org/10.1214/17-BA1091</a>
</div>
<div id="ref-yarkoniChoosingPredictionExplanation2017" class="csl-entry">
Yarkoni, T., &amp; Westfall, J. (2017). Choosing prediction over explanation in psychology: <span>Lessons</span> from machine learning. <em>Perspectives on Psychological Science : A Journal of the Association for Psychological Science</em>, <em>12</em>(6), 1100–1122. <a href="https://doi.org/10.1177/1745691617693393">https://doi.org/10.1177/1745691617693393</a>
</div>
<div id="ref-zhangCrossvalidationSelectingModel2015" class="csl-entry">
Zhang, Y., &amp; Yang, Y. (2015). Cross-validation for selecting a model selection procedure. <em>Journal of Econometrics</em>, <em>187</em>(1), 95–112. <a href="https://doi.org/10.1016/j.jeconom.2015.02.006">https://doi.org/10.1016/j.jeconom.2015.02.006</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Okay, I’m not being completely honest, here. The <code>sim_train_test()</code> code in this section worked fine in version 0.2.0 of this ebook and earlier. However, something has changed over the past year or so and it now returns an error. I’ve reported the error on GitHub, and you can get all the deets <a href="https://github.com/rmcelreath/rethinking/issues/361">here</a>. In the meantime, the results I’m displaying in this section are from mid 2020. So it goes…<a href="ulysses-compass.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-haunted-dag-the-causal-terror.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conditional-manatees.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
