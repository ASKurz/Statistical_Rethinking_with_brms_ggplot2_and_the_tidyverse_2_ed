<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Ulysses’ Compass – *Statistical rethinking* 2 with brms and the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08.html" rel="next">
<link href="./06.html" rel="prev">
<link href="./mischa_favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7d082c015fa132ca880f975003d7bf2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="7&nbsp; Ulysses’ Compass – Statistical rethinking 2 with brms and the tidyverse">
<meta property="og:description" content="">
<meta property="og:image" content="https://solomon.quarto.pub/sr2/07_files/figure-html/unnamed-chunk-3-1.png">
<meta property="og:site_name" content="*Statistical rethinking* 2 with brms and the tidyverse">
<meta property="og:image:height" content="432">
<meta property="og:image:width" content="1152">
</head>

<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ulysses’ Compass</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><em>Statistical rethinking</em> 2 with brms and the tidyverse</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Golem of Prague</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Small Worlds and Large Worlds</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling the Imaginary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Geocentric Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Many Variables &amp; The Spurious Waffles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Haunted DAG &amp; The Causal Terror</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ulysses’ Compass</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Manatees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Big Entropy and the Generalized Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">God Spiked the Integers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Monsters and Mixtures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Models With Memory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Missing Data and Other Opportunities</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Generalized Linear Madness</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><del>Horoscopes</del> Insights</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#rethinking-stargazing" id="toc-rethinking-stargazing" class="nav-link active" data-scroll-target="#rethinking-stargazing"><span class="header-section-number">7.0.0.1</span> Rethinking stargazing</a></li>
  <li><a href="#the-problem-with-parameters" id="toc-the-problem-with-parameters" class="nav-link" data-scroll-target="#the-problem-with-parameters"><span class="header-section-number">7.1</span> The problem with parameters</a>
  <ul>
  <li><a href="#sec-More-parameters-almost-always" id="toc-sec-More-parameters-almost-always" class="nav-link" data-scroll-target="#sec-More-parameters-almost-always"><span class="header-section-number">7.1.1</span> More parameters (almost) always improve fit</a>
  <ul>
  <li><a href="#rethinking-model-fitting-as-compression" id="toc-rethinking-model-fitting-as-compression" class="nav-link" data-scroll-target="#rethinking-model-fitting-as-compression"><span class="header-section-number">7.1.1.1</span> Rethinking: Model fitting as compression</a></li>
  </ul></li>
  <li><a href="#too-few-parameters-hurts-too" id="toc-too-few-parameters-hurts-too" class="nav-link" data-scroll-target="#too-few-parameters-hurts-too"><span class="header-section-number">7.1.2</span> Too few parameters hurts, too</a>
  <ul>
  <li><a href="#rethinking-bias-and-variance" id="toc-rethinking-bias-and-variance" class="nav-link" data-scroll-target="#rethinking-bias-and-variance"><span class="header-section-number">7.1.2.1</span> Rethinking: Bias and variance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#entropy-and-accuracy" id="toc-entropy-and-accuracy" class="nav-link" data-scroll-target="#entropy-and-accuracy"><span class="header-section-number">7.2</span> Entropy and accuracy</a>
  <ul>
  <li><a href="#firing-the-weatherperson" id="toc-firing-the-weatherperson" class="nav-link" data-scroll-target="#firing-the-weatherperson"><span class="header-section-number">7.2.1</span> Firing the weatherperson</a>
  <ul>
  <li><a href="#costs-and-benefits" id="toc-costs-and-benefits" class="nav-link" data-scroll-target="#costs-and-benefits"><span class="header-section-number">7.2.1.1</span> Costs and benefits</a></li>
  <li><a href="#measuring-accuracy" id="toc-measuring-accuracy" class="nav-link" data-scroll-target="#measuring-accuracy"><span class="header-section-number">7.2.1.2</span> Measuring accuracy</a></li>
  </ul></li>
  <li><a href="#information-and-uncertainty" id="toc-information-and-uncertainty" class="nav-link" data-scroll-target="#information-and-uncertainty"><span class="header-section-number">7.2.2</span> Information and uncertainty</a></li>
  <li><a href="#from-entropy-to-accuracy" id="toc-from-entropy-to-accuracy" class="nav-link" data-scroll-target="#from-entropy-to-accuracy"><span class="header-section-number">7.2.3</span> From entropy to accuracy</a>
  <ul>
  <li><a href="#rethinking-divergence-depends-upon-direction" id="toc-rethinking-divergence-depends-upon-direction" class="nav-link" data-scroll-target="#rethinking-divergence-depends-upon-direction"><span class="header-section-number">7.2.3.1</span> Rethinking: Divergence depends upon direction</a></li>
  </ul></li>
  <li><a href="#estimating-divergence" id="toc-estimating-divergence" class="nav-link" data-scroll-target="#estimating-divergence"><span class="header-section-number">7.2.4</span> Estimating divergence</a>
  <ul>
  <li><a href="#sec-Computing-the-lppd" id="toc-sec-Computing-the-lppd" class="nav-link" data-scroll-target="#sec-Computing-the-lppd"><span class="header-section-number">7.2.4.1</span> Overthinking: Computing the lppd</a></li>
  </ul></li>
  <li><a href="#sec-Scoring-the-right-data" id="toc-sec-Scoring-the-right-data" class="nav-link" data-scroll-target="#sec-Scoring-the-right-data"><span class="header-section-number">7.2.5</span> Scoring the right data</a>
  <ul>
  <li><a href="#overthinking-simulated-training-and-testing" id="toc-overthinking-simulated-training-and-testing" class="nav-link" data-scroll-target="#overthinking-simulated-training-and-testing"><span class="header-section-number">7.2.5.1</span> Overthinking: Simulated training and testing</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#golem-taming-regularization" id="toc-golem-taming-regularization" class="nav-link" data-scroll-target="#golem-taming-regularization"><span class="header-section-number">7.3</span> Golem taming: regularization</a>
  <ul>
  <li><a href="#rethinking-ridge-regression" id="toc-rethinking-ridge-regression" class="nav-link" data-scroll-target="#rethinking-ridge-regression"><span class="header-section-number">7.3.0.1</span> Rethinking: Ridge regression</a></li>
  </ul></li>
  <li><a href="#predicting-predictive-accuracy" id="toc-predicting-predictive-accuracy" class="nav-link" data-scroll-target="#predicting-predictive-accuracy"><span class="header-section-number">7.4</span> Predicting predictive accuracy</a>
  <ul>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">7.4.1</span> Cross-validation</a></li>
  <li><a href="#information-criteria" id="toc-information-criteria" class="nav-link" data-scroll-target="#information-criteria"><span class="header-section-number">7.4.2</span> Information criteria</a>
  <ul>
  <li><a href="#overthinking-waic-calculations" id="toc-overthinking-waic-calculations" class="nav-link" data-scroll-target="#overthinking-waic-calculations"><span class="header-section-number">7.4.2.1</span> Overthinking: WAIC calculations</a></li>
  </ul></li>
  <li><a href="#comparing-cv-psis-and-waic" id="toc-comparing-cv-psis-and-waic" class="nav-link" data-scroll-target="#comparing-cv-psis-and-waic"><span class="header-section-number">7.4.3</span> Comparing CV, PSIS, and WAIC</a></li>
  </ul></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison"><span class="header-section-number">7.5</span> Model comparison</a>
  <ul>
  <li><a href="#model-mis-selection" id="toc-model-mis-selection" class="nav-link" data-scroll-target="#model-mis-selection"><span class="header-section-number">7.5.1</span> Model mis-selection</a>
  <ul>
  <li><a href="#rethinking-waic-metaphors" id="toc-rethinking-waic-metaphors" class="nav-link" data-scroll-target="#rethinking-waic-metaphors"><span class="header-section-number">7.5.1.1</span> Rethinking: WAIC metaphors</a></li>
  </ul></li>
  <li><a href="#outliers-and-other-illusions" id="toc-outliers-and-other-illusions" class="nav-link" data-scroll-target="#outliers-and-other-illusions"><span class="header-section-number">7.5.2</span> Outliers and other illusions</a>
  <ul>
  <li><a href="#rethinking-the-curse-of-tippecanoe" id="toc-rethinking-the-curse-of-tippecanoe" class="nav-link" data-scroll-target="#rethinking-the-curse-of-tippecanoe"><span class="header-section-number">7.5.2.1</span> Rethinking: The Curse of Tippecanoe</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary-bonus-r2-talk" id="toc-summary-bonus-r2-talk" class="nav-link" data-scroll-target="#summary-bonus-r2-talk"><span class="header-section-number">7.6</span> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments">Comments</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-Ulysses-Compass" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ulysses’ Compass</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter we contend with two contrasting kinds of statistical error:</p>
<ul>
<li>overfitting, “which leads to poor prediction by learning too <em>much</em> from the data”</li>
<li>underfitting, “which leads to poor prediction by learning too <em>little</em> from the data” <span class="citation" data-cites="mcelreathStatisticalRethinkingBayesian2020">(<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020, p. 192</a>, <em>emphasis</em> added)</span></li>
</ul>
<blockquote class="blockquote">
<p>Our job is to carefully navigate among these monsters. There are two common families of approaches. The first approach is to use a <strong>regularizing prior</strong> to tell the model not to get too excited by the data. This is the same device that non-Bayesian methods refer to as “penalized likelihood.” The second approach is to use some scoring device, like <strong>information criteria</strong> or <strong>cross-validation</strong>, to model the prediction task and estimate predictive accuracy. Both families of approaches are routinely used in the natural and social sciences. Furthermore, they can be–maybe should be–used in combination. So it’s worth understanding both, as you’re going to need both at some point. (p.&nbsp;192, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>There’s a lot going on in this chapter. More more practice with these ideas, check out <span class="citation" data-cites="yarkoniChoosingPredictionExplanation2017">Yarkoni &amp; Westfall (<a href="references.html#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6603289/"><em>Choosing prediction over explanation in psychology: Lessons from machine learning</em></a>.</p>
<section id="rethinking-stargazing" class="level4" data-number="7.0.0.1">
<h4 data-number="7.0.0.1" class="anchored" data-anchor-id="rethinking-stargazing"><span class="header-section-number">7.0.0.1</span> Rethinking stargazing</h4>
<blockquote class="blockquote">
<p>The most common form of model selection among practicing scientists is to search for a model in which every coefficient is statistically significant. Statisticians sometimes call this <strong>stargazing</strong>, as it is embodied by scanning for asterisks (<span class="math inline">\(^{\star \star}\)</span>) trailing after estimates….</p>
<p>Whatever you think about null hypothesis significance testing in general, using it to select among structurally different models is a mistake–<span class="math inline">\(p\)</span>-values are not designed to help you navigate between underfitting and overfitting. (p.&nbsp;193, <strong>emphasis</strong> in the original).</p>
</blockquote>
<p>McElreath spent little time discussing <span class="math inline">\(p\)</span>-values and null hypothesis testing in the text. If you’d like to learn more from a Bayesian perspective, you might check out the first several chapters (particularly 10–13) in Kruschke’s <span class="citation" data-cites="kruschkeDoingBayesianData2015">(<a href="references.html#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">text</a> and my <span class="citation" data-cites="kurzDoingBayesianDataAnalysis2026">(<a href="references.html#ref-kurzDoingBayesianDataAnalysis2026" role="doc-biblioref">2026a</a>)</span> <a href="https://solomon.quarto.pub/dbda2/">ebook translating it to <strong>brms</strong> and the tidyverse</a>. The great <a href="https://www.fharrell.com/">Frank Harrell</a> has complied <a href="https://www.fharrell.com/post/pval-litany/"><em>A Litany of Problems With p-values</em></a>. Also, don’t miss the statement on <span class="math inline">\(p\)</span>-values released by the <a href="https://www.amstat.org/">American Statistical Association</a> <span class="citation" data-cites="wassersteinASAStatementPvalues2016">(<a href="references.html#ref-wassersteinASAStatementPvalues2016" role="doc-biblioref">Wasserstein &amp; Lazar, 2016</a>)</span>.</p>
</section>
<section id="the-problem-with-parameters" class="level2 page-columns page-full" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="the-problem-with-parameters"><span class="header-section-number">7.1</span> The problem with parameters</h2>
<p>The <span class="math inline">\(R^2\)</span> is a popular way to measure how well you can retrodict the data. It traditionally follows the form</p>
<p><span class="math display">\[R^2 = \frac{\text{var(outcome)} - \text{var(residuals)}}{\text{var(outcome)}} = 1 - \frac{\text{var(residuals)}}{\text{var(outcome)}}.\]</span></p>
<p>By <span class="math inline">\(\operatorname{var}()\)</span>, of course, we meant variance (i.e., what you get from the <code>var()</code> function in <strong>R</strong>). McElreath is not a fan of the <span class="math inline">\(R^2\)</span>. But it’s important in my field, so instead of a summary at the end of the chapter, we will cover the Bayesian version of <span class="math inline">\(R^2\)</span> and how to use it in <strong>brms</strong>.</p>
<section id="sec-More-parameters-almost-always" class="level3 page-columns page-full" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-More-parameters-almost-always"><span class="header-section-number">7.1.1</span> More parameters (almost) always improve fit</h3>
<p>We’ll start off by making the data with brain size and body size for seven <code>species</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">"afarensis"</span>, <span class="st">"africanus"</span>, <span class="st">"habilis"</span>, <span class="st">"boisei"</span>, <span class="st">"rudolfensis"</span>, <span class="st">"ergaster"</span>, <span class="st">"sapiens"</span>), </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">brain   =</span> <span class="fu">c</span>(<span class="dv">438</span>, <span class="dv">452</span>, <span class="dv">612</span>, <span class="dv">521</span>, <span class="dv">752</span>, <span class="dv">871</span>, <span class="dv">1350</span>), </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mass    =</span> <span class="fu">c</span>(<span class="fl">37.0</span>, <span class="fl">35.5</span>, <span class="fl">34.5</span>, <span class="fl">41.5</span>, <span class="fl">55.5</span>, <span class="fl">61.0</span>, <span class="fl">53.5</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  species     brain  mass
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 afarensis     438  37  
2 africanus     452  35.5
3 habilis       612  34.5
4 boisei        521  41.5
5 rudolfensis   752  55.5
6 ergaster      871  61  
7 sapiens      1350  53.5</code></pre>
</div>
</div>
<p>Let’s get ready for Figure 7.2. The plots in this chapter will be characterized by <code>theme_classic() + theme(text = element_text(family = "Courier"))</code>. Our color palette will come from the <a href="https://CRAN.R-project.org/package=rcartocolor"><strong>rcartocolor</strong> package</a> <span class="citation" data-cites="R-rcartocolor">(<a href="references.html#ref-R-rcartocolor" role="doc-biblioref">Nowosad, 2019</a>)</span>, which provides color schemes <a href="https://carto.com/carto-colors/">designed by ‘CARTO’</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rcartocolor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The specific palette we’ll be using is “BurgYl.” In addition to palettes, the <strong>rcartocolor</strong> package offers a few convenience functions which make it easier to use their palettes. The <code>carto_pal()</code> function will return the HEX numbers associated with a given palette’s colors and the <code>display_carto_pal()</code> function will display the actual colors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#FBE6C5" "#F5BA98" "#EE8A82" "#DC7176" "#C8586C" "#9C3F5D" "#70284A"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display_carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We’ll be using a diluted version of the third color for the panel background (i.e., <code>theme(panel.background = element_rect(fill = alpha(carto_pal(7, "BurgYl")[3], 1/4)))</code>) and the darker purples for other plot elements. Here’s the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Courier"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>  mass, <span class="at">y =</span> brain, <span class="at">label =</span> species)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">family =</span> <span class="st">"Courier"</span>, <span class="at">seed =</span> <span class="dv">438</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (kg)"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"brain volume (cc)"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Average brain volume by body</span><span class="sc">\n</span><span class="st">mass for six hominin species"</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">30</span>, <span class="dv">65</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>Before fitting our models,</p>
<blockquote class="blockquote">
<p>we want to standardize body mass–give it mean zero and standard deviation one–and rescale the outcome, brain volume, so that the largest observed value is 1. Why not standardize brain volume as well? Because we want to preserve zero as a reference point: No brain at all. You can’t have negative brain. I don’t think. (p.&nbsp;195)</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mass_std  =</span> (mass <span class="sc">-</span> <span class="fu">mean</span>(mass)) <span class="sc">/</span> <span class="fu">sd</span>(mass),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain_std =</span> brain <span class="sc">/</span> <span class="fu">max</span>(brain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our first statistical model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{brain\_std}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i              &amp; = \alpha + \beta \text{mass\_std}_i \\
\alpha             &amp; \sim \operatorname{Normal}(0.5, 1) \\
\beta              &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma             &amp; \sim \operatorname{Log-Normal}(0, 1).
\end{align*}\]</span></p>
<blockquote class="blockquote">
<p>This simply says that the average brain volume <span class="math inline">\(b_i\)</span> of species <span class="math inline">\(i\)</span> is a linear function of its body mass <span class="math inline">\(m_i\)</span>. Now consider what the priors imply. The prior for <span class="math inline">\(\alpha\)</span> is just centered on the mean brain volume (rescaled) in the data. So it says that the average species with an average body mass has a brain volume with an 89% credible interval from about −1 to 2. That is ridiculously wide and includes impossible (negative) values. The prior for <span class="math inline">\(\beta\)</span> is very flat and centered on zero. It allows for absurdly large positive and negative relationships. These priors allow for absurd inferences, especially as the model gets more complex. And that’s part of the lesson. (p.&nbsp;196)</p>
</blockquote>
<p>Fire up <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A careful study of McElreath’s <strong>R</strong> code 7.3 will show he is modeling <code>log_sigma</code>, rather than <span class="math inline">\(\sigma\)</span>. There are ways to do this with <strong>brms</strong> <span class="citation" data-cites="Bürkner2022Distributional">(see <a href="references.html#ref-Bürkner2022Distributional" role="doc-biblioref">Bürkner, 2022b</a>)</span>, but I’m going to keep things simple, here. Our approach will be to follow the above equation more literally and just slap the <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span> prior directly onto <span class="math inline">\(\sigma\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the model summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: brain_std ~ 1 + mass_std 
   Data: d (Number of observations: 7) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.53      0.12     0.28     0.75 1.00     2502     1887
mass_std      0.16      0.13    -0.10     0.42 1.00     2190     1615

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.28      0.13     0.14     0.60 1.00     1327     1587

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>As we’ll learn later on, <strong>brms</strong> already has a convenience function for computing the Bayesian <span class="math inline">\(R^2\)</span>. At this point in the chapter, we’ll follow along and make a <strong>brms</strong>-centric version of McElreath’s <code>R2_is_bad()</code>. But because part of our version of <code>R2_is_bad()</code> will contain the <code>brms::predict()</code> function, I’m going to add a <code>seed</code> argument to make the results more reproducible.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;For more context for my ordering in the residuals portion of the code, see <a href="05.html#sec-Bonus-Rethinking-residuals" class="quarto-xref"><span>Section 5.1.5.1.2</span></a>.</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>R2_is_bad <span class="ot">&lt;-</span> <span class="cf">function</span>(brm_fit, <span class="at">seed =</span> <span class="dv">7</span>, ...) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">predict</span>(brm_fit, <span class="at">summary =</span> F, ...)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nowadays it's more typical to define residuals as y minus yhat</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> d<span class="sc">$</span>brain_std <span class="sc">-</span> <span class="fu">apply</span>(p, <span class="dv">2</span>, mean)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(r) <span class="sc">/</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(d<span class="sc">$</span>brain_std)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the estimate for our <span class="math inline">\(R^2\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">R2_is_bad</span>(b7<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.485846</code></pre>
</div>
</div>
<p>Do note that,</p>
<blockquote class="blockquote">
<p>in principle, the Bayesian approach mandates that we do this for each sample from the posterior. But <span class="math inline">\(R^2\)</span> is traditionally computed only at the mean prediction. So we’ll do that as well here. Later in the chapter you’ll learn a properly Bayesian score that uses the entire posterior distribution. (p.&nbsp;197)</p>
</blockquote>
<p>Now fit the quadratic through the fifth-order polynomial models using <code>update()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> d, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.02"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cubic</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> d, </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.03"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth-order</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> d, </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.995</span>, <span class="at">max_treedepth =</span> <span class="dv">11</span>),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.04"</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Fifth-order</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> d, </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99999</span>, <span class="at">max_treedepth =</span> <span class="dv">11</span>),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.05"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may have noticed we fiddled with the <code>adapt_delta</code> setting for some of the models. When you try to fit complex models with few data points and wide priors, that can cause difficulties for Stan. I’m not going to get into the details on what <code>adapt_delta</code> does, right now. But it’ll make appearances in later chapters and we’ll more formally introduce it in <a href="13.html#sec-Non-centered-chimpanzees" class="quarto-xref"><span>Section 13.4.2</span></a>.</p>
<p>Now returning to the text,</p>
<blockquote class="blockquote">
<p>That last model, <code>m7.6</code>, has one trick in it. The standard deviation is replaced with a constant value 0.001. The model will not work otherwise, for a very important reason that will become clear as we plot these monsters. (p.&nbsp;198)</p>
</blockquote>
<p>By “last model, <code>m7.6</code>,” McElreath was referring to the sixth-order polynomial, fit on page 199. McElreath’s <strong>rethinking</strong> package is set up so the syntax is simple to replacing <span class="math inline">\(\sigma\)</span> with a constant value. We can do this with <strong>brms</strong>, too, but it’ll take more effort. If we want to fix <span class="math inline">\(\sigma\)</span> to a constant, we’ll need to define a custom likelihood. Bürkner explained how to do so in his <span class="citation" data-cites="Bürkner2022Define">(<a href="references.html#ref-Bürkner2022Define" role="doc-biblioref">2022c</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define custom response distributions with brms</em></a>. I’m not going to explain this in great detail, here. In brief, first we use the <code>custom_family()</code> function to define the name and parameters of a <code>custom_normal()</code> likelihood that will set <span class="math inline">\(\sigma\)</span> to a constant value, 0.001. Second, we’ll define some functions for Stan which are not defined in Stan itself and save them as <code>stan_funs</code>. Third, we make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>custom_normal <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"custom_normal"</span>, <span class="at">dpars =</span> <span class="st">"mu"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="st">"identity"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"real"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>stan_funs  <span class="ot">&lt;-</span> <span class="st">"real custom_normal_lpdf(real y, real mu) {</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_lpdf(y | mu, 0.001);</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">real custom_normal_rng(real mu) {</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_rng(mu, 0.001);</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">"</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> stan_funs, <span class="at">block =</span> <span class="st">"functions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can fit the model by setting <code>family = custom_normal</code>. Note that since we’ve set <span class="math inline">\(\sigma = 0.001\)</span>, we don’t need to include a prior for <span class="math inline">\(\sigma\)</span>. Also notice our <code>stanvars = stanvars</code> line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> custom_normal,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  brain_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b)),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> stanvars,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.06"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we can do our variant of Figure 7.3, we’ll need to define a few more custom functions to work with <code>b7.6</code>. The <code>posterior_epred_custom_normal()</code> function is required for <code>brms::fitted()</code> to work with our <code>family = custom_normal</code> <code>brmsfit</code> object. Same thing for <code>posterior_predict_custom_normal()</code> and <code>brms::predict()</code>. Though we won’t need it until <a href="#sec-Scoring-the-right-data" class="quarto-xref"><span>Section 7.2.5</span></a>, we’ll also define <code>log_lik_custom_normal</code> so we can use the <code>log_lik()</code> function for any models fit with <code>family = custom_normal</code>. Before all that, we need to throw in a line with the <code>expose_functions()</code> function. If you want to understand why, read up in Bürkner’s <span class="citation" data-cites="Bürkner2022Define">(<a href="references.html#ref-Bürkner2022Define" role="doc-biblioref">2022c</a>)</span> vignette. For now, just go with it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(b7<span class="fl">.6</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>posterior_epred_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>posterior_predict_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_rng</span>(mu)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>log_lik_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_lpdf</span>(y, mu)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, here’s how we might plot the result for the first model, <code>b7.1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b7<span class="fl">.1</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">|&gt;</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lineribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (standardized)"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"brain volume (standardized)"</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">==</span>.(<span class="fu">round</span>(<span class="fu">R2_is_bad</span>(b7<span class="fl">.1</span>), <span class="at">digits =</span> <span class="dv">2</span>))),) <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>To slightly repurpose a quote from McElreath:</p>
<blockquote class="blockquote">
<p>We’ll want to do this for the next several models, so let’s write a function to make it repeatable. If you find yourself writing code more than once, it is usually saner to write a function and call the function more than once instead. (p.&nbsp;197)</p>
</blockquote>
<p>Our <code>make_figure7.3()</code> function will wrap the simulation, data wrangling, and plotting code all in one. It takes two arguments, the first of which defines which fit object we’d like to plot. If you look closely at Figure 7.3 in the text, you’ll notice that the range of the <span class="math inline">\(y\)</span>-axis changes in the last three plots. Our second argument, <code>ylim</code>, will allow us to vary those parameters across subplots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>make_figure7<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std)) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the R2</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="fu">R2_is_bad</span>(brms_fit)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the new data </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">200</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate and wrangle</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(brms_fit, <span class="at">newdata =</span> nd, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd) <span class="sc">|&gt;</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot!  </span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_lineribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">6</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (std)"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"brain volume (std)"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">==</span>.(<span class="fu">round</span>(r2, <span class="at">digits =</span> <span class="dv">2</span>)))) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.5</span>),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> ylim)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we make and save the six subplots in bulk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.2</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.3</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.4</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">1.1</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.5</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">1.4</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">make_figure7.3</span>(b7<span class="fl">.6</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now use <strong>patchwork</strong> syntax to bundle them all together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>((p1 <span class="sc">|</span> p2) <span class="sc">/</span> (p3 <span class="sc">|</span> p4) <span class="sc">/</span> (p5 <span class="sc">|</span> p6)) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Figure7.3. Polynomial linear models of increasing</span><span class="sc">\n</span><span class="st">degree for the hominin data."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It’s not clear, to me, why our <strong>brms</strong>-based 89% intervals are so much broader than those in the text. But if you do fit the size models with <code>rethinking::quap()</code> and compare the summaries, you’ll see our <strong>brms</strong>-based parameters are systemically less certain than those fit with <code>quap()</code>. In you have an answer or perhaps even an alternative workflow to solve the issue, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">share on GitHub</a>.</p>
<p>If you really what the axes scaled in the original metrics of the variables rather than their standardized form, you can use the re-scaling techniques from back in <a href="04.html#sec-Converting-back-to-natural-scale" class="quarto-xref"><span>Section 4.5.1.0.1</span></a>.</p>
<p>“This is a general phenomenon: If you adopt a model family with enough parameters, you can fit the data exactly. But such a model will make rather absurd predictions for yet-to-be-observed cases” (pp.&nbsp;199–201).</p>
<section id="rethinking-model-fitting-as-compression" class="level4" data-number="7.1.1.1">
<h4 data-number="7.1.1.1" class="anchored" data-anchor-id="rethinking-model-fitting-as-compression"><span class="header-section-number">7.1.1.1</span> Rethinking: Model fitting as compression</h4>
<blockquote class="blockquote">
<p>Another perspective on the absurd model just above is to consider that model fitting can be considered a form of <strong>data compression</strong>. Parameters summarize relationships among the data. These summaries compress the data into a simpler form, although with loss of information (“lossy” compression) about the sample. The parameters can then be used to generate new data, effectively decompressing the data. (p.&nbsp;201, <strong>emphasis</strong> in the original)</p>
</blockquote>
</section>
</section>
<section id="too-few-parameters-hurts-too" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="too-few-parameters-hurts-too"><span class="header-section-number">7.1.2</span> Too few parameters hurts, too</h3>
<blockquote class="blockquote">
<p>The overfit polynomial models fit the data extremely well, but they suffer for this within-sample accuracy by making nonsensical out-of-sample predictions. In contrast, <strong>underfitting</strong> produces models that are inaccurate both within and out of sample. They learn too little, failing to recover regular features of the sample. (p.&nbsp;201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>To explore the distinctions between overfitting and underfitting, we’ll need to refit <code>b7.1</code> and <code>b7.4</code> several times after serially dropping one of the rows in the data. You can <code>filter()</code> by <code>row_number()</code> to drop rows in a <a href="https://dplyr.tidyverse.org/reference/slice.html"><strong>tidyverse</strong> kind of way</a>. For example, we can drop the second row of <code>d</code> like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  species     brain  mass mass_std brain_std   row
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1 afarensis     438  37     -0.779     0.324     1
2 habilis       612  34.5   -1.01      0.453     3
3 boisei        521  41.5   -0.367     0.386     4
4 rudolfensis   752  55.5    0.917     0.557     5
5 ergaster      871  61      1.42      0.645     6
6 sapiens      1350  53.5    0.734     1         7</code></pre>
</div>
</div>
<p>In his <strong>Overthinking: Dropping rows</strong> box (p.&nbsp;202), McElreath encouraged us to take a look at the <code>brain_loo_plot()</code> function to get a sense of how he made his Figure 7.4. Here it is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>brain_loo_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (fit, atx = c(35, 47, 60), aty = c(450, 900, 1300), 
    xlim, ylim, npts = 100) 
{
    post &lt;- extract.samples(fit)
    n &lt;- dim(post$b)[2]
    if (is.null(n)) 
        n &lt;- 1
    if (missing(xlim)) 
        xlim &lt;- range(d$mass_std)
    else xlim &lt;- (xlim - mean(d$mass))/sd(d$mass)
    if (missing(ylim)) 
        ylim &lt;- range(d$brain_std)
    else ylim &lt;- ylim/max(d$brain)
    plot(d$brain_std ~ d$mass_std, xaxt = "n", yaxt = "n", xlab = "body mass (kg)", 
        ylab = "brain volume (cc)", col = rangi2, pch = 16, xlim = xlim, 
        ylim = ylim)
    axis_unscale(1, atx, d$mass)
    axis_unscale(2, at = aty, factor = max(d$brain))
    d &lt;- as.data.frame(fit@data)
    for (i in 1:nrow(d)) {
        di &lt;- d[-i, ]
        m_temp &lt;- quap(fit@formula, data = di, start = list(b = rep(0, 
            n)))
        xseq &lt;- seq(from = xlim[1] - 0.2, to = xlim[2] + 0.2, 
            length.out = npts)
        l &lt;- link(m_temp, data = list(mass_std = xseq), refresh = 0)
        mu &lt;- apply(l, 2, mean)
        lines(xseq, mu, lwd = 2, col = col.alpha("black", 0.3))
    }
    model_name &lt;- deparse(match.call()[[2]])
    mtext(model_name, adj = 0)
}
&lt;bytecode: 0x32edf3b68&gt;
&lt;environment: namespace:rethinking&gt;</code></pre>
</div>
</div>
<p>Though we’ll be taking a slightly different route than the one outlined in McElreath’s <code>brain_loo_plot()</code> function, we can glean some great insights. For example, we’ll be refitting our <strong>brms</strong> models with <code>update()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>b7.<span class="fl">1.1</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  b7<span class="fl">.1</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">filter</span>(d, <span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">1</span>), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.01.1"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7.<span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: brain_std ~ 1 + mass_std 
   Data: filter(d, row_number() != 1) (Number of observations: 6) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.54      0.14     0.26     0.83 1.00     2373     1698
mass_std      0.15      0.16    -0.17     0.47 1.00     2295     1513

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.32      0.16     0.14     0.77 1.00     1115     1439

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>You can see by the <code>newdata</code> statement that <code>b7.1.1</code> is fit on the <code>d</code> data after dropping the first row. Here’s how we might amend our plotting strategy from before to visualize the posterior mean for the model-implied trajectory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b7.<span class="fl">1.1</span>, <span class="at">newdata =</span> nd) <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (std)"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"brain volume (std)"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"b7.1.1"</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>Now we’ll make a <strong>brms</strong>-oriented version of McElreath’s <code>brain_loo_plot()</code> function. Our version <code>brain_loo_lines()</code> will refit the model and extract the lines information in one step. We’ll leave the plotting for a second step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>brain_loo_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, row, ...) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Refit the model</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  new_fit <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    brms_fit,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">filter</span>(d, <span class="fu">row_number</span>() <span class="sc">!=</span> row), </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    ...)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pull the lines values</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(new_fit, <span class="at">newdata =</span> nd) <span class="sc">|&gt;</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s how <code>brain_loo_lines()</code> works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">brain_loo_lines</span>(b7<span class="fl">.1</span>, <span class="at">row =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 2
$ Estimate &lt;dbl&gt; 0.2432784, 0.2493555, 0.2554325, 0.2615096, 0.2675867, 0.2736638, 0.2797409, 0.2858179, 0.2918950, 0.2979721, 0…
$ mass_std &lt;dbl&gt; -2.0000000, -1.9595960, -1.9191919, -1.8787879, -1.8383838, -1.7979798, -1.7575758, -1.7171717, -1.6767677, -1.…</code></pre>
</div>
</div>
<p>Working within the <strong>tidyverse</strong> paradigm, we’ll make a tibble with the predefined <code>row</code> values. We will then use <code>purrr::map()</code> to plug those <code>row</code> values into <code>brain_loo_lines()</code>, which will return the desired posterior <code>mean</code> values for each corresponding value of <code>mass_std</code>. Here we do that for both <code>b7.1</code> and <code>b7.4</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.1</span>_fits <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> row, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.f =</span> \(x) <span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> b7<span class="fl">.1</span>, <span class="at">row =</span> x))) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>b7<span class="fl">.4</span>_fits <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> row, <span class="at">.f =</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> b7<span class="fl">.4</span>, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">row =</span> x,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.999</span>))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now for each, pump those values into <code>ggplot()</code>, customize the settings, and combine the two ggplots to make the full Figure 7.4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> b7<span class="fl">.1</span>_fits <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> row),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (std)"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"brain volume (std)"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"b7.1"</span>) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>brain_std))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Right</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> b7<span class="fl">.4</span>_fits <span class="sc">|&gt;</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_std),</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"body mass (std)"</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"brain volume (std)"</span>,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"b7.4"</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>mass_std),</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.4</span>))</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>“Notice that the straight lines hardly vary, while the curves fly about wildly. This is a general contrast between underfit and overfit models: sensitivity to the exact composition of the sample used to fit the model” (p.&nbsp;201).</p>
<section id="rethinking-bias-and-variance" class="level4" data-number="7.1.2.1">
<h4 data-number="7.1.2.1" class="anchored" data-anchor-id="rethinking-bias-and-variance"><span class="header-section-number">7.1.2.1</span> Rethinking: Bias and variance</h4>
<blockquote class="blockquote">
<p>The underfitting/overfitting dichotomy is often described as the <strong>bias-variance trade-off</strong>. While not exactly the same distinction, the bias-variance trade-off addresses the same problem. “Bias” is related to underfitting, while “variance” is related to overfitting. These terms are confusing, because they are used in many different ways in different contexts, even within statistics. The term “bias” also sounds like a bad thing, even though increasing bias often leads to better predictions. (p.&nbsp;201, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Take a look at <span class="citation" data-cites="yarkoniChoosingPredictionExplanation2017">Yarkoni &amp; Westfall (<a href="references.html#ref-yarkoniChoosingPredictionExplanation2017" role="doc-biblioref">2017</a>)</span> for more on the bias-variance trade-off. As McElreath indicated in his endnote #104 (p.&nbsp;563), Hastie, Tibshirani and Friedman <span class="citation" data-cites="hastie2009elements">(<a href="references.html#ref-hastie2009elements" role="doc-biblioref">2009</a>)</span> broadly cover these ideas in their freely-downloadable text, <a href="https://link.springer.com/book/10.1007%2F978-0-387-84858-7"><em>The elements of statistical learning</em></a>.</p>
</section>
</section>
</section>
<section id="entropy-and-accuracy" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="entropy-and-accuracy"><span class="header-section-number">7.2</span> Entropy and accuracy</h2>
<blockquote class="blockquote">
<p>So how do we navigate between the hydra of overfitting and the vortex of underfitting? Whether you end up using regularization or information criteria or both, the first thing you must do is pick a criterion of model performance. What do you want the model to do well at? We’ll call this criterion the <em>target</em>, and in this section you’ll see how information theory provides a common and useful target. (p.&nbsp;202, <em>emphasis</em> in the original)</p>
</blockquote>
<section id="firing-the-weatherperson" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="firing-the-weatherperson"><span class="header-section-number">7.2.1</span> Firing the weatherperson</h3>
<p>If you let rain = 1 and sun = 0, here’s a way to make a plot of the first table of page 203, the weatherperson’s predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">day        =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prediction =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.6</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed   =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day) <span class="sc">|&gt;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> name, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value, <span class="at">color =</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here’s how the newcomer fared:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>newcomer <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">day        =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prediction =</span> <span class="dv">0</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed   =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>))) </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>newcomer <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> name, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value, <span class="at">color =</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>If we do the math entailed in the tibbles, we’ll see why the newcomer could boast “I’m the best person for the job” (p.&nbsp;203).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(newcomer) <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"weatherperson"</span>, <span class="st">"newcomer"</span>), <span class="at">each =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hit    =</span> <span class="fu">ifelse</span>(prediction <span class="sc">==</span> observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> prediction <span class="sc">-</span> observed)) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">|&gt;</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hit_rate =</span> <span class="fu">mean</span>(hit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  person        hit_rate
  &lt;chr&gt;            &lt;dbl&gt;
1 newcomer          0.7 
2 weatherperson     0.58</code></pre>
</div>
</div>
<section id="costs-and-benefits" class="level4" data-number="7.2.1.1">
<h4 data-number="7.2.1.1" class="anchored" data-anchor-id="costs-and-benefits"><span class="header-section-number">7.2.1.1</span> Costs and benefits</h4>
<p>Our new <code>points</code> variable doesn’t fit into the nice color-based <code>geom_tile()</code> plots from above, but we can still do the math.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(weatherperson, newcomer) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"weatherperson"</span>, <span class="st">"newcomer"</span>), <span class="at">each =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">points =</span> <span class="fu">ifelse</span>(observed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> prediction <span class="sc">!=</span> <span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(observed <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> prediction <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> prediction))) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">|&gt;</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">happiness =</span> <span class="fu">sum</span>(points))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  person        happiness
  &lt;chr&gt;             &lt;dbl&gt;
1 newcomer          -15  
2 weatherperson      -7.2</code></pre>
</div>
</div>
</section>
<section id="measuring-accuracy" class="level4" data-number="7.2.1.2">
<h4 data-number="7.2.1.2" class="anchored" data-anchor-id="measuring-accuracy"><span class="header-section-number">7.2.1.2</span> Measuring accuracy</h4>
<blockquote class="blockquote">
<p>Consider computing the probability of predicting the exact sequence of days. This means computing the probability of a correct prediction for each day. Then multiply all of these probabilities together to get the joint probability of correctly predicting the observed sequence. This is the same thing as the joint likelihood, which you’ve been using up to this point to fit models with Bayes’ theorem. This is the definition of accuracy that is maximized by the correct model.</p>
<p>In this light, the newcomer looks even worse. (p.&nbsp;204)</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(weatherperson, newcomer) <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"weatherperson"</span>, <span class="st">"newcomer"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">hit    =</span> <span class="fu">ifelse</span>(prediction <span class="sc">==</span> observed, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> prediction <span class="sc">-</span> observed)) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(person, hit) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">power =</span> hit <span class="sc">^</span> n,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">term  =</span> <span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">times =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(person, term, power) <span class="sc">|&gt;</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> power) <span class="sc">|&gt;</span> </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability_correct_sequence =</span> a <span class="sc">*</span> b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  person              a     b probability_correct_sequence
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;                        &lt;dbl&gt;
1 newcomer      0           1                      0      
2 weatherperson 0.00164     1                      0.00164</code></pre>
</div>
</div>
</section>
</section>
<section id="information-and-uncertainty" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="information-and-uncertainty"><span class="header-section-number">7.2.2</span> Information and uncertainty</h3>
<p>Within the context of information theory <span class="citation" data-cites="shannonMathematicalTheoryCommunication1948 cover2006elements">(<a href="references.html#ref-shannonMathematicalTheoryCommunication1948" role="doc-biblioref">Shannon, 1948</a>; also <a href="references.html#ref-cover2006elements" role="doc-biblioref">Cover &amp; Thomas, 2006</a>)</span>, information is “the reduction in uncertainty when we learn an outcome” (p.&nbsp;205). <strong>Information entropy</strong> is a way of measuring that uncertainty in a way that is (a) continuous, (b) increases as the number of possible events increases, and (c) is additive. The formula for information entropy is:</p>
<p><span class="math display">\[H(p) = - \text E \log (p_i) = - \sum_{i = 1}^n p_i \log (p_i).\]</span></p>
<p>McElreath put it in words as: “The uncertainty contained in a probability distribution is the average log-probability of an event.” (p.&nbsp;206). We’ll compute the information entropy for weather at the first unnamed location, which we’ll call <code>McElreath's house</code>, and <code>Abu Dhabi</code> at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">place  =</span> <span class="fu">c</span>(<span class="st">"McElreath's house"</span>, <span class="st">"Abu Dhabi"</span>),</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_rain =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_shine =</span> <span class="dv">1</span> <span class="sc">-</span> p_rain) <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(place) <span class="sc">|&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h_p =</span> (p_rain <span class="sc">*</span> <span class="fu">log</span>(p_rain) <span class="sc">+</span> p_shine <span class="sc">*</span> <span class="fu">log</span>(p_shine)) <span class="sc">|&gt;</span> <span class="fu">mean</span>() <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Groups:   place [2]
  place             p_rain p_shine    h_p
  &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 McElreath's house   0.3     0.7  0.611 
2 Abu Dhabi           0.01    0.99 0.0560</code></pre>
</div>
</div>
<p>Did you catch how we used the equation <span class="math inline">\(H(p) = - \sum_{i = 1}^n p_i \log (p_i)\)</span> in our <code>mutate()</code> code, there? Our computation indicated the uncertainty is less in Abu Dhabi because it rarely rains, there. If you have sun, rain and snow, the entropy for weather is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8188085</code></pre>
</div>
</div>
<p>“These entropy values by themselves don’t mean much to us, though. Instead we can use them to build a measure of accuracy. That comes next” (p.&nbsp;206).</p>
</section>
<section id="from-entropy-to-accuracy" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="from-entropy-to-accuracy"><span class="header-section-number">7.2.3</span> From entropy to accuracy</h3>
<blockquote class="blockquote">
<p>How can we use information entropy to say how far a model is from the target? The key lies in <strong>divergence</strong>:</p>
<blockquote class="blockquote">
<p><strong>Divergence</strong>: The additional uncertainty induced by using probabilities from one distribution to describe another distribution.</p>
</blockquote>
<p>This is often known as <em>Kullback-Leibler divergence</em> or simply KL divergence. <span class="citation" data-cites="kullbackInformationSufficiency1951">(p.&nbsp;207, <strong>emphasis</strong> in the original, see <a href="references.html#ref-kullbackInformationSufficiency1951" role="doc-biblioref">Kullback &amp; Leibler, 1951</a>)</span></p>
</blockquote>
<p>The formula for the KL divergence is</p>
<p><span class="math display">\[D_\text{KL} (p, q) = \sum_i p_i \big ( \log (p_i) - \log (q_i) \big ) = \sum_i p_i \log \left ( \frac{p_i}{q_i} \right ),\]</span></p>
<p>which is what McElreath described in plainer language as “the average difference in log probability between the target (<span class="math inline">\(p\)</span>) and model (<span class="math inline">\(q\)</span>)” (p.&nbsp;207).</p>
<p>In McElreath’s initial example</p>
<ul>
<li><span class="math inline">\(p_1 = 0.3\)</span>,</li>
<li><span class="math inline">\(p_2 = 0.7\)</span>,</li>
<li><span class="math inline">\(q_1 = 0.25\)</span>, and</li>
<li><span class="math inline">\(q_2 = 0.75\)</span>.</li>
</ul>
<p>With those values, we can compute <span class="math inline">\(D_\text{KL} (p, q)\)</span> within a tibble like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p_1 =</span> <span class="fl">0.3</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_2 =</span> <span class="fl">0.7</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_1 =</span> <span class="fl">0.25</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_2 =</span> <span class="fl">0.75</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    p_1   p_2   q_1   q_2    d_kl
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1   0.3   0.7  0.25  0.75 0.00640</code></pre>
</div>
</div>
<p>Our systems in this section are binary (e.g., <span class="math inline">\(q = \{ q_i, q_2 \}\)</span>). Thus if you know <span class="math inline">\(q_1 = .3\)</span> you know of a necessity <span class="math inline">\(q_2 = 1 - q_1\)</span>. Therefore we can code the tibble for the next example, for when <span class="math inline">\(p = q\)</span>, like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p_1 =</span> <span class="fl">0.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2 =</span> <span class="dv">1</span> <span class="sc">-</span> p_1,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_1 =</span> p_1) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    p_1   p_2   q_1   q_2  d_kl
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.3   0.7   0.3   0.7     0</code></pre>
</div>
</div>
<p>Building off of that, you can make the data required for Figure 7.6 like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">p_1 =</span> <span class="fl">0.3</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_2 =</span> <span class="fl">0.7</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">q_1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="fl">0.99</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
    p_1   p_2   q_1   q_2  d_kl
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.3   0.7  0.01  0.99 0.778
2   0.3   0.7  0.02  0.98 0.577
3   0.3   0.7  0.03  0.97 0.462
4   0.3   0.7  0.04  0.96 0.383
5   0.3   0.7  0.05  0.95 0.324
6   0.3   0.7  0.06  0.94 0.276</code></pre>
</div>
</div>
<p>Now we have the data, plotting Figure 7.6 is a just <code>geom_line()</code> with stylistic flourishes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>t <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> q_1, <span class="at">y =</span> d_kl)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">5</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.4</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">"q = p"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">5</span>], <span class="at">family =</span> <span class="st">"Courier"</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"q[1]"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Divergence of q from p"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>What divergence can do for us now is help us contrast different approximations to <span class="math inline">\(p\)</span>. As an approximating function <span class="math inline">\(q\)</span> becomes more accurate, <span class="math inline">\(D_\text{KL} (p, q)\)</span> will shrink. So if we have a pair of candidate distributions, then the candidate that minimizes the divergence will be closest to the target. Since predictive models specify probabilities of events (observations), we can use divergence to compare the accuracy of models. (p.&nbsp;208)</p>
</blockquote>
<section id="rethinking-divergence-depends-upon-direction" class="level4" data-number="7.2.3.1">
<h4 data-number="7.2.3.1" class="anchored" data-anchor-id="rethinking-divergence-depends-upon-direction"><span class="header-section-number">7.2.3.1</span> Rethinking: Divergence depends upon direction</h4>
<p>Here we see <span class="math inline">\(H(p, q) \neq H(q, p)\)</span>. That is, direction matters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">direction =</span> <span class="fu">c</span>(<span class="st">"Earth to Mars"</span>, <span class="st">"Mars to Earth"</span>),</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_1 =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.7</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_1 =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2 =</span> <span class="dv">1</span> <span class="sc">-</span> p_1,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">|&gt;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  direction       p_1   q_1   p_2   q_2  d_kl
  &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Earth to Mars  0.01  0.7   0.99  0.3   1.14
2 Mars to Earth  0.7   0.01  0.3   0.99  2.62</code></pre>
</div>
</div>
<p>The <span class="math inline">\(D_\text{KL}\)</span> was double when applying Martian estimates to Terran estimates.</p>
<blockquote class="blockquote">
<p>An important practical consequence of this asymmetry, in a model fitting context, is that if we use a distribution with high entropy to approximate an unknown true distribution of events, we will reduce the distance to the truth and therefore the error. This fact will help us build generalized linear models, later on in <a href="10.html" class="quarto-xref"><span>Chapter 10</span></a>. (p.&nbsp;209)</p>
</blockquote>
</section>
</section>
<section id="estimating-divergence" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="estimating-divergence"><span class="header-section-number">7.2.4</span> Estimating divergence</h3>
<blockquote class="blockquote">
<p>The point of all the preceding material about information theory and divergence is to establish both:</p>
<ol type="1">
<li><p>How to measure the distance of a model from our target. Information theory gives us the distance measure we need, the KL divergence.</p></li>
<li><p>How to estimate the divergence. Having identified the right measure of distance, we now need a way to estimate it in real statistical modeling tasks. (p.&nbsp;209)</p></li>
</ol>
</blockquote>
<p>Now we’ll start working on item #2.</p>
<p>Within the context of science, say we’ve labeled the true model for our topic of interest as <span class="math inline">\(p\)</span>. We don’t actually know what <span class="math inline">\(p\)</span> is–we wouldn’t need the scientific method if we did. But say what we do have are two candidate models <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span>. We would at least like to know which is closer to <span class="math inline">\(p\)</span>. It turns out we don’t even need to know the absolute value of <span class="math inline">\(p\)</span> to achieve this. Just the relative values of <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> will suffice. We express model <span class="math inline">\(q\)</span>’s average log-probability as <span class="math inline">\(\text E \log (q_i)\)</span>. Extrapolating, the difference <span class="math inline">\(\text E \log (q_i) - \text E \log (r_i)\)</span> gives us a sense about the divergence of both <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> from the target <span class="math inline">\(p\)</span>. That is, “we can compare the average log-probability from each model to get an estimate of the relative distance of each model from the target” (p.&nbsp;210). <strong>Deviance</strong> and related statistics can help us towards this end. We define deviance as</p>
<p><span class="math display">\[D(q) = -2 \sum_i \log (q_i),\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes each case and <span class="math inline">\(q_i\)</span> is the likelihood for each case. Here’s the deviance from the OLS version of model <code>m7.1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">data =</span> d, brain_std <span class="sc">~</span> mass_std) <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logLik</span>() <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'log Lik.' -5.985049 (df=3)</code></pre>
</div>
</div>
<p>In our <span class="math inline">\(D(q)\)</span> formula, did you notice how we ended up multiplying <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span>? Frequentists and Bayesians alike make use of information theory, KL divergence, and deviance. It turns out that the differences between two <span class="math inline">\(D(q)\)</span> values follows a <span class="math inline">\(\chi^2\)</span> distribution <span class="citation" data-cites="wilksLargesampleDistributionLikelihood1938">(<a href="references.html#ref-wilksLargesampleDistributionLikelihood1938" role="doc-biblioref">Wilks, 1938</a>)</span>, which frequentists like to reference for the purpose of null-hypothesis significance testing. Many Bayesians, however, are not into all that significance-testing stuff and they aren’t as inclined to multiply <span class="math inline">\(\sum_i \log (p_i)\)</span> by <span class="math inline">\(-2\)</span> for the simple purpose of scaling the associated difference distribution to follow the <span class="math inline">\(\chi^2\)</span>. If we leave that part out of the equation, we end up with</p>
<p><span class="math display">\[S(q) = \sum_i \log (q_i),\]</span></p>
<p>which we can think of as a log-probability score which is “the gold standard way to compare the predictive accuracy of different models. It is an estimate of <span class="math inline">\(\text E \log (q_i)\)</span>, just without the final step of dividing by the number of observations” (p.&nbsp;210). When Bayesians compute <span class="math inline">\(S(q)\)</span>, they do so over the entire posterior distribution. “Doing this calculation correctly requires a little subtlety. The <strong>rethinking</strong> package has a function called <code>lppd</code>–<strong>log-pointwise-predictive-density</strong>–to do this calculation for quap models” (p.&nbsp;210, <strong>emphasis</strong> in the original for the second time, but not the first). However, I’m now aware of a similar function within <strong>brms</strong>. If you’re willing to roll up your sleeves, a little, you can do it by hand. Here’s an example with <code>b7.1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(b7<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">|&gt;</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"species"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"logprob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">|&gt;</span> </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">|&gt;</span> <span class="fu">log</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  species     log_probability_score
  &lt;chr&gt;                       &lt;dbl&gt;
1 afarensis                   0.355
2 africanus                   0.379
3 boisei                      0.371
4 ergaster                    0.202
5 habilis                     0.302
6 rudolfensis                 0.247
7 sapiens                    -0.591</code></pre>
</div>
</div>
<p>“If you sum these values, you’ll have the total log-probability score for the model and data” (p.&nbsp;210). Here we sum those <span class="math inline">\(\log (q_i)\)</span> values up to compute <span class="math inline">\(S(q)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(b7<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">|&gt;</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"species"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"logprob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">|&gt;</span> </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">|&gt;</span> <span class="fu">log</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total_log_probability_score
                        &lt;dbl&gt;
1                        1.26</code></pre>
</div>
</div>
<section id="sec-Computing-the-lppd" class="level4" data-number="7.2.4.1">
<h4 data-number="7.2.4.1" class="anchored" data-anchor-id="sec-Computing-the-lppd"><span class="header-section-number">7.2.4.1</span> Overthinking: Computing the lppd</h4>
<p>The Bayesian version of the log-probability score, what we’ve been calling the lppd, has to account for the data and the posterior distribution. It follows the form</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i \mid \Theta_s),\]</span></p>
<blockquote class="blockquote">
<p>where <span class="math inline">\(S\)</span> is the number of samples and <span class="math inline">\(\Theta_s\)</span> is the <span class="math inline">\(s\)</span>-th set of sampled parameter values in the posterior distribution. While in principle this is easy–you just need to compute the probability (density) of each observation <span class="math inline">\(i\)</span> for each sample <span class="math inline">\(s\)</span>, take the average, and then the logarithm–in practice it is not so easy. The reason is that doing arithmetic in a computer often requires some tricks to retain precision. (p.&nbsp;210)</p>
</blockquote>
<p>Our approach to McElreath’s <strong>R</strong> code 7.14 code will look very different. Going step by step, first we use the <code>log_lik()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>log_prob <span class="ot">&lt;-</span> <span class="fu">log_lik</span>(b7<span class="fl">.1</span>) </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>log_prob <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1:7] 0.0602 -0.1208 -0.284 -0.667 -1.0836 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : NULL</code></pre>
</div>
</div>
<p>The <code>log_lik()</code> function returned a matrix. Each occasion in the original data, <span class="math inline">\(y_i\)</span>, got a column and each HMC chain iteration gets a row. Given we used the <strong>brms</strong> default of 4,000 HMC iterations, which corresponds to <span class="math inline">\(S = 4{,}000\)</span> in the formula. Note the each of these <span class="math inline">\(7 \times 4{,}000\)</span> values is a log-probability, not a probability itself. Thus, if we want to start summing these <span class="math inline">\(s\)</span> iterations within cases, we’ll need to exponentiate them into probabilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> log_prob <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make it a data frame</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add case names, for convenience</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(d, species)) <span class="sc">|&gt;</span> </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add an `s` iteration index, for convenience</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make it long</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>s,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"species"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"logprob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the probability scores</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob))</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28,000 × 4
       s species     logprob  prob
   &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;
 1     1 afarensis    0.0602 1.06 
 2     1 africanus   -0.0458 0.955
 3     1 habilis     -0.491  0.612
 4     1 boisei       0.152  1.16 
 5     1 rudolfensis  0.197  1.22 
 6     1 ergaster     0.130  1.14 
 7     1 sapiens     -0.629  0.533
 8     2 afarensis   -0.121  0.886
 9     2 africanus   -0.208  0.812
10     2 habilis     -0.575  0.563
# ℹ 27,990 more rows</code></pre>
</div>
</div>
<p>Now for each case, we take the average of each of the probability sores, and then take the log of that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> prob <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">|&gt;</span> <span class="fu">log</span>())</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  species     log_probability_score
  &lt;chr&gt;                       &lt;dbl&gt;
1 afarensis                   0.355
2 africanus                   0.379
3 boisei                      0.371
4 ergaster                    0.202
5 habilis                     0.302
6 rudolfensis                 0.247
7 sapiens                    -0.591</code></pre>
</div>
</div>
<p>For our last step, we sum those values up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>prob <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total_log_probability_score
                        &lt;dbl&gt;
1                        1.26</code></pre>
</div>
</div>
<p>That, my friends, is the log-pointwise-predictive-density, <span class="math inline">\(\text{lppd}(y, \Theta)\)</span>.</p>
</section>
</section>
<section id="sec-Scoring-the-right-data" class="level3" data-number="7.2.5">
<h3 data-number="7.2.5" class="anchored" data-anchor-id="sec-Scoring-the-right-data"><span class="header-section-number">7.2.5</span> Scoring the right data</h3>
<p>Since we don’t have a <code>lppd()</code> function for <strong>brms</strong>, we’ll have to turn our workflow from the last two sections into a custom function. We’ll call it <code>my_lppd()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>my_lppd <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit) {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(brms_fit) <span class="sc">|&gt;</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"logprob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(logprob)) <span class="sc">|&gt;</span> </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">|&gt;</span> <span class="fu">log</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a <strong>tidyverse</strong>-style approach for computing the lppd for each of our six <strong>brms</strong> models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">"b7."</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brms_fit =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> name, <span class="at">.f =</span> get)) <span class="sc">|&gt;</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lppd =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> brms_fit, <span class="at">.f =</span> my_lppd)) <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(lppd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  name  brms_fit  total_log_probability_score
  &lt;chr&gt; &lt;list&gt;                          &lt;dbl&gt;
1 b7.1  &lt;brmsfit&gt;                      1.26  
2 b7.2  &lt;brmsfit&gt;                      0.632 
3 b7.3  &lt;brmsfit&gt;                      0.362 
4 b7.4  &lt;brmsfit&gt;                      0.0140
5 b7.5  &lt;brmsfit&gt;                      2.25  
6 b7.6  &lt;brmsfit&gt;                     25.9   </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>When we usually have data and use it to fit a statistical model, the data comprise a <strong>training sample</strong>. Parameters are estimated from it, and then we can imagine using those estimates to predict outcomes in a new sample, called the <strong>test sample</strong>. R is going to do all of this for you. But here’s the full procedure, in outline:</p>
<ol type="1">
<li>Suppose there’s a training sample of size <span class="math inline">\(N\)</span>.</li>
<li>Compute the posterior distribution of a model for the training sample, and compute the score on the training sample. Call this score <span class="math inline">\(D_\text{train}\)</span>.</li>
<li>Suppose another sample of size <span class="math inline">\(N\)</span> from the same process. This is the test sample.</li>
<li>Compute the score on the test sample, using the posterior trained on the training sample. Call this new score <span class="math inline">\(D_\text{test}\)</span>.</li>
</ol>
<p>The above is a thought experiment. It allows us to explore the distinction between accuracy measured in and out of sample, using a simple prediction scenario. (p.&nbsp;211, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>We’ll see how to carry out such a thought experiment in the next section.</p>
<section id="overthinking-simulated-training-and-testing" class="level4" data-number="7.2.5.1">
<h4 data-number="7.2.5.1" class="anchored" data-anchor-id="overthinking-simulated-training-and-testing"><span class="header-section-number">7.2.5.1</span> Overthinking: Simulated training and testing</h4>
<p>McElreath plotted the results of such a thought experiment in implemented in <strong>R</strong> with the aid of his <code>sim_train_test()</code> function. If you’re interested in how the function pulls this off, execute the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>sim_train_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the sake of brevity, I am going to show the results of a simulation based on 1,000 simulations rather than McElreath’s 10,000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>t0 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># I've reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>n_sim   <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>kseq    <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the simulation function</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>my_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(k);</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(n_sim, <span class="fu">sim_train_test</span>(<span class="at">N =</span> n, <span class="at">k =</span> k), <span class="at">mc.cores =</span> n_cores);</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">mean</span>(r[<span class="dv">1</span>, ]), <span class="fu">mean</span>(r[<span class="dv">2</span>, ]), <span class="fu">sd</span>(r[<span class="dv">1</span>, ]), <span class="fu">sd</span>(r[<span class="dv">2</span>, ]))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's our dev object based on `N &lt;- 20`</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>n      <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>dev_20 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(kseq, my_sim)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's our dev object based on `N &lt;- 100`</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>n       <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>dev_100 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(kseq, my_sim)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>t1 <span class="sc">-</span> t0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you didn’t quite catch it, the simulation yields <code>dev_20</code> and <code>dev_100</code>. We’ll want to convert them to tibbles, bind them together, and wrangle extensively before we’re ready to plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>dev_tibble <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dev_20, dev_100) <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statistic =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>), <span class="at">each =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">rep</span>(<span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample    =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"in"</span>, <span class="st">"out"</span>), <span class="at">times =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">rep</span>(<span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">n         =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"n = 20"</span>, <span class="st">"n = 100"</span>), <span class="at">each =</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(statistic<span class="sc">:</span>n)) <span class="sc">|&gt;</span> </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> statistic, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n     =</span> <span class="fu">factor</span>(n, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"n = 20"</span>, <span class="st">"n = 100"</span>)),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_par =</span> <span class="fu">str_extract</span>(name, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">|&gt;</span> <span class="fu">as.double</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_par =</span> <span class="fu">ifelse</span>(sample <span class="sc">==</span> <span class="st">"in"</span>, n_par <span class="sc">-</span> <span class="fl">0.075</span>, n_par <span class="sc">+</span> <span class="fl">0.075</span>))</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dev_tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  sample n      name   mean    sd n_par
  &lt;chr&gt;  &lt;fct&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 in     n = 20 X1     55.8  5.85 0.925
2 in     n = 20 X2     54.6  5.40 1.92 
3 in     n = 20 X3     51.8  4.29 2.92 
4 in     n = 20 X4     51.2  4.04 3.92 
5 in     n = 20 X5     51.2  3.63 4.92 
6 out    n = 20 X1     57.8  6.25 1.08 </code></pre>
</div>
</div>
<p>Now we’re ready to make Figure 7.6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the annotation</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> dev_tibble <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_par <span class="sc">&gt;</span> <span class="fl">1.5</span>, </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>         n_par <span class="sc">&lt;</span> <span class="fl">2.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_par =</span> <span class="fu">ifelse</span>(sample <span class="sc">==</span> <span class="st">"in"</span>, n_par <span class="sc">-</span> <span class="fl">0.2</span>, n_par <span class="sc">+</span> <span class="fl">0.29</span>))</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot!</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>dev_tibble <span class="sc">|&gt;</span> </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_par, <span class="at">y =</span> mean,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> mean <span class="sc">-</span> sd, <span class="at">ymax =</span> mean <span class="sc">+</span> sd,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> sample, <span class="at">color =</span> sample, <span class="at">fill  =</span> sample)) <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> sample)) <span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values  =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"number of parameters"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"deviance"</span>,</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Figure 7.6. Deviance in and out of sample."</span>) <span class="sc">+</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> n, <span class="at">scale =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Even with a substantially smaller <span class="math inline">\(N\)</span>, our simulation results matched up well with those in the text.</p>
<blockquote class="blockquote">
<p>Deviance is an assessment of predictive accuracy, not of truth. The true model, in terms of which predictors are included, is not guaranteed to produce the best predictions. Likewise a false model, in terms of which predictors are included, is not guaranteed to produce poor predictions.</p>
<p>The point of this thought experiment is to demonstrate how deviance behaves, in theory. While deviance on training data always improves with additional predictor variables, deviance on future data may or may not, depending upon both the true data-generating process and how much data is available to precisely estimate the parameters. These facts form the basis for understanding both regularizing priors and information criteria. (p.&nbsp;213)</p>
</blockquote>
</section>
</section>
</section>
<section id="golem-taming-regularization" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="golem-taming-regularization"><span class="header-section-number">7.3</span> Golem taming: regularization</h2>
<blockquote class="blockquote">
<p>The root of overfitting is a model’s tendency to get overexcited by the training sample. When the priors are flat or nearly flat, the machine interprets this to mean that every parameter value is equally plausible. As a result, the model returns a posterior that encodes as much of the training sample–as represented by the likelihood function–as possible.</p>
<p>One way to prevent a model from getting too excited by the training sample is to use a skeptical prior. By “skeptical,” I mean a prior that slows the rate of learning from the sample. The most common skeptical prior is a <strong>regularizing prior</strong>. Such a prior, when tuned properly, reduces overfitting while still allowing the model to learn the regular features of a sample. (p.&nbsp;214, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>In case you were curious, here’s how you might make a version Figure 7.7 with <strong>ggplot2</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span> <span class="fl">3.5</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">c =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">1.0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> name, <span class="at">color =</span> name, <span class="at">linetype =</span> name)) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"parameter value"</span>, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>In our version of the plot, darker purple = more regularizing.</p>
<p>To prepare for Figure 7.8, we need to simulate. This time we’ll wrap the basic simulation code we used before into a function we’ll call <code>make_sim()</code>. Our <code>make_sim()</code> function has two parameters, <code>n</code> and <code>b_sigma</code>, both of which come from McElreath’s simulation code. So you’ll note that instead of hard coding the values for <code>n</code> and <code>b_sigma</code> within the simulation, we’re leaving them adjustable (i.e., <code>sim_train_test(N = n, k = k, b_sigma = b_sigma)</code>). Also notice that instead of saving the simulation results as objects, like before, we’re just converting them to a data frame with the <code>data.frame()</code> function at the bottom. Our goal is to use <code>make_sim()</code> within a <code>purrr::map2()</code> statement. The result will be a nested data frame into which we’ve saved the results of 6 simulations based off of two sample sizes (i.e., <code>n = c(20, 100)</code>) and three values of <span class="math inline">\(\sigma\)</span> for our Gaussian <span class="math inline">\(\beta\)</span> prior (i.e., <code>b_sigma = c(1, 0.5, 0.2)</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># I've reduced this number by one order of magnitude to reduce computation time</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>n_sim   <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>make_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, b_sigma) {</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(kseq, <span class="cf">function</span>(k) {</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(k);</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(n_sim, <span class="fu">sim_train_test</span>(<span class="at">N =</span> n, <span class="at">k =</span> k, <span class="at">b_sigma =</span> b_sigma),  <span class="co"># This is an augmented line of code</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mc.cores =</span> n_cores);</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fu">mean</span>(r[<span class="dv">1</span>, ]), <span class="fu">mean</span>(r[<span class="dv">2</span>, ]), <span class="fu">sd</span>(r[<span class="dv">1</span>, ]), <span class="fu">sd</span>(r[<span class="dv">2</span>, ])) </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is a new line of code</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>()</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">n       =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">map2</span>(n, b_sigma, make_sim)) <span class="sc">|&gt;</span> </span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll follow the same principles for wrangling these data as we did those from the previous simulation, <code>dev_tibble</code>. After wrangling, we’ll feed the data directly into the code for our version of Figure 7.8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle the simulation data</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statistic =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>), <span class="at">each =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">rep</span>(<span class="at">times =</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample    =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"in"</span>, <span class="st">"out"</span>), <span class="at">times =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">rep</span>(<span class="at">times =</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(n<span class="sc">:</span>b_sigma, statistic<span class="sc">:</span>sample)) <span class="sc">|&gt;</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> statistic, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n     =</span> <span class="fu">str_c</span>(<span class="st">"n = "</span>, n) <span class="sc">|&gt;</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"n = 20"</span>, <span class="st">"n = 100"</span>)),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_par =</span> <span class="fu">str_extract</span>(name, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">|&gt;</span> <span class="fu">as.double</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_par, <span class="at">y =</span> mean,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> <span class="fu">interaction</span>(sample, b_sigma))) <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> sample, <span class="at">linewidth =</span> b_sigma <span class="sc">|&gt;</span> <span class="fu">as.character</span>())) <span class="sc">+</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This function contains the data from the previous simulation</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> dev_tibble, </span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">group =</span> sample, <span class="at">fill =</span> sample),</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">stroke =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"number of parameters"</span>,</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"deviance"</span>) <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> n, <span class="at">scale =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), </span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Our results don’t perfectly align with those in the text. I suspect his is because we used <code>1e3</code> iterations, rather than the <code>1e4</code> of the text. If you’d like to wait all night long for the simulation to yield more stable results, be my guest.</p>
<blockquote class="blockquote">
<p>Regularizing priors are great, because they reduce overfitting. But if they are too skeptical, they prevent the model from learning from the data. When you encounter multilevel models in <a href="13.html" class="quarto-xref"><span>Chapter 13</span></a>, you’ll see that their central device is to learn the strength of the prior from the data itself. So you can think of multilevel models as adaptive regularization, where the model itself tries to learn how skeptical it should be. (p.&nbsp;216)</p>
</blockquote>
<p>I found this connection difficult to grasp for a long time. Practice now and hopefully it’ll sink in for you faster than it did me.</p>
<section id="rethinking-ridge-regression" class="level4" data-number="7.3.0.1">
<h4 data-number="7.3.0.1" class="anchored" data-anchor-id="rethinking-ridge-regression"><span class="header-section-number">7.3.0.1</span> Rethinking: Ridge regression</h4>
<p>Within the <strong>brms</strong> framework, you can do something like this with the horseshoe prior via the <code>horseshoe()</code> function. You can learn all about it from the <code>horseshoe</code> section of the <a href="https://cran.r-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation" data-cites="brms2022RM">(<a href="references.html#ref-brms2022RM" role="doc-biblioref">Bürkner, 2022a</a>)</span>. Here’s an extract from the section:</p>
<blockquote class="blockquote">
<p>The horseshoe prior is a special shrinkage prior initially proposed by <span class="citation" data-cites="carvalho2009handling">Carvalho et al. (<a href="references.html#ref-carvalho2009handling" role="doc-biblioref">2009</a>)</span>. It is symmetric around zero with fat tails and an infinitely large spike at zero. This makes it ideal for sparse models that have many regression coefficients, although only a minority of them is nonzero. The horseshoe prior can be applied on all population-level effects at once (excluding the intercept) by using <code>set_prior("horseshoe(1)")</code>. ()p.&nbsp;105</p>
</blockquote>
<p>To dive even deeper into the horseshoe prior, check out Michael Betancourt’s <span class="citation" data-cites="betancourtBayesSparse2018">(<a href="references.html#ref-betancourtBayesSparse2018" role="doc-biblioref">2018</a>)</span> tutorial, <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html#35_the_horseshoe"><em>Bayes sparse regression</em></a>. Gelman, Hill, and Vehtari cover the horseshoe prior with <strong>rstanarm</strong> in Section 12.7 of their <span class="citation" data-cites="gelmanRegressionOtherStories2020">(<a href="references.html#ref-gelmanRegressionOtherStories2020" role="doc-biblioref">2020</a>)</span> text, <a href="https://avehtari.github.io/ROS-Examples/"><em>Regression and other stories</em></a>. I also have an example of the horseshoe prior (<code>fit18.5</code>) in <a href="https://solomon.quarto.pub/dbda2/18.html#shrinkage-of-regression-coefficients">Section 18.3</a> of my <span class="citation" data-cites="kurzDoingBayesianDataAnalysis2026">(<a href="references.html#ref-kurzDoingBayesianDataAnalysis2026" role="doc-biblioref">2026a</a>)</span> ebook translation of Kruschke’s <span class="citation" data-cites="kruschkeDoingBayesianData2015">(<a href="references.html#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> text.</p>
</section>
</section>
<section id="predicting-predictive-accuracy" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="predicting-predictive-accuracy"><span class="header-section-number">7.4</span> Predicting predictive accuracy</h2>
<blockquote class="blockquote">
<p>All of the preceding suggests one way to navigate overfitting and underfitting: Evaluate our models out-of-sample. But we do not have the out-of-sample, by definition, so how can we evaluate our models on it? There are two families of strategies: <strong>cross-validation</strong> and <strong>information criteria</strong>. These strategies try to guess how well models will perform, on average, in predicting new data. (p.&nbsp;217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<section id="cross-validation" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">7.4.1</span> Cross-validation</h3>
<blockquote class="blockquote">
<p>A popular strategy for estimating predictive accuracy is to actually test the model’s predictive accuracy on another sample. This is known as <strong>cross-validation</strong>, leaving out a small chunk of observations from our sample and evaluating the model on the observations that were left out. Of course we don’t want to leave out data. So what is usually done is to divide the sample in a number of chunks, called “folds.” The model is asked to predict each fold, after training on all the others. We then average over the score for each fold to get an estimate of out-of-sample accuracy. The minimum number of folds is 2. At the other extreme, you could make each point observation a fold and fit as many models as you have individual observations. (p.&nbsp;217, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Folds are typically equivalent in size and we often denote the total number of folds by <span class="math inline">\(k\)</span>, which means that the number of cases will get smaller as <span class="math inline">\(k\)</span> increases. In the extreme <span class="math inline">\(k = N\)</span>. <strong>Leave-one-out cross-validation</strong> (LOO-CV) is the name for this popular type of cross-validation which uses the largest number of folds possible by including a single case in each fold <span class="citation" data-cites="zhangCrossvalidationSelectingModel2015 derooijCrossvalidationMethodEvery2020">(<a href="references.html#ref-derooijCrossvalidationMethodEvery2020" role="doc-biblioref">de Rooij &amp; Weeda, 2020</a>; see <a href="references.html#ref-zhangCrossvalidationSelectingModel2015" role="doc-biblioref">Zhang &amp; Yang, 2015</a>)</span>. This will be our approach.</p>
<p>A practical difficulty with LOO-CV is it’s costly in terms of the time and memory required to refit the model <span class="math inline">\(k = N\)</span> times. Happily, we have an approximation to pure LOO-CV. Vehtari, Gelman, and Gabry <span class="citation" data-cites="vehtariPracticalBayesianModel2017">(<a href="references.html#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">2017</a>)</span> proposed Pareto smoothed importance-sampling leave-one-out cross-validation (PSIS-LOO-CV) as an efficient way to approximate true LOO-CV.</p>
</section>
<section id="information-criteria" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="information-criteria"><span class="header-section-number">7.4.2</span> Information criteria</h3>
<blockquote class="blockquote">
<p>The second approach is the use of <strong>information criteria</strong> to compute an expected score out of sample. Information criteria construct a theoretical estimate of the relative out-of-sample KL divergence. (p.&nbsp;219, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>The frequentist Akaike information criterion <span class="citation" data-cites="akaike1998information">(AIC, <a href="references.html#ref-akaike1998information" role="doc-biblioref">Akaike, 1998</a>)</span> is the oldest and most restrictive. Among Bayesians, the deviance information criterion <span class="citation" data-cites="spiegelhalterBayesianMeasuresModel2002">(DIC, <a href="references.html#ref-spiegelhalterBayesianMeasuresModel2002" role="doc-biblioref">Spiegelhalter et al., 2002</a>)</span> has been widely used for some time, now. For a great talk on the DIC, check out the authoritative David Spiegelhalter’s <a href="https://youtu.be/H-59eqmHuuQ"><em>Retrospective read paper: Bayesian measure of model complexity and fit</em></a>. However, the DIC is limited in that it presumes the posterior is multivariate Gaussian, which is not always the case.</p>
<p>In this book, our focus will be on the widely applicable information criterion <span class="citation" data-cites="watanabeAsymptoticEquivalenceBayes2010">(WAIC, <a href="references.html#ref-watanabeAsymptoticEquivalenceBayes2010" role="doc-biblioref">Watanabe, 2010</a>)</span>, which does not impose assumptions on the shape of the posterior distribution. The WAIC both provides an estimate of out-of-sample deviance and converges with LOO-CV as <span class="math inline">\(N \rightarrow \infty\)</span>. The WAIC follows the formula</p>
<p><span class="math display">\[\text{WAIC}(y, \Theta) = -2 \big (\text{lppd} - \underbrace{\sum_i \operatorname{var}_\theta \log p(y_i \mid \theta)}_\text{penalty term} \big),\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the data, <span class="math inline">\(\Theta\)</span> is the posterior distribution, and <span class="math inline">\(\text{lppd}\)</span> is the log-posterior-predictive-density from before. The penalty term is also referred to at the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. There are a few ways to compute the WAIC with <strong>brms</strong>, including with the <code>waic()</code> function.</p>
<section id="overthinking-waic-calculations" class="level4" data-number="7.4.2.1">
<h4 data-number="7.4.2.1" class="anchored" data-anchor-id="overthinking-waic-calculations"><span class="header-section-number">7.4.2.1</span> Overthinking: WAIC calculations</h4>
<p>Here is how to fit the pre-WAIC model with <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cars)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>b7.m <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cars, </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  dist <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> speed,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b07.0m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Behold the posterior summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b7.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: dist ~ 1 + speed 
   Data: cars (Number of observations: 50) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept   -17.52      6.09   -29.43    -5.15 1.00     3647     2790
speed         3.92      0.37     3.17     4.65 1.00     3613     2878

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma    13.81      1.22    11.67    16.44 1.00     4056     2960

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Now use the <code>log_lik()</code> function to return the log-likelihood for each observation <span class="math inline">\(i\)</span> at each posterior draw <span class="math inline">\(s\)</span>, where <span class="math inline">\(S = 4{,}000\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>n_cases <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cars)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">log_lik</span>(b7.m) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="sc">:</span>n_cases))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have a <span class="math inline">\(4{,}000 \times 50\)</span> (i.e., <span class="math inline">\(S \times N\)</span>) data frame with posterior draws in rows and cases in columns. Computing the <span class="math inline">\(\text{lppd}\)</span>, the “Bayesian deviance”, takes a bit of leg work. Recall the formula for <span class="math inline">\(\text{lppd}\)</span>,</p>
<p><span class="math display">\[\text{lppd}(y, \Theta) = \sum_i \log \frac{1}{S} \sum_s p (y_i \mid \Theta_s),\]</span></p>
<p>where <span class="math inline">\(p (y_i \mid \Theta_s)\)</span> is the likelihood of case <span class="math inline">\(i\)</span> on posterior draw <span class="math inline">\(s\)</span>. Since <code>log_lik()</code> returns the pointwise log-likelihood, our first step is to exponentiate those values. For each case <span class="math inline">\(i\)</span> (i.e., <span class="math inline">\(\sum_i\)</span>), we then take the average likelihood value [i.e., <span class="math inline">\(\frac{1}{S} \sum_s p (y_i \mid \Theta_s)\)</span>] and transform the result by taking its log [i.e., <span class="math inline">\(\log \left (\frac{1}{S} \sum_s p (y_i \mid \Theta_s) \right )\)</span>]. Here we’ll save the pointwise solution as <code>log_mu_l</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>log_mu_l <span class="ot">&lt;-</span> ll <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"i"</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"loglikelihood"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">exp</span>(loglikelihood)) <span class="sc">|&gt;</span> </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">|&gt;</span> </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_mean_likelihood =</span> <span class="fu">mean</span>(likelihood) <span class="sc">|&gt;</span> <span class="fu">log</span>())</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  lppd <span class="ot">&lt;-</span> log_mu_l <span class="sc">|&gt;</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">lppd =</span> <span class="fu">sum</span>(log_mean_likelihood)) <span class="sc">|&gt;</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(lppd) </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -206.6458</code></pre>
</div>
</div>
<p>It’s a little easier to compute the effective number of parameters, <span class="math inline">\(p_\text{WAIC}\)</span>. First, let’s use a shorthand notation and define <span class="math inline">\(V(y_i)\)</span> as the variance in log-likelihood for the <span class="math inline">\(i^\text{th}\)</span> case across all <span class="math inline">\(S\)</span> samples. We define <span class="math inline">\(p_\text{WAIC}\)</span> as their sum</p>
<p><span class="math display">\[p_\text{WAIC} = \sum_{i=1}^N V (y_i).\]</span></p>
<p>We’ll save the pointwise results [i.e., <span class="math inline">\(V (y_i)\)</span>] as <code>v_i</code> and their sum [i.e., <span class="math inline">\(\sum_{i=1}^N V (y_i)\)</span>] as <code>pwaic</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>v_i <span class="ot">&lt;-</span> ll <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"i"</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"loglikelihood"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">|&gt;</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var_loglikelihood =</span> <span class="fu">var</span>(loglikelihood))</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>pwaic <span class="ot">&lt;-</span> v_i <span class="sc">|&gt;</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pwaic =</span> <span class="fu">sum</span>(var_loglikelihood)) <span class="sc">|&gt;</span> </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>pwaic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.042903</code></pre>
</div>
</div>
<p>Now we can finally plug our hand-made <code>lppd</code> and <code>pwaic</code> values into the formula <span class="math inline">\(-2 (\text{lppd} - p_\text{WAIC})\)</span> to compute the WAIC. Compare it to the value returned by the <strong>brms</strong> <code>waic()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (lppd <span class="sc">-</span> pwaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 421.3773</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b7.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 50 log-likelihood matrix.

          Estimate   SE
elpd_waic   -210.7  8.2
p_waic         4.0  1.5
waic         421.4 16.4

2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead. </code></pre>
</div>
</div>
<p>Before we move on, did you notice the <code>elpd_waic</code> row in the tibble returned by the<code>waic()</code> function? That value is the <code>lppd</code> minus the <code>pwaic</code>, but without multiplying the result by -2. E.g.,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>(lppd <span class="sc">-</span> pwaic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -210.6887</code></pre>
</div>
</div>
<p>Finally, here’s how we compute the WAIC standard error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">lppd   =</span> <span class="fu">pull</span>(log_mu_l, log_mean_likelihood),</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic =</span> <span class="fu">pull</span>(v_i, var_loglikelihood)) <span class="sc">|&gt;</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">waic_vec =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (lppd <span class="sc">-</span> p_waic)) <span class="sc">|&gt;</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">waic_se =</span> <span class="fu">sqrt</span>(n_cases <span class="sc">*</span> <span class="fu">var</span>(waic_vec)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  waic_se
    &lt;dbl&gt;
1    16.4</code></pre>
</div>
</div>
<p>If you’d like the pointwise values from <code>brms::waic()</code>, just index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b7.m)<span class="sc">$</span>pointwise <span class="sc">|&gt;</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_waic     p_waic     waic
[1,] -3.649019 0.02268800 7.298038
[2,] -4.024923 0.09432405 8.049846
[3,] -3.682755 0.02162366 7.365510
[4,] -3.997352 0.05956809 7.994703
[5,] -3.587876 0.01069652 7.175752
[6,] -3.740043 0.02135511 7.480087</code></pre>
</div>
</div>
</section>
</section>
<section id="comparing-cv-psis-and-waic" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="comparing-cv-psis-and-waic"><span class="header-section-number">7.4.3</span> Comparing CV, PSIS, and WAIC</h3>
<p>Here we update our <code>make_sim()</code> to accommodate the simulation for Figure 7.9.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>make_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, k, b_sigma) {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(<span class="at">n =</span> n_sim, </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expr =</span> <span class="fu">sim_train_test</span>(</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">N       =</span> n,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">k       =</span> k,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b_sigma =</span> b_sigma,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">WAIC    =</span> T,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">LOOCV   =</span> T, </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">LOOIC   =</span> T),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mc.cores =</span> n_cores)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviance_os =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">2</span>, ])),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviance_w  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">3</span>, ])),</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviance_p  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">11</span>, ])),</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">deviance_c  =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">19</span>, ])),</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">error_w     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">7</span>, ])),</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">error_p     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">15</span>, ])),</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">error_c     =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">20</span>, ]))</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Computing all three WAIC, PSIS-LOO-CV, and actual LOO-CV for many models across multiple combinations of <code>k</code> and <code>b_sigma</code> takes a long time–many hours. If you plan on running this code to replicate the figure on your own, take it for a spin first with <code>n_sim</code> set to something small like <code>10</code> to get a sense of the speed of your machine and the nature of the output. Alternatively, consider running the simulation for one combination of <code>k</code> and <code>b_sigma</code> at a time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">n       =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">k       =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>)) <span class="sc">|&gt;</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(n, k, b_sigma), make_sim)) <span class="sc">|&gt;</span> </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have our results saved as <code>s</code>, we’re ready to make our version of Figure 7.9. I’m going to deviate from McElreath’s version a bit and express the two average deviance plots on the left column into two columns. To my eyes, the reduced clutter makes it easier to track what I’m looking at.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(deviance_w<span class="sc">:</span>deviance_c) <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">criteria =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"deviance_w"</span>, <span class="st">"WAIC"</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"deviance_p"</span>, <span class="st">"PSIS"</span>, <span class="st">"CV"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n       =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">"N = "</span>, n), </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"N = "</span>, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_sigma =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">"sigma = "</span>, b_sigma),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> (<span class="fu">str_c</span>(<span class="st">"sigma = "</span>, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="sc">|&gt;</span> </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k)) <span class="sc">+</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> deviance_os, <span class="at">shape =</span> b_sigma),</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> criteria)) <span class="sc">+</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"number of parameters (k)"</span>,</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"average deviance"</span>) <span class="sc">+</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(n <span class="sc">~</span> b_sigma, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Although our specific values vary, the overall patterns in our simulations are well aligned with those in the text. The CV, PSIS, and WAIC all did a reasonable job approximating out-of-sample deviance. Now we’ll follow the same sensibilities to make our version of the right column of McElreath’s Figure 7.9.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(error_w<span class="sc">:</span>error_c) <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">criteria =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"error_w"</span>, <span class="st">"WAIC"</span>,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"error_p"</span>, <span class="st">"PSIS"</span>, <span class="st">"CV"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n       =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">"N = "</span>, n),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">str_c</span>(<span class="st">"N = "</span>, <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))),</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_sigma =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(<span class="st">"sigma = "</span>, b_sigma),</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> (<span class="fu">str_c</span>(<span class="st">"sigma = "</span>, <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>))))) <span class="sc">|&gt;</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k)) <span class="sc">+</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> criteria)) <span class="sc">+</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"number of parameters (k)"</span>,</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"average error (test deviance)"</span>) <span class="sc">+</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(n <span class="sc">~</span> b_sigma, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As in the text, the mean error was very similar across the three criteria. When <span class="math inline">\(N = 100\)</span>, they were nearly identical. When <span class="math inline">\(N = 20\)</span>, the WAIC was slightly better than the PSIS, which was slightly better than the CV. As we will see, the PSIS-LOO-CV has the advantage of a built-in diagnostic.</p>
</section>
</section>
<section id="model-comparison" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="model-comparison"><span class="header-section-number">7.5</span> Model comparison</h2>
<p>In the sections to follow, we’ll practice the model comparison approach, as opposed to the widely-used model selection approach.</p>
<section id="model-mis-selection" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="model-mis-selection"><span class="header-section-number">7.5.1</span> Model mis-selection</h3>
<blockquote class="blockquote">
<p>We must keep in mind the lessons of the previous chapters: Inferring cause and making predictions are different tasks. Cross-validation and WAIC aim to find models that make good predictions. They don’t solve any causal inference problem. If you select a model based only on expected predictive accuracy, you could easily be confounded. The reason is that backdoor paths do give us valid information about statistical associations in the data. So they can improve prediction, as long as we don’t intervene in the system and the future is like the past. But recall that our working definition of knowing a cause is that we can predict the consequences of an intervention. So a good PSIS or WAIC score does not in general indicate a good causal model. (p.&nbsp;226)</p>
</blockquote>
<p>If you have been following along and fitting the model on your own and saving them as external <code>.rds</code> files the way I have, you can use the <code>readRDS()</code> to retrieve them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"fits/b06.06.rds"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"fits/b06.07.rds"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"fits/b06.08.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With our <strong>brms</strong> paradigm, we also use the <code>waic()</code> function. Both the <strong>rethinking</strong> and <strong>brms</strong> packages get their functionality for the <code>waic()</code> and related functions from the <a href="https://CRAN.R-project.org/package=loo"><strong>loo</strong> package</a> <span class="citation" data-cites="R-loo vehtariPracticalBayesianModel2017 yaoUsingStackingAverage2018">(<a href="references.html#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">Vehtari et al., 2017</a>; <a href="references.html#ref-R-loo" role="doc-biblioref">Vehtari et al., 2022</a>; <a href="references.html#ref-yaoUsingStackingAverage2018" role="doc-biblioref">Yao et al., 2018</a>)</span>. Since the <code>brms::brm()</code> function fits the models with HMC, we don’t need to set a seed before calling <code>waic()</code> the way McElreath did with his <code>rethinking::quap()</code> model. We’re already drawing from the posterior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b6<span class="fl">.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 100 log-likelihood matrix.

          Estimate   SE
elpd_waic   -180.7  6.7
p_waic         3.4  0.5
waic         361.3 13.5</code></pre>
</div>
</div>
<p>The WAIC estimate and its standard error are on the bottom row. The <span class="math inline">\(p_\text{WAIC}\)</span>–what McElreath’s output called the <code>penalty</code>–and its SE are stacked atop that. And look there on the top row. Remember how we pointed out, above, that we get the WAIC by multiplying <code>(lppd - pwaic)</code> by -2? Well, if you just do the subtraction without multiplying the result by -2, you get the <code>elpd_waic</code>. File that away. It’ll become important in a bit. In McElreath’s output, that was called the <code>lppd</code>.</p>
<p>Following the version 2.8.0 update, part of the suggested workflow for using information criteria with <strong>brms</strong> (i.e., execute <code>?loo.brmsfit</code>) is to add the estimates to the <code>brm()</code> fit object itself. You do that with the <code>add_criterion()</code> function. Here’s how we’d do so with <code>b6.7</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With that in place, here’s how you’d extract the WAIC information from the fit object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 100 log-likelihood matrix.

          Estimate   SE
elpd_waic   -180.7  6.7
p_waic         3.4  0.5
waic         361.3 13.5</code></pre>
</div>
</div>
<p><em>Why would I go through all that trouble?</em>, you might ask. Well, two reasons. First, now your WAIC information is saved with all the rest of your fit output, which can be convenient. But second, it sets you up to use the <code>loo_compare()</code> function to compare models by their information criteria. To get a sense of that workflow, here we use <code>add_criterion()</code> for the next three models. Then we’ll use <code>loo_compare()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute and save the WAIC information for the next three models</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the WAIC estimates</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff
b6.7   0.0       0.0  
b6.8 -20.6       4.9  
b6.6 -22.3       5.8  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w, <span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
b6.7    0.0       0.0  -180.7       6.7          3.4    0.5     361.3   13.5 
b6.8  -20.6       4.9  -201.3       5.4          2.4    0.3     402.5   10.7 
b6.6  -22.3       5.8  -202.9       5.7          1.5    0.2     405.9   11.4 </code></pre>
</div>
</div>
<p>You don’t have to save those results as an object like we just did with <code>w</code>. But that’ll serve some pedagogical purposes in just a bit. With respect to the output, notice the <code>elpd_diff</code> column and the adjacent <code>se_diff</code> column. Those are our WAIC differences in the elpd metric. The models have been rank ordered from the highest (i.e., <code>b6.7</code>) to the highest (i.e., <code>b6.6</code>). The scores listed are the differences of <code>b6.7</code> minus the comparison model. Since <code>b6.7</code> is the comparison model in the top row, the values are naturally 0 (i.e., <span class="math inline">\(x - x = 0\)</span>). But now here’s another critical thing to understand: Since the <strong>brms</strong> version 2.8.0 update, WAIC and LOO differences are no longer reported in the <span class="math inline">\(-2 \times x\)</span> metric. Remember how multiplying <code>(lppd - pwaic)</code> by -2 is a historic artifact associated with the frequentist <span class="math inline">\(\chi^2\)</span> test? We’ll, the makers of the <strong>loo</strong> package aren’t fans and they no longer support the conversion.</p>
<p>So here’s the deal. The substantive interpretations of the differences presented in an <code>elpd_diff</code> metric will be the same as if presented in a WAIC metric. But if we want to compare our <code>elpd_diff</code> results to those in the text, we will have to multiply them by -2. And also, if we want the associated standard error in the same metric, we’ll need to multiply the <code>se_diff</code> column by 2. You wouldn’t multiply by -2 because that would return a negative standard error, which would be silly. Here’s a quick way to do those conversions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">waic_diff =</span> w[, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">se        =</span> w[, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     waic_diff        se
b6.7   0.00000  0.000000
b6.8  41.19024  9.834776
b6.6  44.53342 11.588276</code></pre>
</div>
</div>
<p>Now those match up reasonably well with the values in McElreath’s <code>dWAIC</code> and <code>dSE</code> columns.</p>
<p>One more thing. On page 227, and on many other pages to follow in the text, McElreath used the <code>rethinking::compare()</code> function to return a rich table of information about the WAIC information for several models. If we’re tricky, we can do something similar with <code>loo_compare</code>. To learn how, let’s peer further into the structure of our <code>w</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'compare.loo' num [1:3, 1:8] 0 -20.6 -22.27 0 4.92 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:3] "b6.7" "b6.8" "b6.6"
  ..$ : chr [1:8] "elpd_diff" "se_diff" "elpd_waic" "se_elpd_waic" ...</code></pre>
</div>
</div>
<p>When we used <code>print(w)</code>, a few code blocks earlier, it only returned two columns. It appears we actually have eight. We can see the full output with the <code>simplify = F</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(w, <span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
b6.7    0.0       0.0  -180.7       6.7          3.4    0.5     361.3   13.5 
b6.8  -20.6       4.9  -201.3       5.4          2.4    0.3     402.5   10.7 
b6.6  -22.3       5.8  -202.9       5.7          1.5    0.2     405.9   11.4 </code></pre>
</div>
</div>
<p>The results are quite analogous to those from <code>rethinking::compare()</code>. Again, the difference estimates are in the metric of the <span class="math inline">\(\text{elpd}\)</span>. But the interpretation is the same and we can convert them to the traditional information criteria metric with simple multiplication. As we’ll see later, this basic workflow also applies to the PSIS-LOO.</p>
<p>Okay, we’ve deviated a bit from the text. Let’s reign things back in and note that right after McElreath’s <strong>R</strong> code 7.26, he wrote: “PSIS will give you almost identical values. You can add <code>func=PSIS</code> to the <code>compare</code> call to check” (p.&nbsp;227). Our <code>brms::loo_compare()</code> function has a similar argument, but it’s called <code>criterion</code>. We set it to <code>criterion = "waic"</code> to compare the models by the WAIC. What McElreath is calling <code>func=PSIS</code>, we’d call <code>criterion = "loo"</code>. Either way, we’re asking the software the compare the models using leave-one-out cross-validation with Pareto-smoothed importance sampling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.6</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.7</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>b6<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the WAIC estimates</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff elpd_loo se_elpd_loo p_loo  se_p_loo looic  se_looic
b6.7    0.0       0.0  -180.7      6.7         3.4    0.5    361.3   13.5  
b6.8  -20.6       4.9  -201.3      5.4         2.5    0.3    402.5   10.7  
b6.6  -22.3       5.8  -202.9      5.7         1.5    0.2    405.9   11.4  </code></pre>
</div>
</div>
<p>Yep, the LOO values are very similar to those from the WAIC. Anyway, at the bottom of page 227, McElreath showed how to compute the standard error of the WAIC difference for models <code>m6.7</code> and <code>m6.8</code>. Here’s the procedure for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">"waic"</span>])</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">waic_b6.7 =</span> b6<span class="fl">.7</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">"waic"</span>],</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">waic_b6.8 =</span> b6<span class="fl">.8</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">"waic"</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> waic_b6<span class="fl">.7</span> <span class="sc">-</span> waic_b6<span class="fl">.8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_se =</span> <span class="fu">sqrt</span>(n <span class="sc">*</span> <span class="fu">var</span>(diff)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  diff_se
    &lt;dbl&gt;
1    9.83</code></pre>
</div>
</div>
<p>Since we used different estimation methods (HMC versus the quadratic approximation) via different software (<code>brms::brm()</code> versus <code>rethinking::quap()</code>), we shouldn’t be surprised our values are a little different from those in the text. But we’re in the ballpark, for sure. For us, this value was in the second row of the second column in our <code>w</code> object. But remember we have to multiply that value by 2 to convert it from the <span class="math inline">\(\text{elpd}\)</span> metric to that of the WAIC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.834776</code></pre>
</div>
</div>
<p>Presuming the difference is Gaussian distributed, here’s our 99% interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>(w[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> (w[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fl">2.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.61982 66.76066</code></pre>
</div>
</div>
<p>With our <strong>brms</strong> paradigm, we won’t get a comparison plot by inserting <code>loo_compare(b6.6, b6.7, b6.8, criterion = "waic")</code> within <code>plot()</code>. But with a little <code>[]</code> subsetting and light wrangling, we can convert the contents of our <code>w</code> object to a format suitable for plotting the WAIC estimates with <strong>ggplot2</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>w[, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"model_name"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_name =</span> <span class="fu">fct_reorder</span>(model_name, waic, <span class="at">.desc =</span> T)) <span class="sc">|&gt;</span> </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> waic, <span class="at">y =</span> model_name, </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> waic <span class="sc">-</span> se_waic, </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> waic <span class="sc">+</span> se_waic)) <span class="sc">+</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>], </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">5</span>], <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"My custom WAIC plot"</span>) <span class="sc">+</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>We don’t get the deviance points with this method, but that’s okay. Our primary focus is on the WAIC and its standard errors. Here’s how to hand-compute the standard error for the difference between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">waic_b6.6 =</span> <span class="fu">waic</span>(b6<span class="fl">.6</span>)<span class="sc">$</span>pointwise[, <span class="st">"waic"</span>],</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">waic_b6.8 =</span> <span class="fu">waic</span>(b6<span class="fl">.8</span>)<span class="sc">$</span>pointwise[, <span class="st">"waic"</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> waic_b6<span class="fl">.6</span> <span class="sc">-</span> waic_b6<span class="fl">.8</span>) <span class="sc">|&gt;</span> </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_se =</span> <span class="fu">sqrt</span>(n <span class="sc">*</span> <span class="fu">var</span>(diff)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  diff_se
    &lt;dbl&gt;
1    4.72</code></pre>
</div>
</div>
<p>Unlike <code>rethinking::compare()</code>, the <code>loo_compare()</code> function will not allow us to so easily pull this value by indexing with <code>@dSE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'compare.loo' num [1:3, 1:8] 0 -20.6 -22.27 0 4.92 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:3] "b6.7" "b6.8" "b6.6"
  ..$ : chr [1:8] "elpd_diff" "se_diff" "elpd_waic" "se_elpd_waic" ...</code></pre>
</div>
</div>
<p>However, if you really want that value, make a simple WAIC comparison between <code>b6.6</code> and <code>b6.8</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff
b6.8  0.0       0.0   
b6.6 -1.7       2.4   </code></pre>
</div>
</div>
<p>The value we’re looking for is in the second row of the <code>se_diff</code> column. But remember this is in the <span class="math inline">\(\text{elpd}\)</span> metric. Here’s the conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b6<span class="fl">.6</span>, b6<span class="fl">.8</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>)[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.715244</code></pre>
</div>
</div>
<p>Unlike <code>rethinking::compare()</code>, our <code>brms::loo_compare()</code> (even when we <code>print(simplify = T)</code>) does not contain a <code>weight</code> column. Don’t worry; we can still compute them. We’ll just have to do so with a different function. Before we do, here’s the equation they’re based on:</p>
<p><span class="math display">\[w_i = \frac{\exp(-0.5 \Delta_i)}{\sum_j \exp(-0.5 \Delta_j)},\]</span></p>
<p>where <span class="math inline">\(w_i\)</span> is the weight for the <span class="math inline">\(i^\text{th}\)</span> model and <span class="math inline">\(\Delta_i\)</span> is the difference between that model and the WAIC for the best one in the comparison set. If you want to get those WAIC weights, you can use the <code>brms::model_weights()</code> function like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(b6<span class="fl">.6</span>, b6<span class="fl">.7</span>, b6<span class="fl">.8</span>, <span class="at">weights =</span> <span class="st">"waic"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>b6.6 b6.7 b6.8 
   0    1    0 </code></pre>
</div>
</div>
<p>In his endnote #130, McElreath discussed how these WAIC weights can be used for model averaging. From the endnote, we read:</p>
<blockquote class="blockquote">
<p>The first edition had a section on model averaging, but the topic has been dropped in this edition to save space. The approach is really focused on prediction, not inference, and so it doesn’t fit the flow of the second edition. But it is an important approach. (p.&nbsp;565)</p>
</blockquote>
<p>A variety of approaches to model averaging are available with <strong>brms</strong> and I covered them in my <span class="citation" data-cites="kurzStatisticalRethinking2026">(<a href="references.html#ref-kurzStatisticalRethinking2026" role="doc-biblioref">2026b</a>)</span> ebook translation of the first edition of McElreath’s text.</p>
<section id="rethinking-waic-metaphors" class="level4" data-number="7.5.1.1">
<h4 data-number="7.5.1.1" class="anchored" data-anchor-id="rethinking-waic-metaphors"><span class="header-section-number">7.5.1.1</span> Rethinking: WAIC metaphors</h4>
<blockquote class="blockquote">
<p>Think of models as race horses. In any particular race, the best horse may not win. But it’s more likely to win than is the worst horse. And when the winning horse finishes in half the time of the second-place horse, you can be pretty sure the winning horse is also the best. But if instead it’s a photo-finish, with a near tie between first and second place, then it is much harder to be confident about which is the best horse. (p.&nbsp;230)</p>
</blockquote>
</section>
</section>
<section id="outliers-and-other-illusions" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="outliers-and-other-illusions"><span class="header-section-number">7.5.2</span> Outliers and other illusions</h3>
<p>Time to bring back the <code>WaffleDivorce</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce <span class="sc">|&gt;</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(Divorce),</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">m =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(Marriage),</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> rethinking<span class="sc">::</span><span class="fu">standardize</span>(MedianAgeMarriage))</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(WaffleDivorce)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Refit the divorce models from <a href="05.html#sec-Spurious-associations" class="quarto-xref"><span>Section 5.1</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> a,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> T,</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b05.01"</span>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m,</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b05.02"</span>)</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> a,</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b05.03"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compute and save the LOO estimates for each.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.1</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now compare the models by the PSIS-LOO-CV.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.1</span>, b5<span class="fl">.2</span>, b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
b5.1   0.0       0.0   -62.8      6.4         3.6   1.7    125.6  12.7   
b5.3  -1.1       0.4   -63.9      6.4         4.8   1.9    127.8  12.9   
b5.2  -6.8       4.6   -69.6      5.0         2.9   0.9    139.3   9.9   </code></pre>
</div>
</div>
<p>Like in the text, our <code>b5.1</code> has the best LOO estimate, but only by a little bit when compared to <code>b5.3</code>. Unlike McElreath reported in the text, we did not get a warning message from <code>loo_compare()</code>. Let’s investigate more carefully with the <code>loo()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b5<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 50 log-likelihood matrix.

         Estimate   SE
elpd_loo    -63.9  6.4
p_loo         4.8  1.9
looic       127.8 12.9
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.7, 1.4]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<p>None of the observations were in the <code>(bad)</code> or <code>(very bad)</code> ranges. One of the values, however, was a little on the high side. By opening the <strong>loo</strong> package directly, we gain access to the <code>pareto_k_ids()</code> function, which will help us identify which observation crossed out of the <code>(good)</code> range into the <code>(ok)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(b5<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<p>The number <code>13</code> refers to the corresponding row in the data used to fit the model. We can access that row directly with the <code>dplyr::slice()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Location<span class="sc">:</span>Loc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Location Loc
1    Idaho  ID</code></pre>
</div>
</div>
<p>Here we subset the 13<sup>th</sup> cell in the <code>loo::pareto_k_values()</code> output to see what that value was.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(b5<span class="fl">.3</span>))[<span class="dv">13</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6034469</code></pre>
</div>
</div>
<p>Alternatively, we could have extracted that value from our <code>b5.3</code> fit object like so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k[<span class="dv">13</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6034469</code></pre>
</div>
</div>
<p>0.6 is a little high, but not high enough to cause <code>loo()</code> to return a warning message. Once a Pareto <span class="math inline">\(k\)</span> value crosses the 0.7 threshold, though, the <strong>loo</strong> package will bark. Before we make our version of Figure 7.10, we’ll want to compute the WAIC for <code>b5.3</code>. That will give us access to the <span class="math inline">\(p_\text{WAIC}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">"waic"</span>, <span class="at">file =</span> <span class="st">"fits/b05.03"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’re ready to make our version of Figure 7.10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pareto_k =</span> b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_waic   =</span> b5<span class="fl">.3</span><span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">"p_waic"</span>],</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">Loc      =</span> <span class="fu">pull</span>(d, Loc)) </span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>l <span class="sc">|&gt;</span> </span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">"ID"</span>)) <span class="sc">+</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">"ID"</span>)) <span class="sc">+</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> l <span class="sc">|&gt;</span> <span class="fu">filter</span>(p_waic <span class="sc">&gt;</span> <span class="fl">0.5</span>),</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.03</span>, <span class="at">label =</span> Loc),</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Gaussian model (b5.3)"</span>) <span class="sc">+</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>For both the Pareto <span class="math inline">\(k\)</span> and the <span class="math inline">\(p_\text{WAIC}\)</span>, our values are not as extreme as those McElreath reported in the text. I’m not sure if this is a consequence of us using HMC or due to recent algorithmic changes for the Stan/<strong>loo</strong> teams. But at least the overall pattern is the same. Idaho is the most extreme/influential case.</p>
<p>In the text (p.&nbsp;232), McElreath reported the effective number of parameters for <code>b5.3</code> was nearly 6. We can look at this with the <code>waic()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b5<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 50 log-likelihood matrix.

          Estimate   SE
elpd_waic    -63.8  6.4
p_waic         4.7  1.9
waic         127.6 12.8

2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead. </code></pre>
</div>
</div>
<p>Our <span class="math inline">\(p_\text{WAIC}\)</span> was about 4.7, which is still a little high due to Idaho but not quite as high as in the text. There is some concern that Idaho is putting us at risk of overfitting due to the large influence it has on the posterior.</p>
<blockquote class="blockquote">
<p>What can be done about this? There is a tradition of dropping outliers. People sometimes drop outliers even before a model is fit, based only on standard deviations from the mean outcome value. You should never do that–a point can only be unexpected and highly influential in light of a model. After you fit a model, the picture changes. If there are only a few outliers, and you are sure to report results both with and without them, dropping outliers might be okay. But if there are several outliers and we really need to model them, what then?</p>
<p>A basic problem here is that the Gaussian error model is easily surprised. (p.&nbsp;232)</p>
</blockquote>
<p>This surprise has to do with the thinness of its tails relative to those of the Student’s <span class="math inline">\(t\)</span>-distribution. We can get a sense of this with Figure 7.11.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">6</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gaussian    =</span> <span class="fu">dnorm</span>(x),</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Student-t</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dstudent</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>x,</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"likelihood"</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"density"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">minus log density</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="fu">log</span>(density)) <span class="sc">|&gt;</span> </span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">"density"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> likelihood, <span class="at">color =</span> likelihood)) <span class="sc">+</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">6</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"value"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>I’m a little baffled as to why our curves don’t quite match up with those in the text. The Gaussian curves were made using the <code>dnorm()</code> function with the default settings, which are <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span>. The Student-<span class="math inline">\(t\)</span> curves were made with McElreath’s <code>rethinking::dstudent()</code>function with the default settings, which are <span class="math inline">\(\operatorname{Student-t}(2, 0, 1)\)</span>–you get the same results is you use <code>dt(x, df = 2)</code>. Discrepancies aside, the main point in the text still stands. The <span class="math inline">\(t\)</span> distribution, especially as <span class="math inline">\(\nu \rightarrow 1\)</span>, has thicker tails than the Gaussian. As a consequence, it is more robust to extreme values.</p>
<p>The <strong>brms</strong> package will allow us to fit a Student <span class="math inline">\(t\)</span> model. Just set <code>family = student</code>. We are at liberty to estimate <span class="math inline">\(\nu\)</span> along with the other parameters in the model or to set it to a constant. We’ll follow McElreath and fix <code>nu = 2</code>. Note that <strong>brms</strong> syntax requires we do so within a <code>bf()</code> statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(d <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> a, <span class="at">nu =</span> <span class="dv">2</span>),</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b05.03t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b5<span class="fl">.3</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: student 
  Links: mu = identity 
Formula: d ~ 1 + m + a 
         nu = 2
   Data: d (Number of observations: 50) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.02      0.10    -0.17     0.21 1.00     3490     3090
m             0.05      0.20    -0.33     0.47 1.00     3164     3040
a            -0.70      0.15    -1.00    -0.39 1.00     3076     2596

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.58      0.09     0.43     0.78 1.00     4205     3106
nu        2.00      0.00     2.00     2.00   NA       NA       NA

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Here we use the <code>add_criterion()</code> function compute both the LOO-CV and the WAIC and add them to the model fit object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>b5<span class="fl">.3</span>t <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we might remake the plot from Figure 7.10, this time based on the <span class="math inline">\(t\)</span> model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pareto_k =</span> b5<span class="fl">.3</span>t<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_waic   =</span> b5<span class="fl">.3</span>t<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">"p_waic"</span>],</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">Loc      =</span> <span class="fu">pull</span>(d, Loc)) </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>l <span class="sc">|&gt;</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">"ID"</span>)) <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">"ID"</span>)) <span class="sc">+</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> l <span class="sc">|&gt;</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"ME"</span>)),</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.005</span>, <span class="at">label =</span> Loc),</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>)]) <span class="sc">+</span></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Student-t model (b5.3t)"</span>) <span class="sc">+</span></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>The high points in both the Pareto <span class="math inline">\(k\)</span> and <span class="math inline">\(p_\text{WAIC}\)</span> are much smaller and both ID and ME are now closer to the center of the bivariate distribution. We can formally compare the models with the WAIC and the LOO.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="st">"waic"</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic  se_waic
b5.3    0.0       0.0   -63.8       6.4          4.7    1.9     127.6  12.8  
b5.3t  -2.7       3.0   -66.5       5.8          6.2    1.0     133.0  11.5  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(b5<span class="fl">.3</span>, b5<span class="fl">.3</span>t, <span class="at">criterion =</span> <span class="st">"loo"</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo looic se_looic
b5.3    0.0       0.0   -63.9      6.4         4.8   1.9    127.8  12.9   
b5.3t  -2.6       3.0   -66.5      5.8         6.2   1.0    132.9  11.5   </code></pre>
</div>
</div>
<p>For both criteria, the standard error for the difference was about the same size as the difference itself. This suggests the models were close and hard to distinguish with respect to their fit to the data. This will not always be the case.</p>
<p>Just for kicks and giggles, let’s compare the parameter summaries for the two models in a coefficient plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">as_draws_df</span>(b5<span class="fl">.3</span>),</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_draws_df</span>(b5<span class="fl">.3</span>t)) <span class="sc">|&gt;</span> </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Gaussian (b5.3)"</span>, <span class="st">"Student-t (b5.3t)"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">|&gt;</span> </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"b_Intercept"</span>, <span class="st">"b_a"</span>, <span class="st">"b_m"</span>, <span class="st">"sigma"</span>),</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta[a]"</span>, <span class="st">"beta[m]"</span>, <span class="st">"sigma"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> fit, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">6</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"posterior"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">color =</span> <span class="st">"transparent"</span>),</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>Overall, the coefficients are very similar between the two models. The most notable difference is in <span class="math inline">\(\sigma\)</span>. This is, in part, because <span class="math inline">\(\sigma\)</span> has a slightly different meaning for Student-<span class="math inline">\(t\)</span> models than it does for the Gaussian. For both, we can refer to <span class="math inline">\(\sigma\)</span> as the <em>scale</em> parameter, with is a measure of spread or variability around the mean. However, the scale is the same thing as the standard deviation only for the Gaussian. Kruschke walked this out nicely:</p>
<blockquote class="blockquote">
<p>It is important to understand that the scale parameter <span class="math inline">\(\sigma\)</span> in the <span class="math inline">\(t\)</span> distribution is not the standard deviation of the distribution. (Recall that the standard deviation is the square root of the variance, which is the expected value of the squared deviation from the mean, as defined back in Equation 4.8, p.&nbsp;86.) The standard deviation is actually larger than <span class="math inline">\(\sigma\)</span> because of the heavy tails. In fact, when <span class="math inline">\(\nu\)</span> drops below 2 (but is still <span class="math inline">\(\geq 1\)</span>), the standard deviation of the mathematical <span class="math inline">\(t\)</span> distribution goes to infinity. <span class="citation" data-cites="kruschkeDoingBayesianData2015">(<a href="references.html#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015, p. 159</a>)</span></p>
</blockquote>
<p>The variance for <span class="math inline">\(\operatorname{Student-t}(\nu, 0, 1)\)</span> is</p>
<p><span class="math display">\[\frac{\nu}{\nu-2} \text{ for }  \nu &gt;2, \;\;\; \infty \text{ for } 1 &lt; \nu \leq 2,\]</span></p>
<p>and the standard deviation is the square of that. To give a sense of how that formula works, here are the standard deviation values when <span class="math inline">\(\nu\)</span> ranges from 2.1 to 20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the annotation</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nu    =</span> <span class="fu">c</span>(<span class="fl">1.35</span>, <span class="dv">20</span>),</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd    =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fl">2.1</span> <span class="sc">/</span> (<span class="fl">2.1</span> <span class="sc">-</span> <span class="dv">2</span>)), <span class="fl">0.875</span>),</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">angle =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">0</span>),</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"asymptote"</span>)</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">nu =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">2.1</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var =</span> nu <span class="sc">/</span> (nu <span class="sc">-</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd =</span> <span class="fu">sqrt</span>(var)) <span class="sc">|&gt;</span> </span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> nu, <span class="at">y =</span> sd)) <span class="sc">+</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">angle =</span> angle, <span class="at">hjust =</span> hjust),</span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(nu), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="fu">expression</span>(standard<span class="sc">~</span>deviation<span class="sc">*</span><span class="st">", "</span><span class="sc">*</span><span class="er">~</span><span class="fu">sqrt</span>(nu<span class="sc">/</span>(nu<span class="dv">-2</span>))),</span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">expression</span>(Student<span class="sc">-</span><span class="fu">t</span>(nu<span class="sc">*</span><span class="st">', '</span><span class="sc">*</span><span class="dv">0</span><span class="sc">*</span><span class="st">', '</span><span class="sc">*</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>As <span class="math inline">\(\nu \rightarrow \infty\)</span>, the standard deviation approaches the scale, <span class="math inline">\(\sigma\)</span>. We’ll have more practice with robust Student’s <span class="math inline">\(t\)</span> regression later on. In the mean time, you might check out chapters <a href="https://solomon.quarto.pub/dbda2/16.html#sec-Outliers-and-robust-estimation-The-t-distribution">16</a>, <a href="https://solomon.quarto.pub/dbda2/17.html#sec-Robust-linear-regression">17</a>, <a href="https://solomon.quarto.pub/dbda2/18.html#sec-The-model-and-implementation">18</a>, <a href="https://solomon.quarto.pub/dbda2/19.html#the-two-group-case">19</a>, and <a href="https://solomon.quarto.pub/dbda2/20.html#heterogeneous-variances-and-robustness-against-outliers">20</a> from my <span class="citation" data-cites="kurzDoingBayesianDataAnalysis2026">(<a href="references.html#ref-kurzDoingBayesianDataAnalysis2026" role="doc-biblioref">2026a</a>)</span> ebook translation of Kruschke’s text. I’ve also blogged on using the robust Student’s <span class="math inline">\(t\)</span> for <a href="https://solomonkurz.netlify.app/blog/2019-02-02-robust-linear-regression-with-student-s-t-distribution/">regression</a> and <a href="https://solomonkurz.netlify.app/blog/2019-02-10-bayesian-robust-correlations-with-brms-and-why-you-should-love-student-s-t/">correlations</a>. <span class="citation" data-cites="gelmanRegressionOtherStories2020">Gelman et al. (<a href="references.html#ref-gelmanRegressionOtherStories2020" role="doc-biblioref">2020</a>)</span> covered robust Student’s <span class="math inline">\(t\)</span> regression in Section 15.6, too.</p>
<section id="rethinking-the-curse-of-tippecanoe" class="level4" data-number="7.5.2.1">
<h4 data-number="7.5.2.1" class="anchored" data-anchor-id="rethinking-the-curse-of-tippecanoe"><span class="header-section-number">7.5.2.1</span> Rethinking: The Curse of Tippecanoe</h4>
<blockquote class="blockquote">
<p>One concern with model comparison is, if we try enough combinations and transformations of predictors, we might eventually find a model that fits any sample very well. But this fit will be badly overfit, unlikely to generalize….</p>
<p>Fiddling with and constructing many predictor variables is a great way to find coincidences, but not necessarily a great way to evaluate hypotheses. However, fitting many possible models isn’t always a dangerous idea, provided some judgment is exercised in weeding down the list of variables at the start. There are two scenarios in which this strategy appears defensible. First, sometimes all one wants to do is explore a set of data, because there are no clear hypotheses to evaluate. This is rightly labeled pejoratively as <strong>data dredging</strong>, when one does not admit to it. But when used together with model averaging, and freely admitted, it can be a way to stimulate future investigation. Second, sometimes we need to convince an audience that we have tried all of the combinations of predictors, because none of the variables seem to help much in prediction. (p.&nbsp;234, <strong>emphasis</strong> in the original)</p>
</blockquote>
</section>
</section>
</section>
<section id="summary-bonus-r2-talk" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="summary-bonus-r2-talk"><span class="header-section-number">7.6</span> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</h2>
<p>At the beginning of the chapter (pp.&nbsp;193–201), McElreath introduced <span class="math inline">\(R^2\)</span> as a popular way to assess the variance explained in a model. He pooh-poohed it because of its tendency to overfit. It’s also limited in that it doesn’t generalize well outside of the single-level Gaussian framework, which will be a big deal for us starting in <a href="10.html" class="quarto-xref"><span>Chapter 10</span></a>. However, if you should find yourself in a situation where <span class="math inline">\(R^2\)</span> suits your purposes, the <strong>brms</strong> <code>bayes_R2()</code> function might be of use. Simply feeding a model <code>brm()</code> fit object into <code>bayes_R2()</code> will return the posterior mean, <span class="math inline">\(\textit{SD}\)</span>, and 95% intervals. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayes_R2</span>(b5<span class="fl">.3</span>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate Est.Error  Q2.5 Q97.5
R2    0.331     0.088 0.142  0.48</code></pre>
</div>
</div>
<p>With just a little data processing, you can get a tibble table of each of models’ <span class="math inline">\(R^2\)</span> ‘Estimate’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>), </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(b5<span class="fl">.2</span>), </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(b5<span class="fl">.3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model                   =</span> <span class="fu">c</span>(<span class="st">"b5.1"</span>, <span class="st">"b5.2"</span>, <span class="st">"b5.3"</span>),</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">r_square_posterior_mean =</span> <span class="fu">round</span>(Estimate, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, r_square_posterior_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     model r_square_posterior_mean
R2    b5.1                   0.327
R2.1  b5.2                   0.131
R2.2  b5.3                   0.331</code></pre>
</div>
</div>
<p>If you want the full distribution of the <span class="math inline">\(R^2\)</span>, you’ll need to add a <code>summary = F</code> argument. Note how this returns a numeric vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>r2_b5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="at">summary =</span> F)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>r2_b5<span class="fl">.1</span> <span class="sc">|&gt;</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1] 0.254 0.223 0.501 0.429 0.185 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr "R2"</code></pre>
</div>
</div>
<p>If you want to use these in <strong>ggplot2</strong>, you’ll need to put them in tibbles or data frames. Here we do so for two of our model fits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">bayes_R2</span>(b5<span class="fl">.1</span>, <span class="at">summary =</span> F),</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">bayes_R2</span>(b5<span class="fl">.2</span>, <span class="at">summary =</span> F)) <span class="sc">|&gt;</span> </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">"b5."</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>r2 <span class="sc">|&gt;</span> </span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b5<span class="fl">.1</span>),</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> b5<span class="fl">.2</span>),</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.34</span>), <span class="at">y =</span> <span class="fl">3.5</span>, </span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"b5.2"</span>, <span class="st">"b5.1"</span>), </span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>), <span class="at">family =</span> <span class="st">"Courier"</span>) <span class="sc">+</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>distributions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>If you do your work in a field where folks use <span class="math inline">\(R^2\)</span> change, you might do that with a simple difference score. Here’s the <span class="math inline">\(\Delta R^2\)</span> plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="sc">|&gt;</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> b5<span class="fl">.2</span> <span class="sc">-</span> b5<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> <span class="fl">0.95</span>,</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">5</span>], </span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">carto_pal</span>(<span class="dv">7</span>, <span class="st">"BurgYl"</span>)[<span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(Delta<span class="sc">*</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">expression</span>(Turns<span class="sc">~</span>out<span class="sc">~</span>b5<span class="fl">.2</span><span class="sc">~</span>had<span class="sc">~</span>a<span class="sc">~</span>lower<span class="sc">~</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>than<span class="sc">~</span>b5<span class="fl">.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>The <strong>brms</strong> package did not get these <span class="math inline">\(R^2\)</span> values by traditional method used in, say, ordinary least squares estimation. To learn more about how the Bayesian <span class="math inline">\(R^2\)</span> sausage is made, check out the paper by <span class="citation" data-cites="gelmanRsquaredBayesianRegression2019">Gelman et al. (<a href="references.html#ref-gelmanRsquaredBayesianRegression2019" role="doc-biblioref">2019</a>)</span>, <a href="https://doi.org/10.1080/00031305.2018.1549100"><em>R-squared for Bayesian regression models</em></a>.</p>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Ventura 13.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] loo_2.9.0.9000       rethinking_2.42      posterior_1.6.1.9000 cmdstanr_0.9.0       patchwork_1.3.2      tidybayes_3.0.7     
 [7] brms_2.23.0          Rcpp_1.1.0           ggrepel_0.9.6        rcartocolor_2.1.2    lubridate_1.9.4      forcats_1.0.1       
[13] stringr_1.6.0        dplyr_1.1.4          purrr_1.2.1          readr_2.1.5          tidyr_1.3.2          tibble_3.3.1        
[19] ggplot2_4.0.1        tidyverse_2.0.0     

loaded via a namespace (and not attached):
 [1] svUnit_1.0.8            tidyselect_1.2.1        viridisLite_0.4.2       farver_2.1.2            S7_0.2.1               
 [6] fastmap_1.2.0           TH.data_1.1-4           tensorA_0.36.2.1        digest_0.6.39           estimability_1.5.1     
[11] timechange_0.3.0        lifecycle_1.0.5         StanHeaders_2.36.0.9000 processx_3.8.6          survival_3.8-3         
[16] magrittr_2.0.4          compiler_4.5.1          rlang_1.1.7             tools_4.5.1             utf8_1.2.6             
[21] yaml_2.3.12             knitr_1.51              labeling_0.4.3          bridgesampling_1.2-1    htmlwidgets_1.6.4      
[26] curl_7.0.0              pkgbuild_1.4.8          plyr_1.8.9              RColorBrewer_1.1-3      BH_1.90.0-1            
[31] abind_1.4-8             multcomp_1.4-29         withr_3.0.2             grid_4.5.1              stats4_4.5.1           
[36] xtable_1.8-4            inline_0.3.21           emmeans_1.11.2-8        scales_1.4.0            MASS_7.3-65            
[41] cli_3.6.5               mvtnorm_1.3-3           rmarkdown_2.30          generics_0.1.4          RcppParallel_5.1.11-1  
[46] rstudioapi_0.17.1       reshape2_1.4.5          tzdb_0.5.0              rstan_2.36.0.9000       splines_4.5.1          
[51] bayesplot_1.15.0.9000   matrixStats_1.5.0       vctrs_0.7.0             V8_8.0.1                Matrix_1.7-3           
[56] sandwich_3.1-1          jsonlite_2.0.0          callr_3.7.6             arrayhelpers_1.1-0      hms_1.1.4              
[61] ggdist_3.3.3            glue_1.8.0              ps_1.9.1                codetools_0.2-20        distributional_0.5.0   
[66] shape_1.4.6.1           stringi_1.8.7           gtable_0.3.6            QuickJSR_1.8.1          pillar_1.11.1          
[71] htmltools_0.5.9         Brobdingnag_1.2-9       RcppEigen_0.3.4.0.2     R6_2.6.1                evaluate_1.0.5         
[76] lattice_0.22-7          backports_1.5.0         rstantools_2.5.0.9000   coda_0.19-4.1           gridExtra_2.3          
[81] nlme_3.1-168            checkmate_2.3.3         xfun_0.55               zoo_1.8-14              pkgconfig_2.0.3        </code></pre>
</div>
</div>
</section>
<section id="comments" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comments">Comments</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-akaike1998information" class="csl-entry" role="listitem">
Akaike, H. (1998). Information theory and an extension of the maximum likelihood principle. In <em>Selected papers of <span>Hirotugu Akaike</span></em> (pp. 199–213). Springer. <a href="https://www.springer.com/gp/book/9780387983554">https://www.springer.com/gp/book/9780387983554</a>
</div>
<div id="ref-betancourtBayesSparse2018" class="csl-entry" role="listitem">
Betancourt, M. (2018). <em>Bayes sparse regression</em>. <a href="https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html">https://betanalpha.github.io/assets/case_studies/bayes_sparse_regression.html</a>
</div>
<div id="ref-brms2022RM" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022a). <em><span class="nocase">brms</span> reference manual, <span>Version</span> 2.18.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a>
</div>
<div id="ref-Bürkner2022Distributional" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022b). <em>Estimating distributional models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html">https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html</a>
</div>
<div id="ref-Bürkner2022Define" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022c). <em>Define custom response distributions with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html">https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html</a>
</div>
<div id="ref-carvalho2009handling" class="csl-entry" role="listitem">
Carvalho, C. M., Polson, N. G., &amp; Scott, J. G. (2009). Handling sparsity via the horseshoe. <em>Artificial Intelligence and Statistics</em>, 73–80. <a href="http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf">http://proceedings.mlr.press/v5/carvalho09a/carvalho09a.pdf</a>
</div>
<div id="ref-cover2006elements" class="csl-entry" role="listitem">
Cover, T. M., &amp; Thomas, J. A. (2006). <em>Elements of information theory</em> (2nd Edition). John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Elements+of+Information+Theory%2C+2nd+Edition-p-9780471241959">https://www.wiley.com/en-us/Elements+of+Information+Theory%2C+2nd+Edition-p-9780471241959</a>
</div>
<div id="ref-derooijCrossvalidationMethodEvery2020" class="csl-entry" role="listitem">
de Rooij, M., &amp; Weeda, W. (2020). Cross-validation: <span>A</span> method every psychologist should know. <em>Advances in Methods and Practices in Psychological Science</em>, <em>3</em>(2), 248–263. <a href="https://doi.org/10.1177/2515245919898466">https://doi.org/10.1177/2515245919898466</a>
</div>
<div id="ref-gelmanRsquaredBayesianRegression2019" class="csl-entry" role="listitem">
Gelman, A., Goodrich, B., Gabry, J., &amp; Vehtari, A. (2019). R-squared for <span>Bayesian</span> regression models. <em>The American Statistician</em>, <em>73</em>(3), 307–309. <a href="https://doi.org/10.1080/00031305.2018.1549100">https://doi.org/10.1080/00031305.2018.1549100</a>
</div>
<div id="ref-gelmanRegressionOtherStories2020" class="csl-entry" role="listitem">
Gelman, A., Hill, J., &amp; Vehtari, A. (2020). <em>Regression and other stories</em>. Cambridge University Press. <a href="https://doi.org/10.1017/9781139161879">https://doi.org/10.1017/9781139161879</a>
</div>
<div id="ref-hastie2009elements" class="csl-entry" role="listitem">
Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The elements of statistical learning: <span>Data</span> mining, inference, and prediction</em>. Springer Science &amp; Business Media. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry" role="listitem">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. Academic Press. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-kullbackInformationSufficiency1951" class="csl-entry" role="listitem">
Kullback, S., &amp; Leibler, R. A. (1951). On information and sufficiency. <em>Annals of Mathematical Statistics</em>, <em>22</em>(1), 79–86. <a href="https://doi.org/10.1214/aoms/1177729694">https://doi.org/10.1214/aoms/1177729694</a>
</div>
<div id="ref-kurzDoingBayesianDataAnalysis2026" class="csl-entry" role="listitem">
Kurz, A. S. (2026a). <em>Doing <span>Bayesian</span> data analysis in brms and the tidyverse</em> (Version 1.3.0). <a href="https://solomon.quarto.pub/dbda2/">https://solomon.quarto.pub/dbda2/</a>
</div>
<div id="ref-kurzStatisticalRethinking2026" class="csl-entry" role="listitem">
Kurz, A. S. (2026b). <em>Statistical rethinking with brms, <span class="nocase">ggplot2</span>, and the tidyverse</em> (version 1.4.0). <a href="https://solomon.quarto.pub/sr/">https://solomon.quarto.pub/sr/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-R-rcartocolor" class="csl-entry" role="listitem">
Nowosad, J. (2019). <em><span class="nocase">rcartocolor</span>: ’<span>CARTOColors</span>’ palettes</em>. <a href="https://CRAN.R-project.org/package=rcartocolor">https://CRAN.R-project.org/package=rcartocolor</a>
</div>
<div id="ref-shannonMathematicalTheoryCommunication1948" class="csl-entry" role="listitem">
Shannon, C. E. (1948). A mathematical theory of communication. <em>Bell System Technical Journal</em>, <em>27</em>(3), 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>
</div>
<div id="ref-spiegelhalterBayesianMeasuresModel2002" class="csl-entry" role="listitem">
Spiegelhalter, D. J., Best, N. G., Carlin, B. P., &amp; Linde, A. V. D. (2002). Bayesian measures of model complexity and fit. <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>, <em>64</em>(4), 583–639. <a href="https://doi.org/10.1111/1467-9868.00353">https://doi.org/10.1111/1467-9868.00353</a>
</div>
<div id="ref-R-loo" class="csl-entry" role="listitem">
Vehtari, A., Gabry, J., Magnusson, M., Yao, Y., &amp; Gelman, A. (2022). <em><span class="nocase">loo</span>: <span>Efficient</span> leave-one-out cross-validation and <span>WAIC</span> for bayesian models</em>. <a href="https://CRAN.R-project.org/package=loo/">https://CRAN.R-project.org/package=loo/</a>
</div>
<div id="ref-vehtariPracticalBayesianModel2017" class="csl-entry" role="listitem">
Vehtari, A., Gelman, A., &amp; Gabry, J. (2017). Practical <span>Bayesian</span> model evaluation using leave-one-out cross-validation and <span>WAIC</span>. <em>Statistics and Computing</em>, <em>27</em>(5), 1413–1432. <a href="https://doi.org/10.1007/s11222-016-9696-4">https://doi.org/10.1007/s11222-016-9696-4</a>
</div>
<div id="ref-wassersteinASAStatementPvalues2016" class="csl-entry" role="listitem">
Wasserstein, R. L., &amp; Lazar, N. A. (2016). The <span>ASA</span> statement on p-values: <span>Context</span>, process, and purpose. <em>The American Statistician</em>, <em>70</em>(2), 129–133. <a href="https://doi.org/10.1080/00031305.2016.1154108">https://doi.org/10.1080/00031305.2016.1154108</a>
</div>
<div id="ref-watanabeAsymptoticEquivalenceBayes2010" class="csl-entry" role="listitem">
Watanabe, S. (2010). Asymptotic equivalence of <span>Bayes</span> cross validation and widely applicable information criterion in singular learning theory. <em>Journal of Machine Learning Research</em>, <em>11</em>(116), 3571–3594. <a href="http://jmlr.org/papers/v11/watanabe10a.html">http://jmlr.org/papers/v11/watanabe10a.html</a>
</div>
<div id="ref-wilksLargesampleDistributionLikelihood1938" class="csl-entry" role="listitem">
Wilks, S. S. (1938). The large-sample distribution of the likelihood ratio for testing composite hypotheses. <em>The Annals of Mathematical Statistics</em>, <em>9</em>(1), 60–62. <a href="https://doi.org/10.1214/aoms/1177732360">https://doi.org/10.1214/aoms/1177732360</a>
</div>
<div id="ref-yaoUsingStackingAverage2018" class="csl-entry" role="listitem">
Yao, Y., Vehtari, A., Simpson, D., &amp; Gelman, A. (2018). Using stacking to average <span>Bayesian</span> predictive distributions (with discussion). <em>Bayesian Analysis</em>, <em>13</em>(3), 917–1007. <a href="https://doi.org/10.1214/17-BA1091">https://doi.org/10.1214/17-BA1091</a>
</div>
<div id="ref-yarkoniChoosingPredictionExplanation2017" class="csl-entry" role="listitem">
Yarkoni, T., &amp; Westfall, J. (2017). Choosing prediction over explanation in psychology: <span>Lessons</span> from machine learning. <em>Perspectives on Psychological Science : A Journal of the Association for Psychological Science</em>, <em>12</em>(6), 1100–1122. <a href="https://doi.org/10.1177/1745691617693393">https://doi.org/10.1177/1745691617693393</a>
</div>
<div id="ref-zhangCrossvalidationSelectingModel2015" class="csl-entry" role="listitem">
Zhang, Y., &amp; Yang, Y. (2015). Cross-validation for selecting a model selection procedure. <em>Journal of Econometrics</em>, <em>187</em>(1), 95–112. <a href="https://doi.org/10.1016/j.jeconom.2015.02.006">https://doi.org/10.1016/j.jeconom.2015.02.006</a>
</div>
</div>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/solomon\.quarto\.pub\/sr2\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkxNjE5MTg0MTE=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOCaaty84C1AJZ";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06.html" class="pagination-link" aria-label="The Haunted DAG &amp; The Causal Terror">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Haunted DAG &amp; The Causal Terror</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08.html" class="pagination-link" aria-label="Conditional Manatees">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Manatees</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>