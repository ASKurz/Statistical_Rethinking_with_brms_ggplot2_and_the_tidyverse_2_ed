<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Monsters and Mixtures | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Monsters and Mixtures | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Monsters and Mixtures | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-08-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="god-spiked-the-integers.html"/>
<link rel="next" href="models-with-memory.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summarybonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del>Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.1</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>9.4.2</b> Estimation.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a><ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a><ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a><ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a><ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a><ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monsters-and-mixtures" class="section level1">
<h1><span class="header-section-number">12</span> Monsters and Mixtures</h1>
<blockquote>
<p>Many monsters are hybrids. Many statistical models are too. This chapter is about constructing likelihood and link functions by piecing together the simpler components of previous chapters. Like legendary monsters, these hybrid likelihoods contain pieces of other model types. Endowed with some properties of each piece, they help us model outcome variables with inconvenient, but common, properties….</p>
</blockquote>
<blockquote>
<p>We’ll consider three common and useful examples. The first are models for handling <strong>over-dispersion</strong>. These models extend the binomial and Poisson models of the previous chapter to cope a bit with unmeasured sources of variation. The second type is a family of <strong>zero-inflated</strong> and <strong>zero-augmented</strong> models, each of which mixes a binary event with an ordinary GLM likelihood like a Poisson or binomial. The third type is the <strong>ordered categorical</strong> model, useful for categorical outcomes with a fixed ordering. This model is built by merging a categorical likelihood function with a special kind of link function, usually a <strong>cumulative link</strong>. We’ll also learn how to construct ordered categorical predictors.</p>
<p>These model types help us transform our modeling to cope with the inconvenient realities of measurement, rather than transforming measurements to cope with the constraints of our models. <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020">a</a>, p. 369, <strong>emphasis</strong> in the original)</span></p>
</blockquote>
<div id="over-dispersed-counts" class="section level2">
<h2><span class="header-section-number">12.1</span> Over-dispersed counts</h2>
<blockquote>
<p>When counts arise from a mixture of different processes, then there may be more variation—thicker tails—than a pure count model expects. This can again lead to overly excited models. When counts are more variable than a pure process, they exhibit <strong>over-dispersion</strong>. The variance of a variable is sometimes called its <strong>dispersion</strong>. For a counting process like a binomial, the variance is a function of the same parameters as the expected value. For example, the expected value of a binomial is <span class="math inline">\(Np\)</span> and its variance is <span class="math inline">\(Np(1 - p)\)</span>. When the observed variance exceeds this amount–after conditioning on all the predictor variables—this implies that some omitted variable is producing additional dispersion in the observed counts.</p>
<p>That isn’t necessarily bad. Such a model could still produce perfectly good inferences. But ignoring over-dispersion can also lead to all of the same problems as ignoring any predictor variable. Heterogeneity in counts can be a confound, hiding effects of interest or producing spurious inferences. (p, 346, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In this chapter we’ll cope with the problem using continuous mixture models–first the beta-binomial and then the gamma-Poisson (a.k.a. negative binomial).</p>
<div id="beta-binomial." class="section level3">
<h3><span class="header-section-number">12.1.1</span> Beta-binomial.</h3>
<blockquote>
<p>A <strong>beta-binomial</strong> model is a mixture of binomial distributions. It assumes that each binomial count observation has its own probability of success. We estimate the <em>distribution</em> of probabilities of success instead of a single probability of success. Any predictor variables describe the shape of this distribution. (p, 370, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Unfortunately, we need to digress. As it turns out, there are multiple ways to parameterize the beta distribution and we’ve run square into two. In the text, McElreath wrote the beta distribution has two parameters, an average probability <span class="math inline">\(\bar p\)</span> and a shape parameter <span class="math inline">\(\theta\)</span>. In his <strong>R</strong> code 12.1, which we’ll reproduce in a bit, he demonstrated that parameterization with the <code>rethinking::dbeta2()</code> function. The nice thing about this parameterization is how intuitive the <code>pbar</code> parameter is. If you want a beta with an average of .2, you set <code>pbar = .2</code>. If you want the distribution to be more or less certain, make the <code>theta</code> argument more or less large, respectively.</p>
<p>However, the beta density is often defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. If you denote the data as <span class="math inline">\(y\)</span>, this follows the form</p>
<p><span class="math display">\[\operatorname{Beta} (y | \alpha, \beta) = \frac{y^{\alpha - 1} (1 - y)^{\beta - 1}}{\text B (\alpha, \beta)},\]</span></p>
<p>which you can verify in the <a href="https://mc-stan.org/docs/2_23/functions-reference/continuous-distributions-on-0-1.html"><em>Continuous distributions on [0, 1]</em> section</a> of the <a href="https://mc-stan.org/docs/2_23/functions-reference/index.html">Stan functions reference</a> <span class="citation">(Stan Development Team, <a href="#ref-standevelopmentteamStanFunctionsReference2020">2020</a><a href="#ref-standevelopmentteamStanFunctionsReference2020">b</a>)</span>. In the formula, <span class="math inline">\(\text B\)</span> stands for the Beta function, which computes a normalizing constant, which you can learn about in the <a href="https://mc-stan.org/docs/2_23/functions-reference/math-functions.html"><em>Mathematical functions</em> chapter</a> of the <a href="https://mc-stan.org/docs/2_23/functions-reference/index.html">Stan functions reference</a>. If you look at the base <strong>R</strong> <code>dbeta()</code> function, you’ll learn it takes two parameters, <code>shape1</code> and <code>shape2</code>. Those uncreatively-named parameters are the same <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> from the density, above. They do not correspond to the <code>pbar</code> and <code>theta</code> parameters of McEreath’s <code>rethinking::dbeta2()</code> function.</p>
<p>McElreath had good reason for using <code>dbeta2()</code>. Beta’s typical <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters aren’t the most intuitive to use; the parameters in McElreath’s <code>dbeta2()</code> are much nicer. If you dive a little deeper, it turns out you can find the mean of a beta distribution in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this:</p>
<p><span class="math display">\[\mu = \frac{\alpha}{\alpha + \beta}.\]</span></p>
<p>We can talk about the spread of the distribution, sometimes called <span class="math inline">\(\kappa\)</span>, in terms <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this:</p>
<p><span class="math display">\[\kappa = \alpha + \beta.\]</span></p>
<p>With <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\kappa\)</span> in hand, we can even find the <span class="math inline">\(SD\)</span> of a beta distribution with the formula</p>
<p><span class="math display">\[\sigma = \sqrt{\mu (1 - \mu) / (\kappa + 1)}.\]</span></p>
<p>I explicate all this because McElreath’s <code>pbar</code> is <span class="math inline">\(\mu = \frac{\alpha}{\alpha + \beta}\)</span> and his <code>theta</code> is <span class="math inline">\(\kappa = \alpha + \beta\)</span>, which is great news because it means that we can understand what McElreath did with his <code>beta2()</code> function in terms of the base <strong>R</strong> <code>dbeta()</code> function. This also sets us up to understand the distribution of the beta parameters used in <code>brms::brm()</code>. To demonstrate, let’s walk through McElreath’s <strong>R</strong> code 12.1.</p>
<p>Before we get to <strong>R</strong> code 12.1 and our version of the resulting plot, we should discuss themes. In this chapter we’ll use theme settings and a color palette from the <a href="https://cran.r-project.org/package=ggthemes"><strong>ggthemes</strong> package</a>.</p>
<div class="sourceCode" id="cb1369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1369-1" data-line-number="1"><span class="kw">library</span>(ggthemes)</a></code></pre></div>
<p>We’ll take our basic theme settings from the <code>theme_hc()</code> function. We’ll use the <code>Green fields</code> color palette, which we can inspect with the <code>canva_pal()</code> function and a little help from <code>scales::show_col()</code>.</p>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1370-1" data-line-number="1">scales<span class="op">::</span><span class="kw">show_col</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1371-1" data-line-number="1"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;#919636&quot; &quot;#524a3a&quot; &quot;#fffae1&quot; &quot;#5a5f37&quot;</code></pre>
<div class="sourceCode" id="cb1373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1373-1" data-line-number="1"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] &quot;#fffae1&quot;</code></pre>
<p>Now we finally get to <strong>R</strong> code 12.1.</p>
<div class="sourceCode" id="cb1375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1375-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1375-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1375-3" data-line-number="3"><span class="kw">theme_set</span>(</a>
<a class="sourceLine" id="cb1375-4" data-line-number="4">  <span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1375-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1375-6" data-line-number="6">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a>
<a class="sourceLine" id="cb1375-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb1375-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1375-9" data-line-number="9">pbar  &lt;-<span class="st"> </span><span class="fl">.5</span></a>
<a class="sourceLine" id="cb1375-10" data-line-number="10">theta &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1375-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1375-12" data-line-number="12"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>)),</a>
<a class="sourceLine" id="cb1375-13" data-line-number="13">       <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1375-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1375-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1375-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1375-17" data-line-number="17"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(The<span class="op">~</span>beta<span class="op">~</span>distribution),</a>
<a class="sourceLine" id="cb1375-18" data-line-number="18">          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;Defined in terms of &quot;</span><span class="op">*</span>mu<span class="op">*</span><span class="st">&quot; (i.e., pbar) and &quot;</span><span class="op">*</span>kappa<span class="op">*</span><span class="st">&quot; (i.e., theta)&quot;</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>In his <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015">2015</a>)</span> text, <a href="https://sites.google.com/site/doingbayesiandataanalysis/"><em>Doing Bayesian data analysis</em></a>, Kruschke provided code for a convenience function that takes <code>pbar</code> and <code>theta</code> as inputs and returns the corresponding <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values. Here’s the function:</p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1376-1" data-line-number="1">betaABfromMeanKappa &lt;-<span class="st"> </span><span class="cf">function</span>(mean, kappa) {</a>
<a class="sourceLine" id="cb1376-2" data-line-number="2">  <span class="cf">if</span> (mean <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>mean <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">stop</span>(<span class="st">&quot;must have 0 &lt; mean &lt; 1&quot;</span>)</a>
<a class="sourceLine" id="cb1376-3" data-line-number="3">  <span class="cf">if</span> (kappa <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;kappa must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb1376-4" data-line-number="4">  a &lt;-<span class="st"> </span>mean <span class="op">*</span><span class="st"> </span>kappa</a>
<a class="sourceLine" id="cb1376-5" data-line-number="5">  b &lt;-<span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span>mean) <span class="op">*</span><span class="st"> </span>kappa</a>
<a class="sourceLine" id="cb1376-6" data-line-number="6">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">a =</span> a, <span class="dt">b =</span> b))</a>
<a class="sourceLine" id="cb1376-7" data-line-number="7">}</a></code></pre></div>
<p>Now we can use Kruschke’s <code>betaABfromMeanKappa()</code> to find the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values corresponding to <code>pbar</code> and <code>theta</code>.</p>
<div class="sourceCode" id="cb1377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1377-1" data-line-number="1"><span class="kw">betaABfromMeanKappa</span>(<span class="dt">mean =</span> pbar, <span class="dt">kappa =</span> theta)</a></code></pre></div>
<pre><code>## $a
## [1] 2.5
## 
## $b
## [1] 2.5</code></pre>
<p>And finally, we can double check that all of this works. Here’s the same distribution but defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.</p>
<div class="sourceCode" id="cb1379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1379-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>)),</a>
<a class="sourceLine" id="cb1379-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">dbeta</span>(x, <span class="fl">2.5</span>, <span class="fl">2.5</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1379-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1379-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1379-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1379-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(The<span class="op">~</span>beta<span class="op">~</span>distribution),</a>
<a class="sourceLine" id="cb1379-7" data-line-number="7">          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;This time defined in terms of &quot;</span><span class="op">*</span>alpha<span class="op">*</span><span class="st">&quot; and &quot;</span><span class="op">*</span>beta))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>McElreath encouraged us to “explore different values for <code>pbar</code> and <code>theta</code>” (p. 348). Here’s a grid of plots with <code>pbar = c(.25, .5, .75)</code> and <code>theta = c(5, 10, 15)</code>.</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1380-1" data-line-number="1"><span class="co"># data</span></a>
<a class="sourceLine" id="cb1380-2" data-line-number="2"><span class="kw">crossing</span>(<span class="dt">pbar  =</span> <span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>),</a>
<a class="sourceLine" id="cb1380-3" data-line-number="3">         <span class="dt">theta =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1380-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(pbar, theta), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1380-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta),</a>
<a class="sourceLine" id="cb1380-6" data-line-number="6">         <span class="dt">mu      =</span> <span class="kw">str_c</span>(<span class="st">&quot;mu == &quot;</span>, pbar <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(., <span class="st">&quot;0&quot;</span>)),</a>
<a class="sourceLine" id="cb1380-7" data-line-number="7">         <span class="dt">kappa   =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;kappa == &quot;</span>, theta), </a>
<a class="sourceLine" id="cb1380-8" data-line-number="8">                          <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;kappa == 30&quot;</span>, <span class="st">&quot;kappa == 15&quot;</span>, <span class="st">&quot;kappa == 5&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1380-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1380-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1380-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1380-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1380-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, </a>
<a class="sourceLine" id="cb1380-14" data-line-number="14">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1380-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1380-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1380-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_grid</span>(kappa <span class="op">~</span><span class="st"> </span>mu, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>If you’d like to see how to make a similar plot in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, see <a href="https://bookdown.org/content/3686/inferring-a-binomial-probability-via-exact-mathematical-analysis.html">Chapter 6</a> of my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020">2020</a><a href="#ref-kurzDoingBayesianData2020">b</a>)</span> <a href="https://bookdown.org/content/3686/">ebook</a> wherein I translated Kruschke’s text into <strong>tidyverse</strong> and <strong>brms</strong> code.</p>
<p>But remember, we’re not fitting a beta model. We’re using the beta-binomial. “We’re going to bind our linear model to <span class="math inline">\(\bar p\)</span>, so that changes in predictor variables change the central tendency of the distribution” (p. 371). The statistical model we’ll be fitting follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{admit}_i &amp; \sim \operatorname{BetaBinomial}(n_i, \bar p_i, \phi)\\
\operatorname{logit} (\bar p_i) &amp; = \alpha_{\text{gid}[i]} \\
\alpha_j                        &amp; \sim \operatorname{Normal}(0, 1.5) \\
\phi                            &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Here the size, <span class="math inline">\(n\)</span>, is defined in the <code>applications</code> column in the data we’ll load in just a moment. In case you’re confused, yes, our statistical model is not quite the same as the one McElreath presented on page 371 in the text. If you look closely, we dropped all mention of <span class="math inline">\(\theta\)</span> and jumped directly to <span class="math inline">\(\phi\)</span>. Instead of implementing McElreath’s <span class="math inline">\(\theta = \phi + 2\)</span> trick, we’re going to set the lower bound for <span class="math inline">\(\phi\)</span> directly. Which brings us to the next issue:</p>
<p>We have an additional complication. The beta-binomial likelihood is not natively supported in <strong>brms</strong> at this time (see <a href="https://github.com/paul-buerkner/brms/issues/144">GitHub issue #144</a>). However, <strong>brms</strong> versions 2.2.0 and above allow users to define custom distributions. To get all the details, you might check out Bürkner’s <span class="citation">(<a href="#ref-Bürkner2020Define">2020</a><a href="#ref-Bürkner2020Define">a</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define custom response distributions with brms</em></a>. Happily, Bürkner even used the <a href="https://cran.r-project.org/package=brms/vignettes/brms_customfamilies.html#the-beta-binomial-distribution">beta-binomial distribution as the exemplar</a> in the vignette.</p>
<p>Before we get carried away, let’s load the data.</p>
<div class="sourceCode" id="cb1381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1381-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb1381-2" data-line-number="2"><span class="kw">data</span>(UCBadmit) </a>
<a class="sourceLine" id="cb1381-3" data-line-number="3">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1381-4" data-line-number="4"><span class="st">  </span>UCBadmit <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1381-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gid =</span> <span class="kw">ifelse</span>(applicant.gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>))</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1382-1" data-line-number="1"><span class="kw">rm</span>(UCBadmit)</a>
<a class="sourceLine" id="cb1382-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb1382-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>I’m not going to go into great detail explaining the ins and outs of making custom distributions for <code>brm()</code>. You’ve got Bürkner’s vignette for that. For our purposes, we need a few preparatory steps. First, we need to use the <code>custom_family()</code> function to define the name and parameters of the beta-binomial distribution for use in <code>brm()</code>. Second, we have to define some functions for Stan which are not defined in Stan itself. We’ll save them as <code>stan_funs</code>. Third, we’ll make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</p>
<div class="sourceCode" id="cb1383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1383-1" data-line-number="1">beta_binomial2 &lt;-<span class="st"> </span><span class="kw">custom_family</span>(</a>
<a class="sourceLine" id="cb1383-2" data-line-number="2">  <span class="st">&quot;beta_binomial2&quot;</span>, <span class="dt">dpars =</span> <span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;phi&quot;</span>),</a>
<a class="sourceLine" id="cb1383-3" data-line-number="3">  <span class="dt">links =</span> <span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;log&quot;</span>), <span class="dt">lb =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1383-4" data-line-number="4">  <span class="dt">type =</span> <span class="st">&quot;int&quot;</span>, <span class="dt">vars =</span> <span class="st">&quot;vint1[n]&quot;</span></a>
<a class="sourceLine" id="cb1383-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb1383-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1383-7" data-line-number="7">stan_funs &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb1383-8" data-line-number="8"><span class="st">  real beta_binomial2_lpmf(int y, real mu, real phi, int T) {</span></a>
<a class="sourceLine" id="cb1383-9" data-line-number="9"><span class="st">    return beta_binomial_lpmf(y | T, mu * phi, (1 - mu) * phi);</span></a>
<a class="sourceLine" id="cb1383-10" data-line-number="10"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1383-11" data-line-number="11"><span class="st">  int beta_binomial2_rng(real mu, real phi, int T) {</span></a>
<a class="sourceLine" id="cb1383-12" data-line-number="12"><span class="st">    return beta_binomial_rng(T, mu * phi, (1 - mu) * phi);</span></a>
<a class="sourceLine" id="cb1383-13" data-line-number="13"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1383-14" data-line-number="14"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1383-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1383-16" data-line-number="16">stanvars &lt;-<span class="st"> </span><span class="kw">stanvar</span>(<span class="dt">scode =</span> stan_funs, <span class="dt">block =</span> <span class="st">&quot;functions&quot;</span>)</a></code></pre></div>
<p>Did you notice the <code>lb = c(NA, 2)</code> portion of the code defining <code>beta_binomial2()</code>? In Bürkner’s vignette, he set the lower bound of <code>phi</code> to zero. Since McElreath wanted the lower bound for <span class="math inline">\(\phi\)</span> to be 2, we just set that as the default in the likelihood. We should clarify two more points:</p>
<p>First, what McElreath referred to as the shape parameter, <span class="math inline">\(\theta\)</span>, Bürkner called the precision parameter, <span class="math inline">\(\phi\)</span>. In our exposition, above, we followed Kruschke’s convention and called it <span class="math inline">\(\kappa\)</span>. These are all the same thing: <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\phi\)</span>, and <span class="math inline">\(\kappa\)</span> are <strong>all the same thing</strong>. Perhaps less confusingly, what McElreath called the <code>pbar</code> parameter, <span class="math inline">\(\bar p\)</span>, Bürkner simply refers to as <span class="math inline">\(\mu\)</span>.</p>
<p>Second, we’ve become accustomed to using the <code>y | trials() ~ ...</code> syntax when defining our <code>formula</code> arguments for binomial models. Here we are replacing <code>trials()</code> with <code>vint()</code>. From Bürkner’s <em>Define custom response distributions with brms</em> vignette, we read:</p>
<blockquote>
<p>To provide information about the number of trials (an integer variable), we are going to use the addition argument <code>vint()</code>, which can only be used in custom families. Simiarily, if we needed to include additional vectors of real data, we would use <code>vreal()</code>. Actually, for this particular example, we could more elegantly apply the addition argument <code>trials()</code> instead of <code>vint()</code> as in the basic binomial model. However, since the present vignette is ment to give a general overview of the topic, we will go with the more general method.</p>
<p>We now have all components together to fit our custom beta-binomial model:</p>
</blockquote>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1384-1" data-line-number="1">b12<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb1384-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1384-3" data-line-number="3">      <span class="dt">family =</span> beta_binomial2,  <span class="co"># here&#39;s our custom likelihood</span></a>
<a class="sourceLine" id="cb1384-4" data-line-number="4">      admit <span class="op">|</span><span class="st"> </span><span class="kw">vint</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>gid,</a>
<a class="sourceLine" id="cb1384-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1384-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> phi)),</a>
<a class="sourceLine" id="cb1384-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1384-8" data-line-number="8">      <span class="dt">stanvars =</span> stanvars,  <span class="co"># note our `stanvars`</span></a>
<a class="sourceLine" id="cb1384-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1384-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.01&quot;</span>)</a></code></pre></div>
<p>Success, our results look a lot like those in the text!</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1385-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: beta_binomial2 
##   Links: mu = logit; phi = identity 
## Formula: admit | vint(applications) ~ 0 + gid 
##    Data: d (Number of observations: 12) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## gid1    -0.44      0.41    -1.24     0.35 1.00     3107     2410
## gid2    -0.32      0.40    -1.12     0.48 1.00     3175     2674
## 
## Family Specific Parameters: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## phi     3.01      0.79     2.05     5.01 1.00     1975     1414
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Just remember that, perhaps confusingly, what McElreath’s output called <code>theta</code>, our <strong>brms</strong> output is calling <code>phi</code>. I know; this section is a lot. Keep your chin up! Here’s what the corresponding <code>posterior_samples()</code> data object looks like.</p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1387-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b12<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb1387-2" data-line-number="2"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##      b_gid1     b_gid2      phi      lp__
## 1 0.4041865 -0.8175448 2.821786 -75.31071
## 2 0.5615804 -0.6257836 2.700033 -75.71862
## 3 0.3605382 -0.8058735 2.988188 -75.06070
## 4 0.1551593 -0.5701586 2.952003 -73.58417
## 5 0.1566764 -0.5911687 2.733407 -73.71537
## 6 0.7297896 -0.5087445 3.440514 -77.18120</code></pre>
<p>Now we can compute and summarize a contrast between the two genders, what McElreath called <code>da</code>.</p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1389-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb1389-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1389-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1389-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">da =</span> b_gid1 <span class="op">-</span><span class="st"> </span>b_gid2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1389-5" data-line-number="5"><span class="st">  </span><span class="kw">mean_qi</span>(<span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1389-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##       da .lower .upper .width .point .interval
## 1 -0.119 -1.001  0.796   0.89   mean        qi</code></pre>
<p>Much like in the text, the difference between genders on admission rates is near zero with wide uncertainty intervals spanning in either direction.</p>
<p>To stay within the <strong>tidyverse</strong> while making the many thin lines in Figure 12.1.a, we’re going to need to do a bit of data processing. First, we’ll want a variable to index the rows in <code>post</code> (i.e., to index the posterior draws). And we’ll want to convert the <code>b_gid2</code> to the <span class="math inline">\(\bar p\)</span> metric with the <code>inv_logit_scaled()</code> function. Then we’ll use <code>sample_n()</code> to randomly draw a subset of the posterior draws. Then with the <code>expand()</code> function, we’ll insert a dense sequence of <code>x</code> values ranging between 0 and 1–the parameter space of beta distribution. Finally, we’ll use <code>pmap_dbl()</code> to compute the density values for the <code>rethinking::dbeta2</code> distribution corresponding to the unique combination of <code>x</code>, <code>p_bar</code>, and <code>phi</code> values in each row.</p>
<div class="sourceCode" id="cb1391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1391-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1391-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1391-3" data-line-number="3">lines &lt;-</a>
<a class="sourceLine" id="cb1391-4" data-line-number="4"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1391-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1391-6" data-line-number="6">         <span class="dt">p_bar =</span> <span class="kw">inv_logit_scaled</span>(b_gid2)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1391-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1391-8" data-line-number="8"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, p_bar, phi),</a>
<a class="sourceLine" id="cb1391-9" data-line-number="9">         <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.005</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1391-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">pmap_dbl</span>(<span class="kw">list</span>(x, p_bar, phi), rethinking<span class="op">::</span>dbeta2))</a>
<a class="sourceLine" id="cb1391-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1391-12" data-line-number="12"><span class="kw">str</span>(lines)</a></code></pre></div>
<pre><code>## tibble [20,100 × 5] (S3: tbl_df/tbl/data.frame)
##  $ iter   : int [1:20100] 72 72 72 72 72 72 72 72 72 72 ...
##  $ p_bar  : num [1:20100] 0.324 0.324 0.324 0.324 0.324 ...
##  $ phi    : num [1:20100] 2.61 2.61 2.61 2.61 2.61 ...
##  $ x      : num [1:20100] 0 0.005 0.01 0.015 0.02 0.025 0.03 0.035 0.04 0.045 ...
##  $ density: num [1:20100] Inf 3.16 2.83 2.64 2.52 ...</code></pre>
<p>All that was just for the thin lines. To make the thicker line for the posterior mean, we’ll get tricky with <code>stat_function()</code>.</p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1393-1" data-line-number="1">lines <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1393-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1393-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> rethinking<span class="op">::</span>dbeta2,</a>
<a class="sourceLine" id="cb1393-4" data-line-number="4">                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">prob  =</span> <span class="kw">mean</span>(<span class="kw">inv_logit_scaled</span>(post[, <span class="st">&quot;b_gid2&quot;</span>])),</a>
<a class="sourceLine" id="cb1393-5" data-line-number="5">                            <span class="dt">theta =</span> <span class="kw">mean</span>(post[, <span class="st">&quot;phi&quot;</span>])),</a>
<a class="sourceLine" id="cb1393-6" data-line-number="6">                <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1393-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1393-8" data-line-number="8">            <span class="dt">alpha =</span> <span class="fl">.2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1393-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1393-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;distribution of female admission rates&quot;</span>,</a>
<a class="sourceLine" id="cb1393-11" data-line-number="11">       <span class="dt">X =</span> <span class="st">&quot;probability admit&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-16-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>There are other ways to do this. For ideas, check out my blog post, <a href="https://solomonkurz.netlify.com/post/make-rotated-gaussians-kruschke-style/"><em>Make rotated Gaussians, Kruschke style</em></a>.</p>
<p>Before we can do our variant of Figure 12.1.b, we’ll need to define a few more custom functions. The <code>log_lik_beta_binomial2()</code> and <code>posterior_predict_beta_binomial2()</code> functions are required for <code>brms::predict()</code> to work with our <code>family = beta_binomial2</code> brmfit object. Similarly, <code>posterior_epred_beta_binomial2()</code> is required for <code>brms::fitted()</code> to work properly. And before all that, we need to throw in a line with the <code>expose_functions()</code> function. Just go with it.</p>
<div class="sourceCode" id="cb1394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1394-1" data-line-number="1"><span class="kw">expose_functions</span>(b12<span class="fl">.1</span>, <span class="dt">vectorize =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1394-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1394-3" data-line-number="3"><span class="co"># required to use `predict()`</span></a>
<a class="sourceLine" id="cb1394-4" data-line-number="4">log_lik_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(i, prep) {</a>
<a class="sourceLine" id="cb1394-5" data-line-number="5">  mu     &lt;-<span class="st"> </span>prep<span class="op">$</span>dpars<span class="op">$</span>mu[, i]</a>
<a class="sourceLine" id="cb1394-6" data-line-number="6">  phi    &lt;-<span class="st"> </span>prep<span class="op">$</span>dpars<span class="op">$</span>phi</a>
<a class="sourceLine" id="cb1394-7" data-line-number="7">  trials &lt;-<span class="st"> </span>prep<span class="op">$</span>data<span class="op">$</span>vint1[i]</a>
<a class="sourceLine" id="cb1394-8" data-line-number="8">  y      &lt;-<span class="st"> </span>prep<span class="op">$</span>data<span class="op">$</span>Y[i]</a>
<a class="sourceLine" id="cb1394-9" data-line-number="9">  <span class="kw">beta_binomial2_lpmf</span>(y, mu, phi, trials)</a>
<a class="sourceLine" id="cb1394-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1394-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1394-12" data-line-number="12">posterior_predict_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(i, prep, ...) {</a>
<a class="sourceLine" id="cb1394-13" data-line-number="13">  mu     &lt;-<span class="st"> </span>prep<span class="op">$</span>dpars<span class="op">$</span>mu[, i]</a>
<a class="sourceLine" id="cb1394-14" data-line-number="14">  phi    &lt;-<span class="st"> </span>prep<span class="op">$</span>dpars<span class="op">$</span>phi</a>
<a class="sourceLine" id="cb1394-15" data-line-number="15">  trials &lt;-<span class="st"> </span>prep<span class="op">$</span>data<span class="op">$</span>vint1[i]</a>
<a class="sourceLine" id="cb1394-16" data-line-number="16">  <span class="kw">beta_binomial2_rng</span>(mu, phi, trials)</a>
<a class="sourceLine" id="cb1394-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb1394-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1394-19" data-line-number="19"><span class="co"># required to use `fitted()`</span></a>
<a class="sourceLine" id="cb1394-20" data-line-number="20">posterior_epred_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(prep) {</a>
<a class="sourceLine" id="cb1394-21" data-line-number="21">  mu     &lt;-<span class="st"> </span>prep<span class="op">$</span>dpars<span class="op">$</span>mu</a>
<a class="sourceLine" id="cb1394-22" data-line-number="22">  trials &lt;-<span class="st"> </span>prep<span class="op">$</span>data<span class="op">$</span>vint1</a>
<a class="sourceLine" id="cb1394-23" data-line-number="23">  trials &lt;-<span class="st"> </span><span class="kw">matrix</span>(trials, <span class="dt">nrow =</span> <span class="kw">nrow</span>(mu), <span class="dt">ncol =</span> <span class="kw">ncol</span>(mu), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1394-24" data-line-number="24">  mu <span class="op">*</span><span class="st"> </span>trials</a>
<a class="sourceLine" id="cb1394-25" data-line-number="25">}</a></code></pre></div>
<p>With those intermediary steps out of the way, we’re ready to make Figure 12.1.b.</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1395-1" data-line-number="1"><span class="co"># the prediction intervals</span></a>
<a class="sourceLine" id="cb1395-2" data-line-number="2"><span class="kw">predict</span>(b12<span class="fl">.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1395-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">ll =</span> Q2<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1395-5" data-line-number="5">            <span class="dt">ul =</span> Q97<span class="fl">.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1395-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb1395-7" data-line-number="7">    <span class="co"># the fitted intervals</span></a>
<a class="sourceLine" id="cb1395-8" data-line-number="8">    <span class="kw">fitted</span>(b12<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>(),</a>
<a class="sourceLine" id="cb1395-9" data-line-number="9">    <span class="co"># the original data used to fit the model) %&gt;% </span></a>
<a class="sourceLine" id="cb1395-10" data-line-number="10">    b12<span class="fl">.1</span><span class="op">$</span>data</a>
<a class="sourceLine" id="cb1395-11" data-line-number="11">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb1395-14" data-line-number="14"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1395-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> case)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ll <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1395-17" data-line-number="17">                     <span class="dt">ymax =</span> ul <span class="op">/</span><span class="st"> </span>applications),</a>
<a class="sourceLine" id="cb1395-18" data-line-number="18">                 <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb1395-19" data-line-number="19">                 <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>  <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1395-21" data-line-number="21">                      <span class="dt">ymax =</span> Q97<span class="fl">.5</span> <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1395-22" data-line-number="22">                      <span class="dt">y =</span> Estimate<span class="op">/</span>applications),</a>
<a class="sourceLine" id="cb1395-23" data-line-number="23">                  <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1395-24" data-line-number="24">                  <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> admit<span class="op">/</span>applications),</a>
<a class="sourceLine" id="cb1395-26" data-line-number="26">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1395-27" data-line-number="27">             <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-28" data-line-number="28"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-29" data-line-number="29"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span> <span class="op">/</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-30" data-line-number="30"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Posterior validation check&quot;</span>,</a>
<a class="sourceLine" id="cb1395-31" data-line-number="31">       <span class="dt">caption =</span> <span class="kw">expression</span>(<span class="kw">italic</span>(Note.)<span class="op">*</span><span class="st">&quot; A = admittance probability&quot;</span>),</a>
<a class="sourceLine" id="cb1395-32" data-line-number="32">       <span class="dt">y =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1395-33" data-line-number="33"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1395-34" data-line-number="34">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-18-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>As in the text, the raw data are consistent with the prediction intervals. But those intervals are so incredibly wide, they’re hardly an endorsement of the model. Once we learn about hierarchical models, we’ll be able to do much better.</p>
</div>
<div id="negative-binomial-or-gamma-poisson." class="section level3">
<h3><span class="header-section-number">12.1.2</span> Negative-binomial or gamma-Poisson.</h3>
<p>Recall from the last chapter how the Poisson distribution presumes <span class="math inline">\(\sigma^2\)</span> scales with <span class="math inline">\(\mu\)</span>. The negative binomial distribution relaxes this assumption and presumes “each Poisson count observation has its own rate. It estimates the shape of a gamma distribution to describe the Poisson rates across cases” (p. 373).</p>
<p>If you execute <code>?dgamma</code>, you’ll see that base <strong>R</strong> will allow you to define the gamma distribution with either the <code>shape</code> and <code>rate</code> or the <code>shape</code> and <code>scale</code>. If we define gamma in terms of shape and rate, it follows the formula</p>
<p><span class="math display">\[\text{Gamma} (y | \alpha, \beta) = \frac{\beta^\alpha y^{\alpha - 1} e^{-\beta y}}{\Gamma (\alpha)},\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the shape, <span class="math inline">\(\beta\)</span> is the rate, <span class="math inline">\(e\)</span> is base of the natural logarithm, and <span class="math inline">\(\Gamma\)</span> is the <a href="https://en.wikipedia.org/wiki/Gamma_function">gamma function</a>. It turns out the rate and scale parameters are the reciprocals of each other. Thus if you’d like to define a gamma distribution in terms of shape and scale, it would follow the formula</p>
<p><span class="math display">\[\text{Gamma} (y | \alpha, \theta) = \frac{y^{\alpha - 1} e^{-x /\theta}}{\theta^\alpha \Gamma (\alpha)},\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(e\)</span>, and <span class="math inline">\(\Gamma\)</span> are all as they were before and <span class="math inline">\(\theta\)</span> is the scale parameter. If that all wasn’t complicated enough, it turns out there’s one more way to define a gamma distribution. You can use the mean and shape. This would follow the formula</p>
<p><span class="math display">\[\text{Gamma} (y | \mu, \alpha) = \frac{(\frac{\alpha}{\mu})^\alpha}{\Gamma (\alpha)} y^{\alpha - 1} \exp (- \frac{\alpha y}{\mu}),\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\Gamma\)</span> are still the shape and gamma function, respectively, and <span class="math inline">\(\mu\)</span> is the mean. I know, this is a lot and it probably all seems really abstract, right now. Think of this section as a reference. As you’ll see after we fit our model, you may well need it. Returning to the content in the text, we might express the gamma-Poisson (negative binomial) as</p>
<p><span class="math display">\[y_i \sim \operatorname{Gamma-Poisson}(\mu, \alpha),\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean or rate, taking the place of <span class="math inline">\(\lambda\)</span> from the Poisson distribution, and <span class="math inline">\(\alpha\)</span> is the shape.</p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1396-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb1396-2" data-line-number="2"><span class="kw">data</span>(Kline)</a>
<a class="sourceLine" id="cb1396-3" data-line-number="3">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1396-4" data-line-number="4"><span class="st">  </span>Kline <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1396-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p          =</span> <span class="kw">standardize</span>(<span class="kw">log</span>(population)),</a>
<a class="sourceLine" id="cb1396-6" data-line-number="6">         <span class="dt">contact_id =</span> <span class="kw">ifelse</span>(contact <span class="op">==</span><span class="st"> &quot;high&quot;</span>, 2L, 1L),</a>
<a class="sourceLine" id="cb1396-7" data-line-number="7">         <span class="dt">cid        =</span> contact)</a>
<a class="sourceLine" id="cb1396-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1396-9" data-line-number="9"><span class="kw">print</span>(d)</a></code></pre></div>
<pre><code>##       culture population contact total_tools mean_TU            p contact_id  cid
## 1    Malekula       1100     low          13     3.2 -1.291473310          1  low
## 2     Tikopia       1500     low          22     4.7 -1.088550750          1  low
## 3  Santa Cruz       3600     low          24     4.0 -0.515764892          1  low
## 4         Yap       4791    high          43     5.0 -0.328773359          2 high
## 5    Lau Fiji       7400    high          33     5.0 -0.044338980          2 high
## 6   Trobriand       8000    high          19     4.0  0.006668287          2 high
## 7       Chuuk       9200    high          40     3.8  0.098109204          2 high
## 8       Manus      13000     low          28     6.6  0.324317564          1  low
## 9       Tonga      17500    high          55     5.4  0.518797917          2 high
## 10     Hawaii     275000     low          71     6.6  2.321008320          1  low</code></pre>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1398-1" data-line-number="1"><span class="kw">rm</span>(Kline)</a>
<a class="sourceLine" id="cb1398-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking,  <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb1398-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>If you take a look of McElreath’s <code>m12.2</code>, you’ll see it’s a gamma-Poisson version of the non-linear model he fit in last chapter, <code>m11.11</code>. You might also recall that we had to employ somewhat complicated non-linear syntax to translate that model into <strong>brms</strong>. Instead of jumping straight into a similarly complicated gamma-Poisson version of that model, I’m going to warm us up with a simple intercept-only model of the data. The formula will be</p>
<p><span class="math display">\[\begin{align*}
\text{total_tools}_i &amp; \sim \operatorname{Gamma-Poisson} (\mu, \alpha) \\
\text{log}(\mu) &amp; = \beta_0 \\
\beta_0          &amp; \sim \operatorname{Normal}(3, 0.5) \\
\alpha          &amp; \sim \operatorname{Gamma}(0.01, 0.01), 
\end{align*}\]</span></p>
<p>where we have deviated from McElreath’s convention of using <span class="math inline">\(\alpha\)</span> for the model in favor <span class="math inline">\(\beta_0\)</span>. This is because <strong>brms</strong> parameterizes the gamma likelihood in terms of <span class="math inline">\(\mu\)</span> and shape and, as we discussed above, shape is typically denoted as <span class="math inline">\(\alpha\)</span>. I mean, technically we could refer to the shape parameter as <span class="math inline">\(\psi\)</span> or <span class="math inline">\(\xi\)</span> or whatever, but then we’d just be abandoning one convention for another. I just don’t think there’s any way to win, here. <em>Sigh</em>. The prior for <span class="math inline">\(\beta_0\)</span> is the same one we used for the intercept way back for model <code>b11.9</code>. We have assigned a gamma prior for our troublesome new <span class="math inline">\(\alpha\)</span> (shape) parameter. Here’s where that prior came from.</p>
<div class="sourceCode" id="cb1399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1399-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1399-2" data-line-number="2">          <span class="dt">family =</span> negbinomial,</a>
<a class="sourceLine" id="cb1399-3" data-line-number="3">          total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>##                    prior     class coef group resp dpar nlpar bound
## 1 student_t(3, 3.4, 2.5) Intercept                                 
## 2      gamma(0.01, 0.01)     shape</code></pre>
<p><code>gamma(0.01, 0.01)</code> is the <strong>brms</strong> default for the <code>shape</code> parameter in this model. Within <strong>brms</strong>, priors using the gamma distribution are based on the shape-rate (<span class="math inline">\(\alpha\)</span>-<span class="math inline">\(\theta\)</span>) parameterization. This is what <span class="math inline">\(\operatorname{Gamma}(0.01, 0.01)\)</span> looks like.</p>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1401-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="fl">.1</span>)),</a>
<a class="sourceLine" id="cb1401-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1401-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">dgamma</span>(x, <span class="fl">0.01</span>, <span class="fl">0.01</span>)),</a>
<a class="sourceLine" id="cb1401-4" data-line-number="4">              <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, </a>
<a class="sourceLine" id="cb1401-5" data-line-number="5">              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1401-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1401-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1401-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1401-9" data-line-number="9"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(brms<span class="op">~</span>default<span class="op">~</span><span class="kw">gamma</span>(<span class="fl">0.01</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="fl">0.01</span>)<span class="op">~</span>shape<span class="op">~</span>prior))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-22-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Let’s fit the model.</p>
<div class="sourceCode" id="cb1402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1402-1" data-line-number="1">b12<span class="fl">.2</span>a &lt;-</a>
<a class="sourceLine" id="cb1402-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1402-3" data-line-number="3">      <span class="dt">family =</span> negbinomial,</a>
<a class="sourceLine" id="cb1402-4" data-line-number="4">      total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1402-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> Intercept),  <span class="co"># beta_0</span></a>
<a class="sourceLine" id="cb1402-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="dt">class =</span> shape)),  <span class="co"># alpha</span></a>
<a class="sourceLine" id="cb1402-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1402-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1402-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.02a&quot;</span>)</a></code></pre></div>
<p>Notice how you use the language of <code>family = negbinomial</code> to fit these models with <strong>brms</strong>. Here’s the summary.</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1403-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.2</span>a)</a></code></pre></div>
<pre><code>##  Family: negbinomial 
##   Links: mu = log; shape = identity 
## Formula: total_tools ~ 1 
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     3.50      0.16     3.19     3.81 1.00     2632     2527
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## shape     4.86      2.71     1.40    11.94 1.00     2504     2244
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The intercept is our estimate of <span class="math inline">\(\log \mu\)</span>, similar to <span class="math inline">\(\log \lambda\)</span> from a simple Poisson model. The <code>shape</code> is our estimate of, well, the shape (<span class="math inline">\(\alpha\)</span>). To help us get a sense of what this model is, let’s use the <code>brms::predict()</code> function to return random samples of the poster predictive distribution. Because we want random samples instead of summary values, we will specify <code>summary = F</code>. Let’s take a look of what this returns.</p>
<div class="sourceCode" id="cb1405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1405-1" data-line-number="1">p &lt;-</a>
<a class="sourceLine" id="cb1405-2" data-line-number="2"><span class="st">  </span><span class="kw">predict</span>(b12<span class="fl">.2</span>a,</a>
<a class="sourceLine" id="cb1405-3" data-line-number="3">          <span class="dt">summary =</span> F)</a>
<a class="sourceLine" id="cb1405-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1405-5" data-line-number="5">p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1405-6" data-line-number="6"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:4000, 1:10] 32 54 31 29 6 37 47 55 46 29 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>Because we have 4,000 posterior iterations, we also get back 4,000 rows. We have 10 columns, which correspond to the 10 rows (i.e., cultures) in the original data. In the next block, we’ll put convert that output to a data frame and wrangle a little before plotting the results.</p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1407-1" data-line-number="1">p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1407-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1407-3" data-line-number="3"><span class="st">  </span><span class="kw">set_names</span>(d<span class="op">$</span>culture) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1407-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb1407-5" data-line-number="5">               <span class="dt">names_to =</span> <span class="st">&quot;culture&quot;</span>,</a>
<a class="sourceLine" id="cb1407-6" data-line-number="6">               <span class="dt">values_to =</span> <span class="st">&quot;lambda&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1407-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb1407-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lambda)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1407-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1407-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1407-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(lambda[<span class="st">&quot;[culture]&quot;</span>]), <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1407-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">210</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1407-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>culture, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Because this model had no predictors, we have similar posterior-predictive distributions for each case in the data. It’s important, however, to be very clear of what these posterior-predictive distributions are of. They are not of the data, per se. Let’s look back at the text:</p>
<blockquote>
<p>A <strong>negative-binomial</strong> model, more usefully called a <strong>gamma-Poisson</strong> model, assumes that each Poisson count observation has its own rate. It estimates the shape of the gamma distribution to describe the Poisson rates across cases. (p. 373, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>As a reminder, the “rate” for the Poisson distribution is just another word for the mean, also called <span class="math inline">\(\lambda\)</span>. So unlike a simple Poisson model where we use the individual cases to estimate one overall <span class="math inline">\(\lambda\)</span>, here we’re presuming each case has it’s own <span class="math inline">\(\lambda_i\)</span>. There are 10 <span class="math inline">\(\lambda_i\)</span> values that generated our data and if we look at those <span class="math inline">\(\lambda_i\)</span> values on the whole, their distribution can be described with a gamma distribution. And again, this is not a gamma distribution for our data. This is a gamma distribution of the <span class="math inline">\(\lambda_i\)</span> values from the 10 separate Poisson distributions that presumably made our data.</p>
<p>After exponentiating the intercept parameter (<span class="math inline">\(\log \mu\)</span>), here are the posterior distributions for those two gamma parameters.</p>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1408-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b12<span class="fl">.2</span>a)</a>
<a class="sourceLine" id="cb1408-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1408-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1408-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu    =</span> <span class="kw">exp</span>(b_Intercept),</a>
<a class="sourceLine" id="cb1408-5" data-line-number="5">         <span class="dt">alpha =</span> shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1408-6" data-line-number="6"><span class="st">  </span><span class="kw">pivot_longer</span>(mu<span class="op">:</span>alpha,</a>
<a class="sourceLine" id="cb1408-7" data-line-number="7">               <span class="dt">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1408-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb1408-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1408-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1408-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1408-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Behold our gamma parameters!&quot;</span>,</a>
<a class="sourceLine" id="cb1408-13" data-line-number="13">       <span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1408-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-26-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>We might want to use these parameters estimates to visualize the model-implied gamma distribution of <span class="math inline">\(\lambda\)</span> parameters. But recall that the base <strong>R</strong> <code>dgamma()</code> function doesnt’ take the mean. It is based on either the <code>shape</code> and <code>rate</code> or the <code>shape and</code>scale`. Since we already have the shape (<span class="math inline">\(\alpha\)</span>), we need a way to compute the scale or rate. Happily, we can define the scale in terms of the mean and the shape with the equation</p>
<p><span class="math display">\[\theta = \frac{\mu}{\alpha}.\]</span></p>
<p>Behold <span class="math inline">\(\theta\)</span> in a plot.</p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1409-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1409-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu    =</span> <span class="kw">exp</span>(b_Intercept),</a>
<a class="sourceLine" id="cb1409-3" data-line-number="3">         <span class="dt">alpha =</span> shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1409-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">theta =</span> mu <span class="op">/</span><span class="st"> </span>alpha) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1409-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1409-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1409-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1409-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1409-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">expression</span>(We<span class="op">~</span>define<span class="op">~</span>the<span class="op">~</span>scale<span class="op">~</span>as<span class="op">~</span>theta<span class="op">==</span>mu<span class="op">/</span>alpha),</a>
<a class="sourceLine" id="cb1409-10" data-line-number="10">       <span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1409-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">40</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-27-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Now we know how to get both <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\theta\)</span> from the model, we can pump them into <code>dgamma()</code> to get a sense of the model-implied gamma distribution, the presumed underlying distribution of <span class="math inline">\(\lambda\)</span> values that generated the <code>total_tools</code> data.</p>
<div class="sourceCode" id="cb1410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1410-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1410-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1410-3" data-line-number="3"><span class="co"># wrangle to get 200 draws</span></a>
<a class="sourceLine" id="cb1410-4" data-line-number="4">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1410-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1410-6" data-line-number="6">         <span class="dt">alpha =</span> shape,</a>
<a class="sourceLine" id="cb1410-7" data-line-number="7">         <span class="dt">theta =</span> <span class="kw">exp</span>(b_Intercept) <span class="op">/</span><span class="st"> </span>shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1410-8" data-line-number="8"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">200</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1410-9" data-line-number="9"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, alpha, theta),</a>
<a class="sourceLine" id="cb1410-10" data-line-number="10">         <span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">250</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1410-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dgamma</span>(x, <span class="dt">shape =</span> alpha, <span class="dt">scale =</span> theta)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1410-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb1410-13" data-line-number="13"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1410-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1410-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1410-16" data-line-number="16">            <span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1410-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1410-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;200 credible gamma densities for &quot;</span><span class="op">*</span>lambda),</a>
<a class="sourceLine" id="cb1410-19" data-line-number="19">       <span class="dt">x =</span> <span class="kw">expression</span>(lambda)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1410-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">170</span>),</a>
<a class="sourceLine" id="cb1410-21" data-line-number="21">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.045</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-28-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Now we’ve warmed up with an intercept-only gamma-Poisson, it’s time to fit a <strong>brms</strong> version of McElreath’s <code>m12.2</code>. Our model formula will be</p>
<p><span class="math display">\[\begin{align*}
\text{total_tools_i} &amp; \sim \operatorname{Gamma-Poisson} (\mu_i, \alpha) \\
\mu_i       &amp; = \exp (\beta_{0,\text{cid}[i]}) \text{population}_i^{\beta_{1,\text{cid}[i]}} / \gamma \\
\beta_{0,j} &amp; \sim \operatorname{Normal}(1, 1) \\
\beta_{1,j} &amp; \sim \operatorname{Exponential}(1) \\
\gamma      &amp; \sim \operatorname{Exponential}(1) \\
\alpha      &amp; \sim \operatorname{Exponential}(1),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\alpha\)</span> and the mean and shape of the gamma distribution for the case-specific <span class="math inline">\(\lambda\)</span> parameters. Here’s how we might fit that model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1411-1" data-line-number="1">b12<span class="fl">.2</span>b &lt;-</a>
<a class="sourceLine" id="cb1411-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1411-3" data-line-number="3">      <span class="dt">family =</span> <span class="kw">negbinomial</span>(<span class="dt">link =</span> <span class="st">&quot;identity&quot;</span>),</a>
<a class="sourceLine" id="cb1411-4" data-line-number="4">      <span class="kw">bf</span>(total_tools <span class="op">~</span><span class="st"> </span><span class="kw">exp</span>(b0) <span class="op">*</span><span class="st"> </span>population<span class="op">^</span>b1 <span class="op">/</span><span class="st"> </span>g,</a>
<a class="sourceLine" id="cb1411-5" data-line-number="5">         b0 <span class="op">+</span><span class="st"> </span>b1 <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>cid,</a>
<a class="sourceLine" id="cb1411-6" data-line-number="6">         g <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1411-7" data-line-number="7">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1411-8" data-line-number="8">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">nlpar =</span> b0),</a>
<a class="sourceLine" id="cb1411-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">nlpar =</span> b1, <span class="dt">lb =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1411-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">nlpar =</span> g, <span class="dt">lb =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1411-11" data-line-number="11">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> shape)),</a>
<a class="sourceLine" id="cb1411-12" data-line-number="12">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1411-13" data-line-number="13">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1411-14" data-line-number="14">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.95</span>),</a>
<a class="sourceLine" id="cb1411-15" data-line-number="15">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.02b&quot;</span>) </a></code></pre></div>
<p>Here is the model summary.</p>
<div class="sourceCode" id="cb1412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1412-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.2</span>b)</a></code></pre></div>
<pre><code>##  Family: negbinomial 
##   Links: mu = identity; shape = identity 
## Formula: total_tools ~ exp(b0) * population^b1/g 
##          b0 ~ 0 + cid
##          b1 ~ 0 + cid
##          g ~ 1
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## b0_cidhigh      1.04      0.92    -0.76     2.79 1.00     2161     2394
## b0_cidlow       0.90      0.82    -0.75     2.47 1.00     2262     2310
## b1_cidhigh      0.26      0.13     0.03     0.51 1.00     1214      850
## b1_cidlow       0.25      0.10     0.06     0.45 1.00     1429     1337
## g_Intercept     1.04      0.86     0.15     3.37 1.00     1832     2070
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## shape     3.69      1.67     1.21     7.80 1.00     2369     1533
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Compute and check the PSIS-LOO estimates along with their diagnostic Pareto <span class="math inline">\(k\)</span> values.</p>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1414-1" data-line-number="1">b12<span class="fl">.2</span>b &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b12<span class="fl">.2</span>b, <span class="st">&quot;loo&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Found 1 observations with a pareto_k &gt; 0.7 in model &#39;b12.2b&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 1 times to compute the ELPDs for the problematic observations directly.</code></pre>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1416-1" data-line-number="1"><span class="kw">loo</span>(b12<span class="fl">.2</span>b)</a></code></pre></div>
<pre><code>## Warning: Found 1 observations with a pareto_k &gt; 0.7 in model &#39;b12.2b&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 1 times to compute the ELPDs for the problematic observations directly.</code></pre>
<pre><code>## 
## Computed from 4000 by 10 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo    -41.4 1.7
## p_loo         1.3 0.3
## looic        82.9 3.4
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     9     90.0%   1429      
##  (0.5, 0.7]   (ok)       0      0.0%   &lt;NA&gt;      
##    (0.7, 1]   (bad)      1     10.0%   329       
##    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>One of those Pareto <span class="math inline">\(k\)</span> values is still on the high side. Can you guess which one that is?</p>
<div class="sourceCode" id="cb1419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1419-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1419-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">k =</span> b12<span class="fl">.2</span>b<span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics<span class="op">$</span>pareto_k) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1419-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(k <span class="op">&gt;</span><span class="st"> </span><span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1419-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(culture, k)</a></code></pre></div>
<pre><code>##   culture         k
## 1  Hawaii 0.7043926</code></pre>
<p>Before we can make our version of Figure 12.2, we’ll need to reload <code>b11.11</code> from last chapter. One way is with the <code>readRDS()</code> function.</p>
<div class="sourceCode" id="cb1421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1421-1" data-line-number="1">b11<span class="fl">.11</span> &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;fits/b11.11.rds&quot;</span>)</a></code></pre></div>
<p>Here we make the left panel of the figure.</p>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1422-1" data-line-number="1"><span class="co"># the new data</span></a>
<a class="sourceLine" id="cb1422-2" data-line-number="2">nd &lt;-</a>
<a class="sourceLine" id="cb1422-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(d, cid) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1422-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(cid, </a>
<a class="sourceLine" id="cb1422-5" data-line-number="5">         <span class="dt">population =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">300000</span>, <span class="dt">length.out =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb1422-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1422-7" data-line-number="7">p1 &lt;-</a>
<a class="sourceLine" id="cb1422-8" data-line-number="8"><span class="st">  </span><span class="co"># compute the expected trajectories</span></a>
<a class="sourceLine" id="cb1422-9" data-line-number="9"><span class="st">  </span><span class="kw">fitted</span>(b11<span class="fl">.11</span>,</a>
<a class="sourceLine" id="cb1422-10" data-line-number="10">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1422-11" data-line-number="11">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">055</span>, <span class="fl">.945</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-12" data-line-number="12"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-13" data-line-number="13"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1422-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb1422-15" data-line-number="15"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1422-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> population, <span class="dt">group =</span> cid, <span class="dt">color =</span> cid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1422-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q5<span class="fl">.5</span>, <span class="dt">ymax =</span> Q94<span class="fl">.5</span>, <span class="dt">fill =</span> cid),</a>
<a class="sourceLine" id="cb1422-18" data-line-number="18">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb1422-19" data-line-number="19">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1422-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">bind_cols</span>(d, b11<span class="fl">.11</span><span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics),</a>
<a class="sourceLine" id="cb1422-21" data-line-number="21">             <span class="kw">aes</span>(<span class="dt">y =</span> total_tools, <span class="dt">size =</span> pareto_k),</a>
<a class="sourceLine" id="cb1422-22" data-line-number="22">             <span class="dt">alpha =</span> <span class="dv">4</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1422-23" data-line-number="23"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;pure Poisson model&quot;</span>,</a>
<a class="sourceLine" id="cb1422-24" data-line-number="24">       <span class="dt">y =</span> <span class="st">&quot;total tools&quot;</span>)</a></code></pre></div>
<p>Now make the right panel.</p>
<div class="sourceCode" id="cb1423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1423-1" data-line-number="1"><span class="co"># for the annotation</span></a>
<a class="sourceLine" id="cb1423-2" data-line-number="2">text &lt;-</a>
<a class="sourceLine" id="cb1423-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(d, cid) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1423-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">population  =</span> <span class="kw">c</span>(<span class="dv">150000</span>, <span class="dv">110000</span>),</a>
<a class="sourceLine" id="cb1423-5" data-line-number="5">         <span class="dt">total_tools =</span> <span class="kw">c</span>(<span class="dv">57</span>, <span class="dv">69</span>),</a>
<a class="sourceLine" id="cb1423-6" data-line-number="6">         <span class="dt">label       =</span> <span class="kw">str_c</span>(cid, <span class="st">&quot; contact&quot;</span>))</a>
<a class="sourceLine" id="cb1423-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1423-8" data-line-number="8">p2 &lt;-</a>
<a class="sourceLine" id="cb1423-9" data-line-number="9"><span class="st">  </span><span class="kw">fitted</span>(b12<span class="fl">.2</span>b,</a>
<a class="sourceLine" id="cb1423-10" data-line-number="10">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1423-11" data-line-number="11">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">055</span>, <span class="fl">.945</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1423-12" data-line-number="12"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1423-13" data-line-number="13"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1423-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb1423-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> population, <span class="dt">group =</span> cid, <span class="dt">color =</span> cid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1423-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q5<span class="fl">.5</span>, <span class="dt">ymax =</span> Q94<span class="fl">.5</span>, <span class="dt">fill =</span> cid),</a>
<a class="sourceLine" id="cb1423-17" data-line-number="17">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb1423-18" data-line-number="18">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1423-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">bind_cols</span>(d, b12<span class="fl">.2</span>b<span class="op">$</span>criteria<span class="op">$</span>loo<span class="op">$</span>diagnostics),</a>
<a class="sourceLine" id="cb1423-20" data-line-number="20">             <span class="kw">aes</span>(<span class="dt">y =</span> total_tools, <span class="dt">size =</span> pareto_k),</a>
<a class="sourceLine" id="cb1423-21" data-line-number="21">             <span class="dt">alpha =</span> <span class="dv">4</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1423-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</a>
<a class="sourceLine" id="cb1423-23" data-line-number="23">            <span class="kw">aes</span>(<span class="dt">y =</span> total_tools, <span class="dt">label =</span> label)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1423-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1423-25" data-line-number="25"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;gamma-Poisson model&quot;</span>)</a></code></pre></div>
<p>Combine the two ggplots with <strong>patchwork</strong> syntax to make the full version of Figure 12.2.</p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1424-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb1424-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1424-3" data-line-number="3">(p1 <span class="op">|</span><span class="st"> </span>p2) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)]) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)]) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_size</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;population&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">150000</span>, <span class="dv">250000</span>)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>population),</a>
<a class="sourceLine" id="cb1424-9" data-line-number="9">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>total_tools)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1424-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1424-11" data-line-number="11">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-35-1.png" width="696" style="display: block; margin: auto;" /></p>
<p>Oh man!</p>
<blockquote>
<p>Recall that Hawaii was a highly influential point in the pure Poisson model. It does all the work of pulling the low-contact trend down. In this new model, Hawaii is still influential, but it exerts a lot less influence on the trends. Now the high and low contact trends are much more similar, very hard to reliably distinguish. This is because the gamma-Poisson model expects rate variation, and the estimated amount of variation is quite large. Population is still strongly related to the total tools, but the influence of contact rate has greatly diminished. (p. 374)</p>
</blockquote>
<p>Before we move on, let’s use <code>predict()</code> to generate posterior predictive distributions for each of our 10 cultures.</p>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1425-1" data-line-number="1"><span class="kw">predict</span>(b12<span class="fl">.2</span>b,</a>
<a class="sourceLine" id="cb1425-2" data-line-number="2">        <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1425-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1425-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>(d<span class="op">$</span>culture) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1425-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb1425-6" data-line-number="6">               <span class="dt">names_to =</span> <span class="st">&quot;culture&quot;</span>,</a>
<a class="sourceLine" id="cb1425-7" data-line-number="7">               <span class="dt">values_to =</span> <span class="st">&quot;lambda&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1425-8" data-line-number="8"><span class="st">  </span><span class="kw">left_join</span>(d) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1425-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1425-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lambda, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_halfeye</span>(<span class="dt">point_interval =</span> mean_qi, <span class="dt">.width =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1425-12" data-line-number="12">               <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1425-13" data-line-number="13">               <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> total_tools),</a>
<a class="sourceLine" id="cb1425-15" data-line-number="15">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(lambda[<span class="st">&quot;[culture]&quot;</span>]), <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-18" data-line-number="18"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">210</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1425-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>culture, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Because we used predictors in the model, this time the posterior predictive distributions differ across the cultures. The mean and interquartile range of each distribution are marked off by the light-green dot and horizontal line below each. The vertical lines in the foreground mark off the corresponding <code>total_tools</code> values from the data. Recall that these distributions are not based on the <code>total_tools</code> values themselves, but rather are estimates of the <span class="math inline">\(\lambda\)</span> values from the underlying Poisson distributions that might have generated such <code>total_tools</code> values.</p>
</div>
<div id="over-dispersion-entropy-and-information-criteria." class="section level3">
<h3><span class="header-section-number">12.1.3</span> Over-dispersion, entropy, and information criteria.</h3>
<blockquote>
<p>In terms of model comparison using information criteria, a beta-binomial model is a binomial model, and a gamma-Poisson (negative-binomial) is a Poisson model.</p>
<p>You should not use WAIC and PSIS with these models, however, unless you are very sure of what you are doing. The reason is that while ordinary binomial and Poisson models can be aggregated and disaggregated across rows in the data, without changing any causal assumptions, the same is not true of beta-binomial and gamma-Poisson models. The reason is that a beta-binomial or gamma-Poisson likelihood applies an unobserved parameter to each row in the data. When we then go to calculate log-likelihoods, how the data are structured will determine how the beta-distributed or gamma-distributed variation enters the model. (pp. 374–375)</p>
</blockquote>
</div>
</div>
<div id="zero-inflated-outcomes" class="section level2">
<h2><span class="header-section-number">12.2</span> Zero-inflated outcomes</h2>
<blockquote>
<p>Very often, the things we can measure are not emissions from any pure process. Instead, they are <em>mixtures</em> of multiple processes. Whenever there are different causes for the same observation, then a <strong>mixture model</strong> may be useful. A mixture model uses more than one simple probability distribution to model a mixture of causes. In effect, these models use more than one likelihood for the same outcome variable.</p>
</blockquote>
<blockquote>
<p>Count variables are especially prone to needing a mixture treatment. The reason is that a count of zero can often arise more than one way. A “zero” means that nothing happened, and nothing can happen either because the rate of events is low or rather because the process that generates events failed to get started. (p. 376, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="rethinking-breaking-the-law." class="section level4">
<h4><span class="header-section-number">12.2.0.1</span> Rethinking: Breaking the law.</h4>
<p>McElreath discussed how advances in computing have made it possible for working scientists to define their own data generating models. If you’d like to dive deeper into the topic, check out Bürkner’s <span class="citation">(<a href="#ref-Bürkner2020Define">2020</a><a href="#ref-Bürkner2020Define">a</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define custom response distributions with brms</em></a>.</p>
</div>
<div id="example-zero-inflated-poisson." class="section level3">
<h3><span class="header-section-number">12.2.1</span> Example: Zero-inflated Poisson.</h3>
<p>Do you remember the monk data from back in <a href="god-spiked-the-integers.html#example-exposure-and-the-offset.">Chapter 11</a>? Here we simulate some more. This time we’ll work in a little alcohol.</p>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1426-1" data-line-number="1"><span class="co"># define parameters</span></a>
<a class="sourceLine" id="cb1426-2" data-line-number="2">prob_drink &lt;-<span class="st"> </span><span class="fl">0.2</span>  <span class="co"># 20% of days</span></a>
<a class="sourceLine" id="cb1426-3" data-line-number="3">rate_work  &lt;-<span class="st"> </span><span class="dv">1</span>    <span class="co"># average 1 manuscript per day</span></a>
<a class="sourceLine" id="cb1426-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1426-5" data-line-number="5"><span class="co"># sample one year of production</span></a>
<a class="sourceLine" id="cb1426-6" data-line-number="6">n &lt;-<span class="st"> </span><span class="dv">365</span></a>
<a class="sourceLine" id="cb1426-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1426-8" data-line-number="8"><span class="co"># simulate days monks drink</span></a>
<a class="sourceLine" id="cb1426-9" data-line-number="9"><span class="kw">set.seed</span>(<span class="dv">365</span>)</a>
<a class="sourceLine" id="cb1426-10" data-line-number="10">drink &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, prob_drink)</a>
<a class="sourceLine" id="cb1426-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1426-12" data-line-number="12"><span class="co"># simulate manuscripts completed</span></a>
<a class="sourceLine" id="cb1426-13" data-line-number="13">y &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>drink) <span class="op">*</span><span class="st"> </span><span class="kw">rpois</span>(n, rate_work)</a></code></pre></div>
<p>We’ll put those data in a tidy tibble before plotting.</p>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1427-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb1427-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">drink =</span> <span class="kw">factor</span>(drink, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1427-3" data-line-number="3">         <span class="dt">y     =</span> y)</a>
<a class="sourceLine" id="cb1427-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb1427-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1427-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> drink),</a>
<a class="sourceLine" id="cb1427-7" data-line-number="7">                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1427-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1427-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manuscripts completed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1427-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-38-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>With these data, the likelihood of observing zero on <code>y</code>, (i.e., the likelihood zero manuscripts were completed on a given occasion) is</p>
<p><span class="math display">\[\begin{align*}
\operatorname{Pr} (0 | p, \lambda) &amp; = \operatorname{Pr} (\text{drink} | p) + \operatorname{Pr} (\text{work} | p) \times \operatorname{Pr} (0 | \lambda) \\
                                   &amp; = p + (1 - p) \exp (- \lambda).
\end{align*}\]</span></p>
<p>And</p>
<blockquote>
<p>since the Poisson likelihood of <span class="math inline">\(y\)</span> is <span class="math inline">\(\text{Pr} (y | \lambda) = \lambda^y \exp (- \lambda) / y!\)</span>, the likelihood of <span class="math inline">\(y = 0\)</span> is just <span class="math inline">\(\exp (- \lambda)\)</span>. The above is just the mathematics for:</p>
<blockquote>
<p><em>The probability of observing a zero is the probability that the monks didn’t drink OR (<span class="math inline">\(+\)</span>) the probability that the monks worked AND (<span class="math inline">\(\times\)</span>) failed to finish anything</em>.</p>
</blockquote>
<p>And the likelihood of a non-zero value <span class="math inline">\(y\)</span> is:</p>
<p><span class="math display">\[\operatorname{Pr} (y | y &gt; 0, p, \lambda) = \operatorname{Pr} (\text{drink} | p) (0) + \operatorname{Pr} (\text{work} | p) \operatorname{Pr} (y | \lambda) = (1 - p) \frac {\lambda^y \exp (- \lambda)}{y!}\]</span></p>
<p>Since drinking monks never produce <span class="math inline">\(y &gt; 0\)</span>, the expression above is just the chance the monks both work <span class="math inline">\(1 - p\)</span>, and finish <span class="math inline">\(y\)</span> manuscripts. (pp. 377–378, <em>emphasis</em> in the original)</p>
</blockquote>
<p>So letting <span class="math inline">\(p\)</span> be the probability <span class="math inline">\(y\)</span> is zero and <span class="math inline">\(\lambda\)</span> be the shape of the distribution, the zero-inflated Poisson (<span class="math inline">\(\operatorname{ZIPoisson}\)</span>) regression model might take the basic form</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; \sim \operatorname{ZIPoisson} (p_i, \lambda_i)\\
\operatorname{logit} (p_i)     &amp; = \alpha_p + \beta_p x_i \\
\log (\lambda_i) &amp; = \alpha_\lambda + \beta_\lambda x_i,
\end{align*}\]</span></p>
<p>where both parameters in the likelihood, <span class="math inline">\(p_i\)</span> and <span class="math inline">\(\lambda_i\)</span> might get their own statistical model, making this a special case of what Bürkner <span class="citation">(<a href="#ref-Bürkner2020Distributional">2020</a><a href="#ref-Bürkner2020Distributional">b</a>)</span> calls distributional models. One last thing to note is that in <strong>brms</strong>, <span class="math inline">\(p_i\)</span> is denoted <code>zi</code>. To fit a zero-inflated Poisson model with <strong>brms</strong>, make sure to specify the correct likelihood with <code>family = zero_inflated_poisson</code>. To use a non-default prior for <code>zi</code>, make sure to indicate <code>class = zi</code> within the <code>prior()</code> function.</p>
<div class="sourceCode" id="cb1428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1428-1" data-line-number="1">b12<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1428-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1428-3" data-line-number="3">      <span class="dt">family =</span> zero_inflated_poisson,</a>
<a class="sourceLine" id="cb1428-4" data-line-number="4">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1428-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="op">-</span><span class="fl">1.5</span>, <span class="dv">1</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1428-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="dt">class =</span> zi)),  <span class="co"># the brms default is beta(1, 1)</span></a>
<a class="sourceLine" id="cb1428-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1428-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1428-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.03&quot;</span>) </a></code></pre></div>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1429-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>##  Family: zero_inflated_poisson 
##   Links: mu = log; zi = identity 
## Formula: y ~ 1 
##    Data: d (Number of observations: 365) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.02      0.09    -0.20     0.16 1.00     1115     1401
## 
## Family Specific Parameters: 
##    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## zi     0.21      0.06     0.10     0.32 1.00     1237     1410
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If you look at the <a href="https://cran.r-project.org/package=brms/vignettes/brms_families.html#zero-inflated-and-hurdle-models"><em>Zero-inflated and hurdle models</em> section</a> of Bürkner’s <span class="citation">(<a href="#ref-Bürkner2020Parameterization">2020</a><a href="#ref-Bürkner2020Parameterization">i</a>)</span> <a href="https://cran.r-project.org/package=brms/vignettes/brms_families.html"><em>Parameterization of response distributions in brms</em></a> document, you’ll see the zero-inflated Poisson is set up a little differently in <strong>brms</strong> than it is in <strong>rethinking</strong>. The difference did not influence the estimate for the intercept, <span class="math inline">\(\lambda\)</span>. In both here and in the text, <span class="math inline">\(\lambda\)</span> was about zero. However, it did influence the summary of <code>zi</code>. Note how McElreath’s <code>mean( inv_logit( post$ap ) )</code> returned 0.2241255 Seems rather close to our <code>zi</code> estimate of 0.214. Hopefully it’s clear that <code>zi</code> in <strong>brms</strong> is already in the probability metric. There’s no need to convert it. You can further confirm this by looking at the second line from the <code>print()</code> output, <code>Links: mu = log; zi = identity</code>. When there are no predictors for <code>zi</code>, the <strong>brms</strong> default is to use the identity link. In the text, however, McElreath used the logit link for <code>p</code>.</p>
<p>In the <code>prior</code> argument, we used <code>beta(2, 6)</code> for <code>zi</code> and also mentioned in the margin that the <strong>brms</strong> default is <code>beta(1, 1)</code>. The beta distribution ranges from 0 to 1, making it a natural distribution to use for priors on probabilities when using the identity link. To give you a sense of what those two versions of the beta look like, let’s plot.</p>
<p>A typical way to plot a beta distribution would be to use the base <strong>R</strong> <code>dbeta()</code> function. Let’s try a different approach, instead. The <strong>tidybayes</strong> package includes a <code>parse_dist()</code> function which takes the kind of string specifications you would usually include in the <code>brms::prior()</code> function and converts them into a format one can plot with. For example, here’s what the preparatory work would be in our case.</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1431-1" data-line-number="1">priors &lt;-</a>
<a class="sourceLine" id="cb1431-2" data-line-number="2"><span class="st">  </span><span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">class =</span> zi),</a>
<a class="sourceLine" id="cb1431-3" data-line-number="3">    <span class="kw">prior</span>(<span class="kw">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="dt">class =</span> zi))</a>
<a class="sourceLine" id="cb1431-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1431-5" data-line-number="5">priors <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1431-6" data-line-number="6"><span class="st">  </span><span class="kw">parse_dist</span>(prior)</a></code></pre></div>
<pre><code>##        prior class coef group resp dpar nlpar bound .dist .args
## 1 beta(1, 1)    zi                                   beta  1, 1
## 2 beta(2, 6)    zi                                   beta  2, 6</code></pre>
<p>The first several columns look a lot like the kind of output we’d get from the <code>brms::get_prior()</code> function. The <code>parse_dist()</code> function added those last two columns. Here we put them to work by feeding them into a ggplot.</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1433-1" data-line-number="1">priors <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1433-2" data-line-number="2"><span class="st">  </span><span class="kw">parse_dist</span>(prior) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1433-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> prior, <span class="dt">dist =</span> .dist, <span class="dt">args =</span> .args, <span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1433-4" data-line-number="4"><span class="st">  </span><span class="kw">stat_dist_halfeye</span>(<span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1433-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1433-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;zi&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1433-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1433-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-41-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Whereas the <strong>brms</strong> default is flat, our prior guided the posterior a bit toward 0. In case you were curious, we might write our statistical model for <code>b12.3</code> as</p>
<p><span class="math display">\[\begin{align*}
y_i            &amp; \sim \operatorname{ZIPoisson} (p, \lambda) \\
p              &amp; = \alpha_p \\
\log \lambda   &amp; = \alpha_\lambda \\
\alpha_p       &amp; \sim \operatorname{Beta}(2, 6) \\
\alpha_\lambda &amp; \sim \operatorname{Normal}(-1.5, 1).
\end{align*}\]</span></p>
<p>Anyway, here’s that exponentiated <span class="math inline">\(\alpha_\lambda\)</span>.</p>
<div class="sourceCode" id="cb1434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1434-1" data-line-number="1"><span class="kw">fixef</span>(b12<span class="fl">.3</span>)[<span class="dv">1</span>, ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1434-2" data-line-number="2"><span class="st">  </span><span class="kw">exp</span>()</a></code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
## 0.9791160 1.0962957 0.8173027 1.1679982</code></pre>
<div id="overthinking-zero-inflated-poisson-calculations-in-stan." class="section level4">
<h4><span class="header-section-number">12.2.1.1</span> Overthinking: Zero-inflated Poisson calculations in Stan.</h4>
<p>If you’re curious, here’s the Stan code underlying our <strong>brms</strong> fit, <code>b12.3</code>.</p>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1436-1" data-line-number="1">b12<span class="fl">.3</span><span class="op">$</span>model</a></code></pre></div>
<pre><code>## // generated with brms 2.13.0
## functions {
## 
##   /* zero-inflated poisson log-PDF of a single response 
##    * Args: 
##    *   y: the response value 
##    *   lambda: mean parameter of the poisson distribution
##    *   zi: zero-inflation probability
##    * Returns:  
##    *   a scalar to be added to the log posterior 
##    */ 
##   real zero_inflated_poisson_lpmf(int y, real lambda, real zi) { 
##     if (y == 0) { 
##       return log_sum_exp(bernoulli_lpmf(1 | zi), 
##                          bernoulli_lpmf(0 | zi) + 
##                          poisson_lpmf(0 | lambda)); 
##     } else { 
##       return bernoulli_lpmf(0 | zi) +  
##              poisson_lpmf(y | lambda); 
##     } 
##   }
##   /* zero-inflated poisson log-PDF of a single response 
##    * logit parameterization of the zero-inflation part
##    * Args: 
##    *   y: the response value 
##    *   lambda: mean parameter of the poisson distribution
##    *   zi: linear predictor for zero-inflation part 
##    * Returns:  
##    *   a scalar to be added to the log posterior 
##    */ 
##   real zero_inflated_poisson_logit_lpmf(int y, real lambda, real zi) { 
##     if (y == 0) { 
##       return log_sum_exp(bernoulli_logit_lpmf(1 | zi), 
##                          bernoulli_logit_lpmf(0 | zi) + 
##                          poisson_lpmf(0 | lambda)); 
##     } else { 
##       return bernoulli_logit_lpmf(0 | zi) +  
##              poisson_lpmf(y | lambda); 
##     } 
##   }
##   /* zero-inflated poisson log-PDF of a single response
##    * log parameterization for the poisson part
##    * Args: 
##    *   y: the response value 
##    *   eta: linear predictor for poisson distribution
##    *   zi: zero-inflation probability
##    * Returns:  
##    *   a scalar to be added to the log posterior 
##    */ 
##   real zero_inflated_poisson_log_lpmf(int y, real eta, real zi) { 
##     if (y == 0) { 
##       return log_sum_exp(bernoulli_lpmf(1 | zi), 
##                          bernoulli_lpmf(0 | zi) + 
##                          poisson_log_lpmf(0 | eta)); 
##     } else { 
##       return bernoulli_lpmf(0 | zi) +  
##              poisson_log_lpmf(y | eta); 
##     } 
##   }
##   /* zero-inflated poisson log-PDF of a single response 
##    * log parameterization for the poisson part
##    * logit parameterization of the zero-inflation part
##    * Args: 
##    *   y: the response value 
##    *   eta: linear predictor for poisson distribution
##    *   zi: linear predictor for zero-inflation part 
##    * Returns:  
##    *   a scalar to be added to the log posterior 
##    */ 
##   real zero_inflated_poisson_log_logit_lpmf(int y, real eta, real zi) { 
##     if (y == 0) { 
##       return log_sum_exp(bernoulli_logit_lpmf(1 | zi), 
##                          bernoulli_logit_lpmf(0 | zi) + 
##                          poisson_log_lpmf(0 | eta)); 
##     } else { 
##       return bernoulli_logit_lpmf(0 | zi) +  
##              poisson_log_lpmf(y | eta); 
##     } 
##   }
##   // zero-inflated poisson log-CCDF and log-CDF functions
##   real zero_inflated_poisson_lccdf(int y, real lambda, real zi) { 
##     return bernoulli_lpmf(0 | zi) + poisson_lccdf(y | lambda); 
##   }
##   real zero_inflated_poisson_lcdf(int y, real lambda, real zi) { 
##     return log1m_exp(zero_inflated_poisson_lccdf(y | lambda, zi));
##   }
## }
## data {
##   int&lt;lower=1&gt; N;  // number of observations
##   int Y[N];  // response variable
##   int prior_only;  // should the likelihood be ignored?
## }
## transformed data {
## }
## parameters {
##   real Intercept;  // temporary intercept for centered predictors
##   real&lt;lower=0,upper=1&gt; zi;  // zero-inflation probability
## }
## transformed parameters {
## }
## model {
##   // initialize linear predictor term
##   vector[N] mu = Intercept + rep_vector(0, N);
##   // priors including all constants
##   target += normal_lpdf(Intercept | -1.5, 1);
##   target += beta_lpdf(zi | 2, 6);
##   // likelihood including all constants
##   if (!prior_only) {
##     for (n in 1:N) {
##       target += zero_inflated_poisson_log_lpmf(Y[n] | mu[n], zi);
##     }
##   }
## }
## generated quantities {
##   // actual population-level intercept
##   real b_Intercept = Intercept;
## }</code></pre>
</div>
</div>
</div>
<div id="ordered-categorical-outcomes" class="section level2">
<h2><span class="header-section-number">12.3</span> Ordered categorical outcomes</h2>
<blockquote>
<p>It is very common in the social sciences, and occasional in the natural sciences, to have an outcome variable that is discrete, like a count, but in which the values merely indicate different ordered levels along some dimension. For example, if I were to ask you how much you like to eat fish, on a scale from 1 to 7, you might say 5. If I were to ask 100 people the same question, I’d end up with 100 values between 1 and 7. In modeling each outcome value, I’d have to keep in mind that these values are <em>ordered</em>, because 7 is greater than 6, which is greater than 5, and so on. The result is a set of <strong>ordered categories</strong>. Unlike a count, the differences in value are not necessarily equal….</p>
<p>In principle, an ordered categorical variable is just a multinomial prediction problem (page 359). But the constraint that the categories be ordered demands special treatment….</p>
<p>The conventional solution is to use a <strong>cumulative link</strong> function. The cumulative probability of a value is the probability of that value <em>or any smaller value</em>. In the context of ordered categories, the cumulative probability of 3 is the sum of the probabilities of 3, 2, and 1. Ordered categories by convention begin at 1, so a result less than 1 has no probability at all. By linking a linear model to cumulative probability, it is possible to guarantee the ordering of the outcomes. (p. 380, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="example-moral-intuition." class="section level3">
<h3><span class="header-section-number">12.3.1</span> Example: Moral intuition.</h3>
<p>Let’s get the <code>Trolley</code> data from <strong>rethinking</strong> <span class="citation">(see Cushman et al., <a href="#ref-cushmanRoleConsciousReasoning2006">2006</a>)</span>.</p>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1438-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb1438-2" data-line-number="2"><span class="kw">data</span>(Trolley)</a>
<a class="sourceLine" id="cb1438-3" data-line-number="3">d &lt;-<span class="st"> </span>Trolley</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1439-1" data-line-number="1"><span class="kw">rm</span>(Trolley)</a>
<a class="sourceLine" id="cb1439-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb1439-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Use the <code>dplyr::glimpse()</code> to get a sense of the dimensions of the data.</p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1440-1" data-line-number="1"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<pre><code>## Rows: 9,930
## Columns: 12
## $ case      &lt;fct&gt; cfaqu, cfbur, cfrub, cibox, cibur, cispe, fkaqu, fkboa, fkbox, fkbur, fkcar, fkspe, fkswi…
## $ response  &lt;int&gt; 4, 3, 4, 3, 3, 3, 5, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, 4, 3, 3, 3, 4, 4, 5, 4, 4, 3, 4, 4,…
## $ order     &lt;int&gt; 2, 31, 16, 32, 4, 9, 29, 12, 23, 22, 27, 19, 14, 3, 18, 15, 30, 5, 1, 13, 20, 17, 28, 10,…
## $ id        &lt;fct&gt; 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 9…
## $ age       &lt;int&gt; 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 1…
## $ male      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ edu       &lt;fct&gt; Middle School, Middle School, Middle School, Middle School, Middle School, Middle School,…
## $ action    &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1,…
## $ intention &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,…
## $ contact   &lt;int&gt; 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ story     &lt;fct&gt; aqu, bur, rub, box, bur, spe, aqu, boa, box, bur, car, spe, swi, boa, car, che, sha, swi,…
## $ action2   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1,…</code></pre>
<p>Though we have 9,930 rows, we only have 331 unique individuals.</p>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1442-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1442-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1442-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>##     n
## 1 331</code></pre>
</div>
<div id="describing-an-ordered-distribution-with-intercepts." class="section level3">
<h3><span class="header-section-number">12.3.2</span> Describing an ordered distribution with intercepts.</h3>
<p>Make our version of the simple Figure 12.4 histogram of our primary variable, <code>response</code>.</p>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1444-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1444-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1444-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">fill =</span> ..x..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1444-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1444-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1444-6" data-line-number="6">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1444-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1444-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1444-9" data-line-number="9">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb1444-10" data-line-number="10">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1444-11" data-line-number="11">p1</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-48-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Our cumulative proportion plot, Figure 12.4.b, will require some pre-plot wrangling.</p>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1445-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb1445-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1445-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1445-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d),</a>
<a class="sourceLine" id="cb1445-5" data-line-number="5">         <span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(pr_k)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1445-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1445-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k, </a>
<a class="sourceLine" id="cb1445-8" data-line-number="8">             <span class="dt">fill =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1445-11" data-line-number="11">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1445-13" data-line-number="13">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, </a>
<a class="sourceLine" id="cb1445-16" data-line-number="16">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1445-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1445-18" data-line-number="18">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb1445-19" data-line-number="19">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1445-20" data-line-number="20">p2</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-49-1.png" width="240" style="display: block; margin: auto;" /></p>
<blockquote>
<p>To re-describe the histogram as log-cumulative odds, we’ll need a series of intercept parameters. Each intercept will be on the log-cumulative-odds scale and stand in for the cumulative probability of each outcome. So this is just the application of the link function. The log-cumulative-odds that a response value <span class="math inline">\(y_i\)</span> is equal-to-or-less-than some possible outcome value <span class="math inline">\(k\)</span> is:</p>
<p><span class="math display">\[\log \frac{\operatorname{Pr}(y_i \leq k)}{1 - \operatorname{Pr}(y_i \leq k)} = \alpha_k\]</span></p>
<p>where <span class="math inline">\(\alpha_k\)</span> is an “intercept” unique to each possible outcome value <span class="math inline">\(k\)</span>. (p. 383)</p>
</blockquote>
<p>We can compute the <span class="math inline">\(\alpha_k\)</span> estimates directly with a little help from McElreath’s custom <code>logit()</code> function.</p>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1446-1" data-line-number="1">logit &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x)) <span class="co"># convenience function</span></a>
<a class="sourceLine" id="cb1446-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1446-3" data-line-number="3">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1446-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1446-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d),</a>
<a class="sourceLine" id="cb1446-6" data-line-number="6">         <span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1446-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">alpha =</span> <span class="kw">logit</span>(cum_pr_k) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>))</a></code></pre></div>
<pre><code>##   response    n       pr_k  cum_pr_k alpha
## 1        1 1274 0.12829809 0.1282981 -1.92
## 2        2  909 0.09154079 0.2198389 -1.27
## 3        3 1071 0.10785498 0.3276939 -0.72
## 4        4 2323 0.23393756 0.5616314  0.25
## 5        5 1462 0.14723061 0.7088620  0.89
## 6        6 1445 0.14551863 0.8543807  1.77
## 7        7 1446 0.14561934 1.0000000   Inf</code></pre>
<p>Now we plot those joints to make our version of Figure 12.4.c.</p>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1448-1" data-line-number="1">p3 &lt;-</a>
<a class="sourceLine" id="cb1448-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1448-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1448-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1448-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(response <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1448-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1448-7" data-line-number="7"><span class="st">  </span><span class="co"># we can do the `logit()` conversion right in `ggplot() </span></a>
<a class="sourceLine" id="cb1448-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> <span class="kw">logit</span>(cum_pr_k), <span class="dt">fill =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1448-11" data-line-number="11">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1448-13" data-line-number="13">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-15" data-line-number="15"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1448-17" data-line-number="17">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb1448-18" data-line-number="18">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1448-19" data-line-number="19">p3</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-51-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Why not combine the three subplots with patchwork?</p>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1449-1" data-line-number="1">(p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1449-2" data-line-number="2"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Re-describing a discrete distribution using log-cumulative-odds.&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-52-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The code for Figure 12.5 is itself something of a monster.</p>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1450-1" data-line-number="1">d_plot &lt;-</a>
<a class="sourceLine" id="cb1450-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1450-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1450-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d),</a>
<a class="sourceLine" id="cb1450-5" data-line-number="5">         <span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d))) </a>
<a class="sourceLine" id="cb1450-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1450-7" data-line-number="7">d_plot <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1450-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k,</a>
<a class="sourceLine" id="cb1450-9" data-line-number="9">             <span class="dt">color =</span> cum_pr_k, <span class="dt">fill =</span> cum_pr_k)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1450-12" data-line-number="12">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> cum_pr_k),</a>
<a class="sourceLine" id="cb1450-14" data-line-number="14">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-15" data-line-number="15"><span class="st">  </span><span class="co"># there must be more elegant ways to do this part</span></a>
<a class="sourceLine" id="cb1450-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1450-17" data-line-number="17"><span class="st">                   </span><span class="kw">mutate</span>(<span class="dt">discrete_probability =</span></a>
<a class="sourceLine" id="cb1450-18" data-line-number="18">                            <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, cum_pr_k,</a>
<a class="sourceLine" id="cb1450-19" data-line-number="19">                                   cum_pr_k <span class="op">-</span><span class="st"> </span>pr_k)),</a>
<a class="sourceLine" id="cb1450-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> response <span class="op">+</span><span class="st"> </span><span class="fl">.025</span>,</a>
<a class="sourceLine" id="cb1450-21" data-line-number="21">                     <span class="dt">ymin =</span> <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">0</span>, discrete_probability), </a>
<a class="sourceLine" id="cb1450-22" data-line-number="22">                     <span class="dt">ymax =</span> cum_pr_k),</a>
<a class="sourceLine" id="cb1450-23" data-line-number="23">                 <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1450-25" data-line-number="25">    <span class="dt">text     =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1450-26" data-line-number="26">    <span class="dt">response =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">1.25</span>, <span class="dt">to =</span> <span class="fl">7.25</span>, <span class="dt">by =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1450-27" data-line-number="27">    <span class="dt">cum_pr_k =</span> d_plot<span class="op">$</span>cum_pr_k <span class="op">-</span><span class="st"> </span><span class="fl">.065</span></a>
<a class="sourceLine" id="cb1450-28" data-line-number="28">  ), <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1450-29" data-line-number="29">  <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-30" data-line-number="30"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1450-31" data-line-number="31">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-32" data-line-number="32"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1450-33" data-line-number="33">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-34" data-line-number="34"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-35" data-line-number="35"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1450-36" data-line-number="36"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1450-37" data-line-number="37">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb1450-38" data-line-number="38">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-53-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>A compact way to express the formula for this first type of statistical model is</p>
<p><span class="math display">\[\begin{align*} 
\text{response}_i &amp; \sim \operatorname{Categorical} (\mathbf p) \\
\text{logit}(p_k) &amp; = \alpha_k - \phi \\
\phi              &amp; = 0 \\
\alpha_k          &amp; \sim \operatorname{Normal}(0, 1.5),
\end{align*}\]</span></p>
<p>where the <span class="math inline">\(\alpha_k\)</span> term denotes the <span class="math inline">\(K - 1\)</span> intercepts (cut points or thresholds) we use to describe each possible outcome value <span class="math inline">\(k\)</span> and. The mysterious looking <span class="math inline">\(\phi\)</span> term is a stand-in for the potential terms of the linear model. In the case where we have no predictors, it’s just 0. Just hold on to your hats; this will make more sense in the next section.</p>
<blockquote>
<p>An ordered-logit distribution is really just a categorical distribution that takes a vector <span class="math inline">\(\mathbf p = \{p_1, p_2, p_3, p_4, p_5, p_6\}\)</span> of probabilities of each response value below the maximum response (7 in this example). Each response value <span class="math inline">\(k\)</span> in this vector is defined by its link to an intercept parameter, <span class="math inline">\(\alpha_k\)</span>. Finally, some weakly regularizing priors are placed on these intercepts. (p. 385)</p>
</blockquote>
<p>Whereas in <code>rethinking::ulam()</code> you indicate the likelihood by <code>&lt;criterion&gt; ~ dordlogit(0 , c(&lt;the thresholds&gt;)</code>, in <code>brms::brm()</code> you code <code>family = cumulative</code>. Here’s how to fit the intercepts-only model.</p>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1451-1" data-line-number="1"><span class="co"># define the start values</span></a>
<a class="sourceLine" id="cb1451-2" data-line-number="2">inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">-2</span>,</a>
<a class="sourceLine" id="cb1451-3" data-line-number="3">              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb1451-4" data-line-number="4">              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1451-5" data-line-number="5">              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1451-6" data-line-number="6">              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1451-7" data-line-number="7">              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb1451-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1451-9" data-line-number="9">inits_list &lt;-<span class="st"> </span><span class="kw">list</span>(inits, inits, inits, inits)</a>
<a class="sourceLine" id="cb1451-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1451-11" data-line-number="11">b12<span class="fl">.4</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1451-12" data-line-number="12"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1451-13" data-line-number="13">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1451-14" data-line-number="14">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1451-15" data-line-number="15">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1451-16" data-line-number="16">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1451-17" data-line-number="17">      <span class="dt">inits =</span> inits_list,  <span class="co"># here we add our start values</span></a>
<a class="sourceLine" id="cb1451-18" data-line-number="18">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.04&quot;</span>)  </a></code></pre></div>
<p>McElreath needed to include the <code>depth=2</code> argument in the <code>rethinking::precis()</code> function to show the threshold parameters from his <code>m11.1stan</code> model (<strong>R</strong> code 12.24). With a <code>brm()</code> fit, we just use <code>print()</code> or <code>summary()</code> as usual.</p>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1452-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 
##    Data: d (Number of observations: 9930) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -1.92      0.03    -1.97    -1.86 1.00     2425     2274
## Intercept[2]    -1.27      0.02    -1.31    -1.22 1.00     3828     2848
## Intercept[3]    -0.72      0.02    -0.76    -0.68 1.00     4106     3519
## Intercept[4]     0.25      0.02     0.21     0.29 1.00     4635     3143
## Intercept[5]     0.89      0.02     0.85     0.93 1.00     4607     3756
## Intercept[6]     1.77      0.03     1.71     1.83 1.00     4254     3681
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00 1.00     4000     4000
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>What McElreath’s <code>m12.4</code> summary termed <code>cutpoints[k]</code>, our <strong>brms</strong> summary termed <code>Intercept[k]</code>. In both cases, these are the <span class="math inline">\(\alpha_k\)</span> parameters from the formula, above (i.e., the thresholds). The summaries look like those in the text, the <span class="math inline">\(\widehat R\)</span> values are great, and both measures of effective sample size are high. The results looks good.</p>
<p>We can use the <code>brms::inv_logit_scaled()</code> function to get these into the probability metric.</p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1454-1" data-line-number="1">b12<span class="fl">.4</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1454-2" data-line-number="2"><span class="st">  </span><span class="kw">fixef</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1454-3" data-line-number="3"><span class="st">  </span><span class="kw">inv_logit_scaled</span>()</a></code></pre></div>
<pre><code>##               Estimate Est.Error      Q2.5     Q97.5
## Intercept[1] 0.1283074 0.5073187 0.1219904 0.1346918
## Intercept[2] 0.2198609 0.5060240 0.2118940 0.2279523
## Intercept[3] 0.3277441 0.5052919 0.3185029 0.3369117
## Intercept[4] 0.5615558 0.5050178 0.5516214 0.5710280
## Intercept[5] 0.7088031 0.5055075 0.6998148 0.7176410
## Intercept[6] 0.8543686 0.5072299 0.8473217 0.8613109</code></pre>
<p>But recall that the posterior <span class="math inline">\(SD\)</span> (i.e., the ‘Est.Error’ values) are not valid using that approach. If you really care about them, you’ll need to work with the <code>posterior_samples()</code>.</p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1456-1" data-line-number="1"><span class="kw">posterior_samples</span>(b12<span class="fl">.4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1456-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1456-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1456-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1456-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb1456-6" data-line-number="6">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb1456-7" data-line-number="7">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb1456-8" data-line-number="8">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>))</a></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   name            mean      sd    ll    ul
##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept[1] 0.128 0.00328 0.122 0.135
## 2 b_Intercept[2] 0.220 0.00413 0.212 0.228
## 3 b_Intercept[3] 0.328 0.00466 0.319 0.337
## 4 b_Intercept[4] 0.562 0.00494 0.552 0.571
## 5 b_Intercept[5] 0.709 0.00455 0.700 0.718
## 6 b_Intercept[6] 0.854 0.00360 0.847 0.861</code></pre>
<p>Just to confirm, those posterior means are centered right around the <code>cum_pr_k</code> we computed for Figure 12.4.</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1459-1" data-line-number="1">d_plot <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1459-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(response, cum_pr_k)</a></code></pre></div>
<pre><code>##   response  cum_pr_k
## 1        1 0.1282981
## 2        2 0.2198389
## 3        3 0.3276939
## 4        4 0.5616314
## 5        5 0.7088620
## 6        6 0.8543807
## 7        7 1.0000000</code></pre>
<p>To walk out our results even further, we can make <code>b12.4</code>-based version of Figure 12.4.c after formatting our posterior summary a little.</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1461-1" data-line-number="1"><span class="kw">fixef</span>(b12<span class="fl">.4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-3" data-line-number="3"><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;intercept&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">response =</span> <span class="kw">str_extract</span>(intercept, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1461-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> Estimate,</a>
<a class="sourceLine" id="cb1461-7" data-line-number="7">             <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1461-8" data-line-number="8">             <span class="dt">fill =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1461-11" data-line-number="11">             <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1461-14" data-line-number="14">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-16" data-line-number="16"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1461-18" data-line-number="18">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),</a>
<a class="sourceLine" id="cb1461-19" data-line-number="19">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-58-1.png" width="240" style="display: block; margin: auto;" /></p>
<p>Now the dots are the posterior means and the vertical lines layered on top of them are their 95% posterior intervals. Given the large amount of data, the posteriors for our <span class="math inline">\(\alpha_k\)</span> parameters are rather narrow, which is expressed in tightness of those vertical lines.</p>
</div>
<div id="adding-predictor-variables." class="section level3">
<h3><span class="header-section-number">12.3.3</span> Adding predictor variables.</h3>
<p>Now we define the linear model as <span class="math inline">\(\phi_i = \beta x_i\)</span>. Accordingly, the formula for our cumulative logit model becomes</p>
<p><span class="math display">\[\begin{align*}
\log \frac{\operatorname{Pr} (y_i \leq k)}{1 - \operatorname{Pr} (y_i \leq k)} &amp; = \alpha_k - \phi_i \\
\phi_i &amp; = \beta x_i.
\end{align*}\]</span></p>
<blockquote>
<p>This form automatically ensures the correct ordering of the outcome values, while still morphing the likelihood of each individual value as the predictor <span class="math inline">\(x_i\)</span> changes value. Why is the linear model <span class="math inline">\(\phi\)</span> subtracted from each intercept? Because if we decrease the log-cumulative-odds of every outcome value <span class="math inline">\(k\)</span> below the maximum, this necessarily shifts probability mass upwards towards higher outcome values. So then positive values of <span class="math inline">\(\beta\)</span> mean increasing <span class="math inline">\(x\)</span> also increases the mean <span class="math inline">\(y\)</span>. You could add <span class="math inline">\(\phi\)</span> instead like <span class="math inline">\(\alpha_k + \phi_i\)</span>. But then <span class="math inline">\(\beta &gt; 0\)</span> would indicate increasing <span class="math inline">\(x\)</span> decreases the mean. (p. 386)</p>
</blockquote>
<p>I’m not aware that <strong>brms</strong> has an equivalent to the <code>rethinking::dordlogit()</code> function. So here we’ll make it by hand. The code comes from McElreath’s <a href="https://github.com/rmcelreath/rethinking/blob/a309712d904d1db7af1e08a76c521ab994006fd5/R/distributions.r">GitHub repo for <strong>rethinking</strong></a>.</p>
<div class="sourceCode" id="cb1462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1462-1" data-line-number="1">logistic &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1462-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1462-3" data-line-number="3">  p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x))</a>
<a class="sourceLine" id="cb1462-4" data-line-number="4">  p &lt;-<span class="st"> </span><span class="kw">ifelse</span>(x <span class="op">==</span><span class="st"> </span><span class="ot">Inf</span>, <span class="dv">1</span>, p)</a>
<a class="sourceLine" id="cb1462-5" data-line-number="5">  p</a>
<a class="sourceLine" id="cb1462-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1462-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1462-8" data-line-number="8"><span class="co"># now we get down to it</span></a>
<a class="sourceLine" id="cb1462-9" data-line-number="9">dordlogit &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1462-10" data-line-number="10"><span class="st">  </span><span class="cf">function</span>(x, phi, a, <span class="dt">log =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1462-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb1462-12" data-line-number="12">    a  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.numeric</span>(a), <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb1462-13" data-line-number="13">    p  &lt;-<span class="st"> </span><span class="kw">logistic</span>(a[x] <span class="op">-</span><span class="st"> </span>phi)</a>
<a class="sourceLine" id="cb1462-14" data-line-number="14">    na &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, a)</a>
<a class="sourceLine" id="cb1462-15" data-line-number="15">    np &lt;-<span class="st"> </span><span class="kw">logistic</span>(na[x] <span class="op">-</span><span class="st"> </span>phi)</a>
<a class="sourceLine" id="cb1462-16" data-line-number="16">    p  &lt;-<span class="st"> </span>p <span class="op">-</span><span class="st"> </span>np</a>
<a class="sourceLine" id="cb1462-17" data-line-number="17">    <span class="cf">if</span> (log <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) p &lt;-<span class="st"> </span><span class="kw">log</span>(p)</a>
<a class="sourceLine" id="cb1462-18" data-line-number="18">    p</a>
<a class="sourceLine" id="cb1462-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb1462-20" data-line-number="20">  }</a></code></pre></div>
<p>The <code>dordlogit()</code> function works like this:</p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1463-1" data-line-number="1">pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b12<span class="fl">.4</span>)[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1463-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1463-3" data-line-number="3">pk <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1463-4" data-line-number="4"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 0.13 0.09 0.11 0.23 0.15 0.15 0.15</code></pre>
<p>Note the slight difference in how we used <code>dordlogit()</code> with a <code>brm()</code> fit summarized by <code>fixef()</code> than the way McElreath did with a <code>ulam()</code> fit summarized by <code>coef()</code>. McElreath just put <code>coef(m12.4)</code> into <code>dordlogit()</code>. We, however, more specifically placed <code>fixef(b12.4)[, 1]</code> into the function. With the <code>[, 1]</code> part, we specified that we were working with the posterior means (i.e., <code>Estimate</code>) and neglecting the other summaries (i.e., the posterior <em>SD</em>s and 95% intervals). If you forget to subset, chaos ensues.</p>
<p>Next, as McElreath further noted on page 338, “these probabilities imply an average outcome of:”</p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1465-1" data-line-number="1"><span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a></code></pre></div>
<pre><code>## [1] 4.19936</code></pre>
<p>I found that a bit abstract. Here’s the thing in a more elaborate tibble format.</p>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1467-1" data-line-number="1">(</a>
<a class="sourceLine" id="cb1467-2" data-line-number="2">  explicit_example &lt;-</a>
<a class="sourceLine" id="cb1467-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">probability_of_a_response =</span> pk) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1467-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">the_response =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1467-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">their_product =</span> probability_of_a_response <span class="op">*</span><span class="st"> </span>the_response)</a>
<a class="sourceLine" id="cb1467-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   probability_of_a_response the_response their_product
##                       &lt;dbl&gt;        &lt;int&gt;         &lt;dbl&gt;
## 1                    0.128             1         0.128
## 2                    0.0916            2         0.183
## 3                    0.108             3         0.324
## 4                    0.234             4         0.935
## 5                    0.147             5         0.736
## 6                    0.146             6         0.873
## 7                    0.146             7         1.02</code></pre>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1469-1" data-line-number="1">explicit_example <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1469-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_outcome_value =</span> <span class="kw">sum</span>(their_product))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   average_outcome_value
##                   &lt;dbl&gt;
## 1                  4.20</code></pre>
<p>Now we’ll try it by subtracting .5 from each.</p>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1471-1" data-line-number="1"><span class="co"># the probabilities of a given response</span></a>
<a class="sourceLine" id="cb1471-2" data-line-number="2">pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b12<span class="fl">.4</span>)[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb1471-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1471-4" data-line-number="4">pk <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1471-5" data-line-number="5"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 0.08 0.06 0.08 0.21 0.16 0.18 0.22</code></pre>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1473-1" data-line-number="1"><span class="co"># the average rating</span></a>
<a class="sourceLine" id="cb1473-2" data-line-number="2"><span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a></code></pre></div>
<pre><code>## [1] 4.729837</code></pre>
<p>So the rule is we <em>subtract the linear model from each intercept</em>. “This way, a positive <span class="math inline">\(\beta\)</span> value indicates that an increase in the predictor variable <span class="math inline">\(x\)</span> results in an increase in the average response” (p. 387). Happily, even though this makes for a somewhat confusing statistical formula, we still enter our predictor terms into the <code>brm()</code> <code>formula</code> argument much the same way we always have. As to our upcoming model, we might express the statistical formula as</p>
<p><span class="math display">\[\begin{align*} 
\text{response}_i &amp; \sim \operatorname{Categorical} (\mathbf p) \\
\text{logit}(p_k)     &amp; = \alpha_k - \phi_i \\
\phi_i                &amp; = \beta_1 \text{action}_i + \beta_2 \text{contact}_i +  (\beta_3 + \beta_4 \text{action}_i + \beta_5 \text{contact}_i) \text{intention}_i \\
\alpha_k              &amp; \sim \operatorname{Normal}(0, 1.5) \\
\beta_1, ..., \beta_5 &amp; \sim \operatorname{Normal}(0, 0.5),
\end{align*}\]</span></p>
<p>where, because we have included predictors, <span class="math inline">\(\phi\)</span> is no longer set to 0. Using our skills from back in <a href="conditional-manatees.html#conditional-manatees">Chapter 8</a>, we might also rewrite the linear model for <span class="math inline">\(\phi\)</span> as</p>
<p><span class="math display">\[\phi_i = \beta_1 \text{action}_i + \beta_2 \text{contact}_i + \beta_3 \text{intention}_i + \beta_4 (\text{action}_i \times \text{intention}_i) + \beta_5 (\text{contact}_i \times \text{intention}_i).\]</span></p>
<p>Let’s fit the model.</p>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1475-1" data-line-number="1">b12<span class="fl">.5</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1475-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1475-3" data-line-number="3">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1475-4" data-line-number="4">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>intention<span class="op">:</span>action <span class="op">+</span><span class="st"> </span>intention<span class="op">:</span>contact,</a>
<a class="sourceLine" id="cb1475-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1475-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b)),</a>
<a class="sourceLine" id="cb1475-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1475-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1475-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.05&quot;</span>)</a></code></pre></div>
<p>There are ways with <strong>brms</strong> to mirror how McElreath coded his <code>phi &lt;- bA*A + bC*C + BI*I</code> and <code>BI &lt;- bI + bIA*A + bIC*C</code>. Here we just used a more conventional style of syntax. Behold the summary.</p>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1476-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 + action + contact + intention + intention:action + intention:contact 
##    Data: d (Number of observations: 9930) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]         -2.64      0.05    -2.73    -2.54 1.00     2743     2617
## Intercept[2]         -1.94      0.05    -2.03    -1.85 1.00     2909     2531
## Intercept[3]         -1.35      0.04    -1.43    -1.26 1.00     2839     2458
## Intercept[4]         -0.31      0.04    -0.40    -0.23 1.00     2777     2761
## Intercept[5]          0.36      0.04     0.28     0.44 1.00     2723     2766
## Intercept[6]          1.26      0.05     1.17     1.36 1.00     2890     2832
## action               -0.48      0.05    -0.58    -0.37 1.00     2778     2893
## contact              -0.35      0.07    -0.47    -0.22 1.00     2913     2764
## intention            -0.30      0.06    -0.40    -0.19 1.00     2754     2926
## action:intention     -0.43      0.08    -0.58    -0.27 1.00     2868     2828
## contact:intention    -1.23      0.10    -1.42    -1.05 1.00     2889     2759
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00 1.00     4000     4000
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>For a little variety, we’ll make our coefficient plot with a little help from the <code>tidybayes::stat_gradientinterval()</code> function.</p>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1478-1" data-line-number="1">labs &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;beta[&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="st">&quot;]&quot;</span>)</a>
<a class="sourceLine" id="cb1478-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1478-3" data-line-number="3"><span class="kw">posterior_samples</span>(b12<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1478-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(b_action<span class="op">:</span><span class="st">`</span><span class="dt">b_contact:intention</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1478-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(labs) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1478-6" data-line-number="6"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1478-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb1478-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1478-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1478-10" data-line-number="10"><span class="st">  </span><span class="kw">stat_gradientinterval</span>(<span class="dt">.width =</span> <span class="fl">.5</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">point_size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">21</span>,</a>
<a class="sourceLine" id="cb1478-11" data-line-number="11">                        <span class="dt">point_fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>], </a>
<a class="sourceLine" id="cb1478-12" data-line-number="12">                        <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb1478-13" data-line-number="13">                        <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1478-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;marginal posterior&quot;</span>, <span class="dt">breaks =</span> <span class="dv">-5</span><span class="op">:</span><span class="dv">0</span> <span class="op">/</span><span class="st"> </span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1478-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> labs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1478-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">1.4</span>, <span class="dv">0</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>As always, this will all be easier to see if we plot the posterior predictions. There is no perfect way to plot the predictions of these log-cumulative-odds models. Why? Because each prediction is really a vector of probabilities, one for each possible outcome value. So as a predictor variable changes value, the entire vector changes. This kind of thing can be visualized in several different ways. (p. 388)</p>
</blockquote>
<p>Our approach to making the top panels of Figure 12.6 will start with <code>fitted()</code>.</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1479-1" data-line-number="1">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1479-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1479-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(action, contact, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1479-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">combination =</span> <span class="kw">str_c</span>(action, contact, intention, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))</a>
<a class="sourceLine" id="cb1479-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1479-6" data-line-number="6">f &lt;-</a>
<a class="sourceLine" id="cb1479-7" data-line-number="7"><span class="st">  </span><span class="kw">fitted</span>(b12<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1479-8" data-line-number="8">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1479-9" data-line-number="9">         <span class="dt">summary =</span> F)</a>
<a class="sourceLine" id="cb1479-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1479-11" data-line-number="11"><span class="co"># what have we done?</span></a>
<a class="sourceLine" id="cb1479-12" data-line-number="12">f <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:4000, 1:6, 1:7] 0.0818 0.0937 0.0922 0.0936 0.0985 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ : NULL
##   ..$ : NULL
##   ..$ : chr [1:7] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<p>That returned a three-dimensional array. The 4,000 rows correspond to the 4,000 post-warmup iterations. The six columns correspond to the six unique combinations of <code>action</code>, <code>contact</code>, and <code>intention</code> within the data (i.e., <code>d %&gt;% distinct(action, contact, intention)</code>). The three levels of the third dimension correspond to the seven levels of our <code>response</code> variable. This is all the information we need to plot our posterior in the triptych in the top row of Figure 12.6. It will take a bit of tricky wrangling to get it into a useful format. Our first several steps have to do with arranging the data into a long tibble format.</p>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1481-1" data-line-number="1">f &lt;-</a>
<a class="sourceLine" id="cb1481-2" data-line-number="2"><span class="st">  </span><span class="kw">rbind</span>(f[, , <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1481-3" data-line-number="3">        f[, , <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1481-4" data-line-number="4">        f[, , <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1481-5" data-line-number="5">        f[, , <span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1481-6" data-line-number="6">        f[, , <span class="dv">5</span>],</a>
<a class="sourceLine" id="cb1481-7" data-line-number="7">        f[, , <span class="dv">6</span>],</a>
<a class="sourceLine" id="cb1481-8" data-line-number="8">        f[, , <span class="dv">7</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1481-9" data-line-number="9"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1481-10" data-line-number="10"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, combination)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1481-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">response =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1481-12" data-line-number="12">         <span class="dt">iter     =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">times =</span> <span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1481-13" data-line-number="13"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(iter, response),</a>
<a class="sourceLine" id="cb1481-14" data-line-number="14">               <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</a>
<a class="sourceLine" id="cb1481-15" data-line-number="15">               <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>,</a>
<a class="sourceLine" id="cb1481-16" data-line-number="16">               <span class="dt">values_to =</span> <span class="st">&quot;pk&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1481-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.integer</span>())</a>
<a class="sourceLine" id="cb1481-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1481-19" data-line-number="19"><span class="co"># how do the data look, now?</span></a>
<a class="sourceLine" id="cb1481-20" data-line-number="20"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 168,000
## Columns: 6
## $ response  &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ iter      &lt;int&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5,…
## $ action    &lt;chr&gt; &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;, &quot;1&quot;, &quot;0&quot;,…
## $ contact   &lt;chr&gt; &quot;1&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;,…
## $ intention &lt;int&gt; 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1,…
## $ pk        &lt;dbl&gt; 0.08177003, 0.33149119, 0.10441114, 0.06330260, 0.18715418, 0.08440229, 0.09373010, 0.307…</code></pre>
<p>We’re moving pretty quickly, here. If it wasn’t apparent, the original values in the <code>f</code> data were in the probability metric. This is why we followed the convention from earlier in this section and named them <code>pk</code>. However, we need them to be in the cumulative-probability metric to make the top panels of the figure.</p>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1483-1" data-line-number="1"><span class="co"># to order our factor levels for `facet`</span></a>
<a class="sourceLine" id="cb1483-2" data-line-number="2">levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;action=0, contact=0&quot;</span>, <span class="st">&quot;action=1, contact=0&quot;</span>, <span class="st">&quot;action=0, contact=1&quot;</span>)</a>
<a class="sourceLine" id="cb1483-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1483-4" data-line-number="4">p1 &lt;-</a>
<a class="sourceLine" id="cb1483-5" data-line-number="5"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-6" data-line-number="6"><span class="st">  </span><span class="co"># unnecessary for these plots</span></a>
<a class="sourceLine" id="cb1483-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(response <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-8" data-line-number="8"><span class="st">  </span><span class="co"># this will help us define the three panels of the triptych</span></a>
<a class="sourceLine" id="cb1483-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact),</a>
<a class="sourceLine" id="cb1483-10" data-line-number="10">                        <span class="dt">levels =</span> levels)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-11" data-line-number="11"><span class="st">  </span><span class="co"># these next three lines allow us to compute the cumulative probabilities</span></a>
<a class="sourceLine" id="cb1483-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(iter, facet, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-13" data-line-number="13"><span class="st">  </span><span class="kw">arrange</span>(iter, facet, intention, response) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(pk)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-15" data-line-number="15"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-16" data-line-number="16"><span class="st">  </span><span class="co"># these next three lines are how we randomly selected 50 posterior draws</span></a>
<a class="sourceLine" id="cb1483-17" data-line-number="17"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">data =</span> <span class="op">-</span>iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-18" data-line-number="18"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1483-19" data-line-number="19"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-20" data-line-number="20"><span class="st">  </span></a>
<a class="sourceLine" id="cb1483-21" data-line-number="21"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1483-22" data-line-number="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> probability)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, response), <span class="dt">color =</span> probability),</a>
<a class="sourceLine" id="cb1483-24" data-line-number="24">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># wrangle the original data to make the dots</span></a>
<a class="sourceLine" id="cb1483-26" data-line-number="26"><span class="st">               </span><span class="kw">group_by</span>(intention, contact, action) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-27" data-line-number="27"><span class="st">               </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-28" data-line-number="28"><span class="st">               </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)),</a>
<a class="sourceLine" id="cb1483-29" data-line-number="29">                      <span class="dt">facet =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact),</a>
<a class="sourceLine" id="cb1483-30" data-line-number="30">                                     <span class="dt">levels =</span> levels)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1483-31" data-line-number="31"><span class="st">               </span><span class="kw">filter</span>(response <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1483-32" data-line-number="32">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-33" data-line-number="33"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1483-34" data-line-number="34">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-35" data-line-number="35"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-36" data-line-number="36"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-37" data-line-number="37"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1483-38" data-line-number="38"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</a></code></pre></div>
<p>We will look at the results of our code in just a bit. For now, we’ll focus on the code for the triptych in the bottom panels of Figure 12.6. These plots will be based on <code>predict()</code>.</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1484-1" data-line-number="1">p &lt;-</a>
<a class="sourceLine" id="cb1484-2" data-line-number="2"><span class="st">  </span><span class="kw">predict</span>(b12<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1484-3" data-line-number="3">          <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1484-4" data-line-number="4">          <span class="dt">nsamples =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb1484-5" data-line-number="5">          <span class="dt">scale =</span> <span class="st">&quot;response&quot;</span>,</a>
<a class="sourceLine" id="cb1484-6" data-line-number="6">          <span class="dt">summary =</span> F)</a>
<a class="sourceLine" id="cb1484-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1484-8" data-line-number="8">p <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:1000, 1:6] 3 1 5 7 1 4 1 7 2 2 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL
##  - attr(*, &quot;levels&quot;)= chr [1:7] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<p>This time we have a simple two-dimensional array. There are only 1,000 rows because we set <code>nsamples = 1000</code>. Much like with <code>fitted()</code>, above, the six columns correspond to the sex unique combinations of our three predictor variables. With the <code>scale = &quot;response&quot;</code> argument, we requested our results were in the metric of the original data, which were <code>response</code> values ranging from <code>1</code> to <code>7</code>. Compared to the last plot, the post-<code>predict()</code> data wrangling for this triptych is low-key. We just need the data in a long tibble format that includes a variable with which we might facet.</p>
<div class="sourceCode" id="cb1486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1486-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb1486-2" data-line-number="2"><span class="st">  </span>p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1486-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1486-4" data-line-number="4"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, combination)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1486-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb1486-6" data-line-number="6">               <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</a>
<a class="sourceLine" id="cb1486-7" data-line-number="7">               <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>,</a>
<a class="sourceLine" id="cb1486-8" data-line-number="8">               <span class="dt">values_to =</span> <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1486-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact),</a>
<a class="sourceLine" id="cb1486-10" data-line-number="10">                        <span class="dt">levels =</span> levels)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1486-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb1486-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">fill =</span> intention)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1486-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">width =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">.4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1486-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1486-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1486-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1486-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</a></code></pre></div>
<p>Finally, we’re ready to combine our two triptychs into one glorious remake of Figure 12.6.</p>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1487-1" data-line-number="1">p1 <span class="op">/</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-71-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Just for kicks and giggles, I’d like to make an alternative version of Figure 12.6. The triptych on the top panels did a pretty good job depicting the model in terms of the thresholds, <span class="math inline">\(\alpha_k\)</span>. It’s important that we, the data analysts, have a good sense of what those are. However, I suspect many of our substantively-oriented colleagues will find themselves confused by a plot like that. In my field, people generally just want to know <em>What’s the mean for each group?</em> At this point, you and I know that such a question is a bit impoverished compared the to the rich output from a model like this. But if we do want to boil these analyses down to comparisons of means, McElreath has already showed us how. Look back to <strong>R</strong> code 12.20 through 12.23 (pp. 386–387). In those blocks, we multiplied the vector of probability values (<code>pk</code>) by their respective <code>response</code> values and summed, which produced an average outcome value. We can use that same approach so that our top triptych might express the results of the model in terms of means rather than parameters. All it takes is a slightly amended wrangling workflow with respect to the <code>f</code> data.</p>
<div class="sourceCode" id="cb1488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1488-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1488-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact),</a>
<a class="sourceLine" id="cb1488-4" data-line-number="4">                        <span class="dt">levels =</span> levels)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(iter, facet, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_response =</span> <span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>response)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-8" data-line-number="8"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">data =</span> <span class="op">-</span>iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1488-9" data-line-number="9"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1488-10" data-line-number="10"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1488-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1488-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter, <span class="dt">color =</span> mean_response),</a>
<a class="sourceLine" id="cb1488-14" data-line-number="14">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1488-16" data-line-number="16">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;resopnse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1488-20" data-line-number="20"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</a></code></pre></div>
<p>I really like how intuitive the histograms were in McElreath’s bottom triptych. A limitation of that approach, however, is there is no direct expression of uncertainty. To address this, we might recall that the bars in the histogram are basically just reparameterizations of the <code>pk</code> values already in our <code>f</code> data and, happily, our vector of <code>pk</code> values already contains the uncertainty in the posterior. One way we might express that is with the <code>tidybayes::stat_ccdfinterval()</code> function, which will return a bar plot where the top parts of the bars depict our uncertainty in terms of cumulative density curves.</p>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1489-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb1489-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1489-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">facet =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;action=&quot;</span>, action, <span class="st">&quot;, contact=&quot;</span>, contact),</a>
<a class="sourceLine" id="cb1489-4" data-line-number="4">                        <span class="dt">levels =</span> levels)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1489-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1489-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> pk, <span class="dt">fill =</span> <span class="kw">factor</span>(intention))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_ccdfinterval</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">justification =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, </a>
<a class="sourceLine" id="cb1489-8" data-line-number="8">                    <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">point_fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>], <span class="dt">point_size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1489-9" data-line-number="9">                    <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">width =</span> <span class="fl">.75</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;resopnse&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;count&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="dv">10</span>, <span class="dt">labels =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1489-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>facet)</a></code></pre></div>
<p>Here’s our alternative plot.</p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1490-1" data-line-number="1">p1 <span class="op">/</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-74-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>I suspect our <code>stat_ccdfinterval()</code> approach would work better in plots with fewer bars. But hopefully it gives you some ideas.</p>
<div id="rethinking-staring-into-the-abyss." class="section level4">
<h4><span class="header-section-number">12.3.3.1</span> Rethinking: Staring into the abyss.</h4>
<blockquote>
<p>The plotting code for ordered logistic models is complicated, compared to that of models from previous chapters. But as models become more monstrous, so too does the code needed to compute predictions and display them. With power comes hardship. It’s better to see the guts of the machine than to live in awe or fear of it. (p. 391)</p>
</blockquote>
</div>
</div>
</div>
<div id="ordered-categorical-predictors" class="section level2">
<h2><span class="header-section-number">12.4</span> Ordered categorical predictors</h2>
<blockquote>
<p>We can handle ordered outcome variables using a categorical model with a cumulative link. That was the previous section. What about ordered predictor variables? We could just include them as continuous predictors like in any linear model. But this isn’t ideal. Just
like with ordered outcomes, we don’t really want to assume that the distance between each ordinal value is the same. Luckily, we don’t have to. (p. 391)</p>
</blockquote>
<p>Here are the eight levels of <code>edu</code>.</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1491-1" data-line-number="1"><span class="kw">distinct</span>(d, edu)</a></code></pre></div>
<pre><code>##                    edu
## 1        Middle School
## 2    Bachelor&#39;s Degree
## 3         Some College
## 4      Master&#39;s Degree
## 5 High School Graduate
## 6      Graduate Degree
## 7     Some High School
## 8    Elementary School</code></pre>
<p>McElreath defined his <code>edu_new</code> variable with an impressively compact couple lines of code. I’m going to take a more explicit approach with the <code>dplyr::recode()</code> function.</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1493-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb1493-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1493-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">edu_new =</span> </a>
<a class="sourceLine" id="cb1493-4" data-line-number="4">           <span class="kw">recode</span>(edu,</a>
<a class="sourceLine" id="cb1493-5" data-line-number="5">                  <span class="st">&quot;Elementary School&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1493-6" data-line-number="6">                  <span class="st">&quot;Middle School&quot;</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1493-7" data-line-number="7">                  <span class="st">&quot;Some High School&quot;</span> =<span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1493-8" data-line-number="8">                  <span class="st">&quot;High School Graduate&quot;</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1493-9" data-line-number="9">                  <span class="st">&quot;Some College&quot;</span> =<span class="st"> </span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb1493-10" data-line-number="10">                  <span class="st">&quot;Bachelor&#39;s Degree&quot;</span> =<span class="st"> </span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb1493-11" data-line-number="11">                  <span class="st">&quot;Master&#39;s Degree&quot;</span> =<span class="st"> </span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1493-12" data-line-number="12">                  <span class="st">&quot;Graduate Degree&quot;</span> =<span class="st"> </span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1493-13" data-line-number="13"><span class="st">           </span><span class="kw">as.integer</span>())</a>
<a class="sourceLine" id="cb1493-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1493-15" data-line-number="15"><span class="co"># what did we do?</span></a>
<a class="sourceLine" id="cb1493-16" data-line-number="16">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1493-17" data-line-number="17"><span class="st">  </span><span class="kw">distinct</span>(edu, edu_new) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1493-18" data-line-number="18"><span class="st">  </span><span class="kw">arrange</span>(edu_new)</a></code></pre></div>
<pre><code>##                    edu edu_new
## 1    Elementary School       1
## 2        Middle School       2
## 3     Some High School       3
## 4 High School Graduate       4
## 5         Some College       5
## 6    Bachelor&#39;s Degree       6
## 7      Master&#39;s Degree       7
## 8      Graduate Degree       8</code></pre>
<p>The prior often used to handle monotonic effects is the Dirichlet distribution. The Dirichlet distribution is the multivariate extension of the beta distribution, which we met back in <a href="monsters-and-mixtures.html#beta-binomial.">Section 12.1.1</a>. Here we follow McElreath’s <strong>R</strong> code 12.32 to simulate a few draws from the Dirichlet distribution.</p>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1495-1" data-line-number="1"><span class="kw">library</span>(gtools)</a>
<a class="sourceLine" id="cb1495-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1805</span>)</a>
<a class="sourceLine" id="cb1495-3" data-line-number="3">delta &lt;-<span class="st"> </span><span class="kw">rdirichlet</span>(<span class="dv">10</span>, <span class="dt">alpha =</span> <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)) </a>
<a class="sourceLine" id="cb1495-4" data-line-number="4"><span class="kw">str</span>(delta)</a></code></pre></div>
<pre><code>##  num [1:10, 1:7] 0.1053 0.2504 0.1917 0.1241 0.0877 ...</code></pre>
<p>Plot <code>delta</code> with <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb1497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1497-1" data-line-number="1">delta <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1497-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1497-3" data-line-number="3"><span class="st">  </span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1497-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1497-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>row, <span class="dt">names_to =</span> <span class="st">&quot;index&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1497-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1497-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> index, <span class="dt">y =</span> value, <span class="dt">group =</span> row,</a>
<a class="sourceLine" id="cb1497-8" data-line-number="8">             <span class="dt">alpha =</span> row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, <span class="dt">color =</span> row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-13" data-line-number="13"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1497-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-78-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>The <strong>brms</strong> package has a <code>rdirichlet()</code> function, too. Here we use that to make an alternative version of the plot, above.</p>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1498-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb1498-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1498-3" data-line-number="3">brms<span class="op">::</span><span class="kw">rdirichlet</span>(<span class="dt">n =</span> <span class="fl">1e4</span>,</a>
<a class="sourceLine" id="cb1498-4" data-line-number="4">                 <span class="dt">alpha =</span> <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-6" data-line-number="6"><span class="st">  </span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name  =</span> name <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb1498-9" data-line-number="9">         <span class="dt">alpha =</span> <span class="kw">str_c</span>(<span class="st">&quot;alpha[&quot;</span>, name, <span class="st">&quot;]&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb1498-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">color =</span> name, <span class="dt">group =</span> name, <span class="dt">fill=</span> name)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1498-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1498-14" data-line-number="14">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1498-16" data-line-number="16">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1498-18" data-line-number="18">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), ) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;Dirichlet&quot;</span><span class="op">*</span>(<span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="dv">2</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-21" data-line-number="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1498-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>alpha, <span class="dt">labeller =</span> label_parsed, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-79-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>When using <strong>brms</strong>, the issue of treating a predictor in the way McElreath covered in this section is referred to as <strong>monotonic effects</strong>. Bürkner outlined the issue in his <span class="citation">(<a href="#ref-Bürkner2020Monotonic">2020</a><a href="#ref-Bürkner2020Monotonic">e</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_monotonic.html"><em>Estimating monotonic effects with with brms</em></a>, and in his <span class="citation">(<a href="#ref-burknerModellingMonotonicEffects2020">2020</a>)</span> article with Emmanuel Charpentier, <em>Modelling monotonic effects of ordinal predictors in Bayesian regression models</em> (click <a href="https://psyarxiv.com/9qkhj/">here</a> for the freely-available preprint). From the introduction in Bürkner’s vignette, we read:</p>
<blockquote>
<p>For a single monotonic predictor, <span class="math inline">\(x\)</span>, the linear predictor term of observation <span class="math inline">\(n\)</span> looks as follows:</p>
<p><span class="math display">\[\eta_n = b_D \sum_{i = 1}^{x_n} \zeta_i\]</span></p>
<p>The parameter <span class="math inline">\(b\)</span> can take on any real value, while <span class="math inline">\(\zeta\)</span> is a simplex, which means that it satisfies <span class="math inline">\(\zeta_i \in [0, 1]\)</span> and <span class="math inline">\(\sum_{i = 1}^D \zeta_i = 1\)</span> with <span class="math inline">\(D\)</span> being the number of elements of <span class="math inline">\(\zeta\)</span>. Equivalently, <span class="math inline">\(D\)</span> is the number of categories (or highest integer in the data) minus 1, since we start counting categories from zero to simplify the notation.</p>
</blockquote>
<p>In this context, <span class="math inline">\(n\)</span> indexes the observations in the hypothetical data and <span class="math inline">\(\eta\)</span> denotes the linear model for some outcome <span class="math inline">\(y\)</span>. Unlike with <strong>rethinking</strong>, the <strong>brms</strong> syntax for fitting models with monotonic predictors is fairly simple. Just place your monotonic predictors within the <code>mo()</code> function and enter them into the <code>formula</code>. Here we fit our first monotonic model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1499-1" data-line-number="1">b12<span class="fl">.6</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1499-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1499-3" data-line-number="3">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1499-4" data-line-number="4">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span><span class="kw">mo</span>(edu_new),  <span class="co"># note the `mo()` syntax</span></a>
<a class="sourceLine" id="cb1499-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1499-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1499-7" data-line-number="7">                <span class="co"># note the new kinds of prior statements</span></a>
<a class="sourceLine" id="cb1499-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.143</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> moedu_new),</a>
<a class="sourceLine" id="cb1499-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">dirichlet</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">class =</span> simo, <span class="dt">coef =</span> moedu_new1)),</a>
<a class="sourceLine" id="cb1499-10" data-line-number="10">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1499-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1499-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.06&quot;</span>)</a></code></pre></div>
<p>In the text, McElreath remarked it took about 20 minutes to fit this model in his computer. Using my 2019 MacBook Pro, it took just under 40 minutes. Mind you, our <strong>brms</strong> version of the model used twice the number of warmup and post-warmup iterations, so this isn’t a knock against the sampling speed of <strong>brms</strong> versus <strong>rethinking</strong>. But either way, get ready to wait a while when fitting a model like this. Here’s the summary.</p>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1500-1" data-line-number="1"><span class="kw">print</span>(b12<span class="fl">.6</span>)</a></code></pre></div>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 + action + contact + intention + mo(edu_new) 
##    Data: d (Number of observations: 9930) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -3.12      0.16    -3.47    -2.85 1.00     1898     2057
## Intercept[2]    -2.44      0.16    -2.78    -2.17 1.00     1913     2064
## Intercept[3]    -1.86      0.16    -2.20    -1.59 1.00     1900     2020
## Intercept[4]    -0.84      0.15    -1.18    -0.57 1.00     1923     2157
## Intercept[5]    -0.17      0.15    -0.51     0.09 1.00     1906     2171
## Intercept[6]     0.74      0.15     0.39     1.01 1.00     1961     2159
## action          -0.71      0.04    -0.79    -0.63 1.00     3962     2843
## contact         -0.96      0.05    -1.06    -0.86 1.00     3993     2745
## intention       -0.72      0.04    -0.79    -0.65 1.00     4772     2936
## moedu_new       -0.05      0.02    -0.11    -0.01 1.00     1851     2001
## 
## Simplex Parameters: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## moedu_new1[1]     0.25      0.15     0.04     0.58 1.00     2649     2676
## moedu_new1[2]     0.14      0.09     0.02     0.36 1.00     3934     2171
## moedu_new1[3]     0.19      0.11     0.03     0.43 1.00     3827     2589
## moedu_new1[4]     0.17      0.09     0.03     0.39 1.00     3466     2598
## moedu_new1[5]     0.04      0.04     0.00     0.12 1.00     2925     2369
## moedu_new1[6]     0.09      0.06     0.01     0.25 1.00     4047     2926
## moedu_new1[7]     0.12      0.08     0.02     0.30 1.00     4027     2804
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00 1.00     4000     4000
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If you compare our results to those in the text, you may be surprised by how small our summary values are for <code>moedu_new</code>. <strong>brms</strong> and <strong>rethinking</strong> have an important difference in how they parameterize <span class="math inline">\(\beta_\text{Education}\)</span>. From page 392 in the text, McElreath explained the</p>
<blockquote>
<p>sum of all the <span class="math inline">\(\delta\)</span> parameters is the maximum education effect. It will be very convenient for interpretation if we call this maximum sum an ordinary coefficient like <span class="math inline">\(\beta_\text{E}\)</span> and then let the <span class="math inline">\(\delta\)</span> parameters be fractions of it. If we also make a dummy <span class="math inline">\(\delta_0 = 0\)</span> then we can write it all very compactly. Like this:</p>
<p><span class="math display">\[\phi_i = \beta_\text{E} \sum_{j = 0}^{\text{E}_i - 1} \delta_j + \text{other stuff}\]</span></p>
<p>where <span class="math inline">\(\text{E}_i\)</span> is the completed education level of individual <span class="math inline">\(i\)</span>. Now the sum of every <span class="math inline">\(\delta_j\)</span> is 1, and we can interpret the maximum education effect by looking at <span class="math inline">\(\beta_\text{E}\)</span>.</p>
</blockquote>
<p>The current version of <strong>brms</strong> takes expresses <span class="math inline">\(\beta_\text{E}\)</span> as an average effect. From <span class="citation">Bürkner &amp; Charpentier (<a href="#ref-burknerModellingMonotonicEffects2020">2020</a>)</span>, we read:</p>
<blockquote>
<p>If the monotonic effect is used in a linear model, <span class="math inline">\(b\)</span> can be interpreted as the expected average difference between two adjacent categories of <span class="math inline">\(x\)</span>, while <span class="math inline">\(\zeta_i\)</span> describes the expected difference between the categories <span class="math inline">\(i\)</span> and <span class="math inline">\(i - 1\)</span> in the form of a proportion of the overall difference between lowest and highest categories. Thus, this parameterization has an intuitive interpretation while guaranteeing the monotonicity of the effect (p. 6)</p>
</blockquote>
<p>To clarify, the <span class="math inline">\(b\)</span> in this section is what we’re calling <span class="math inline">\(\beta_\text{E}\)</span> in the current example and Bürkner and Charpentier used <span class="math inline">\(\zeta_i\)</span> in place of McElreath’s <span class="math inline">\(\delta_j\)</span>. The upshot of all this is that if we’d like to compare the summary of our <code>b12.6</code> to the results McElreath reported for his <code>m12.6</code>, we’ll need to multiply our <code>moedu_new</code> by 7.</p>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1502-1" data-line-number="1"><span class="kw">posterior_samples</span>(b12<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1502-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">bE =</span> bsp_moedu_new <span class="op">*</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1502-3" data-line-number="3"><span class="st">  </span><span class="kw">median_qi</span>(<span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1502-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##      bE .lower .upper .width .point .interval
## 1 -0.35  -0.65  -0.11   0.89 median        qi</code></pre>
<p>This parameterization difference between <strong>brms</strong> and <strong>rethinking</strong> is also the reason why we set <code>prior(normal(0, 0.143), class = b, coef = moedu_new)</code> within <code>b12.6</code> where as McElreath used a <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> prior for all his <span class="math inline">\(\beta\)</span> coefficients, including for his <code>bE</code>. Because our <code>moedu_new</code> (i.e., <span class="math inline">\(\beta_\text{E}\)</span>) is parameterized as the average of seven <span class="math inline">\(\delta\)</span> parameters, it made sense to divide our hyperparameter for <span class="math inline">\(\sigma\)</span> by 7. That is, <span class="math inline">\(1 / 7 \approx 0.143\)</span>.</p>
<p>This might be a good place to practice expressing our model in formal statistical notation. Here we’ll complement McElreath’s formula from page 392 by mixing in a little notation from <span class="citation">Bürkner &amp; Charpentier (<a href="#ref-burknerModellingMonotonicEffects2020">2020</a>)</span>:</p>
<p><span class="math display">\[\begin{align*} 
\text{response}_i &amp; \sim \operatorname{Categorical} (\mathbf p) \\
\text{logit}(p_k)    &amp; = \alpha_k - \phi_i \\
\phi_i               &amp; = \beta_1 \text{action}_i + \beta_2 \text{contact}_i + \beta_3 \text{intention}_i + \beta_4 \operatorname{mo}(\text{edu_new}_i, \boldsymbol{\delta}) \\
\alpha_k             &amp; \sim \operatorname{Normal}(0, 1.5) \\
\beta_1,..., \beta_3 &amp; \sim \operatorname{Normal}(0, 1) \\
\beta_4              &amp; \sim \operatorname{Normal}(0, 0.143) \\
\boldsymbol{\delta}  &amp; \sim \operatorname{Dirichlet}(2, 2, 2, 2, 2, 2, 2),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\operatorname{mo}(x, \boldsymbol{\delta})\)</span> is an operator indicating some predictor <span class="math inline">\(x\)</span> is has undergone the monotonic transform and <span class="math inline">\(\boldsymbol{\delta}\)</span> is our vector of simplex parameters <span class="math inline">\(\delta_1,..., \delta_7\)</span>. That is, <span class="math inline">\(\beta_4 \operatorname{mo}(\text{edu_new}_i, \boldsymbol{\delta})\)</span> is our alternative <strong>brms</strong>-oriented way of expressing McElreath’s <span class="math inline">\(\beta_\text{E} \sum_{j = 0}^{\text{E}_i - 1} \delta_j\)</span>. I don’t know that one is better. 🤷🏻 At first contact, I found them both confusing.</p>
<p>Since this will be our only pairs plot for this chapter, let’s use <code>GGally::ggpairs()</code> to make it fancy. First we customize the panels.</p>
<div class="sourceCode" id="cb1504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1504-1" data-line-number="1">my_lower &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb1504-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1504-3" data-line-number="3">  <span class="co"># get the x and y data to use the other code</span></a>
<a class="sourceLine" id="cb1504-4" data-line-number="4">  x &lt;-<span class="st"> </span><span class="kw">eval_data_col</span>(data, mapping<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb1504-5" data-line-number="5">  y &lt;-<span class="st"> </span><span class="kw">eval_data_col</span>(data, mapping<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb1504-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1504-7" data-line-number="7">  <span class="co"># compute the correlations</span></a>
<a class="sourceLine" id="cb1504-8" data-line-number="8">  corr &lt;-<span class="st"> </span><span class="kw">cor</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;p&quot;</span>, <span class="dt">use =</span> <span class="st">&quot;pairwise&quot;</span>)</a>
<a class="sourceLine" id="cb1504-9" data-line-number="9">  abs_corr &lt;-<span class="st"> </span><span class="kw">abs</span>(corr)</a>
<a class="sourceLine" id="cb1504-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb1504-11" data-line-number="11">  <span class="co"># plot the cor value</span></a>
<a class="sourceLine" id="cb1504-12" data-line-number="12">  <span class="kw">ggally_text</span>(</a>
<a class="sourceLine" id="cb1504-13" data-line-number="13">    <span class="dt">label =</span> <span class="kw">formatC</span>(corr, <span class="dt">digits =</span> <span class="dv">2</span>, <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_replace</span>(., <span class="st">&quot;0.&quot;</span>, <span class="st">&quot;.&quot;</span>),</a>
<a class="sourceLine" id="cb1504-14" data-line-number="14">    <span class="dt">mapping =</span> <span class="kw">aes</span>(),</a>
<a class="sourceLine" id="cb1504-15" data-line-number="15">    <span class="dt">size =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1504-16" data-line-number="16">    <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-17" data-line-number="17"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-18" data-line-number="18"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1504-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb1504-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1504-21" data-line-number="21">my_diag &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb1504-22" data-line-number="22">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1504-23" data-line-number="23"><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-24" data-line-number="24"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-25" data-line-number="25"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1504-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb1504-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1504-28" data-line-number="28">my_upper &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb1504-29" data-line-number="29">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1504-30" data-line-number="30"><span class="st">    </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">18</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-31" data-line-number="31"><span class="st">    </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1504-32" data-line-number="32">                        <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-33" data-line-number="33"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-34" data-line-number="34"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1504-35" data-line-number="35"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]))</a>
<a class="sourceLine" id="cb1504-36" data-line-number="36">}</a></code></pre></div>
<p>Now we are ready to make our custom version of the pairs plot in Figure 12.8.</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1505-1" data-line-number="1"><span class="kw">library</span>(GGally)</a>
<a class="sourceLine" id="cb1505-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1505-3" data-line-number="3">delta_labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Elem&quot;</span>, <span class="st">&quot;MidSch&quot;</span>, <span class="st">&quot;SHS&quot;</span>, <span class="st">&quot;HSG&quot;</span>, <span class="st">&quot;SCol&quot;</span>, <span class="st">&quot;Bach&quot;</span>, <span class="st">&quot;Mast&quot;</span>, <span class="st">&quot;Grad&quot;</span>)</a>
<a class="sourceLine" id="cb1505-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1505-5" data-line-number="5"><span class="kw">posterior_samples</span>(b12<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1505-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;simo_moedu_new1&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1505-7" data-line-number="7"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(delta_labels[<span class="dv">2</span><span class="op">:</span><span class="dv">8</span>], <span class="st">&quot;~(delta[&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="st">&quot;])&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1505-8" data-line-number="8"><span class="st">  </span><span class="kw">ggpairs</span>(<span class="dt">upper =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_upper),</a>
<a class="sourceLine" id="cb1505-9" data-line-number="9">          <span class="dt">diag =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),</a>
<a class="sourceLine" id="cb1505-10" data-line-number="10">          <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower),</a>
<a class="sourceLine" id="cb1505-11" data-line-number="11">          <span class="dt">labeller =</span> label_parsed) <span class="op">+</span></a>
<a class="sourceLine" id="cb1505-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>))</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-83-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Here we add a normalized version of <code>edu_new</code> called <code>edu_norm</code>.</p>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1506-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb1506-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1506-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">edu_norm =</span> (edu_new <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1506-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1506-5" data-line-number="5"><span class="co"># what does this look like?</span></a>
<a class="sourceLine" id="cb1506-6" data-line-number="6">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1506-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>(edu, edu_new, edu_norm) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1506-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(edu_new)</a></code></pre></div>
<pre><code>##                    edu edu_new  edu_norm
## 1    Elementary School       1 0.0000000
## 2        Middle School       2 0.1428571
## 3     Some High School       3 0.2857143
## 4 High School Graduate       4 0.4285714
## 5         Some College       5 0.5714286
## 6    Bachelor&#39;s Degree       6 0.7142857
## 7      Master&#39;s Degree       7 0.8571429
## 8      Graduate Degree       8 1.0000000</code></pre>
<p>Now fit the more conventional model.</p>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1508-1" data-line-number="1">b12<span class="fl">.7</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1508-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1508-3" data-line-number="3">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1508-4" data-line-number="4">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>edu_norm,</a>
<a class="sourceLine" id="cb1508-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1508-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b)),</a>
<a class="sourceLine" id="cb1508-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1508-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb1508-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b12.07&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1509-1" data-line-number="1"><span class="kw">fixef</span>(b12<span class="fl">.7</span>)[<span class="dv">7</span><span class="op">:</span><span class="dv">10</span>, ]</a></code></pre></div>
<pre><code>##             Estimate  Est.Error       Q2.5       Q97.5
## action    -0.7065217 0.04062075 -0.7835762 -0.62763964
## contact   -0.9584785 0.05073591 -1.0572652 -0.85913421
## intention -0.7191983 0.03603597 -0.7914742 -0.65006562
## edu_norm  -0.1132587 0.09246165 -0.2935643  0.06527575</code></pre>
<p>It might be nice to get a better sense of the two models with a plot. For our approach, we’ll use <code>fitted()</code>. Start with <code>b12.6</code>.</p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1511-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb1511-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">edu_new   =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,</a>
<a class="sourceLine" id="cb1511-3" data-line-number="3">         <span class="dt">action    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1511-4" data-line-number="4">         <span class="dt">contact   =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1511-5" data-line-number="5">         <span class="dt">intention =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1511-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1511-7" data-line-number="7">f &lt;-</a>
<a class="sourceLine" id="cb1511-8" data-line-number="8"><span class="st">  </span><span class="kw">fitted</span>(b12<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb1511-9" data-line-number="9">         <span class="dt">newdata =</span> nd) </a>
<a class="sourceLine" id="cb1511-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1511-11" data-line-number="11">f <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:8, 1:4, 1:7] 0.0426 0.0469 0.0491 0.0524 0.0553 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ : NULL
##   ..$ : chr [1:4] &quot;Estimate&quot; &quot;Est.Error&quot; &quot;Q2.5&quot; &quot;Q97.5&quot;
##   ..$ : chr [1:7] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<p>The rows correspond to the eight educational levels. The columns are the typical summary columns. The seven levels of the third dimension are the seven levels of <code>response</code>. Before we plot, we’re going to need to wrangle that a little and then do the same thing all over for <code>b12.7</code>.</p>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1513-1" data-line-number="1"><span class="co"># b12.6</span></a>
<a class="sourceLine" id="cb1513-2" data-line-number="2">f12<span class="fl">.6</span> &lt;-</a>
<a class="sourceLine" id="cb1513-3" data-line-number="3"><span class="st">  </span><span class="kw">rbind</span>(f[, , <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1513-4" data-line-number="4">        f[, , <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1513-5" data-line-number="5">        f[, , <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1513-6" data-line-number="6">        f[, , <span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1513-7" data-line-number="7">        f[, , <span class="dv">5</span>],</a>
<a class="sourceLine" id="cb1513-8" data-line-number="8">        f[, , <span class="dv">6</span>],</a>
<a class="sourceLine" id="cb1513-9" data-line-number="9">        f[, , <span class="dv">7</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-10" data-line-number="10"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">edu      =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">times =</span> <span class="dv">7</span>)),</a>
<a class="sourceLine" id="cb1513-12" data-line-number="12">         <span class="dt">response =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">each =</span> <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb1513-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1513-14" data-line-number="14"><span class="co"># b12.7</span></a>
<a class="sourceLine" id="cb1513-15" data-line-number="15">nd &lt;-</a>
<a class="sourceLine" id="cb1513-16" data-line-number="16"><span class="st">  </span>nd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">edu_norm  =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>)</a>
<a class="sourceLine" id="cb1513-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1513-19" data-line-number="19">f &lt;-</a>
<a class="sourceLine" id="cb1513-20" data-line-number="20"><span class="st">  </span><span class="kw">fitted</span>(b12<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb1513-21" data-line-number="21">         <span class="dt">newdata =</span> nd) </a>
<a class="sourceLine" id="cb1513-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1513-23" data-line-number="23">f12<span class="fl">.7</span> &lt;-</a>
<a class="sourceLine" id="cb1513-24" data-line-number="24"><span class="st">  </span><span class="kw">rbind</span>(f[, , <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb1513-25" data-line-number="25">        f[, , <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1513-26" data-line-number="26">        f[, , <span class="dv">3</span>],</a>
<a class="sourceLine" id="cb1513-27" data-line-number="27">        f[, , <span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1513-28" data-line-number="28">        f[, , <span class="dv">5</span>],</a>
<a class="sourceLine" id="cb1513-29" data-line-number="29">        f[, , <span class="dv">6</span>],</a>
<a class="sourceLine" id="cb1513-30" data-line-number="30">        f[, , <span class="dv">7</span>]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-31" data-line-number="31"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1513-32" data-line-number="32"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">edu      =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">times =</span> <span class="dv">7</span>)),</a>
<a class="sourceLine" id="cb1513-33" data-line-number="33">         <span class="dt">response =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">each =</span> <span class="dv">8</span>))</a></code></pre></div>
<p>Now combine the two data objects and plot.</p>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1514-1" data-line-number="1"><span class="co"># this will help with `scale_color_manual()`</span></a>
<a class="sourceLine" id="cb1514-2" data-line-number="2">colors &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1514-3" data-line-number="3"><span class="st">  </span>scales<span class="op">::</span><span class="kw">seq_gradient_pal</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>], </a>
<a class="sourceLine" id="cb1514-4" data-line-number="4">                           <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>])(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb1514-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1514-6" data-line-number="6"><span class="kw">bind_rows</span>(f12<span class="fl">.6</span>, f12<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1514-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;b12.6 with `mo()` syntax&quot;</span>, <span class="st">&quot;b12.7 with conventional syntax&quot;</span>), </a>
<a class="sourceLine" id="cb1514-8" data-line-number="8">                   <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1514-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1514-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> Estimate,</a>
<a class="sourceLine" id="cb1514-11" data-line-number="11">             <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1514-12" data-line-number="12">             <span class="dt">color =</span> edu, <span class="dt">group =</span> edu)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1514-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">fatten =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1514-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="st">&quot;education&quot;</span>, <span class="dt">values =</span> colors, <span class="dt">labels =</span> delta_labels) <span class="op">+</span></a>
<a class="sourceLine" id="cb1514-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1514-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.43</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1514-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1514-18" data-line-number="18">        <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1514-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>fit)  </a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-88-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In case you were curious, the PSIS-LOO suggests the monotonic model (<code>b12.6</code>) made better sense of the data.</p>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1515-1" data-line-number="1">b12<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b12<span class="fl">.6</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb1515-2" data-line-number="2">b12<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b12<span class="fl">.7</span>, <span class="st">&quot;loo&quot;</span>)</a>
<a class="sourceLine" id="cb1515-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1515-4" data-line-number="4"><span class="kw">loo_compare</span>(b12<span class="fl">.6</span>, b12<span class="fl">.7</span>, <span class="dt">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##       elpd_diff se_diff  elpd_loo se_elpd_loo p_loo    se_p_loo looic    se_looic
## b12.6      0.0       0.0 -18540.8     38.1        11.1      0.1  37081.5     76.3
## b12.7     -4.4       1.8 -18545.1     38.1        10.0      0.1  37090.3     76.2</code></pre>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1517-1" data-line-number="1"><span class="kw">model_weights</span>(b12<span class="fl">.6</span>, b12<span class="fl">.7</span>, <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## b12.6 b12.7 
##  0.99  0.01</code></pre>
<p>We might explore the monotonic effects of <code>b12.6</code> in one more way. If you were reading closely along in the text, you may have noticed that “the sum of every <span class="math inline">\(\delta_j\)</span> is 1” (p. 392). When using HMC, this is true for each posterior draw. We can exploit that information to visualize the <span class="math inline">\(\delta_j\)</span> parameters in a cumulative fashion.</p>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1519-1" data-line-number="1"><span class="kw">posterior_samples</span>(b12<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;new1&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-3" data-line-number="3"><span class="st">  </span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), </a>
<a class="sourceLine" id="cb1519-5" data-line-number="5">         <span class="st">`</span><span class="dt">0</span><span class="st">`</span>  =<span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-6" data-line-number="6"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>iter,</a>
<a class="sourceLine" id="cb1519-7" data-line-number="7">               <span class="dt">names_to =</span> <span class="st">&quot;delta&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(delta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_sum =</span> <span class="kw">cumsum</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1519-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb1519-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> delta, <span class="dt">y =</span> cum_sum)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1519-13" data-line-number="13"><span class="st">  </span><span class="kw">stat_pointinterval</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1519-14" data-line-number="14">                     <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1519-15" data-line-number="15"><span class="st">  </span><span class="kw">stat_pointinterval</span>(<span class="dt">.width =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1519-16" data-line-number="16">                     <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1519-17" data-line-number="17">                     <span class="dt">point_color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1519-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">str_c</span>(<span class="st">&quot;delta[&quot;</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">7</span> , <span class="st">&quot;]&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1519-19" data-line-number="19"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;cumulative sum&quot;</span>)</a></code></pre></div>
<p><img src="12_files/figure-gfm/unnamed-chunk-90-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>This is another way to show that the largest effects of education are when going from <code>Elementary School</code> to <code>Middle School</code> (<span class="math inline">\(\delta_0 \rightarrow \delta_1\)</span>) and when going from <code>Some High School</code> to <code>High School Graduate</code> (<span class="math inline">\(\delta_2 \rightarrow \delta_3\)</span>).</p>
<div class="sourceCode" id="cb1520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1520-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1520-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(edu, edu_new) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1520-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(edu_new) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1520-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">delta[j]</span><span class="st">`</span> =<span class="st"> </span>edu_new <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>##                    edu edu_new delta[j]
## 1    Elementary School       1        0
## 2        Middle School       2        1
## 3     Some High School       3        2
## 4 High School Graduate       4        3
## 5         Some College       5        4
## 6    Bachelor&#39;s Degree       6        5
## 7      Master&#39;s Degree       7        6
## 8      Graduate Degree       8        7</code></pre>
</div>
<div id="summary-1" class="section level2">
<h2><span class="header-section-number">12.5</span> Summary</h2>
<p>“This chapter introduced several new types of regression, all of which are generalizations of generalized linear models (GLMs)” (p. 397). This chapter has been a ride. If you’d like more practice with the negative-binomial model and some of the others models for categorical data we covered in this chapter and in <a href="god-spiked-the-integers.html#god-spiked-the-integers">Chapter 11</a>, Alan Agresti covered them extensively in his <span class="citation">(<a href="#ref-agrestiFoundationsLinearGeneralized2015">2015</a>)</span> text, <a href="https://www.wiley.com/en-us/Foundations+of+Linear+and+Generalized+Linear+Models-p-9781118730034"><em>Foundations of linear and generalized linear models</em></a>. For more on different kinds of zero-inflated count models, check out <span class="citation">Atkins et al. (<a href="#ref-atkinsTutorialCountRegression2013">2013</a>)</span>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3513584/pdf/nihms396181.pdf"><em>A tutorial on count regression and zero-altered count models for
longitudinal substance use data</em></a>. If you’d like to learn more about using cumulative probabilities to model ordinal data in <strong>brms</strong>, check out Bürkner and Vuorre’s <span class="citation">(<a href="#ref-burknerOrdinalRegressionModels2019">2019</a>)</span> <a href="https://doi.org/10.1177/2515245918823199"><em>Ordinal regression models in psychology: A tutorial</em></a> and its <a href="https://osf.io/cu8jv/">repository</a> on the Open Science Framework. Also check out <a href="https://bookdown.org/content/3686/ordinal-predicted-variable.html">Chapter 23</a> of my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020">2020</a><a href="#ref-kurzDoingBayesianData2020">b</a>)</span> ebook <a href="https://bookdown.org/content/3686/"><em>Doing Bayesian Data Analysis in brms and the tidyverse</em></a> were we model ordinal data with a series of cumulative <em>probit</em> models.</p>
</div>
<div id="session-info-11" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1522-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] GGally_1.5.0         gtools_3.8.2         patchwork_1.0.1.9000 tidybayes_2.1.1      brms_2.13.0         
##  [6] Rcpp_1.0.5           dagitty_0.2-2        rstan_2.19.3         StanHeaders_2.21.0-1 forcats_0.5.0       
## [11] stringr_1.4.0        dplyr_1.0.1          purrr_0.3.4          readr_1.3.1          tidyr_1.1.1         
## [16] tibble_3.0.3         ggplot2_3.3.2        tidyverse_1.3.0      ggthemes_4.2.0      
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.1.8      RcppEigen_0.3.3.7.0  plyr_1.8.6           igraph_1.2.5        
##   [6] splines_3.6.3        svUnit_1.0.3         crosstalk_1.1.0.1    TH.data_1.0-10       rstantools_2.0.0    
##  [11] inline_0.3.15        digest_0.6.25        htmltools_0.5.0      rsconnect_0.8.16     fansi_0.4.1         
##  [16] magrittr_1.5         BH_1.72.0-3.1        modelr_0.1.6         matrixStats_0.56.0   xts_0.12-0          
##  [21] sandwich_2.5-1       prettyunits_1.1.1    colorspace_1.4-1     rvest_0.3.5          ggdist_2.1.1        
##  [26] haven_2.2.0          xfun_0.13            hexbin_1.28.1        callr_3.4.3          crayon_1.3.4        
##  [31] jsonlite_1.7.0       survival_3.1-12      zoo_1.8-7            glue_1.4.1           gtable_0.3.0        
##  [36] emmeans_1.4.5        V8_3.0.2             pkgbuild_1.1.0       shape_1.4.4          abind_1.4-5         
##  [41] scales_1.1.1         mvtnorm_1.1-0        emo_0.0.0.9000       DBI_1.1.0            miniUI_0.1.1.1      
##  [46] xtable_1.8-4         stats4_3.6.3         DT_0.13              htmlwidgets_1.5.1    httr_1.4.1          
##  [51] threejs_0.3.3        arrayhelpers_1.1-0   RColorBrewer_1.1-2   ellipsis_0.3.1       reshape_0.8.8       
##  [56] pkgconfig_2.0.3      loo_2.2.0            farver_2.0.3         dbplyr_1.4.2         utf8_1.1.4          
##  [61] tidyselect_1.1.0     labeling_0.3         rlang_0.4.7          reshape2_1.4.4       later_1.1.0.1       
##  [66] munsell_0.5.0        cellranger_1.1.0     tools_3.6.3          cli_2.0.2            generics_0.0.2      
##  [71] broom_0.5.5          ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1        yaml_2.2.1          
##  [76] processx_3.4.3       knitr_1.28           fs_1.4.1             nlme_3.1-144         mime_0.9            
##  [81] xml2_1.3.1           compiler_3.6.3       bayesplot_1.7.1      shinythemes_1.1.2    rstudioapi_0.11     
##  [86] curl_4.3             reprex_0.3.0         stringi_1.4.6        ps_1.3.4             Brobdingnag_1.2-6   
##  [91] lattice_0.20-38      Matrix_1.2-18        markdown_1.1         shinyjs_1.1          vctrs_0.3.2         
##  [96] pillar_1.4.6         lifecycle_0.2.0      bridgesampling_1.0-0 estimability_1.3     httpuv_1.5.4        
## [101] R6_2.4.1             bookdown_0.18        promises_1.1.1       gridExtra_2.3        codetools_0.2-16    
## [106] boot_1.3-24          colourpicker_1.0     MASS_7.3-51.5        assertthat_0.2.1     withr_2.2.0         
## [111] shinystan_2.5.0      multcomp_1.4-13      hms_0.5.3            grid_3.6.3           coda_0.19-3         
## [116] rmarkdown_2.1        shiny_1.5.0          lubridate_1.7.8      base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-agrestiFoundationsLinearGeneralized2015">
<p>Agresti, A. (2015). <em>Foundations of linear and generalized linear models</em>. John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Foundations+of+Linear+and+Generalized+Linear+Models-p-9781118730034">https://www.wiley.com/en-us/Foundations+of+Linear+and+Generalized+Linear+Models-p-9781118730034</a></p>
</div>
<div id="ref-atkinsTutorialCountRegression2013">
<p>Atkins, D. C., Baldwin, S. A., Zheng, C., Gallop, R. J., &amp; Neighbors, C. (2013). A tutorial on count regression and zero-altered count models for longitudinal substance use data. <em>Psychology of Addictive Behaviors : Journal of the Society of Psychologists in Addictive Behaviors</em>, <em>27</em>(1), 166–177. <a href="https://doi.org/10.1037/a0029508">https://doi.org/10.1037/a0029508</a></p>
</div>
<div id="ref-Bürkner2020Define">
<p>Bürkner, P.-C. (2020a). <em>Define custom response distributions with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html">https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html</a></p>
</div>
<div id="ref-Bürkner2020Distributional">
<p>Bürkner, P.-C. (2020b). <em>Estimating distributional models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html">https://CRAN.R-project.org/package=brms/vignettes/brms_distreg.html</a></p>
</div>
<div id="ref-Bürkner2020Monotonic">
<p>Bürkner, P.-C. (2020e). <em>Estimating monotonic effects with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_monotonic.html">https://CRAN.R-project.org/package=brms/vignettes/brms_monotonic.html</a></p>
</div>
<div id="ref-Bürkner2020Parameterization">
<p>Bürkner, P.-C. (2020i). <em>Parameterization of response distributions in brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_families.html">https://CRAN.R-project.org/package=brms/vignettes/brms_families.html</a></p>
</div>
<div id="ref-burknerModellingMonotonicEffects2020">
<p>Bürkner, P.-C., &amp; Charpentier, E. (2020). Modelling monotonic effects of ordinal predictors in Bayesian regression models. <em>British Journal of Mathematical and Statistical Psychology</em>. <a href="https://doi.org/10.1111/bmsp.12195">https://doi.org/10.1111/bmsp.12195</a></p>
</div>
<div id="ref-burknerOrdinalRegressionModels2019">
<p>Bürkner, P.-C., &amp; Vuorre, M. (2019). Ordinal regression models in psychology: A tutorial. <em>Advances in Methods and Practices in Psychological Science</em>, <em>2</em>(1), 77–101. <a href="https://doi.org/10.1177/2515245918823199">https://doi.org/10.1177/2515245918823199</a></p>
</div>
<div id="ref-cushmanRoleConsciousReasoning2006">
<p>Cushman, F., Young, L., &amp; Hauser, M. (2006). The role of conscious reasoning and intuition in moral judgment: Testing three principles of harm. <em>Psychological Science</em>, <em>17</em>(12), 1082–1089. <a href="https://doi.org/10.1111/j.1467-9280.2006.01834.x">https://doi.org/10.1111/j.1467-9280.2006.01834.x</a></p>
</div>
<div id="ref-kruschkeDoingBayesianData2015">
<p>Kruschke, J. K. (2015). <em>Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan</em>. Academic Press. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a></p>
</div>
<div id="ref-kurzDoingBayesianData2020">
<p>Kurz, A. S. (2020b). <em>Doing Bayesian data analysis in brms and the tidyverse</em> (version 0.2.0). <a href="https://bookdown.org/content/3686/">https://bookdown.org/content/3686/</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020a). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-standevelopmentteamStanFunctionsReference2020">
<p>Stan Development Team. (2020b). <em>Stan functions reference</em>. <a href="https://mc-stan.org/docs/2_23/functions-reference/index.html">https://mc-stan.org/docs/2_23/functions-reference/index.html</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="god-spiked-the-integers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="models-with-memory.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
