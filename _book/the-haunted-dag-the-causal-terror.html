<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 The Haunted DAG &amp; The Causal Terror | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="6 The Haunted DAG &amp; The Causal Terror | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 The Haunted DAG &amp; The Causal Terror | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-06-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-many-variables-the-spurious-waffles.html"/>
<link rel="next" href="ulysses-compass.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summarybonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del>Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.1</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>9.4.2</b> Estimation.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-haunted-dag-the-causal-terror" class="section level1">
<h1><span class="header-section-number">6</span> The Haunted DAG &amp; The Causal Terror</h1>
<p>Read this opening and cry:</p>
<blockquote>
<p>It seems like the most newsworthy scientific studies are the least trustworthy. The more likely it is to kill you, if true, the less likely it is to be true. The more boring the topic, the more rigorous the results. How could this widely believed negative correlation exist? There doesn’t seem to be any reason for studies of topics that people care about to produce less reliable results. Maybe popular topics attract more and worse researchers, like flies drawn to the smell of honey?</p>
<p>Actually all that is necessary for such a negative correlation to arise is that peer reviewers care about both newsworthiness and trustworthiness. Whether it is grant review or journal review, if editors and reviewers care about both, then the act of selection itself is enough to make the most newsworthy studies the least trustworthy….</p>
<p>Strong selection induces a negative correlation among the criteria used in selection. Why? If the only way to cross the threshold is to score high, it is more common to score high on one item than on both. Therefore among funded proposals, the most newsworthy studies can actually have less than average trustworthiness (less than 0 in the figure). Similarly the most trustworthy studies can be less newsworthy than average.</p>
<p>This general phenomenon has been recognized for a long time. It is sometimes called <strong>Berkson’s paradox</strong>. But it is easier to remember if we call it the <em>selection-distortion effect</em>. Once you appreciate this effect, you’ll see it everywhere….</p>
<p>The selection-distortion effect can happen inside of a multiple regression, because the act of adding a predictor induces statistical selection within the model, a phenomenon that goes by the unhelpful name collider bias. This can mislead us into believing, for example, that there is a negative association between newsworthiness and trustworthiness in general, when in fact it is just a consequence of conditioning on some variable. This is both a deeply confusing fact and one that is important to understand in order to regress responsibly.</p>
<p>This chapter and the next are both about terrible things that can happen when we simply add variables to a regression, without a clear idea of a causal model. <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020">a</a>, pp. 159–160, <strong>emphasis</strong> in the original)</span></p>
</blockquote>
<div id="overthinking-simulated-science-distortion." class="section level4">
<h4><span class="header-section-number">6.0.0.1</span> Overthinking: Simulated science distortion.</h4>
<p>First let’s run the simulation.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb593-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb593-2" data-line-number="2"></a>
<a class="sourceLine" id="cb593-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">1914</span>)</a>
<a class="sourceLine" id="cb593-4" data-line-number="4">n &lt;-<span class="st"> </span><span class="dv">200</span>  <span class="co"># num grant proposals</span></a>
<a class="sourceLine" id="cb593-5" data-line-number="5">p &lt;-<span class="st"> </span><span class="fl">0.1</span>  <span class="co"># proportion to select</span></a>
<a class="sourceLine" id="cb593-6" data-line-number="6"></a>
<a class="sourceLine" id="cb593-7" data-line-number="7">d &lt;-</a>
<a class="sourceLine" id="cb593-8" data-line-number="8"><span class="st">  </span><span class="co"># uncorrelated newsworthiness and trustworthiness</span></a>
<a class="sourceLine" id="cb593-9" data-line-number="9"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">newsworthiness  =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb593-10" data-line-number="10">         <span class="dt">trustworthiness =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb593-11" data-line-number="11"><span class="st">  </span><span class="co"># total_score</span></a>
<a class="sourceLine" id="cb593-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_score =</span> newsworthiness <span class="op">+</span><span class="st"> </span>trustworthiness) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb593-13" data-line-number="13"><span class="st">  </span><span class="co"># select top 10% of combined scores</span></a>
<a class="sourceLine" id="cb593-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">selected =</span> <span class="kw">ifelse</span>(total_score <span class="op">&gt;=</span><span class="st"> </span><span class="kw">quantile</span>(total_score, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p), <span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb593-15" data-line-number="15"></a>
<a class="sourceLine" id="cb593-16" data-line-number="16"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   newsworthiness trustworthiness total_score selected
##            &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt; &lt;lgl&gt;   
## 1         -0.379         -1.20        -1.58  FALSE   
## 2          0.130          0.504        0.634 FALSE   
## 3          0.334          0.532        0.866 FALSE   
## 4         -1.89          -0.594       -2.48  FALSE   
## 5          2.05           0.0672       2.12  TRUE    
## 6          2.54           1.02         3.56  TRUE</code></pre>
<p>Here’s the correlation among those cases for which <code>selected == TRUE</code>.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb595-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(selected <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb595-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(newsworthiness, trustworthiness) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb595-4" data-line-number="4"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##                 newsworthiness trustworthiness
## newsworthiness       1.0000000      -0.7680083
## trustworthiness     -0.7680083       1.0000000</code></pre>
<p>For the plots in this chapter, we’ll take some aesthetic cues from Aki Vehtari’s great GitHub repo, <a href="https://github.com/avehtari/BDA_R_demos"><em>Bayesian Data Analysis R Demos</em></a>.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1"><span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</a></code></pre></div>
<p>Okay, let’s make Figure 6.1.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" data-line-number="1"><span class="co"># we&#39;ll need this for the annotation</span></a>
<a class="sourceLine" id="cb598-2" data-line-number="2">text &lt;-</a>
<a class="sourceLine" id="cb598-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">newsworthiness  =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb598-4" data-line-number="4">         <span class="dt">trustworthiness =</span> <span class="kw">c</span>(<span class="fl">2.25</span>, <span class="fl">-2.5</span>),</a>
<a class="sourceLine" id="cb598-5" data-line-number="5">         <span class="dt">selected        =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb598-6" data-line-number="6">         <span class="dt">label           =</span> <span class="kw">c</span>(<span class="st">&quot;selected&quot;</span>, <span class="st">&quot;rejected&quot;</span>))</a>
<a class="sourceLine" id="cb598-7" data-line-number="7"></a>
<a class="sourceLine" id="cb598-8" data-line-number="8">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> newsworthiness, <span class="dt">y =</span> trustworthiness, <span class="dt">color =</span> selected)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> selected), <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</a>
<a class="sourceLine" id="cb598-12" data-line-number="12">            <span class="kw">aes</span>(<span class="dt">label =</span> label)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(selected <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb598-14" data-line-number="14">              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,</a>
<a class="sourceLine" id="cb598-15" data-line-number="15">              <span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">se =</span> F, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;lightblue&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="fl">3.9</span>), <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-19" data-line-number="19"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>trustworthiness)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-20" data-line-number="20"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-5-1.png" width="336" style="display: block; margin: auto;" /></p>
</div>
<div id="multicollinearity" class="section level2">
<h2><span class="header-section-number">6.1</span> Multicollinearity</h2>
<blockquote>
<p>Multicollinearity means a very strong association between two or more predictor variables. <em>The raw correlation isn’t what matters. Rather what matters is the association, conditional on the other variables in the model.</em> The consequence of multicollinearity is that the posterior distribution will seem to suggest that none of the variables is reliably associated with the outcome, even if all of the variables are in reality strongly associated with the outcome.</p>
<p>This frustrating phenomenon arises from the details of how multiple regression works. In fact, there is nothing wrong with multicollinearity. The model will work fine for prediction. You will just be frustrated trying to understand it. The hope is that once you understand multicollinearity, you will better understand regression models in general. (p. 163, <em>emphasis</em> added)</p>
</blockquote>
<p>For more on this topic, check out <a href="https://twitter.com/janhove">Jan VanHove</a>’s interesting blog post, <a href="https://janhove.github.io/analysis/2019/09/11/collinearity"><em>Collinearity isn’t a disease that needs curing</em></a>.</p>
<div id="multicollinear-legs." class="section level3">
<h3><span class="header-section-number">6.1.1</span> Multicollinear legs.</h3>
<p>Let’s simulate some leg data.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb599-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">909</span>)</a>
<a class="sourceLine" id="cb599-3" data-line-number="3"></a>
<a class="sourceLine" id="cb599-4" data-line-number="4">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb599-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">height   =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb599-6" data-line-number="6">         <span class="dt">leg_prop =</span> <span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.4</span>, <span class="dt">max =</span> <span class="fl">0.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">leg_left  =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>),</a>
<a class="sourceLine" id="cb599-8" data-line-number="8">         <span class="dt">leg_right =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>))</a></code></pre></div>
<p><code>leg_left</code> and <code>leg_right</code> are <strong>highly</strong> correlated.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(leg_left<span class="op">:</span>leg_right) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-3" data-line-number="3"><span class="st">  </span><span class="kw">cor</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-4" data-line-number="4"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##           leg_left leg_right
## leg_left    1.0000    0.9997
## leg_right   0.9997    1.0000</code></pre>
<p>Have you ever even seen a <span class="math inline">\(\rho = .9997\)</span> correlation, before? Here it is in a plot.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb602-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> leg_left, <span class="dt">y =</span> leg_right)) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;forestgreen&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-8-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Here’s our attempt to predict <code>height</code> with both legs.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" data-line-number="1">b6<span class="fl">.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb604-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb604-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb604-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>leg_left <span class="op">+</span><span class="st"> </span>leg_right,</a>
<a class="sourceLine" id="cb604-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb604-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb604-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb604-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb604-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb604-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.01&quot;</span>)</a></code></pre></div>
<p>Let’s inspect the damage.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + leg_left + leg_right 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.99      0.30     0.40     1.58 1.00     4350     2694
## leg_left      0.29      2.50    -4.68     5.31 1.00     1377     1717
## leg_right     1.71      2.51    -3.30     6.69 1.00     1376     1690
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.64      0.05     0.55     0.73 1.00     2188     2159
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>That ‘Est.Error’ column isn’t looking too good. But it’s easy to miss that, which is why McElreath suggested “a graphical view of the [output] is more useful because it displays the posterior means and [intervals] in a way that allows us with a glance to see that something has gone wrong here” (p. 164).</p>
<p>Here’s our coefficient plot using <code>brms::mcmc_plot()</code> with a little help from <code>bayesplot::color_scheme_set()</code>.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1"><span class="kw">library</span>(bayesplot)</a>
<a class="sourceLine" id="cb607-2" data-line-number="2"></a>
<a class="sourceLine" id="cb607-3" data-line-number="3"><span class="kw">color_scheme_set</span>(<span class="st">&quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb607-4" data-line-number="4"></a>
<a class="sourceLine" id="cb607-5" data-line-number="5"><span class="kw">mcmc_plot</span>(b6<span class="fl">.1</span>, </a>
<a class="sourceLine" id="cb607-6" data-line-number="6">         <span class="dt">type =</span> <span class="st">&quot;intervals&quot;</span>, </a>
<a class="sourceLine" id="cb607-7" data-line-number="7">         <span class="dt">prob =</span> <span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb607-8" data-line-number="8">         <span class="dt">prob_outer =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb607-9" data-line-number="9">         <span class="dt">point_est =</span> <span class="st">&quot;mean&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb607-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;The coefficient plot for the two-leg model&quot;</span>,</a>
<a class="sourceLine" id="cb607-11" data-line-number="11">       <span class="dt">subtitle =</span> <span class="st">&quot;Holy smokes; look at the widths of those betas!&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb607-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb607-13" data-line-number="13">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb607-14" data-line-number="14">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>)) </a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-11-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Now you can use the <code>brms::mcmc_plot()</code> function without explicitly loading the <strong>bayesplot</strong> package. But loading <strong>bayesplot</strong> allows you to set the color scheme with <code>color_scheme_set()</code>.</p>
<p>In the middle of page 164, McElreath suggested we might try this again with different seeds. This might be a good place to iteration. Our first step will be to make a custom function that will simulate new data of the same form as above and then immediately fit a model based on <code>b6.1</code> to those new data. To speed up the process, we’ll use the <code>update()</code> function to avoid recompiling the model. Our custom function, sim_and_fit()<code>, will take two arguments. The</code>seed<code>argument will allow us to keep the results reproducible by setting a seed for the data simulation. The</code>n` argument will allow us, should we wish, to change the sample size.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1">sim_and_fit &lt;-<span class="st"> </span><span class="cf">function</span>(seed, <span class="dt">n =</span> <span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb608-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb608-3" data-line-number="3">  <span class="co"># set up the parameters</span></a>
<a class="sourceLine" id="cb608-4" data-line-number="4">  n &lt;-<span class="st"> </span>n</a>
<a class="sourceLine" id="cb608-5" data-line-number="5">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb608-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb608-7" data-line-number="7">  <span class="co"># simulate the new data</span></a>
<a class="sourceLine" id="cb608-8" data-line-number="8">  d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb608-9" data-line-number="9"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">height   =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb608-10" data-line-number="10">           <span class="dt">leg_prop =</span> <span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.4</span>, <span class="dt">max =</span> <span class="fl">0.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-11" data-line-number="11"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">leg_left  =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>),</a>
<a class="sourceLine" id="cb608-12" data-line-number="12">           <span class="dt">leg_right =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>))</a>
<a class="sourceLine" id="cb608-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb608-14" data-line-number="14">  <span class="co"># update b6.1 to the new data</span></a>
<a class="sourceLine" id="cb608-15" data-line-number="15">  fit &lt;-<span class="st"> </span><span class="kw">update</span>(b6<span class="fl">.1</span>, <span class="dt">newdata =</span> d, <span class="dt">seed =</span> <span class="dv">6</span>) </a>
<a class="sourceLine" id="cb608-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb608-17" data-line-number="17">}</a></code></pre></div>
<p>Now use <code>sim_and_fit()</code> to make our simulations which correspond to seed values <code>1:4</code>. By nesting the <code>seed</code> values and the <code>sim_and_fit()</code> function within <code>purrr::map()</code>, the results will be saved within our tibble, <code>sim</code>.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">sim &lt;-</a>
<a class="sourceLine" id="cb609-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">seed =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">post =</span> <span class="kw">map</span>(seed, <span class="op">~</span><span class="kw">sim_and_fit</span>(.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-4" data-line-number="4"><span class="st">                      </span><span class="kw">posterior_samples</span>()))</a></code></pre></div>
<p>Take a look at what we did.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" data-line-number="1"><span class="kw">head</span>(sim)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##    seed post                
##   &lt;int&gt; &lt;list&gt;              
## 1     1 &lt;df[,5] [4,000 × 5]&gt;
## 2     2 &lt;df[,5] [4,000 × 5]&gt;
## 3     3 &lt;df[,5] [4,000 × 5]&gt;
## 4     4 &lt;df[,5] [4,000 × 5]&gt;</code></pre>
<p>We have a tibble with four rows and two columns. Hopefully it’s unsurprising the first column shows our four <code>seed</code> values. The second column, <code>post</code>, might look odd. If you look back up at the code we used to make <code>sim</code>, you’ll notice we fed the results form <code>sim_and_fit()</code> into the <code>brms::posterior_samples()</code> function. Each model contained 4,000 poster draws. There are four parameters in the model and, by <strong>brms</strong> default, the <code>posterior_samples()</code> function also returns the <code>lp__</code>, which we generally ignore in this project. Anyway, that’s why you see each of the four rows of <code>post</code> containing <code>&lt;data.frame [4,000 × 5]&gt;</code>. Each cell contains an entire <span class="math inline">\(4,000 × 5\)</span> data frame–the results of <code>posterior_samples()</code>. When you have a data frames nested within data frames, this is called a nested data structure. To unpack the contents of those four nested data frames, you simply call <code>nest(d, post)</code>. In the next code block, we’ll do that within the context of a larger work low designed to plot the results of each in a faceted coefficient plot. For data of this kind of structure, the <code>tidybayes::stat_pointintervalh()</code> function will be particularly useful.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidybayes&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:brms&#39;:
## 
##     dstudent_t, pstudent_t, qstudent_t, rstudent_t</code></pre>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" data-line-number="1">sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-2" data-line-number="2"><span class="st">  </span><span class="kw">unnest</span>(post) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(b_Intercept<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">seed =</span> <span class="kw">str_c</span>(<span class="st">&quot;seed &quot;</span>, seed)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb615-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="dt">.width =</span> <span class="fl">.95</span>, <span class="dt">color =</span> <span class="st">&quot;forestgreen&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb615-10" data-line-number="10">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb615-11" data-line-number="11">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-12" data-line-number="12"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>seed, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Warning: &#39;stat_pointintervalh&#39; is deprecated.
## Use &#39;stat_pointinterval&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="06_files/figure-gfm/unnamed-chunk-16-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Though the results varied across iterations, the overall pattern was massive uncertainty in the two <span class="math inline">\(\beta\)</span> parameters. You may be wondering,</p>
<blockquote>
<p>Did the posterior approximation work correctly?</p>
<p>It did work correctly, and the posterior distribution here is the right answer to the ques- tion we asked. The problem is the question. Recall that a multiple linear regression answers the question: <em>What is the value of knowing each predictor, after already knowing all of the other predictors? So in this case, the question becomes: What is the value of knowing each leg’s length, after already knowing the other leg’s length?</em></p>
<p>The answer to this weird question is equally weird, but perfectly logical. (p. 164, <em>emphasis</em> in the original)</p>
</blockquote>
<p>To further answer this weird question, we might start making the panels from Figure 6.2. Starting with the left panel, this is perhaps the simplest way to plot the bivariate posterior of our two predictor coefficients.</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb617-1" data-line-number="1"><span class="kw">pairs</span>(b6<span class="fl">.1</span>, <span class="dt">pars =</span> <span class="kw">parnames</span>(b6<span class="fl">.1</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-17-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you’d like a nicer and more focused attempt, you might have to revert to the <code>posterior_samples()</code> function and a little <strong>ggplot2</strong> code.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b6<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb618-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb618-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left, <span class="dt">y =</span> b_leg_right)) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;forestgreen&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-18-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>While we’re at it, you can make a similar plot with the <code>mcmc_scatter()</code> function <span class="citation">(see Gabry, <a href="#ref-gabryPlottingMCMCDraws2019">2019</a>, <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html"><em>Plotting MCMC draws using the bayesplot package</em></a>)</span>.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb619-1" data-line-number="1"><span class="kw">color_scheme_set</span>(<span class="st">&quot;green&quot;</span>)</a>
<a class="sourceLine" id="cb619-2" data-line-number="2"></a>
<a class="sourceLine" id="cb619-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb619-4" data-line-number="4"><span class="st">  </span><span class="kw">mcmc_scatter</span>(<span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_leg_left&quot;</span>, <span class="st">&quot;b_leg_right&quot;</span>),</a>
<a class="sourceLine" id="cb619-5" data-line-number="5">               <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb619-6" data-line-number="6">               <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-19-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>But wow, those coefficients look about as highly correlated as the predictors, just with the reversed sign.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb620-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(b_leg_left<span class="op">:</span>b_leg_right) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb620-3" data-line-number="3"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##             b_leg_left b_leg_right
## b_leg_left   1.0000000  -0.9996662
## b_leg_right -0.9996662   1.0000000</code></pre>
<p>On page 165, McElreath clarified that from the perspective of <strong>brms</strong>, this model may as well be</p>
<p><span class="math display">\[
\begin{align*}
y_i   &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + (\beta_1 + \beta_2) x_i.
\end{align*}
\]</span></p>
<p>Accordingly, here’s the posterior of the sum of the two regression coefficients, Figure 6.2.b. We’ll use <code>tidybayes::geom_halfeyeh()</code> to both plot the density and mark off the posterior median and percentile-based 95% probability intervals at its base.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb622-2" data-line-number="2"></a>
<a class="sourceLine" id="cb622-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb622-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left <span class="op">+</span><span class="st"> </span>b_leg_right, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, </a>
<a class="sourceLine" id="cb622-6" data-line-number="6">                <span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sum the multicollinear coefficients&quot;</span>,</a>
<a class="sourceLine" id="cb622-9" data-line-number="9">       <span class="dt">subtitle =</span> <span class="st">&quot;Marked by the median and 95% PIs&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-21-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Now we fit the model after ditching one of the leg lengths.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1">b6<span class="fl">.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb623-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb623-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb623-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>leg_left,</a>
<a class="sourceLine" id="cb623-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb623-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb623-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb623-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb623-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb623-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.02&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb624-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + leg_left 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     1.00      0.29     0.43     1.56 1.00     3721     2696
## leg_left      1.99      0.06     1.87     2.12 1.00     3742     2681
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.63      0.04     0.55     0.73 1.00     3514     2866
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>That posterior <span class="math inline">\(SD\)</span> looks much better. Compare this density to the one in Figure 6.2.b.</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb626-1" data-line-number="1"><span class="kw">posterior_samples</span>(b6<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb626-2" data-line-number="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb626-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb626-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, </a>
<a class="sourceLine" id="cb626-5" data-line-number="5">                <span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb626-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb626-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Just one coefficient needed&quot;</span>,</a>
<a class="sourceLine" id="cb626-8" data-line-number="8">       <span class="dt">subtitle =</span> <span class="st">&quot;Marked by the median and 95% PIs&quot;</span>,</a>
<a class="sourceLine" id="cb626-9" data-line-number="9">       <span class="dt">x =</span> <span class="st">&quot;only b_leg_left, this time&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: &#39;geom_halfeyeh&#39; is deprecated.
## Use &#39;stat_halfeye&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="06_files/figure-gfm/unnamed-chunk-23-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The basic lesson is only this: When two predictor variables are very strongly correlated (conditional on other variables in the model), including both in a model may lead to confusion. The posterior distribution isn’t wrong, in such cases. It’s telling you that the question you asked cannot be answered with these data. And that’s a great thing for a model to say, that it cannot answer your question. And if you are just interested in prediction, you’ll find that this leg model makes fine predictions. It just doesn’t make any claims about which leg is more important. (p. 166)</p>
</blockquote>
</div>
<div id="multicollinear-milk." class="section level3">
<h3><span class="header-section-number">6.1.2</span> Multicollinear <code>milk</code>.</h3>
<p>Multicollinearity arises in real data, too.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb628-2" data-line-number="2"><span class="kw">data</span>(milk)</a>
<a class="sourceLine" id="cb628-3" data-line-number="3">d &lt;-<span class="st"> </span>milk</a></code></pre></div>
<p>Now use <code>rethinking::standardize()</code> to standardize our focal variables.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb629-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb629-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">k =</span> <span class="kw">standardize</span>(kcal.per.g),</a>
<a class="sourceLine" id="cb629-4" data-line-number="4">         <span class="dt">f =</span> <span class="kw">standardize</span>(perc.fat),</a>
<a class="sourceLine" id="cb629-5" data-line-number="5">         <span class="dt">l =</span> <span class="kw">standardize</span>(perc.lactose))</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb630-1" data-line-number="1"><span class="kw">rm</span>(milk)</a>
<a class="sourceLine" id="cb630-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb630-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>We’ll follow the text and fit the two univariable models, first. Note our use of <code>update()</code>.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1"><span class="co"># k regressed on f</span></a>
<a class="sourceLine" id="cb631-2" data-line-number="2">b6<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb631-3" data-line-number="3"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb631-4" data-line-number="4">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb631-5" data-line-number="5">      k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>f,</a>
<a class="sourceLine" id="cb631-6" data-line-number="6">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb631-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb631-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb631-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb631-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb631-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.03&quot;</span>)</a>
<a class="sourceLine" id="cb631-12" data-line-number="12"></a>
<a class="sourceLine" id="cb631-13" data-line-number="13"><span class="co"># k regressed on l</span></a>
<a class="sourceLine" id="cb631-14" data-line-number="14">b6<span class="fl">.4</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb631-15" data-line-number="15"><span class="st">  </span><span class="kw">update</span>(b6<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb631-16" data-line-number="16">         <span class="dt">newdata =</span> d,</a>
<a class="sourceLine" id="cb631-17" data-line-number="17">         <span class="dt">formula =</span> k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>l,</a>
<a class="sourceLine" id="cb631-18" data-line-number="18">         <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb631-19" data-line-number="19">         <span class="dt">file =</span> <span class="st">&quot;fits/b06.04&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1"><span class="kw">posterior_summary</span>(b6<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept     0.00      0.08  -0.16   0.17
## b_f             0.85      0.09   0.67   1.02
## sigma           0.49      0.07   0.37   0.65
## lp__          -22.14      1.30 -25.42 -20.64</code></pre>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1"><span class="kw">posterior_summary</span>(b6<span class="fl">.4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept     0.00      0.07  -0.14   0.14
## b_l            -0.90      0.08  -1.05  -0.74
## sigma           0.41      0.06   0.32   0.54
## lp__          -17.34      1.23 -20.53 -15.93</code></pre>
<p>Now “watch what happens when we place both predictor varaibles in the same regression model” (p. 167).</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" data-line-number="1">b6<span class="fl">.5</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb636-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b6<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb636-3" data-line-number="3">         <span class="dt">newdata =</span> d,</a>
<a class="sourceLine" id="cb636-4" data-line-number="4">         <span class="dt">formula =</span> k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span>l,</a>
<a class="sourceLine" id="cb636-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb636-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/b06.05&quot;</span>)</a></code></pre></div>
<p>Now the <span class="math inline">\(\beta\)</span>’s are smaller and less certain.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1"><span class="kw">posterior_summary</span>(b6<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept     0.00      0.07  -0.14   0.15
## b_f             0.25      0.19  -0.12   0.64
## b_l            -0.67      0.19  -1.03  -0.27
## sigma           0.42      0.06   0.32   0.56
## lp__          -17.31      1.53 -21.16 -15.41</code></pre>
<p>Here’s a quick <code>paris()</code> plot.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb639-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb639-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(kcal.per.g, perc.fat, perc.lactose) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb639-3" data-line-number="3"><span class="st">  </span><span class="kw">pairs</span>(<span class="dt">col =</span> <span class="st">&quot;forestgreen&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-29-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Now here’s the custom <strong>GGally</strong> version.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1"><span class="kw">library</span>(GGally)</a>
<a class="sourceLine" id="cb640-2" data-line-number="2"></a>
<a class="sourceLine" id="cb640-3" data-line-number="3">my_diag &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb640-4" data-line-number="4">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb640-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb640-7" data-line-number="7"></a>
<a class="sourceLine" id="cb640-8" data-line-number="8">my_lower &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb640-9" data-line-number="9">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-10" data-line-number="10"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb640-11" data-line-number="11">                <span class="dt">fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-12" data-line-number="12"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb640-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb640-14" data-line-number="14"></a>
<a class="sourceLine" id="cb640-15" data-line-number="15"><span class="co"># plug those custom functions into `ggpairs()`</span></a>
<a class="sourceLine" id="cb640-16" data-line-number="16"><span class="kw">ggpairs</span>(<span class="dt">data =</span> d, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">6</span>),</a>
<a class="sourceLine" id="cb640-17" data-line-number="17">        <span class="dt">diag =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),</a>
<a class="sourceLine" id="cb640-18" data-line-number="18">        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower))</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-30-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Our two predictor “variables are negatively correlated, and so strongly so that they are nearly redundant. Either helps in predicting <code>kcal.per.g</code>, but neither helps much <em>once you already know the other</em>” (p. 169, <em>emphasis</em> in the original). You can really see that on the lower two scatter plots. You’ll note the <code>ggpairs()</code> plot also returned the Pearson’s correlation coefficients.</p>
<p>Making a DAG might help us make sense of this.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1"><span class="kw">library</span>(ggdag)</a>
<a class="sourceLine" id="cb641-2" data-line-number="2"></a>
<a class="sourceLine" id="cb641-3" data-line-number="3">dag_coords &lt;-</a>
<a class="sourceLine" id="cb641-4" data-line-number="4"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;K&quot;</span>),</a>
<a class="sourceLine" id="cb641-5" data-line-number="5">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb641-6" data-line-number="6">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb641-7" data-line-number="7"></a>
<a class="sourceLine" id="cb641-8" data-line-number="8"><span class="kw">dagify</span>(L <span class="op">~</span><span class="st"> </span>D,</a>
<a class="sourceLine" id="cb641-9" data-line-number="9">       F <span class="op">~</span><span class="st"> </span>D,</a>
<a class="sourceLine" id="cb641-10" data-line-number="10">       K <span class="op">~</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span>F,</a>
<a class="sourceLine" id="cb641-11" data-line-number="11">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb641-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb641-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name <span class="op">==</span><span class="st"> &quot;D&quot;</span>),</a>
<a class="sourceLine" id="cb641-15" data-line-number="15">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb641-17" data-line-number="17">             <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">stroke =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb641-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>))</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-31-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The central tradeoff decides how dense, <span class="math inline">\(D\)</span>, the milk needs to be. We haven’t observed this variable, so it’s shown circled. Then fat, <span class="math inline">\(F\)</span>, and lactose, <span class="math inline">\(L\)</span>, are determined. Finally, the composition of <span class="math inline">\(F\)</span> and <span class="math inline">\(L\)</span> determines the kilocalories, <span class="math inline">\(K\)</span>. If we could measure <span class="math inline">\(D\)</span>, or had an evolutionary and economic model to predict it based upon other aspects of a species, that would be better than stumbling through regressions. (p. 167)</p>
</blockquote>
<div id="rethinking-identification-guaranteed-comprehension-up-to-you." class="section level4">
<h4><span class="header-section-number">6.1.2.1</span> Rethinking: Identification guaranteed; comprehension up to you.</h4>
<p>If you come from a frequentist background, this may jar you, but</p>
<blockquote>
<p>technically speaking, <em>identifiability</em> is not a concern for Bayesian models. The reason is that as long as the posterior distribution is proper–which just means that it integrates to 1–then all of the parameters are identified. But this technical fact doesn’t also mean that you can make sense of the posterior distribution. So it’s probably better to speak of <em>weakly identified</em> parameters in a Bayesian context. (pp. 169–170, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="overthinking-simulating-collinearity." class="section level4">
<h4><span class="header-section-number">6.1.2.2</span> Overthinking: Simulating collinearity.</h4>
<p>First we’ll get the data and define the functions. You’ll note I’ve defined my <code>sim_coll()</code> a little differently from <code>sim.coll()</code> in the text. I’ve omitted <code>rep.sim.coll()</code> as an independent function altogether, but computed similar summary information with the <code>summarise()</code> code at the bottom of the block.</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb642-1" data-line-number="1">sim_coll &lt;-<span class="st"> </span><span class="cf">function</span>(seed, rho) {</a>
<a class="sourceLine" id="cb642-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb642-3" data-line-number="3">  <span class="co"># simulate the data</span></a>
<a class="sourceLine" id="cb642-4" data-line-number="4">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb642-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb642-6" data-line-number="6">  d &lt;-</a>
<a class="sourceLine" id="cb642-7" data-line-number="7"><span class="st">    </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-8" data-line-number="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), </a>
<a class="sourceLine" id="cb642-9" data-line-number="9">                     <span class="dt">mean =</span> perc.fat <span class="op">*</span><span class="st"> </span>rho,</a>
<a class="sourceLine" id="cb642-10" data-line-number="10">                     <span class="dt">sd =</span> <span class="kw">sqrt</span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(perc.fat))))</a>
<a class="sourceLine" id="cb642-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb642-12" data-line-number="12">  <span class="co"># fit an OLS model</span></a>
<a class="sourceLine" id="cb642-13" data-line-number="13">  m &lt;-<span class="st"> </span><span class="kw">lm</span>(kcal.per.g <span class="op">~</span><span class="st"> </span>perc.fat <span class="op">+</span><span class="st"> </span>x, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb642-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb642-15" data-line-number="15">  <span class="co"># extract the parameter SD</span></a>
<a class="sourceLine" id="cb642-16" data-line-number="16">  <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcov</span>(m)))[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb642-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb642-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb642-19" data-line-number="19"></a>
<a class="sourceLine" id="cb642-20" data-line-number="20"><span class="co"># how many simulations per `rho`-value would you like?</span></a>
<a class="sourceLine" id="cb642-21" data-line-number="21">n_seed &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb642-22" data-line-number="22"><span class="co"># how many `rho`-values from 0 to .99 would you like to evaluate the process over?</span></a>
<a class="sourceLine" id="cb642-23" data-line-number="23">n_rho  &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb642-24" data-line-number="24"></a>
<a class="sourceLine" id="cb642-25" data-line-number="25">d &lt;-</a>
<a class="sourceLine" id="cb642-26" data-line-number="26"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">seed =</span> <span class="dv">1</span><span class="op">:</span>n_seed,</a>
<a class="sourceLine" id="cb642-27" data-line-number="27">           <span class="dt">rho  =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="fl">.99</span>, <span class="dt">length.out =</span> n_rho))  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-28" data-line-number="28"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">parameter_sd =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(seed, rho, sim_coll)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-29" data-line-number="29"><span class="st">  </span><span class="kw">group_by</span>(rho) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-30" data-line-number="30"><span class="st">  </span><span class="co"># we&#39;ll `summarise()` our output by the mean and 95% intervals</span></a>
<a class="sourceLine" id="cb642-31" data-line-number="31"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(parameter_sd),</a>
<a class="sourceLine" id="cb642-32" data-line-number="32">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(parameter_sd, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb642-33" data-line-number="33">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(parameter_sd, <span class="dt">prob =</span> <span class="fl">.975</span>))</a></code></pre></div>
<p>We’ve added 95% interval bands to our version of Figure 5.10.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb643-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rho, <span class="dt">y =</span> mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ll, <span class="dt">ymax =</span> ul),</a>
<a class="sourceLine" id="cb643-4" data-line-number="4">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb643-5" data-line-number="5">              <span class="dt">fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">size =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(rho),</a>
<a class="sourceLine" id="cb643-7" data-line-number="7">       <span class="dt">y =</span> <span class="st">&quot;parameter SD&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.0072</span>))</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-33-1.png" width="312" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="post-treatment-bias" class="section level2">
<h2><span class="header-section-number">6.2</span> Post-treatment bias</h2>
<p>It helped me understand the next example by mapping out the sequence of events McElreath described in the second paragraph:</p>
<ul>
<li>seed and sprout plants</li>
<li>measure heights</li>
<li>apply different antifungal soil treatments (i.e., the experimental manipulation)</li>
<li>measure (a) the heights and (b) the presence of fungus</li>
</ul>
<p>Based on the design, let’s simulate our data.</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" data-line-number="1"><span class="co"># how many plants would you like?</span></a>
<a class="sourceLine" id="cb644-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb644-3" data-line-number="3"></a>
<a class="sourceLine" id="cb644-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">71</span>)</a>
<a class="sourceLine" id="cb644-5" data-line-number="5">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb644-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">h0        =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb644-7" data-line-number="7">         <span class="dt">treatment =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">each =</span> n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb644-8" data-line-number="8">         <span class="dt">fungus    =</span> <span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">.5</span> <span class="op">-</span><span class="st"> </span>treatment <span class="op">*</span><span class="st"> </span><span class="fl">0.4</span>),</a>
<a class="sourceLine" id="cb644-9" data-line-number="9">         <span class="dt">h1        =</span> h0 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">5</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>fungus, <span class="dt">sd =</span> <span class="dv">1</span>))</a></code></pre></div>
<p>We’ll use <code>head()</code> to peek at the data.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb645-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##      h0 treatment fungus    h1
##   &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1  9.14         0      0  14.3
## 2  9.11         0      0  15.6
## 3  9.04         0      0  14.4
## 4 10.8          0      0  15.8
## 5  9.16         0      1  11.5
## 6  7.63         0      0  11.1</code></pre>
<p>And here’s a quick summary with <code>tidybayes::mean_qi()</code>.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb647-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb647-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb647-4" data-line-number="4"><span class="st">  </span><span class="kw">mean_qi</span>(<span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb647-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   key       value .lower .upper .width .point .interval
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 fungus     0.23   0       1     0.89 mean   qi       
## 2 h0         9.96   6.57   13.1   0.89 mean   qi       
## 3 h1        14.4   10.6    17.9   0.89 mean   qi       
## 4 treatment  0.5    0       1     0.89 mean   qi</code></pre>
<div id="a-prior-is-born." class="section level3">
<h3><span class="header-section-number">6.2.1</span> A prior is born.</h3>
<p>Let’s take a look at the <span class="math inline">\(p \sim \operatorname{Log-Normal}(0, 0.25)\)</span> prior distribution.</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb649-2" data-line-number="2"></a>
<a class="sourceLine" id="cb649-3" data-line-number="3"><span class="co"># simulate</span></a>
<a class="sourceLine" id="cb649-4" data-line-number="4">sim_p &lt;-</a>
<a class="sourceLine" id="cb649-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">sim_p =</span> <span class="kw">rlnorm</span>(<span class="fl">1e4</span>, <span class="dt">meanlog =</span> <span class="dv">0</span>, <span class="dt">sdlog =</span> <span class="fl">0.25</span>)) </a>
<a class="sourceLine" id="cb649-6" data-line-number="6"></a>
<a class="sourceLine" id="cb649-7" data-line-number="7"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb649-8" data-line-number="8">sim_p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb649-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">exp(sim_p)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(sim_p)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb649-10" data-line-number="10"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb649-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb649-12" data-line-number="12"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb649-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.x =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb649-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scale =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-37-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Summarize.</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" data-line-number="1">sim_p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb650-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">exp(sim_p)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(sim_p)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb650-3" data-line-number="3"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb650-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb650-5" data-line-number="5"><span class="st">  </span><span class="kw">mean_qi</span>(<span class="dt">.width =</span> <span class="fl">.89</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb650-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   key        value .lower .upper .width .point .interval
##   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 exp(sim_p)  2.92   1.96   4.49   0.89 mean   qi       
## 2 sim_p       1.03   0.67   1.5    0.89 mean   qi</code></pre>
<p>So then, our initial statistical model follows the form</p>
<p><span class="math display">\[
\begin{align*}
h_{1i} &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i  &amp; = h_{0i} \times p \\
p      &amp; \sim \operatorname{Log-Normal}(0, 0.25) \\
\sigma &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
<p>Let’s fit the model.</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" data-line-number="1">b6<span class="fl">.6</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb652-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb652-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb652-4" data-line-number="4">      h1 <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>h0,</a>
<a class="sourceLine" id="cb652-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb652-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb652-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb652-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb652-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.06&quot;</span>)</a></code></pre></div>
<p>Behold the summary.</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.6</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: h1 ~ 0 + h0 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## h0     1.43      0.02     1.39     1.46 1.00     3543     2357
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.82      0.13     1.58     2.10 1.00     3052     2478
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>So then, the expectation is an increase of about 43 percent relative to <span class="math inline">\(h_0\)</span>. But this isn’t the best model. We’re leaving important predictors on the table. Our updated model follows the form</p>
<p><span class="math display">\[
\begin{align*}
h_{1i}  &amp; \sim  \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = h_{0,i} \times p \\
p       &amp; = \alpha + \beta_1 \text{treatment}_i + \beta_2 \text{fungus}_i \\
\alpha  &amp; \sim \operatorname{Log-Normal}(0, 0.25) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
<p>That is, now the “proportion of growth <span class="math inline">\(p\)</span> is now a function of the predictor variables” (p. 172). Although we will fit the equivalent of McElreath’s model in <strong>brms</strong>, I’m not aware that we can translate it directly into <strong>brms</strong> syntax. But take a look at the critical two lines from above:</p>
<p><span class="math display">\[
\begin{align*}
\mu_i &amp; = h_{0,i} \times p \\
p     &amp; = \alpha + \beta_1 \text{treatment}_i + \beta_2 \text{fungus}_i. \\
\end{align*}
\]</span></p>
<p>With just a little algebra, we can re-express that as</p>
<p><span class="math display">\[
\mu_i = h_{0i} \times (\alpha + \beta_1 \text{treatment}_i + \beta_2 \text{fungus}_i).
\]</span></p>
<p>With <strong>brms</strong>, we fit models like that using the <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">non-linear syntax</a> <span class="citation">(Bürkner, <a href="#ref-Bürkner2020Non_linear">2020</a><a href="#ref-Bürkner2020Non_linear">d</a>)</span>, which we introduced at the end of Chapter 5. Here it is for <code>b6.7</code>.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1">b6<span class="fl">.7</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb655-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb655-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb655-4" data-line-number="4">      <span class="kw">bf</span>(h1 <span class="op">~</span><span class="st"> </span>h0 <span class="op">*</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>t <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>f <span class="op">*</span><span class="st"> </span>fungus),</a>
<a class="sourceLine" id="cb655-5" data-line-number="5">         a <span class="op">+</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span>f <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb655-6" data-line-number="6">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb655-7" data-line-number="7">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb655-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">nlpar =</span> t),</a>
<a class="sourceLine" id="cb655-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">nlpar =</span> f),</a>
<a class="sourceLine" id="cb655-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb655-11" data-line-number="11">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb655-12" data-line-number="12">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb655-13" data-line-number="13">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.07&quot;</span>)</a></code></pre></div>
<p>To explain what’s going on with our <code>formula</code>syntax, it’s probably best to quote Bürkner’s <span class="citation">(<a href="#ref-Bürkner2020Non_linear">2020</a><a href="#ref-Bürkner2020Non_linear">d</a>)</span> <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">vignette</a> at length:</p>
<blockquote>
<p>When looking at the above code, the first thing that becomes obvious is that we changed the <code>formula</code> syntax to display the non-linear formula including predictors (i.e., [<code>h0</code>, <code>treatment</code>, and <code>fungus</code>]) and parameters (i.e., [<code>a</code>, <code>t</code>, and <code>f</code>]) wrapped in a call to [the <code>bf()</code> function]. This stands in contrast to classical <strong>R</strong> formulas, where only predictors are given and parameters are implicit. The argument [<code>a + t + f ~ 1</code>] serves two purposes. First, it provides information, which variables in <code>formula</code> are parameters, and second, it specifies the linear predictor terms for each parameter. In fact, we should think of non-linear parameters as placeholders for linear predictor terms rather than as parameters themselves (see also the following examples). In the present case, we have no further variables to predict [<code>a</code>, <code>t</code>, and <code>f</code>] and thus we just fit intercepts that represent our estimates of [<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(t\)</span>, and <span class="math inline">\(f\)</span>]. The formula [<code>a + t + f ~ 1</code>] is a short form of [<code>a ~ 1, t ~ 1, f ~ 1</code>] that can be used if multiple non-linear parameters share the same formula. Setting <code>nl = TRUE</code> tells <strong>brms</strong> that the formula should be treated as non-linear.</p>
<p>In contrast to generalized linear models, priors on population-level parameters (i.e., ‘fixed effects’) are often mandatory to identify a non-linear model. Thus, <strong>brms</strong> requires the user to explicitely specify these priors. In the present example, we used a [<code>lognormal(0, 0.2)</code> prior on (the population-level intercept of) <code>a</code>, while we used a <code>normal(0, 0.5)</code> prior on both (population-level intercepts of) <code>t</code> and <code>f</code>]. Setting priors is a non-trivial task in all kinds of models, especially in non-linear models, so you should always invest some time to think of appropriate priors. Quite often, you may be forced to change your priors after fitting a non-linear model for the first time, when you observe different MCMC chains converging to different posterior regions. This is a clear sign of an idenfication problem and one solution is to set stronger (i.e., more narrow) priors. (<strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Let’s see what we’ve done.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.7</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: h1 ~ h0 * (a + t * treatment + f * fungus) 
##          a ~ 1
##          t ~ 1
##          f ~ 1
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_Intercept     1.48      0.03     1.43     1.53 1.00     1664     1797
## t_Intercept     0.00      0.03    -0.06     0.07 1.00     1764     1713
## f_Intercept    -0.27      0.04    -0.34    -0.19 1.00     2167     2201
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.44      0.10     1.26     1.67 1.00     2722     2599
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>All in all, it looks like we did a good job matching up McElreath’s results. The posterior doesn’t, however, match up well with the way we generated the data…</p>
</div>
<div id="blocked-by-consequence." class="section level3">
<h3><span class="header-section-number">6.2.2</span> Blocked by consequence.</h3>
<p>To measure the treatment effect properly, we should omit <code>fungus</code> from the model. This leaves us with the equation</p>
<p><span class="math display">\[
\begin{align*}
h_{1i}  &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = h_{0i} \times (\alpha + \beta_1 \text{treatment}_i) \\
\alpha  &amp; \sim \operatorname{Log-Normal}(0, 0.25) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">b6<span class="fl">.8</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb658-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb658-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb658-4" data-line-number="4">      <span class="kw">bf</span>(h1 <span class="op">~</span><span class="st"> </span>h0 <span class="op">*</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>t <span class="op">*</span><span class="st"> </span>treatment),</a>
<a class="sourceLine" id="cb658-5" data-line-number="5">         a <span class="op">+</span><span class="st"> </span>t <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb658-6" data-line-number="6">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb658-7" data-line-number="7">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb658-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">nlpar =</span> t),</a>
<a class="sourceLine" id="cb658-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb658-10" data-line-number="10">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb658-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb658-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.08&quot;</span>)</a></code></pre></div>
<p>Did we do better?</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.8</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: h1 ~ h0 * (a + t * treatment) 
##          a ~ 1
##          t ~ 1
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_Intercept     1.38      0.03     1.33     1.43 1.00     2012     2414
## t_Intercept     0.09      0.03     0.02     0.15 1.00     1886     2108
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.79      0.13     1.55     2.06 1.00     2375     2212
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Yes, now we have a positive treatment effect.</p>
</div>
<div id="fungus-and-d-separation." class="section level3">
<h3><span class="header-section-number">6.2.3</span> Fungus and <span class="math inline">\(d\)</span>-separation.</h3>
<p>Let’s make a DAG.</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" data-line-number="1"><span class="co"># define our coordinates</span></a>
<a class="sourceLine" id="cb661-2" data-line-number="2">dag_coords &lt;-</a>
<a class="sourceLine" id="cb661-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;H0&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;H1&quot;</span>),</a>
<a class="sourceLine" id="cb661-4" data-line-number="4">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb661-5" data-line-number="5">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">1.5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb661-6" data-line-number="6"></a>
<a class="sourceLine" id="cb661-7" data-line-number="7"><span class="co"># save our DAG</span></a>
<a class="sourceLine" id="cb661-8" data-line-number="8">dag &lt;-</a>
<a class="sourceLine" id="cb661-9" data-line-number="9"><span class="st">  </span><span class="kw">dagify</span>(F <span class="op">~</span><span class="st"> </span>T,</a>
<a class="sourceLine" id="cb661-10" data-line-number="10">         H1 <span class="op">~</span><span class="st"> </span>H0 <span class="op">+</span><span class="st"> </span>F,</a>
<a class="sourceLine" id="cb661-11" data-line-number="11">         <span class="dt">coords =</span> dag_coords)</a>
<a class="sourceLine" id="cb661-12" data-line-number="12"></a>
<a class="sourceLine" id="cb661-13" data-line-number="13"><span class="co"># plot </span></a>
<a class="sourceLine" id="cb661-14" data-line-number="14">dag <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb661-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb661-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">6.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb661-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb661-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb661-19" data-line-number="19"><span class="st">  </span><span class="kw">theme_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-42-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We’ll be making a lot of simple DAGs following this format over this chapter. To streamline out plotting code, let’s make a custom plotting function. I’ll call it <code>gg_simple_dag()</code>.</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1">gg_simple_dag &lt;-<span class="st"> </span><span class="cf">function</span>(d) {</a>
<a class="sourceLine" id="cb662-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb662-3" data-line-number="3">  d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb662-4" data-line-number="4"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb662-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">6.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb662-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb662-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb662-8" data-line-number="8"><span class="st">    </span><span class="kw">theme_dag</span>()</a>
<a class="sourceLine" id="cb662-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb662-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb662-11" data-line-number="11"></a>
<a class="sourceLine" id="cb662-12" data-line-number="12"><span class="co"># try it out!</span></a>
<a class="sourceLine" id="cb662-13" data-line-number="13">dag <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb662-14" data-line-number="14"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-43-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Anyway, the DAG clarifies</p>
<blockquote>
<p>that learning the treatment tells us nothing about the outcome, once we know the fungus status.</p>
<p>An even more DAG way to say this is that conditioning on <span class="math inline">\(F\)</span> induces <strong>d-separation</strong>. The “d” stands for <em>directional</em>. D-separation means that some variables on a directed graph are independent of others. There is no path connecting them. In this case, <span class="math inline">\(H_1\)</span> is d-separated from <span class="math inline">\(T\)</span>, but only when we condition on <span class="math inline">\(F\)</span>. Conditioning on <span class="math inline">\(F\)</span> effectively blocks the directed path <span class="math inline">\(T \rightarrow F \rightarrow H_1\)</span>, making <span class="math inline">\(T\)</span> and <span class="math inline">\(H_1\)</span> independent (d-separated).</p>
</blockquote>
<p>Note that our ggdag object, <code>dag</code>, will also work with the <code>dagitty::dseparated()</code> function.</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1"><span class="kw">library</span>(dagitty)</a>
<a class="sourceLine" id="cb663-2" data-line-number="2"></a>
<a class="sourceLine" id="cb663-3" data-line-number="3">dag <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb663-4" data-line-number="4"><span class="st">  </span><span class="kw">dseparated</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;H1&quot;</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" data-line-number="1">dag <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb665-2" data-line-number="2"><span class="st">  </span><span class="kw">dseparated</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;H1&quot;</span>, <span class="st">&quot;F&quot;</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The descriptively-named <code>dagitty::mpliedConditionalIndependencies()</code> function will work, too.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1"><span class="kw">impliedConditionalIndependencies</span>(dag)</a></code></pre></div>
<pre><code>## F _||_ H0
## H0 _||_ T
## H1 _||_ T | F</code></pre>
<p>Notice that last line. “Final height is independent of treatment, when conditioning on fungus” (p. 175). Now consider a DAG of a different kind of causal structure.</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" data-line-number="1"><span class="co"># define our coordinates</span></a>
<a class="sourceLine" id="cb669-2" data-line-number="2">dag_coords &lt;-</a>
<a class="sourceLine" id="cb669-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;H0&quot;</span>, <span class="st">&quot;H1&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>),</a>
<a class="sourceLine" id="cb669-4" data-line-number="4">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb669-5" data-line-number="5">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb669-6" data-line-number="6"></a>
<a class="sourceLine" id="cb669-7" data-line-number="7"><span class="co"># save our DAG</span></a>
<a class="sourceLine" id="cb669-8" data-line-number="8">dag &lt;-</a>
<a class="sourceLine" id="cb669-9" data-line-number="9"><span class="st">  </span><span class="kw">dagify</span>(F <span class="op">~</span><span class="st"> </span>M <span class="op">+</span><span class="st"> </span>T,</a>
<a class="sourceLine" id="cb669-10" data-line-number="10">         H1 <span class="op">~</span><span class="st"> </span>H0 <span class="op">+</span><span class="st"> </span>M,</a>
<a class="sourceLine" id="cb669-11" data-line-number="11">         <span class="dt">coords =</span> dag_coords)</a>
<a class="sourceLine" id="cb669-12" data-line-number="12"></a>
<a class="sourceLine" id="cb669-13" data-line-number="13"><span class="co"># plot </span></a>
<a class="sourceLine" id="cb669-14" data-line-number="14">dag <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb669-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb669-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name <span class="op">==</span><span class="st"> &quot;M&quot;</span>),</a>
<a class="sourceLine" id="cb669-17" data-line-number="17">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb669-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">x =</span> <span class="fl">2.5</span>, <span class="dt">y =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb669-19" data-line-number="19">             <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">stroke =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb669-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb669-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb669-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb669-23" data-line-number="23"><span class="st">  </span><span class="kw">theme_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-46-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Our custom <code>gg_simple_dag()</code> was a little too brittle to accommodate DAGs that mark of unobserved variables. Since we’ll be making a few more DADs of this kind, we’ll make one more custom plotting function. We’ll call this one <code>gg_fancy_dag()</code>.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1">gg_fancy_dag &lt;-<span class="st"> </span><span class="cf">function</span>(d, <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">circle =</span> <span class="st">&quot;U&quot;</span>) {</a>
<a class="sourceLine" id="cb670-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb670-3" data-line-number="3">  d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-4" data-line-number="4"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_dag_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> name <span class="op">==</span><span class="st"> </span>circle),</a>
<a class="sourceLine" id="cb670-6" data-line-number="6">                   <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, </a>
<a class="sourceLine" id="cb670-8" data-line-number="8">               <span class="dt">size =</span> <span class="fl">6.5</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">stroke =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-9" data-line-number="9"><span class="st">    </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-10" data-line-number="10"><span class="st">    </span><span class="kw">geom_dag_edges</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-11" data-line-number="11"><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-12" data-line-number="12"><span class="st">    </span><span class="kw">theme_dag</span>()</a>
<a class="sourceLine" id="cb670-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb670-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb670-15" data-line-number="15"></a>
<a class="sourceLine" id="cb670-16" data-line-number="16"><span class="co"># check it out</span></a>
<a class="sourceLine" id="cb670-17" data-line-number="17">dag <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-18" data-line-number="18"><span class="st">  </span><span class="kw">gg_fancy_dag</span>(<span class="dt">x =</span> <span class="fl">2.5</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">circle =</span> <span class="st">&quot;M&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-47-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Here we simulate some data based on the new DAG.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">71</span>)</a>
<a class="sourceLine" id="cb671-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb671-3" data-line-number="3"></a>
<a class="sourceLine" id="cb671-4" data-line-number="4">d2 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb671-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">h0        =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb671-6" data-line-number="6">         <span class="dt">treatment =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">each =</span> n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb671-7" data-line-number="7">         <span class="dt">m         =</span> <span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb671-8" data-line-number="8">         <span class="dt">fungus    =</span> <span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">.5</span> <span class="op">-</span><span class="st"> </span>treatment <span class="op">*</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">*</span><span class="st"> </span>m),</a>
<a class="sourceLine" id="cb671-9" data-line-number="9">         <span class="dt">h1        =</span> h0 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>m))</a>
<a class="sourceLine" id="cb671-10" data-line-number="10"></a>
<a class="sourceLine" id="cb671-11" data-line-number="11"><span class="kw">head</span>(d2)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##      h0 treatment     m fungus    h1
##   &lt;dbl&gt;     &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1  9.14         0     0      0  14.8
## 2  9.11         0     0      0  15.3
## 3  9.04         0     1      1  16.4
## 4 10.8          0     1      1  19.1
## 5  9.16         0     1      1  17.2
## 6  7.63         0     0      0  13.4</code></pre>
<p>Use <code>update()</code> to refit <code>b6.7</code> and <code>b6.8</code> to the new data.</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" data-line-number="1">b6<span class="fl">.7</span>b &lt;-</a>
<a class="sourceLine" id="cb673-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b6<span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb673-3" data-line-number="3">         <span class="dt">newdata =</span> d2,</a>
<a class="sourceLine" id="cb673-4" data-line-number="4">         <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb673-5" data-line-number="5">         <span class="dt">file =</span> <span class="st">&quot;fits/b06.07b&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: It appears as if you have specified a lower bounded prior on a parameter that has no natural lower bound.
## If this is really what you want, please specify argument &#39;lb&#39; of &#39;set_prior&#39; appropriately.
## Warning occurred for prior 
## b_a ~ lognormal(0, 0.2)</code></pre>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1">b6<span class="fl">.8</span>b &lt;-</a>
<a class="sourceLine" id="cb675-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b6<span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb675-3" data-line-number="3">         <span class="dt">newdata =</span> d2,</a>
<a class="sourceLine" id="cb675-4" data-line-number="4">         <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb675-5" data-line-number="5">         <span class="dt">file =</span> <span class="st">&quot;fits/b06.08b&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: It appears as if you have specified a lower bounded prior on a parameter that has no natural lower bound.
## If this is really what you want, please specify argument &#39;lb&#39; of &#39;set_prior&#39; appropriately.
## Warning occurred for prior 
## b_a ~ lognormal(0, 0.2)</code></pre>
<p>Check the results.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" data-line-number="1"><span class="kw">posterior_summary</span>(b6<span class="fl">.7</span>b) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##               Estimate Est.Error     Q2.5    Q97.5
## b_a_Intercept     1.52      0.01     1.50     1.55
## b_t_Intercept     0.05      0.01     0.02     0.08
## b_f_Intercept     0.14      0.01     0.12     0.17
## sigma             2.11      0.05     2.02     2.20
## lp__          -2168.96      1.38 -2172.38 -2167.21</code></pre>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb679-1" data-line-number="1"><span class="kw">posterior_summary</span>(b6<span class="fl">.8</span>b) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##               Estimate Est.Error     Q2.5    Q97.5
## b_a_Intercept     1.62      0.01     1.61     1.64
## b_t_Intercept    -0.01      0.01    -0.04     0.02
## sigma             2.21      0.05     2.11     2.31
## lp__          -2216.68      1.25 -2219.96 -2215.29</code></pre>
<p>“Including fungus again confounds inference about the treatment, this time by making it seem like it helped the plants, even though it had no effect” (p. 175).</p>
<div id="rethinking-model-selection-doesnt-help." class="section level4">
<h4><span class="header-section-number">6.2.3.1</span> Rethinking: Model selection doesn’t help.</h4>
<blockquote>
<p>In the next chapter, you’ll learn about model selection using information criteria. Like other model comparison and selection schemes, these criteria help in contrasting and choosing model structure. But such approaches are no help in the example presented just above, since the model that includes fungus both fits the sample better and would make better out-of-sample predictions. Model [<code>b6.7</code>] misleads because it asks the wrong question, not because it would make poor predictions. As argued in Chapter 1, prediction and causal inference are just not the same task. No statistical procedure can substitute for scientific knowledge and attention to it. We need multiple models because they help us understand causal paths, not just so we can choose one or another for prediction. (p. 175)</p>
</blockquote>
<p>Brutal.</p>
</div>
</div>
</div>
<div id="collider-bias" class="section level2">
<h2><span class="header-section-number">6.3</span> Collider bias</h2>
<p>Make the collider bias DAG of the trustworthiness/newsworthiness example.</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb681-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb681-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;N&quot;</span>),</a>
<a class="sourceLine" id="cb681-3" data-line-number="3">         <span class="dt">x    =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb681-4" data-line-number="4">         <span class="dt">y    =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb681-5" data-line-number="5"></a>
<a class="sourceLine" id="cb681-6" data-line-number="6"><span class="kw">dagify</span>(S <span class="op">~</span><span class="st"> </span>T <span class="op">+</span><span class="st"> </span>N,</a>
<a class="sourceLine" id="cb681-7" data-line-number="7">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb681-8" data-line-number="8"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-50-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The fact that two arrows enter <span class="math inline">\(S\)</span> means it is a <strong>collider</strong>. The core concept is easy to understand: When you condition on a collider, it creates statistical–but not necessarily causal–associations among its causes. In this case, once you learn that a proposal has been selected (<span class="math inline">\(S\)</span>), then learning its trustworthiness (<span class="math inline">\(T\)</span>) also provides information about its newsworthiness (<span class="math inline">\(N\)</span>). Why? Because if, for example, a selected proposal has low trustworthiness, then it must have high newsworthiness. Otherwise it wouldn’t have been funded. The same works in reverse: If a proposal has low newsworthiness, we’d infer that it must have higher than average trustworthiness. Otherwise it would not have been selected for funding. (p. 176. <strong>emphasis</strong> in the original)</p>
</blockquote>
<div id="collider-of-false-sorrow." class="section level3">
<h3><span class="header-section-number">6.3.1</span> Collider of false sorrow.</h3>
<p>All it takes is a single <code>mutate()</code> line in the <code>dagify()</code> function to amend our previous DAG.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" data-line-number="1"><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb682-2" data-line-number="2">       <span class="dt">coords =</span> dag_coords <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb682-3" data-line-number="3"><span class="st">         </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;A&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb682-4" data-line-number="4"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-51-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>In this made-up example,</p>
<blockquote>
<p>happiness (<span class="math inline">\(H\)</span>) and age (<span class="math inline">\(A\)</span>) both cause marriage (<span class="math inline">\(M\)</span>). Marriage is therefore a collider. Even though there is no causal association between happiness and age, if we condition on marriage–which means here, if we include it as a predictor in a regression–then it will induce a statistical association between age and happiness. And this can mislead us to think that happiness changes with age, when in fact it is constant.</p>
<p>To convince you of this, let’s do another simulation. (pp. 176–177)</p>
</blockquote>
<p>Here’s the code for McElreath’s <code>rethinking::sim_happiness()</code> function.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb683-1" data-line-number="1">rethinking<span class="op">::</span>sim_happiness</a></code></pre></div>
<pre><code>## function (seed = 1977, N_years = 1000, max_age = 65, N_births = 20, 
##     aom = 18) 
## {
##     set.seed(seed)
##     H &lt;- M &lt;- A &lt;- c()
##     for (t in 1:N_years) {
##         A &lt;- A + 1
##         A &lt;- c(A, rep(1, N_births))
##         H &lt;- c(H, seq(from = -2, to = 2, length.out = N_births))
##         M &lt;- c(M, rep(0, N_births))
##         for (i in 1:length(A)) {
##             if (A[i] &gt;= aom &amp; M[i] == 0) {
##                 M[i] &lt;- rbern(1, inv_logit(H[i] - 4))
##             }
##         }
##         deaths &lt;- which(A &gt; max_age)
##         if (length(deaths) &gt; 0) {
##             A &lt;- A[-deaths]
##             H &lt;- H[-deaths]
##             M &lt;- M[-deaths]
##         }
##     }
##     d &lt;- data.frame(age = A, married = M, happiness = H)
##     return(d)
## }
## &lt;bytecode: 0x7fb2ac166b78&gt;
## &lt;environment: namespace:rethinking&gt;</code></pre>
<p>Quite frankly, I can’t make sense of it. So we’ll just have to move forward and use the convenience function rather than practicing a <strong>tidyverse</strong> alternative. If you have a handle on what’s going on and have a <strong>tidyverse</strong> alternative, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">please share your code</a>.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb685-1" data-line-number="1">d &lt;-<span class="st"> </span>rethinking<span class="op">::</span><span class="kw">sim_happiness</span>(<span class="dt">seed =</span> <span class="dv">1977</span>, <span class="dt">N_years =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb685-2" data-line-number="2"></a>
<a class="sourceLine" id="cb685-3" data-line-number="3"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>##   age married  happiness
## 1  65       0 -2.0000000
## 2  65       0 -1.7894737
## 3  65       1 -1.5789474
## 4  65       0 -1.3684211
## 5  65       0 -1.1578947
## 6  65       0 -0.9473684</code></pre>
<p>Summarize the variables.</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb687-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb687-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb687-4" data-line-number="4"><span class="st">  </span><span class="kw">mean_qi</span>(value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb687-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   name      value .lower .upper .width .point .interval
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 age        33        2     64   0.95 mean   qi       
## 2 happiness   0       -2      2   0.95 mean   qi       
## 3 married     0.3      0      1   0.95 mean   qi</code></pre>
<p>Here’s our version of Figure 6.5.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb689-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb689-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">married =</span> <span class="kw">factor</span>(married,</a>
<a class="sourceLine" id="cb689-3" data-line-number="3">                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;unmarried&quot;</span>, <span class="st">&quot;married&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb689-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb689-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> happiness)) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> married), <span class="dt">size =</span> <span class="fl">1.75</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="ot">NULL</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;grey85&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">015</span>, <span class="fl">.015</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-55-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Here’s the simple Gaussian multivariable model predicting happiness:</p>
<p><span class="math display">\[
\begin{align*}
\text{happiness}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i              &amp; = \alpha_{\text{married} [i]} + \beta_1 \text{age}_i ,\\
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\text{married}[i]\)</span> is the marriage status of individual <span class="math inline">\(i\)</span>. Here we make <code>d2</code>, the subset of <code>d</code> containing only those 18 and up. We then make a new <code>age</code> variable, <code>a</code>, which is scaled such that <span class="math inline">\(18 = 0\)</span>, <span class="math inline">\(65 = 1\)</span>, and so on.</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" data-line-number="1">d2 &lt;-</a>
<a class="sourceLine" id="cb690-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb690-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(age <span class="op">&gt;</span><span class="st"> </span><span class="dv">17</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb690-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">a =</span> (age <span class="op">-</span><span class="st"> </span><span class="dv">18</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">65</span> <span class="op">-</span><span class="st"> </span><span class="dv">18</span>))</a>
<a class="sourceLine" id="cb690-5" data-line-number="5"></a>
<a class="sourceLine" id="cb690-6" data-line-number="6"><span class="kw">head</span>(d2)</a></code></pre></div>
<pre><code>##   age married  happiness a
## 1  65       0 -2.0000000 1
## 2  65       0 -1.7894737 1
## 3  65       1 -1.5789474 1
## 4  65       0 -1.3684211 1
## 5  65       0 -1.1578947 1
## 6  65       0 -0.9473684 1</code></pre>
<p>With respect to priors,</p>
<blockquote>
<p>Happiness is on an arbitrary scale, in these data, from −2 to +2. So our imaginary strongest relationship, taking happiness from maximum to minimum, has a slope with rise over run of <span class="math inline">\((2 − (−2))/1 = 4\)</span>. Remember that 95% of the mass of a normal distribution is contained within 2 standard deviations. So if we set the standard deviation of the prior to half of 4, we are saying that we expect 95% of plausible slopes to be less than maximally strong. That isn’t a very strong prior, but again, it at least helps bound inference to realistic ranges. Now for the intercepts. Each <span class="math inline">\(\alpha\)</span> is the value of <span class="math inline">\(\mu_i\)</span> when <span class="math inline">\(A_i = 0\)</span>. In this case, that means at age 18. So we need to allow <span class="math inline">\(\alpha\)</span> to cover the full range of happiness scores. <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> will put 95% of the mass in the −2 to +2 interval. (p. 178)</p>
</blockquote>
<p>Here we’ll take one last step before fitting our model with <strong>brms</strong>. Saving <code>mid</code> as a factor will make it easier to interpret the model results.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb692-1" data-line-number="1">d2 &lt;-</a>
<a class="sourceLine" id="cb692-2" data-line-number="2"><span class="st">  </span>d2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb692-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mid =</span> <span class="kw">factor</span>(married <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;single&quot;</span>, <span class="st">&quot;married&quot;</span>)))</a>
<a class="sourceLine" id="cb692-4" data-line-number="4"></a>
<a class="sourceLine" id="cb692-5" data-line-number="5"><span class="kw">head</span>(d2)</a></code></pre></div>
<pre><code>##   age married  happiness a     mid
## 1  65       0 -2.0000000 1  single
## 2  65       0 -1.7894737 1  single
## 3  65       1 -1.5789474 1 married
## 4  65       0 -1.3684211 1  single
## 5  65       0 -1.1578947 1  single
## 6  65       0 -0.9473684 1  single</code></pre>
<p>Fit the model.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb694-1" data-line-number="1">b6<span class="fl">.9</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb694-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb694-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb694-4" data-line-number="4">      happiness <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>mid <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb694-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> midmarried),</a>
<a class="sourceLine" id="cb694-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> midsingle),</a>
<a class="sourceLine" id="cb694-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> a),</a>
<a class="sourceLine" id="cb694-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb694-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb694-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb694-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.09&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb695-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.9</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: happiness ~ 0 + mid + a 
##    Data: d2 (Number of observations: 960) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## midsingle     -0.24      0.07    -0.37    -0.11 1.00     1453     1811
## midmarried     1.26      0.09     1.09     1.43 1.00     1580     1931
## a             -0.75      0.12    -0.98    -0.52 1.00     1375     1756
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.99      0.02     0.95     1.04 1.00     2750     2436
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now drop marriage status, <code>mid</code>.</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" data-line-number="1">b6<span class="fl">.10</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb697-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb697-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb697-4" data-line-number="4">      happiness <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb697-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> Intercept),</a>
<a class="sourceLine" id="cb697-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> a),</a>
<a class="sourceLine" id="cb697-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb697-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb697-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb697-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.10&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: happiness ~ 0 + Intercept + a 
##    Data: d2 (Number of observations: 960) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.08    -0.15     0.15 1.00     1319     1646
## a             0.00      0.13    -0.26     0.26 1.00     1317     1621
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.22      0.03     1.17     1.27 1.00     2573     2213
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Wow. So when we take out <code>mid</code>, the coefficient for <code>a</code> drops to zero.</p>
<blockquote>
<p>The pattern above is exactly what we should expect when we condition on a collider. The collider is marriage status. It is a common consequence of age and happiness. As a result, when we condition on it, we induce a spurious association between the two causes. So it looks like, to model [<code>b6.9</code>], that age is negatively associated with happiness. But this is just a statistical association, not a causal association. Once we know whether someone is married or not, then their age does provide information about how happy they are. (p. 179)</p>
</blockquote>
<p>A little further down, McElreath gets rough:</p>
<blockquote>
<p>It’s easy to plead with this example. Shouldn’t marriage also influence happiness? What if happiness does change with age? But this misses the point. <em>If you don’t have a causal model, you can’t make inferences from a multiple regression</em>. And the regression itself does not provide the evidence you need to justify a causal model. Instead, you need some science. (pp. 179–180, <em>emphasis</em> added)</p>
</blockquote>
</div>
<div id="the-haunted-dag." class="section level3">
<h3><span class="header-section-number">6.3.2</span> The haunted DAG.</h3>
<p>It gets worse. “Unmeasured causes can still induce collider bias. So I’m sorry to say that we also have to consider the possibility that our DAG may be haunted” (p. 180).</p>
<p>Here’s the unhaunted DAG.</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb700-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb700-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;C&quot;</span>),</a>
<a class="sourceLine" id="cb700-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb700-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb700-5" data-line-number="5"></a>
<a class="sourceLine" id="cb700-6" data-line-number="6"><span class="kw">dagify</span>(P <span class="op">~</span><span class="st"> </span>G,</a>
<a class="sourceLine" id="cb700-7" data-line-number="7">       C <span class="op">~</span><span class="st"> </span>P <span class="op">+</span><span class="st"> </span>G,</a>
<a class="sourceLine" id="cb700-8" data-line-number="8">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb700-9" data-line-number="9"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-60-1.png" width="216" style="display: block; margin: auto;" /></p>
<p>Now we add the haunting variable, <code>U</code>.</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb701-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb701-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb701-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">2.5</span>),</a>
<a class="sourceLine" id="cb701-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb701-5" data-line-number="5"></a>
<a class="sourceLine" id="cb701-6" data-line-number="6"><span class="kw">dagify</span>(P <span class="op">~</span><span class="st"> </span>G <span class="op">+</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb701-7" data-line-number="7">       C <span class="op">~</span><span class="st"> </span>P <span class="op">+</span><span class="st"> </span>G <span class="op">+</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb701-8" data-line-number="8">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb701-9" data-line-number="9"><span class="st">  </span><span class="kw">gg_fancy_dag</span>(<span class="dt">x =</span> <span class="fl">2.5</span>, <span class="dt">y =</span> <span class="fl">1.5</span>, <span class="dt">circle =</span> <span class="st">&quot;U&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-61-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>This is a mess. Let’s simulate some data.</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb702-1" data-line-number="1"><span class="co"># how many grandparent-parent-child triads would you like?</span></a>
<a class="sourceLine" id="cb702-2" data-line-number="2">n    &lt;-<span class="st"> </span><span class="dv">200</span> </a>
<a class="sourceLine" id="cb702-3" data-line-number="3"></a>
<a class="sourceLine" id="cb702-4" data-line-number="4">b_gp &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co"># direct effect of G on P</span></a>
<a class="sourceLine" id="cb702-5" data-line-number="5">b_gc &lt;-<span class="st"> </span><span class="dv">0</span>  <span class="co"># direct effect of G on C</span></a>
<a class="sourceLine" id="cb702-6" data-line-number="6">b_pc &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co"># direct effect of P on C</span></a>
<a class="sourceLine" id="cb702-7" data-line-number="7">b_u  &lt;-<span class="st"> </span><span class="dv">2</span>  <span class="co"># direct effect of U on P and C</span></a>
<a class="sourceLine" id="cb702-8" data-line-number="8"></a>
<a class="sourceLine" id="cb702-9" data-line-number="9"><span class="co"># simulate triads</span></a>
<a class="sourceLine" id="cb702-10" data-line-number="10"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb702-11" data-line-number="11">d &lt;-</a>
<a class="sourceLine" id="cb702-12" data-line-number="12"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">u =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">.5</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb702-13" data-line-number="13">         <span class="dt">g =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb702-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> b_gp <span class="op">*</span><span class="st"> </span>g <span class="op">+</span><span class="st"> </span>b_u <span class="op">*</span><span class="st"> </span>u, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb702-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">c =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> b_pc <span class="op">*</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span>b_gc <span class="op">*</span><span class="st"> </span>g <span class="op">+</span><span class="st"> </span>b_u <span class="op">*</span><span class="st"> </span>u, <span class="dt">sd =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb702-16" data-line-number="16"></a>
<a class="sourceLine" id="cb702-17" data-line-number="17"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##       u       g     p     c
##   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1    -1 -0.620  -1.73 -3.65
## 2    -1  0.0421 -3.01 -5.30
## 3     1 -0.911   3.06  3.88
## 4     1  0.158   1.77  3.79
## 5    -1 -0.655  -1.00 -2.01
## 6     1  1.77    5.28  8.87</code></pre>
<p>Fit the model without <code>U</code>.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb704-1" data-line-number="1">b6<span class="fl">.11</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb704-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb704-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb704-4" data-line-number="4">      c <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span>g,</a>
<a class="sourceLine" id="cb704-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb704-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb704-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb704-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb704-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.11&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.11</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: c ~ 0 + Intercept + p + g 
##    Data: d (Number of observations: 200) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.12      0.10    -0.32     0.08 1.00     4195     3063
## p             1.79      0.04     1.70     1.87 1.00     3240     2968
## g            -0.84      0.11    -1.05    -0.63 1.00     3377     2692
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.43      0.07     1.30     1.57 1.00     4177     3169
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s our version of Figure 6.5.</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb707-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">centile =</span> <span class="kw">ifelse</span>(p <span class="op">&gt;=</span><span class="st"> </span><span class="kw">quantile</span>(p, <span class="dt">prob =</span> <span class="fl">.45</span>) <span class="op">&amp;</span><span class="st"> </span>p <span class="op">&lt;=</span><span class="st"> </span><span class="kw">quantile</span>(p, <span class="dt">prob =</span> <span class="fl">.60</span>), <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb707-3" data-line-number="3">         <span class="dt">u =</span> <span class="kw">factor</span>(u)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb707-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb707-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> g, <span class="dt">y =</span> c)) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> centile, <span class="dt">color =</span> u),</a>
<a class="sourceLine" id="cb707-7" data-line-number="7">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-8" data-line-number="8"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(centile <span class="op">==</span><span class="st"> &quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb707-9" data-line-number="9">              <span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fullrange =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;lightblue&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-64-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Now fit the model including <code>u</code>.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb708-1" data-line-number="1">b6<span class="fl">.12</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb708-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b6<span class="fl">.11</span>,</a>
<a class="sourceLine" id="cb708-3" data-line-number="3">         <span class="dt">newdata =</span> d,</a>
<a class="sourceLine" id="cb708-4" data-line-number="4">         <span class="dt">formula =</span> c <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>Intercept <span class="op">+</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span>g <span class="op">+</span><span class="st"> </span>u,</a>
<a class="sourceLine" id="cb708-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb708-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/b06.12&quot;</span>)</a></code></pre></div>
<p>Check the results.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" data-line-number="1"><span class="kw">print</span>(b6<span class="fl">.12</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: c ~ Intercept + p + g + u - 1 
##    Data: d (Number of observations: 200) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.12      0.07    -0.26     0.02 1.00     2949     2454
## p             1.01      0.07     0.88     1.15 1.00     1938     2311
## g            -0.05      0.10    -0.24     0.15 1.00     2223     2592
## u             1.99      0.15     1.69     2.29 1.00     1939     2545
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.04      0.05     0.94     1.14 1.00     2866     2733
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now the posterior for <span class="math inline">\(\beta_\text g\)</span> is hovering around 0, where it belongs.</p>
</div>
</div>
<div id="confronting-confounding" class="section level2">
<h2><span class="header-section-number">6.4</span> Confronting confounding</h2>
<p>“Let’s define <strong>confounding</strong> as any context in which the association between an outcome <span class="math inline">\(Y\)</span> and a predictor of interest <span class="math inline">\(X\)</span> is not the same as it would be, if we had experimentally determined the values of <span class="math inline">\(X\)</span>” (p. 183, <strong>emphasis</strong> in the original)</p>
<p>Here’s the <span class="math inline">\(E\)</span>-<span class="math inline">\(U\)</span>-<span class="math inline">\(W\)</span> DAG to help us sort this out.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb711-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb711-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;W&quot;</span>),</a>
<a class="sourceLine" id="cb711-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb711-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb711-5" data-line-number="5"></a>
<a class="sourceLine" id="cb711-6" data-line-number="6"><span class="kw">dagify</span>(E <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb711-7" data-line-number="7">       W <span class="op">~</span><span class="st"> </span>E <span class="op">+</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb711-8" data-line-number="8">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb711-9" data-line-number="9"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-66-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Here’s the alternative is we randomly assign <span class="math inline">\(E\)</span>.</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb712-1" data-line-number="1"><span class="kw">dagify</span>(W <span class="op">~</span><span class="st"> </span>E <span class="op">+</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb712-2" data-line-number="2">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb712-3" data-line-number="3"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-67-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>“Manipulation removes the confounding, because it blocks the other path between <span class="math inline">\(E\)</span> and <span class="math inline">\(W\)</span>” (p. 184).</p>
<div id="shutting-the-backdoor." class="section level3">
<h3><span class="header-section-number">6.4.1</span> Shutting the backdoor.</h3>
<blockquote>
<p>Blocking confounding paths between some predictor <span class="math inline">\(X\)</span> and some outcome <span class="math inline">\(Y\)</span> is known as shutting the <strong>backdoor</strong>. We don’t want any spurious association sneaking in through a non-causal path that enters the back of the predictor <span class="math inline">\(X\)</span>. In the example above, the path <span class="math inline">\(E \leftarrow U \rightarrow W\)</span> is a backdoor path, because it enters <span class="math inline">\(E\)</span> with an arrow and also connects <span class="math inline">\(E\)</span> to <span class="math inline">\(W\)</span>. This path is non-causal—intervening on <span class="math inline">\(E\)</span> will not cause a change in <span class="math inline">\(W\)</span> through this path—but it still produces an association between <span class="math inline">\(E\)</span> and <span class="math inline">\(W\)</span>.</p>
<p>Now for some good news. Given a causal DAG, it is always possible to say which, if any, variables one must control for in order to shut all the backdoor paths. It is also possible to say which variables one must <em>not</em> control for, in order to avoid making new confounds. And–some more good news—there are only four types of variable relations that combine to form all possible paths. (p. 184, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Here are the representations for our four types of variable relations: the fork, pipe, collider, and descendant.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb713-1" data-line-number="1">d1 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb713-2" data-line-number="2"><span class="st">  </span><span class="kw">dagify</span>(X <span class="op">~</span><span class="st"> </span>Z,</a>
<a class="sourceLine" id="cb713-3" data-line-number="3">         Y <span class="op">~</span><span class="st"> </span>Z,</a>
<a class="sourceLine" id="cb713-4" data-line-number="4">         <span class="dt">coords =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>),</a>
<a class="sourceLine" id="cb713-5" data-line-number="5">                         <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb713-6" data-line-number="6">                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb713-7" data-line-number="7"></a>
<a class="sourceLine" id="cb713-8" data-line-number="8">d2 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb713-9" data-line-number="9"><span class="st">  </span><span class="kw">dagify</span>(Z <span class="op">~</span><span class="st"> </span>X,</a>
<a class="sourceLine" id="cb713-10" data-line-number="10">         Y <span class="op">~</span><span class="st"> </span>Z,</a>
<a class="sourceLine" id="cb713-11" data-line-number="11">         <span class="dt">coords =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>),</a>
<a class="sourceLine" id="cb713-12" data-line-number="12">                         <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb713-13" data-line-number="13">                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">1.5</span>)))</a>
<a class="sourceLine" id="cb713-14" data-line-number="14"></a>
<a class="sourceLine" id="cb713-15" data-line-number="15">d3 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb713-16" data-line-number="16"><span class="st">  </span><span class="kw">dagify</span>(Z <span class="op">~</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Y,</a>
<a class="sourceLine" id="cb713-17" data-line-number="17">         <span class="dt">coords =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>),</a>
<a class="sourceLine" id="cb713-18" data-line-number="18">                         <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb713-19" data-line-number="19">                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb713-20" data-line-number="20"></a>
<a class="sourceLine" id="cb713-21" data-line-number="21">d4 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb713-22" data-line-number="22"><span class="st">  </span><span class="kw">dagify</span>(Z <span class="op">~</span><span class="st"> </span>X <span class="op">+</span><span class="st"> </span>Y,</a>
<a class="sourceLine" id="cb713-23" data-line-number="23">         D <span class="op">~</span><span class="st"> </span>Z,</a>
<a class="sourceLine" id="cb713-24" data-line-number="24">         <span class="dt">coords =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;D&quot;</span>),</a>
<a class="sourceLine" id="cb713-25" data-line-number="25">                         <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb713-26" data-line-number="26">                         <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">1.05</span>)))</a>
<a class="sourceLine" id="cb713-27" data-line-number="27"></a>
<a class="sourceLine" id="cb713-28" data-line-number="28">p1 &lt;-<span class="st"> </span><span class="kw">gg_simple_dag</span>(d1) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;The Fork&quot;</span>)</a>
<a class="sourceLine" id="cb713-29" data-line-number="29">p2 &lt;-<span class="st"> </span><span class="kw">gg_simple_dag</span>(d2) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;The Pipe&quot;</span>)</a>
<a class="sourceLine" id="cb713-30" data-line-number="30">p3 &lt;-<span class="st"> </span><span class="kw">gg_simple_dag</span>(d3) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;The Collider&quot;</span>)</a>
<a class="sourceLine" id="cb713-31" data-line-number="31">p4 &lt;-<span class="st"> </span><span class="kw">gg_simple_dag</span>(d4) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;The Descendant&quot;</span>)</a></code></pre></div>
<p>Outside of the DAGs produced by the <code>node_equivalent_dags()</code>, the <strong>ggdag</strong> package does not simultaneously plot multiple DAGs the way one might with <code>ggplot::facet_wrap()</code>. For details, see GitHub issues <a href="https://github.com/malcolmbarrett/ggdag/issues/41">#41</a> and <a href="https://github.com/malcolmbarrett/ggdag/issues/42">#42</a>. However, a simple way around that is to make each plot separately, save them, and then combine the individual plots with <strong>patchwork</strong>. Here it is, our DAGgy Figure 6.6.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb714-2" data-line-number="2"></a>
<a class="sourceLine" id="cb714-3" data-line-number="3">(p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3 <span class="op">|</span><span class="st"> </span>p4) <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;The four elemental confounds&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-69-1.png" width="960" style="display: block; margin: auto;" /></p>
<blockquote>
<p>No matter how complicated a causal DAG appears, it is always built out of these four types of relations. And since you know how to open and close each, you (or your computer) can figure out which variables you need to include or not include. Here’s the recipe:</p>
<ul>
<li>1 List all of the paths connecting <span class="math inline">\(X\)</span> (the potential cause of interest) and <span class="math inline">\(Y\)</span> (the outcome).</li>
<li>2 Classify each path by whether it is open or closed. A path is open unless it contains a collider.</li>
<li>3 Classify each path by whether it is a backdoor path. A backdoor path has an arrow entering <span class="math inline">\(X\)</span>.</li>
<li>4 If there are any open backdoor paths, decide which variable(s) to condition on to close it (if possible). (p. 185)</li>
</ul>
</blockquote>
</div>
<div id="two-roads." class="section level3">
<h3><span class="header-section-number">6.4.2</span> Two roads.</h3>
<p>“The DAG below contains an exposure of interest <span class="math inline">\(X\)</span>, an outcome of interest <span class="math inline">\(Y\)</span>, an unobserved variable <span class="math inline">\(U\)</span>, and three observed covariates (<span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span>)” (p. 186).</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb715-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb715-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>),</a>
<a class="sourceLine" id="cb715-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb715-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb715-5" data-line-number="5"></a>
<a class="sourceLine" id="cb715-6" data-line-number="6"><span class="kw">dagify</span>(B <span class="op">~</span><span class="st"> </span>C <span class="op">+</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb715-7" data-line-number="7">       C <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb715-8" data-line-number="8">       U <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb715-9" data-line-number="9">       X <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb715-10" data-line-number="10">       Y <span class="op">~</span><span class="st"> </span>C <span class="op">+</span><span class="st"> </span>X,</a>
<a class="sourceLine" id="cb715-11" data-line-number="11">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb715-12" data-line-number="12"><span class="st">  </span><span class="kw">gg_fancy_dag</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">3</span>, <span class="dt">circle =</span> <span class="st">&quot;U&quot;</span>)</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-70-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>In this DAG, there are two indirect (backdoor) paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>, which are</p>
<ul>
<li><span class="math inline">\(X \leftarrow U \leftarrow A \rightarrow C \rightarrow Y\)</span>, which is open; and</li>
<li><span class="math inline">\(X \leftarrow U \rightarrow B \leftarrow C \rightarrow Y\)</span>, which is closed.</li>
</ul>
<p>Conditioning on either <span class="math inline">\(C\)</span> or <span class="math inline">\(A\)</span> will close the open backdoor.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb716-1" data-line-number="1">dag_<span class="fl">6.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb716-2" data-line-number="2"><span class="st">  </span><span class="kw">dagitty</span>(<span class="st">&quot;dag {</span></a>
<a class="sourceLine" id="cb716-3" data-line-number="3"><span class="st">  U [unobserved]</span></a>
<a class="sourceLine" id="cb716-4" data-line-number="4"><span class="st">  X -&gt; Y</span></a>
<a class="sourceLine" id="cb716-5" data-line-number="5"><span class="st">  X &lt;- U &lt;- A -&gt; C -&gt; Y </span></a>
<a class="sourceLine" id="cb716-6" data-line-number="6"><span class="st">  U -&gt; B &lt;- C</span></a>
<a class="sourceLine" id="cb716-7" data-line-number="7"><span class="st">           }&quot;</span></a>
<a class="sourceLine" id="cb716-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb716-9" data-line-number="9"></a>
<a class="sourceLine" id="cb716-10" data-line-number="10"><span class="kw">adjustmentSets</span>(dag_<span class="fl">6.1</span>, <span class="dt">exposure =</span> <span class="st">&quot;X&quot;</span>, <span class="dt">outcome =</span> <span class="st">&quot;Y&quot;</span>)</a></code></pre></div>
<pre><code>##  { C }
##  { A }</code></pre>
</div>
<div id="backdoor-waffles." class="section level3">
<h3><span class="header-section-number">6.4.3</span> Backdoor waffles.</h3>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb718-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb718-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;W&quot;</span>),</a>
<a class="sourceLine" id="cb718-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb718-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb718-5" data-line-number="5"></a>
<a class="sourceLine" id="cb718-6" data-line-number="6"><span class="kw">dagify</span>(A <span class="op">~</span><span class="st"> </span>S,</a>
<a class="sourceLine" id="cb718-7" data-line-number="7">       D <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M <span class="op">+</span><span class="st"> </span>W,</a>
<a class="sourceLine" id="cb718-8" data-line-number="8">       M <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>S,</a>
<a class="sourceLine" id="cb718-9" data-line-number="9">       W <span class="op">~</span><span class="st"> </span>S,</a>
<a class="sourceLine" id="cb718-10" data-line-number="10">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb718-11" data-line-number="11"><span class="st">  </span><span class="kw">gg_simple_dag</span>()</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-72-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>In this graph, <span class="math inline">\(S\)</span> is whether or not a State is in the southern United States, <span class="math inline">\(A\)</span> is median age at marriage, <span class="math inline">\(M\)</span> is marriage rate, <span class="math inline">\(W\)</span> is number of Waffle Houses, and <span class="math inline">\(D\)</span> is divorce rate. This graph assumes that southern States have lower ages of marriage (<span class="math inline">\(S \rightarrow A\)</span>), higher rates of marriage both directly (<span class="math inline">\(S \rightarrow M\)</span>) and mediated through age of marriage (<span class="math inline">\(S \rightarrow A \rightarrow M\)</span>), as well as more waffles (<span class="math inline">\(S \rightarrow W\)</span>). Age of marriage and marriage rate both influence divorce.</p>
<p>There are three open backdoor paths between <span class="math inline">\(W\)</span> and <span class="math inline">\(D\)</span>. (p. 187)</p>
</blockquote>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb719-1" data-line-number="1">dag_<span class="fl">6.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb719-2" data-line-number="2"><span class="st">  </span><span class="kw">dagitty</span>(<span class="st">&quot;dag {</span></a>
<a class="sourceLine" id="cb719-3" data-line-number="3"><span class="st">  A -&gt; D</span></a>
<a class="sourceLine" id="cb719-4" data-line-number="4"><span class="st">  A -&gt; M -&gt; D</span></a>
<a class="sourceLine" id="cb719-5" data-line-number="5"><span class="st">  A &lt;- S -&gt; M</span></a>
<a class="sourceLine" id="cb719-6" data-line-number="6"><span class="st">  S -&gt; W -&gt; D</span></a>
<a class="sourceLine" id="cb719-7" data-line-number="7"><span class="st">           }&quot;</span></a>
<a class="sourceLine" id="cb719-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb719-9" data-line-number="9"></a>
<a class="sourceLine" id="cb719-10" data-line-number="10"><span class="kw">adjustmentSets</span>(dag_<span class="fl">6.2</span>, <span class="dt">exposure =</span> <span class="st">&quot;W&quot;</span>, <span class="dt">outcome =</span> <span class="st">&quot;D&quot;</span>)</a></code></pre></div>
<pre><code>##  { A, M }
##  { S }</code></pre>
<p>The first line of output indicates we’d have to condition on <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span> simultaneously. As an alternative, we could just condition on <span class="math inline">\(S\)</span>. Here are the conditional independencies implied in that DAG.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb721-1" data-line-number="1"><span class="kw">impliedConditionalIndependencies</span>(dag_<span class="fl">6.2</span>)</a></code></pre></div>
<pre><code>## A _||_ W | S
## D _||_ S | A, M, W
## M _||_ W | S</code></pre>
</div>
</div>
<div id="summary-and-a-little-more-practice" class="section level2">
<h2><span class="header-section-number">6.5</span> Summary [and a little more practice]</h2>
<blockquote>
<p>Multiple regression is no oracle, but only a golem. It is logical, but the relationships it describes are conditional associations, not causal influences. Therefore additional information, from outside the model, is needed to make sense of it. This chapter presented introductory examples of some common frustrations: multicollinearity, post-treatment bias, and collider bias. Solutions to these frustrations can be organized under a coherent framework in which hypothetical causal relations among variables are analyzed to cope with confounding. (p. 189)</p>
</blockquote>
<p>In the last section, we used a DAG to explore how including/excluding different covariates might influence our estimate of the causal relationship between the number of Waffle Houses and the divorce rate (<span class="math inline">\(W \rightarrow D\)</span>). To finish that example out, we might explore some of the possible models informed by the DAG. First we load the <a href="https://www.snopes.com/fact-check/fema-waffle-house-index/">Waffle House</a> data.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb723-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb723-2" data-line-number="2"><span class="kw">data</span>(WaffleDivorce)</a>
<a class="sourceLine" id="cb723-3" data-line-number="3">d &lt;-<span class="st"> </span>WaffleDivorce</a>
<a class="sourceLine" id="cb723-4" data-line-number="4"></a>
<a class="sourceLine" id="cb723-5" data-line-number="5"><span class="co"># standardize the continuous focal variables.</span></a>
<a class="sourceLine" id="cb723-6" data-line-number="6">d &lt;-</a>
<a class="sourceLine" id="cb723-7" data-line-number="7"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb723-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">a =</span> <span class="kw">standardize</span>(MedianAgeMarriage),</a>
<a class="sourceLine" id="cb723-9" data-line-number="9">         <span class="dt">d =</span> <span class="kw">standardize</span>(Divorce),</a>
<a class="sourceLine" id="cb723-10" data-line-number="10">         <span class="dt">m =</span> <span class="kw">standardize</span>(Marriage),</a>
<a class="sourceLine" id="cb723-11" data-line-number="11">         <span class="dt">s =</span> <span class="kw">factor</span>(South),</a>
<a class="sourceLine" id="cb723-12" data-line-number="12">         <span class="dt">w =</span> <span class="kw">standardize</span>(WaffleHouses))</a>
<a class="sourceLine" id="cb723-13" data-line-number="13"></a>
<a class="sourceLine" id="cb723-14" data-line-number="14"><span class="co"># tidy up</span></a>
<a class="sourceLine" id="cb723-15" data-line-number="15"><span class="kw">rm</span>(WaffleDivorce)</a>
<a class="sourceLine" id="cb723-16" data-line-number="16"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb723-17" data-line-number="17"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>The only focal variable we did not standardize was <code>South</code>, which is binary. Technically, you can standardize binary variables and not break the regression model. However, my preference it so leave them in their 0/1 metric. To do otherwise would complicate how you’d interpret the result of any model including them. Here is our <code>ggpairs()</code> of all five focal variables. Remember, the central issue is the causal relation between <code>w</code> and <code>d</code>.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb724-1" data-line-number="1"><span class="kw">ggpairs</span>(<span class="dt">data =</span> d, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="dv">14</span><span class="op">:</span><span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">17</span>),</a>
<a class="sourceLine" id="cb724-2" data-line-number="2">        <span class="dt">diag =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),</a>
<a class="sourceLine" id="cb724-3" data-line-number="3">        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower))</a></code></pre></div>
<p><img src="06_files/figure-gfm/unnamed-chunk-76-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Let’s fit a series of models. The priors are based on those we used the last time we saw the <code>WaffleHouses</code> data (<a href="the-many-variables-the-spurious-waffles.html#spurious-associations">Chapter 5</a>).</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb725-1" data-line-number="1">b6<span class="fl">.13</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb725-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb725-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb725-4" data-line-number="4">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w,</a>
<a class="sourceLine" id="cb725-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb725-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb725-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb725-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb725-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb725-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.13&quot;</span>)</a>
<a class="sourceLine" id="cb725-11" data-line-number="11"></a>
<a class="sourceLine" id="cb725-12" data-line-number="12">b6<span class="fl">.14</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb725-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb725-14" data-line-number="14">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb725-15" data-line-number="15">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>s,</a>
<a class="sourceLine" id="cb725-16" data-line-number="16">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb725-17" data-line-number="17">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb725-18" data-line-number="18">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb725-19" data-line-number="19">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb725-20" data-line-number="20">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb725-21" data-line-number="21">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.14&quot;</span>)</a>
<a class="sourceLine" id="cb725-22" data-line-number="22"></a>
<a class="sourceLine" id="cb725-23" data-line-number="23">b6<span class="fl">.15</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb725-24" data-line-number="24"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb725-25" data-line-number="25">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb725-26" data-line-number="26">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb725-27" data-line-number="27">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb725-28" data-line-number="28">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb725-29" data-line-number="29">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb725-30" data-line-number="30">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb725-31" data-line-number="31">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb725-32" data-line-number="32">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.15&quot;</span>)</a>
<a class="sourceLine" id="cb725-33" data-line-number="33"></a>
<a class="sourceLine" id="cb725-34" data-line-number="34">b6<span class="fl">.16</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb725-35" data-line-number="35"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb725-36" data-line-number="36">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb725-37" data-line-number="37">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb725-38" data-line-number="38">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb725-39" data-line-number="39">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb725-40" data-line-number="40">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb725-41" data-line-number="41">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb725-42" data-line-number="42">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb725-43" data-line-number="43">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.16&quot;</span>)</a>
<a class="sourceLine" id="cb725-44" data-line-number="44"></a>
<a class="sourceLine" id="cb725-45" data-line-number="45">b6<span class="fl">.17</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb725-46" data-line-number="46"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb725-47" data-line-number="47">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb725-48" data-line-number="48">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb725-49" data-line-number="49">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb725-50" data-line-number="50">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb725-51" data-line-number="51">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb725-52" data-line-number="52">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb725-53" data-line-number="53">      <span class="dt">seed =</span> <span class="dv">6</span>,</a>
<a class="sourceLine" id="cb725-54" data-line-number="54">      <span class="dt">file =</span> <span class="st">&quot;fits/b06.17&quot;</span>)</a></code></pre></div>
<p>If we extract the posterior draws from each model, the column corresponding to <span class="math inline">\(W \rightarrow D\)</span> will be <code>b_w</code>. Here we extract those columns, wrangle, and compare the posteriors in a coefficient plot.</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1">formula &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;d ~ 1 + w&quot;</span>, <span class="st">&quot;d ~ 1 + w + s&quot;</span>, <span class="st">&quot;d ~ 1 + w + a + m&quot;</span>, <span class="st">&quot;d ~ 1 + w + a&quot;</span>, <span class="st">&quot;d ~ 1 + w + m&quot;</span>)</a>
<a class="sourceLine" id="cb726-2" data-line-number="2"></a>
<a class="sourceLine" id="cb726-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">fit =</span> <span class="kw">str_c</span>(<span class="st">&quot;b6.1&quot;</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb726-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y    =</span> <span class="kw">str_c</span>(fit, <span class="st">&quot; (&quot;</span>, formula, <span class="st">&quot;)&quot;</span>),</a>
<a class="sourceLine" id="cb726-5" data-line-number="5">         <span class="dt">post =</span> purrr<span class="op">::</span><span class="kw">map</span>(fit, <span class="op">~</span><span class="kw">get</span>(.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb726-6" data-line-number="6"><span class="st">                               </span><span class="kw">posterior_samples</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb726-7" data-line-number="7"><span class="st">                               </span><span class="kw">select</span>(b_w))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb726-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(post) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb726-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb726-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_w, <span class="dt">y =</span> y, <span class="dt">color =</span> fit <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;b6.14&quot;</span>, <span class="st">&quot;b6.15&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb726-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb726-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;grey50&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb726-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(beta[w]),</a>
<a class="sourceLine" id="cb726-14" data-line-number="14">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb726-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb726-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb726-17" data-line-number="17">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: &#39;stat_pointintervalh&#39; is deprecated.
## Use &#39;stat_pointinterval&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="06_files/figure-gfm/unnamed-chunk-77-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The two <span class="math inline">\(\beta_w\)</span> posteriors corresponding to those endorsed by our DAG are in green. Frustratingly, the results from a real-world data analysis aren’t as conclusive as we may have naïvely supposed. Why? Well, McElreath left us with some words of wisdom back a few pages back:</p>
<blockquote>
<p>This DAG is obviously not satisfactory–it assumes there are no unobserved confounds, which is very unlikely for this sort of data. But we can still learn something by analyzing it. While the data cannot tell us whether a graph is correct, it can sometimes suggest how a graph is wrong. (p. 187)</p>
</blockquote>
<p>DAGs are nice tool for informing our data analytic strategy. But just as our multivariable predictor models are no fail-safes, our DAGs aren’t either. Models, theories, data-collection procedures–they all work together (or not) to determine the quality of our posteriors. To the extent any of those components are off, watch out.</p>
</div>
<div id="session-info-5" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb728-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] patchwork_1.0.0      ggdag_0.2.2          GGally_1.5.0         dagitty_0.2-2       
##  [5] rstan_2.19.3         StanHeaders_2.21.0-1 tidybayes_2.1.1      bayesplot_1.7.1     
##  [9] brms_2.13.0          Rcpp_1.0.4.6         forcats_0.5.0        stringr_1.4.0       
## [13] dplyr_0.8.5          purrr_0.3.4          readr_1.3.1          tidyr_1.0.2         
## [17] tibble_3.0.1         ggplot2_3.3.1        tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.1.7      plyr_1.8.6           igraph_1.2.5        
##   [5] splines_3.6.3        svUnit_1.0.3         crosstalk_1.1.0.1    TH.data_1.0-10      
##   [9] rstantools_2.0.0     inline_0.3.15        digest_0.6.25        htmltools_0.4.0     
##  [13] viridis_0.5.1        rsconnect_0.8.16     fansi_0.4.1          magrittr_1.5        
##  [17] graphlayouts_0.7.0   modelr_0.1.6         matrixStats_0.56.0   xts_0.12-0          
##  [21] sandwich_2.5-1       prettyunits_1.1.1    colorspace_1.4-1     ggrepel_0.8.2       
##  [25] rvest_0.3.5          ggdist_2.1.1         haven_2.2.0          xfun_0.13           
##  [29] callr_3.4.3          crayon_1.3.4         jsonlite_1.6.1       survival_3.1-12     
##  [33] zoo_1.8-7            glue_1.4.1           polyclip_1.10-0      gtable_0.3.0        
##  [37] emmeans_1.4.5        V8_3.0.2             pkgbuild_1.0.8       shape_1.4.4         
##  [41] abind_1.4-5          scales_1.1.1         mvtnorm_1.1-0        DBI_1.1.0           
##  [45] miniUI_0.1.1.1       viridisLite_0.3.0    xtable_1.8-4         stats4_3.6.3        
##  [49] DT_0.13              htmlwidgets_1.5.1    httr_1.4.1           threejs_0.3.3       
##  [53] arrayhelpers_1.1-0   RColorBrewer_1.1-2   ellipsis_0.3.1       pkgconfig_2.0.3     
##  [57] reshape_0.8.8        loo_2.2.0            farver_2.0.3         dbplyr_1.4.2        
##  [61] utf8_1.1.4           tidyselect_1.0.0     labeling_0.3         rlang_0.4.6         
##  [65] reshape2_1.4.4       later_1.0.0          munsell_0.5.0        cellranger_1.1.0    
##  [69] tools_3.6.3          cli_2.0.2            generics_0.0.2       broom_0.5.5         
##  [73] ggridges_0.5.2       evaluate_0.14        fastmap_1.0.1        yaml_2.2.1          
##  [77] processx_3.4.2       knitr_1.28           fs_1.4.1             tidygraph_1.2.0     
##  [81] ggraph_2.0.3         nlme_3.1-144         mime_0.9             xml2_1.3.1          
##  [85] compiler_3.6.3       shinythemes_1.1.2    rstudioapi_0.11      curl_4.3            
##  [89] reprex_0.3.0         tweenr_1.0.1         stringi_1.4.6        ps_1.3.3            
##  [93] Brobdingnag_1.2-6    lattice_0.20-38      Matrix_1.2-18        markdown_1.1        
##  [97] shinyjs_1.1          vctrs_0.3.1          pillar_1.4.4         lifecycle_0.2.0     
## [101] bridgesampling_1.0-0 estimability_1.3     httpuv_1.5.2         R6_2.4.1            
## [105] bookdown_0.18        promises_1.1.0       gridExtra_2.3        codetools_0.2-16    
## [109] boot_1.3-24          colourpicker_1.0     MASS_7.3-51.5        gtools_3.8.2        
## [113] assertthat_0.2.1     withr_2.2.0          shinystan_2.5.0      multcomp_1.4-13     
## [117] mgcv_1.8-31          hms_0.5.3            grid_3.6.3           coda_0.19-3         
## [121] rmarkdown_2.1        ggforce_0.3.1        shiny_1.4.0.2        lubridate_1.7.8     
## [125] base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Bürkner2020Non_linear">
<p>Bürkner, P.-C. (2020d). <em>Estimating non-linear models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html</a></p>
</div>
<div id="ref-gabryPlottingMCMCDraws2019">
<p>Gabry, J. (2019). <em>Plotting MCMC draws using the bayesplot package</em>. <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html">https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020a). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-many-variables-the-spurious-waffles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ulysses-compass.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
