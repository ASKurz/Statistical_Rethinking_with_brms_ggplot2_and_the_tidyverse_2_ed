<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Missing Data and Other Opportunities – *Statistical rethinking* 2 with rstan and the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16.html" rel="next">
<link href="./14.html" rel="prev">
<link href="./mischa_favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7d082c015fa132ca880f975003d7bf2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./15.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Missing Data and Other Opportunities</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><em>Statistical rethinking</em> 2 with rstan and the tidyverse</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Golem of Prague</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Small Worlds and Large Worlds</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling the Imaginary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Geocentric Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Many Variables &amp; The Spurious Waffles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Haunted DAG &amp; The Causal Terror</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ulysses’ Compass</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Manatees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Big Entropy and the Generalized Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">God Spiked the Integers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Monsters and Mixtures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Models With Memory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Missing Data and Other Opportunities</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Generalized Linear Madness</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><del>Horoscopes</del> Insights</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#measurement-error" id="toc-measurement-error" class="nav-link active" data-scroll-target="#measurement-error"><span class="header-section-number">15.1</span> Measurement error</a>
  <ul>
  <li><a href="#rethinking-generative-thinking-bayesian-inference" id="toc-rethinking-generative-thinking-bayesian-inference" class="nav-link" data-scroll-target="#rethinking-generative-thinking-bayesian-inference"><span class="header-section-number">15.1.0.1</span> Rethinking: Generative thinking, Bayesian inference</a></li>
  <li><a href="#error-on-the-outcome" id="toc-error-on-the-outcome" class="nav-link" data-scroll-target="#error-on-the-outcome"><span class="header-section-number">15.1.1</span> Error on the outcome</a></li>
  <li><a href="#error-on-both-outcome-and-predictor" id="toc-error-on-both-outcome-and-predictor" class="nav-link" data-scroll-target="#error-on-both-outcome-and-predictor"><span class="header-section-number">15.1.2</span> Error on both outcome and predictor</a></li>
  <li><a href="#measurement-terrors" id="toc-measurement-terrors" class="nav-link" data-scroll-target="#measurement-terrors"><span class="header-section-number">15.1.3</span> Measurement terrors</a></li>
  </ul></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">15.2</span> Missing data</a>
  <ul>
  <li><a href="#rethinking-missing-data-are-meaningful-data" id="toc-rethinking-missing-data-are-meaningful-data" class="nav-link" data-scroll-target="#rethinking-missing-data-are-meaningful-data"><span class="header-section-number">15.2.0.1</span> Rethinking: Missing data are meaningful data</a></li>
  <li><a href="#dag-ate-my-homework" id="toc-dag-ate-my-homework" class="nav-link" data-scroll-target="#dag-ate-my-homework"><span class="header-section-number">15.2.1</span> DAG ate my homework</a>
  <ul>
  <li><a href="#rethinking-naming-completely-at-random" id="toc-rethinking-naming-completely-at-random" class="nav-link" data-scroll-target="#rethinking-naming-completely-at-random"><span class="header-section-number">15.2.1.1</span> Rethinking: Naming completely at random</a></li>
  </ul></li>
  <li><a href="#imputing-primates" id="toc-imputing-primates" class="nav-link" data-scroll-target="#imputing-primates"><span class="header-section-number">15.2.2</span> Imputing primates</a>
  <ul>
  <li><a href="#rethinking-multiple-imputations" id="toc-rethinking-multiple-imputations" class="nav-link" data-scroll-target="#rethinking-multiple-imputations"><span class="header-section-number">15.2.2.1</span> Rethinking: Multiple imputations</a></li>
  </ul></li>
  <li><a href="#where-is-your-god-now" id="toc-where-is-your-god-now" class="nav-link" data-scroll-target="#where-is-your-god-now"><span class="header-section-number">15.2.3</span> Where is your god now?</a>
  <ul>
  <li><a href="#rethinking-present-details-about-missing-data" id="toc-rethinking-present-details-about-missing-data" class="nav-link" data-scroll-target="#rethinking-present-details-about-missing-data"><span class="header-section-number">15.2.3.1</span> Rethinking: Present details about missing data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-Categorical-errors-and-discrete-absences" id="toc-sec-Categorical-errors-and-discrete-absences" class="nav-link" data-scroll-target="#sec-Categorical-errors-and-discrete-absences"><span class="header-section-number">15.3</span> Categorical errors and discrete absences</a>
  <ul>
  <li><a href="#discrete-cats" id="toc-discrete-cats" class="nav-link" data-scroll-target="#discrete-cats"><span class="header-section-number">15.3.1</span> Discrete cats</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">15.4</span> Summary</a></li>
  <li><a href="#bonus-bayesian-meta-analysis-with-odds-ratios" id="toc-bonus-bayesian-meta-analysis-with-odds-ratios" class="nav-link" data-scroll-target="#bonus-bayesian-meta-analysis-with-odds-ratios"><span class="header-section-number">15.5</span> Bonus: Bayesian meta-analysis with odds ratios</a>
  <ul>
  <li><a href="#how-do-meta-analyses-fit-into-the-picture" id="toc-how-do-meta-analyses-fit-into-the-picture" class="nav-link" data-scroll-target="#how-do-meta-analyses-fit-into-the-picture"><span class="header-section-number">15.5.1</span> How do meta-analyses fit into the picture?</a></li>
  <li><a href="#we-need-some-data" id="toc-we-need-some-data" class="nav-link" data-scroll-target="#we-need-some-data"><span class="header-section-number">15.5.2</span> We need some data</a></li>
  <li><a href="#our-effect-size-will-be-an-odds-ratio" id="toc-our-effect-size-will-be-an-odds-ratio" class="nav-link" data-scroll-target="#our-effect-size-will-be-an-odds-ratio"><span class="header-section-number">15.5.3</span> Our effect size will be an odds ratio</a></li>
  <li><a href="#log-odds-odds-ratios-and-modeling-effect-sizes" id="toc-log-odds-odds-ratios-and-modeling-effect-sizes" class="nav-link" data-scroll-target="#log-odds-odds-ratios-and-modeling-effect-sizes"><span class="header-section-number">15.5.4</span> Log-odds, odds ratios, and modeling effect sizes</a></li>
  <li><a href="#compute-the-study-specific-effect-sizes" id="toc-compute-the-study-specific-effect-sizes" class="nav-link" data-scroll-target="#compute-the-study-specific-effect-sizes"><span class="header-section-number">15.5.5</span> Compute the study-specific effect sizes</a></li>
  <li><a href="#fit-the-bayesian-meta-analysis" id="toc-fit-the-bayesian-meta-analysis" class="nav-link" data-scroll-target="#fit-the-bayesian-meta-analysis"><span class="header-section-number">15.5.6</span> Fit the Bayesian meta-analysis</a></li>
  <li><a href="#sec-Fit-the-Bayesian-muiltilevel-alternative" id="toc-sec-Fit-the-Bayesian-muiltilevel-alternative" class="nav-link" data-scroll-target="#sec-Fit-the-Bayesian-muiltilevel-alternative"><span class="header-section-number">15.5.7</span> Fit the Bayesian muiltilevel alternative</a></li>
  <li><a href="#relative-to-the-muiltilevel-model-meta-analyses-have-limitations" id="toc-relative-to-the-muiltilevel-model-meta-analyses-have-limitations" class="nav-link" data-scroll-target="#relative-to-the-muiltilevel-model-meta-analyses-have-limitations"><span class="header-section-number">15.5.8</span> Relative to the muiltilevel model, meta-analyses have limitations</a></li>
  <li><a href="#parting-thoughts" id="toc-parting-thoughts" class="nav-link" data-scroll-target="#parting-thoughts"><span class="header-section-number">15.5.9</span> Parting thoughts</a></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#comments" id="toc-comments" class="nav-link" data-scroll-target="#comments">Comments</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-Missing-Data-and-Other-Opportunities" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Missing Data and Other Opportunities</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>For the opening example, we’re playing with the conditional probability</p>
<p><span class="math display">\[
\Pr(\text{burnt down} \mid \text{burnt up}) = \frac{\Pr(\text{burnt up, burnt down})}{\Pr(\text{burnt up})}.
\]</span></p>
<p>Given McElreath’s setup, it works out that</p>
<p><span class="math display">\[
\Pr(\text{burnt down} \mid \text{burnt up}) = \frac{1/3}{1/2} = \frac{2}{3}.
\]</span></p>
<p>We might express the math toward the bottom of page 489 in tibble form like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>p_pancake <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pancake =</span> <span class="fu">c</span>(<span class="st">"BB"</span>, <span class="st">"BU"</span>, <span class="st">"UU"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_burnt =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_burnt_up =</span> p_burnt <span class="sc">*</span> p_pancake)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  pancake p_burnt p_burnt_up
  &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 BB          1        0.333
2 BU          0.5      0.167
3 UU          0        0    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">p (burnt_down | burnt_up)</span><span class="st">`</span> <span class="ot">=</span> p_pancake <span class="sc">/</span> <span class="fu">sum</span>(p_burnt_up))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `p (burnt_down | burnt_up)`
                        &lt;dbl&gt;
1                       0.667</code></pre>
</div>
</div>
<p>I understood McElreath’s simulation (<strong>R</strong> code 15.1) better after breaking it apart. The first part of <code>sim_pancake()</code> takes one random draw from the integers 1, 2, and 3. It just so happens that if we set <code>set.seed(1)</code>, the code returns a 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>So here’s what it looks like if we use seeds <code>2:11</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>take_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(seed) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">seed =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">11</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_returned =</span> <span class="fu">map_dbl</span>(seed, take_sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
    seed value_returned
   &lt;int&gt;          &lt;dbl&gt;
 1     2              1
 2     3              1
 3     4              3
 4     5              2
 5     6              1
 6     7              2
 7     8              3
 8     9              3
 9    10              3
10    11              2</code></pre>
</div>
</div>
<p>Each of those <code>value_returned</code> values stands for one of the three pancakes: 1 = BB, 2 = BU, and 3 = UU. In the next line, McElreath made slick use of a matrix to specify that. Here’s what the matrix looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    0
[2,]    1    0    0</code></pre>
</div>
</div>
<p>See how the three columns are identified as <code>[,1]</code>, <code>[,2]</code>, and <code>[,3]</code>? If, say, we wanted to subset the values in the second column, we’d execute</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)[, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0</code></pre>
</div>
</div>
<p>which returns a numeric vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)[, <span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:2] 1 0</code></pre>
</div>
</div>
<p>That <code>1 0</code> corresponds to the pancake with one burnt (i.e., 1) and one unburnt (i.e., 0) side. So when McElreath then executed <code>sample(sides)</code>, he randomly sampled from one of those two values. In the case of <code>pancake == 2</code>, he randomly sampled one the pancake with one burnt and one unburnt side. Had he sampled from <code>pancake == 1</code>, he would have sampled from the pancake with both sides burnt.</p>
<p>Going forward, let’s amend McElreath’s <code>sim_pancake()</code> function so it will take a <code>seed</code> argument, which will allow us to make the output reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate a `pancake` and return randomly ordered `sides`</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sim_pancake <span class="ot">&lt;-</span> <span class="cf">function</span>(seed) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  pancake <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  sides   <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)[, pancake]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(sides)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take this baby for a whirl.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many simulations would you like?</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">seed =</span> <span class="dv">1</span><span class="sc">:</span>n_sim) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">burnt =</span> <span class="fu">map</span>(<span class="at">.x =</span> seed, <span class="at">.f =</span> sim_pancake)) <span class="sc">|&gt;</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(burnt) <span class="sc">|&gt;</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">side =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"up"</span>, <span class="st">"down"</span>), <span class="at">times =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a look at what we’ve done.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
    seed burnt side 
   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
 1     1     1 up   
 2     1     1 down 
 3     2     1 up   
 4     2     1 down 
 5     3     1 up   
 6     3     1 down 
 7     4     0 up   
 8     4     0 down 
 9     5     1 up   
10     5     0 down </code></pre>
</div>
</div>
<p>Now we use <code>pivot_wider()</code> and <code>summarise()</code> to get the value we’ve been working for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> side, <span class="at">values_from =</span> burnt) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">p (burnt_down | burnt_up)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(up <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> down <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="fu">sum</span>(up)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `p (burnt_down | burnt_up)`
                        &lt;dbl&gt;
1                       0.658</code></pre>
</div>
</div>
<p>The results are within rounding error of the ideal 2/3.</p>
<blockquote class="blockquote">
<p>Probability theory is not difficult mathematically. It is just counting. But it is hard to interpret and apply. Doing so often seems to require some cleverness, and authors have an incentive to solve problems in clever ways, just to show off. But we don’t need that cleverness, if we ruthlessly apply conditional probability….</p>
<p>In this chapter, [we’ll] meet two commonplace applications of this assume-and-deduce strategy. The first is the incorporation of <strong>measurement error</strong> into our models. The second is the estimation of <strong>missing data</strong> through <strong>Bayesian imputation</strong>….</p>
<p>In neither application do [we] have to intuit the consequences of measurement errors nor the implications of missing values in order to design the models. All [we] have to do is state your information about the error or about the variables with missing values. Logic does the rest. <span class="citation" data-cites="mcelreathStatisticalRethinkingBayesian2020">(<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020, p. 490</a>, <strong>emphasis</strong> in the original)</span></p>
</blockquote>
<section id="measurement-error" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="measurement-error"><span class="header-section-number">15.1</span> Measurement error</h2>
<p>Let’s grab those <code>WaffleDivorce</code> data from back in <a href="05.html#sec-Spurious-associations" class="quarto-xref"><span>Section 5.1</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> WaffleDivorce</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(WaffleDivorce)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In anticipation of <strong>R</strong> code 15.3 and 15.5, wrangle the data a little.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D_obs =</span> (Divorce <span class="sc">-</span> <span class="fu">mean</span>(Divorce)) <span class="sc">/</span> <span class="fu">sd</span>(Divorce),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">D_sd  =</span> Divorce.SE <span class="sc">/</span> <span class="fu">sd</span>(Divorce),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">M     =</span> (Marriage <span class="sc">-</span> <span class="fu">mean</span>(Marriage)) <span class="sc">/</span> <span class="fu">sd</span>(Marriage),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">A     =</span> (MedianAgeMarriage <span class="sc">-</span> <span class="fu">mean</span>(MedianAgeMarriage)) <span class="sc">/</span> <span class="fu">sd</span>(MedianAgeMarriage),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">M_obs =</span> M,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">M_sd  =</span> Marriage.SE <span class="sc">/</span> <span class="fu">sd</span>(Marriage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In previous editions of this book, we relied on the dark theme functions from the <a href="https://CRAN.R-project.org/package=ggdark"><strong>ggdark</strong> package</a> <span class="citation" data-cites="R-ggdark">(<a href="references.html#ref-R-ggdark" role="doc-biblioref">Grantham, 2019</a>)</span> for the plot themes. Though <strong>ggdark</strong> was formerly available on CRAN, it was removed on 2025-11-07 due to some unresolved issues (see <a href="https://cran.r-project.org/web/packages/ggdark/index.html">here</a>). There’s currently a promising looking <a href="https://github.com/nsgrantham/ggdark/pull/13">pull request</a> on GitHub that may fix the issue, but until the issue is resolved we’ll make substitutes by hand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">ink =</span> <span class="st">"white"</span>, <span class="at">paper =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>dark_theme_void <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">ink =</span> <span class="st">"white"</span>, <span class="at">paper =</span> <span class="st">"black"</span>, ...)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># To reset the ggplot2 theme to its default parameters, execute:</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot2::theme_set(theme_gray())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the rest of our color palette, we’ll use colors from the <a href="https://github.com/sjmgarnier/viridis"><strong>viridis</strong> package</a> <span class="citation" data-cites="R-viridis">(<a href="references.html#ref-R-viridis" role="doc-biblioref">Garnier, 2021</a>)</span>, which provides a variety of colorblind-safe color palettes <span class="citation" data-cites="rudisViridisColorPalettes2018">(see <a href="references.html#ref-rudisViridisColorPalettes2018" role="doc-biblioref">Rudis et al., 2018</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>viridis_pal()</code> function gives a list of colors within a given palette. The colors in each palette fall on a spectrum. Within <code>viridis_pal()</code>, the <code>option</code> argument allows one to select a given spectrum, “C”, in our case. The final parentheses, <code>()</code>, allows one to determine how many discrete colors one would like to break the spectrum up by. We’ll choose 7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#0D0887FF" "#5D01A6FF" "#9C179EFF" "#CC4678FF" "#ED7953FF" "#FDB32FFF" "#F0F921FF"</code></pre>
</div>
</div>
<p>With a little data wrangling, we can put the colors of our palette in a tibble and display them in a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">factor       =</span> <span class="st">"a"</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">number       =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">color_number =</span> <span class="fu">str_c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="st">". "</span>, <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> factor, <span class="at">y =</span> number)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> number)) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> color_number, <span class="at">color =</span> number <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>))) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">discrete =</span> T, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Behold: viridis C!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s make use of our custom theme and reproduce/reimagine Figure 15.1.a.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">7</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MedianAgeMarriage, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Divorce,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Divorce <span class="sc">-</span> Divorce.SE, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> Divorce <span class="sc">+</span> Divorce.SE)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Median age marriage"</span> , </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Divorce rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how <code>viridis_pal(option = "C")(7)[7]</code> called the seventh color in the color scheme, <code>"#F0F921FF"</code>. For Figure 15.1.b, we’ll select the sixth color in the palette by coding <code>viridis_pal(option = "C")(7)[6]</code>. We’ll then combine the two subplots with <strong>patchwork</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">6</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(Population), </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Divorce,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Divorce <span class="sc">-</span> Divorce.SE, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> Divorce <span class="sc">+</span> Divorce.SE)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">shape =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log population"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="696"></p>
</figure>
</div>
</div>
</div>
<p>Just like in the text, our plot shows states with larger populations tend to have smaller measurement error. The relation between measurement error and <code>MedianAgeMarriage</code> is less apparent.</p>
<section id="rethinking-generative-thinking-bayesian-inference" class="level4" data-number="15.1.0.1">
<h4 data-number="15.1.0.1" class="anchored" data-anchor-id="rethinking-generative-thinking-bayesian-inference"><span class="header-section-number">15.1.0.1</span> Rethinking: Generative thinking, Bayesian inference</h4>
<blockquote class="blockquote">
<p>Bayesian models are <em>generative</em>, meaning they can be used to simulate observations just as well as they can be used to estimate parameters. One benefit of this fact is that a statistical model can be developed by thinking hard about how the data might have arisen. This includes sampling and measurement, as well as the nature of the process we are studying. Then let Bayesian updating discover the implications. (p.&nbsp;491, <em>emphasis</em> in the original)</p>
</blockquote>
</section>
<section id="error-on-the-outcome" class="level3" data-number="15.1.1">
<h3 data-number="15.1.1" class="anchored" data-anchor-id="error-on-the-outcome"><span class="header-section-number">15.1.1</span> Error on the outcome</h3>
<p>Now make a DAG of our data with <strong>ggdag</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"D"</span>, <span class="st">"Dobs"</span>, <span class="st">"eD"</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M    <span class="sc">~</span> A,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>       D    <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>       Dobs <span class="sc">~</span> D <span class="sc">+</span> eD,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"eD"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>, <span class="fu">expression</span>(<span class="fu">italic</span>(e)[D]), <span class="fu">expression</span>(D[obs]))) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>Note our use of the <code>dark_theme_void()</code> function. But more to the substance of the matter,</p>
<blockquote class="blockquote">
<p>there’s a lot going on here. But we can proceed one step at a time. The left triangle of this DAG is the same system that we worked with back in <a href="05.html#sec-Think-before-you-regress" class="quarto-xref"><span>Section 5.1.1</span></a>. Age at marriage (<span class="math inline">\(A\)</span>) influences divorce (<span class="math inline">\(D\)</span>) both directly and indirectly, passing through marriage rate (<span class="math inline">\(M\)</span>). Then we have the observation model. The true divorce rate <span class="math inline">\(D\)</span> cannot be observed, so it is circled as an unobserved node. However we do get to observe <span class="math inline">\(D_\text{obs}\)</span>, which is a function of both the true rate <span class="math inline">\(D\)</span> and some unobserved error <span class="math inline">\(e_\text{D}\)</span>. (p.&nbsp;492)</p>
</blockquote>
<p>To get a better sense of what we’re about to do, imagine for a moment that each state’s divorce rate is normally distributed with a mean of <code>Divorce</code> and standard deviation <code>Divorce.SE</code>. Those distributions would be like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Divorce_distribution =</span> <span class="fu">str_c</span>(<span class="st">"Divorce ~ Normal("</span>, Divorce, <span class="st">", "</span>, Divorce.SE, <span class="st">")"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Loc, Divorce_distribution) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Loc         Divorce_distribution
1  AL Divorce ~ Normal(12.7, 0.79)
2  AK Divorce ~ Normal(12.5, 2.05)
3  AZ Divorce ~ Normal(10.8, 0.74)
4  AR Divorce ~ Normal(13.5, 1.22)
5  CA    Divorce ~ Normal(8, 0.24)
6  CO Divorce ~ Normal(11.6, 0.94)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Here’s how to define the error distribution for each divorce rate. For each observed value <span class="math inline">\(D_{\text{OBS},i}\)</span>, there will be one parameter, <span class="math inline">\(D_{\text{TRUE},i}\)</span>, defined by:</p>
<p><span class="math display">\[D_{\text{OBS},i} \sim \operatorname{Normal}(D_{\text{TRUE},i}, D_{\text{SE},i})\]</span></p>
<p>All this does is define the measurement <span class="math inline">\(D_{\text{OBS},i}\)</span> as having the specified Gaussian distribution centered on the unknown parameter <span class="math inline">\(D_{\text{TRUE},i}\)</span>. So the above defines a probability for each State <span class="math inline">\(i\)</span>’s observed divorce rate, given a known measurement error. (p.&nbsp;493)</p>
</blockquote>
<p>Our model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\color{#5D01A6FF}{\text{Divorce}_{\text{OBS}, i}} &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Normal}(\text{Divorce}_{\text{TRUE}, i}, \text{Divorce}_{\text{SE}, i})} \\
\color{#5D01A6FF}{\text{Divorce}_{\text{TRUE}, i}} &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu     &amp; = \alpha + \beta_1 \text A_i + \beta_2 \text M_i \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Fire up <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <strong>brms</strong>, we accommodate measurement error in the criterion using the <code>mi()</code> syntax, following the general form <code>&lt;response&gt; | mi(&lt;se_response&gt;)</code>. This follows a missing data logic, resulting in Bayesian missing data imputation for the criterion values. The <code>mi()</code> syntax is based on the missing data capabilities for <strong>brms</strong>, which we will cover in greater detail in the second half of this chapter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the data into a `list()`</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_obs =</span> d<span class="sc">$</span>D_obs,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_sd  =</span> d<span class="sc">$</span>D_sd,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">M     =</span> d<span class="sc">$</span>M,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">A     =</span> d<span class="sc">$</span>A)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dlist, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  D_obs <span class="sc">|</span> <span class="fu">mi</span>(D_sd) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note this line</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">latent =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the model summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: D_obs | mi(D_sd) ~ 1 + A + M 
   Data: dlist (Number of observations: 50) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -0.05      0.10    -0.24     0.14 1.00     4597     3090
A            -0.62      0.16    -0.92    -0.30 1.00     3829     3423
M             0.05      0.17    -0.27     0.38 1.00     3671     3297

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.58      0.11     0.39     0.81 1.00     1682     1720

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>To return the summaries for the <code>D_true[i]</code> parameters, you might execute <code>posterior_summary(b15.1)</code> or <code>b15.1$fit</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b15<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Est.Error   Q2.5  Q97.5
b_Intercept    -0.05      0.10  -0.24   0.14
b_A            -0.62      0.16  -0.92  -0.30
b_M             0.05      0.17  -0.27   0.38
sigma           0.58      0.11   0.39   0.81
Intercept      -0.05      0.10  -0.24   0.14
Yl[1]           1.16      0.36   0.46   1.88
Yl[2]           0.69      0.56  -0.41   1.79
Yl[3]           0.43      0.34  -0.23   1.08
Yl[4]           1.42      0.46   0.52   2.34
Yl[5]          -0.90      0.13  -1.15  -0.65
Yl[6]           0.66      0.40  -0.10   1.45
Yl[7]          -1.37      0.36  -2.05  -0.67
Yl[8]          -0.34      0.47  -1.26   0.58
Yl[9]          -1.90      0.59  -3.05  -0.72
Yl[10]         -0.62      0.17  -0.96  -0.28
Yl[11]          0.76      0.28   0.21   1.31
Yl[12]         -0.55      0.49  -1.53   0.41
Yl[13]          0.18      0.51  -0.85   1.15
Yl[14]         -0.87      0.23  -1.32  -0.43
Yl[15]          0.56      0.31  -0.03   1.16
Yl[16]          0.28      0.40  -0.54   1.08
Yl[17]          0.50      0.43  -0.34   1.32
Yl[18]          1.25      0.35   0.59   1.94
Yl[19]          0.43      0.39  -0.30   1.21
Yl[20]          0.40      0.54  -0.60   1.49
Yl[21]         -0.56      0.32  -1.18   0.06
Yl[22]         -1.10      0.26  -1.61  -0.59
Yl[23]         -0.27      0.26  -0.78   0.25
Yl[24]         -1.00      0.31  -1.62  -0.41
Yl[25]          0.43      0.40  -0.33   1.23
Yl[26]         -0.03      0.31  -0.67   0.59
Yl[27]         -0.01      0.50  -0.99   1.00
Yl[28]         -0.15      0.39  -0.92   0.61
Yl[29]         -0.26      0.50  -1.20   0.75
Yl[30]         -1.80      0.24  -2.26  -1.33
Yl[31]          0.17      0.41  -0.64   1.00
Yl[32]         -1.66      0.16  -1.98  -1.34
Yl[33]          0.12      0.24  -0.36   0.61
Yl[34]         -0.05      0.51  -1.11   0.92
Yl[35]         -0.12      0.23  -0.57   0.32
Yl[36]          1.28      0.41   0.49   2.11
Yl[37]          0.22      0.35  -0.46   0.91
Yl[38]         -1.03      0.22  -1.45  -0.59
Yl[39]         -0.93      0.54  -1.96   0.16
Yl[40]         -0.68      0.32  -1.31  -0.05
Yl[41]          0.24      0.55  -0.82   1.33
Yl[42]          0.75      0.33   0.10   1.39
Yl[43]          0.20      0.18  -0.17   0.56
Yl[44]          0.80      0.42  -0.05   1.60
Yl[45]         -0.41      0.53  -1.42   0.68
Yl[46]         -0.39      0.26  -0.90   0.09
Yl[47]          0.13      0.30  -0.46   0.73
Yl[48]          0.56      0.45  -0.32   1.44
Yl[49]         -0.64      0.28  -1.19  -0.08
Yl[50]          0.85      0.58  -0.33   1.98
lprior         -1.37      0.45  -2.45  -0.71
lp__          -78.16      6.57 -91.47 -65.54</code></pre>
</div>
</div>
<p>Our rows <code>Yl[1]</code> through <code>Yl[50]</code> correspond to what <strong>rethinking</strong> named <code>D_true[1]</code> through <code>D_true[50]</code>. Here’s the code for our Figure 15.2.a.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AL"</span>, <span class="st">"AR"</span>, <span class="st">"ME"</span>, <span class="st">"NH"</span>, <span class="st">"RI"</span>, <span class="st">"DC"</span>, <span class="st">"VT"</span>, <span class="st">"AK"</span>, <span class="st">"SD"</span>, <span class="st">"UT"</span>, <span class="st">"ID"</span>, <span class="st">"ND"</span>, <span class="st">"WY"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>d_est <span class="ot">&lt;-</span> <span class="fu">posterior_summary</span>(b15<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D_est =</span> Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, D_est) <span class="sc">|&gt;</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"Yl"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">5</span>]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d_est <span class="sc">|&gt;</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> D_sd, <span class="at">y =</span> D_est <span class="sc">-</span> D_obs)) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> d_est <span class="sc">|&gt;</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> states),  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">15</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use a little <code>as_draws_df()</code> + <code>expand_grid()</code> magic to help with our version of Figure 15.2.b.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AR"</span>, <span class="st">"ME"</span>, <span class="st">"RI"</span>, <span class="st">"ID"</span>, <span class="st">"WY"</span>, <span class="st">"ND"</span>, <span class="st">"MN"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">4</span>]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b15<span class="fl">.1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">A =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">3.5</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">length.out =</span> <span class="dv">50</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> b_Intercept <span class="sc">+</span> b_A <span class="sc">*</span> A) <span class="sc">|&gt;</span> </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> A)) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> fitted),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">.width =</span> <span class="fl">0.95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> d_est,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">xend =</span> A, <span class="at">y =</span> D_obs, <span class="at">yend =</span> D_est),</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d_est,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> D_obs),</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d_est,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> D_est),</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> states),  </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> D_obs, <span class="at">label =</span> Loc), </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"median age marriage (std)"</span>,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"divorce rate (std)"</span>) <span class="sc">+</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>A), </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>D_obs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now combine the two ggplots and plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="720"></p>
</figure>
</div>
</div>
</div>
<p>If you look closely, our plot on the left is flipped relative to the one in the text. I’m pretty sure my code is correct, which leaves me to believe McElreath accidentally flipped the ordering in his code and made his <span class="math inline">\(y\)</span>-axis ‘D_obs - D_est.’ Happily, our plot on the right matches up nicely with the one in the text.</p>
</section>
<section id="error-on-both-outcome-and-predictor" class="level3" data-number="15.1.2">
<h3 data-number="15.1.2" class="anchored" data-anchor-id="error-on-both-outcome-and-predictor"><span class="header-section-number">15.1.2</span> Error on both outcome and predictor</h3>
<p>Now we update the DAG to account for measurement error in the predictor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"Mobs"</span>, <span class="st">"eM"</span>, <span class="st">"D"</span>, <span class="st">"Dobs"</span>, <span class="st">"eD"</span>),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M    <span class="sc">~</span> A,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>       D    <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>       Mobs <span class="sc">~</span> M <span class="sc">+</span> eM,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>       Dobs <span class="sc">~</span> D <span class="sc">+</span> eD,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"Mobs"</span>, <span class="st">"Dobs"</span>), <span class="st">"b"</span>, <span class="st">"a"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>, </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(<span class="fu">italic</span>(e)[D]), <span class="fu">expression</span>(<span class="fu">italic</span>(e)[M]), </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(D[obs]), <span class="fu">expression</span>(M[obs]))) <span class="sc">+</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>We will express this DAG in an augmented statistical model following the form</p>
<p><span class="math display">\[\begin{align*}
\text{Divorce}_{\text{OBS}, i}  &amp; \sim \operatorname{Normal}(\text{Divorce}_{\text{TRUE}, i}, \text{Divorce}_{\text{SE}, i}) \\
\text{Divorce}_{\text{TRUE}, i} &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta_1 \text A_i + \beta_2 \color{#5D01A6FF}{\text{Marriage}_{\text{TRUE}, i}} \\
\color{#5D01A6FF}{\text{Marriage}_{\text{OBS}, i}} &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Normal}(\text{Marriage}_{\text{TRUE}, i}, \text{Marriage}_{\text{SE}, i})} \\
\color{#5D01A6FF}{\text{Marriage}_{\text{TRUE}, i}} &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Normal}(0, 1)} \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>The current version <strong>brms</strong> allows users to specify error on predictors with an <code>me()</code> statement in the form of <code>me(predictor, sd_predictor)</code> where <code>sd_predictor</code> is a vector in the data denoting the size of the measurement error, presumed to be in a standard-deviation metric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the data into a `list()`</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_obs =</span> d<span class="sc">$</span>D_obs,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_sd  =</span> d<span class="sc">$</span>D_sd,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">M_obs =</span> d<span class="sc">$</span>M_obs,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">M_sd  =</span> d<span class="sc">$</span>M_sd,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">A     =</span> d<span class="sc">$</span>A)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dlist, </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  D_obs <span class="sc">|</span> <span class="fu">mi</span>(D_sd) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> <span class="fu">me</span>(M_obs, M_sd),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> meanme),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note this line</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">latent =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.02"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use <code>posterior_summary()</code>, again, to get a sense of those <code>depth=2</code> summaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b15<span class="fl">.2</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Due to space concerns, I’m not going to show the results, here. You can do that on your own. Basically, now in addition to the posterior summaries for the <code>Yl[i]</code> parameters (what McElreath called <span class="math inline">\(D_{\text{TRUE}, i}\)</span>), we now get posterior summaries for <code>Xme_meM_obs[i]</code> (what McElreath called <span class="math inline">\(M_{\text{TRUE}, i}\)</span>). Note that you’ll need to specify <code>save_pars = save_pars(latent = TRUE)</code> in the <code>brm()</code> function in order to save the posterior samples of error-adjusted variables obtained by using the <code>me()</code> argument. Without doing so, functions like <code>predict()</code> may give you trouble. Here’s our version of Figure 15.3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>color_y <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">7</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>color_p <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># D</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Loc   =</span> d <span class="sc">|&gt;</span> <span class="fu">pull</span>(Loc),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">D_obs =</span> d <span class="sc">|&gt;</span> <span class="fu">pull</span>(D_obs),</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">D_est =</span> <span class="fu">posterior_summary</span>(b15<span class="fl">.2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"Yl"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">pull</span>(Estimate)) <span class="sc">|&gt;</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>Loc, <span class="at">values_to =</span> <span class="st">"d"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">"D_obs"</span>, <span class="st">"observed"</span>, <span class="st">"posterior"</span>)),</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># M</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Loc   =</span> d <span class="sc">|&gt;</span> <span class="fu">pull</span>(Loc),</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">M_obs =</span> d <span class="sc">|&gt;</span> <span class="fu">pull</span>(M_obs),</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">M_est =</span> <span class="fu">posterior_summary</span>(b15<span class="fl">.2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"Xme_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>           <span class="fu">pull</span>(Estimate)) <span class="sc">|&gt;</span> </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>Loc, <span class="at">values_to =</span> <span class="st">"m"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">"M_obs"</span>, <span class="st">"observed"</span>, <span class="st">"posterior"</span>)),</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Loc"</span>, <span class="st">"name"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> m, <span class="at">y =</span> d)) <span class="sc">+</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> Loc),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(color_p, color_y)) <span class="sc">+</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Marriage rate (std)"</span>, </span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Divorce rate (std)"</span>,</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Shrinkage of both divorce rate and marriage rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="364"></p>
</figure>
</div>
</div>
</div>
<p>The yellow points are model-implied; the purple ones are of the original data. It turns out our <strong>brms</strong> model regularized just a little more aggressively than McElreath’s <strong>rethinking</strong> model.</p>
<p>Anyway,</p>
<blockquote class="blockquote">
<p>The big take home point for this section is that when you have a distribution of values, don’t reduce it down to a single value to use in a regression. Instead, use the entire distribution. Anytime we use an average value, discarding the uncertainty around that average, we risk overconfidence and spurious inference. This doesn’t only apply to measurement error, but also to cases in which data are averaged before analysis. (p.&nbsp;497)</p>
</blockquote>
</section>
<section id="measurement-terrors" class="level3" data-number="15.1.3">
<h3 data-number="15.1.3" class="anchored" data-anchor-id="measurement-terrors"><span class="header-section-number">15.1.3</span> Measurement terrors</h3>
<p>McElreath invited us to consider a few more DAGs. The first is an instance where both sources of measurement error have a common cause, <span class="math inline">\(P\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"Mobs"</span>, <span class="st">"eM"</span>, <span class="st">"D"</span>, <span class="st">"Dobs"</span>, <span class="st">"eD"</span>, <span class="st">"P"</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M    <span class="sc">~</span> A,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>       D    <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>       Mobs <span class="sc">~</span> M <span class="sc">+</span> eM,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>       Dobs <span class="sc">~</span> D <span class="sc">+</span> eD,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>       eM   <span class="sc">~</span> P,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>       eD   <span class="sc">~</span> P,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"Mobs"</span>, <span class="st">"Dobs"</span>, <span class="st">"P"</span>), <span class="st">"b"</span>, <span class="st">"a"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>, <span class="st">"P"</span>, </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(<span class="fu">italic</span>(e)[D]), <span class="fu">expression</span>(<span class="fu">italic</span>(e)[M]), </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(D[obs]), <span class="fu">expression</span>(M[obs]))) <span class="sc">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="360"></p>
</figure>
</div>
</div>
</div>
<p>The second instance is when the true marriage rate <span class="math inline">\(M\)</span> has a causal effect on the measurement error for Divorce, <span class="math inline">\(e_\text{D}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"Mobs"</span>, <span class="st">"eM"</span>, <span class="st">"D"</span>, <span class="st">"Dobs"</span>, <span class="st">"eD"</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M    <span class="sc">~</span> A,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>       D    <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>       Mobs <span class="sc">~</span> M <span class="sc">+</span> eM,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>       Dobs <span class="sc">~</span> D <span class="sc">+</span> eD,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>       eD   <span class="sc">~</span> M,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"Mobs"</span>, <span class="st">"Dobs"</span>), <span class="st">"b"</span>, <span class="st">"a"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"M"</span>, </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(<span class="fu">italic</span>(e)[D]), <span class="fu">expression</span>(<span class="fu">italic</span>(e)[M]), </span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">expression</span>(D[obs]), <span class="fu">expression</span>(M[obs]))) <span class="sc">+</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>The final example is when we have negligible measurement error for <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span>, but known nonignorable measurement error for the causal variable <span class="math inline">\(A\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"eA"</span>, <span class="st">"Aobs"</span>, <span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"D"</span>),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(Aobs <span class="sc">~</span> A <span class="sc">+</span> eA,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>       M    <span class="sc">~</span> A,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>       D    <span class="sc">~</span> A,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"eA"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="fu">expression</span>(<span class="fu">italic</span>(e)[A]), <span class="fu">expression</span>(A[obs]), <span class="st">"D"</span>, <span class="st">"M"</span>)) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>On page 498, we read:</p>
<blockquote class="blockquote">
<p>In this circumstance, it can happen that a naive regression of <span class="math inline">\(D\)</span> on <span class="math inline">\(A_\text{obs}\)</span> and <span class="math inline">\(M\)</span> will strongly suggest that <span class="math inline">\(M\)</span> influences <span class="math inline">\(D\)</span>. The reason is that <span class="math inline">\(M\)</span> contains information about the true <span class="math inline">\(A\)</span>. And <span class="math inline">\(M\)</span> is measured more precisely than <span class="math inline">\(A\)</span> is. It’s like a proxy <span class="math inline">\(A\)</span>. Here’s a small simulation you can toy with that will produce such a frustration:</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">A =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M     =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="sc">-</span>A, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">D     =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span>  A, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">A_obs =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span>  A, <span class="at">sd =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get a sense of the havoc ignoring measurement error can cause, we’ll fit to models. These aren’t in the text, but, you know, let’s live a little. The first model will include <code>A</code>, the true predictor for <code>D</code>. The second model will include <code>A_obs</code> instead, the version of <code>A</code> with measurement error added in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The model with `A` containing no measurement error</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.2</span>b <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A <span class="sc">+</span> M,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note this line</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">latent =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.02b"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># The model where `A` has measurement error, but we ignore it</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.2</span>c <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat, </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> A_obs <span class="sc">+</span> M,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note this line</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">latent =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.02c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the summaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.2</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: D ~ 1 + A + M 
   Data: dat (Number of observations: 500) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.01      0.04    -0.08     0.09 1.00     3258     2465
A             0.89      0.06     0.77     1.01 1.00     2968     2746
M            -0.04      0.04    -0.13     0.04 1.00     3099     2638

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.01      0.03     0.94     1.07 1.00     3873     2770

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.2</span>c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: D ~ 1 + A_obs + M 
   Data: dat (Number of observations: 500) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.05      0.05    -0.05     0.15 1.00     3912     3018
A_obs         0.29      0.04     0.21     0.37 1.00     3593     2946
M            -0.35      0.04    -0.43    -0.28 1.00     3458     2860

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     1.14      0.04     1.07     1.22 1.00     3780     2812

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Model <code>b15.2b</code>, where <code>A</code> contains no measurement error, comes close to reproducing the data-generating parameters. The second model, <code>b15.2c</code>, which used <code>A</code> infused with measurement error (i.e., <code>A_obs</code>), is a disaster. A coefficient plot might help the comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For annotation</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit      =</span> <span class="st">"b15.2b"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">term     =</span> <span class="st">"beta[0]"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimate =</span> <span class="fu">fixef</span>(b15<span class="fl">.2</span>b, <span class="at">probs =</span> <span class="fl">0.99</span>)[<span class="st">"Intercept"</span>, <span class="dv">3</span>],</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">label    =</span> <span class="st">"In this plot, we like the yellow posteriors."</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">posterior_summary</span>(b15<span class="fl">.2</span>b) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">posterior_summary</span>(b15<span class="fl">.2</span>c) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"Intercept"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"lp__"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"lprior"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">"beta["</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">"]"</span>), <span class="st">"sigma"</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">fit  =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"b15.2b"</span>, <span class="st">"b15.2c"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> color_y) <span class="sc">+</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(color_y, <span class="st">"white"</span>)) <span class="sc">+</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"marginal posterior"</span>,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> term, <span class="at">labeller =</span> label_parsed, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"transparent"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="missing-data" class="level2 page-columns page-full" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">15.2</span> Missing data</h2>
<blockquote class="blockquote">
<p>With measurement error, the insight is to realize that any uncertain piece of data can be replaced by a distribution that reflects uncertainty. But sometimes data are simply missing–no measurement is available at all. At first, this seems like a lost cause. What can be done when there is no measurement at all, not even one with error?…</p>
</blockquote>
<blockquote class="blockquote">
<p>So what can we do instead? We can think causally about missingness, and we can use the model to <strong>impute</strong> missing values. A generative model tells you whether the process that produced the missing values will also prevent the identification of causal effects. (p.&nbsp;499, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Starting with <a href="https://cran.r-project.org/package=brms/news/news.html">version 2.2.0</a>, <strong>brms</strong> supports Bayesian missing data imputation using adaptations of the <a href="https://cran.r-project.org/package=brms/vignettes/brms_multivariate.html">multivariate syntax</a> <span class="citation" data-cites="Bürkner2022Multivariate">(<a href="references.html#ref-Bürkner2022Multivariate" role="doc-biblioref">Bürkner, 2022a</a>)</span>. Bürkner’s <span class="citation" data-cites="Bürkner2022HandleMissingValues">(<a href="references.html#ref-Bürkner2022HandleMissingValues" role="doc-biblioref">2022b</a>)</span> vignette, <a href="https://cran.r-project.org/package=brms/vignettes/brms_missings.html"><em>Handle missing values with brms</em></a>, can provide a nice overview.</p>
<section id="rethinking-missing-data-are-meaningful-data" class="level4" data-number="15.2.0.1">
<h4 data-number="15.2.0.1" class="anchored" data-anchor-id="rethinking-missing-data-are-meaningful-data"><span class="header-section-number">15.2.0.1</span> Rethinking: Missing data are meaningful data</h4>
<blockquote class="blockquote">
<p>The fact that a variable has an unobserved value is still an observation. It is data, just with a very special value. The meaning of this value depends upon the context. Consider for example a questionnaire on personal income. If some people refuse to fill in their income, this may be associated with low (or high) income. Therefore a model that tries to predict the missing values can be enlightening. (p.&nbsp;499)</p>
</blockquote>
</section>
<section id="dag-ate-my-homework" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="dag-ate-my-homework"><span class="header-section-number">15.2.1</span> DAG ate my homework</h3>
<p>We’ll start this section off with our version of Figure 15.4. It’s going to take a bit of effort on our part to make a nice representation those four DAGs. Here we make panels a, b, and d.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel a</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"H"</span>, <span class="st">"Hs"</span>, <span class="st">"D"</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  H  <span class="sc">~</span> S,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  Hs <span class="sc">~</span> H <span class="sc">+</span> D,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"H"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"H"</span>, <span class="st">"H*"</span>, <span class="st">"S"</span>)) <span class="sc">+</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel b</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  H  <span class="sc">~</span> S,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  Hs <span class="sc">~</span> H <span class="sc">+</span> D,</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  D  <span class="sc">~</span> S,</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"H"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"H"</span>, <span class="st">"H*"</span>, <span class="st">"S"</span>)) <span class="sc">+</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel d</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  H  <span class="sc">~</span> S,</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  Hs <span class="sc">~</span> H <span class="sc">+</span> D,</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  D  <span class="sc">~</span> H,</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"H"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"H"</span>, <span class="st">"H*"</span>, <span class="st">"S"</span>)) <span class="sc">+</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make panel c.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"H"</span>, <span class="st">"Hs"</span>, <span class="st">"D"</span>, <span class="st">"X"</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">1.5</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">1.5</span>))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  H  <span class="sc">~</span> S <span class="sc">+</span> X,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  Hs <span class="sc">~</span> H <span class="sc">+</span> D,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  D  <span class="sc">~</span> X,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"X"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"D"</span>, <span class="st">"H"</span>, <span class="st">"H*"</span>, <span class="st">"S"</span>, <span class="st">"X"</span>)) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now combine, adjust a little, and plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"a"</span>, <span class="at">tag_prefix =</span> <span class="st">"("</span>, <span class="at">tag_suffix =</span> <span class="st">")"</span>) <span class="sc">&amp;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">&amp;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>() <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey8"</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="st">"in"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="432"></p>
</figure>
</div>
</div>
</div>
<p>On page 500, we read:</p>
<blockquote class="blockquote">
<p>Consider a sample of students, all of whom own dogs. The students produce homework (<span class="math inline">\(H\)</span>). This homework varies in quality, influenced by how much each student studies (<span class="math inline">\(S\)</span>). We could simulate 100 students, their attributes, and their homework like this:</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">s =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h   =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">10</span>, <span class="fu">plogis</span>(s)),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_a =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d_b =</span> <span class="fu">ifelse</span>(s <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hm_a =</span> <span class="fu">ifelse</span>(d_a <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, h),</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">hm_b =</span> <span class="fu">ifelse</span>(d_b <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, h))</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 6
         s     h   d_a   d_b  hm_a  hm_b
     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
 1  0.259      6     0     1     6    NA
 2  1.83       8     0     1     8    NA
 3 -0.340      4     0     0     4     4
 4  0.897      6     1     1    NA    NA
 5  0.488      8     1     1    NA    NA
 6 -1.26       3     1     0    NA     3
 7  0.0228     3     1     1    NA    NA
 8  1.09       6     1     1    NA    NA
 9 -0.132      6     0     0     6     6
10 -1.08       3     1     0    NA     3
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>In that code block, we simulated the data corresponding to McElreath’s <strong>R</strong> code 15.8 through 15.10. We have two <code>d</code> and <code>hm</code> variables. <code>d_a</code> and <code>hm_a</code> correspond to McElreath’s <strong>R</strong> code 15.9 and the DAG in panel a. <code>d_b</code> and <code>hm_b</code> correspond to McElreath’s <strong>R</strong> code 15.10 and the DAG in panel b.</p>
<p>This wasn’t in the text, but here we’ll plot <code>h</code>, <code>hm_a</code>, and <code>hm_b</code> to get a sense of how the first two missing data examples compare to the original data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"h"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    name, </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"h"</span>, <span class="st">"hm_a"</span>, <span class="st">"hm_b"</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"true distribution"</span>, <span class="st">"missing completely at random"</span>, <span class="st">"missing conditional on s"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">|&gt;</span> </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> value, <span class="at">color =</span> name <span class="sc">==</span> <span class="st">"true distribution"</span>)) <span class="sc">+</span> </span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="720"></p>
</figure>
</div>
</div>
</div>
<p>The left panel is the ideal situation letting us learn what we want to know, what is the effect of studying on the grade you’ll get on your homework (<span class="math inline">\(S \rightarrow H\)</span>). Once we enter in a missing data process (i.e., dogs <span class="math inline">\(D\)</span> eating homework), we end up with <span class="math inline">\(H^*\)</span>, the homework left over after the dogs. Thus the homework outcomes we collect are a combination of the full set of homework and the hungry dogs. The middle panel depicts the scenario where the dogs eat the homework completely at random, <span class="math inline">\(H \rightarrow H^* \leftarrow D\)</span>. In the right panel, we consider a scenario where the dogs only and always eat the homework on the occasions the students studied more than average, <span class="math inline">\(H \rightarrow H^* \leftarrow D \leftarrow S\)</span>.</p>
<p>The situation in the third DAG is more complicated. Now homework is conditional on both studying and how noisy it is in a students home, <span class="math inline">\(X\)</span>. Also, our new variable <span class="math inline">\(X\)</span> isn’t measured and whether the dogs eat the homework is also conditional on that unmeasured <span class="math inline">\(X\)</span>. Here’s the new data simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">501</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">s =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">10</span>, <span class="fu">plogis</span>(<span class="dv">2</span> <span class="sc">+</span> s <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> x)),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hm =</span> <span class="fu">ifelse</span>(d <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, h))</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 5
         x      s     h     d    hm
     &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
 1  0.577   1.15     10     0    10
 2  0.617  -0.786     7     0     7
 3  0.452   0.958     9     0     9
 4  0.226   0.754     8     0     8
 5 -0.845   0.689    10     0    10
 6 -1.43    0.176    10     0    10
 7 -1.65    0.280    10     0    10
 8  0.0356 -0.397     8     0     8
 9  0.184   0.261     7     0     7
10  1.22   -1.01      2     1    NA
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>Those data look like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"h"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    name, </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"h"</span>, <span class="st">"hm"</span>),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"true distribution"</span>, <span class="st">"missing conditional on x"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">|&gt;</span> </span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> value, <span class="at">color =</span> name <span class="sc">==</span> <span class="st">"true distribution"</span>)) <span class="sc">+</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="504"></p>
</figure>
</div>
</div>
</div>
<p>Fit the model using the data with no missingness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  h <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">10</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> s,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.03"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: h | trials(10) ~ 1 + s 
   Data: d (Number of observations: 1000) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.11      0.02     1.06     1.16 1.00     2906     2559
s             0.69      0.03     0.64     0.74 1.00     2714     2530

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Since this is not the data-generating model, we shouldn’t be all that surprised the coefficient for <code>s</code> is off (it should be 1). Because this is an example of where we didn’t collect data on <span class="math inline">\(X\)</span>, we can think of our incorrect results as a case of <strong>omitted variable bias</strong>. Here’s what happens when we run the model on <code>hm</code>, the homework variable after the hungry dogs got to it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  h <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">10</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> s,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.04"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: h | trials(10) ~ 1 + s 
   Data: filter(d, d == 0) (Number of observations: 820) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.79      0.03     1.73     1.87 1.00     2061     2136
s             0.83      0.03     0.76     0.89 1.00     1977     2358

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Interestingly, both the intercept and the coefficient for <code>s</code> are now less biased. Because both <span class="math inline">\(H\)</span> and <span class="math inline">\(D\)</span> are conditional on <span class="math inline">\(X\)</span>, omitting cases based on <span class="math inline">\(X\)</span> resulted in a model that conditional on <span class="math inline">\(X\)</span>, even though <span class="math inline">\(X\)</span> wasn’t directly in the statistical model. This won’t always be the case. Consider what happens when we have a different missing data mechanism.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hm =</span> <span class="fu">ifelse</span>(d <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, h))</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 5
         x      s     h     d    hm
     &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
 1  0.577   1.15     10     1    NA
 2  0.617  -0.786     7     1    NA
 3  0.452   0.958     9     1    NA
 4  0.226   0.754     8     1    NA
 5 -0.845   0.689    10     1    NA
 6 -1.43    0.176    10     0    10
 7 -1.65    0.280    10     0    10
 8  0.0356 -0.397     8     1    NA
 9  0.184   0.261     7     1    NA
10  1.22   -1.01      2     0     2
# ℹ 990 more rows</code></pre>
</div>
</div>
<p>Here’s what then updated data look like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"h"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    name, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"h"</span>, <span class="st">"hm"</span>),</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"true distribution"</span>, <span class="st">"missing conditional on x"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(value) <span class="sc">|&gt;</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> value, <span class="at">color =</span> name <span class="sc">==</span> <span class="st">"true distribution"</span>)) <span class="sc">+</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>]) <span class="sc">+</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="504"></p>
</figure>
</div>
</div>
</div>
<p>McElreath didn’t fit this model in the text, but he encouraged us to do so on our own (p.&nbsp;503). Here it is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.4</span>b <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(d <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  h <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">10</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> s,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.04b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.4</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: h | trials(10) ~ 1 + s 
   Data: filter(d, d == 0) (Number of observations: 307) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.34      0.04     0.27     0.42 1.00     3677     2416
s             0.49      0.04     0.41     0.57 1.00     3499     2659

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Yep, “now missingness makes things worse” (p.&nbsp;503).</p>
<section id="rethinking-naming-completely-at-random" class="level4" data-number="15.2.1.1">
<h4 data-number="15.2.1.1" class="anchored" data-anchor-id="rethinking-naming-completely-at-random"><span class="header-section-number">15.2.1.1</span> Rethinking: Naming completely at random</h4>
<p>McElreath briefly mentioned the terms <strong>missing completely at random</strong> (MCAR), <strong>missing at random</strong> (MAR), and <strong>missing not at random</strong> (MNAR). I share his sentiments; these terms are awful. However, they’re peppered throughout the missing data literature and I recommend you familiarize yourself with them. In his endnote #227, McElreath pointed readers to the authoritative work of <span class="citation" data-cites="rubinInferenceAndMissingData1976">Donald B. Rubin (<a href="references.html#ref-rubinInferenceAndMissingData1976" role="doc-biblioref">1976</a>)</span> and Little and Rubin <span class="citation" data-cites="littleStatisticalAnalysisMissing2019">(<a href="references.html#ref-littleStatisticalAnalysisMissing2019" role="doc-biblioref">2019</a>, though he referenced the second edition, whereas I’m referencing the third)</span>. <span class="citation" data-cites="baraldiIntroductionToModernMissingData2010">Baraldi &amp; Enders (<a href="references.html#ref-baraldiIntroductionToModernMissingData2010" role="doc-biblioref">2010</a>)</span> is a nice primer, too. Also, the great <a href="https://statistics.fas.harvard.edu/people/donald-b-rubin">Donald Rubin</a> has several lectures available online. Here’s a <a href="https://youtu.be/AH7lvy45k2U">link</a> to a talk on causal inference, which includes bits of insights into missing data analysis and lots of historical tidbits, too.</p>
</section>
</section>
<section id="imputing-primates" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="imputing-primates"><span class="header-section-number">15.2.2</span> Imputing primates</h3>
<p>We return to the <code>milk</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(milk, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> milk</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(milk)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neocortex.prop =</span> neocortex.perc <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">logmass        =</span> <span class="fu">log</span>(mass)) <span class="sc">|&gt;</span> </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">k =</span> (kcal.per.g <span class="sc">-</span> <span class="fu">mean</span>(kcal.per.g)) <span class="sc">/</span> <span class="fu">sd</span>(kcal.per.g),</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> (neocortex.prop <span class="sc">-</span> <span class="fu">mean</span>(neocortex.prop, <span class="at">na.rm =</span> T)) <span class="sc">/</span> <span class="fu">sd</span>(neocortex.prop, <span class="at">na.rm =</span> T),</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">m =</span> (logmass <span class="sc">-</span> <span class="fu">mean</span>(logmass)) <span class="sc">/</span> <span class="fu">sd</span>(logmass))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note how we set <code>na.rm = T</code> within the <code>mean()</code> and <code>sd()</code> functions when computing <code>b</code>. See what happens if you leave that part out. As hinted at above and explicated in the text, we’re missing 12 values for <code>neocortex.prop</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="fu">is.na</span>(neocortex.prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  is.na(neocortex.prop)  n
1                 FALSE 17
2                  TRUE 12</code></pre>
</div>
</div>
<p>We dropped those values when we fit the models back in <a href="05.html#sec-Masked-relationship" class="quarto-xref"><span>Section 5.2</span></a>. To get a sense of whether this was a bad idea, let’s consider the model with a DAG. Ignoring the missing data, we have this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"U"</span>, <span class="st">"K"</span>, <span class="st">"B"</span>),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M <span class="sc">~</span> U,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>       B <span class="sc">~</span> U,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>       K <span class="sc">~</span> M <span class="sc">+</span> B,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"U"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>() <span class="sc">+</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="240"></p>
</figure>
</div>
</div>
</div>
<p>“<span class="math inline">\(M\)</span> is body mass, <span class="math inline">\(B\)</span> is neocortex percent, <span class="math inline">\(K\)</span> is milk energy, and <span class="math inline">\(U\)</span> is some unobserved variable that renders <span class="math inline">\(M\)</span> and <span class="math inline">\(B\)</span> positively correlated” (p.&nbsp;504). Because we have missingness in <span class="math inline">\(B\)</span>, our data in hand are actually <span class="math inline">\(B^*\)</span>. McElreath considered three processes that may have generated these missing data. Here are the DAGs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"U"</span>, <span class="st">"K"</span>, <span class="st">"B"</span>, <span class="st">"RB"</span>, <span class="st">"Bs"</span>),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Left</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  M  <span class="sc">~</span> U,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  B  <span class="sc">~</span> U,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  K  <span class="sc">~</span> M <span class="sc">+</span> B,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  Bs <span class="sc">~</span> RB <span class="sc">+</span> B,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"U"</span>, <span class="st">"B"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"M"</span>, <span class="fu">expression</span>(R[B]), <span class="st">"U"</span>, <span class="fu">expression</span>(B<span class="sc">^</span><span class="st">'*'</span>), <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Middle</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  M  <span class="sc">~</span> U,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  B  <span class="sc">~</span> U,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  K  <span class="sc">~</span> M <span class="sc">+</span> B,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  Bs <span class="sc">~</span> RB <span class="sc">+</span> B,</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  RB <span class="sc">~</span> M,</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"U"</span>, <span class="st">"B"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"M"</span>, <span class="fu">expression</span>(R[B]), <span class="st">"U"</span>, <span class="fu">expression</span>(B<span class="sc">^</span><span class="st">'*'</span>), <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Right</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>  M  <span class="sc">~</span> U,</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>  B  <span class="sc">~</span> U,</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>  K  <span class="sc">~</span> M <span class="sc">+</span> B,</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  Bs <span class="sc">~</span> RB <span class="sc">+</span> B,</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>  RB <span class="sc">~</span> B,</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"U"</span>, <span class="st">"B"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"M"</span>, <span class="fu">expression</span>(R[B]), <span class="st">"U"</span>, <span class="fu">expression</span>(B<span class="sc">^</span><span class="st">'*'</span>), <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>)</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine, entitle, and display</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3) <span class="sc">&amp;</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">&amp;</span></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>() <span class="sc">&amp;</span></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"black"</span>),</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey8"</span>, <span class="at">color =</span> <span class="st">"grey8"</span>),</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="st">"in"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="696"></p>
</figure>
</div>
</div>
</div>
<p>In each of the DAGs, the new variable <span class="math inline">\(R_B\)</span> simply indicates whether a given species has missingness in <span class="math inline">\(B^*\)</span>, much like our dog variable <span class="math inline">\(D\)</span> indicated the missing data in the DAGs from the earlier DAGs. The big difference between then and now is that whereas we had a sense of what was causing the missing data in the earlier examples (i.e., those hungry <span class="math inline">\(D\)</span> dogs), now we only have a generic missing data mechanism, <span class="math inline">\(R_B\)</span>. In the middle of page 505, McElreath asked we consider one more missing data mechanism, this time with a new unmeasured causal variable <span class="math inline">\(V\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"U"</span>, <span class="st">"K"</span>, <span class="st">"B"</span>, <span class="st">"Bs"</span>, <span class="st">"RB"</span>, <span class="st">"V"</span>),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">3.4</span>),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="fl">1.45</span>))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M  <span class="sc">~</span> U,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>       B  <span class="sc">~</span> U <span class="sc">+</span> V,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>       K  <span class="sc">~</span> M <span class="sc">+</span> B,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>       Bs <span class="sc">~</span> RB <span class="sc">+</span> B,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>       RB <span class="sc">~</span> V,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"U"</span>, <span class="st">"B"</span>, <span class="st">"V"</span>), <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"M"</span>, <span class="fu">expression</span>(R[B]), <span class="st">"U"</span>, <span class="st">"V"</span>, <span class="fu">expression</span>(B<span class="sc">^</span><span class="st">'*'</span>), <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="360"></p>
</figure>
</div>
</div>
</div>
<p>However, our statistical model will follow the form</p>
<p><span class="math display">\[\begin{align*}
K_i     &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \color{#5D01A6FF}{B_i} + \beta_2 \log M_i \\
\color{#5D01A6FF}{B_i} &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Normal}(\nu, \sigma_B)} \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1) \\
\color{#5D01A6FF}\nu &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Normal}(0, 0.5)} \\
\color{#5D01A6FF}{\sigma_B} &amp; \color{#5D01A6FF}\sim \color{#5D01A6FF}{\operatorname{Exponential}(1)},
\end{align*}\]</span></p>
<p>where we simply presume the missing values in <span class="math inline">\(B_i\)</span>, which was <span class="math inline">\(B^*\)</span> in our DAGs, are unrelated to any of the other variables in the model. But those missing values in <span class="math inline">\(B_i\)</span> values do get their own prior distribution, <span class="math inline">\(\operatorname{Normal}(\nu, \sigma_B)\)</span>. If you look closely, you’ll discover the prior McElreath reported for <span class="math inline">\(\nu\)</span> <span class="math inline">\([\operatorname{Normal}(0.5, 1)]\)</span> does not match up with his <code>rethinking::ulam()</code> code in his <strong>R</strong> code block 15.17, <span class="math inline">\(\operatorname{Normal}(0, 0.5)\)</span>. Here we use the latter.</p>
<p>When writing a multivariate model in <strong>brms</strong>, I find it easier to save the model code by itself and then insert it into the <code>brm()</code> function. Otherwise, things start to feel cluttered.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's the primary `k` model</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>b_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(k <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">mi</span>(b) <span class="sc">+</span> m) <span class="sc">+</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here's the model for the missing `b` data </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(b <span class="sc">|</span> <span class="fu">mi</span>() <span class="sc">~</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here we set the residual correlations for the two models to zero</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note the <code>mi(b)</code> syntax in the <code>k</code> model. This indicates that the predictor, <code>b</code>, has missing values that are themselves being modeled. To get a sense of how to specify the priors for such a model in <strong>brms</strong>, use the <code>get_prior()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> d,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> gaussian,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>          b_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   prior     class coef group resp dpar nlpar lb ub tag       source
    student_t(3, 0, 2.5) Intercept               b                           default
    student_t(3, 0, 2.5)     sigma               b             0             default
                  (flat)         b               k                           default
                  (flat)         b    m          k                      (vectorized)
                  (flat)         b  mib          k                      (vectorized)
 student_t(3, -0.3, 2.5) Intercept               k                           default
    student_t(3, 0, 2.5)     sigma               k             0             default</code></pre>
</div>
</div>
<p>With the one-step Bayesian imputation procedure in <strong>brms</strong>, you might need to use the <code>resp</code> argument when specifying non-default priors. Now fit the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  b_model,  <span class="co"># here we insert the model</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> k),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> b),</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b,         <span class="at">resp =</span> k),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma,     <span class="at">resp =</span> k),</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma,     <span class="at">resp =</span> b)),</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.05"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With a model like this, <code>print()</code> only gives up part of the picture.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity
         mu = identity 
Formula: k ~ 1 + mi(b) + m 
         b | mi() ~ 1 
   Data: d (Number of observations: 29) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
k_Intercept     0.03      0.16    -0.30     0.35 1.00     4087     3220
b_Intercept    -0.04      0.21    -0.46     0.39 1.00     3378     2750
k_m            -0.54      0.20    -0.93    -0.13 1.00     2271     2695
k_mib           0.49      0.24     0.01     0.93 1.00     1472     2646

Further Distributional Parameters:
        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_k     0.84      0.14     0.61     1.16 1.00     2070     3008
sigma_b     1.02      0.18     0.73     1.41 1.00     2398     2615

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Note that for the parameters summarized in the ‘Population-Level Effects:’ section, the criterion is indexed in the prefix. The parameters in the ‘Family Specific Parameters:’, however, have the criteria indexed in the suffix. I don’t know why. Anyway, we can get a summary of the imputed values with <code>posterior_summary()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b15<span class="fl">.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Est.Error   Q2.5  Q97.5
b_k_Intercept     0.03      0.16  -0.30   0.35
b_b_Intercept    -0.04      0.21  -0.46   0.39
b_k_m            -0.54      0.20  -0.93  -0.13
bsp_k_mib         0.49      0.24   0.01   0.93
sigma_k           0.84      0.14   0.61   1.16
sigma_b           1.02      0.18   0.73   1.41
Intercept_k       0.03      0.16  -0.30   0.35
Intercept_b      -0.04      0.21  -0.46   0.39
Ymi_b[2]         -0.58      0.95  -2.41   1.32
Ymi_b[3]         -0.70      0.95  -2.55   1.22
Ymi_b[4]         -0.72      0.97  -2.62   1.24
Ymi_b[5]         -0.30      0.89  -2.05   1.50
Ymi_b[9]          0.47      0.94  -1.41   2.35
Ymi_b[14]        -0.15      0.91  -1.93   1.76
Ymi_b[15]         0.18      0.87  -1.56   1.88
Ymi_b[17]         0.27      0.89  -1.54   2.02
Ymi_b[19]         0.52      0.92  -1.32   2.36
Ymi_b[21]        -0.44      0.90  -2.25   1.36
Ymi_b[23]        -0.29      0.91  -2.08   1.53
Ymi_b[26]         0.14      0.94  -1.75   1.96
lprior           -4.17      0.81  -6.09  -2.97
lp__            -81.38      3.93 -89.77 -74.82</code></pre>
</div>
</div>
<p>The imputed <code>b</code> values are indexed by occasion number from the original data. This is in contrast with McElreath’s <code>precis()</code> output, which simply serially indexes the missing values as <code>B_impute[1]</code>, <code>B_impute[2]</code>, and so on.</p>
<p>Before we move on to the next model, let’s plot to get a sense of what we’ve done.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b15<span class="fl">.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Ymi_b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">filter</span>(d, <span class="fu">is.na</span>(b)) <span class="sc">|&gt;</span> <span class="fu">pull</span>(species)) <span class="sc">|&gt;</span> </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"species"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">reorder</span>(species, value))) <span class="sc">+</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="at">fill =</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">4</span>], </span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">height =</span> <span class="fl">1.5</span>, <span class="at">slab_color =</span> <span class="st">"black"</span>, <span class="at">slab_size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"imputed values for b"</span>,</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Here’s the model that drops the cases with NAs on <code>b</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  k <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> b <span class="sc">+</span> m,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.06"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you run this on your computer, you’ll notice the following message at the top: “Rows containing NAs were excluded from the model.” This time <code>print()</code> gives us the same basic summary information as <code>posterior_summary()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: k ~ 1 + b + m 
   Data: d (Number of observations: 17) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.10      0.19    -0.28     0.49 1.00     3109     2307
b             0.60      0.28    -0.01     1.12 1.00     1962     2224
m            -0.63      0.25    -1.10    -0.10 1.00     1995     2316

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.88      0.19     0.60     1.32 1.00     2280     2664

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We can’t use McElreath’s <code>plot(coeftab())</code> trick with our <strong>brms</strong> output, but we can still get by.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">fixef</span>(b15<span class="fl">.5</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>),</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">fixef</span>(b15<span class="fl">.6</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_c</span>(<span class="st">"beta["</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">"]"</span>),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">fit  =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"b15.5"</span>, <span class="st">"b15.6"</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"marginal posterior"</span>,</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> term, <span class="at">labeller =</span> label_parsed, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"transparent"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The model using Bayesian imputation (<code>b15.5</code>) used more information, resulting in narrower marginal posteriors for <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>. Because it wasted perfectly good information, the conventional <code>b15.6</code> model was less certain.</p>
<p>In order to make our version of Figure 15.5, we’ll want to add the summary values for the imputed <code>b</code> data from <code>b15.1</code> to the primary data file <code>d</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_summary</span>(b15<span class="fl">.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"Ymi"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">str_extract</span>(term, <span class="st">"(</span><span class="sc">\\</span><span class="st">d)+"</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>()),</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"row"</span>) </span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, k<span class="sc">:</span>Q97<span class="fl">.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29
Columns: 10
$ species   &lt;fct&gt; Eulemur fulvus, E macaco, E mongoz, E rubriventer, Lemur catta, Alouatta seniculus, A palliata, Cebus apella, …
$ k         &lt;dbl&gt; -0.9400408, -0.8161263, -1.1259125, -1.0019980, -0.2585112, -1.0639553, -0.5063402, 1.5382486, 1.6621631, 1.72…
$ b         &lt;dbl&gt; -2.080196025, NA, NA, NA, NA, -0.508641289, -0.508641289, 0.010742472, NA, 0.213469683, -1.461961806, -0.98613…
$ m         &lt;dbl&gt; -0.4558357, -0.4150024, -0.3071581, -0.5650254, -0.3874772, 0.1274408, 0.1407505, -0.3071581, -1.0508443, -1.0…
$ row       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29
$ term      &lt;chr&gt; NA, "Ymi_b[2]", "Ymi_b[3]", "Ymi_b[4]", "Ymi_b[5]", NA, NA, NA, "Ymi_b[9]", NA, NA, NA, NA, "Ymi_b[14]", "Ymi_…
$ Estimate  &lt;dbl&gt; NA, -0.5830310, -0.7044893, -0.7152075, -0.2971713, NA, NA, NA, 0.4743642, NA, NA, NA, NA, -0.1549032, 0.17922…
$ Est.Error &lt;dbl&gt; NA, 0.9462630, 0.9468543, 0.9720820, 0.8900150, NA, NA, NA, 0.9445337, NA, NA, NA, NA, 0.9106710, 0.8715274, N…
$ Q2.5      &lt;dbl&gt; NA, -2.413219, -2.548091, -2.623875, -2.048046, NA, NA, NA, -1.413304, NA, NA, NA, NA, -1.927931, -1.557906, N…
$ Q97.5     &lt;dbl&gt; NA, 1.322098, 1.216156, 1.240403, 1.500836, NA, NA, NA, 2.351685, NA, NA, NA, NA, 1.764372, 1.882271, NA, 2.01…</code></pre>
</div>
</div>
<p>Now make Figure 15.5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"D"</span>)(<span class="dv">7</span>)[<span class="dv">4</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Left</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> k)) <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> b),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"neocortex percent (std)"</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"kcal milk (std)"</span>) <span class="sc">+</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>b, <span class="at">na.rm =</span> T))</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Right</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> m)) <span class="sc">+</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> b),</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"log body mass (std)"</span>,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"neocortex percent (std)"</span>) <span class="sc">+</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>b, <span class="at">na.rm =</span> T))</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>“We can improve this model by changing the imputation model to estimate the relationship between the two predictors” (p.&nbsp;509). In the text, McElreath accomplished this with the model</p>
<p><span class="math display">\[\begin{align*}
K_i   &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta_1 \color{#5D01A6FF}{B_i} + \beta_2 \log M_i \\
\color{#5D01A6FF}{\begin{bmatrix} M_i \\ B_i \end{bmatrix}} &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{MVNormal}
\begin{pmatrix}
\begin{bmatrix} \mu_M \\\mu_B \end{bmatrix},
\mathbf \Sigma \end{pmatrix}} \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1) \\
\color{#5D01A6FF}{\mu_M} &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Normal}(0, 0.5)} \\
\color{#5D01A6FF}{\mu_B} &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Normal}(0, 0.5)} \\
\color{#5D01A6FF}{\mathbf \Sigma} &amp; \color{#5D01A6FF} = \color{#5D01A6FF}{\operatorname{\mathbf S \mathbf R \mathbf S}} \\
\color{#5D01A6FF}{\mathbf S} &amp; \color{#5D01A6FF} = \color{#5D01A6FF}{\begin{bmatrix} \sigma_M &amp; 0 \\ 0 &amp; \sigma_B \end{bmatrix}} \\
\color{#5D01A6FF}{\mathbf R} &amp; \color{#5D01A6FF} = \color{#5D01A6FF}{\begin{bmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{bmatrix}} \\
\color{#5D01A6FF}{\sigma_M}  &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Exponential}(1)} \\
\color{#5D01A6FF}{\sigma_B}  &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Exponential}(1)} \\
\color{#5D01A6FF} \rho       &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{LKJ}(2)},
\end{align*}\]</span></p>
<p>which expresses the relationship between the two predictors with a residual correlation matrix, <span class="math inline">\(\mathbf \Sigma\)</span>. Importantly, though <span class="math inline">\(\mathbf \Sigma\)</span> involves the variables <span class="math inline">\(B_i\)</span> and <span class="math inline">\(M_i\)</span>, it does not directly involve the criterion, <span class="math inline">\(K_i\)</span>. As it turns out, the current version of <strong>brms</strong> cannot handle a model of this form. When you fit multivariate models with residual correlations, you have to set them for either all variables or none of them. For a little more on this topic, you can skim through the <a href="https://discourse.mc-stan.org/t/brms-and-heterogeneous-residual-covariance-equivalent-of-at-level-function/6637"><em>Brms and heterogeneous residual covariance - equivalent of “at.level” function</em></a> thread on the Stan Forums. Bürkner’s response to the initial question indicated this kind of model will be available in <strong>brms</strong> version 3.0+, which I suspect will entail a substantial reworking of the multivariate syntax. Until then, we can fit the alternative model</p>
<p><span class="math display">\[\begin{align*}
K_i   &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta_1 \color{#5D01A6FF}{B_i} + \beta_2 \log M_i \\
\color{#5D01A6FF}{B_i}   &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Normal}(\nu_i, \sigma_B)} \\
\color{#5D01A6FF}{\nu_i} &amp; \color{#5D01A6FF} = \color{#5D01A6FF}{\gamma + \delta_1 \log M_i} \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1) \\
\color{#5D01A6FF}\gamma     &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Normal}(0, 0.5)} \\
\color{#5D01A6FF}{\delta_1} &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Normal}(0, 0.5)} \\
\color{#5D01A6FF}{\sigma_B} &amp; \color{#5D01A6FF} \sim \color{#5D01A6FF}{\operatorname{Exponential}(1)},
\end{align*}\]</span></p>
<p>which captures the relation among the two predictors as a regression of <span class="math inline">\(M_i\)</span> predicting <span class="math inline">\(B_i\)</span>. Here’s how to fit the model with <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>b_model <span class="ot">&lt;-</span> <span class="fu">mvbf</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(k <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">mi</span>(b) <span class="sc">+</span> m), </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(b <span class="sc">|</span> <span class="fu">mi</span>() <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m), </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rescor =</span> <span class="cn">FALSE</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  b_model,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> k),</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> b),</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> k),</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> b),</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma,     <span class="at">resp =</span> k),</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma,     <span class="at">resp =</span> b)),</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.07"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see what we did.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian) 
  Links: mu = identity
         mu = identity 
Formula: k ~ 1 + mi(b) + m 
         b | mi() ~ 1 + m 
   Data: d (Number of observations: 29) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
k_Intercept     0.03      0.16    -0.29     0.33 1.00     4065     3157
b_Intercept    -0.05      0.15    -0.36     0.25 1.00     3325     3131
k_m            -0.65      0.22    -1.06    -0.20 1.00     1645     2332
b_m             0.59      0.15     0.28     0.88 1.00     4121     2837
k_mib           0.59      0.26     0.08     1.08 1.00     1443     2456

Further Distributional Parameters:
        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_k     0.82      0.14     0.60     1.12 1.00     1857     2573
sigma_b     0.71      0.13     0.51     1.00 1.00     2015     2618

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We have two intercepts, <code>k_Intercept</code> (<span class="math inline">\(\alpha\)</span>) and <code>b_Intercept</code> (<span class="math inline">\(\gamma\)</span>). Both are near zero because both <code>k</code> and <code>b</code> are standardized. Our <code>k_mib</code> (<span class="math inline">\(\beta_1\)</span>) and <code>k_m</code> (<span class="math inline">\(\beta_2\)</span>) parameters correspond with McElreath’s <code>bB</code> and <code>bM</code> parameters, respectively. Our summaries for them are very similar to his. Notice our summary for <code>b_m</code> (<span class="math inline">\(\delta_1\)</span>). McElreath doesn’t have a parameter exactly like that, but his close analogue is <code>Rho_BM[1,2]</code> (also <code>Rho_BM[2,1]</code>, which is really the same thing). Also, notice how our summary for <code>b_m</code> is almost the same as the summary for McElreath’s <code>Rho_BM[1,2]</code>. This is because a univariable regression coefficient between two standardized variables is in the same metric as a correlation and McElreath’s <code>Rho_BM[1,2]</code> is just that–a correlation. If you fit McElreath’s model with <strong>rethinking</strong> and execute <code>precis(m15.7, depth = 3)</code>, you’ll see that our <code>sigma_k</code> (<span class="math inline">\(\sigma\)</span>) summary corresponds nicely with his summary for <code>sigma</code>. However, our <code>sigma_b</code> (<span class="math inline">\(\sigma_B\)</span>) is not the same as his <code>Sigma_BM[2]</code>. Why? Because whereas our <code>sigma_b</code> is a residual standard deviation after accounting for the effect of <code>m</code> on <code>b</code>, McElreath’s <code>Sigma_BM[2]</code> is just an estimate of the standard deviation of <code>b</code>. Also, notice that whereas McElreath’s output has a <code>Sigma_BM[1]</code> parameter, we have no direct analogue. Why? Because although <code>m</code> is a predictor variable for both <code>k</code> and <code>b</code>, we did not give it its own likelihood. McElreath, in contrast, entered <code>m</code> into the bivariate likelihood with <code>b</code>.</p>
<p>Our workflow for Figure 15.6 is largely the same as for Figure 15.5. The biggest difference is we need to remove the columns <code>term</code> through <code>upper</code> from our earlier model before we can replace them with those from the current model. After that, it’s basically cut and paste.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(term<span class="sc">:</span>Q97<span class="fl">.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_summary</span>(b15<span class="fl">.7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames_to_column</span>(<span class="st">"term"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"Ymi"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">str_extract</span>(term, <span class="st">"(</span><span class="sc">\\</span><span class="st">d)+"</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>()),</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"row"</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, k<span class="sc">:</span>Q97<span class="fl">.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29
Columns: 10
$ species   &lt;fct&gt; Eulemur fulvus, E macaco, E mongoz, E rubriventer, Lemur catta, Alouatta seniculus, A palliata, Cebus apella, …
$ k         &lt;dbl&gt; -0.9400408, -0.8161263, -1.1259125, -1.0019980, -0.2585112, -1.0639553, -0.5063402, 1.5382486, 1.6621631, 1.72…
$ b         &lt;dbl&gt; -2.080196025, NA, NA, NA, NA, -0.508641289, -0.508641289, 0.010742472, NA, 0.213469683, -1.461961806, -0.98613…
$ m         &lt;dbl&gt; -0.4558357, -0.4150024, -0.3071581, -0.5650254, -0.3874772, 0.1274408, 0.1407505, -0.3071581, -1.0508443, -1.0…
$ row       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29
$ term      &lt;chr&gt; NA, "Ymi_b[2]", "Ymi_b[3]", "Ymi_b[4]", "Ymi_b[5]", NA, NA, NA, "Ymi_b[9]", NA, NA, NA, NA, "Ymi_b[14]", "Ymi_…
$ Estimate  &lt;dbl&gt; NA, -0.61795816, -0.66220796, -0.78002708, -0.41078196, NA, NA, NA, -0.23812970, NA, NA, NA, NA, -0.70877651, …
$ Est.Error &lt;dbl&gt; NA, 0.6577113, 0.6791776, 0.6814547, 0.6265196, NA, NA, NA, 0.6863201, NA, NA, NA, NA, 0.6575743, 0.6374764, N…
$ Q2.5      &lt;dbl&gt; NA, -1.8497430, -1.9531706, -2.1477297, -1.6506746, NA, NA, NA, -1.5979021, NA, NA, NA, NA, -1.9648952, -1.243…
$ Q97.5     &lt;dbl&gt; NA, 0.7293671, 0.6920071, 0.5968854, 0.8499724, NA, NA, NA, 1.0857268, NA, NA, NA, NA, 0.6237932, 1.2977006, N…</code></pre>
</div>
</div>
<p>Now make Figure 15.6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"D"</span>)(<span class="dv">7</span>)[<span class="dv">3</span>]</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> k)) <span class="sc">+</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> b),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"neocortex percent (std)"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"kcal milk (std)"</span>) <span class="sc">+</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>b, <span class="at">na.rm =</span> T))</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> m)) <span class="sc">+</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> b),</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"log body mass (std)"</span>,</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"neocortex percent (std)"</span>) <span class="sc">+</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>b, <span class="at">na.rm =</span> T))</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>The results further show that our fully standardized regression coefficient (<span class="math inline">\(\delta_1\)</span>) had the same effect on the Bayesian imputation as McElreath’s residual correlation. Our <span class="math inline">\(\delta_1\)</span> coefficient is basically just a correlation in disguise.</p>
<section id="rethinking-multiple-imputations" class="level4" data-number="15.2.2.1">
<h4 data-number="15.2.2.1" class="anchored" data-anchor-id="rethinking-multiple-imputations"><span class="header-section-number">15.2.2.1</span> Rethinking: Multiple imputations</h4>
<blockquote class="blockquote">
<p>Missing data imputation has a messy history. There are many forms of imputation… A common non-Bayesian procedure is <strong>multiple imputation</strong>. Multiple imputation was developed in the context of survey non-response, and it actually has a Bayesian justification. But it was invented when Bayesian imputation on the desktop was impractical, so it tries to approximate the full Bayesian solution to a “missing at random” missingness model. If you aren’t comfortable dropping incomplete cases, then you shouldn’t be comfortable using multiple imputation either. The procedure performs multiple draws from an approximate posterior distribution of the missing values, performs separate analyses with these draws, and then combines the analyses in a way that approximates full Bayesian imputation. Multiple imputation is more limited than full Bayesian imputation, so now we just use the real thing. (p.&nbsp;511)</p>
</blockquote>
<p>We won’t be walking through an example in this ebook, but you should know that <strong>brms</strong> is capable of multiple imputation, too. You can find an example of multiple imputation in Bürkner’s <span class="citation" data-cites="Bürkner2022HandleMissingValues">(<a href="references.html#ref-Bürkner2022HandleMissingValues" role="doc-biblioref">2022b</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_missings.html"><em>Handle missing values with brms</em></a>. To learn about the origins of this approach, check out the authoritative work by Rubin <span class="citation" data-cites="rubinMultipleImputationNonresponse1987 rubinMultipleImputation181996">(<a href="references.html#ref-rubinMultipleImputationNonresponse1987" role="doc-biblioref">1987</a>, <a href="references.html#ref-rubinMultipleImputation181996" role="doc-biblioref">1996</a>)</span> and Little and Rubin <span class="citation" data-cites="littleStatisticalAnalysisMissing2019">(<a href="references.html#ref-littleStatisticalAnalysisMissing2019" role="doc-biblioref">2019</a>)</span>.</p>
</section>
</section>
<section id="where-is-your-god-now" class="level3 page-columns page-full" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="where-is-your-god-now"><span class="header-section-number">15.2.3</span> Where is your god now?</h3>
<p>“Sometimes there are no statistical solutions to scientific problems. But even then, careful statistical thinking can be useful because it will tell us that there is no statistical solution” (p.&nbsp;512).</p>
<p>Let’s load the <code>Moralizing_gods</code> data from <span class="citation" data-cites="whitehouseComplexSocietiesPrecede2019">Whitehouse et al. (<a href="references.html#ref-whitehouseComplexSocietiesPrecede2019" role="doc-biblioref">2019</a>)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;As it turns out, the article connected to the <code>Moralizing_gods</code> data, <span class="citation" data-cites="whitehouseComplexSocietiesPrecede2019">Whitehouse et al. (<a href="references.html#ref-whitehouseComplexSocietiesPrecede2019" role="doc-biblioref">2019</a>)</span>, has been retracted. You can find the details at <a href="https://retractionwatch.com/2021/07/07/critique-topples-nature-paper-on-belief-in-gods/"><em>Critique topples Nature paper on belief in gods</em></a>, on Retraction Watch. It appears the retraction is, in part, a reaction to this <a href="https://psyarxiv.com/jwa2n/">preprint</a> which, interestingly enough, questions the authors’ missing data methods. The preprint has since been published as <span class="citation" data-cites="beheim2021TreatmentOfMissingData">Beheim et al. (<a href="references.html#ref-beheim2021TreatmentOfMissingData" role="doc-biblioref">2021</a>)</span>.</p></div></div><div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Moralizing_gods, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Moralizing_gods</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Moralizing_gods)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a look at the new data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 864
Columns: 5
$ polity          &lt;fct&gt; Big Island Hawaii, Big Island Hawaii, Big Island Hawaii, Big Island Hawaii, Big Island Hawaii, Big Islan…
$ year            &lt;int&gt; 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, -600, -500, -400, -300, -200, -100, 0, 100, 200, 3…
$ population      &lt;dbl&gt; 3.729643, 3.729643, 3.598340, 4.026240, 4.311767, 4.205113, 4.373960, 5.157593, 4.997439, 1.547543, 1.54…
$ moralizing_gods &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, 1, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ writing         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,…</code></pre>
</div>
</div>
<p>The bulk of the values for <code>moralizing_gods</code> are missing and very few of the remaining values are <code>0</code>’s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(moralizing_gods) <span class="sc">|&gt;</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">%</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  moralizing_gods   n         %
1               0  17  1.967593
2               1 319 36.921296
3              NA 528 61.111111</code></pre>
</div>
</div>
<p>To get a sense of how these values are distributed, here’s our version of Figure 15.7.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mg =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(moralizing_gods), <span class="dv">2</span>, <span class="dv">1</span> <span class="sc">-</span> moralizing_gods),</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"present"</span>, <span class="st">"absent"</span>, <span class="st">"unknown"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> population, <span class="at">color =</span> mg)) <span class="sc">+</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Moralizing gods"</span>, </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"D"</span>)(<span class="dv">7</span>)[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>)]) <span class="sc">+</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time (year)"</span>,</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Population size (log)"</span>,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'"This is a highly non-random missingness pattern" (p. 514).'</span>) <span class="sc">+</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.125</span>, <span class="fl">0.67</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>Here are the counts broken down by gods and literacy status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gods     =</span> moralizing_gods,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">literacy =</span> writing) <span class="sc">|&gt;</span> </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gods, literacy) <span class="sc">|&gt;</span> </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">%</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  gods literacy   n          %
1    0        0  16  1.8518519
2    0        1   1  0.1157407
3    1        0   9  1.0416667
4    1        1 310 35.8796296
5   NA        0 442 51.1574074
6   NA        1  86  9.9537037</code></pre>
</div>
</div>
<p>The bulk of the missing <code>moralizing_gods</code> values are from non-literate polities and the figure above shows that smaller polities also tend to have missing values. We can try to make sense of all this with McElreath’s DAG.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"P"</span>, <span class="st">"W"</span>, <span class="st">"G"</span>, <span class="st">"RG"</span>, <span class="st">"Gs"</span>),</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">2.33</span>, <span class="dv">4</span>, <span class="fl">5.67</span>, <span class="dv">7</span>),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)) </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(P  <span class="sc">~</span> G,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>       W  <span class="sc">~</span> P,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>       RG <span class="sc">~</span> W,</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>       Gs <span class="sc">~</span> G <span class="sc">+</span> RG,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"G"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"G"</span>, <span class="st">"P"</span>, <span class="fu">expression</span>(R[G]), <span class="st">"W"</span>, <span class="fu">expression</span>(G<span class="sc">^</span><span class="st">'*'</span>))) <span class="sc">+</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="264"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Here <span class="math inline">\(P\)</span> is rate of population growth (not the same as the population size variable in the data), <span class="math inline">\(G\)</span> is the presence of belief in moralizing gods (which is unobserved), <span class="math inline">\(G^*\)</span> is the observed variable with missing values, <span class="math inline">\(W\)</span> is writing, and <span class="math inline">\(R_G\)</span> is the missing values indicator. This is an optimistic scenario, because it assumes there are no unobserved confounds among <span class="math inline">\(P\)</span>, <span class="math inline">\(G\)</span>, and <span class="math inline">\(W\)</span>. These are purely observational data, recall. But the goal is to use this example to think through the impact of missing data. If we can’t recover from missing data with the DAG above, adding confounds isn’t going to help. (p.&nbsp;515)</p>
</blockquote>
<p>Consider the case of Hawaii.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(polity <span class="sc">==</span> <span class="st">"Big Island Hawaii"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, writing, moralizing_gods)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year writing moralizing_gods
1 1000       0              NA
2 1100       0              NA
3 1200       0              NA
4 1300       0              NA
5 1400       0              NA
6 1500       0              NA
7 1600       0              NA
8 1700       0              NA
9 1800       0               1</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>What happened in 1778? Captain James Cook and his crew finally made contact….</p>
<p>After Captain Cook, Hawaii is correctly coded with 1 for belief in moralizing gods. It is also a fact that Hawaii never developed its own writing system. So there is no direct evidence of when moralizing gods appeared in Hawaii. Any imputation model needs to decide how to fill in those <code>NA</code> values. With so much missing data, any imputation model would necessarily make very strong assumptions. (pp.&nbsp;515–516)</p>
</blockquote>
<section id="rethinking-present-details-about-missing-data" class="level4" data-number="15.2.3.1">
<h4 data-number="15.2.3.1" class="anchored" data-anchor-id="rethinking-present-details-about-missing-data"><span class="header-section-number">15.2.3.1</span> Rethinking: Present details about missing data</h4>
<blockquote class="blockquote">
<p><em>Clear documentation of missing data and its treatment is necessary</em>. This is best done with a causal model that makes transparent what is being assumed about the source of missing values and simultaneously justifies how they are handled. But the minimum is to report the counts of missing values in each variable and what was done with them. (p.&nbsp;516, <em>emphasis</em> added)</p>
</blockquote>
<p>I strongly agree with McElreath on this point. When doing peer-reviews, I regularly inquire about missing data and how, if present, they were handled.</p>
</section>
</section>
</section>
<section id="sec-Categorical-errors-and-discrete-absences" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="sec-Categorical-errors-and-discrete-absences"><span class="header-section-number">15.3</span> Categorical errors and discrete absences</h2>
<blockquote class="blockquote">
<p>Discrete unobserved variables require discrete parameters. There are two issues with discrete parameters. First, a discrete variable will not produce a smooth surface for Hamiltonian Monte Carlo to glide around on. HMC just doesn’t do discrete variables. Second, other estimation approaches also have problems with discrete parameter spaces, because discrete jumps are difficult to calibrate. Chains tend to get stuck for long periods.</p>
<p>But that doesn’t mean we are stuck. In almost every case, we don’t need to sample discrete parameters at all. Instead we can use a special technique, known to experts as a “weighted average,” to remove discrete parameters from the model. After sampling the other parameters, we can then use their samples to compute the posterior distribution of any dis- crete parameter that we removed. So no information is given up. (pp.&nbsp;516–517)</p>
</blockquote>
<section id="discrete-cats" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="discrete-cats"><span class="header-section-number">15.3.1</span> Discrete cats</h3>
<p>Here is McElreath’s next DAG.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>dag_coords <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Rc"</span>, <span class="st">"Cs"</span>, <span class="st">"C"</span>, <span class="st">"N"</span>),</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="dv">1</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(Cs <span class="sc">~</span> Rc <span class="sc">+</span> C,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>       N  <span class="sc">~</span> C,</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> dag_coords) <span class="sc">|&gt;</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>() <span class="sc">|&gt;</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">"C"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> color),</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">7</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_text</span>(<span class="at">parse =</span> T, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"C"</span>,<span class="fu">expression</span>(R[C]), <span class="fu">expression</span>(C<span class="sc">^</span><span class="st">"*"</span>), <span class="st">"N"</span>)) <span class="sc">+</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges</span>(<span class="at">edge_colour =</span> <span class="st">"#FCF9F0"</span>) <span class="sc">+</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">2</span>], <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dark_theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="336"></p>
</figure>
</div>
</div>
</div>
<p>“The presence/absence of a cat <span class="math inline">\(C\)</span> influences the number of sung notes <span class="math inline">\(N\)</span>. Because of missing values <span class="math inline">\(R_C\)</span> however, we only observe <span class="math inline">\(C^*\)</span>” (p.&nbsp;517). McElreath’s proposed generative model was</p>
<p><span class="math display">\[\begin{align*}
N_i &amp; \sim \operatorname{Poisson}(\lambda_i) \\
\log \lambda_i &amp; = \alpha + \beta C_i \\
C_i &amp; \sim \operatorname{Bernoulli}(k) \\
R_{C, i} &amp; \sim \operatorname{Bernoulli}(r).
\end{align*}\]</span></p>
<p>We can simulate data along those lines with a few lines of code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>n_houses <span class="ot">&lt;-</span> <span class="dv">1000</span>L </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cat =</span> <span class="fu">rbinom</span>(n_houses, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> k)) <span class="sc">|&gt;</span> </span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">notes =</span> <span class="fu">rpois</span>(n_houses, <span class="at">lambda =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> cat),</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">r_c   =</span> <span class="fu">rbinom</span>(n_houses, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> r)) <span class="sc">|&gt;</span> </span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cat_obs =</span> <span class="fu">if_else</span>(r_c <span class="sc">==</span> <span class="dv">1</span>, (<span class="sc">-</span><span class="dv">9</span>L), cat))</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 4
$ cat     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1…
$ notes   &lt;int&gt; 3, 5, 11, 6, 9, 6, 6, 6, 1, 3, 4, 6, 3, 7, 6, 3, 6, 3, 4, 4, 2, 0, 4, 7, 3, 1, 7, 8, 2, 2, 5, 1, 6, 4, 7, 4, 3, …
$ r_c     &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ cat_obs &lt;int&gt; 0, 0, 0, 0, 0, 0, -9, 0, 1, 1, 0, -9, 1, -9, 0, 1, 0, 1, 0, 0, 1, -9, -9, -9, -9, -9, 0, -9, 1, 1, 0, 1, 0, 1, 0…</code></pre>
</div>
</div>
<p>Note how we constructed <code>cat_obs</code> by replacing several values of <code>cat</code> with <code>-9</code>.</p>
<blockquote class="blockquote">
<p>There is nothing special about this value. The model will skip them. But it is usually good to use some invalid value, so that if you make a mistake in coding, an error will result. In this case, since <code>cat</code> has a Bernoulli distribution, if the model ever asks for the probability of observing -9, there should be an error, because -9 is impossible. (p.&nbsp;518)</p>
</blockquote>
<p>😢 Sadly, this is as far as I’m going in this section. I still haven’t made sense of McElreath’s <em>weighted average</em> approach to missing data and I’m not sure whether it’s even possible with <strong>brms</strong>. If you have insights in to how one might accommodate categorical missing data with <strong>brms</strong>, share them with the rest of us on <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">GitHub</a>.</p>
</section>
</section>
<section id="summary" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">15.4</span> Summary</h2>
<blockquote class="blockquote">
<p>This chapter has been a quick introduction to the design and implementation of measurement error and missing data models. Measurement error and missing data have causes. Incorporating those causes into the generative model helps us decide how error and missingness impact inference as well as how to design a statistical procedure. (p.&nbsp;521)</p>
</blockquote>
<p>If modern missing data methods are new to you, you might also check out van Burren’s great online <span class="citation" data-cites="vanbuurenFlexibleImputationMissing2018">(<a href="references.html#ref-vanbuurenFlexibleImputationMissing2018" role="doc-biblioref">2018</a>)</span> text, <a href="https://stefvanbuuren.name/fimd/"><em>Flexible imputation of missing data</em></a>. I’m also a fan of Enders’s <span class="citation" data-cites="enders2022applied">(<a href="references.html#ref-enders2022applied" role="doc-biblioref">2022</a>)</span> <a href="http://www.appliedmissingdata.com"><em>Applied missing data analysis</em></a>, for which you can download a free sample chapter by clicking <a href="https://dl.dropboxusercontent.com/s/mhk6bdxj1lu48ua/Enders2E-Ch1.pdf?dl=1">here</a>.</p>
</section>
<section id="bonus-bayesian-meta-analysis-with-odds-ratios" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="bonus-bayesian-meta-analysis-with-odds-ratios"><span class="header-section-number">15.5</span> Bonus: Bayesian meta-analysis with odds ratios</h2>
<p>If your mind isn’t fully blown by those measurement-error and missing-data models, let’s keep building. As it turns out, meta-analyses are often just special kinds of multilevel measurement-error models. Thus, you can use <code>brms::brm()</code> to fit Bayesian meta-analyses, too.</p>
<p>Before we proceed, I should acknowledge that this section is heavily influenced by <a href="https://mvuorre.github.io/#about">Matti Vourre</a>’s great blog post, <a href="https://mvuorre.github.io/posts/2016-09-29-bayesian-meta-analysis/"><em>Bayesian meta-analysis with R, Stan, and brms</em></a>. Since neither editions of McElreath’s text directly address meta-analyses, we’ll also have to borrow a bit from Gelman, Carlin, Stern, Dunson, Vehtari, and Rubin’s <span class="citation" data-cites="gelman2013bayesian">(<a href="references.html#ref-gelman2013bayesian" role="doc-biblioref">2013</a>)</span> <a href="https://stat.columbia.edu/~gelman/book/"><em>Bayesian data analysis, Third edition</em></a>.</p>
<section id="how-do-meta-analyses-fit-into-the-picture" class="level3" data-number="15.5.1">
<h3 data-number="15.5.1" class="anchored" data-anchor-id="how-do-meta-analyses-fit-into-the-picture"><span class="header-section-number">15.5.1</span> How do meta-analyses fit into the picture?</h3>
<p>Let Gelman and colleagues introduce the topic:</p>
<blockquote class="blockquote">
<p>Discussions of meta-analysis are sometimes imprecise about the estimands of interest in the analysis, especially when the primary focus is on testing the null hypothesis of no effect in any of the studies to be combined. Our focus is on estimating meaningful parameters, and for this objective there appear to be three possibilities, accepting the overarching assumption that the studies are comparable in some broad sense. The first possibility is that we view the studies as identical replications of each other, in the sense we regard the individuals in all the studies as independent samples from a common population, with the same outcome measures and so on. A second possibility is that the studies are so different that the results of any one study provide no information about the results of any of the others. A third, more general, possibility is that we regard the studies as exchangeable but not necessarily either identical or completely unrelated; in other words we allow differences from study to study, but such that the differences are not expected <em>a priori</em> to have predictable effects favoring one study over another…. this third possibility represents a continuum between the two extremes, and it is this exchangeable model (with unknown hyperparameters characterizing the population distribution) that forms the basis of our Bayesian analysis….</p>
<p>The first potential estimand of a meta-analysis, or a hierarchically structured problem in general, is the mean of the distribution of effect sizes, since this represents the overall ‘average’ effect across all studies that could be regarded as exchangeable with the observed studies. Other possible estimands are the effect size in any of the observed studies and the effect size in another, comparable (exchangeable) unobserved study. (pp.&nbsp;125–126, <em>emphasis</em> in the original)</p>
</blockquote>
<p>The basic version of a Bayesian meta-analysis follows the form</p>
<p><span class="math display">\[y_j \sim \operatorname{Normal}(\theta_j, \sigma_j),\]</span></p>
<p>where <span class="math inline">\(y_j\)</span> = the point estimate for the effect size of a single study, <span class="math inline">\(j\)</span>, which is presumed to have been a draw from a Normal distribution centered on <span class="math inline">\(\theta_j\)</span>. The data in meta-analyses are typically statistical summaries from individual studies. The one clear lesson from this chapter is that those estimates themselves come with error and those errors should be fully expressed in the meta-analytic model. The standard error from study <span class="math inline">\(j\)</span> is specified <span class="math inline">\(\sigma_j\)</span>, which is also a stand-in for the standard deviation of the Normal distribution from which the point estimate was drawn. Do note, we’re not estimating <span class="math inline">\(\sigma_j\)</span>, here. Those values we take directly from the original studies.</p>
<p>Building on the model, we further presume that study <span class="math inline">\(j\)</span> is itself just one draw from a population of related studies, each of which have their own effect sizes. As such, we presume <span class="math inline">\(\theta_j\)</span> itself has a distribution following the form</p>
<p><span class="math display">\[\theta_j \sim \operatorname{Normal}(\mu, \tau),\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the meta-analytic effect (i.e., the population mean) and <span class="math inline">\(\tau\)</span> is the variation around that mean, what you might also think of as <span class="math inline">\(\sigma_\tau\)</span>.</p>
</section>
<section id="we-need-some-data" class="level3" data-number="15.5.2">
<h3 data-number="15.5.2" class="anchored" data-anchor-id="we-need-some-data"><span class="header-section-number">15.5.2</span> We need some data</h3>
<p>Our data in this section come from the second large-scale replication project by the Many Labs team <span class="citation" data-cites="kleinManyLabsInvestigating2018">(<a href="references.html#ref-kleinManyLabsInvestigating2018" role="doc-biblioref">Klein et al., 2018</a>)</span>. Of the 28 studies replicated in the study, we will focus on the replication of the trolley experiment from <span class="citation" data-cites="hauserDissociationMoralJudgments2007">Hauser et al. (<a href="references.html#ref-hauserDissociationMoralJudgments2007" role="doc-biblioref">2007</a>)</span>. Here’s how the study was described by Klein and colleagues:</p>
<blockquote class="blockquote">
<p>According to the principle of double effect, an act that harms other people is more morally permissible if the act is a foreseen side effect rather than the means to the greater good. <span class="citation" data-cites="hauserDissociationMoralJudgments2007">Hauser et al. (<a href="references.html#ref-hauserDissociationMoralJudgments2007" role="doc-biblioref">2007</a>)</span> compared participants’ reactions to two scenarios to test whether their judgments followed this principle. In the <em>foreseen-side-effect</em> scenario, a person on an out-of-control train changed the train’s trajectory so that the train killed one person instead of five. In the <em>greater-good</em> scenario, a person pushed a fat man in front of a train, killing him, to save five people. Whereas <span class="math inline">\(89\%\)</span> of participants judged the action in the foreseen-side-effect scenario as permissible <span class="math inline">\((95 \% \; \text{CI} = [87\%, 91\%]),\)</span> only <span class="math inline">\(11\%\)</span> of participants in the greater-good scenario judged it as permissible <span class="math inline">\((95 \% \; \text{CI} = [9\%, 13\%])\)</span>. The difference between the percentages was significant<span class="math inline">\(,\)</span> <span class="math inline">\(\chi^2(1, N = 2,646) = 1,615.96,\)</span> <span class="math inline">\(p &lt; .001,\)</span> <span class="math inline">\(w = .78,\)</span> <span class="math inline">\(d = 2.50,\)</span> <span class="math inline">\(95 \% \; \text{CI} = [2.22, 2.86]\)</span>. Thus, the results provided evidence for the principle of double effect. (p.&nbsp;459, <em>emphasis</em> in the original)</p>
</blockquote>
<p>You can find supporting materials for the replication project on the Open Science Framework at <a href="https://osf.io/8cd4r/">https://osf.io/8cd4r/</a>. The relevant subset of the data for the replication of Hauser et al.&nbsp;come from the <code>Trolley Dilemma 1 (Hauser et al., 2007)</code> folder within the <code>OSFdata.zip</code> (<a href="https://osf.io/ag2pd/">https://osf.io/ag2pd/</a>). I’ve downloaded the file and saved it on GitHub.</p>
<p>Here we load the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>file_url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/master/data/Hauser_1_study_by_order_all_CLEAN_CASE.csv"</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(file_url)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y   =</span> <span class="fu">ifelse</span>(variable <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">loc =</span> <span class="fu">factor</span>(Location,</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> <span class="fu">distinct</span>(d, Location) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Location),</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">59</span>))</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,842
Columns: 29
$ uID              &lt;dbl&gt; 65, 68, 102, 126, 145, 263, 267, 298, 309, 318, 350, 356, 376, 431, 438, 447, 483, 485, 520, 531, 565, …
$ variable         &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", "No", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …
$ factor           &lt;chr&gt; "SideEffect", "SideEffect", "SideEffect", "SideEffect", "SideEffect", "SideEffect", "SideEffect", "Side…
$ .id              &lt;chr&gt; "ML2_Slate1_Brazil__Portuguese_execution_illegal_r.csv", "ML2_Slate1_Brazil__Portuguese_execution_illeg…
$ source           &lt;chr&gt; "brasilia", "brasilia", "brasilia", "wilfredlaur", "wilfredlaur", "ubc", "ubc", "toronto", "toronto", "…
$ haus1.1          &lt;dbl&gt; 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 2, 1, 2, 1, 1, 2…
$ haus1.1t_1       &lt;dbl&gt; 39.054, 36.792, 56.493, 21.908, 25.635, 50.633, 58.661, 50.137, 51.717, 28.122, 41.889, 53.995, 28.380,…
$ haus2.1          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ haus2.1t_1       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ Source.Global    &lt;chr&gt; "brasilia", "brasilia", "brasilia", "wilfredlaur", "wilfredlaur", "ubc", "ubc", "toronto", "toronto", "…
$ Source.Primary   &lt;chr&gt; "brasilia", "brasilia", "brasilia", "wilfredlaur", "wilfredlaur", "ubc", "ubc", "toronto", "toronto", "…
$ Source.Secondary &lt;chr&gt; "brasilia", "brasilia", "brasilia", "wilfredlaur", "wilfredlaur", "ubc", "ubc", "toronto", "toronto", "…
$ Country          &lt;chr&gt; "Brazil", "Brazil", "Brazil", "Canada", "Canada", "Canada", "Canada", "Canada", "Canada", "Canada", "Ca…
$ Location         &lt;chr&gt; "Social and Work Psychology Department, University of Brasilia, DF, Brazil", "Social and Work Psycholog…
$ Language         &lt;chr&gt; "Portuguese", "Portuguese", "Portuguese", "English", "English", "English", "English", "English", "Engli…
$ Weird            &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0…
$ Execution        &lt;chr&gt; "illegal", "illegal", "illegal", "illegal", "illegal", "illegal", "illegal", "illegal", "illegal", "ill…
$ SubjectPool      &lt;chr&gt; "No", "No", "No", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "…
$ Setting          &lt;chr&gt; "In a classroom", "In a classroom", "In a classroom", "In a lab", "In a lab", "In a lab", "In a lab", "…
$ Tablet           &lt;chr&gt; "Computers", "Computers", "Computers", "Computers", "Computers", "Computers", "Computers", "Computers",…
$ Pencil           &lt;chr&gt; "No, the whole study was on the computer (except maybe consent/debriefing)", "No, the whole study was o…
$ StudyOrderN      &lt;chr&gt; "Hauser|Ross.Slate1|Rottenstrich|Graham|Kay|Inbar|Anderson|VanLange|Huang|Bauer|Critcher|Alter|Miyamoto…
$ IDiffOrderN      &lt;chr&gt; "ID: Global self-esteem SISE|ID: Mood|ID: Subjective wellbeing|ID: Disgust scale (slate 1 only -- for I…
$ study.order      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ analysis.type    &lt;chr&gt; "Order", "Order", "Order", "Order", "Order", "Order", "Order", "Order", "Order", "Order", "Order", "Ord…
$ subset           &lt;chr&gt; "all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "all"…
$ case.include     &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…
$ y                &lt;dbl&gt; 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0…
$ loc              &lt;fct&gt; 1, 1, 1, 2, 2, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 4, 3, 4, 4, 4, 4, 3, 3, 4, 4, 3, 5, 5, 5, 6, 6, 6…</code></pre>
</div>
</div>
<p>The total sample size is <span class="math inline">\(N = 6{,}842\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(uID) <span class="sc">|&gt;</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  6842</code></pre>
</div>
</div>
<p>All cases are to be included.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(case.include)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  case.include     n
  &lt;lgl&gt;        &lt;int&gt;
1 TRUE          6842</code></pre>
</div>
</div>
<p>The data were collected in 59 locations with sample sizes ranging from 34 to 325.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Location) <span class="sc">|&gt;</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dots</span>() <span class="sc">+</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"sample size, by location"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="our-effect-size-will-be-an-odds-ratio" class="level3" data-number="15.5.3">
<h3 data-number="15.5.3" class="anchored" data-anchor-id="our-effect-size-will-be-an-odds-ratio"><span class="header-section-number">15.5.3</span> Our effect size will be an odds ratio</h3>
<p>Here’s how Klein and colleagues summarized their primary results:</p>
<blockquote class="blockquote">
<p>In the aggregate replication sample <span class="math inline">\((N = 6,842\)</span> after removing participants who responded in less than <span class="math inline">\(4\)</span> s<span class="math inline">\(),\)</span> <span class="math inline">\(71\%\)</span> of participants judged the action in the foreseen-side-effect scenario as permissible, but only <span class="math inline">\(17\%\)</span> of participants in the greater-good scenario judged it as permissible. The difference between the percentages was significant, <span class="math inline">\(p = 2.2 \text e^{-16},\)</span> <span class="math inline">\(\text{OR} = 11.54,\)</span> <span class="math inline">\(d = 1.35,\)</span> <span class="math inline">\(95\% \; \text{CI} = [1.28, 1.41]\)</span>. The replication results were consistent with the double-effect hypothesis, and the effect was about half the magnitude of the original <span class="math inline">\((d = 1.35,\)</span> <span class="math inline">\(95\% \; \text{CI} = [1.28, 1.41],\)</span> vs.&nbsp;original <span class="math inline">\(d = 2.50)\)</span>. (p.&nbsp;459)</p>
</blockquote>
<p>Here is the breakdown of the outcome and primary experimental condition, which will confirm the two empirical percentages mentioned, above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(variable, factor) <span class="sc">|&gt;</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(factor) <span class="sc">|&gt;</span> </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   factor [2]
  variable factor          n percent
  &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt;
1 No       GreaterGood  2781    82.8
2 No       SideEffect   1026    29.4
3 Yes      GreaterGood   577    17.2
4 Yes      SideEffect   2458    70.6</code></pre>
</div>
</div>
<p>Though the authors presented their overall effect size with a <span class="math inline">\(p\)</span>-value, an odds-ratio (OR), and a Cohen’s <span class="math inline">\(d\)</span> (i.e., a kind of standardized mean difference), we will focus on the OR. The primary data are binomial counts, which are well-handled with logistic regression. When you perform a logistic regression where a control condition is compared with some experimental condition, the difference between those conditions may be expressed as an OR. To get a sense of what that is, we’ll first practice fitting a logistic regression model with the frequentist <code>glm()</code> function. Here are the results based on the subset of data from the first location.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>glm0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d <span class="sc">|&gt;</span> <span class="fu">filter</span>(loc <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> factor, <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ factor, family = binomial(logit), data = filter(d, 
    loc == 1))

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -1.5404     0.3673  -4.194 2.74e-05 ***
factorSideEffect   2.3232     0.4754   4.887 1.02e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 139.47  on 101  degrees of freedom
Residual deviance: 110.98  on 100  degrees of freedom
AIC: 114.98

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Just like with <strong>brms</strong>, the base-<strong>R</strong> <code>glm()</code> function returns the results of a logistic regression model in the log-odds metric. The intercept is the log-odds probability of selecting <em>yes</em> in the study for participants in the <code>GreaterGood</code> condition. The ‘factorSideEffect’ parameter is the difference in log-odds probability for participants in the <code>SideEffect</code> condition. Here’s what happens when you exponentiate that coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(glm0)[<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>factorSideEffect 
        10.20833 </code></pre>
</div>
</div>
<p>That, my friends, is an odds ratio (OR). <strong>Odds ratios are simply exponentiated logistic regression coefficients</strong>. The implication of this particular OR is that those in the <code>SideEffect</code> condition have about 10 times the odds of selecting <em>yes</em> compared to those in the <code>GreaterGood</code> condition. In the case of this subset of the data, that’s 18% yeses versus 69%, which seems like a large difference, to me.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(loc <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(variable, factor) <span class="sc">|&gt;</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(factor) <span class="sc">|&gt;</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">"Yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
# Groups:   factor [2]
  variable factor          n percent
  &lt;chr&gt;    &lt;chr&gt;       &lt;int&gt;   &lt;dbl&gt;
1 Yes      GreaterGood     9    17.6
2 Yes      SideEffect     35    68.6</code></pre>
</div>
</div>
</section>
<section id="log-odds-odds-ratios-and-modeling-effect-sizes" class="level3" data-number="15.5.4">
<h3 data-number="15.5.4" class="anchored" data-anchor-id="log-odds-odds-ratios-and-modeling-effect-sizes"><span class="header-section-number">15.5.4</span> Log-odds, odds ratios, and modeling effect sizes</h3>
<p>Though it’s common for researchers to express their effect sizes as odds ratios, we don’t want to work directly with odds ratios in a meta-analysis. <em>Why?</em> Well, think back on why we model binomial data with the logit link. The logit link transforms a bounded <span class="math inline">\([0, 1]\)</span> parameter space into an unbounded parameter space ranging from negative to positive infinity. For us Bayesians, it also provides a context in which our <span class="math inline">\(\beta\)</span> parameters are approximately Gaussian. However, when we exponentiate those approximately Gaussian log-odds coefficients, the resulting odds ratios aren’t so Gaussian any more. This is why, even if our ultimate goal is to express a meta-analytic effect as an OR, we want to work with effect sizes in the log-odds metric. It allows us to use the Bayesian meta-analytic framework outlined by Gelman and colleagues, above,</p>
<p><span class="math display">\[\begin{align*}
y_j      &amp; \sim \operatorname{Normal}(\theta_j, \sigma_j) \\
\theta_j &amp; \sim \operatorname{Normal}(\mu, \tau),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(y_j\)</span> is the point estimate in the <span class="math inline">\(j\)</span>th study still in the log-odds scale. After fitting the model, we can then exponentiate the meta-analytic parameter <span class="math inline">\(\mu\)</span> into the OR metric.</p>
</section>
<section id="compute-the-study-specific-effect-sizes" class="level3" data-number="15.5.5">
<h3 data-number="15.5.5" class="anchored" data-anchor-id="compute-the-study-specific-effect-sizes"><span class="header-section-number">15.5.5</span> Compute the study-specific effect sizes</h3>
<p>Our <code>d</code> data from the Klein et al replication study includes the un-aggregated data from all of the study locations combined. Before we compute our meta-analysis, we’ll need to compute the study-specific effect sizes and standard errors. Here we do so within a nested tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>glms <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(loc, y, factor) <span class="sc">|&gt;</span> </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(y, factor)) <span class="sc">|&gt;</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">glm =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">update</span>(glm0, <span class="at">data =</span> .))) <span class="sc">|&gt;</span> </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coef =</span> <span class="fu">map</span>(glm, tidy)) <span class="sc">|&gt;</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>glm) <span class="sc">|&gt;</span> </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coef) <span class="sc">|&gt;</span> </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"factorSideEffect"</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="co"># What did we do?</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>glms <span class="sc">|&gt;</span> </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 59 × 6
   loc   term             estimate std.error statistic p.value
   &lt;fct&gt; &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 1     factorSideEffect     2.32     0.475      4.89       0
 2 2     factorSideEffect     3.64     0.644      5.64       0
 3 3     factorSideEffect     2.37     0.399      5.96       0
 4 4     factorSideEffect     2.24     0.263      8.54       0
 5 5     factorSideEffect     2.02     0.505      4.00       0
 6 6     factorSideEffect     2.49     0.571      4.36       0
 7 7     factorSideEffect     2.53     0.658      3.84       0
 8 8     factorSideEffect     1.78     0.459      3.87       0
 9 9     factorSideEffect     1.81     0.378      4.79       0
10 10    factorSideEffect     2.37     0.495      4.79       0
# ℹ 49 more rows</code></pre>
</div>
</div>
<p>In the <code>estimate</code> column we have all the <span class="math inline">\(y_j\)</span> values and <code>std.error</code> contains the corresponding <span class="math inline">\(\sigma_j\)</span> values. Here they are in a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">5</span>]</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>glms <span class="sc">|&gt;</span> </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> std.error, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(sigma[<span class="fu">italic</span>(j)]<span class="sc">~</span>(<span class="st">"log-odds"</span>)),</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(y[j])<span class="sc">~</span>(<span class="st">"log-odds"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-the-bayesian-meta-analysis" class="level3" data-number="15.5.6">
<h3 data-number="15.5.6" class="anchored" data-anchor-id="fit-the-bayesian-meta-analysis"><span class="header-section-number">15.5.6</span> Fit the Bayesian meta-analysis</h3>
<p>Now are data are ready, we can express our first Bayesian meta-analysis with the formula</p>
<p><span class="math display">\[\begin{align*}
\text{estimate}_j &amp; \sim \operatorname{Normal}(\theta_j, \; \text{std.error}_j) \\
\theta_j   &amp; \sim \operatorname{Normal}(\mu, \tau) \\
\mu        &amp; \sim \operatorname{Normal}(0, 1.5) \\
\tau       &amp; \sim \operatorname{Exponential}(1),
\end{align*}\]</span></p>
<p>where the last two lines spell out our priors. As we learned in <a href="11.html#sec-Binomial-regression" class="quarto-xref"><span>Section 11.1</span></a>, the <span class="math inline">\(\operatorname{Normal}(0, 1.5)\)</span> prior in the log-odds space is just about flat on the probability space. If you wanted to be more conservative, consider something like <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span>. Here’s how to fit the model with <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glms, </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  estimate <span class="sc">|</span> <span class="fu">se</span>(std.error) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> loc),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>se()</code> is one of the <strong>brms</strong> helper functions designed to provide additional information about the criterion variable. Here it informs <code>brm()</code> that each <code>estimate</code> value has an associated measurement error defined in the <code>std.error</code> column. Unlike the <code>mi()</code> function, which we used earlier in the chapter to accommodate measurement error and the Bayesian imputation of missing data, the <code>se()</code> function is specially designed to handle meta-analyses. <code>se()</code> contains a <code>sigma</code> argument which is set to <code>FALSE</code> by default. This will return a model with no estimate for sigma, which is what we want. The uncertainty around the <code>estimate</code>-value for each study <span class="math inline">\(j\)</span> has already been encoded in the data as <code>std.error</code>.</p>
<p>Let’s look at the model results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: estimate | se(std.error) ~ 1 + (1 | loc) 
   Data: glms (Number of observations: 59) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~loc (Number of levels: 59) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.43      0.09     0.26     0.61 1.00     1574     2287

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     2.55      0.09     2.37     2.73 1.00     3511     3050

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Our estimate for heterogeneity across studies, <span class="math inline">\(\tau\)</span>, is about 0.4, suggesting modest differences across the studies. The meta-analytic effect, <span class="math inline">\(\mu\)</span>, is about 2.5. Both, recall, are in the log-odds metric. Here we exponentiate <span class="math inline">\(\mu\)</span> to get our odds ratio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b15<span class="fl">.10</span>)[, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimate     Q2.5    Q97.5 
12.75481 10.74502 15.27348 </code></pre>
</div>
</div>
<p>If you look back up to the results reported by Klein and colleagues, you’ll see this is rather close to their OR estimate of 11.54.</p>
</section>
<section id="sec-Fit-the-Bayesian-muiltilevel-alternative" class="level3" data-number="15.5.7">
<h3 data-number="15.5.7" class="anchored" data-anchor-id="sec-Fit-the-Bayesian-muiltilevel-alternative"><span class="header-section-number">15.5.7</span> Fit the Bayesian muiltilevel alternative</h3>
<p>We said earlier that meta-analysis is just a special case of the multilevel model, applied to summary data. We typically perform meta-analyses on data summaries because historically it has not been the norm among researchers to make their data publicly available. So effect size summaries were the best we typically had for aggregating study results. However, times are changing (e.g., <a href="https://www.apa.org/monitor/2017/11/trends-open-science.aspx">here</a>, <a href="https://www.blog.google/products/search/making-it-easier-discover-datasets/">here</a>). In this case, Klein and colleagues engaged in open-science practices and reported all their data. Thus we can just directly fit the model</p>
<p><span class="math display">\[\begin{align*}
\text{y}_{ij} &amp; \sim \operatorname{Binomial}(n = 1, p_{ij}) \\
\operatorname{logit}(p_{ij}) &amp; \sim \alpha + \beta \text{factor}_{ij} + u_{\alpha j} + u_{\beta j} \text{factor}_{ij} \\

\begin{bmatrix} u_{\alpha j} \\ u_{\beta j} \end{bmatrix} &amp; \sim \operatorname{MVNormal} \begin{pmatrix} \begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf{SRS} \end{pmatrix} \\

\mathbf S &amp; = \begin{bmatrix} \sigma_\alpha &amp; 0 \\ 0 &amp; \sigma_\beta \end{bmatrix} \\
\mathbf R &amp; = \begin{bmatrix} 0 &amp; \rho_{\alpha \beta} \\ \rho_{\beta \alpha} &amp; 0 \end{bmatrix} \\

\alpha &amp; \sim \operatorname{Normal}(0, 1.5) \\
\beta  &amp; \sim \operatorname{Normal}(0, 1.5) \\
\sigma_\alpha &amp; \sim \operatorname{Exponential}(1) \\
\sigma_\beta  &amp; \sim \operatorname{Exponential}(1) \\
\mathbf R &amp; \sim \operatorname{LKJ}(2),
\end{align*}\]</span></p>
<p>where the criterion variable, <span class="math inline">\(y\)</span>, is nested in <span class="math inline">\(i\)</span> participants within <span class="math inline">\(j\)</span> locations. The <span class="math inline">\(\beta\)</span> parameter is analogous to the meta-analytic effect (<span class="math inline">\(\mu\)</span>) and <span class="math inline">\(\sigma_\beta\)</span> is analogous to the expression of heterogeneity in the meta-analytic effect (<span class="math inline">\(\tau\)</span>). Here is how to fit the model with <strong>brms</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>b15<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d, </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> factor <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> factor <span class="sc">|</span> loc),</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">15</span>,</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits/b15.11"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results for the focal parameters are very similar to those from <code>b15.10</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b15<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: y | trials(1) ~ 0 + Intercept + factor + (1 + factor | loc) 
   Data: d (Number of observations: 6842) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~loc (Number of levels: 59) 
                                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)                       0.42      0.07     0.31     0.57 1.00     1555     2292
sd(factorSideEffect)                0.49      0.09     0.33     0.67 1.00      959     1845
cor(Intercept,factorSideEffect)    -0.32      0.19    -0.63     0.10 1.00     1343     2318

Regression Coefficients:
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept           -1.67      0.08    -1.82    -1.52 1.00     2018     2127
factorSideEffect     2.57      0.09     2.39     2.75 1.00     1864     1915

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Here’s the multilevel version of the effect size as an odds ratio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b15<span class="fl">.11</span>)[<span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimate     Q2.5    Q97.5 
13.03125 10.88212 15.71980 </code></pre>
</div>
</div>
<p>Here we compare the study specific effect sizes, <span class="math inline">\(\theta_j\)</span>, by our two modeling approaches.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">3</span>]</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># How many levels are there?</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>n_loc <span class="ot">&lt;-</span> <span class="fu">distinct</span>(d, loc) <span class="sc">|&gt;</span> <span class="fu">count</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(n)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank by meta-analysis</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>ranks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Estimate =</span> <span class="fu">coef</span>(b15<span class="fl">.10</span>)<span class="sc">$</span>loc[, <span class="dv">1</span>, <span class="st">"Intercept"</span>],</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">index    =</span> <span class="dv">1</span><span class="sc">:</span>n_loc) <span class="sc">|&gt;</span> </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="dv">1</span><span class="sc">:</span>n_loc)</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine parameter summaries</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">coef</span>(b15<span class="fl">.10</span>)<span class="sc">$</span>loc[, , <span class="st">"Intercept"</span>],</span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coef</span>(b15<span class="fl">.11</span>)<span class="sc">$</span>loc[, , <span class="st">"factorSideEffect"</span>]) <span class="sc">|&gt;</span> </span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_loc, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">type  =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"meta-analysis"</span>, <span class="st">"multilevel model"</span>), <span class="at">each =</span> n_loc)) <span class="sc">|&gt;</span> </span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the ranks</span></span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(ranks, <span class="sc">-</span>Estimate), </span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"index"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> rank)) <span class="sc">+</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> color, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(log<span class="sc">-</span>odds<span class="sc">~</span>effect<span class="sc">~</span>size<span class="sc">~</span>(theta[<span class="fu">italic</span>(j)])), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">4.5</span>)) <span class="sc">+</span></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The results are very similar. You might be curious how to show these results in a more conventional looking forest plot where the names of the groups (typically studies) for the <span class="math inline">\(\theta_j\)</span> values are listed on the left, the point estimate and 95% interval summaries are listed on the right, and the summary for the population level effect, <span class="math inline">\(\mu\)</span>, is listed beneath all all the <span class="math inline">\(\theta_j\)</span>’s. That’ll require some prep work. First we’ll need to reformat the location names. I’ll save the results in an object called <code>labs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lab =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Social and Work Psychology Department, University of Brasilia, DF, Brazil"</span> <span class="sc">~</span> <span class="st">"University of Brasilia"</span>,</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Wilfrid Laurier University, Waterloo, Ontario, Canada"</span> <span class="sc">~</span> <span class="st">"Wilfrid Laurier University"</span>,</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of British Columbia, Vancouver, Canada"</span> <span class="sc">~</span> <span class="st">"University of British Columbia"</span>,</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Toronto, Scarborough"</span> <span class="sc">~</span> <span class="st">"University of Toronto"</span>,</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Division of Social Science, The Hong Kong University of Science and Technology, Hong Kong, China"</span> <span class="sc">~</span> <span class="st">"Hong Kong University of Science and Technology"</span>,</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Chinese Academy of Science, Beijing, China"</span> <span class="sc">~</span> <span class="st">"Chinese Academy of Science"</span>,</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Shanghai International Studies University, SISU Intercultural Institute, Shanghai, China"</span> <span class="sc">~</span> <span class="st">"Shanghai International Studies University"</span>,</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Guangdong Literature &amp; Art Vocational College, Guangzhou, China"</span> <span class="sc">~</span> <span class="st">"Guangdong Literature &amp; Art Vocational College"</span>,</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"The University of J. E. Purkyně, Ústí nad Labem, Czech Republic"</span> <span class="sc">~</span> <span class="st">"The University of J. E. Purkyně"</span>,</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Leuven, Belgium"</span> <span class="sc">~</span> <span class="st">"University of Leuven"</span>,</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Experimental and Applied Psychology, VU Amsterdam, 1081BT, Amsterdam, The Netherlands"</span> <span class="sc">~</span> <span class="st">"VU Amsterdam"</span>,</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Social Psychology, Tilburg University, P.O. Box 90153, Tilburg, 5000 LE, Netherlands"</span> <span class="sc">~</span> <span class="st">"Department of Social Psychology, Tilburg University"</span>,</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Eindhoven University of Technology, Eindhoven, Netherlands"</span> <span class="sc">~</span> <span class="st">"Eindhoven University of Technology"</span>,</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Communication and Information Sciences, P.O. Box 90153, Tilburg, 5000 LE, Netherlands"</span> <span class="sc">~</span> <span class="st">"Department of Communication and Information Sciences, Tilburg University"</span>,</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Navarra, Spain"</span> <span class="sc">~</span> <span class="st">"University of Navarra"</span>,</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Lausanne, Switzerland"</span> <span class="sc">~</span> <span class="st">"University of Lausanne"</span>,</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Université de Poitiers, France"</span> <span class="sc">~</span> <span class="st">"Université de Poitiers"</span>,</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Eotvos Lorand University, in Budapest, Hungary"</span> <span class="sc">~</span> <span class="st">"Eotvos Lorand University"</span>,</span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"MTurk India Workers"</span> <span class="sc">~</span> <span class="st">"MTurk India Workers"</span>,</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Winchester, Winchester, Hampshire, England"</span> <span class="sc">~</span> <span class="st">"University of Winchester"</span>,</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Doshisha University, Kyoto, Japan"</span> <span class="sc">~</span> <span class="st">"Doshisha University"</span>,</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Victoria University of Wellington, New Zealand"</span> <span class="sc">~</span> <span class="st">"Victoria University of Wellington"</span>,</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Social Sciences and Humanities, Wroclaw, Poland"</span> <span class="sc">~</span> <span class="st">"University of Social Sciences and Humanities"</span>,</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, SWPS University of Social Sciences and Humanities Campus Sopot, Sopot, Poland"</span> <span class="sc">~</span> <span class="st">"SWPS University of Social Sciences and Humanities Campus Sopot"</span>,</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"badania.net"</span> <span class="sc">~</span> <span class="st">"badania.net"</span>,</span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Universidade do Porto, Portugal"</span> <span class="sc">~</span> <span class="st">"Universidade do Porto"</span>,</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Belgrade, Belgrade, Serbia"</span> <span class="sc">~</span> <span class="st">"University of Belgrade"</span>,</span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Johannesburg, Johanneburg, South Africa"</span> <span class="sc">~</span> <span class="st">"University of Johannesburg"</span>,</span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Santiago, Chile"</span> <span class="sc">~</span> <span class="st">"Santiago, Chile"</span>,</span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Universidad de Costa Rica, Costa Rica"</span> <span class="sc">~</span> <span class="st">"Universidad de Costa Rica"</span>,</span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"National Autonomous University of Mexico in Mexico City"</span> <span class="sc">~</span> <span class="st">"National Autonomous University of Mexico"</span>,</span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of the Republic, Montevideo, Uruguay"</span> <span class="sc">~</span> <span class="st">"University of the Republic"</span>,</span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Lund University, Lund, Sweden"</span> <span class="sc">~</span> <span class="st">"Lund University"</span>,</span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Academia Sinica, Taiwan National Taiwan Normal University, Taiwan"</span> <span class="sc">~</span> <span class="st">"Taiwan National Taiwan Normal University"</span>,</span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Bilgi University, Istanbul, Turkey"</span> <span class="sc">~</span> <span class="st">"Bilgi University"</span>,</span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Koç University, Istanbul, Turkey"</span> <span class="sc">~</span> <span class="st">"Koç University"</span>,</span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"American University of Sharjah, United Arab Emirates"</span> <span class="sc">~</span> <span class="st">"American University of Sharjah"</span>,</span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Hawaii, Honolulu, HI"</span> <span class="sc">~</span> <span class="st">"University of Hawaii"</span>,</span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Social Science and Policy Studies Department, Worcester Polytechnic Institute, Worcester, MA 01609"</span> <span class="sc">~</span> <span class="st">"Worcester Polytechnic Institute"</span>,</span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, Washington and Lee University, Lexington, VA 24450"</span> <span class="sc">~</span> <span class="st">"Washington and Lee University"</span>,</span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, San Diego State University, San Diego, CA 92182"</span> <span class="sc">~</span> <span class="st">"San Diego State University"</span>,</span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Tufts"</span> <span class="sc">~</span> <span class="st">"Tufts"</span>,</span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Florida, Florida"</span> <span class="sc">~</span> <span class="st">"University of Florida"</span>,</span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Illinois at Urbana-Champaign, Champaign, IL"</span> <span class="sc">~</span> <span class="st">"University of Illinois at Urbana-Champaign"</span>,</span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Pacific Lutheran University, Tacoma, WA"</span> <span class="sc">~</span> <span class="st">"Pacific Lutheran University"</span>,</span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Virginia, VA"</span> <span class="sc">~</span> <span class="st">"University of Virginia"</span>,</span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Marian University, Indianapolis, IN"</span> <span class="sc">~</span> <span class="st">"Marian University"</span>,</span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, Ithaca College, Ithaca, NY 14850"</span> <span class="sc">~</span> <span class="st">"Ithaca College"</span>,</span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Michigan"</span> <span class="sc">~</span> <span class="st">"University of Michigan"</span>,</span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, Pennsylvania State University Abington, Abington, PA 19001"</span> <span class="sc">~</span> <span class="st">"Pennsylvania State University Abington"</span>,</span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Psychology, Texas A&amp;M University, College Station, TX 77843"</span> <span class="sc">~</span> <span class="st">"Texas A&amp;M University"</span>,</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"William Paterson University, Wayne, NJ"</span> <span class="sc">~</span> <span class="st">"William Paterson University"</span>,</span>
<span id="cb148-55"><a href="#cb148-55" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Department of Cognitive Science, Occidental College, Los Angeles, CA"</span> <span class="sc">~</span> <span class="st">"Occidental College"</span>,</span>
<span id="cb148-56"><a href="#cb148-56" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"The Pennsylvania State University"</span> <span class="sc">~</span> <span class="st">"The Pennsylvania State University"</span>,</span>
<span id="cb148-57"><a href="#cb148-57" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"MTurk US Workers"</span> <span class="sc">~</span> <span class="st">"MTurk US Workers"</span>,</span>
<span id="cb148-58"><a href="#cb148-58" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Graz AND the Universty of Vienna"</span> <span class="sc">~</span> <span class="st">"University of Graz and the Universty of Vienna"</span>,</span>
<span id="cb148-59"><a href="#cb148-59" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"University of Potsdam, Germany"</span> <span class="sc">~</span> <span class="st">"University of Potsdam"</span>,</span>
<span id="cb148-60"><a href="#cb148-60" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Open University of Hong Kong"</span> <span class="sc">~</span> <span class="st">"Open University of Hong Kong"</span>,</span>
<span id="cb148-61"><a href="#cb148-61" aria-hidden="true" tabindex="-1"></a>    Location <span class="sc">==</span> <span class="st">"Concepción, Chile"</span> <span class="sc">~</span> <span class="st">"Concepción"</span></span>
<span id="cb148-62"><a href="#cb148-62" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb148-63"><a href="#cb148-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(loc, lab)</span>
<span id="cb148-64"><a href="#cb148-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-65"><a href="#cb148-65" aria-hidden="true" tabindex="-1"></a><span class="co"># What is this?</span></span>
<span id="cb148-66"><a href="#cb148-66" aria-hidden="true" tabindex="-1"></a>labs <span class="sc">|&gt;</span> </span>
<span id="cb148-67"><a href="#cb148-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 59
Columns: 2
$ loc &lt;fct&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 3…
$ lab &lt;chr&gt; "University of Brasilia", "Wilfrid Laurier University", "University of British Columbia", "University of Toronto", "…</code></pre>
</div>
</div>
<p>Now we’ll do some tricky wrangling with the output from <code>coef()</code> and <code>fixef()</code> to arrange the odds ratio summaries for the population average and the location-specific results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will help us format the labels on the secondary y-axis</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>my_format <span class="ot">&lt;-</span> <span class="cf">function</span>(number) {</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatC</span>(number, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">"f"</span>)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the theta_j summaries</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">coef</span>(b15<span class="fl">.11</span>)<span class="sc">$</span>loc[, , <span class="st">"factorSideEffect"</span>] <span class="sc">|&gt;</span> </span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loc =</span> <span class="fu">distinct</span>(d, loc) <span class="sc">|&gt;</span> <span class="fu">pull</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Estimate)</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the mu summary</span></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>average <span class="ot">&lt;-</span> <span class="fu">fixef</span>(b15<span class="fl">.11</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loc =</span> <span class="st">"Average"</span>)</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and wrangle</span></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(groups, average) <span class="sc">|&gt;</span> </span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank     =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">59</span>, <span class="dv">0</span>),</span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">Estimate =</span> <span class="fu">exp</span>(Estimate),</span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q2.5     =</span> <span class="fu">exp</span>(Q2<span class="fl">.5</span>),</span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Q97.5    =</span> <span class="fu">exp</span>(Q97<span class="fl">.5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(labs, <span class="at">by =</span> <span class="st">"loc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rank) <span class="sc">|&gt;</span> </span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label   =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(lab), <span class="st">"POPULATION AVERAGE"</span>, lab),</span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> <span class="fu">str_c</span>(<span class="fu">my_format</span>(Estimate), <span class="st">" ["</span>, <span class="fu">my_format</span>(Q2<span class="fl">.5</span>), <span class="st">", "</span>, <span class="fu">my_format</span>(Q97<span class="fl">.5</span>), <span class="st">"]"</span>))</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="co"># What have we done?</span></span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>post <span class="sc">|&gt;</span> </span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 60
Columns: 9
$ Estimate  &lt;dbl&gt; 13.031252, 5.993160, 7.120835, 7.909707, 7.911516, 7.974898, 8.176425, 8.497452, 8.612409, 8.624163, 9.468991,…
$ Est.Error &lt;dbl&gt; 0.09276243, 0.23584341, 0.35278999, 0.33377328, 0.36358500, 0.23316401, 0.33742529, 0.31857643, 0.34481692, 0.…
$ Q2.5      &lt;dbl&gt; 10.882119, 3.855201, 3.484971, 4.061792, 3.810479, 5.119782, 4.151619, 4.551310, 4.327285, 4.655110, 4.920004,…
$ Q97.5     &lt;dbl&gt; 15.719796, 9.591853, 13.626337, 15.052954, 15.904785, 12.460087, 15.742125, 15.735170, 16.899349, 15.363993, 1…
$ loc       &lt;chr&gt; "Average", "19", "38", "8", "32", "55", "5", "34", "22", "9", "6", "58", "24", "7", "50", "15", "4", "11", "23…
$ rank      &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, …
$ lab       &lt;chr&gt; NA, "MTurk India Workers", "University of Hawaii", "Guangdong Literature &amp; Art Vocational College", "Universit…
$ label     &lt;chr&gt; "POPULATION AVERAGE", "MTurk India Workers", "University of Hawaii", "Guangdong Literature &amp; Art Vocational Co…
$ summary   &lt;chr&gt; "13.03 [10.88, 15.72]", "5.99 [3.86, 9.59]", "7.12 [3.48, 13.63]", "7.91 [4.06, 15.05]", "7.91 [3.81, 15.90]",…</code></pre>
</div>
</div>
<p>Here’s our custom forest plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">|&gt;</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> rank)) <span class="sc">+</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_interval</span>(<span class="fu">aes</span>(<span class="at">color =</span> label <span class="sc">==</span> <span class="st">"POPULATION AVERAGE"</span>),</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="dv">1</span> <span class="sc">-</span> Est.Error, <span class="at">color =</span> label <span class="sc">==</span> <span class="st">"POPULATION AVERAGE"</span>),</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"odds ratio"</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.005</span>))) <span class="sc">+</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">59</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">60</span>),</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">pull</span>(post, label),</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">labels =</span> <span class="fu">pull</span>(post, summary))) <span class="sc">+</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"C"</span>, <span class="at">begin =</span> <span class="fl">0.33</span>, <span class="at">end =</span> <span class="fl">0.67</span>) <span class="sc">+</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">3.5</span>)) <span class="sc">+</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y.right =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey8"</span>),</span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>You may have noticed this plot is based on the results of our multilevel model, <code>b15.11</code>. We could have done the same basic thing with the results from the more conventional meta-analysis model, <code>b15.10</code>, too.</p>
<p>I’m not aware this it typical in random effect meta-analyses, but it might be useful to further clarify the meaning of the two primary parameters, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>. Like with the forest plot, above, we could examine these with either <code>b15.10</code> or <code>b15.11</code>. For kicks, we’ll use <code>b15.10</code> (the conventional Bayesian meta-analysis). In the output from <code>as_draws_df(b15.10)</code>, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> are in the columns named <code>b_Intercept</code> and <code>sd_loc__Intercept</code>, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b15<span class="fl">.10</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">|&gt;</span> </span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sd_loc__Intercept) <span class="sc">|&gt;</span> </span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  b_Intercept sd_loc__Intercept
        &lt;dbl&gt;             &lt;dbl&gt;
1        2.58             0.448
2        2.48             0.293
3        2.59             0.246
4        2.60             0.322
5        2.57             0.452
6        2.42             0.491</code></pre>
</div>
</div>
<p>If you scroll back above, you’ll see our random effect meta-analysis explicitly presumed our empirical effect-size estimates <span class="math inline">\(y_j\)</span> are approximations of the true effect sizes <span class="math inline">\(\theta_j\)</span>, which are themselves normally distributed in the population of possible effect sizes from similar studies: <span class="math inline">\(\theta_j \sim \operatorname{Normal}(\mu, \tau)\)</span>. Why not use our posterior draws to simulate draws from <span class="math inline">\(\operatorname{Normal}(\mu, \tau)\)</span> to get a sense of what this distribution might look like? Recall that the parameters are in the log-odds metric. We’ll present the distribution in that metric and as odds ratios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">6</span>]</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>post <span class="sc">|&gt;</span> </span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">lo =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sd_loc__Intercept),</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">or =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sd_loc__Intercept) <span class="sc">|&gt;</span> <span class="fu">exp</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="fl">1e3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(lo<span class="sc">:</span>or, <span class="at">values_to =</span> <span class="st">"effect size"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"log-odds"</span>, <span class="st">"odds ratio"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">effect size</span><span class="st">`</span>, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dots</span>(<span class="at">color =</span> color, <span class="at">fill =</span> color) <span class="sc">+</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">Normal</span>(mu<span class="sc">*</span><span class="st">', '</span><span class="sc">*</span>tau))) <span class="sc">+</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>),</span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"transparent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both panels show 1,000 draws, each of which is depicted by a single dot. If we were to run this experiment 1,000 times and compute the effect size separately for each one, this is what we’d expect those distributions of effect sizes to look like. Seems like there’s a lot of variation in there, eh? The next time you observe your fellow scientists debating over whether a study replicated or not, keep these distributions in mind. Once you start thinking about distributions, replication becomes a tricky notion.</p>
</section>
<section id="relative-to-the-muiltilevel-model-meta-analyses-have-limitations" class="level3" data-number="15.5.8">
<h3 data-number="15.5.8" class="anchored" data-anchor-id="relative-to-the-muiltilevel-model-meta-analyses-have-limitations"><span class="header-section-number">15.5.8</span> Relative to the muiltilevel model, meta-analyses have limitations</h3>
<p>Although the Bayesian meta-analysis and multilevel models produced very similar results for the effect size, the two are not equivalent. Because the meta-analysis was based on summary information from the effect sizes along, it does not offer all of the insights available from the multilevel model. Other than the random effects, the only population parameters offered by the meta-analysis are the effect size, <span class="math inline">\(\mu\)</span>, and the standard deviation around that effect size, <span class="math inline">\(\tau\)</span>. These parameters are equivalent to our multilevel model parameters <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma_\beta\)</span>, respectively. In addition, the multilevel model added group-level parameter for the average performance in the control condition, <span class="math inline">\(\alpha\)</span>, the population-level standard deviation around that mean, <span class="math inline">\(\sigma_\alpha\)</span>, and the correlation between the group-specific <span class="math inline">\(\alpha_j\)</span>’s and <span class="math inline">\(\beta_j\)</span>’s, which we called <span class="math inline">\(\rho_{\alpha \beta}\)</span>.</p>
<p>To build a sense of why we might to want these parameters, too, we’ll extract the posterior draws for the multilevel model <code>b15.11</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b15<span class="fl">.11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we’ll make a scatter plot the posterior means of the random intercepts, <span class="math inline">\(\alpha_j\)</span>’s, and the random slopes, <span class="math inline">\(\beta_j\)</span>’s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="st">"C"</span>)(<span class="dv">7</span>)[<span class="dv">7</span>]</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercepts</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">|&gt;</span> </span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">r_loc[1,Intercept]</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">r_loc[59,Intercept]</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">59</span>) <span class="sc">|&gt;</span> </span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">values_to =</span> <span class="st">"intercepts"</span>),</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Slopes</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">|&gt;</span> </span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">r_loc[1,factorSideEffect]</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">r_loc[59,factorSideEffect]</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">59</span>) <span class="sc">|&gt;</span> </span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">values_to =</span> <span class="st">"slopes"</span>),</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"iter"</span>, <span class="st">"name"</span>)</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by the means</span></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>c <span class="sc">|&gt;</span> </span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">intercepts =</span> <span class="fu">mean</span>(intercepts),</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">slopes =</span> <span class="fu">mean</span>(slopes)) <span class="sc">|&gt;</span> </span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot</span></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intercepts, <span class="at">y =</span> slopes)) <span class="sc">+</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(alpha[<span class="fu">italic</span>(j)]),</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(beta[<span class="fu">italic</span>(j)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>This provides some information, which we wouldn’t get from a meta-analysis. However, the plot is a little deceiving. First, it doesn’t provide an expression of the uncertainty on the effects. Second, it doesn’t give full justice to the correlation between the two effects, <span class="math inline">\(\rho_{\alpha \beta}\)</span>. If you look back up at the <code>print()</code> output from <a href="#sec-Fit-the-Bayesian-muiltilevel-alternative" class="quarto-xref"><span>Section 15.5.7</span></a>, you’ll see that correlation was about -0.32. We can take some cues from <a href="14.html#sec-Social-relations-as" class="quarto-xref"><span>Section 14.4</span></a> and express the bivariate posteriors as ellipses, rather than simple mean-level points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>c <span class="sc">|&gt;</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intercepts, <span class="at">y =</span> slopes)) <span class="sc">+</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="fu">aes</span>(<span class="at">group =</span> name),</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">"polygon"</span>, </span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">fill =</span> color, </span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">level =</span> <span class="fl">0.05</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(alpha[<span class="fu">italic</span>(j)]),</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(beta[<span class="fu">italic</span>(j)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="312"></p>
</figure>
</div>
</div>
</div>
<p>The small semitransparent ellipses depict the inner-most 5% of each of the <span class="math inline">\(j\)</span>-level bivariate posteriors. The larger ellipse is the 95% boundary, collapsing across all levels of <span class="math inline">\(j\)</span>. Both kinds of summaries help depict the negative correlation between the <span class="math inline">\(\alpha_j\)</span>’s and <span class="math inline">\(\beta_j\)</span>’s. That negative correlation means suggests the studies which had larger effect sizes for the control condition tended to have smaller effect sizes for the experimental condition. There’s no way you would know that from the meta-analysis approach.</p>
<p>Another way to explore the relation between the model intercepts and slopes is to plot their implications on the probability scale. The way we parameterized the model, the greater-good condition is expressed the <span class="math inline">\(\alpha_j\)</span> and the side-effect condition is expressed as <span class="math inline">\(\alpha_j + \beta_j\)</span>. If we were working directly with the <code>as_draws_df()</code> output, we’d have to do fancy conversions with the <code>plogis()</code> function. An easier way is to just use <code>fitted()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">plogis</span>(<span class="fu">c</span>(<span class="fu">fixef</span>(b15<span class="fl">.11</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="fu">fixef</span>(b15<span class="fl">.11</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">fixef</span>(b15<span class="fl">.11</span>)[<span class="dv">2</span>, <span class="dv">1</span>])), <span class="dv">1</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">distinct</span>(loc, factor)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b15<span class="fl">.11</span>, <span class="at">newdata =</span> nd) <span class="sc">|&gt;</span> </span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">|&gt;</span> </span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">factor =</span> <span class="fu">if_else</span>(factor <span class="sc">==</span> <span class="st">"SideEffect"</span>, <span class="st">"Side effect"</span>, <span class="st">"Greater good"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> factor, <span class="at">y =</span> Estimate, <span class="at">group =</span> loc)) <span class="sc">+</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> color) <span class="sc">+</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"probability"</span>, <span class="at">breaks =</span> breaks,</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">round</span>(breaks, <span class="at">digits =</span> <span class="dv">2</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>Each of the 59 levels of our grouping variable <code>loc</code> is depicted in one of those 59 lines. Sadly, this approach doesn’t do a good job expressing the uncertainty in those lines. Each one is based on the posterior mean. Regardless, this plot offers more insights that were not available from the meta-analysis.</p>
</section>
<section id="parting-thoughts" class="level3" data-number="15.5.9">
<h3 data-number="15.5.9" class="anchored" data-anchor-id="parting-thoughts"><span class="header-section-number">15.5.9</span> Parting thoughts</h3>
<p>There are other things you might do with these data. For example, you might inspect how much the effect size varies between those from WEIRD and non-WEIRD countries. You might also model the data as clustered by <code>Language</code> rather than by <code>Location</code>. But I think we’ve gone far enough to get you started.</p>
<p>If you’d like to learn more about these methods, do check out Vourre’s <a href="https://mvuorre.github.io/posts/2016-09-29-bayesian-meta-analysis/"><em>Bayesian meta-analysis with R, Stan, and brms</em></a>. You might also read Williams, Rast, and Bürkner’s <span class="citation" data-cites="williamsBayesianMetaanalysisWeakly2018">(<a href="references.html#ref-williamsBayesianMetaanalysisWeakly2018" role="doc-biblioref">2018</a>)</span> manuscript, <a href="https://psyarxiv.com/7tbrm/"><em>Bayesian meta-analysis with weakly informative prior distributions</em></a>. For an alternative workflow, consider the <a href="https://github.com/wwiecek/baggr"><strong>baggr</strong> package</a> <span class="citation" data-cites="R-baggr">(<a href="references.html#ref-R-baggr" role="doc-biblioref">Wiecek &amp; Meager, 2022</a>)</span>, which is designed to fit hierarchical Bayesian meta-analyses with Stan under the hood. Also, I’m not aware that <strong>brms</strong> currently offers a convenient way to fit a meta-analysis model that takes selection bias into account. However, the thread in the Stan forums called <a href="https://discourse.mc-stan.org/t/bayesian-random-effects-meta-analysis-with-selection-models-publication-bias/21419"><em>Bayesian random-effects meta-analysis with selection models (publication bias)</em></a> provides the Stan code for such a model.</p>
</section>
</section>
<section id="session-info" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Ventura 13.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] broom_1.0.10      tidybayes_3.0.7   ggrepel_0.9.6     brms_2.23.0       Rcpp_1.1.0        ggdag_0.2.13      patchwork_1.3.2  
 [8] viridis_0.6.5     viridisLite_0.4.2 lubridate_1.9.4   forcats_1.0.1     stringr_1.6.0     dplyr_1.1.4       purrr_1.2.1      
[15] readr_2.1.5       tidyr_1.3.2       tibble_3.3.1      ggplot2_4.0.1     tidyverse_2.0.0  

loaded via a namespace (and not attached):
 [1] gridExtra_2.3           inline_0.3.21           sandwich_3.1-1          rlang_1.1.7             magrittr_2.0.4         
 [6] multcomp_1.4-29         matrixStats_1.5.0       compiler_4.5.1          loo_2.9.0.9000          vctrs_0.6.5            
[11] reshape2_1.4.5          quadprog_1.5-8          crayon_1.5.3            pkgconfig_2.0.3         arrayhelpers_1.1-0     
[16] fastmap_1.2.0           backports_1.5.0         labeling_0.4.3          ggraph_2.2.2            utf8_1.2.6             
[21] rmarkdown_2.30          tzdb_0.5.0              bit_4.6.0               xfun_0.55               cachem_1.1.0           
[26] jsonlite_2.0.0          tweenr_2.0.3            parallel_4.5.1          R6_2.6.1                stringi_1.8.7          
[31] RColorBrewer_1.1-3      StanHeaders_2.36.0.9000 boot_1.3-31             estimability_1.5.1      assertthat_0.2.1       
[36] rstan_2.36.0.9000       knitr_1.51              zoo_1.8-14              bayesplot_1.15.0.9000   Matrix_1.7-3           
[41] splines_4.5.1           igraph_2.2.0            timechange_0.3.0        tidyselect_1.2.1        rstudioapi_0.17.1      
[46] abind_1.4-8             yaml_2.3.12             codetools_0.2-20        curl_7.0.0              dagitty_0.3-4          
[51] pkgbuild_1.4.8          lattice_0.22-7          plyr_1.8.9              withr_3.0.2             bridgesampling_1.2-1   
[56] S7_0.2.1                posterior_1.6.1.9000    coda_0.19-4.1           evaluate_1.0.5          survival_3.8-3         
[61] RcppParallel_5.1.11-1   polyclip_1.10-7         ggdist_3.3.3            pillar_1.11.1           tensorA_0.36.2.1       
[66] checkmate_2.3.3         stats4_4.5.1            distributional_0.5.0    generics_0.1.4          vroom_1.6.6            
[71] hms_1.1.4               rstantools_2.5.0.9000   scales_1.4.0            xtable_1.8-4            emo_0.0.0.9000         
[76] glue_1.8.0              emmeans_1.11.2-8        tools_4.5.1             mvtnorm_1.3-3           graphlayouts_1.2.2     
[81] tidygraph_1.3.1         grid_4.5.1              QuickJSR_1.8.1          nlme_3.1-168            ggforce_0.5.0          
[86] cli_3.6.5               svUnit_1.0.8            Brobdingnag_1.2-9       V8_8.0.1                gtable_0.3.6           
[91] digest_0.6.39           TH.data_1.1-4           htmlwidgets_1.6.4       farver_2.1.2            memoise_2.0.1          
[96] htmltools_0.5.9         lifecycle_1.0.5         bit64_4.6.0-1           MASS_7.3-65            </code></pre>
</div>
</div>
</section>
<section id="comments" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="comments">Comments</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-baraldiIntroductionToModernMissingData2010" class="csl-entry" role="listitem">
Baraldi, A. N., &amp; Enders, C. K. (2010). An introduction to modern missing data analyses. <em>Journal of School Psychology</em>, <em>48</em>(1), 5–37. <a href="https://doi.org/10.1016/j.jsp.2009.10.001">https://doi.org/10.1016/j.jsp.2009.10.001</a>
</div>
<div id="ref-beheim2021TreatmentOfMissingData" class="csl-entry" role="listitem">
Beheim, B., Atkinson, Q. D., Bulbulia, J., Gervais, W., Gray, R. D., Henrich, J., Lang, M., Monroe, M. W., Muthukrishna, M., Norenzayan, A., et al. (2021). Treatment of missing data determined conclusions regarding moralizing gods. <em>Nature</em>, <em>595</em>(7866), E29–E34. <a href="https://doi.org/10.1038/s41586-019-1043-4">https://doi.org/10.1038/s41586-019-1043-4</a>
</div>
<div id="ref-Bürkner2022Multivariate" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022a). <em>Estimating multivariate models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html">https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html</a>
</div>
<div id="ref-Bürkner2022HandleMissingValues" class="csl-entry" role="listitem">
Bürkner, P.-C. (2022b). <em>Handle missing values with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_missings.html">https://CRAN.R-project.org/package=brms/vignettes/brms_missings.html</a>
</div>
<div id="ref-enders2022applied" class="csl-entry" role="listitem">
Enders, C. K. (2022). <em>Applied missing data analysis</em> (Second Edition). Guilford Press. <a href="http://www.appliedmissingdata.com/">http://www.appliedmissingdata.com/</a>
</div>
<div id="ref-R-viridis" class="csl-entry" role="listitem">
Garnier, S. (2021). <em><span class="nocase">viridis</span>: <span>Default</span> color maps from ’matplotlib’</em> [Manual]. <a href="https://CRAN.R-project.org/package=viridis">https://CRAN.R-project.org/package=viridis</a>
</div>
<div id="ref-gelman2013bayesian" class="csl-entry" role="listitem">
Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. (2013). <em>Bayesian data analysis</em> (Third Edition). CRC press. <a href="https://stat.columbia.edu/~gelman/book/">https://stat.columbia.edu/~gelman/book/</a>
</div>
<div id="ref-R-ggdark" class="csl-entry" role="listitem">
Grantham, N. (2019). <em><span class="nocase">ggdark</span>: <span>Dark</span> mode for ’ggplot2’ themes</em> [Manual]. <a href="https://CRAN.R-project.org/package=ggdark">https://CRAN.R-project.org/package=ggdark</a>
</div>
<div id="ref-hauserDissociationMoralJudgments2007" class="csl-entry" role="listitem">
Hauser, M., Cushman, F., Young, L., Jin, R. K.-X., &amp; Mikhail, J. (2007). A dissociation between moral judgments and justifications. <em>Mind &amp; Language</em>, <em>22</em>(1), 1–21. <a href="https://doi.org/10.1111/j.1468-0017.2006.00297.x">https://doi.org/10.1111/j.1468-0017.2006.00297.x</a>
</div>
<div id="ref-kleinManyLabsInvestigating2018" class="csl-entry" role="listitem">
Klein, R. A., Vianello, M., Hasselman, F., Adams, B. G., Adams, R. B., Alper, S., Aveyard, M., Axt, J. R., Babalola, M. T., Bahník, Š., Batra, R., Berkics, M., Bernstein, M. J., Berry, D. R., Bialobrzeska, O., Binan, E. D., Bocian, K., Brandt, M. J., Busching, R., … Nosek, B. A. (2018). Many <span>Labs</span> 2: <span>Investigating</span> variation in replicability across samples and settings. <em>Advances in Methods and Practices in Psychological Science</em>, <em>1</em>(4), 443–490. <a href="https://doi.org/10.1177/2515245918810225">https://doi.org/10.1177/2515245918810225</a>
</div>
<div id="ref-littleStatisticalAnalysisMissing2019" class="csl-entry" role="listitem">
Little, R. J. A., &amp; Rubin, D. B. (2019). <em>Statistical analysis with missing data</em>. John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Statistical+Analysis+with+Missing+Data%2C+3rd+Edition-p-9780470526798">https://www.wiley.com/en-us/Statistical+Analysis+with+Missing+Data%2C+3rd+Edition-p-9780470526798</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry" role="listitem">
McElreath, R. (2020). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-rubinInferenceAndMissingData1976" class="csl-entry" role="listitem">
Rubin, Donald B. (1976). Inference and missing data. <em>Biometrika</em>, <em>63</em>(3), 581–592. <a href="https://doi.org/10.1093/biomet/63.3.581">https://doi.org/10.1093/biomet/63.3.581</a>
</div>
<div id="ref-rubinMultipleImputationNonresponse1987" class="csl-entry" role="listitem">
Rubin, Donald B. (1987). <em>Multiple imputation for nonresponse in surveys</em>. John Wiley &amp; Sons Inc. <a href="https://doi.org/10.1002/9780470316696">https://doi.org/10.1002/9780470316696</a>
</div>
<div id="ref-rubinMultipleImputation181996" class="csl-entry" role="listitem">
Rubin, Donald B. (1996). Multiple imputation after 18+ years. <em>Journal of the American Statistical Association</em>, <em>91</em>(434), 473–489. <a href="https://doi.org/10.1080/01621459.1996.10476908">https://doi.org/10.1080/01621459.1996.10476908</a>
</div>
<div id="ref-rudisViridisColorPalettes2018" class="csl-entry" role="listitem">
Rudis, B., Ross, N., &amp; Garnier, S. (2018). <em>The viridis color palettes</em>. <a href="https://cran.r-project.org/package=viridis/vignettes/intro-to-viridis.html">https://cran.r-project.org/package=viridis/vignettes/intro-to-viridis.html</a>
</div>
<div id="ref-vanbuurenFlexibleImputationMissing2018" class="csl-entry" role="listitem">
van Buuren, S. (2018). <em>Flexible imputation of missing data</em> (Second Edition). CRC Press. <a href="https://stefvanbuuren.name/fimd/">https://stefvanbuuren.name/fimd/</a>
</div>
<div id="ref-whitehouseComplexSocietiesPrecede2019" class="csl-entry" role="listitem">
Whitehouse, H., François, P., Savage, P. E., Currie, T. E., Feeney, K. C., Cioni, E., Purcell, R., Ross, R. M., Larson, J., Baines, J., ter Haar, B., Covey, A., &amp; Turchin, P. (2019). Complex societies precede moralizing gods throughout world history. <em>Nature</em>, <em>568</em>(7751), 226–229. <a href="https://doi.org/10.1038/s41586-019-1043-4">https://doi.org/10.1038/s41586-019-1043-4</a>
</div>
<div id="ref-R-baggr" class="csl-entry" role="listitem">
Wiecek, W., &amp; Meager, R. (2022). <em><span class="nocase">baggr</span>: <span>Bayesian</span> aggregate treatment effects</em> [Manual]. <a href="https://CRAN.R-project.org/package=baggr">https://CRAN.R-project.org/package=baggr</a>
</div>
<div id="ref-williamsBayesianMetaanalysisWeakly2018" class="csl-entry" role="listitem">
Williams, D. R., Rast, P., &amp; Bürkner, P.-C. (2018). <em>Bayesian meta-analysis with weakly informative prior distributions</em>. <a href="https://doi.org/10.31234/osf.io/7tbrm">https://doi.org/10.31234/osf.io/7tbrm</a>
</div>
</div>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed";
    script.dataset.repoId = "";
    script.dataset.category = "General";
    script.dataset.categoryId = "";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./14.html" class="pagination-link" aria-label="Adventures in Covariance">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./16.html" class="pagination-link" aria-label="Generalized Linear Madness">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Generalized Linear Madness</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>