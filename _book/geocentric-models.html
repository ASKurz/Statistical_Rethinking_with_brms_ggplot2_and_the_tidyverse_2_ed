<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sampling-the-imaginary.html"/>
<link rel="next" href="the-many-variables-the-spurious-waffles.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet" />
<script src="libs/twitter-widget-0.0.1/widgets.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.1."><i class="fa fa-check"></i>Version 0.1.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.3.0."><i class="fa fa-check"></i>Version 0.3.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.4.0."><i class="fa fa-check"></i>Version 0.4.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#were-not-done-yet-and-i-could-use-your-help."><i class="fa fa-check"></i>We’re not done yet and I could use your help.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression."><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression.</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-first-bonus-smooth-functions-with-brmss"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> First bonus: Smooth functions with <code>brms::s()</code></a></li>
<li class="chapter" data-level="4.7" data-path="geocentric-models.html"><a href="geocentric-models.html#second-bonus-group-predictors-with-matrix-columns"><i class="fa fa-check"></i><b>4.7</b> Second bonus: Group predictors with matrix columns</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#summary-bonus-we-can-model-categorical-variables-in-more-ways-than-one"><i class="fa fa-check"></i><b>5.4</b> <del>Summary</del> Bonus: We can model categorical variables in more ways than one</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#you-can-use-a-dummy."><i class="fa fa-check"></i><b>5.4.1</b> You can use a dummy.</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#consider-contrast-coding."><i class="fa fa-check"></i><b>5.4.2</b> Consider contrast coding.</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#theres-always-the-multilevel-anova-approach."><i class="fa fa-check"></i><b>5.4.3</b> There’s always the multilevel ANOVA approach.</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#would-you-like-to-learn-more"><i class="fa fa-check"></i><b>5.4.4</b> Would you like to learn more?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
<li class="chapter" data-level="7.4.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria."><i class="fa fa-check"></i><b>7.4.2</b> Information criteria.</a></li>
<li class="chapter" data-level="7.4.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.4.3</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.5</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.5.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.5.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.5.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>7.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#another-parable."><i class="fa fa-check"></i><b>9.3.1</b> Another parable.</a></li>
<li class="chapter" data-level="9.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#particles-in-space."><i class="fa fa-check"></i><b>9.3.2</b> Particles in space.</a></li>
<li class="chapter" data-level="9.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.3</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to outcomes.</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.2</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#bonus-survival-analysis"><i class="fa fa-check"></i><b>11.5</b> Bonus: Survival analysis</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#survival-summary."><i class="fa fa-check"></i><b>11.5.1</b> Survival summary.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>15.1</b> Measurement error</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>15.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="15.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>15.1.2</b> Error on both outcome and predictor.</a></li>
<li class="chapter" data-level="15.1.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-terrors."><i class="fa fa-check"></i><b>15.1.3</b> Measurement terrors.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>15.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#dag-ate-my-homework."><i class="fa fa-check"></i><b>15.2.1</b> DAG ate my homework.</a></li>
<li class="chapter" data-level="15.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-primates."><i class="fa fa-check"></i><b>15.2.2</b> Imputing primates.</a></li>
<li class="chapter" data-level="15.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#where-is-your-god-now"><i class="fa fa-check"></i><b>15.2.3</b> Where is your god now?</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>15.3</b> Categorical errors and discrete absences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#discrete-cats."><i class="fa fa-check"></i><b>15.3.1</b> Discrete cats.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-bayesian-meta-analysis-with-odds-ratios"><i class="fa fa-check"></i><b>15.5</b> Bonus: Bayesian meta-analysis with odds ratios</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#how-do-meta-analyses-fit-into-the-picture"><i class="fa fa-check"></i><b>15.5.1</b> How do meta-analyses fit into the picture?</a></li>
<li class="chapter" data-level="15.5.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#we-need-some-data."><i class="fa fa-check"></i><b>15.5.2</b> We need some data.</a></li>
<li class="chapter" data-level="15.5.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#our-effect-size-will-be-an-odds-ratio."><i class="fa fa-check"></i><b>15.5.3</b> Our effect size will be an odds ratio.</a></li>
<li class="chapter" data-level="15.5.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#log-odds-odds-ratios-and-modeling-effect-sizes."><i class="fa fa-check"></i><b>15.5.4</b> Log-odds, odds ratios, and modeling effect sizes.</a></li>
<li class="chapter" data-level="15.5.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#compute-the-study-specific-effect-sizes."><i class="fa fa-check"></i><b>15.5.5</b> Compute the study-specific effect sizes.</a></li>
<li class="chapter" data-level="15.5.6" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-meta-analysis."><i class="fa fa-check"></i><b>15.5.6</b> Fit the Bayesian meta-analysis.</a></li>
<li class="chapter" data-level="15.5.7" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-muiltilevel-alternative."><i class="fa fa-check"></i><b>15.5.7</b> Fit the Bayesian muiltilevel alternative.</a></li>
<li class="chapter" data-level="15.5.8" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#relative-to-the-muiltilevel-model-meta-analyses-have-limitations."><i class="fa fa-check"></i><b>15.5.8</b> Relative to the muiltilevel model, meta-analyses have limitations.</a></li>
<li class="chapter" data-level="15.5.9" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#parting-thoughts."><i class="fa fa-check"></i><b>15.5.9</b> Parting thoughts.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#geometric-people"><i class="fa fa-check"></i><b>16.1</b> Geometric people</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model."><i class="fa fa-check"></i><b>16.1.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.1.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model."><i class="fa fa-check"></i><b>16.1.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.1.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#glm-in-disguise."><i class="fa fa-check"></i><b>16.1.3</b> GLM in disguise.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>16.2</b> Hidden minds and observed behavior</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-1"><i class="fa fa-check"></i><b>16.2.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.2.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-1"><i class="fa fa-check"></i><b>16.2.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.2.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#coding-the-statistical-model."><i class="fa fa-check"></i><b>16.2.3</b> Coding the statistical model.</a></li>
<li class="chapter" data-level="16.2.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#state-space-models."><i class="fa fa-check"></i><b>16.2.4</b> State space models.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>16.3</b> Ordinary differential nut cracking</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#scientific-model."><i class="fa fa-check"></i><b>16.3.1</b> Scientific model.</a></li>
<li class="chapter" data-level="16.3.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#statistical-model."><i class="fa fa-check"></i><b>16.3.2</b> Statistical model.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#population-dynamics"><i class="fa fa-check"></i><b>16.4</b> Population dynamics</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-2"><i class="fa fa-check"></i><b>16.4.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.4.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-2"><i class="fa fa-check"></i><b>16.4.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.4.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#lynx-lessons-bonus-practice-with-the-autoregressive-model."><i class="fa fa-check"></i><b>16.4.3</b> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>17</b> <del>Horoscopes</del> Insights</a>
<ul>
<li class="chapter" data-level="17.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>17.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="17.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>17.2</b> Save your model fits</a></li>
<li class="chapter" data-level="17.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>17.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="17.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>17.4</b> Look at your data</a></li>
<li class="chapter" data-level="17.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#consider-using-the-0-intercept-syntax"><i class="fa fa-check"></i><b>17.5</b> Consider using the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="17.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>17.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="17.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>17.7</b> Annotate your code</a></li>
<li class="chapter" data-level="17.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>17.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="17.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>17.9</b> Code in public</a></li>
<li class="chapter" data-level="17.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-social-media"><i class="fa fa-check"></i><b>17.10</b> Check out social media</a></li>
<li class="chapter" data-level="17.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#extra-rethinking-related-resources"><i class="fa fa-check"></i><b>17.11</b> Extra <em>Rethinking</em>-related resources</a></li>
<li class="chapter" data-level="17.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#but-like-how-do-i-do-this-for-real"><i class="fa fa-check"></i><b>17.12</b> <em>But, like, how do I do this for real?</em></a></li>
<li class="chapter" data-level="17.13" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>17.13</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geocentric-models" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Geocentric Models<a href="geocentric-models.html#geocentric-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><strong>Linear regression</strong> is the geocentric model of applied statistics. By “linear regression,” we will mean a family of simple statistical golems that attempt to learn about the mean and variance of some measurement, using an additive combination of other measurements. Like geocentrism, linear regression can usefully describe a very large variety of natural phenomena. Like geocentrism, linear regression is a descriptive model that corresponds to many different process models. If we read its structure too literally, we’re likely to make mistakes. But used wisely, these little linear golems continue to be useful. <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020a, p. 71</a>, <strong>emphasis</strong>, in the original)</span></p>
</blockquote>
<div id="why-normal-distributions-are-normal" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Why normal distributions are normal<a href="geocentric-models.html#why-normal-distributions-are-normal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After laying out his soccer field coin toss shuffle premise, McElreath wrote:</p>
<blockquote>
<p>It’s hard to say where any individual person will end up, but you can say with great confidence what the collection of positions will be. The distances will be distributed in approximately normal, or Gaussian, fashion. This is true even though the underlying distribution is binomial. It does this because there are so many more possible ways to realize a sequence of left-right steps that sums to zero. There are slightly fewer ways to realize a sequence that ends up one step left or right of zero, and so on, with the number of possible sequences declining in the characteristic bell curve of the normal distribution. (p. 72)</p>
</blockquote>
<div id="normal-by-addition." class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Normal by addition.<a href="geocentric-models.html#normal-by-addition." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here’s a way to do the simulation necessary for the plot in the top panel of Figure 4.2.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="geocentric-models.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb215-2"><a href="geocentric-models.html#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="geocentric-models.html#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we set the seed to make the results of `runif()` reproducible.</span></span>
<span id="cb215-4"><a href="geocentric-models.html#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb215-5"><a href="geocentric-models.html#cb215-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-6"><a href="geocentric-models.html#cb215-6" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> </span>
<span id="cb215-7"><a href="geocentric-models.html#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make data with 100 people, 16 steps each with a starting point of `step == 0` (i.e., 17 rows per person)</span></span>
<span id="cb215-8"><a href="geocentric-models.html#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">person =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,</span>
<span id="cb215-9"><a href="geocentric-models.html#cb215-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">step   =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb215-10"><a href="geocentric-models.html#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for all steps above `step == 0` simulate a `deviation`</span></span>
<span id="cb215-11"><a href="geocentric-models.html#cb215-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviation =</span> <span class="fu">map_dbl</span>(step, <span class="sc">~</span><span class="fu">if_else</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb215-12"><a href="geocentric-models.html#cb215-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># after grouping by `person`, compute the cumulative sum of the deviations, then `ungroup()`</span></span>
<span id="cb215-13"><a href="geocentric-models.html#cb215-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span></span>
<span id="cb215-14"><a href="geocentric-models.html#cb215-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">cumsum</span>(deviation)) <span class="sc">%&gt;%</span> </span>
<span id="cb215-15"><a href="geocentric-models.html#cb215-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code></pre></div>
<p>That <code>map_dbl()</code> code within the first <code>mutate()</code> line might look odd. Go <a href="https://purrr.tidyverse.org/reference/map.html">here</a> to learn more about iterating with <code>purrr::map_dbl()</code>.</p>
<p>We might <code>glimpse()</code> at the data.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="geocentric-models.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pos)</span></code></pre></div>
<pre><code>## Rows: 1,700
## Columns: 4
## $ person    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
## $ step      &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 0, 1, 2, 3, 4, 5, 6, 7…
## $ deviation &lt;dbl&gt; 0.00000000, -0.98210841, -0.41252078, -0.44525008, 0.62714843, -0.47914446, 0.44…
## $ position  &lt;dbl&gt; 0.0000000, -0.9821084, -1.3946292, -1.8398793, -1.2127308, -1.6918753, -1.243063…</code></pre>
<p>Here’s the code to make the top panel of Figure 4.2.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="geocentric-models.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> pos, </span>
<span id="cb218-2"><a href="geocentric-models.html#cb218-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> step, <span class="at">y =</span> position, <span class="at">group =</span> person)) <span class="sc">+</span></span>
<span id="cb218-3"><a href="geocentric-models.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb218-4"><a href="geocentric-models.html#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> person <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="at">alpha  =</span> person <span class="sc">&lt;</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb218-5"><a href="geocentric-models.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;skyblue4&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb218-6"><a href="geocentric-models.html#cb218-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb218-7"><a href="geocentric-models.html#cb218-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;step number&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb218-8"><a href="geocentric-models.html#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-4-1.png" width="614.4" style="display: block; margin: auto;" /></p>
<p>Here’s the code for the bottom three plots of Figure 4.2.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="geocentric-models.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.a.</span></span>
<span id="cb219-2"><a href="geocentric-models.html#cb219-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb219-3"><a href="geocentric-models.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb219-4"><a href="geocentric-models.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-5"><a href="geocentric-models.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb219-6"><a href="geocentric-models.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&quot;density&quot;</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>) <span class="sc">+</span></span>
<span id="cb219-7"><a href="geocentric-models.html#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;4 steps&quot;</span>)</span>
<span id="cb219-8"><a href="geocentric-models.html#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="geocentric-models.html#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.b.</span></span>
<span id="cb219-10"><a href="geocentric-models.html#cb219-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb219-11"><a href="geocentric-models.html#cb219-11" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb219-12"><a href="geocentric-models.html#cb219-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-13"><a href="geocentric-models.html#cb219-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb219-14"><a href="geocentric-models.html#cb219-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="at">outline.type =</span> <span class="st">&quot;full&quot;</span>) <span class="sc">+</span></span>
<span id="cb219-15"><a href="geocentric-models.html#cb219-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;8 steps&quot;</span>)</span>
<span id="cb219-16"><a href="geocentric-models.html#cb219-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-17"><a href="geocentric-models.html#cb219-17" aria-hidden="true" tabindex="-1"></a><span class="co"># this is an intermediary step to get an SD value</span></span>
<span id="cb219-18"><a href="geocentric-models.html#cb219-18" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span></span>
<span id="cb219-19"><a href="geocentric-models.html#cb219-19" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb219-20"><a href="geocentric-models.html#cb219-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-21"><a href="geocentric-models.html#cb219-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(position)) <span class="sc">%&gt;%</span> </span>
<span id="cb219-22"><a href="geocentric-models.html#cb219-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sd)</span>
<span id="cb219-23"><a href="geocentric-models.html#cb219-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-24"><a href="geocentric-models.html#cb219-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure 4.2.c.</span></span>
<span id="cb219-25"><a href="geocentric-models.html#cb219-25" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb219-26"><a href="geocentric-models.html#cb219-26" aria-hidden="true" tabindex="-1"></a>  pos <span class="sc">%&gt;%</span></span>
<span id="cb219-27"><a href="geocentric-models.html#cb219-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(step <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb219-28"><a href="geocentric-models.html#cb219-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb219-29"><a href="geocentric-models.html#cb219-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, </span>
<span id="cb219-30"><a href="geocentric-models.html#cb219-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd),</span>
<span id="cb219-31"><a href="geocentric-models.html#cb219-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb219-32"><a href="geocentric-models.html#cb219-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;dodgerblue3&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb219-33"><a href="geocentric-models.html#cb219-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;16 steps&quot;</span>,</span>
<span id="cb219-34"><a href="geocentric-models.html#cb219-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb219-35"><a href="geocentric-models.html#cb219-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-36"><a href="geocentric-models.html#cb219-36" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the ggplots</span></span>
<span id="cb219-37"><a href="geocentric-models.html#cb219-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb219-38"><a href="geocentric-models.html#cb219-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-39"><a href="geocentric-models.html#cb219-39" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3) <span class="sc">&amp;</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>While we were at it, we explored a few ways to express densities. The main action was with the <code>geom_line()</code>, <code>geom_density()</code>, and <code>stat_function()</code> functions, respectively.</p>
<blockquote>
<p>Any process that adds together random values from the same distribution converges to a normal. But it’s not easy to grasp why addition should result in a bell curve of sums. Here’s a conceptual way to think of the process. Whatever the average value of the source distribution, each sample from it can be thought of as a fluctuation from that average value. When we begin to add these fluctuations together, they also begin to cancel one another out. A large positive fluctuation will cancel a large negative one. (p. 73)</p>
</blockquote>
</div>
<div id="normal-by-multiplication." class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Normal by multiplication.<a href="geocentric-models.html#normal-by-multiplication." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here’s McElreath’s simple random growth rate.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="geocentric-models.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb220-2"><a href="geocentric-models.html#cb220-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-3"><a href="geocentric-models.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## [1] 1.774719</code></pre>
<p>In the <code>runif()</code> part of that code, we generated 12 random draws from the uniform distribution with bounds <span class="math inline">\([0, 0.1]\)</span>. Within the <code>prod()</code> function, we first added <code>1</code> to each of those values and then computed their product. Consider a more explicit variant of the code.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="geocentric-models.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb222-2"><a href="geocentric-models.html#cb222-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-3"><a href="geocentric-models.html#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="dv">1</span>,</span>
<span id="cb222-4"><a href="geocentric-models.html#cb222-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">b =</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb222-5"><a href="geocentric-models.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">c =</span> a <span class="sc">+</span> b) <span class="sc">%&gt;%</span> </span>
<span id="cb222-6"><a href="geocentric-models.html#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">prod</span>(c))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##       p
##   &lt;dbl&gt;
## 1  1.77</code></pre>
<p>Same result. Rather than using base <strong>R</strong> <code>replicate()</code> to do this many times, let’s practice with <code>purrr::map_dbl()</code> like before.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="geocentric-models.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb224-2"><a href="geocentric-models.html#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="geocentric-models.html#cb224-3" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> </span>
<span id="cb224-4"><a href="geocentric-models.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">growth =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.1</span>))))</span>
<span id="cb224-5"><a href="geocentric-models.html#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-6"><a href="geocentric-models.html#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> growth, <span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb224-7"><a href="geocentric-models.html#cb224-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-8-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>“The smaller the effect of each locus, the better this additive approximation will be” (p. 74). Let’s compare big and small.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="geocentric-models.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb225-2"><a href="geocentric-models.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb225-3"><a href="geocentric-models.html#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="geocentric-models.html#cb225-4" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span></span>
<span id="cb225-5"><a href="geocentric-models.html#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">big   =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.5</span>))),</span>
<span id="cb225-6"><a href="geocentric-models.html#cb225-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">small =</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="sc">~</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.01</span>))))</span>
<span id="cb225-7"><a href="geocentric-models.html#cb225-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-8"><a href="geocentric-models.html#cb225-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb225-9"><a href="geocentric-models.html#cb225-9" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb225-10"><a href="geocentric-models.html#cb225-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">&quot;samples&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb225-11"><a href="geocentric-models.html#cb225-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-12"><a href="geocentric-models.html#cb225-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb225-13"><a href="geocentric-models.html#cb225-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> samples)) <span class="sc">+</span></span>
<span id="cb225-14"><a href="geocentric-models.html#cb225-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb225-15"><a href="geocentric-models.html#cb225-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) </span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Yep, the <code>small</code> samples were more Gaussian. “The interacting growth deviations, as long as they are sufficiently small, converge to a Gaussian distribution. In this way, the range of causal forces that tend towards Gaussian distributions extends well beyond purely additive interactions” (p. 74).</p>
</div>
<div id="normal-by-log-multiplication." class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Normal by log-multiplication.<a href="geocentric-models.html#normal-by-log-multiplication." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Instead of saving our tibble, we’ll just feed it directly into our plot.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="geocentric-models.html#cb226-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="geocentric-models.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_big =</span> <span class="fu">log</span>(big)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-3"><a href="geocentric-models.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-4"><a href="geocentric-models.html#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_big)) <span class="sc">+</span></span>
<span id="cb226-5"><a href="geocentric-models.html#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;gray33&quot;</span>) <span class="sc">+</span></span>
<span id="cb226-6"><a href="geocentric-models.html#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;the log of the big&quot;</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-10-1.png" width="312" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Yet another Gaussian distribution. We get the Gaussian distribution back, because adding logs is equivalent to multiplying the original numbers. So even multiplicative interactions of large deviations can produce Gaussian distributions, once we measure the outcomes on the log scale. (p. 75)</p>
</blockquote>
</div>
<div id="using-gaussian-distributions." class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Using Gaussian distributions.<a href="geocentric-models.html#using-gaussian-distributions." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>“The justifications for using the Gaussian distribution fall into two broad categories: (1) ontological and (2) epistemological” (p. 75). I’m a fan of the justifications to follow.</p>
<div id="ontological-justification." class="section level4 hasAnchor" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> Ontological justification.<a href="geocentric-models.html#ontological-justification." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Gaussian is</p>
<blockquote>
<p>a widespread pattern, appearing again and again at different scales and in different domains. Measurement errors, variations in growth, and the velocities of molecules all tend towards Gaussian distributions. These processes do this because at their heart, these processes add together fluctuations. And repeatedly adding finite fluctuations results in a distribution of sums that have shed all information about the underlying process, aside from mean and spread.</p>
<p>[However,] one consequence of this is that statistical models based on Gaussian distributions cannot reliably identify micro-process. (p. 75)</p>
</blockquote>
<p>But like Ptolemy’s circles within circles, the Gaussian can still be useful even if it sheds information.</p>
</div>
<div id="epistemological-justification." class="section level4 hasAnchor" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> Epistemological justification.<a href="geocentric-models.html#epistemological-justification." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>By the epistemological justification, the Gaussian represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions.</p>
<p>That is to say that the Gaussian distribution is the most natural expression of our state of ignorance, because if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways and does not introduce any new assumptions. It is the least surprising and least informative assumption to make. In this way, the Gaussian is the distribution most consistent with our assumptions. Or rather, it is the most consistent with our golem’s assumptions. If you don’t think the distribution should be Gaussian, then that implies that you know something else that you should tell your golem about, something that would improve inference. (p. 75)</p>
</blockquote>
<p>We’ll dive deeper into why the Gaussian is such a natural expression of ignorance in these contexts when we cover maximum entropy in <a href="ulysses-compass.html#ulysses-compass">Chapter 7</a>.</p>
</div>
<div id="rethinking-heavy-tails." class="section level4 hasAnchor" number="4.1.4.3">
<h4><span class="header-section-number">4.1.4.3</span> Rethinking: Heavy tails.<a href="geocentric-models.html#rethinking-heavy-tails." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The Gaussian distribution is common in nature and has some nice properties. But there are some risks in using it as a default data model. The extreme ends of a distribution are known as its tails. And the Gaussian distribution has some very thin tails–there is very little probability in them. Instead most of the mass in the Gaussian lies within one standard deviation of the mean. Many natural (and unnatural) processes have much heavier tails. (p. 76)</p>
</blockquote>
<p>You have no idea how excited I am that we’ll be covering some of these heavy-tailed alternatives!</p>
</div>
<div id="overthinking-gaussian-distribution." class="section level4 hasAnchor" number="4.1.4.4">
<h4><span class="header-section-number">4.1.4.4</span> Overthinking: Gaussian distribution.<a href="geocentric-models.html#overthinking-gaussian-distribution." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In this section McElreath gave the formula for the Gaussian probability density function. Let <span class="math inline">\(y\)</span> be the criterion, <span class="math inline">\(\mu\)</span> be the mean, and <span class="math inline">\(\sigma\)</span> be the standard deviation. Then the probability density of some Gaussian value <span class="math inline">\(y\)</span> is</p>
<p><span class="math display">\[p(y|\mu, \sigma) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left (- \frac{(y - \mu)^2}{2 \sigma^2} \right).\]</span></p>
<p>McElreath’s right. “This looks monstrous” (p. 76). Why not demystify that monster with a little <strong>R</strong> code? For simplicity, we’ll compute <span class="math inline">\(p(y|\mu, \sigma)\)</span> for a series of <span class="math inline">\(y\)</span>-values ranging from -1 to 1, holding <span class="math inline">\(\mu = 0\)</span> and <span class="math inline">\(\sigma = 0.1\)</span>. Then we’ll plot.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="geocentric-models.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">y     =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">01</span>),</span>
<span id="cb227-2"><a href="geocentric-models.html#cb227-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu    =</span> <span class="dv">0</span>,</span>
<span id="cb227-3"><a href="geocentric-models.html#cb227-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">sigma =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb227-4"><a href="geocentric-models.html#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute p(y) with a hand-made Gaussian probability density function</span></span>
<span id="cb227-5"><a href="geocentric-models.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>((y <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> sigma<span class="sc">^</span><span class="dv">2</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb227-6"><a href="geocentric-models.html#cb227-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb227-7"><a href="geocentric-models.html#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> p)) <span class="sc">+</span></span>
<span id="cb227-8"><a href="geocentric-models.html#cb227-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb227-9"><a href="geocentric-models.html#cb227-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(<span class="fu">italic</span>(<span class="st">&quot;y|&quot;</span>)<span class="sc">*</span>mu<span class="sc">==</span><span class="dv">0</span><span class="sc">*</span><span class="st">&quot;,&quot;</span><span class="sc">~</span>sigma<span class="sc">==</span><span class="fl">0.1</span>)))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-11-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Notice how <span class="math inline">\(p(y|\mu, \sigma)\)</span> peaks around 4 when <span class="math inline">\(y = 0\)</span>. We can also get that value with the <code>dnorm()</code> function, which will return the <span class="math inline">\(p(y)\)</span> value for a given combination of <span class="math inline">\(y\)</span>, <span class="math inline">\(\mu\)</span>, and <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="geocentric-models.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<pre><code>## [1] 3.989423</code></pre>
<blockquote>
<p>The answer, about 4, is no mistake. Probability <em>density</em> is the rate of change in cumulative probability. So where cumulative probability is increasing rapidly, density can easily exceed 1. But if we calculate the area under the density function, it will never exceed 1. Such areas are also called probability mass. You can usually ignore these density/mass details while doing computational work. But it’s good to be aware of the distinction. (p. 76, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
</div>
<div id="a-language-for-describing-models" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> A language for describing models<a href="geocentric-models.html#a-language-for-describing-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our mathy ways of summarizing models will be something like</p>
<p><span class="math display">\[\begin{align*}
\text{criterion}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i  &amp; = \beta \times \text{predictor}_i \\
\beta  &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma &amp; \sim \operatorname{Exponential}(1) \\
x_i    &amp; \sim \operatorname{Normal}(0, 1).
\end{align*}\]</span></p>
<p>“If that doesn’t make much sense, good. That indicates that you are holding the right textbook” (p. 77). Welcome applied statistics! 🤓</p>
<div id="re-describing-the-globe-tossing-model." class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Re-describing the globe tossing model.<a href="geocentric-models.html#re-describing-the-globe-tossing-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the globe tossing model, the probability <span class="math inline">\(p\)</span> of a count of water <span class="math inline">\(w\)</span> based on <span class="math inline">\(n\)</span> trials was</p>
<p><span class="math display">\[\begin{align*}
w &amp; \sim \operatorname{Binomial}(n, p) \\
p &amp; \sim \operatorname{Uniform}(0, 1),
\end{align*}\]</span></p>
<p>where the top line indicates we’re using the Binomial likelihood function to model <span class="math inline">\(w\)</span> given unique combinations of <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span>. In our example, <span class="math inline">\(w\)</span> and <span class="math inline">\(n\)</span> were already defined in the data, so all we need to do is compute <span class="math inline">\(p\)</span>. Since <span class="math inline">\(p\)</span> is the only parameter, it’s the only element that gets a prior, which is what that second line was.</p>
<div id="overthinking-from-model-definition-to-bayes-theorem." class="section level4 hasAnchor" number="4.2.1.1">
<h4><span class="header-section-number">4.2.1.1</span> Overthinking: From model definition to Bayes’ theorem.<a href="geocentric-models.html#overthinking-from-model-definition-to-bayes-theorem." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can use grid approximation to work through our globe tossing model.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="geocentric-models.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many `p_grid` points would you like?</span></span>
<span id="cb230-2"><a href="geocentric-models.html#cb230-2" aria-hidden="true" tabindex="-1"></a>n_points <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb230-3"><a href="geocentric-models.html#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="geocentric-models.html#cb230-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb230-5"><a href="geocentric-models.html#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">p_grid =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> n_points),</span>
<span id="cb230-6"><a href="geocentric-models.html#cb230-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">w      =</span> <span class="dv">6</span>, </span>
<span id="cb230-7"><a href="geocentric-models.html#cb230-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">n      =</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb230-8"><a href="geocentric-models.html#cb230-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior      =</span> <span class="fu">dunif</span>(p_grid, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>),</span>
<span id="cb230-9"><a href="geocentric-models.html#cb230-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood =</span> <span class="fu">dbinom</span>(w, <span class="at">size =</span> n, <span class="at">prob =</span> p_grid)) <span class="sc">%&gt;%</span></span>
<span id="cb230-10"><a href="geocentric-models.html#cb230-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">posterior =</span> likelihood <span class="sc">*</span> prior <span class="sc">/</span> <span class="fu">sum</span>(likelihood <span class="sc">*</span> prior))</span>
<span id="cb230-11"><a href="geocentric-models.html#cb230-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-12"><a href="geocentric-models.html#cb230-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   p_grid     w     n prior likelihood posterior
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 0          6     9     1   0         0       
## 2 0.0101     6     9     1   8.65e-11  8.74e-12
## 3 0.0202     6     9     1   5.37e- 9  5.43e-10
## 4 0.0303     6     9     1   5.93e- 8  5.99e- 9
## 5 0.0404     6     9     1   3.23e- 7  3.26e- 8
## 6 0.0505     6     9     1   1.19e- 6  1.21e- 7</code></pre>
<p>In case you were curious, here’s what they look like.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="geocentric-models.html#cb232-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="geocentric-models.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(prior<span class="sc">:</span>posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="geocentric-models.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this line allows us to dictate the order in which the panels will appear</span></span>
<span id="cb232-4"><a href="geocentric-models.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>, <span class="st">&quot;likelihood&quot;</span>, <span class="st">&quot;posterior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb232-5"><a href="geocentric-models.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb232-6"><a href="geocentric-models.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> value, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb232-7"><a href="geocentric-models.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb232-8"><a href="geocentric-models.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;purple&quot;</span>)) <span class="sc">+</span></span>
<span id="cb232-9"><a href="geocentric-models.html#cb232-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb232-10"><a href="geocentric-models.html#cb232-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-11"><a href="geocentric-models.html#cb232-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The posterior is a combination of the prior and the likelihood. When the prior is flat across the parameter space, the posterior is just the likelihood re-expressed as a probability. As we go along, you’ll see we almost never use flat priors in practice. Be warned that eschewing flat priors is a recent development, however. You only have to look at the literature from a couple decades ago to see mounds and mounds of flat priors.</p>
</div>
</div>
</div>
<div id="a-gaussian-model-of-height" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> A Gaussian model of height<a href="geocentric-models.html#a-gaussian-model-of-height" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>There are an infinite number of possible Gaussian distributions. Some have small means. Others have large means. Some are wide, with a large <span class="math inline">\(\sigma\)</span>. Others are narrow. We want our Bayesian machine to consider every possible distribution, each defined by a combination of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, and rank them by posterior plausibility. Posterior plausibility provides a measure of the logical compatibility of each possible distribution with the data and model. (p. 79)</p>
</blockquote>
<div id="the-data." class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> The data.<a href="geocentric-models.html#the-data." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s load the Howell <span class="citation">(<a href="#ref-howell2001demography" role="doc-biblioref">2001</a>, <a href="#ref-howell2010life" role="doc-biblioref">2010</a>)</span> data from McElreath’s <span class="citation">(<a href="#ref-R-rethinking" role="doc-biblioref">2020b</a>)</span> <a href="https://xcelab.net/rm/software/"><strong>rethinking</strong> package</a>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="geocentric-models.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb233-2"><a href="geocentric-models.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb233-3"><a href="geocentric-models.html#cb233-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span></code></pre></div>
<p>Here we open our focal statistical package, Bürkner’s <a href="https://github.com/paul-buerkner/brms"><strong>brms</strong></a>. But before we do, we’ll want to detach the <strong>rethinking</strong> package. <strong>R</strong> will not allow us to use a function from one package that shares the same name as a different function from another package if both packages are open at the same time. The <strong>rethinking</strong> and <strong>brms</strong> packages are designed for similar purposes and, unsurprisingly, overlap in some of their function names. To prevent problems, we will always make sure <strong>rethinking</strong> is detached before using <strong>brms</strong>. To learn more on the topic, see <a href="https://www.r-bloggers.com/2015/04/r-and-package-masking-a-real-life-example/">this R-bloggers post</a>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="geocentric-models.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Howell1)</span>
<span id="cb234-2"><a href="geocentric-models.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking, <span class="at">unload =</span> T)</span>
<span id="cb234-3"><a href="geocentric-models.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<p>Go ahead and investigate the data with <code>str()</code>, the <strong>tidyverse</strong> analogue for which is <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="geocentric-models.html#cb235-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb235-2"><a href="geocentric-models.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  4 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<p>The <strong>brms</strong> package does not have a function that works like <code>rethinking::precis()</code> for providing numeric and graphical summaries of variables, as see in McElreath’s <strong>R</strong> code 4.9. We can get some of that information with <code>summary()</code>.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="geocentric-models.html#cb237-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="geocentric-models.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##      height           weight            age             male       
##  Min.   : 53.98   Min.   : 4.252   Min.   : 0.00   Min.   :0.0000  
##  1st Qu.:125.09   1st Qu.:22.008   1st Qu.:12.00   1st Qu.:0.0000  
##  Median :148.59   Median :40.058   Median :27.00   Median :0.0000  
##  Mean   :138.26   Mean   :35.611   Mean   :29.34   Mean   :0.4724  
##  3rd Qu.:157.48   3rd Qu.:47.209   3rd Qu.:43.00   3rd Qu.:1.0000  
##  Max.   :179.07   Max.   :62.993   Max.   :88.00   Max.   :1.0000</code></pre>
<p>We might make the histograms like this.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="geocentric-models.html#cb239-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="geocentric-models.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb239-3"><a href="geocentric-models.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;male&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb239-4"><a href="geocentric-models.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb239-5"><a href="geocentric-models.html#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb239-6"><a href="geocentric-models.html#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb239-7"><a href="geocentric-models.html#cb239-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-19-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>If you’re curious, McElreath made those tiny histograms with help from Wickham’s <a href="https://github.com/hadley/precis/blob/master/R/histospark.R"><code>histospark()</code> function</a>. Here’s the code.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="geocentric-models.html#cb240-1" aria-hidden="true" tabindex="-1"></a>sparks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;\u2581&quot;</span>, <span class="st">&quot;\u2582&quot;</span>, <span class="st">&quot;\u2583&quot;</span>, <span class="st">&quot;\u2585&quot;</span>, <span class="st">&quot;\u2587&quot;</span>)</span>
<span id="cb240-2"><a href="geocentric-models.html#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="geocentric-models.html#cb240-3" aria-hidden="true" tabindex="-1"></a>histospark <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">width =</span> <span class="dv">10</span>) {</span>
<span id="cb240-4"><a href="geocentric-models.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  bins <span class="ot">&lt;-</span> graphics<span class="sc">::</span><span class="fu">hist</span>(x, <span class="at">breaks =</span> width, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb240-5"><a href="geocentric-models.html#cb240-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-6"><a href="geocentric-models.html#cb240-6" aria-hidden="true" tabindex="-1"></a>  factor <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb240-7"><a href="geocentric-models.html#cb240-7" aria-hidden="true" tabindex="-1"></a>    bins<span class="sc">$</span>counts <span class="sc">/</span> <span class="fu">max</span>(bins<span class="sc">$</span>counts),</span>
<span id="cb240-8"><a href="geocentric-models.html#cb240-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="fu">length</span>(sparks) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb240-9"><a href="geocentric-models.html#cb240-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> sparks,</span>
<span id="cb240-10"><a href="geocentric-models.html#cb240-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb240-11"><a href="geocentric-models.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb240-12"><a href="geocentric-models.html#cb240-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-13"><a href="geocentric-models.html#cb240-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(factor, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb240-14"><a href="geocentric-models.html#cb240-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here’s how it works.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="geocentric-models.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histospark</span>(d<span class="sc">$</span>weight)</span></code></pre></div>
<pre><code>## [1] &quot;▁▂▃▂▂▂▂▅▇▇▃▂▁&quot;</code></pre>
<p>One of the neat things about the <code>histospark()</code> function is you can insert the output right in your R Markdown prose. For example, we can use is to casually show how left skewed the our <code>height</code> variable is: ▁▁▁▁▁▁▁▂▁▇▇▅▁. But it’s time to get back on track. You can isolate <code>height</code> values with the <code>dplyr::select()</code> function.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="geocentric-models.html#cb243-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="geocentric-models.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(height) <span class="sc">%&gt;%</span> </span>
<span id="cb243-3"><a href="geocentric-models.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 544
## Columns: 1
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.8300, 149.2250, 168.9100, 147…</code></pre>
<p>If you want the values in a numeric vector rather than in a data fame, try <code>pull(d, height)</code>.</p>
<p>We can use the <code>dplyr::filter()</code> function to make an adults-only data frame.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="geocentric-models.html#cb245-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> </span>
<span id="cb245-2"><a href="geocentric-models.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="geocentric-models.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)</span></code></pre></div>
<p>Our reduced <code>d2</code> does indeed have <span class="math inline">\(n = 352\)</span> cases.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="geocentric-models.html#cb246-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span> </span>
<span id="cb246-2"><a href="geocentric-models.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>##     n
## 1 352</code></pre>
<div id="overthinking-data-frames-and-indexes." class="section level4 hasAnchor" number="4.3.1.1">
<h4><span class="header-section-number">4.3.1.1</span> Overthinking: Data frames and indexes.<a href="geocentric-models.html#overthinking-data-frames-and-indexes." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For more on indexing, check out <a href="https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html">Chapter 9</a> of Peng’s <span class="citation">(<a href="#ref-pengProgrammingDataScience2022" role="doc-biblioref">2022</a>)</span> <em>R programming for data science</em>, or even the <a href="http://r4ds.had.co.nz/vectors.html#subsetting-1">Subsetting</a> subsection in <em>R4DS</em>.</p>
<p>This probably reflects my training history, but the structure of a data frame seems natural and inherently appealing. If you’re in the other camp, do check out either of these two data wrangling talks (<a href="https://youtu.be/4MfUCX_KpdE">here</a> and <a href="https://youtu.be/GapSskrtUzU?t=1249">here</a>) by the ineffable <a href="https://twitter.com/JennyBryan">Jenny Bryan</a>.</p>
</div>
</div>
<div id="the-model." class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> The model.<a href="geocentric-models.html#the-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Please heed McElreath’s warnings to</p>
<blockquote>
<p>be careful about choosing the Gaussian distribution only when the plotted outcome variable looks Gaussian to you. Gawking at the raw data, to try to decide how to model them, is usually not a good idea. The data could be a mixture of different Gaussian distributions, for example, and in that case you won’t be able to detect the underlying normality just by eyeballing the outcome distribution. Furthermore, as mentioned earlier in this chapter, the empirical distribution needn’t be actually Gaussian in order to justify using a Gaussian probability distribution. (p. 81)</p>
</blockquote>
<p>Anyway, the likelihood for our model is</p>
<p><span class="math display">\[\text{heights}_i \sim \operatorname{Normal}(\mu, \sigma),\]</span></p>
<p>where the <span class="math inline">\(i\)</span> subscript indexes the individual cases in the data. Our two parameters are <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, which we will estimate using Bayes’ formula. Our prior for <span class="math inline">\(\mu\)</span> will be</p>
<p><span class="math display">\[\mu \sim \operatorname{Normal}(178, 20)\]</span></p>
<p>and our prior for <span class="math inline">\(\sigma\)</span> will be</p>
<p><span class="math display">\[\sigma \sim \operatorname{Uniform}(0, 50).\]</span></p>
<p>Here’s the shape of the prior for <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\mathcal N(178, 20)\)</span>.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="geocentric-models.html#cb248-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb248-2"><a href="geocentric-models.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-3"><a href="geocentric-models.html#cb248-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb248-4"><a href="geocentric-models.html#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb248-5"><a href="geocentric-models.html#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb248-6"><a href="geocentric-models.html#cb248-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> <span class="dv">75</span>)) <span class="sc">+</span></span>
<span id="cb248-7"><a href="geocentric-models.html#cb248-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;mu ~ dnorm(178, 20)&quot;</span>,</span>
<span id="cb248-8"><a href="geocentric-models.html#cb248-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb248-9"><a href="geocentric-models.html#cb248-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-10"><a href="geocentric-models.html#cb248-10" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-25-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>And here’s the <strong>ggplot2</strong> code for our prior for <span class="math inline">\(\sigma\)</span>, a uniform distribution with a minimum value of 0 and a maximum value of 50. We don’t really need the <span class="math inline">\(y\)</span>-axis when looking at the shapes of a density, so we’ll just remove it with <code>scale_y_continuous()</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="geocentric-models.html#cb249-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb249-2"><a href="geocentric-models.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb249-3"><a href="geocentric-models.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb249-4"><a href="geocentric-models.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dunif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>))) <span class="sc">+</span></span>
<span id="cb249-5"><a href="geocentric-models.html#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb249-6"><a href="geocentric-models.html#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb249-7"><a href="geocentric-models.html#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb249-8"><a href="geocentric-models.html#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;sigma ~ dunif(0, 50)&quot;</span>)</span>
<span id="cb249-9"><a href="geocentric-models.html#cb249-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-10"><a href="geocentric-models.html#cb249-10" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-26-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We can simulate from both priors at once to get a prior probability distribution of <code>heights</code>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="geocentric-models.html#cb250-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb250-2"><a href="geocentric-models.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="geocentric-models.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb250-4"><a href="geocentric-models.html#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="geocentric-models.html#cb250-5" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span></span>
<span id="cb250-6"><a href="geocentric-models.html#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd  =</span> <span class="dv">20</span>),</span>
<span id="cb250-7"><a href="geocentric-models.html#cb250-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb250-8"><a href="geocentric-models.html#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd =</span> sample_sigma))</span>
<span id="cb250-9"><a href="geocentric-models.html#cb250-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb250-10"><a href="geocentric-models.html#cb250-10" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> sim <span class="sc">%&gt;%</span> </span>
<span id="cb250-11"><a href="geocentric-models.html#cb250-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb250-12"><a href="geocentric-models.html#cb250-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey33&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-13"><a href="geocentric-models.html#cb250-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">73</span>, <span class="dv">178</span>, <span class="dv">283</span>)) <span class="sc">+</span></span>
<span id="cb250-14"><a href="geocentric-models.html#cb250-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb250-15"><a href="geocentric-models.html#cb250-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-16"><a href="geocentric-models.html#cb250-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb250-17"><a href="geocentric-models.html#cb250-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-18"><a href="geocentric-models.html#cb250-18" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-27-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you look at the <span class="math inline">\(x\)</span>-axis breaks on the plot in McElreath’s lower left panel in Figure 4.3, you’ll notice they’re intentional. To compute the mean and 3 standard deviations above and below, you might do this.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="geocentric-models.html#cb251-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="geocentric-models.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ll   =</span> <span class="fu">mean</span>(height) <span class="sc">-</span> <span class="fu">sd</span>(height) <span class="sc">*</span> <span class="dv">3</span>,</span>
<span id="cb251-3"><a href="geocentric-models.html#cb251-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb251-4"><a href="geocentric-models.html#cb251-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">mean</span>(height) <span class="sc">+</span> <span class="fu">sd</span>(height) <span class="sc">*</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb251-5"><a href="geocentric-models.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(round, <span class="at">digits =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##      ll  mean    ul
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  73.9  177.  281.</code></pre>
<p>Our values are very close to his, but are off by just a bit due to simulation variation.</p>
<p>Here’s the work to make the lower right panel of Figure 4.3. Watch out; we’re starting to get fancy.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="geocentric-models.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb253-2"><a href="geocentric-models.html#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb253-3"><a href="geocentric-models.html#cb253-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-4"><a href="geocentric-models.html#cb253-4" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span></span>
<span id="cb253-5"><a href="geocentric-models.html#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">100</span>),</span>
<span id="cb253-6"><a href="geocentric-models.html#cb253-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb253-7"><a href="geocentric-models.html#cb253-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd =</span> sample_sigma))</span>
<span id="cb253-8"><a href="geocentric-models.html#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="geocentric-models.html#cb253-9" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the values we&#39;ll use to break on our x axis</span></span>
<span id="cb253-10"><a href="geocentric-models.html#cb253-10" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span></span>
<span id="cb253-11"><a href="geocentric-models.html#cb253-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">mean</span>(sim<span class="sc">$</span>height) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sd</span>(sim<span class="sc">$</span>height), <span class="dv">0</span>, <span class="fu">mean</span>(sim<span class="sc">$</span>height), <span class="fu">mean</span>(sim<span class="sc">$</span>height) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">sd</span>(sim<span class="sc">$</span>height)) <span class="sc">%&gt;%</span> </span>
<span id="cb253-12"><a href="geocentric-models.html#cb253-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb253-13"><a href="geocentric-models.html#cb253-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-14"><a href="geocentric-models.html#cb253-14" aria-hidden="true" tabindex="-1"></a><span class="co"># this is just for aesthetics</span></span>
<span id="cb253-15"><a href="geocentric-models.html#cb253-15" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb253-16"><a href="geocentric-models.html#cb253-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">height =</span> <span class="dv">272</span> <span class="sc">-</span> <span class="dv">25</span>,</span>
<span id="cb253-17"><a href="geocentric-models.html#cb253-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">y      =</span> .<span class="dv">0013</span>,</span>
<span id="cb253-18"><a href="geocentric-models.html#cb253-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="st">&quot;tallest man&quot;</span>,</span>
<span id="cb253-19"><a href="geocentric-models.html#cb253-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">angle  =</span> <span class="dv">90</span>)</span>
<span id="cb253-20"><a href="geocentric-models.html#cb253-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-21"><a href="geocentric-models.html#cb253-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb253-22"><a href="geocentric-models.html#cb253-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb253-23"><a href="geocentric-models.html#cb253-23" aria-hidden="true" tabindex="-1"></a>  sim <span class="sc">%&gt;%</span> </span>
<span id="cb253-24"><a href="geocentric-models.html#cb253-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb253-25"><a href="geocentric-models.html#cb253-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb253-26"><a href="geocentric-models.html#cb253-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-27"><a href="geocentric-models.html#cb253-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">272</span>, <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb253-28"><a href="geocentric-models.html#cb253-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb253-29"><a href="geocentric-models.html#cb253-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> angle),</span>
<span id="cb253-30"><a href="geocentric-models.html#cb253-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-31"><a href="geocentric-models.html#cb253-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> breaks) <span class="sc">+</span></span>
<span id="cb253-32"><a href="geocentric-models.html#cb253-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb253-33"><a href="geocentric-models.html#cb253-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)</span><span class="sc">\n</span><span class="st">mu ~ dnorm(178, 100)&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-34"><a href="geocentric-models.html#cb253-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb253-35"><a href="geocentric-models.html#cb253-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-36"><a href="geocentric-models.html#cb253-36" aria-hidden="true" tabindex="-1"></a>p4</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-29-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>You may have noticed how we were saving each of the four last plots as <code>p1</code> through <code>p4</code>. Let’s combine the four to make our version of McElreath’s Figure 4.3.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="geocentric-models.html#cb254-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;mu&quot;</span>) <span class="sc">|</span> p2 <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;sigma&quot;</span>)) <span class="sc">/</span> (p3 <span class="sc">|</span> p4)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-30-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>On page 84, McElreath said his prior simulation indicated 4% of the heights would be below zero. Here’s how we might determe that percentage for our simulation.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="geocentric-models.html#cb255-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb255-2"><a href="geocentric-models.html#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(height <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb255-3"><a href="geocentric-models.html#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   `height &lt; 0`     n percent
##   &lt;lgl&gt;        &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE         9571   95.7 
## 2 TRUE           429    4.29</code></pre>
<p>Here’s the break down compared to the tallest man on record, <a href="https://en.wikipedia.org/wiki/Robert_Wadlow">Robert Pershing Wadlow</a> (1918–1940).</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="geocentric-models.html#cb257-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb257-2"><a href="geocentric-models.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(height <span class="sc">&lt;</span> <span class="dv">272</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-3"><a href="geocentric-models.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   `height &lt; 272`     n percent
##   &lt;lgl&gt;          &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE           1761    17.6
## 2 TRUE            8239    82.4</code></pre>
<blockquote>
<p>Does this matter? In this case, we have so much data that the silly prior is harmless. But that won’t always be the case. There are plenty of inference problems for which the data alone are not sufficient, no matter how numerous. Bayes lets us proceed in these cases. But only if we use our scientific knowledge to construct sensible priors. Using scientific knowledge to build priors is not cheating. The important thing is that your prior not be based on the values in the data, but only on what you know about the data before you see it. (p. 84)</p>
</blockquote>
<div id="rethinking-a-farewell-to-epsilon." class="section level4 hasAnchor" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Rethinking: A farewell to epsilon.<a href="geocentric-models.html#rethinking-a-farewell-to-epsilon." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Some readers will have already met an alternative notation for a Gaussian linear model:</p>
<p><span class="math display">\[\begin{align*}
h_i &amp; = \mu + \epsilon_i \\
\epsilon_i &amp; \sim \operatorname{Normal}(0, \sigma)
\end{align*}\]</span></p>
<p>This is equivalent to the <span class="math inline">\(h_i \sim \operatorname{Normal}(\mu, \sigma)\)</span> form, with the <span class="math inline">\(\epsilon\)</span> standing in for the Gaussian density. But this <span class="math inline">\(\epsilon\)</span> form is poor form. The reason is that it does not usually generalize to other types of models. This means it won’t be possible to express non-Gaussian models using tricks like <span class="math inline">\(\epsilon\)</span>. Better to learn one system that does generalize. (p. 84)</p>
</blockquote>
<p>Agreed.</p>
</div>
</div>
<div id="grid-approximation-of-the-posterior-distribution." class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Grid approximation of the posterior distribution.<a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As McElreath explained, you’ll never use this for practical data analysis. But I found this helped me better understanding what exactly we’re doing with Bayesian estimation. So let’s play along.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="geocentric-models.html#cb259-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb259-2"><a href="geocentric-models.html#cb259-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-3"><a href="geocentric-models.html#cb259-3" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb259-4"><a href="geocentric-models.html#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we&#39;ll accomplish with `tidyr::crossing()` what McElreath did with base R `expand.grid()`</span></span>
<span id="cb259-5"><a href="geocentric-models.html#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">mu    =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">140</span>, <span class="at">to =</span> <span class="dv">160</span>, <span class="at">length.out =</span> n),</span>
<span id="cb259-6"><a href="geocentric-models.html#cb259-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4</span>, <span class="at">to =</span> <span class="dv">9</span>, <span class="at">length.out =</span> n))</span>
<span id="cb259-7"><a href="geocentric-models.html#cb259-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-8"><a href="geocentric-models.html#cb259-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d_grid)</span></code></pre></div>
<pre><code>## Rows: 40,000
## Columns: 2
## $ mu    &lt;dbl&gt; 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140,…
## $ sigma &lt;dbl&gt; 4.000000, 4.025126, 4.050251, 4.075377, 4.100503, 4.125628, 4.150754, 4.175879, 4.20…</code></pre>
<p><code>d_grid</code> contains every combination of <code>mu</code> and <code>sigma</code> across their specified values. Instead of base <strong>R</strong> <code>sapply()</code>, we’ll do the computations by making a custom function which we’ll then plug into <code>purrr::map2()</code>.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="geocentric-models.html#cb261-1" aria-hidden="true" tabindex="-1"></a>grid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma) {</span>
<span id="cb261-2"><a href="geocentric-models.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-3"><a href="geocentric-models.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(d2<span class="sc">$</span>height, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb261-4"><a href="geocentric-models.html#cb261-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>()</span>
<span id="cb261-5"><a href="geocentric-models.html#cb261-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-6"><a href="geocentric-models.html#cb261-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we’re ready to complete the tibble.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="geocentric-models.html#cb262-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb262-2"><a href="geocentric-models.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb262-3"><a href="geocentric-models.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2</span>(mu, sigma, grid_function)) <span class="sc">%&gt;%</span></span>
<span id="cb262-4"><a href="geocentric-models.html#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(log_likelihood) <span class="sc">%&gt;%</span> </span>
<span id="cb262-5"><a href="geocentric-models.html#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_mu    =</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>, <span class="at">log =</span> T),</span>
<span id="cb262-6"><a href="geocentric-models.html#cb262-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-7"><a href="geocentric-models.html#cb262-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb262-8"><a href="geocentric-models.html#cb262-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)))</span>
<span id="cb262-9"><a href="geocentric-models.html#cb262-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-10"><a href="geocentric-models.html#cb262-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_grid)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##      mu sigma log_likelihood prior_mu prior_sigma product probability
##   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
## 1   140  4            -3813.    -5.72       -3.91  -3822.           0
## 2   140  4.03         -3778.    -5.72       -3.91  -3787.           0
## 3   140  4.05         -3743.    -5.72       -3.91  -3753.           0
## 4   140  4.08         -3709.    -5.72       -3.91  -3719.           0
## 5   140  4.10         -3676.    -5.72       -3.91  -3686.           0
## 6   140  4.13         -3644.    -5.72       -3.91  -3653.           0</code></pre>
<p>In the final <code>d_grid</code>, the <code>probability</code> vector contains the posterior probabilities across values of <code>mu</code> and <code>sigma</code>. We can make a contour plot with <code>geom_contour()</code>.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="geocentric-models.html#cb264-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="geocentric-models.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">z =</span> probability)) <span class="sc">+</span> </span>
<span id="cb264-3"><a href="geocentric-models.html#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>() <span class="sc">+</span></span>
<span id="cb264-4"><a href="geocentric-models.html#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb264-5"><a href="geocentric-models.html#cb264-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma)) <span class="sc">+</span></span>
<span id="cb264-6"><a href="geocentric-models.html#cb264-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d_grid<span class="sc">$</span>mu),</span>
<span id="cb264-7"><a href="geocentric-models.html#cb264-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d_grid<span class="sc">$</span>sigma)) <span class="sc">+</span></span>
<span id="cb264-8"><a href="geocentric-models.html#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-36-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We’ll make our heat map with <code>geom_raster()</code>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="geocentric-models.html#cb265-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="geocentric-models.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">fill =</span> probability)) <span class="sc">+</span> </span>
<span id="cb265-3"><a href="geocentric-models.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb265-4"><a href="geocentric-models.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>) <span class="sc">+</span></span>
<span id="cb265-5"><a href="geocentric-models.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu),</span>
<span id="cb265-6"><a href="geocentric-models.html#cb265-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma)) <span class="sc">+</span></span>
<span id="cb265-7"><a href="geocentric-models.html#cb265-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-37-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="sampling-from-the-posterior." class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Sampling from the posterior.<a href="geocentric-models.html#sampling-from-the-posterior." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use <code>dplyr::sample_n()</code> to sample rows, with replacement, from <code>d_grid</code>.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="geocentric-models.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb266-2"><a href="geocentric-models.html#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="geocentric-models.html#cb266-3" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="ot">&lt;-</span> </span>
<span id="cb266-4"><a href="geocentric-models.html#cb266-4" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb266-5"><a href="geocentric-models.html#cb266-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">1e4</span>, <span class="at">replace =</span> T, <span class="at">weight =</span> probability)</span>
<span id="cb266-6"><a href="geocentric-models.html#cb266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-7"><a href="geocentric-models.html#cb266-7" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb266-8"><a href="geocentric-models.html#cb266-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma)) <span class="sc">+</span> </span>
<span id="cb266-9"><a href="geocentric-models.html#cb266-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb266-10"><a href="geocentric-models.html#cb266-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb266-11"><a href="geocentric-models.html#cb266-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu[samples]),</span>
<span id="cb266-12"><a href="geocentric-models.html#cb266-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma[samples])) <span class="sc">+</span></span>
<span id="cb266-13"><a href="geocentric-models.html#cb266-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-38-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We can use <code>pivot_longer()</code> and then <code>facet_wrap()</code> to plot the densities for both <code>mu</code> and <code>sigma</code> at once.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="geocentric-models.html#cb267-1" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb267-2"><a href="geocentric-models.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mu<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb267-3"><a href="geocentric-models.html#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="geocentric-models.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb267-5"><a href="geocentric-models.html#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey33&quot;</span>) <span class="sc">+</span></span>
<span id="cb267-6"><a href="geocentric-models.html#cb267-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb267-7"><a href="geocentric-models.html#cb267-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb267-8"><a href="geocentric-models.html#cb267-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb267-9"><a href="geocentric-models.html#cb267-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-39-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We’ll use the <strong>tidybayes</strong> package to compute their posterior modes and 95% HDIs.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="geocentric-models.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb268-2"><a href="geocentric-models.html#cb268-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-3"><a href="geocentric-models.html#cb268-3" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb268-4"><a href="geocentric-models.html#cb268-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mu<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb268-5"><a href="geocentric-models.html#cb268-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb268-6"><a href="geocentric-models.html#cb268-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mode_hdi</span>(value)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 7
##   name   value .lower .upper .width .point .interval
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 mu    155.   154.   155.     0.95 mode   hdi      
## 2 sigma   7.82   7.14   8.30   0.95 mode   hdi</code></pre>
<p>Let’s say you wanted their posterior medians and 50% quantile-based intervals, instead. Just switch out the last line for <code>median_qi(value, .width = .5)</code>.</p>
<div id="overthinking-sample-size-and-the-normality-of-sigmas-posterior." class="section level4 hasAnchor" number="4.3.4.1">
<h4><span class="header-section-number">4.3.4.1</span> Overthinking: Sample size and the normality of <span class="math inline">\(\sigma\)</span>’s posterior.<a href="geocentric-models.html#overthinking-sample-size-and-the-normality-of-sigmas-posterior." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Since we’ll be fitting models with <strong>brms</strong> almost exclusively from here on out, this section is largely mute. But we’ll do it anyway for the sake of practice. I’m going to break the steps up like before rather than compress the code together. Here’s <code>d3</code>.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="geocentric-models.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb270-2"><a href="geocentric-models.html#cb270-2" aria-hidden="true" tabindex="-1"></a>(d3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(d2<span class="sc">$</span>height, <span class="at">size =</span> <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##  [1] 147.3200 154.9400 168.9100 156.8450 165.7350 151.7650 165.7350 156.2100 144.7800 154.9400
## [11] 151.1300 147.9550 149.8600 162.5600 161.9250 164.4650 160.9852 151.7650 163.8300 149.8600</code></pre>
<p>For our first step using <code>d3</code>, we’ll redefine <code>d_grid</code>.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="geocentric-models.html#cb272-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb272-2"><a href="geocentric-models.html#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="geocentric-models.html#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="co"># note we&#39;ve redefined the ranges of `mu` and `sigma`</span></span>
<span id="cb272-4"><a href="geocentric-models.html#cb272-4" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb272-5"><a href="geocentric-models.html#cb272-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">mu    =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">150</span>, <span class="at">to =</span> <span class="dv">170</span>, <span class="at">length.out =</span> n),</span>
<span id="cb272-6"><a href="geocentric-models.html#cb272-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">4</span>, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> n))</span></code></pre></div>
<p>Second, we’ll redefine our custom <code>grid_function()</code> function to operate over the <code>height</code> values of <code>d3</code>.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="geocentric-models.html#cb273-1" aria-hidden="true" tabindex="-1"></a>grid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma) {</span>
<span id="cb273-2"><a href="geocentric-models.html#cb273-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-3"><a href="geocentric-models.html#cb273-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(d3, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma, <span class="at">log =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb273-4"><a href="geocentric-models.html#cb273-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>()</span>
<span id="cb273-5"><a href="geocentric-models.html#cb273-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb273-6"><a href="geocentric-models.html#cb273-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we’ll use the amended <code>grid_function()</code> to make the posterior.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="geocentric-models.html#cb274-1" aria-hidden="true" tabindex="-1"></a>d_grid <span class="ot">&lt;-</span></span>
<span id="cb274-2"><a href="geocentric-models.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb274-3"><a href="geocentric-models.html#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2_dbl</span>(mu, sigma, grid_function)) <span class="sc">%&gt;%</span> </span>
<span id="cb274-4"><a href="geocentric-models.html#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_mu    =</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>, <span class="at">log =</span> T),</span>
<span id="cb274-5"><a href="geocentric-models.html#cb274-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb274-6"><a href="geocentric-models.html#cb274-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb274-7"><a href="geocentric-models.html#cb274-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)))</span></code></pre></div>
<p>Did you catch our use of <code>purrr::map2_dbl()</code>, there, in place of <code>purrr::map2()</code>? It turns out that <code>purrr::map()</code> and <code>purrr::map2()</code> always return a list (see <a href="https://purrr.tidyverse.org/reference/map.html">here</a> and <a href="https://purrr.tidyverse.org/reference/map2.html">here</a>). But we can add the <code>_dbl</code> suffix to those functions, which will instruct the <strong>purrr</strong> package to return a double vector (i.e., a <a href="http://r4ds.had.co.nz/vectors.html#important-types-of-atomic-vector">common kind of numeric vector</a>). The advantage of that approach is we no longer need to follow our <code>map()</code> or <code>map2()</code> lines with <code>unnest()</code>. To learn more about the ins and outs of the <code>map()</code> family, check out <a href="http://r4ds.had.co.nz/iteration.html#the-map-functions">this section</a> from <em>R4DS</em> or Jenny Bryan’s <a href="https://jennybc.github.io/purrr-tutorial/"><em>purrr tutorial</em></a>.</p>
<p>Next we’ll <code>sample_n()</code> and plot.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="geocentric-models.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb275-2"><a href="geocentric-models.html#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="geocentric-models.html#cb275-3" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="ot">&lt;-</span> </span>
<span id="cb275-4"><a href="geocentric-models.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  d_grid <span class="sc">%&gt;%</span> </span>
<span id="cb275-5"><a href="geocentric-models.html#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="fl">1e4</span>, <span class="at">replace =</span> T, <span class="at">weight =</span> probability)</span>
<span id="cb275-6"><a href="geocentric-models.html#cb275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-7"><a href="geocentric-models.html#cb275-7" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb275-8"><a href="geocentric-models.html#cb275-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma)) <span class="sc">+</span> </span>
<span id="cb275-9"><a href="geocentric-models.html#cb275-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb275-10"><a href="geocentric-models.html#cb275-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(mu[samples]),</span>
<span id="cb275-11"><a href="geocentric-models.html#cb275-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(sigma[samples])) <span class="sc">+</span></span>
<span id="cb275-12"><a href="geocentric-models.html#cb275-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-45-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Behold the updated densities.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="geocentric-models.html#cb276-1" aria-hidden="true" tabindex="-1"></a>d_grid_samples <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="geocentric-models.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mu<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb276-3"><a href="geocentric-models.html#cb276-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-4"><a href="geocentric-models.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span> </span>
<span id="cb276-5"><a href="geocentric-models.html#cb276-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey33&quot;</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb276-6"><a href="geocentric-models.html#cb276-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb276-7"><a href="geocentric-models.html#cb276-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb276-8"><a href="geocentric-models.html#cb276-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb276-9"><a href="geocentric-models.html#cb276-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-46-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>That <code>labeller = label_parsed</code> bit in the <code>facet_wrap()</code> function is what converted our subplot strip labels into Greek. You can learn more about <code>labeller</code> <a href="https://ggplot2.tidyverse.org/reference/labeller.html">here</a>. Anyway, our posterior for <span class="math inline">\(\sigma\)</span> isn’t so Gaussian with that small <span class="math inline">\(n\)</span>.</p>
<p>This is the point in the project where we hop off the grid-approximation train. On the one hand, I think this is a great idea. Most of y’all reading this will never use grid approximation in a real-world applied data analysis. On the other hand, there is some pedagogical utility in practicing with it. It can help you grasp what it is we’re doing when we apply Bayes’ theorem. If you’d like more practice, check out the first several chapters in John Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">textbook</a> and the corresponding chapters in my <span class="citation">(<a href="#ref-kurzDoingBayesianDataAnalysis2023" role="doc-biblioref">2023a</a>)</span> <a href="https://bookdown.org/content/3686/">ebook</a> translating it into <strong>brms</strong> and <strong>tidyverse</strong>.</p>
</div>
</div>
<div id="finding-the-posterior-distribution-with-quap-brm." class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.<a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we rewrite the statistical model, this time using font color to help differentiate the likelihood from the prior(s).</p>
<p><span class="math display">\[\begin{align*}
\color{red}{\text{heights}_i} &amp; \color{red}\sim \color{red}{\operatorname{Normal}(\mu, \sigma)} &amp;&amp; \color{red}{\text{likelihood}} \\
\color{blue}\mu &amp; \color{blue}\sim \color{blue}{\operatorname{Normal}(178, 20)} &amp;&amp; \color{blue}{\text{prior}} \\
\color{blue}\sigma &amp; \color{blue}\sim \color{blue}{\operatorname{Uniform}(0, 50)}
\end{align*}\]</span></p>
<p>We won’t actually use <code>rethinking::quap()</code>. It’s time to jump straight to the primary <strong>brms</strong> modeling function, <code>brm()</code>. In the text, McElreath indexed his models with names like <code>m4.1</code>. I will largely follow that convention, but will replace the <em>m</em> with a <em>b</em> to stand for the <strong>brms</strong> package. Here’s how to fit the first model for this chapter.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="geocentric-models.html#cb277-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb277-2"><a href="geocentric-models.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb277-3"><a href="geocentric-models.html#cb277-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb277-4"><a href="geocentric-models.html#cb277-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb277-5"><a href="geocentric-models.html#cb277-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb277-6"><a href="geocentric-models.html#cb277-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb277-7"><a href="geocentric-models.html#cb277-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb277-8"><a href="geocentric-models.html#cb277-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb277-9"><a href="geocentric-models.html#cb277-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.01&quot;</span>)</span></code></pre></div>
<p>Note our use of the <code>ub</code> parameter for the uniform prior on <span class="math inline">\(\sigma\)</span>. If you want to use an upper-bound prior on <span class="math inline">\(\sigma\)</span> with a <code>brm()</code> model, the <code>up</code> setting will help out a lot. We’ll start to get a sense of why when we cover Hamiltonian Monte Carlo (HMC) in <a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo">Chapter 9</a>. This leads to an important point. After running a model fit with HMC, it’s a good idea to inspect the chains. As we’ll see, McElreath covered visual chain diagnostics in <a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo">Chapter 9</a>. Here’s a typical way to do so with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="geocentric-models.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-47-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If you want detailed diagnostics for the HMC chains, call <code>launch_shinystan(b4.1)</code>. That’ll keep you busy for a while. But anyway, the chains look good. We can reasonably trust the results. Here’s how to get the model summary of our <code>brm()</code> object.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="geocentric-models.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.61      0.41   153.77   155.43 1.00     3285     2401
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     7.76      0.29     7.23     8.35 1.00     4000     2696
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <code>summary()</code> function works in a similar way. You can also get a Stan-like summary [see the <a href="https://CRAN.R-project.org/package=rstan/vignettes/rstan.html"><em>RStan: the R interface to Stan</em></a> vignette; <span class="citation">Stan Development Team (<a href="#ref-standevelopmentteamRStanInterfaceStan2023" role="doc-biblioref">2023</a>)</span>] with a little indexing.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="geocentric-models.html#cb281-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span><span class="sc">$</span>fit</span></code></pre></div>
<pre><code>## Inference for Stan model: d1a1a9941e111c880584a682efcf0a73.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                 mean se_mean   sd     2.5%      25%      50%      75%    97.5% n_eff Rhat
## b_Intercept   154.61    0.01 0.41   153.77   154.34   154.61   154.88   155.43  3337    1
## sigma           7.76    0.00 0.29     7.23     7.56     7.75     7.95     8.35  3985    1
## lprior         -8.51    0.00 0.02    -8.56    -8.53    -8.51    -8.49    -8.46  3332    1
## lp__        -1227.02    0.02 1.00 -1229.71 -1227.39 -1226.71 -1226.31 -1226.06  1634    1
## 
## Samples were drawn using NUTS(diag_e) at Tue Sep 20 16:25:00 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Whereas <strong>rethinking</strong> defaults to 89% intervals, using <code>print()</code> or <code>summary()</code> with <strong>brms</strong> models defaults to 95% intervals. Unless otherwise specified, I will stick with 95% intervals throughout. However, if you really want those 89% intervals, an easy way is with the <code>prob</code> argument within <code>brms::summary()</code> or <code>brms::print()</code>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="geocentric-models.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.1</span>, <span class="at">prob =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.61      0.41   153.95   155.27 1.00     3285     2401
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
## sigma     7.76      0.29     7.31     8.24 1.00     4000     2696
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Anyways, here’s the <code>brms::brm()</code> code for the model with the very-narrow-<span class="math inline">\(\mu\)</span>-prior corresponding to the <code>rethinking::quap()</code> code in McElreath’s <strong>R</strong> code 4.31.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="geocentric-models.html#cb285-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb285-2"><a href="geocentric-models.html#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb285-3"><a href="geocentric-models.html#cb285-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb285-4"><a href="geocentric-models.html#cb285-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb285-5"><a href="geocentric-models.html#cb285-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="fl">0.1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb285-6"><a href="geocentric-models.html#cb285-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb285-7"><a href="geocentric-models.html#cb285-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb285-8"><a href="geocentric-models.html#cb285-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb285-9"><a href="geocentric-models.html#cb285-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.02&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="geocentric-models.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.2</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The chains look great. Here’s the model <code>summary()</code>.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="geocentric-models.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   177.87      0.10   177.66   178.06 1.00     2514     2190
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    24.60      0.93    22.89    26.55 1.00     2613     2290
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Subsetting the <code>summary()</code> output with <code>$fixed</code> provides a convenient way to compare the <code>Intercept</code> summaries between <code>b4.1_hc</code> and <code>b4.2</code>.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="geocentric-models.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">summary</span>(b4<span class="fl">.1</span>)<span class="sc">$</span>fixed,</span>
<span id="cb289-2"><a href="geocentric-models.html#cb289-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(b4<span class="fl">.2</span>)<span class="sc">$</span>fixed)</span></code></pre></div>
<pre><code>##            Estimate Est.Error l-95% CI u-95% CI     Rhat Bulk_ESS Tail_ESS
## Intercept  154.6111 0.4129813 153.7729 155.4321 1.000552 3284.680 2401.409
## Intercept1 177.8663 0.1005478 177.6627 178.0598 1.003814 2514.203 2190.330</code></pre>
</div>
<div id="sampling-from-a-quap-brm-fit." class="section level3 hasAnchor" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.<a href="geocentric-models.html#sampling-from-a-quap-brm-fit." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>brms</strong> doesn’t seem to have a convenience function that works the way <code>vcov()</code> does for <strong>rethinking</strong>. For example:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="geocentric-models.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##           Intercept
## Intercept 0.1705535</code></pre>
<p>This only returns the first element in the matrix it did for <strong>rethinking</strong>. That is, it appears <code>brms::vcov()</code> only returns the variance/covariance matrix for the single-level <span class="math inline">\(\beta\)</span> parameters. However, if you really wanted this information, you could get it after putting the HMC chains in a data frame. We do that with the <code>as_draws_df()</code> function, which we’ll be using a lot of as we go along.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="geocentric-models.html#cb293-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.1</span>)</span>
<span id="cb293-2"><a href="geocentric-models.html#cb293-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-3"><a href="geocentric-models.html#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post)</span></code></pre></div>
<pre><code>## # A draws_df: 6 iterations, 1 chains, and 4 variables
##   b_Intercept sigma lprior  lp__
## 1         155   7.4   -8.5 -1227
## 2         155   8.2   -8.5 -1227
## 3         154   7.6   -8.5 -1227
## 4         155   7.8   -8.5 -1226
## 5         155   8.2   -8.5 -1227
## 6         154   8.4   -8.5 -1228
## # ... hidden reserved variables {&#39;.chain&#39;, &#39;.iteration&#39;, &#39;.draw&#39;}</code></pre>
<p>Now <code>select()</code> the columns containing the draws from the desired parameters and feed them into <code>cov()</code>.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="geocentric-models.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(post, b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="geocentric-models.html#cb295-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span></code></pre></div>
<pre><code>##               b_Intercept         sigma
## b_Intercept  0.1705535224 -0.0002227235
## sigma       -0.0002227235  0.0833750930</code></pre>
<p>That was “(1) a vector of variances for the parameters and (2) a correlation matrix” for them (p. 90). Here are just the variances (i.e., the diagonal elements) and the correlation matrix.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="geocentric-models.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variances</span></span>
<span id="cb297-2"><a href="geocentric-models.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(post, b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb297-3"><a href="geocentric-models.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span></span>
<span id="cb297-4"><a href="geocentric-models.html#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diag</span>()</span></code></pre></div>
<pre><code>## b_Intercept       sigma 
##  0.17055352  0.08337509</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="geocentric-models.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation</span></span>
<span id="cb299-2"><a href="geocentric-models.html#cb299-2" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb299-3"><a href="geocentric-models.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept, sigma) <span class="sc">%&gt;%</span></span>
<span id="cb299-4"><a href="geocentric-models.html#cb299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code></pre></div>
<pre><code>##              b_Intercept        sigma
## b_Intercept  1.000000000 -0.001867745
## sigma       -0.001867745  1.000000000</code></pre>
<p>With our <code>post &lt;- as_draws_df(b4.1)</code> code from a few lines above, we’ve already produced the <strong>brms</strong> version of what McElreath achieved with <code>extract.samples()</code> on page 90. However, what happened under the hood was different. Whereas <strong>rethinking</strong> used the <code>mvnorm()</code> function from the <a href="https://cran.r-project.org/package=MASS"><strong>MASS</strong> package</a> <span class="citation">(<a href="#ref-R-MASS" role="doc-biblioref">Ripley, 2022</a>; <a href="#ref-MASS2002" role="doc-biblioref">Venables &amp; Ripley, 2002</a>)</span>, with <strong>brms</strong> we just extracted the iterations of the HMC chains and put them in a data frame. It’s also noteworthy that the <code>as_draws_df()</code> is part of a larger class of <code>as_draws()</code> functions <strong>brms</strong> currently imports from the <a href="https://github.com/stan-dev/posterior"><strong>posterior</strong> package</a> <span class="citation">(<a href="#ref-R-posterior" role="doc-biblioref">Bürkner et al., 2022</a>)</span>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="geocentric-models.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(post)</span></code></pre></div>
<pre><code>## draws_df [4,000 × 7] (S3: draws_df/draws/tbl_df/tbl/data.frame)
##  $ b_Intercept: num [1:4000] 155 155 154 155 155 ...
##  $ sigma      : num [1:4000] 7.39 8.18 7.58 7.8 8.25 ...
##  $ lprior     : num [1:4000] -8.5 -8.51 -8.53 -8.5 -8.51 ...
##  $ lp__       : num [1:4000] -1227 -1227 -1227 -1226 -1227 ...
##  $ .chain     : int [1:4000] 1 1 1 1 1 1 1 1 1 1 ...
##  $ .iteration : int [1:4000] 1 2 3 4 5 6 7 8 9 10 ...
##  $ .draw      : int [1:4000] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p>Thus, our <code>post</code> object is not just a data frame, but also of class draws_df, which means it contains three metadata variables–<code>.chain</code>, <code>.iteration</code>, and <code>.draw</code>–which will are often hidden from view, but are there in the background when needed. As you’ll see, we’ll make good use of the <code>.draw</code> variable in the future. Notice how our <code>post</code> data frame also includes a vector named <code>lp__</code>. That’s the log posterior. For details, see the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(<a href="#ref-brms2022RM" role="doc-biblioref">Bürkner, 2022i</a>)</span>, the “<a href="https://cran.r-project.org/package=rstan/vignettes/rstan.html#the-log-posterior-function-and-gradient">The Log-Posterior (function and gradient)</a>” section of the Stan Development Team’s <span class="citation">(<a href="#ref-standevelopmentteamRStanInterfaceStan2023" role="doc-biblioref">2023</a>)</span> vignette, <a href="https://cran.r-project.org/package=rstan/vignettes/rstan.html"><em>RStan: the R interface to Stan</em></a>, or <a href="https://twitter.com/smartin2018">Stephen Martin</a>’s <a href="https://discourse.mc-stan.org/t/basic-question-what-is-lp-in-posterior-samples-of-a-brms-regression/17567/2">nice explanation</a> of the log posterior on the Stan Forums. The log posterior will largely be outside of our focus in this ebook.</p>
<p>The <code>summary()</code> function doesn’t work for <strong>brms</strong> posterior data frames quite the way <code>precis()</code> does for posterior data frames from the <strong>rethinking package</strong>. Behold the results.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="geocentric-models.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(post[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>##   b_Intercept        sigma      
##  Min.   :153.3   Min.   :6.818  
##  1st Qu.:154.3   1st Qu.:7.562  
##  Median :154.6   Median :7.755  
##  Mean   :154.6   Mean   :7.764  
##  3rd Qu.:154.9   3rd Qu.:7.953  
##  Max.   :156.2   Max.   :8.784</code></pre>
<p>Here’s one option using the transpose of a <code>quantile()</code> call nested within <code>apply()</code>, which is a very general function you can learn more about <a href="https://www.datacamp.com/community/tutorials/r-tutorial-apply-family#gs.f7fyw2s">here</a> or <a href="https://www.r-bloggers.com/r-tutorial-on-the-apply-family-of-functions/">here</a>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="geocentric-models.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">apply</span>(post[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">025</span>, .<span class="dv">75</span>)))</span></code></pre></div>
<pre><code>##                    50%       2.5%        75%
## b_Intercept 154.605597 153.772880 154.881059
## sigma         7.754982   7.229028   7.952742</code></pre>
<p>The base <strong>R</strong> code is compact, but somewhat opaque. Here’s how to do something similar with more explicit <strong>tidyverse</strong> code.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="geocentric-models.html#cb307-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="geocentric-models.html#cb307-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb307-3"><a href="geocentric-models.html#cb307-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb307-4"><a href="geocentric-models.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb307-5"><a href="geocentric-models.html#cb307-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb307-6"><a href="geocentric-models.html#cb307-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">025</span>),</span>
<span id="cb307-7"><a href="geocentric-models.html#cb307-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb307-8"><a href="geocentric-models.html#cb307-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   name          mean    sd `2.5%` `97.5%`
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 b_Intercept 155.    0.41 154.    155.  
## 2 sigma         7.76  0.29   7.23    8.35</code></pre>
<p>You can always get pretty similar information by just putting the <code>brm()</code> fit object into <code>posterior_summary()</code>.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="geocentric-models.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##                 Estimate Est.Error         Q2.5        Q97.5
## b_Intercept   154.611115 0.4129813   153.772880   155.432077
## sigma           7.763805 0.2887475     7.229028     8.351164
## lprior         -8.510707 0.0241456    -8.560385    -8.463333
## lp__        -1227.019686 0.9983204 -1229.709193 -1226.060608</code></pre>
<p>And if you’re willing to drop the posterior <span class="math inline">\(\textit{SD}\)</span>s, you can use <code>tidybayes::mean_hdi()</code>, too.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="geocentric-models.html#cb311-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb311-2"><a href="geocentric-models.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb311-3"><a href="geocentric-models.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb311-4"><a href="geocentric-models.html#cb311-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 7
##   name         value .lower .upper .width .point .interval
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_Intercept 155.   154.   155.     0.95 mean   qi       
## 2 sigma         7.76   7.23   8.35   0.95 mean   qi</code></pre>
<p>Though none of these solutions get you those sweet little histograms, you can always make those for your HMC models by inserting the desired posterior draws into <code>histospark()</code>.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="geocentric-models.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">histospark</span>(post<span class="sc">$</span>b_Intercept),</span>
<span id="cb313-2"><a href="geocentric-models.html#cb313-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">histospark</span>(post<span class="sc">$</span>sigma))</span></code></pre></div>
<pre><code>##      [,1]        
## [1,] &quot;▁▁▅▇▂▁▁&quot;   
## [2,] &quot;▁▁▂▅▇▇▃▂▁▁&quot;</code></pre>
<p>Hell, you can even tack those onto the output from our verbose <strong>tidyverse</strong> code from a few blocks up.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="geocentric-models.html#cb315-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="geocentric-models.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb315-3"><a href="geocentric-models.html#cb315-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb315-4"><a href="geocentric-models.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb315-5"><a href="geocentric-models.html#cb315-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb315-6"><a href="geocentric-models.html#cb315-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">025</span>),</span>
<span id="cb315-7"><a href="geocentric-models.html#cb315-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb315-8"><a href="geocentric-models.html#cb315-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-9"><a href="geocentric-models.html#cb315-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">histospark =</span> <span class="fu">c</span>(<span class="fu">histospark</span>(post<span class="sc">$</span>b_Intercept), <span class="fu">histospark</span>(post<span class="sc">$</span>sigma)))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   name          mean    sd `2.5%` `97.5%` histospark
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
## 1 b_Intercept 155.    0.41 154.    155.   ▁▁▅▇▂▁▁   
## 2 sigma         7.76  0.29   7.23    8.35 ▁▁▂▅▇▇▃▂▁▁</code></pre>
<div id="overthinking-start-values-for-quap-brm." class="section level4 hasAnchor" number="4.3.6.1">
<h4><span class="header-section-number">4.3.6.1</span> Overthinking: Start values for <del><code>quap()</code></del> <code>brm()</code>.<a href="geocentric-models.html#overthinking-start-values-for-quap-brm." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We won’t be emphasizing start values in this ebook. But, yes, you can set start values for the HMC chains from <strong>brms</strong>, too. Within the <code>brm()</code> function, you do so with the <code>init</code> argument. From the <code>brm</code> section within the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a>, we read:</p>
<blockquote>
<p>Initial values for the sampler. If <code>NULL</code> (the default) or <code>"random"</code>, Stan will randomly generate initial values for parameters in a reasonable range. If <code>0</code>, all parameters are initialized to zero on the unconstrained space. This option is sometimes useful for certain families, as it happens that default random initial values cause draws to be essentially constant. Generally, setting <code>init = 0</code> is worth a try, if chains do not initialize or behave well. Alternatively, <code>init</code> can be a list of lists containing the initial values, or a function (or function name) generating initial values. The latter options are mainly implemented for internal testing but are available to users if necessary. If specifying initial values using a list or a function then currently the parameter names must correspond to the names used in the generated Stan code (not the names used in <code>R</code>).</p>
</blockquote>
</div>
<div id="overthinking-under-the-hood-with-multivariate-sampling." class="section level4 hasAnchor" number="4.3.6.2">
<h4><span class="header-section-number">4.3.6.2</span> Overthinking: Under the hood with multivariate sampling.<a href="geocentric-models.html#overthinking-under-the-hood-with-multivariate-sampling." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Again, <code>brms::as_draws_df()</code> is not the same as <code>rethinking::extract.samples()</code>. Rather than use the <code>MASS::mvnorm()</code>, <strong>brms</strong> takes the draws from the HMC chains. McElreath covered all of this in <a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo">Chapter 9</a> and we will too. You might also look at the <a href="https://cran.r-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> or <a href="https://github.com/paul-buerkner/brms">GitHub page</a> for details. To get documentation in a hurry, you could also just execute <code>?as_draws_df</code>.</p>
</div>
</div>
</div>
<div id="linear-prediction" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Linear prediction<a href="geocentric-models.html#linear-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here’s our scatter plot of <code>weight</code> and <code>height</code>.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="geocentric-models.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d2, </span>
<span id="cb317-2"><a href="geocentric-models.html#cb317-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb317-3"><a href="geocentric-models.html#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb317-4"><a href="geocentric-models.html#cb317-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb317-5"><a href="geocentric-models.html#cb317-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-66-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>There’s obviously a relationship: Knowing a person’s weight helps you predict height.</p>
<p>To make this vague observation into a more precise quantitative model that relates values of <code>weight</code> to plausible values of <code>height</code>, we need some more technology. How do we take our Gaussian model from the previous section and incorporate predictor variables? (p. 92)</p>
</blockquote>
<div id="the-linear-model-strategy." class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> The linear model strategy.<a href="geocentric-models.html#the-linear-model-strategy." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The strategy is to make the parameter for the mean of a Gaussian distribution, <span class="math inline">\(\mu\)</span>, into a linear function of the predictor variable and other, new parameters that we invent. This strategy is often simply called the <strong>linear model</strong>. The linear model strategy instructs the golem to assume that the predictor variable has a constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship. (p. 92, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>Like we did for our first model without a predictor, we’ll use font color to help differentiate between the likelihood and prior(s) of our new univariable model,</p>
<p><span class="math display">\[\begin{align*}
\color{red}{\text{height}_i} &amp; \color{red}\sim \color{red}{\operatorname{Normal}(\mu_i, \sigma)} &amp;&amp; \color{red}{\text{likelihood}} \\
\color{red}{\mu_i} &amp; \color{red}= \color{red}{\alpha + \beta (\text{weight}_i - \overline{\text{weight}})}  &amp;&amp; \color{red}{\text{\{the linear model is just a special part of the likelihood\}} } \\
\color{blue}\alpha &amp; \color{blue}\sim \color{blue}{\operatorname{Normal}(178, 20)} &amp;&amp; \color{blue}{\text{prior(s)}} \\
\color{blue}\beta  &amp; \color{blue}\sim \color{blue}{\operatorname{Normal}(0, 10)} \\
\color{blue}\sigma &amp; \color{blue}\sim \color{blue}{\operatorname{Uniform}(0, 50)}.
\end{align*}\]</span></p>
<p>Do note that <span class="math inline">\((\text{weight}_i - \overline{\text{weight}})\)</span> part. As we’ll see, it’s often advantageous to mean center our predictors.</p>
<div id="probability-of-the-data." class="section level4 hasAnchor" number="4.4.1.1">
<h4><span class="header-section-number">4.4.1.1</span> Probability of the data.<a href="geocentric-models.html#probability-of-the-data." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>Let’s begin with just the probability of the observed height, the first line of the model. This is nearly identical to before, except now there is a little index <span class="math inline">\(i\)</span> on the <span class="math inline">\(\mu\)</span> as well as the [<span class="math inline">\(\text{height}\)</span>]. You can read [<span class="math inline">\(\text{height}_i\)</span>] as “each [<span class="math inline">\(\text{height}\)</span>]” and <span class="math inline">\(\mu_i\)</span> as “each <span class="math inline">\(\mu\)</span>.” The mean <span class="math inline">\(\mu\)</span> now depends upon unique values on each row <span class="math inline">\(i\)</span>. So the little <span class="math inline">\(i\)</span> on <span class="math inline">\(\mu_i\)</span> indicates that <em>the mean depends upon the row</em>. (p. 93, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="linear-model." class="section level4 hasAnchor" number="4.4.1.2">
<h4><span class="header-section-number">4.4.1.2</span> Linear model.<a href="geocentric-models.html#linear-model." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The mean <span class="math inline">\(\mu\)</span> is no longer a parameter to be estimated. Rather, as seen in the second line of the model, <span class="math inline">\(\mu_i\)</span> is constructed from other parameters, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, and the observed variable [<span class="math inline">\(\text{weight}\)</span>]. This line is not a stochastic relationship–there is no <span class="math inline">\(\sim\)</span> in it, but rather an <span class="math inline">\(=\)</span> in it–because the definition of <span class="math inline">\(\mu_i\)</span> is deterministic. That is to say that, once we know <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> and [<span class="math inline">\(\text{weight}_i\)</span>], we know <span class="math inline">\(\mu_i\)</span> with certainty.</p>
<p>The value [<span class="math inline">\(\text{weight}_i\)</span>] is just the weight value on row <span class="math inline">\(i\)</span>. It refers to the same individual as the height value, [<span class="math inline">\(\text{height}_i\)</span>], on the same row. The parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are more mysterious. Where did they come from? We made them up….</p>
<p>You’ll be making up all manner of parameters as your skills improve. (p. 93)</p>
</blockquote>
<div id="rethinking-nothing-special-or-natural-about-linear-models." class="section level5 hasAnchor" number="4.4.1.2.1">
<h5><span class="header-section-number">4.4.1.2.1</span> Rethinking: Nothing special or natural about linear models.<a href="geocentric-models.html#rethinking-nothing-special-or-natural-about-linear-models." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<blockquote>
<p>Note that there’s nothing special about the linear model, really. You can choose a different relationship between <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\mu\)</span>. For example, the following is a perfectly legitimate definition for <span class="math inline">\(\mu_i\)</span>:</p>
<p><span class="math display">\[\mu_i = \alpha \exp(- \beta x_i)\]</span></p>
<p>This does not define a linear regression, but it does define a regression model. The linear relationship we are using instead is conventional, but nothing requires that you use it. (p. 94)</p>
</blockquote>
</div>
</div>
<div id="priors." class="section level4 hasAnchor" number="4.4.1.3">
<h4><span class="header-section-number">4.4.1.3</span> Priors.<a href="geocentric-models.html#priors." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p>The remaining lines in the model define distributions for the unobserved variables. These variables are commonly known as parameters, and their distributions as priors. There are three parameters: <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma\)</span>. You’ve seen priors for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\sigma\)</span> before, although <span class="math inline">\(\alpha\)</span> was called <span class="math inline">\(\mu\)</span> back then.</p>
<p>The prior for <span class="math inline">\(\beta\)</span> deserves explanation. Why have a Gaussian prior with mean zero? (p. 94)</p>
</blockquote>
<p>We’ll simulate to find out. Instead of using a loop to make our data for Figure 4.5, we’ll stay within the <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="geocentric-models.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb318-2"><a href="geocentric-models.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="co"># how many lines would you like?</span></span>
<span id="cb318-3"><a href="geocentric-models.html#cb318-3" aria-hidden="true" tabindex="-1"></a>n_lines <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb318-4"><a href="geocentric-models.html#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="geocentric-models.html#cb318-5" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span></span>
<span id="cb318-6"><a href="geocentric-models.html#cb318-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>n_lines,</span>
<span id="cb318-7"><a href="geocentric-models.html#cb318-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> <span class="fu">rnorm</span>(n_lines, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb318-8"><a href="geocentric-models.html#cb318-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">rnorm</span>(n_lines, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb318-9"><a href="geocentric-models.html#cb318-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">weight =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb318-10"><a href="geocentric-models.html#cb318-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)))</span>
<span id="cb318-11"><a href="geocentric-models.html#cb318-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-12"><a href="geocentric-models.html#cb318-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lines)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##       n     a      b weight height
##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1  191. -7.06    31.1  289. 
## 2     1  191. -7.06    63.0   63.5
## 3     2  199.  0.839   31.1  187. 
## 4     2  199.  0.839   63.0  214. 
## 5     3  202.  3.93    31.1  147. 
## 6     3  202.  3.93    63.0  272.</code></pre>
<p>Now we’ll plot the left panel from Figure 4.5.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="geocentric-models.html#cb320-1" aria-hidden="true" tabindex="-1"></a>lines <span class="sc">%&gt;%</span> </span>
<span id="cb320-2"><a href="geocentric-models.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height, <span class="at">group =</span> n)) <span class="sc">+</span></span>
<span id="cb320-3"><a href="geocentric-models.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">linetype =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb320-4"><a href="geocentric-models.html#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb320-5"><a href="geocentric-models.html#cb320-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="sc">+</span></span>
<span id="cb320-6"><a href="geocentric-models.html#cb320-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;b ~ dnorm(0, 10)&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-7"><a href="geocentric-models.html#cb320-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-68-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The pattern doesn’t look like any human population at all. It essentially says that the relationship between weight and height could be absurdly positive or negative. Before we’ve even seen the data, this is a bad model. Can we do better?</p>
<p>We can do better immediately. (pp. 95–96)</p>
</blockquote>
<p>One thing we know from the outset is that the correlation between human height and weight is positive. We might not be sure of the magnitude, but it’s definitely the case that, on average, taller people are heavier people. Within the univariable regression context, this implies that the regression coefficient for <code>weight</code> predicting <code>height</code> will be positive. It might be unclear how large that coefficient will be, but it will certainly be above zero. One way we might encode this information in our data is by using the log-normal distribution for our <span class="math inline">\(\beta\)</span> prior. Here’s what <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span> looks like.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="geocentric-models.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb321-2"><a href="geocentric-models.html#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="geocentric-models.html#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">b =</span> <span class="fu">rlnorm</span>(<span class="fl">1e4</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb321-4"><a href="geocentric-models.html#cb321-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b)) <span class="sc">+</span></span>
<span id="cb321-5"><a href="geocentric-models.html#cb321-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>) <span class="sc">+</span></span>
<span id="cb321-6"><a href="geocentric-models.html#cb321-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb321-7"><a href="geocentric-models.html#cb321-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-69-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you’re unfamiliar with the log-normal distribution, it is the distribution whose logarithm is normally distributed. For example, here’s what happens when we compare <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> with <span class="math inline">\(\log \big ( \operatorname{Log-Normal}(0, 1) \big)\)</span>.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="geocentric-models.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb322-2"><a href="geocentric-models.html#cb322-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-3"><a href="geocentric-models.html#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">rnorm           =</span> <span class="fu">rnorm</span>(<span class="fl">1e5</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb322-4"><a href="geocentric-models.html#cb322-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">log(rlognorm)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="fu">rlnorm</span>(<span class="fl">1e5</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb322-5"><a href="geocentric-models.html#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb322-6"><a href="geocentric-models.html#cb322-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-7"><a href="geocentric-models.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb322-8"><a href="geocentric-models.html#cb322-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey92&quot;</span>) <span class="sc">+</span></span>
<span id="cb322-9"><a href="geocentric-models.html#cb322-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb322-10"><a href="geocentric-models.html#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb322-11"><a href="geocentric-models.html#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-70-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>They are the same within simulation variance. Also, did you notice how we simulated those log-normal data with <code>mean = 0, sd = 1</code>? Those values are what the mean and standard deviation of the output from the <code>rlnorm()</code> function <strong>after</strong> they are log transformed. The formulas for the actual mean and standard deviation for the log-normal distribution itself are complicated (see <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">here</a>). They are</p>
<p><span class="math display">\[\begin{align*}
\text{mean}               &amp; = \exp \left (\mu + \frac{\sigma^2}{2} \right) &amp; \text{and} \\
\text{standard deviation} &amp; = \sqrt{[\exp(\sigma ^{2})-1] \; \exp(2\mu +\sigma ^{2})}.
\end{align*}\]</span></p>
<p>Let’s try our hand at those formulas and compute the mean and standard deviation for <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span>.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="geocentric-models.html#cb323-1" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb323-2"><a href="geocentric-models.html#cb323-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb323-3"><a href="geocentric-models.html#cb323-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-4"><a href="geocentric-models.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb323-5"><a href="geocentric-models.html#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(mu <span class="sc">+</span> (sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1.648721</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="geocentric-models.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sd</span></span>
<span id="cb325-2"><a href="geocentric-models.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>((<span class="fu">exp</span>(sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="dv">2</span> <span class="sc">*</span> mu <span class="sc">+</span> sigma<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2.161197</code></pre>
<p>Let’s confirm with simulated draws from <code>rlnorm()</code>.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="geocentric-models.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb327-2"><a href="geocentric-models.html#cb327-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-3"><a href="geocentric-models.html#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rlnorm</span>(<span class="fl">1e7</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-4"><a href="geocentric-models.html#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb327-5"><a href="geocentric-models.html#cb327-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(x))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##    mean    sd
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  1.65  2.17</code></pre>
<p>But okay, “so what [do all these complications] earn us? Do the prior predictive simulation again, now with the Log-Normal prior:” (p. 96).</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="geocentric-models.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a tibble to annotate the plot</span></span>
<span id="cb329-2"><a href="geocentric-models.html#cb329-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb329-3"><a href="geocentric-models.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">43</span>),</span>
<span id="cb329-4"><a href="geocentric-models.html#cb329-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span> <span class="sc">-</span> <span class="dv">25</span>, <span class="dv">272</span> <span class="sc">+</span> <span class="dv">25</span>),</span>
<span id="cb329-5"><a href="geocentric-models.html#cb329-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">c</span>(<span class="st">&quot;Embryo&quot;</span>, <span class="st">&quot;World&#39;s tallest person (272 cm)&quot;</span>))</span>
<span id="cb329-6"><a href="geocentric-models.html#cb329-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-7"><a href="geocentric-models.html#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb329-8"><a href="geocentric-models.html#cb329-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb329-9"><a href="geocentric-models.html#cb329-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-10"><a href="geocentric-models.html#cb329-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>n_lines,</span>
<span id="cb329-11"><a href="geocentric-models.html#cb329-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">a =</span> <span class="fu">rnorm</span>(n_lines, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb329-12"><a href="geocentric-models.html#cb329-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">b =</span> <span class="fu">rlnorm</span>(n_lines, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-13"><a href="geocentric-models.html#cb329-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">weight =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-14"><a href="geocentric-models.html#cb329-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))) <span class="sc">%&gt;%</span></span>
<span id="cb329-15"><a href="geocentric-models.html#cb329-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb329-16"><a href="geocentric-models.html#cb329-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb329-17"><a href="geocentric-models.html#cb329-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height, <span class="at">group =</span> n)) <span class="sc">+</span></span>
<span id="cb329-18"><a href="geocentric-models.html#cb329-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">linetype =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb329-19"><a href="geocentric-models.html#cb329-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb329-20"><a href="geocentric-models.html#cb329-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb329-21"><a href="geocentric-models.html#cb329-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb329-22"><a href="geocentric-models.html#cb329-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb329-23"><a href="geocentric-models.html#cb329-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="sc">+</span></span>
<span id="cb329-24"><a href="geocentric-models.html#cb329-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;log(b) ~ dnorm(0, 1)&quot;</span>) <span class="sc">+</span></span>
<span id="cb329-25"><a href="geocentric-models.html#cb329-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-72-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>“This is much more sensible. There is still a rare impossible relationship. But nearly all lines in the joint prior for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are now within human reason” (p. 96)</p>
<div id="rethinking-whats-the-correct-prior" class="section level5 hasAnchor" number="4.4.1.3.1">
<h5><span class="header-section-number">4.4.1.3.1</span> Rethinking: What’s the correct prior?<a href="geocentric-models.html#rethinking-whats-the-correct-prior" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Good luck with that question. Hang around on academic Twitter long enough and you’ll see folks debating this.</p>
<blockquote>
<p>This is a mistake. There is no more a uniquely correct prior than there is a uniquely correct likelihood. Statistical models are machines for inference. Many machines will work, but some work better than others. Priors can be wrong, but only in the same sense that a kind of hammer can be wrong for building a table. (p. 96)</p>
</blockquote>
</div>
<div id="rethinking-prior-predictive-simulation-and-p-hacking." class="section level5 hasAnchor" number="4.4.1.3.2">
<h5><span class="header-section-number">4.4.1.3.2</span> Rethinking: Prior predictive simulation and <span class="math inline">\(p\)</span>-hacking.<a href="geocentric-models.html#rethinking-prior-predictive-simulation-and-p-hacking." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>“We don’t pay any attention to <span class="math inline">\(p\)</span>-values in this book” (p. 97). Off hand, I’m not sure of the exact origin of the term <span class="math inline">\(p\)</span>-hacking. But the paper by Simmons, Nelson and Simonsohn <span class="citation">(<a href="#ref-simmonsFalsepositivePsychologyUndisclosed2011" role="doc-biblioref">2011</a>)</span>, <a href="https://doi.org/10.1177/0956797611417632"><em>False-positive psychology: Undisclosed flexibility in data collection and analysis allows presenting anything as significant</em></a>, is often cited as an introduction to the problem.</p>
</div>
</div>
</div>
<div id="finding-the-posterior-distribution." class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Finding the posterior distribution.<a href="geocentric-models.html#finding-the-posterior-distribution." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unlike with McElreath’s <code>quap()</code> formula syntax, I’m not aware that you can just specify something like <code>weight – xbar</code> in the <code>formula</code> argument in <code>brm()</code>. However, the alternative is easy: Just make a new variable in the data that is equivalent to <code>weight – mean(weight)</code>. We’ll call it <code>weight_c</code>.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="geocentric-models.html#cb330-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb330-2"><a href="geocentric-models.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span> </span>
<span id="cb330-3"><a href="geocentric-models.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span></code></pre></div>
<p>Unlike with McElreath’s <strong>rethinking</strong> package, the conventional <code>brms::brm()</code> syntax doesn’t mirror the statistical notation. But here are the analogues to the exposition at the bottom of page 97:</p>
<ul>
<li><span class="math inline">\(\text{height}_i \sim \operatorname{Normal}(\mu_i, \sigma)\)</span>: <code>family = gaussian</code>,</li>
<li><span class="math inline">\(\mu_i = \alpha + \beta \text{weight}_i\)</span>: <code>height ~ 1 + weight_c</code>,</li>
<li><span class="math inline">\(\alpha \sim \operatorname{Normal}(178, 20)\)</span>: <code>prior(normal(178, 20), class = Intercept</code>,</li>
<li><span class="math inline">\(\beta \sim \operatorname{Log-Normal}(0, 1)\)</span>: <code>prior(lognormal(0, 1), class = b)</code>, and</li>
<li><span class="math inline">\(\sigma \sim \operatorname{Uniform}(0, 50)\)</span>: <code>prior(uniform(0, 50), class = sigma)</code>.</li>
</ul>
<p>Thus, to add a predictor you just the <code>+</code> operator in the model <code>formula</code>.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="geocentric-models.html#cb331-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb331-2"><a href="geocentric-models.html#cb331-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb331-3"><a href="geocentric-models.html#cb331-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb331-4"><a href="geocentric-models.html#cb331-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb331-5"><a href="geocentric-models.html#cb331-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb331-6"><a href="geocentric-models.html#cb331-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb331-7"><a href="geocentric-models.html#cb331-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb331-8"><a href="geocentric-models.html#cb331-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb331-9"><a href="geocentric-models.html#cb331-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb331-10"><a href="geocentric-models.html#cb331-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03&quot;</span>)</span></code></pre></div>
<p>Here are the trace plots.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="geocentric-models.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-74-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="overthinking-logs-and-exps-oh-my." class="section level4 hasAnchor" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> Overthinking: Logs and exps, oh my.<a href="geocentric-models.html#overthinking-logs-and-exps-oh-my." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>brms</strong> does not allow users to insert coefficients into functions like <span class="math inline">\(\exp()\)</span> within the conventional <code>formula</code> syntax. We can fit a <strong>brms</strong> model like McElreath’s <code>m4.3b</code> if we adopt what’s called the non-linear syntax <span class="citation">(<a href="#ref-Bürkner2022Non_linear" role="doc-biblioref">Bürkner, 2022e</a>)</span>. The non-linear syntax is a lot like the syntax McElreath uses in <strong>rethinking</strong> in that it typically includes both predictor and variable names in the <code>formula</code>. Since this is so early in the book and we’re just working through a problem in an <strong>Overthinking</strong> tangent, I won’t go into a full-blown explanation, here. There will be many more opportunities to practice with the non-linear syntax in the chapters to come (e.g., <a href="the-many-variables-the-spurious-waffles.html#many-categories.">Section 5.3.2</a>, <a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born.">Section 6.2.1</a>). For now, here’s how we might fit the model.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="geocentric-models.html#cb333-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>b <span class="ot">&lt;-</span> </span>
<span id="cb333-2"><a href="geocentric-models.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb333-3"><a href="geocentric-models.html#cb333-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb333-4"><a href="geocentric-models.html#cb333-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(height <span class="sc">~</span> a <span class="sc">+</span> <span class="fu">exp</span>(lb) <span class="sc">*</span> weight_c,</span>
<span id="cb333-5"><a href="geocentric-models.html#cb333-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb333-6"><a href="geocentric-models.html#cb333-6" aria-hidden="true" tabindex="-1"></a>         lb <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb333-7"><a href="geocentric-models.html#cb333-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb333-8"><a href="geocentric-models.html#cb333-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a),</span>
<span id="cb333-9"><a href="geocentric-models.html#cb333-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> lb),</span>
<span id="cb333-10"><a href="geocentric-models.html#cb333-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb333-11"><a href="geocentric-models.html#cb333-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb333-12"><a href="geocentric-models.html#cb333-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb333-13"><a href="geocentric-models.html#cb333-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03b&quot;</span>)</span></code></pre></div>
<p>If you execute <code>summary(b4.3b)</code>, you’ll see the intercept and <span class="math inline">\(\sigma\)</span> summaries for this model are about the same as those for <code>b4.3</code>, above. The difference is for the <span class="math inline">\(\beta\)</span> parameter, which we called <code>lb</code> in the <code>b4.3b</code> model. If we term that parameter from <code>b4.3</code> as <span class="math inline">\(\beta^\text{b4.3}\)</span> and the one from our new model <span class="math inline">\(\beta^\text{b4.3b}\)</span>, it turns out that <span class="math inline">\(\beta^\text{b4.3} = \exp \left (\beta^\text{b4.3b} \right )\)</span>.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="geocentric-models.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b4<span class="fl">.3</span>)[<span class="st">&quot;weight_c&quot;</span>, <span class="st">&quot;Estimate&quot;</span>]</span></code></pre></div>
<pre><code>## [1] 0.9033555</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="geocentric-models.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b4<span class="fl">.3</span>b)[<span class="st">&quot;lb_Intercept&quot;</span>, <span class="st">&quot;Estimate&quot;</span>] <span class="sc">%&gt;%</span> <span class="fu">exp</span>()</span></code></pre></div>
<pre><code>## [1] 0.9019411</code></pre>
<p>They’re the same within simulation variance.</p>
</div>
</div>
<div id="interpreting-the-posterior-distribution." class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Interpreting the posterior distribution.<a href="geocentric-models.html#interpreting-the-posterior-distribution." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>“One trouble with statistical models is that they are hard to understand” (p. 99). Welcome to the world of applied statistics, friends. 😅</p>
<div id="rethinking-what-do-parameters-mean" class="section level5 hasAnchor" number="4.4.3.0.1">
<h5><span class="header-section-number">4.4.3.0.1</span> Rethinking: What do parameters mean?<a href="geocentric-models.html#rethinking-what-do-parameters-mean" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<blockquote>
<p>A basic issue with interpreting model-based estimates is in knowing the meaning of parameters. There is no consensus about what a parameter means, however, because different people take different philosophical stances towards models, probability, and prediction. The perspective in this book is a common Bayesian perspective: <em>Posterior probabilities of parameter values describe the relative compatibility of different states of the world with the data, according to the model</em>. (p. 99, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="tables-of-marginal-distributions." class="section level4 hasAnchor" number="4.4.3.1">
<h4><span class="header-section-number">4.4.3.1</span> Tables of marginal distributions.<a href="geocentric-models.html#tables-of-marginal-distributions." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With a little <code>[]</code> subsetting we can exclude the log posterior from our summary for <code>b4.3</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="geocentric-models.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="geocentric-models.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept    154.6      0.27 154.09 155.12
## b_weight_c       0.9      0.04   0.82   0.99
## sigma            5.1      0.19   4.74   5.50</code></pre>
<p>If we put our <strong>brms</strong> fit into the <code>vcov()</code> function, we’ll get the variance/covariance matrix of the intercept and <code>weight_c</code> coefficient.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="geocentric-models.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(b4<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb340-2"><a href="geocentric-models.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           Intercept weight_c
## Intercept     0.072    0.000
## weight_c      0.000    0.002</code></pre>
<p>No <span class="math inline">\(\sigma\)</span>, however. To get that, we’ll have to extract the posterior draws and use the <code>cov()</code> function, instead.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="geocentric-models.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="geocentric-models.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="geocentric-models.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span></span>
<span id="cb342-4"><a href="geocentric-models.html#cb342-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##             b_Intercept b_weight_c  sigma
## b_Intercept       0.072      0.000 -0.001
## b_weight_c        0.000      0.002  0.000
## sigma            -0.001      0.000  0.036</code></pre>
<p>The <code>pairs()</code> function will work for a <strong>brms</strong> fit much like it would one from <strong>rethinking</strong>. It will show “both the marginal posteriors and the covariance” (p. 100).</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="geocentric-models.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b4<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-79-1.png" width="432" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-posterior-inference-against-the-data." class="section level4 hasAnchor" number="4.4.3.2">
<h4><span class="header-section-number">4.4.3.2</span> Plotting posterior inference against the data.<a href="geocentric-models.html#plotting-posterior-inference-against-the-data." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>“It’s almost always much more useful to plot the posterior inference against the data. Not only does plotting help in interpreting the posterior, but it also provides an informal check on model assumptions” (p. 100).</p>
<p>Here is the code for Figure 4.6. Note our use of the <code>fixef()</code> function within <code>geom_abline()</code>.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="geocentric-models.html#cb345-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb345-2"><a href="geocentric-models.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb345-3"><a href="geocentric-models.html#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span>], </span>
<span id="cb345-4"><a href="geocentric-models.html#cb345-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb345-5"><a href="geocentric-models.html#cb345-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb345-6"><a href="geocentric-models.html#cb345-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-80-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Note how the breaks on our <span class="math inline">\(x\)</span>-axis look off. That’s because we fit the model with <code>weight_c</code> and we plotted the points in that metric, too. Since we computed <code>weight_c</code> by subtracting the mean of <code>weight</code> from the data, we can adjust the <span class="math inline">\(x\)</span>-axis break point labels by simply adding that value back.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="geocentric-models.html#cb346-1" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span></span>
<span id="cb346-2"><a href="geocentric-models.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight) <span class="sc">%&gt;%</span> </span>
<span id="cb346-3"><a href="geocentric-models.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb346-4"><a href="geocentric-models.html#cb346-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-5"><a href="geocentric-models.html#cb346-5" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb346-6"><a href="geocentric-models.html#cb346-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb346-7"><a href="geocentric-models.html#cb346-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span>], </span>
<span id="cb346-8"><a href="geocentric-models.html#cb346-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb346-9"><a href="geocentric-models.html#cb346-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb346-10"><a href="geocentric-models.html#cb346-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>,</span>
<span id="cb346-11"><a href="geocentric-models.html#cb346-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb346-12"><a href="geocentric-models.html#cb346-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb346-13"><a href="geocentric-models.html#cb346-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb346-14"><a href="geocentric-models.html#cb346-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-81-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-uncertainty-around-the-mean." class="section level4 hasAnchor" number="4.4.3.3">
<h4><span class="header-section-number">4.4.3.3</span> Adding uncertainty around the mean.<a href="geocentric-models.html#adding-uncertainty-around-the-mean." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Be default, we extract all the posterior draws with <code>as_draws_df()</code>.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="geocentric-models.html#cb347-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>)</span>
<span id="cb347-2"><a href="geocentric-models.html#cb347-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-3"><a href="geocentric-models.html#cb347-3" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb347-4"><a href="geocentric-models.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)  <span class="co"># this serves a similar function as `head()`</span></span></code></pre></div>
<pre><code>## # A draws_df: 5 iterations, 1 chains, and 5 variables
##   b_Intercept b_weight_c sigma lprior  lp__
## 1         154       0.87   4.9   -9.3 -1080
## 2         155       0.97   5.4   -9.4 -1081
## 3         155       0.86   4.9   -9.3 -1080
## 4         155       0.93   5.5   -9.3 -1082
## 5         154       0.93   5.1   -9.4 -1079
## # ... hidden reserved variables {&#39;.chain&#39;, &#39;.iteration&#39;, &#39;.draw&#39;}</code></pre>
<p>Here are the four models leading up to McElreath’s Figure 4.7.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="geocentric-models.html#cb349-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb349-2"><a href="geocentric-models.html#cb349-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-3"><a href="geocentric-models.html#cb349-3" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_010 <span class="ot">&lt;-</span> </span>
<span id="cb349-4"><a href="geocentric-models.html#cb349-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb349-5"><a href="geocentric-models.html#cb349-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N),  <span class="co"># note our tricky use of `N` and `slice()`</span></span>
<span id="cb349-6"><a href="geocentric-models.html#cb349-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb349-7"><a href="geocentric-models.html#cb349-7" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb349-8"><a href="geocentric-models.html#cb349-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb349-9"><a href="geocentric-models.html#cb349-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb349-10"><a href="geocentric-models.html#cb349-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb349-11"><a href="geocentric-models.html#cb349-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb349-12"><a href="geocentric-models.html#cb349-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb349-13"><a href="geocentric-models.html#cb349-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03_010&quot;</span>)</span>
<span id="cb349-14"><a href="geocentric-models.html#cb349-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-15"><a href="geocentric-models.html#cb349-15" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb349-16"><a href="geocentric-models.html#cb349-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-17"><a href="geocentric-models.html#cb349-17" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_050 <span class="ot">&lt;-</span> </span>
<span id="cb349-18"><a href="geocentric-models.html#cb349-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb349-19"><a href="geocentric-models.html#cb349-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb349-20"><a href="geocentric-models.html#cb349-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb349-21"><a href="geocentric-models.html#cb349-21" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb349-22"><a href="geocentric-models.html#cb349-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb349-23"><a href="geocentric-models.html#cb349-23" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb349-24"><a href="geocentric-models.html#cb349-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb349-25"><a href="geocentric-models.html#cb349-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb349-26"><a href="geocentric-models.html#cb349-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb349-27"><a href="geocentric-models.html#cb349-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03_050&quot;</span>)</span>
<span id="cb349-28"><a href="geocentric-models.html#cb349-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-29"><a href="geocentric-models.html#cb349-29" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb349-30"><a href="geocentric-models.html#cb349-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-31"><a href="geocentric-models.html#cb349-31" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_150 <span class="ot">&lt;-</span> </span>
<span id="cb349-32"><a href="geocentric-models.html#cb349-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb349-33"><a href="geocentric-models.html#cb349-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb349-34"><a href="geocentric-models.html#cb349-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb349-35"><a href="geocentric-models.html#cb349-35" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb349-36"><a href="geocentric-models.html#cb349-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb349-37"><a href="geocentric-models.html#cb349-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb349-38"><a href="geocentric-models.html#cb349-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb349-39"><a href="geocentric-models.html#cb349-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb349-40"><a href="geocentric-models.html#cb349-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb349-41"><a href="geocentric-models.html#cb349-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03_150&quot;</span>)</span>
<span id="cb349-42"><a href="geocentric-models.html#cb349-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-43"><a href="geocentric-models.html#cb349-43" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">352</span></span>
<span id="cb349-44"><a href="geocentric-models.html#cb349-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-45"><a href="geocentric-models.html#cb349-45" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.3</span>_352 <span class="ot">&lt;-</span> </span>
<span id="cb349-46"><a href="geocentric-models.html#cb349-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2 <span class="sc">%&gt;%</span></span>
<span id="cb349-47"><a href="geocentric-models.html#cb349-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb349-48"><a href="geocentric-models.html#cb349-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb349-49"><a href="geocentric-models.html#cb349-49" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_c,</span>
<span id="cb349-50"><a href="geocentric-models.html#cb349-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb349-51"><a href="geocentric-models.html#cb349-51" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb349-52"><a href="geocentric-models.html#cb349-52" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb349-53"><a href="geocentric-models.html#cb349-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb349-54"><a href="geocentric-models.html#cb349-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb349-55"><a href="geocentric-models.html#cb349-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.03_352&quot;</span>)</span></code></pre></div>
<p>I’m not going to clutter up the document with all the trace plots and coefficient summaries from these four models. But here’s how to get that information.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="geocentric-models.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>_010)</span>
<span id="cb350-2"><a href="geocentric-models.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_010)</span>
<span id="cb350-3"><a href="geocentric-models.html#cb350-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-4"><a href="geocentric-models.html#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>_050)</span>
<span id="cb350-5"><a href="geocentric-models.html#cb350-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_050)</span>
<span id="cb350-6"><a href="geocentric-models.html#cb350-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-7"><a href="geocentric-models.html#cb350-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>_150)</span>
<span id="cb350-8"><a href="geocentric-models.html#cb350-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_150)</span>
<span id="cb350-9"><a href="geocentric-models.html#cb350-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-10"><a href="geocentric-models.html#cb350-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.3</span>_352)</span>
<span id="cb350-11"><a href="geocentric-models.html#cb350-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.3</span>_352)</span></code></pre></div>
<p>We’ll need to put the chains of each model into data frames.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="geocentric-models.html#cb351-1" aria-hidden="true" tabindex="-1"></a>post010 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>_010)</span>
<span id="cb351-2"><a href="geocentric-models.html#cb351-2" aria-hidden="true" tabindex="-1"></a>post050 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>_050)</span>
<span id="cb351-3"><a href="geocentric-models.html#cb351-3" aria-hidden="true" tabindex="-1"></a>post150 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>_150)</span>
<span id="cb351-4"><a href="geocentric-models.html#cb351-4" aria-hidden="true" tabindex="-1"></a>post352 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.3</span>_352)</span></code></pre></div>
<p>Here is the code for the four individual plots.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="geocentric-models.html#cb352-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb352-2"><a href="geocentric-models.html#cb352-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], </span>
<span id="cb352-3"><a href="geocentric-models.html#cb352-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb352-4"><a href="geocentric-models.html#cb352-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> post010 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb352-5"><a href="geocentric-models.html#cb352-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> b_Intercept, <span class="at">slope =</span> b_weight_c),</span>
<span id="cb352-6"><a href="geocentric-models.html#cb352-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb352-7"><a href="geocentric-models.html#cb352-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-8"><a href="geocentric-models.html#cb352-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight_c),</span>
<span id="cb352-9"><a href="geocentric-models.html#cb352-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb352-10"><a href="geocentric-models.html#cb352-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;N = 10&quot;</span>)</span>
<span id="cb352-11"><a href="geocentric-models.html#cb352-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-12"><a href="geocentric-models.html#cb352-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb352-13"><a href="geocentric-models.html#cb352-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, ], </span>
<span id="cb352-14"><a href="geocentric-models.html#cb352-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb352-15"><a href="geocentric-models.html#cb352-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> post050 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb352-16"><a href="geocentric-models.html#cb352-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> b_Intercept, <span class="at">slope =</span> b_weight_c),</span>
<span id="cb352-17"><a href="geocentric-models.html#cb352-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb352-18"><a href="geocentric-models.html#cb352-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-19"><a href="geocentric-models.html#cb352-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight_c),</span>
<span id="cb352-20"><a href="geocentric-models.html#cb352-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb352-21"><a href="geocentric-models.html#cb352-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;N = 50&quot;</span>)</span>
<span id="cb352-22"><a href="geocentric-models.html#cb352-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-23"><a href="geocentric-models.html#cb352-23" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb352-24"><a href="geocentric-models.html#cb352-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>, ], </span>
<span id="cb352-25"><a href="geocentric-models.html#cb352-25" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb352-26"><a href="geocentric-models.html#cb352-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> post150 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb352-27"><a href="geocentric-models.html#cb352-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> b_Intercept, <span class="at">slope =</span> b_weight_c),</span>
<span id="cb352-28"><a href="geocentric-models.html#cb352-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb352-29"><a href="geocentric-models.html#cb352-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-30"><a href="geocentric-models.html#cb352-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight_c),</span>
<span id="cb352-31"><a href="geocentric-models.html#cb352-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb352-32"><a href="geocentric-models.html#cb352-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;N = 150&quot;</span>)</span>
<span id="cb352-33"><a href="geocentric-models.html#cb352-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-34"><a href="geocentric-models.html#cb352-34" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> </span>
<span id="cb352-35"><a href="geocentric-models.html#cb352-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span>  d2[<span class="dv">1</span><span class="sc">:</span><span class="dv">352</span>, ], </span>
<span id="cb352-36"><a href="geocentric-models.html#cb352-36" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight_c, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb352-37"><a href="geocentric-models.html#cb352-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> post352 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),</span>
<span id="cb352-38"><a href="geocentric-models.html#cb352-38" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> b_Intercept, <span class="at">slope =</span> b_weight_c),</span>
<span id="cb352-39"><a href="geocentric-models.html#cb352-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb352-40"><a href="geocentric-models.html#cb352-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-41"><a href="geocentric-models.html#cb352-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight_c),</span>
<span id="cb352-42"><a href="geocentric-models.html#cb352-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb352-43"><a href="geocentric-models.html#cb352-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;N = 352&quot;</span>)</span></code></pre></div>
<p>Now we can combine the ggplots with <strong>patchwork</strong> syntax to make the full version of Figure 4.7.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="geocentric-models.html#cb353-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4) <span class="sc">&amp;</span></span>
<span id="cb353-2"><a href="geocentric-models.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>,</span>
<span id="cb353-3"><a href="geocentric-models.html#cb353-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb353-4"><a href="geocentric-models.html#cb353-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> labels) <span class="sc">&amp;</span></span>
<span id="cb353-5"><a href="geocentric-models.html#cb353-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-86-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>“Notice that the cloud of regression lines grows more compact as the sample size increases. This is a result of the model growing more confident about the location of the mean” (p. 102).</p>
</div>
<div id="plotting-regression-intervals-and-contours." class="section level4 hasAnchor" number="4.4.3.4">
<h4><span class="header-section-number">4.4.3.4</span> Plotting regression intervals and contours.<a href="geocentric-models.html#plotting-regression-intervals-and-contours." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Since we used <code>weight_c</code> to fit our model, we might first want to understand what exactly the mean value is for <code>weight</code>.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="geocentric-models.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span></code></pre></div>
<pre><code>## [1] 44.99049</code></pre>
<p>Just a hair under 45. If we’re interested in <span class="math inline">\(\mu\)</span> at <code>weight</code> = 50, that implies we’re also interested in <span class="math inline">\(\mu\)</span> at <code>weight_c</code> + 5.01. Within the context of our model, we compute this with <span class="math inline">\(\alpha + \beta \cdot 5.01\)</span>. Here’s what that looks like with <code>post</code>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="geocentric-models.html#cb356-1" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> </span>
<span id="cb356-2"><a href="geocentric-models.html#cb356-2" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb356-3"><a href="geocentric-models.html#cb356-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">mu_at_50 =</span> b_Intercept <span class="sc">+</span> b_weight_c <span class="sc">*</span> <span class="fl">5.01</span>)</span>
<span id="cb356-4"><a href="geocentric-models.html#cb356-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb356-5"><a href="geocentric-models.html#cb356-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mu_at_50)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   mu_at_50
##      &lt;dbl&gt;
## 1     159.
## 2     160.
## 3     159.
## 4     160.
## 5     159.
## 6     159.</code></pre>
<p>And here is a version McElreath’s Figure 4.8 density plot.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="geocentric-models.html#cb358-1" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="geocentric-models.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu_at_50)) <span class="sc">+</span></span>
<span id="cb358-3"><a href="geocentric-models.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb358-4"><a href="geocentric-models.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb358-5"><a href="geocentric-models.html#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(mu[<span class="st">&quot;height | weight = 50&quot;</span>])) <span class="sc">+</span></span>
<span id="cb358-6"><a href="geocentric-models.html#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-89-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We’ll use <code>mean_hdi()</code> to get both 89% and 95% HPDIs along with the mean.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="geocentric-models.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean_hdi</span>(mu_at_50[, <span class="dv">1</span>], <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">89</span>, .<span class="dv">95</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   mu_at_50 .lower .upper .width .point .interval
##      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1     159.   159.   160.   0.89 mean   hdi      
## 2     159.   158.   160.   0.95 mean   hdi</code></pre>
<p>If you wanted to express those sweet 95% HPDIs on your density plot, you might use <code>tidybayes::stat_halfeye()</code>. Since <code>stat_halfeye()</code> also returns a point estimate, we’ll throw in the mode.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="geocentric-models.html#cb361-1" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="sc">%&gt;%</span></span>
<span id="cb361-2"><a href="geocentric-models.html#cb361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu_at_50, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb361-3"><a href="geocentric-models.html#cb361-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb361-4"><a href="geocentric-models.html#cb361-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb361-5"><a href="geocentric-models.html#cb361-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb361-6"><a href="geocentric-models.html#cb361-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(mu[<span class="st">&quot;height | weight = 50&quot;</span>])) <span class="sc">+</span></span>
<span id="cb361-7"><a href="geocentric-models.html#cb361-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-91-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>With <strong>brms</strong>, you would use <code>fitted()</code> to do what McElreath accomplished with <code>link()</code>.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="geocentric-models.html#cb362-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.3</span>, <span class="at">summary =</span> F)</span>
<span id="cb362-2"><a href="geocentric-models.html#cb362-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-3"><a href="geocentric-models.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:4000, 1:352] 157 158 157 158 157 ...</code></pre>
<p>When you specify <code>summary = F</code>, <code>fitted()</code> returns a matrix of values with as many rows as there were post-warmup draws across your HMC chains and as many columns as there were cases in your analysis. Because we had 4,000 post-warmup draws and <span class="math inline">\(n = 352\)</span>, <code>fitted()</code> returned a matrix of 4,000 rows and 352 vectors. If you omitted the <code>summary = F</code> argument, the default is <code>TRUE</code> and <code>fitted()</code> will return summary information instead.</p>
<p>Much like <strong>rethinking</strong>’s <code>link()</code>, <code>brms::fitted()</code> can accommodate custom predictor values with its <code>newdata</code> argument.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="geocentric-models.html#cb364-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb364-2"><a href="geocentric-models.html#cb364-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">70</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb364-3"><a href="geocentric-models.html#cb364-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))</span>
<span id="cb364-4"><a href="geocentric-models.html#cb364-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-5"><a href="geocentric-models.html#cb364-5" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span></span>
<span id="cb364-6"><a href="geocentric-models.html#cb364-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.3</span>,</span>
<span id="cb364-7"><a href="geocentric-models.html#cb364-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> F,</span>
<span id="cb364-8"><a href="geocentric-models.html#cb364-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb364-9"><a href="geocentric-models.html#cb364-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb364-10"><a href="geocentric-models.html#cb364-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here we name the columns after the `weight` values from which they were computed</span></span>
<span id="cb364-11"><a href="geocentric-models.html#cb364-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">25</span><span class="sc">:</span><span class="dv">70</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb364-12"><a href="geocentric-models.html#cb364-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span></code></pre></div>
<p>Anticipating <strong>ggplot2</strong>, we went ahead and converted the output to a data frame. But we might do a little more data processing with the aid of <code>tidyr::pivot_longer()</code>, which will convert the data from the wide format to the long format. If you are new to the distinction between wide and long data, you can learn more from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html"><em>Pivot data from wide to long</em></a> vignette from the <strong>tidyverse</strong> team <span class="citation">(<a href="#ref-PivotDataWide2020" role="doc-biblioref">2020</a>)</span>; Simon Ejdemyr’s blog post, <a href="https://sejdemyr.github.io/r-tutorials/basics/wide-and-long/"><em>Wide &amp; long data</em></a>; or Karen Grace-Martin’s blog post, <a href="https://www.theanalysisfactor.com/wide-and-long-data/"><em>The wide and long data format for repeated measures data</em></a>.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="geocentric-models.html#cb365-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> </span>
<span id="cb365-2"><a href="geocentric-models.html#cb365-2" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">%&gt;%</span></span>
<span id="cb365-3"><a href="geocentric-models.html#cb365-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter,</span>
<span id="cb365-4"><a href="geocentric-models.html#cb365-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>,</span>
<span id="cb365-5"><a href="geocentric-models.html#cb365-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb365-6"><a href="geocentric-models.html#cb365-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we might reformat `weight` to numerals</span></span>
<span id="cb365-7"><a href="geocentric-models.html#cb365-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight))</span>
<span id="cb365-8"><a href="geocentric-models.html#cb365-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-9"><a href="geocentric-models.html#cb365-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mu)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##    iter weight height
##   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     25   137.
## 2     1     26   138.
## 3     1     27   139.
## 4     1     28   140.
## 5     1     29   141.
## 6     1     30   141.</code></pre>
<p>Now our data processing is done, here we reproduce McElreath’s Figure 4.9.a.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="geocentric-models.html#cb367-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb367-2"><a href="geocentric-models.html#cb367-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb367-3"><a href="geocentric-models.html#cb367-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mu <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">&lt;</span> <span class="dv">101</span>), </span>
<span id="cb367-4"><a href="geocentric-models.html#cb367-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">alpha =</span> .<span class="dv">05</span>) <span class="sc">+</span></span>
<span id="cb367-5"><a href="geocentric-models.html#cb367-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">65</span>)) <span class="sc">+</span></span>
<span id="cb367-6"><a href="geocentric-models.html#cb367-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-95-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>With <code>fitted()</code>, it’s quite easy to plot a regression line and its intervals. Just omit the <code>summary = T</code> argument.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="geocentric-models.html#cb368-1" aria-hidden="true" tabindex="-1"></a>mu_summary <span class="ot">&lt;-</span></span>
<span id="cb368-2"><a href="geocentric-models.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.3</span>, </span>
<span id="cb368-3"><a href="geocentric-models.html#cb368-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb368-4"><a href="geocentric-models.html#cb368-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb368-5"><a href="geocentric-models.html#cb368-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb368-6"><a href="geocentric-models.html#cb368-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-7"><a href="geocentric-models.html#cb368-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mu_summary)</span></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5    Q97.5 weight  weight_c
## 1 136.5440 0.8980997 134.7610 138.2850     25 -19.99049
## 2 137.4474 0.8577127 135.7422 139.1166     26 -18.99049
## 3 138.3507 0.8175317 136.7125 139.9426     27 -17.99049
## 4 139.2541 0.7775885 137.6966 140.7603     28 -16.99049
## 5 140.1575 0.7379219 138.6831 141.5796     29 -15.99049
## 6 141.0608 0.6985789 139.6677 142.3997     30 -14.99049</code></pre>
<p>Here it is, our analogue to Figure 4.9.b.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="geocentric-models.html#cb370-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb370-2"><a href="geocentric-models.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb370-3"><a href="geocentric-models.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> mu_summary,</span>
<span id="cb370-4"><a href="geocentric-models.html#cb370-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb370-5"><a href="geocentric-models.html#cb370-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb370-6"><a href="geocentric-models.html#cb370-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb370-7"><a href="geocentric-models.html#cb370-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb370-8"><a href="geocentric-models.html#cb370-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight)) <span class="sc">+</span></span>
<span id="cb370-9"><a href="geocentric-models.html#cb370-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb370-10"><a href="geocentric-models.html#cb370-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-97-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you wanted to use intervals other than the default 95% ones, you’d include the <code>probs</code> argument like this: <code>fitted(b4.3, newdata = weight.seq, probs = c(.25, .75))</code>. The resulting third and fourth vectors from the <code>fitted()</code> object would be named <code>Q25</code> and <code>Q75</code> instead of the default <code>Q2.5</code> and <code>Q97.5</code>. The <a href="https://github.com/paul-buerkner/brms/issues/425"><code>Q</code> prefix</a> stands for quantile.</p>
<div id="rethinking-overconfident-intervals." class="section level5 hasAnchor" number="4.4.3.4.1">
<h5><span class="header-section-number">4.4.3.4.1</span> Rethinking: Overconfident intervals.<a href="geocentric-models.html#rethinking-overconfident-intervals." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<blockquote>
<p>The compatibility interval for the regression line in Figure 4.9 clings tightly to the MAP line. Thus there is very little uncertainty about the average height as a function of average weight. But you have to keep in mind that these inferences are always conditional on the model. Even a very bad model can have very tight compatibility intervals. It may help if you think of the regression line in Figure 4.9 as saying: <em>Conditional on the assumption that height and weight are related by a straight line, then this is the most plausible line, and these are its plausible bounds</em>. (p. 107, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="overthinking-how-link-fitted-works." class="section level5 hasAnchor" number="4.4.3.4.2">
<h5><span class="header-section-number">4.4.3.4.2</span> Overthinking: How <del>link</del> <code>fitted()</code> works.<a href="geocentric-models.html#overthinking-how-link-fitted-works." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Similar to <code>rethinking::link()</code>, <code>brms::fitted()</code> uses the formula from your model to compute the model expectations for a given set of predictor values. I use it a lot in this project. If you follow along, you’ll get a good handle on it. But to dive deeper, you can go <a href="https://rdrr.io/cran/brms/man/fitted.brmsfit.html">here</a> for the documentation. Though we won’t be using it in this project, <strong>brms</strong> users might want to know that <code>fitted()</code> is also an alias for the <code>posterior_epred()</code> function, about which you might learn more <a href="https://rdrr.io/cran/brms/man/posterior_epred.brmsfit.html">here</a>. Users can always learn more about them and other functions in the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a>.</p>
</div>
</div>
<div id="prediction-intervals." class="section level4 hasAnchor" number="4.4.3.5">
<h4><span class="header-section-number">4.4.3.5</span> Prediction intervals.<a href="geocentric-models.html#prediction-intervals." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Even though our statistical model (omitting priors for the sake of simplicity) is</p>
<p><span class="math display">\[\text{height}_i \sim \operatorname{Normal}(\mu_i = \alpha + \beta x_, \sigma),\]</span></p>
<p>we’ve only been plotting the <span class="math inline">\(\mu\)</span> part. In order to bring in the variability expressed by <span class="math inline">\(\sigma\)</span>, we’ll have to switch to the <code>predict()</code> function. Much as <code>brms::fitted()</code> was our analogue to <code>rethinking::link()</code>, <code>brms::predict()</code> is our analogue to <code>rethinking::sim()</code>.</p>
<p>We can reuse our <code>weight_seq</code> data from before. But in case you forgot, here’s that code again.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="geocentric-models.html#cb371-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb371-2"><a href="geocentric-models.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">70</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb371-3"><a href="geocentric-models.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight))</span></code></pre></div>
<p>The <code>predict()</code> code looks a lot like what we used for <code>fitted()</code>.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="geocentric-models.html#cb372-1" aria-hidden="true" tabindex="-1"></a>pred_height <span class="ot">&lt;-</span></span>
<span id="cb372-2"><a href="geocentric-models.html#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.3</span>,</span>
<span id="cb372-3"><a href="geocentric-models.html#cb372-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb372-4"><a href="geocentric-models.html#cb372-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb372-5"><a href="geocentric-models.html#cb372-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb372-6"><a href="geocentric-models.html#cb372-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb372-7"><a href="geocentric-models.html#cb372-7" aria-hidden="true" tabindex="-1"></a>pred_height <span class="sc">%&gt;%</span></span>
<span id="cb372-8"><a href="geocentric-models.html#cb372-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5    Q97.5 weight  weight_c
## 1 136.6175  5.127009 126.4819 146.4957     25 -19.99049
## 2 137.4013  5.192623 127.2867 147.4380     26 -18.99049
## 3 138.5001  5.156907 128.3914 148.2272     27 -17.99049
## 4 139.0617  5.229955 128.8768 149.3872     28 -16.99049
## 5 140.1661  5.115493 130.1331 150.0594     29 -15.99049
## 6 140.9403  5.155106 130.8889 150.9702     30 -14.99049</code></pre>
<p>This time the summary information in our data frame is for, as McElreath put it, “simulated heights, not distributions of plausible average height, <span class="math inline">\(\mu\)</span>” (p. 108). Another way of saying that is that these simulations are the joint consequence of both <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, unlike the results of <code>fitted()</code>, which only reflect <span class="math inline">\(\mu\)</span>. Figure 4.10 shows how you might visualize them.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="geocentric-models.html#cb374-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">%&gt;%</span></span>
<span id="cb374-2"><a href="geocentric-models.html#cb374-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb374-3"><a href="geocentric-models.html#cb374-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_height, </span>
<span id="cb374-4"><a href="geocentric-models.html#cb374-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb374-5"><a href="geocentric-models.html#cb374-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="sc">+</span></span>
<span id="cb374-6"><a href="geocentric-models.html#cb374-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> mu_summary,</span>
<span id="cb374-7"><a href="geocentric-models.html#cb374-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb374-8"><a href="geocentric-models.html#cb374-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb374-9"><a href="geocentric-models.html#cb374-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb374-10"><a href="geocentric-models.html#cb374-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb374-11"><a href="geocentric-models.html#cb374-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb374-12"><a href="geocentric-models.html#cb374-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb374-13"><a href="geocentric-models.html#cb374-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb374-14"><a href="geocentric-models.html#cb374-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb374-15"><a href="geocentric-models.html#cb374-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-100-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Notice that the outline for the wide shaded interval is a little rough. This is the simulation variance in the tails of the sampled Gaussian values. If it really bothers you, increase the number of samples you take from the posterior distribution. (p. 109)</p>
</blockquote>
<p>With our <strong>brms</strong> model fitting approach, that would mean we’d have to refit <code>b4.3</code> after specifying a larger number of post-warmup iterations with alterations to the <code>iter</code> and <code>warmup</code> parameters.</p>
<div id="overthinking-rolling-your-own-sim-predict." class="section level5 hasAnchor" number="4.4.3.5.1">
<h5><span class="header-section-number">4.4.3.5.1</span> Overthinking: Rolling your own <del>sim</del> <code>predict()</code>.<a href="geocentric-models.html#overthinking-rolling-your-own-sim-predict." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Here we follow McElreath’s example and do our model-based predictions by hand. Instead of relying on base <strong>R</strong> <code>apply()</code> and <code>sapply()</code>, here the main action is in <code>expand_grid()</code>, the second <code>mutate()</code> line and the <code>group_by()</code> + <code>summarise()</code> combination.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="geocentric-models.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `predict()` by hand</span></span>
<span id="cb375-2"><a href="geocentric-models.html#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb375-3"><a href="geocentric-models.html#cb375-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-4"><a href="geocentric-models.html#cb375-4" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb375-5"><a href="geocentric-models.html#cb375-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">70</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb375-6"><a href="geocentric-models.html#cb375-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_c =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb375-7"><a href="geocentric-models.html#cb375-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim_height =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(),</span>
<span id="cb375-8"><a href="geocentric-models.html#cb375-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mean =</span> b_Intercept <span class="sc">+</span> b_weight_c <span class="sc">*</span> weight_c,</span>
<span id="cb375-9"><a href="geocentric-models.html#cb375-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sd   =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb375-10"><a href="geocentric-models.html#cb375-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb375-11"><a href="geocentric-models.html#cb375-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(sim_height),</span>
<span id="cb375-12"><a href="geocentric-models.html#cb375-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(sim_height, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb375-13"><a href="geocentric-models.html#cb375-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(sim_height, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb375-14"><a href="geocentric-models.html#cb375-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb375-15"><a href="geocentric-models.html#cb375-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb375-16"><a href="geocentric-models.html#cb375-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb375-17"><a href="geocentric-models.html#cb375-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> ll, <span class="at">ymax =</span> ul),</span>
<span id="cb375-18"><a href="geocentric-models.html#cb375-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb375-19"><a href="geocentric-models.html#cb375-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb375-20"><a href="geocentric-models.html#cb375-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d2,</span>
<span id="cb375-21"><a href="geocentric-models.html#cb375-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb375-22"><a href="geocentric-models.html#cb375-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb375-23"><a href="geocentric-models.html#cb375-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb375-24"><a href="geocentric-models.html#cb375-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d2<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb375-25"><a href="geocentric-models.html#cb375-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb375-26"><a href="geocentric-models.html#cb375-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-101-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We specifically left out the <code>fitted()</code> intervals to make it more apparent what we were simulating. You might also note that we could have easily replaced that three-line <code>summarise()</code> code with a single line of <code>tidybayes::mean_qi(sim_height)</code>, or whatever combination of central tendency and interval type you wanted (e.g., <code>mode_hdi(sim_height, .width = .89)</code>).</p>
</div>
</div>
</div>
</div>
<div id="curves-from-lines" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Curves from lines<a href="geocentric-models.html#curves-from-lines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The models so far all assume that a straight line describes the relationship. But there’s nothing special about straight lines, aside from their simplicity.” (p. 110).</p>
<div id="polynomial-regression." class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Polynomial regression.<a href="geocentric-models.html#polynomial-regression." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember <code>d</code>?</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="geocentric-models.html#cb376-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb376-2"><a href="geocentric-models.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 544
## Columns: 4
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.8300, 149.2250, 168.9100, 147…
## $ weight &lt;dbl&gt; 47.82561, 36.48581, 31.86484, 53.04191, 41.27687, 62.99259, 38.24348, 55.47997, 34.…
## $ age    &lt;dbl&gt; 63.0, 63.0, 65.0, 41.0, 51.0, 35.0, 32.0, 27.0, 19.0, 54.0, 47.0, 66.0, 73.0, 20.0,…
## $ male   &lt;int&gt; 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0,…</code></pre>
<p>McElreath suggested we plot <code>height</code> against <code>weight</code> using the full sample.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="geocentric-models.html#cb378-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb378-2"><a href="geocentric-models.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb378-3"><a href="geocentric-models.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb378-4"><a href="geocentric-models.html#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb378-5"><a href="geocentric-models.html#cb378-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">42</span>, <span class="at">y =</span> <span class="dv">115</span>,</span>
<span id="cb378-6"><a href="geocentric-models.html#cb378-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;This relation is</span><span class="sc">\n</span><span class="st">visibly curved.&quot;</span>,</span>
<span id="cb378-7"><a href="geocentric-models.html#cb378-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-8"><a href="geocentric-models.html#cb378-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb378-9"><a href="geocentric-models.html#cb378-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-103-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Those variables two appear to follow an orderly relation, but whatever it is, it’s clearly not a simple straight line. The quadratic model is probably the most commonly used polynomial regression model. It follows the generic form</p>
<p><span class="math display">\[\mu = \alpha + \beta_1 x_i + \color{navy}{\beta_2 x_i^2}.\]</span></p>
<p>McElreath warned: “Fitting these models to data is easy. Interpreting them can be hard” (p. 111). Standardizing will help <code>brm()</code> fit the model. We might standardize our <code>weight</code> variable like so.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="geocentric-models.html#cb379-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb379-2"><a href="geocentric-models.html#cb379-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb379-3"><a href="geocentric-models.html#cb379-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s =</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(weight)) <span class="sc">/</span> <span class="fu">sd</span>(weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb379-4"><a href="geocentric-models.html#cb379-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<p>While we were at it, we just went ahead and computed the <code>weight_s2</code> variable. We can express our statistical model as</p>
<p><span class="math display">\[\begin{align*}
\text{height}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{weight_s}_i + \color{navy}{\beta_2 \text{weight_s}^2_i} \\
\alpha  &amp; \sim \operatorname{Normal}(178, 20) \\
\beta_1 &amp; \sim \operatorname{Log-Normal}(0, 1) \\
\color{navy}{\beta_2} &amp; \color{navy}\sim \color{navy}{\operatorname{Normal}(0, 1)} \\
\sigma  &amp; \sim \operatorname{Uniform}(0, 50).
\end{align*}\]</span></p>
<p>Here’s how we might fit the quadratic model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="geocentric-models.html#cb380-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb380-2"><a href="geocentric-models.html#cb380-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb380-3"><a href="geocentric-models.html#cb380-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb380-4"><a href="geocentric-models.html#cb380-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> weight_s2,</span>
<span id="cb380-5"><a href="geocentric-models.html#cb380-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb380-6"><a href="geocentric-models.html#cb380-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb380-7"><a href="geocentric-models.html#cb380-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</span>
<span id="cb380-8"><a href="geocentric-models.html#cb380-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb380-9"><a href="geocentric-models.html#cb380-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb380-10"><a href="geocentric-models.html#cb380-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb380-11"><a href="geocentric-models.html#cb380-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.05&quot;</span>)</span></code></pre></div>
<p>Note our use of the <code>coef</code> argument within our prior statements. Since <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are both parameters of <code>class = b</code> within the <strong>brms</strong> set-up, we need to use the <code>coef</code> argument when we want their priors to differ.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="geocentric-models.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.5</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-105-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="geocentric-models.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_s + weight_s2 
##    Data: d (Number of observations: 544) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   146.05      0.37   145.33   146.79 1.00     3722     3212
## weight_s     21.74      0.29    21.16    22.31 1.00     3279     3137
## weight_s2    -7.80      0.28    -8.36    -7.26 1.00     3723     2932
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.80      0.18     5.46     6.15 1.00     3990     2846
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our quadratic plot requires new <code>fitted()</code>- and <code>predict()</code>-oriented wrangling.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="geocentric-models.html#cb384-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb384-2"><a href="geocentric-models.html#cb384-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb384-3"><a href="geocentric-models.html#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb384-4"><a href="geocentric-models.html#cb384-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-5"><a href="geocentric-models.html#cb384-5" aria-hidden="true" tabindex="-1"></a>fitd_quad <span class="ot">&lt;-</span></span>
<span id="cb384-6"><a href="geocentric-models.html#cb384-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.5</span>, </span>
<span id="cb384-7"><a href="geocentric-models.html#cb384-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb384-8"><a href="geocentric-models.html#cb384-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb384-9"><a href="geocentric-models.html#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb384-10"><a href="geocentric-models.html#cb384-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-11"><a href="geocentric-models.html#cb384-11" aria-hidden="true" tabindex="-1"></a>pred_quad <span class="ot">&lt;-</span></span>
<span id="cb384-12"><a href="geocentric-models.html#cb384-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.5</span>, </span>
<span id="cb384-13"><a href="geocentric-models.html#cb384-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb384-14"><a href="geocentric-models.html#cb384-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb384-15"><a href="geocentric-models.html#cb384-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)  </span></code></pre></div>
<p>Behold the code for our version of Figure 4.11.b.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="geocentric-models.html#cb385-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb385-2"><a href="geocentric-models.html#cb385-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> d, </span>
<span id="cb385-3"><a href="geocentric-models.html#cb385-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb385-4"><a href="geocentric-models.html#cb385-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_quad, </span>
<span id="cb385-5"><a href="geocentric-models.html#cb385-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb385-6"><a href="geocentric-models.html#cb385-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="sc">+</span></span>
<span id="cb385-7"><a href="geocentric-models.html#cb385-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitd_quad,</span>
<span id="cb385-8"><a href="geocentric-models.html#cb385-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb385-9"><a href="geocentric-models.html#cb385-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb385-10"><a href="geocentric-models.html#cb385-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb385-11"><a href="geocentric-models.html#cb385-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb385-12"><a href="geocentric-models.html#cb385-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb385-13"><a href="geocentric-models.html#cb385-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;quadratic&quot;</span>,</span>
<span id="cb385-14"><a href="geocentric-models.html#cb385-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">+</span></span>
<span id="cb385-15"><a href="geocentric-models.html#cb385-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>weight_s),</span>
<span id="cb385-16"><a href="geocentric-models.html#cb385-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb385-17"><a href="geocentric-models.html#cb385-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb385-18"><a href="geocentric-models.html#cb385-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb385-19"><a href="geocentric-models.html#cb385-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-20"><a href="geocentric-models.html#cb385-20" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-107-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>From a formula perspective, the cubic model is a simple extension of the quadratic:</p>
<p><span class="math display">\[\mu = \alpha + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3.\]</span></p>
<p>Before we fit the model, we need to wrangle the data again.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="geocentric-models.html#cb386-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb386-2"><a href="geocentric-models.html#cb386-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb386-3"><a href="geocentric-models.html#cb386-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s3 =</span> weight_s<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div>
<p>Now fit the model like so.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="geocentric-models.html#cb387-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb387-2"><a href="geocentric-models.html#cb387-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb387-3"><a href="geocentric-models.html#cb387-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb387-4"><a href="geocentric-models.html#cb387-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> weight_s2 <span class="sc">+</span> weight_s3,</span>
<span id="cb387-5"><a href="geocentric-models.html#cb387-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb387-6"><a href="geocentric-models.html#cb387-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb387-7"><a href="geocentric-models.html#cb387-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</span>
<span id="cb387-8"><a href="geocentric-models.html#cb387-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s3&quot;</span>),</span>
<span id="cb387-9"><a href="geocentric-models.html#cb387-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb387-10"><a href="geocentric-models.html#cb387-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb387-11"><a href="geocentric-models.html#cb387-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb387-12"><a href="geocentric-models.html#cb387-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.06&quot;</span>)</span></code></pre></div>
<p>And now we’ll fit the good old linear model.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="geocentric-models.html#cb388-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.7</span> <span class="ot">&lt;-</span> </span>
<span id="cb388-2"><a href="geocentric-models.html#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb388-3"><a href="geocentric-models.html#cb388-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb388-4"><a href="geocentric-models.html#cb388-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s,</span>
<span id="cb388-5"><a href="geocentric-models.html#cb388-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb388-6"><a href="geocentric-models.html#cb388-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb388-7"><a href="geocentric-models.html#cb388-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb388-8"><a href="geocentric-models.html#cb388-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb388-9"><a href="geocentric-models.html#cb388-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb388-10"><a href="geocentric-models.html#cb388-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.07&quot;</span>)</span></code></pre></div>
<p>Here’s the <code>fitted()</code>, <code>predict()</code>, and <strong>ggplot2</strong> code for Figure 4.11.c, the cubic model.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="geocentric-models.html#cb389-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> </span>
<span id="cb389-2"><a href="geocentric-models.html#cb389-2" aria-hidden="true" tabindex="-1"></a>  weight_seq <span class="sc">%&gt;%</span> </span>
<span id="cb389-3"><a href="geocentric-models.html#cb389-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s3 =</span> weight_s<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb389-4"><a href="geocentric-models.html#cb389-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-5"><a href="geocentric-models.html#cb389-5" aria-hidden="true" tabindex="-1"></a>fitd_cub <span class="ot">&lt;-</span></span>
<span id="cb389-6"><a href="geocentric-models.html#cb389-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.6</span>, </span>
<span id="cb389-7"><a href="geocentric-models.html#cb389-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb389-8"><a href="geocentric-models.html#cb389-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb389-9"><a href="geocentric-models.html#cb389-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb389-10"><a href="geocentric-models.html#cb389-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-11"><a href="geocentric-models.html#cb389-11" aria-hidden="true" tabindex="-1"></a>pred_cub <span class="ot">&lt;-</span></span>
<span id="cb389-12"><a href="geocentric-models.html#cb389-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.6</span>, </span>
<span id="cb389-13"><a href="geocentric-models.html#cb389-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb389-14"><a href="geocentric-models.html#cb389-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb389-15"><a href="geocentric-models.html#cb389-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) </span>
<span id="cb389-16"><a href="geocentric-models.html#cb389-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-17"><a href="geocentric-models.html#cb389-17" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb389-18"><a href="geocentric-models.html#cb389-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> d, </span>
<span id="cb389-19"><a href="geocentric-models.html#cb389-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb389-20"><a href="geocentric-models.html#cb389-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_cub, </span>
<span id="cb389-21"><a href="geocentric-models.html#cb389-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb389-22"><a href="geocentric-models.html#cb389-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="sc">+</span></span>
<span id="cb389-23"><a href="geocentric-models.html#cb389-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitd_cub,</span>
<span id="cb389-24"><a href="geocentric-models.html#cb389-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb389-25"><a href="geocentric-models.html#cb389-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb389-26"><a href="geocentric-models.html#cb389-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb389-27"><a href="geocentric-models.html#cb389-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb389-28"><a href="geocentric-models.html#cb389-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb389-29"><a href="geocentric-models.html#cb389-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;cubic&quot;</span>,</span>
<span id="cb389-30"><a href="geocentric-models.html#cb389-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">+</span></span>
<span id="cb389-31"><a href="geocentric-models.html#cb389-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>weight_s),</span>
<span id="cb389-32"><a href="geocentric-models.html#cb389-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb389-33"><a href="geocentric-models.html#cb389-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb389-34"><a href="geocentric-models.html#cb389-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb389-35"><a href="geocentric-models.html#cb389-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-36"><a href="geocentric-models.html#cb389-36" aria-hidden="true" tabindex="-1"></a>p3</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-109-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>And here’s the <code>fitted()</code>, <code>predict()</code>, and <strong>ggplot2</strong> code for Figure 4.11.a, the linear model.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="geocentric-models.html#cb390-1" aria-hidden="true" tabindex="-1"></a>fitd_line <span class="ot">&lt;-</span></span>
<span id="cb390-2"><a href="geocentric-models.html#cb390-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b4<span class="fl">.7</span>, </span>
<span id="cb390-3"><a href="geocentric-models.html#cb390-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb390-4"><a href="geocentric-models.html#cb390-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb390-5"><a href="geocentric-models.html#cb390-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq)</span>
<span id="cb390-6"><a href="geocentric-models.html#cb390-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-7"><a href="geocentric-models.html#cb390-7" aria-hidden="true" tabindex="-1"></a>pred_line <span class="ot">&lt;-</span></span>
<span id="cb390-8"><a href="geocentric-models.html#cb390-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b4<span class="fl">.7</span>, </span>
<span id="cb390-9"><a href="geocentric-models.html#cb390-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb390-10"><a href="geocentric-models.html#cb390-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb390-11"><a href="geocentric-models.html#cb390-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) </span>
<span id="cb390-12"><a href="geocentric-models.html#cb390-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-13"><a href="geocentric-models.html#cb390-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb390-14"><a href="geocentric-models.html#cb390-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> d, </span>
<span id="cb390-15"><a href="geocentric-models.html#cb390-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb390-16"><a href="geocentric-models.html#cb390-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_line, </span>
<span id="cb390-17"><a href="geocentric-models.html#cb390-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb390-18"><a href="geocentric-models.html#cb390-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="sc">+</span></span>
<span id="cb390-19"><a href="geocentric-models.html#cb390-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitd_line,</span>
<span id="cb390-20"><a href="geocentric-models.html#cb390-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb390-21"><a href="geocentric-models.html#cb390-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb390-22"><a href="geocentric-models.html#cb390-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb390-23"><a href="geocentric-models.html#cb390-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb390-24"><a href="geocentric-models.html#cb390-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb390-25"><a href="geocentric-models.html#cb390-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;linear&quot;</span>,</span>
<span id="cb390-26"><a href="geocentric-models.html#cb390-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">+</span></span>
<span id="cb390-27"><a href="geocentric-models.html#cb390-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>weight_s),</span>
<span id="cb390-28"><a href="geocentric-models.html#cb390-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>height)) <span class="sc">+</span></span>
<span id="cb390-29"><a href="geocentric-models.html#cb390-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb390-30"><a href="geocentric-models.html#cb390-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb390-31"><a href="geocentric-models.html#cb390-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-32"><a href="geocentric-models.html#cb390-32" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-110-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Did you notice how we labeled each of the past three plots as <code>p1</code>, <code>p2</code>, and <code>p3</code>? Here we use those names to plot them all together with <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="geocentric-models.html#cb391-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-111-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As fun as this all has been,</p>
<blockquote>
<p>it’s not clear that any of these models make a lot of sense. They are good geocentric descriptions of the sample, yes. But there are two problems. First, a better fit to the sample might not actually be a better model. That’s the subject of Chapter 7. Second, the model contains no biological information. We aren’t learning any causal relationship between height and weight. We’ll deal with this second problem much later, in Chapter 16. (p. 113)</p>
</blockquote>
<div id="overthinking-converting-back-to-natural-scale." class="section level5 hasAnchor" number="4.5.1.0.1">
<h5><span class="header-section-number">4.5.1.0.1</span> Overthinking: Converting back to natural scale.<a href="geocentric-models.html#overthinking-converting-back-to-natural-scale." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>You can apply McElreath’s conversion trick within the <strong>ggplot2</strong> environment, too. Here it is with the cubic model.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="geocentric-models.html#cb392-1" aria-hidden="true" tabindex="-1"></a>at <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb392-2"><a href="geocentric-models.html#cb392-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-3"><a href="geocentric-models.html#cb392-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, </span>
<span id="cb392-4"><a href="geocentric-models.html#cb392-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb392-5"><a href="geocentric-models.html#cb392-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_cub, </span>
<span id="cb392-6"><a href="geocentric-models.html#cb392-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb392-7"><a href="geocentric-models.html#cb392-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="sc">+</span></span>
<span id="cb392-8"><a href="geocentric-models.html#cb392-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height),</span>
<span id="cb392-9"><a href="geocentric-models.html#cb392-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb392-10"><a href="geocentric-models.html#cb392-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>weight_s)) <span class="sc">+</span></span>
<span id="cb392-11"><a href="geocentric-models.html#cb392-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb392-12"><a href="geocentric-models.html#cb392-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb392-13"><a href="geocentric-models.html#cb392-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb392-14"><a href="geocentric-models.html#cb392-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here it is!</span></span>
<span id="cb392-15"><a href="geocentric-models.html#cb392-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;standardized weight converted back&quot;</span>,</span>
<span id="cb392-16"><a href="geocentric-models.html#cb392-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> at,</span>
<span id="cb392-17"><a href="geocentric-models.html#cb392-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">round</span>(at<span class="sc">*</span><span class="fu">sd</span>(d<span class="sc">$</span>weight) <span class="sc">+</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight), <span class="dv">1</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-112-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="splines." class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Splines.<a href="geocentric-models.html#splines." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Load the <code>cherry_blossoms</code> data <span class="citation">(<a href="#ref-aonoLongTermChange2012" role="doc-biblioref">Aono, 2012</a>; <a href="#ref-aonoPhenologicalDataSeries2008" role="doc-biblioref">Aono &amp; Kazui, 2008</a>; <a href="#ref-aonoClarifyingSpringtimeTemperature2010" role="doc-biblioref">Aono &amp; Saito, 2010</a>)</span>.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="geocentric-models.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb393-2"><a href="geocentric-models.html#cb393-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-3"><a href="geocentric-models.html#cb393-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb393-4"><a href="geocentric-models.html#cb393-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb393-5"><a href="geocentric-models.html#cb393-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cherry_blossoms)</span>
<span id="cb393-6"><a href="geocentric-models.html#cb393-6" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking, <span class="at">unload =</span> T)</span></code></pre></div>
<p>Minus the mini histograms, here is our ground-up <strong>tidyverse</strong> way to summarize our new <code>d</code> data the way McElreath did with his <code>precis()</code>.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="geocentric-models.html#cb394-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb394-2"><a href="geocentric-models.html#cb394-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb394-3"><a href="geocentric-models.html#cb394-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb394-4"><a href="geocentric-models.html#cb394-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T),</span>
<span id="cb394-5"><a href="geocentric-models.html#cb394-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value, <span class="at">na.rm =</span> T),</span>
<span id="cb394-6"><a href="geocentric-models.html#cb394-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">055</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb394-7"><a href="geocentric-models.html#cb394-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">945</span>, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb394-8"><a href="geocentric-models.html#cb394-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   key           mean     sd     ll      ul
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 doy         105.     6.41  94.4   115   
## 2 temp          6.14   0.66   5.15    7.29
## 3 temp_lower    5.1    0.85   3.79    6.37
## 4 temp_upper    7.19   0.99   5.9     8.9 
## 5 year       1408    351.   868.   1948.</code></pre>
<p>McElreath encouraged us to plot <code>doy</code> against <code>year</code>.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="geocentric-models.html#cb396-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb396-2"><a href="geocentric-models.html#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb396-3"><a href="geocentric-models.html#cb396-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color from here: https://www.colorhexa.com/ffb7c5</span></span>
<span id="cb396-4"><a href="geocentric-models.html#cb396-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb396-5"><a href="geocentric-models.html#cb396-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb396-6"><a href="geocentric-models.html#cb396-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb396-7"><a href="geocentric-models.html#cb396-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># color from here: https://www.colordic.org/w/, inspired by https://chichacha.netlify.com/2018/11/29/plotting-traditional-colours-of-japan/</span></span>
<span id="cb396-8"><a href="geocentric-models.html#cb396-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>))</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-115-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>It looks like there are some wiggly trends, but it’s hard to tell with a scatter plot.</p>
<blockquote>
<p>Our goal is to approximate the blossom trend with a wiggly function. With B-splines, just like with polynomial regression, we do this by generating new predictor variables and using those in the linear model, <span class="math inline">\(\mu_i\)</span>. Unlike polynomial regression, B-splines do not directly transform the predictor by squaring or cubing it. Instead they invent a series of entirely new, synthetic predictor variables. Each of these synthetic variables exists only to gradually turn a specific parameter on and off within a specific range of the real predictor variable. Each of the synthetic variables is called a <strong>basis function</strong>. The linear model ends up looking very familiar:</p>
<p><span class="math display">\[\mu_i = \alpha + w_1 B_{i, 1} + w_2 B_{i, 2} + w_3 B_{i, 3} + \dots\]</span></p>
<p>where <span class="math inline">\(B_{i,n}\)</span> is the <span class="math inline">\(n\)</span>-th basis function’s value on row <span class="math inline">\(i\)</span>, and the <span class="math inline">\(w\)</span> parameters are corresponding weights for each. The parameters act like slopes, adjusting the influence of each basis function on the mean <span class="math inline">\(\mu_i\)</span>. So really this is just another linear regression, but with some fancy, synthetic predictor variables. (p. 115, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>It turns out there are cases with missing data for the <code>doy</code> variable.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="geocentric-models.html#cb397-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb397-2"><a href="geocentric-models.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="fu">is.na</span>(doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb397-3"><a href="geocentric-models.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>##   is.na(doy)   n  percent
## 1      FALSE 827 68.06584
## 2       TRUE 388 31.93416</code></pre>
<p>Let’s follow McElreath and make a subset of the data that excludes cases with missing data in <code>doy</code>. Within the <strong>tidyverse</strong>, we might do so with the <code>tidyr::drop_na()</code> function.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="geocentric-models.html#cb399-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span></span>
<span id="cb399-2"><a href="geocentric-models.html#cb399-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb399-3"><a href="geocentric-models.html#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(doy)</span></code></pre></div>
<p>On page 117 in the text, McElreath indirectly explained how to make Figure 4.12 by walking through the workflow for making Figure 4.13. Here we mimic that ordering.</p>
<blockquote>
<p>First, we choose the knots. Remember, the knots are just values of year that serve as pivots for our spline. Where should the knots go? There are different ways to answer this question. You can, in principle, put the knots wherever you like. Their locations are part of the model, and you are responsible for them. Let’s do what we did in the simple example above, place the knots at different evenlyspaced quantiles of the predictor variable. This gives you more knots where there are more observations. We used only 5 knots in the first example. Now let’s go for 15:</p>
</blockquote>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="geocentric-models.html#cb400-1" aria-hidden="true" tabindex="-1"></a>num_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb400-2"><a href="geocentric-models.html#cb400-2" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(d2<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> num_knots))</span></code></pre></div>
<p>Our <code>knot_list</code> contains 15 <code>year</code> values.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="geocentric-models.html#cb401-1" aria-hidden="true" tabindex="-1"></a>knot_list</span></code></pre></div>
<pre><code>##        0% 7.142857% 14.28571% 21.42857% 28.57143% 35.71429% 42.85714%       50% 57.14286% 64.28571% 
##       812      1036      1174      1269      1377      1454      1518      1583      1650      1714 
## 71.42857% 78.57143% 85.71429% 92.85714%      100% 
##      1774      1833      1893      1956      2015</code></pre>
<p>Here’s what it looks like if we use those <code>knot_list</code> values to chop up our <code>year</code>/<code>doy</code> scatter plot, from above.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="geocentric-models.html#cb403-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb403-2"><a href="geocentric-models.html#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb403-3"><a href="geocentric-models.html#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb403-4"><a href="geocentric-models.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb403-5"><a href="geocentric-models.html#cb403-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb403-6"><a href="geocentric-models.html#cb403-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb403-7"><a href="geocentric-models.html#cb403-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-120-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The next choice is polynomial degree. This determines how basis functions combine, which determines how the parameters interact to produce the spline. For degree 1, as in Figure 4.12, two basis functions combine at each point. For degree 2, three functions combine at each point. For degree 3, four combine. R already has a nice function that will build basis functions for any list of knots and degree. This code will construct the necessary basis functions for a degree 3 (cubic) spline: (p. 117)</p>
</blockquote>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="geocentric-models.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb404-2"><a href="geocentric-models.html#cb404-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-3"><a href="geocentric-models.html#cb404-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(d2<span class="sc">$</span>year,</span>
<span id="cb404-4"><a href="geocentric-models.html#cb404-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, num_knots)], </span>
<span id="cb404-5"><a href="geocentric-models.html#cb404-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree =</span> <span class="dv">3</span>, </span>
<span id="cb404-6"><a href="geocentric-models.html#cb404-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Look closely at McElreath’s tricky <code>knot_list[-c(1, num_knots)]</code> code. Whereas <code>knot_list</code> contains 15 ordered <code>year</code> values, McElreath shaved off the first and last <code>year</code> values with <code>knot_list[-c(1, num_knots)]</code>, leaving 13. This is because, by default, the <code>bs()</code> function places knots at the boundaries. Since the first and 15<sup>th</sup> values in <code>knot_list</code> were boundary values for <code>year</code>, we removed them to avoid redundancies. We can confirm this with the code, below.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="geocentric-models.html#cb405-1" aria-hidden="true" tabindex="-1"></a>B <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code></pre></div>
<pre><code>##  &#39;bs&#39; num [1:827, 1:17] 1 0.96 0.767 0.563 0.545 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:17] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  - attr(*, &quot;degree&quot;)= int 3
##  - attr(*, &quot;knots&quot;)= Named num [1:13] 1036 1174 1269 1377 1454 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:13] &quot;7.142857%&quot; &quot;14.28571%&quot; &quot;21.42857%&quot; &quot;28.57143%&quot; ...
##  - attr(*, &quot;Boundary.knots&quot;)= int [1:2] 812 2015
##  - attr(*, &quot;intercept&quot;)= logi TRUE</code></pre>
<p>Look at the second to last line, <code>- attr(*, "Boundary.knots")= int [1:2] 812 2015</code>. Those default <code>"Boundary.knots"</code> are the same as <code>knot_list[c(1, num_knots)]</code>. Let’s confirm.</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="geocentric-models.html#cb407-1" aria-hidden="true" tabindex="-1"></a>knot_list[<span class="fu">c</span>(<span class="dv">1</span>, num_knots)]</span></code></pre></div>
<pre><code>##   0% 100% 
##  812 2015</code></pre>
<p>By the <code>degree = 3</code> argument, we indicated we wanted a cubic spline. McElreath used <code>degree = 1</code> for Figure 4.12. For reasons I’m not prepared to get into, here, splines don’t always include intercept parameters. Indeed, the <code>bs()</code> default is <code>intercept = FALSE</code>. McElreath’s code indicated he wanted to fit a B-spline that included an intercept. Thus: <code>intercept = TRUE</code>.</p>
<p>Here’s how we might make our version of the top panel of Figure 4.13.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="geocentric-models.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle a bit</span></span>
<span id="cb409-2"><a href="geocentric-models.html#cb409-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span></span>
<span id="cb409-3"><a href="geocentric-models.html#cb409-3" aria-hidden="true" tabindex="-1"></a>  B <span class="sc">%&gt;%</span> </span>
<span id="cb409-4"><a href="geocentric-models.html#cb409-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb409-5"><a href="geocentric-models.html#cb409-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="sc">:</span><span class="dv">17</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb409-6"><a href="geocentric-models.html#cb409-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(d2, year)) <span class="sc">%&gt;%</span> </span>
<span id="cb409-7"><a href="geocentric-models.html#cb409-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year,</span>
<span id="cb409-8"><a href="geocentric-models.html#cb409-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>,</span>
<span id="cb409-9"><a href="geocentric-models.html#cb409-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb409-10"><a href="geocentric-models.html#cb409-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-11"><a href="geocentric-models.html#cb409-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb409-12"><a href="geocentric-models.html#cb409-12" aria-hidden="true" tabindex="-1"></a>b <span class="sc">%&gt;%</span> </span>
<span id="cb409-13"><a href="geocentric-models.html#cb409-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias, <span class="at">group =</span> bias_function)) <span class="sc">+</span></span>
<span id="cb409-14"><a href="geocentric-models.html#cb409-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb409-15"><a href="geocentric-models.html#cb409-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb409-16"><a href="geocentric-models.html#cb409-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;bias value&quot;</span>) <span class="sc">+</span></span>
<span id="cb409-17"><a href="geocentric-models.html#cb409-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb409-18"><a href="geocentric-models.html#cb409-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb409-19"><a href="geocentric-models.html#cb409-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-124-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>To elucidate what’s going on in that plot, we might break it up with <code>facet_wrap()</code>.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="geocentric-models.html#cb410-1" aria-hidden="true" tabindex="-1"></a>b <span class="sc">%&gt;%</span> </span>
<span id="cb410-2"><a href="geocentric-models.html#cb410-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bias_function =</span> <span class="fu">str_c</span>(<span class="st">&quot;bias function &quot;</span>, bias_function)) <span class="sc">%&gt;%</span> </span>
<span id="cb410-3"><a href="geocentric-models.html#cb410-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb410-4"><a href="geocentric-models.html#cb410-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias)) <span class="sc">+</span></span>
<span id="cb410-5"><a href="geocentric-models.html#cb410-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb410-6"><a href="geocentric-models.html#cb410-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb410-7"><a href="geocentric-models.html#cb410-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;bias value&quot;</span>) <span class="sc">+</span></span>
<span id="cb410-8"><a href="geocentric-models.html#cb410-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb410-9"><a href="geocentric-models.html#cb410-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb410-10"><a href="geocentric-models.html#cb410-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb410-11"><a href="geocentric-models.html#cb410-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">&quot;#ffb7c5&quot;</span>, .<span class="dv">25</span>), <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb410-12"><a href="geocentric-models.html#cb410-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">0.1</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb410-13"><a href="geocentric-models.html#cb410-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> bias_function, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-125-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Now to get the parameter weights for each basis function, we need to actually define the model and make it run. The model is just a linear regression. The synthetic basis functions do all the work. We’ll use each column of the matrix <code>B</code> as a variable. We’ll also have an intercept to capture the average blossom day. This will make it easier to define priors on the basis weights, because then we can just conceive of each as a deviation from the intercept. (p. 117)</p>
</blockquote>
<p>That last line is another indication for why we set <code>intercept = TRUE</code>. Our model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{day_in_year}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i  &amp; = \alpha + \color{#4f455c}{\sum_{k=1}^K w_k B_{k, i}} \\
\alpha &amp; \sim \operatorname{Normal}(100, 10) \\
\color{#4f455c}{w_j} &amp; \color{#4f455c}\sim \color{#4f455c}{\operatorname{Normal}(0, 10)} \\
\sigma &amp; \sim \operatorname{Exponential}(1),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the intercept, <span class="math inline">\(B_{k, i}\)</span> is the value of the <span class="math inline">\(k^\text{th}\)</span> bias function on the <span class="math inline">\(i^\text{th}\)</span> row of the data, and <span class="math inline">\(w_k\)</span> is the estimated regression weight for the corresponding <span class="math inline">\(k^\text{th}\)</span> bias function.</p>
<p>As for the new parameter type for <span class="math inline">\(\sigma\)</span>, the exponential distribution is controlled by a single parameter, <span class="math inline">\(\lambda\)</span>, which is also called the <em>rate</em>. As it turns out, the mean of the exponential distribution is the inverse of the rate, <span class="math inline">\(1 / \lambda\)</span>. Here we use the <code>dexp()</code> function to get a sense of what that prior looks like.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="geocentric-models.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb411-2"><a href="geocentric-models.html#cb411-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> <span class="fu">dexp</span>(x, <span class="at">rate =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb411-3"><a href="geocentric-models.html#cb411-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb411-4"><a href="geocentric-models.html#cb411-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> d)) <span class="sc">+</span></span>
<span id="cb411-5"><a href="geocentric-models.html#cb411-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;#ffb7c5&quot;</span>) <span class="sc">+</span></span>
<span id="cb411-6"><a href="geocentric-models.html#cb411-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb411-7"><a href="geocentric-models.html#cb411-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb411-8"><a href="geocentric-models.html#cb411-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb411-9"><a href="geocentric-models.html#cb411-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-126-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>“We’ll use exponential priors for the rest of the book, in place of uniform priors. It is much more common to have a sense of the average deviation than of the maximum” (p. 119). 🎉</p>
<p><strong>Acknowledgment</strong>: The workflow to follow is heavily influenced by the <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/22">helpful contributions</a> from <a href="https://github.com/sjwild">Stephen Wild</a>. My first pass through the material in this section was a mess. Wild’s insights knocked it out of the park and I couldn’t be more grateful. 🍻</p>
<p>Before fitting this model in <strong>brms</strong>, well take a minor detour on the data structure. In his <strong>R</strong> code 4.76, McElreath defined his data in a list, <code>list( D=d2$doy , B=B )</code>. Our approach will be a little different. Here, we’ll add the <code>B</code> matrix to our <code>d2</code> data frame and name the results as <code>d3</code>.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="geocentric-models.html#cb412-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span></span>
<span id="cb412-2"><a href="geocentric-models.html#cb412-2" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span> </span>
<span id="cb412-3"><a href="geocentric-models.html#cb412-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B =</span> B) </span>
<span id="cb412-4"><a href="geocentric-models.html#cb412-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-5"><a href="geocentric-models.html#cb412-5" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the structure of `d3</span></span>
<span id="cb412-6"><a href="geocentric-models.html#cb412-6" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 827
## Columns: 6
## $ year       &lt;int&gt; 812, 815, 831, 851, 853, 864, 866, 869, 889, 891, 892, 894, 895, 896, 902, 908,…
## $ doy        &lt;int&gt; 92, 105, 96, 108, 104, 100, 106, 95, 104, 109, 108, 106, 104, 104, 102, 98, 95,…
## $ temp       &lt;dbl&gt; NA, NA, NA, 7.38, NA, 6.42, 6.44, NA, 6.83, 6.98, 7.11, 6.98, 7.08, 7.20, 7.50,…
## $ temp_upper &lt;dbl&gt; NA, NA, NA, 12.10, NA, 8.69, 8.11, NA, 8.48, 8.96, 9.11, 8.40, 8.57, 8.69, 8.95…
## $ temp_lower &lt;dbl&gt; NA, NA, NA, 2.66, NA, 4.14, 4.77, NA, 5.19, 5.00, 5.11, 5.55, 5.58, 5.72, 6.06,…
## $ B          &lt;bs[,17]&gt; &lt;bs[33 x 17]&gt;</code></pre>
<p>In our <code>d3</code> data, columns <code>year</code> through <code>temp_lower</code> are all standard data columns. The <code>B</code> column is a <em>matrix column</em>, which contains the same number of rows as the others, but also smuggled in 17 columns <em>within</em> that column. Each of those 17 columns corresponds to one of our synthetic <span class="math inline">\(B_k\)</span> variables. The advantage of such a data structure is we can simply define our <code>formula</code> argument as <code>doy ~ 1 + B</code>, where <code>B</code> is a stand-in for <code>B.1 + B.2 + ... + B.17</code>.</p>
<p>Here’s how to fit the model.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="geocentric-models.html#cb414-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.8</span> <span class="ot">&lt;-</span> </span>
<span id="cb414-2"><a href="geocentric-models.html#cb414-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3,</span>
<span id="cb414-3"><a href="geocentric-models.html#cb414-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb414-4"><a href="geocentric-models.html#cb414-4" aria-hidden="true" tabindex="-1"></a>      doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B,</span>
<span id="cb414-5"><a href="geocentric-models.html#cb414-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb414-6"><a href="geocentric-models.html#cb414-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb414-7"><a href="geocentric-models.html#cb414-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb414-8"><a href="geocentric-models.html#cb414-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb414-9"><a href="geocentric-models.html#cb414-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb414-10"><a href="geocentric-models.html#cb414-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.08&quot;</span>)</span></code></pre></div>
<p>Here’s the model summary.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="geocentric-models.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + B 
##    Data: d3 (Number of observations: 827) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   103.48      2.37    98.86   108.29 1.00      822      812
## B1           -3.18      3.90   -10.80     4.34 1.00     2002     2531
## B2           -0.89      3.92    -8.64     6.88 1.00     1484     2029
## B3           -1.20      3.64    -8.37     5.77 1.00     1698     2329
## B4            4.69      2.93    -1.22    10.51 1.00     1107     1523
## B5           -0.97      2.91    -6.87     4.63 1.00     1163     1878
## B6            4.17      3.00    -1.84    10.03 1.00     1153     1825
## B7           -5.46      2.79   -11.05     0.01 1.00     1089     1835
## B8            7.70      2.82     1.90    13.09 1.00     1093     1581
## B9           -1.10      2.83    -6.61     4.40 1.00     1159     1792
## B10           2.89      2.90    -2.97     8.57 1.00     1144     1570
## B11           4.52      2.90    -1.24    10.08 1.01     1091     1413
## B12          -0.25      2.87    -5.91     5.35 1.00     1113     1647
## B13           5.43      2.90    -0.36    11.05 1.00     1131     1392
## B14           0.59      2.97    -5.28     6.21 1.00     1134     1710
## B15          -0.92      3.36    -7.53     5.52 1.00     1427     1973
## B16          -7.05      3.38   -13.62    -0.49 1.00     1352     2278
## B17          -7.82      3.25   -14.31    -1.60 1.00     1450     2022
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.95      0.15     5.65     6.26 1.00     4739     2556
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Look at that. Each of the 17 columns in our <code>B</code> matrix was assigned its own parameter. If you fit this model using McElreath’s <strong>rethinking</strong> code, you’ll see the results are very similar. Anyway, McElreath’s comments are in line with the general consensus on spline modes: the parameter estimates are very difficult to interpret directly. It’s often easier to just plot the results. First we’ll use <code>as_draws_df()</code>.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="geocentric-models.html#cb417-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.8</span>)</span>
<span id="cb417-2"><a href="geocentric-models.html#cb417-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-3"><a href="geocentric-models.html#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(post)</span></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 24
## $ b_Intercept &lt;dbl&gt; 102.32504, 101.75728, 101.80386, 101.92193, 101.36358, 102.58841, 102.83753, 1…
## $ b_B1        &lt;dbl&gt; -2.1988769, 1.5514613, 1.2155614, -0.2260800, -5.3466776, 1.2661183, -0.165271…
## $ b_B2        &lt;dbl&gt; -0.2154135, -1.4097661, -1.1620970, -0.8663052, -1.4269088, -0.3568163, -0.426…
## $ b_B3        &lt;dbl&gt; -0.4913627, 4.2627188, 0.8630932, 1.8648489, 2.9954010, 2.8174197, 0.1149853, …
## $ b_B4        &lt;dbl&gt; 7.4442026, 3.4077223, 6.8353421, 6.9645063, 6.9263101, 1.7572209, 2.4381738, 4…
## $ b_B5        &lt;dbl&gt; -0.246148963, 0.563588101, -0.725083945, -0.804760360, 1.948173110, 4.04556288…
## $ b_B6        &lt;dbl&gt; 5.0194834, 8.4675143, 5.8073068, 4.2985029, 5.4844646, 1.5182629, 2.7351115, 0…
## $ b_B7        &lt;dbl&gt; -4.07109823, -4.67831416, -2.93514477, -1.39525133, -2.95801589, -1.44077038, …
## $ b_B8        &lt;dbl&gt; 10.417435, 8.542275, 8.367905, 7.945836, 11.250234, 4.157325, 3.785513, 3.9697…
## $ b_B9        &lt;dbl&gt; -0.6992461, 0.3026989, 0.5020246, 0.5388738, -2.3026806, 4.0278503, 7.4282320,…
## $ b_B10       &lt;dbl&gt; 3.43122541, 4.61206330, 4.87407828, 5.43929731, 6.97625595, -0.65732856, 0.180…
## $ b_B11       &lt;dbl&gt; 7.1345025, 6.4545413, 7.2468865, 7.5544752, 6.8768078, 5.8222779, 5.9044086, 5…
## $ b_B12       &lt;dbl&gt; 1.11828353, -0.18948805, -2.15614349, -0.08340726, -0.07974591, 0.76294221, 0.…
## $ b_B13       &lt;dbl&gt; 7.3249821, 9.9780688, 8.0284798, 7.6882063, 8.0267477, 5.9900975, 4.8875842, 3…
## $ b_B14       &lt;dbl&gt; 0.17357374, 0.60153059, 1.95809216, 2.25748157, 3.58658608, 1.49630224, 2.5791…
## $ b_B15       &lt;dbl&gt; 1.78979983, 1.19775664, 1.67885316, -0.39557457, 0.15815847, -1.39812485, -2.7…
## $ b_B16       &lt;dbl&gt; -4.383675, -8.741232, -4.975459, -7.362419, -4.482333, -4.384121, -5.641176, -…
## $ b_B17       &lt;dbl&gt; -5.394303, -6.001336, -6.302160, -7.555139, -6.558063, -8.023699, -7.110669, -…
## $ sigma       &lt;dbl&gt; 5.821055, 5.863408, 5.860110, 5.791223, 6.186431, 6.111093, 6.095315, 6.089382…
## $ lprior      &lt;dbl&gt; -65.82895, -66.33285, -65.84365, -65.87950, -66.76725, -65.32073, -65.42357, -…
## $ lp__        &lt;dbl&gt; -2710.249, -2714.750, -2710.344, -2712.408, -2713.698, -2717.167, -2720.764, -…
## $ .chain      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ .iteration  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,…
## $ .draw       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,…</code></pre>
<p>With a little wrangling, we can use summary information from <code>post</code> to make our version of the middle panel of Figure 4.13.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="geocentric-models.html#cb419-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb419-2"><a href="geocentric-models.html#cb419-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_B1<span class="sc">:</span>b_B17) <span class="sc">%&gt;%</span> </span>
<span id="cb419-3"><a href="geocentric-models.html#cb419-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="fu">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="sc">:</span><span class="dv">17</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb419-4"><a href="geocentric-models.html#cb419-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb419-5"><a href="geocentric-models.html#cb419-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bias_function) <span class="sc">%&gt;%</span> </span>
<span id="cb419-6"><a href="geocentric-models.html#cb419-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb419-7"><a href="geocentric-models.html#cb419-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(b, <span class="at">by =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb419-8"><a href="geocentric-models.html#cb419-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb419-9"><a href="geocentric-models.html#cb419-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb419-10"><a href="geocentric-models.html#cb419-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias <span class="sc">*</span> weight, <span class="at">group =</span> bias_function)) <span class="sc">+</span></span>
<span id="cb419-11"><a href="geocentric-models.html#cb419-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb419-12"><a href="geocentric-models.html#cb419-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb419-13"><a href="geocentric-models.html#cb419-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb419-14"><a href="geocentric-models.html#cb419-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb419-15"><a href="geocentric-models.html#cb419-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-131-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In case you missed it, the main action in the <strong>ggplot2</strong> code was <code>y = bias * weight</code>, where we defined the <span class="math inline">\(y\)</span>-axis as the product of <code>bias</code> and <code>weight</code>. This is fulfillment of the <span class="math inline">\(w_k B_{k, i}\)</span> parts of the model. Now here’s how we might use <code>brms::fitted()</code> to make the lower plot of Figure 4.13.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="geocentric-models.html#cb420-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.8</span>)</span>
<span id="cb420-2"><a href="geocentric-models.html#cb420-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-3"><a href="geocentric-models.html#cb420-3" aria-hidden="true" tabindex="-1"></a>f <span class="sc">%&gt;%</span> </span>
<span id="cb420-4"><a href="geocentric-models.html#cb420-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb420-5"><a href="geocentric-models.html#cb420-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d2) <span class="sc">%&gt;%</span> </span>
<span id="cb420-6"><a href="geocentric-models.html#cb420-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb420-7"><a href="geocentric-models.html#cb420-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span> </span>
<span id="cb420-8"><a href="geocentric-models.html#cb420-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb420-9"><a href="geocentric-models.html#cb420-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.8</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb420-10"><a href="geocentric-models.html#cb420-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb420-11"><a href="geocentric-models.html#cb420-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb420-12"><a href="geocentric-models.html#cb420-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb420-13"><a href="geocentric-models.html#cb420-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb420-14"><a href="geocentric-models.html#cb420-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb420-15"><a href="geocentric-models.html#cb420-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb420-16"><a href="geocentric-models.html#cb420-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-132-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If it wasn’t clear, the dashed horizontal line intersecting a little above 100 on the <span class="math inline">\(y\)</span>-axis is the posterior mean for the intercept. Now let’s use our skills to remake the simpler model expressed in Figure 4.12. This model, recall, is based on 5 knots.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="geocentric-models.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># redo the `B` splines</span></span>
<span id="cb421-2"><a href="geocentric-models.html#cb421-2" aria-hidden="true" tabindex="-1"></a>num_knots <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb421-3"><a href="geocentric-models.html#cb421-3" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(d2<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> num_knots))</span>
<span id="cb421-4"><a href="geocentric-models.html#cb421-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-5"><a href="geocentric-models.html#cb421-5" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(d2<span class="sc">$</span>year,</span>
<span id="cb421-6"><a href="geocentric-models.html#cb421-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, num_knots)], </span>
<span id="cb421-7"><a href="geocentric-models.html#cb421-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this makes the splines liner rater than cubic</span></span>
<span id="cb421-8"><a href="geocentric-models.html#cb421-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree =</span> <span class="dv">1</span>, </span>
<span id="cb421-9"><a href="geocentric-models.html#cb421-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb421-10"><a href="geocentric-models.html#cb421-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-11"><a href="geocentric-models.html#cb421-11" aria-hidden="true" tabindex="-1"></a><span class="co"># define a new `d4` data</span></span>
<span id="cb421-12"><a href="geocentric-models.html#cb421-12" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> </span>
<span id="cb421-13"><a href="geocentric-models.html#cb421-13" aria-hidden="true" tabindex="-1"></a>  d2 <span class="sc">%&gt;%</span> </span>
<span id="cb421-14"><a href="geocentric-models.html#cb421-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">B =</span> B)</span>
<span id="cb421-15"><a href="geocentric-models.html#cb421-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-16"><a href="geocentric-models.html#cb421-16" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.9</span> <span class="ot">&lt;-</span> </span>
<span id="cb421-17"><a href="geocentric-models.html#cb421-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4,</span>
<span id="cb421-18"><a href="geocentric-models.html#cb421-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb421-19"><a href="geocentric-models.html#cb421-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B,</span>
<span id="cb421-20"><a href="geocentric-models.html#cb421-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb421-21"><a href="geocentric-models.html#cb421-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb421-22"><a href="geocentric-models.html#cb421-22" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb421-23"><a href="geocentric-models.html#cb421-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb421-24"><a href="geocentric-models.html#cb421-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb421-25"><a href="geocentric-models.html#cb421-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.09&quot;</span>)</span></code></pre></div>
<p>Review the new model summary.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="geocentric-models.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + B 
##    Data: d4 (Number of observations: 827) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   103.50      4.34    95.12   111.99 1.00      800     1283
## B1           -0.35      4.42    -8.96     8.24 1.00      830     1436
## B2            1.43      4.37    -7.20     9.74 1.00      815     1328
## B3            1.52      4.35    -6.93     9.98 1.00      808     1312
## B4            3.94      4.38    -4.57    12.53 1.00      801     1264
## B5           -5.59      4.39   -14.10     2.79 1.00      829     1348
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     6.09      0.15     5.81     6.39 1.00     2251     2146
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we do all the work in bulk to make and save the three subplots for Figure 4.12.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="geocentric-models.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="do">## top</span></span>
<span id="cb424-2"><a href="geocentric-models.html#cb424-2" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle a bit</span></span>
<span id="cb424-3"><a href="geocentric-models.html#cb424-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span></span>
<span id="cb424-4"><a href="geocentric-models.html#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invoke</span>(data.frame, d4) <span class="sc">%&gt;%</span> </span>
<span id="cb424-5"><a href="geocentric-models.html#cb424-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;B&quot;</span>),</span>
<span id="cb424-6"><a href="geocentric-models.html#cb424-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>,</span>
<span id="cb424-7"><a href="geocentric-models.html#cb424-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb424-8"><a href="geocentric-models.html#cb424-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-9"><a href="geocentric-models.html#cb424-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb424-10"><a href="geocentric-models.html#cb424-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb424-11"><a href="geocentric-models.html#cb424-11" aria-hidden="true" tabindex="-1"></a>  b <span class="sc">%&gt;%</span> </span>
<span id="cb424-12"><a href="geocentric-models.html#cb424-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias, <span class="at">group =</span> bias_function)) <span class="sc">+</span></span>
<span id="cb424-13"><a href="geocentric-models.html#cb424-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-14"><a href="geocentric-models.html#cb424-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb424-15"><a href="geocentric-models.html#cb424-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb424-16"><a href="geocentric-models.html#cb424-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;bias value&quot;</span>)</span>
<span id="cb424-17"><a href="geocentric-models.html#cb424-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-18"><a href="geocentric-models.html#cb424-18" aria-hidden="true" tabindex="-1"></a><span class="do">## middle</span></span>
<span id="cb424-19"><a href="geocentric-models.html#cb424-19" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb424-20"><a href="geocentric-models.html#cb424-20" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb424-21"><a href="geocentric-models.html#cb424-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(b4<span class="fl">.9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb424-22"><a href="geocentric-models.html#cb424-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_B1<span class="sc">:</span>b_B5) <span class="sc">%&gt;%</span> </span>
<span id="cb424-23"><a href="geocentric-models.html#cb424-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;B.&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb424-24"><a href="geocentric-models.html#cb424-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb424-25"><a href="geocentric-models.html#cb424-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bias_function) <span class="sc">%&gt;%</span> </span>
<span id="cb424-26"><a href="geocentric-models.html#cb424-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb424-27"><a href="geocentric-models.html#cb424-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(b, <span class="at">by =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb424-28"><a href="geocentric-models.html#cb424-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb424-29"><a href="geocentric-models.html#cb424-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb424-30"><a href="geocentric-models.html#cb424-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias <span class="sc">*</span> weight, <span class="at">group =</span> bias_function)) <span class="sc">+</span></span>
<span id="cb424-31"><a href="geocentric-models.html#cb424-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-32"><a href="geocentric-models.html#cb424-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb424-33"><a href="geocentric-models.html#cb424-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>)</span>
<span id="cb424-34"><a href="geocentric-models.html#cb424-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-35"><a href="geocentric-models.html#cb424-35" aria-hidden="true" tabindex="-1"></a><span class="do">## bottom</span></span>
<span id="cb424-36"><a href="geocentric-models.html#cb424-36" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb424-37"><a href="geocentric-models.html#cb424-37" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(b4<span class="fl">.9</span>)</span>
<span id="cb424-38"><a href="geocentric-models.html#cb424-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-39"><a href="geocentric-models.html#cb424-39" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb424-40"><a href="geocentric-models.html#cb424-40" aria-hidden="true" tabindex="-1"></a>  f <span class="sc">%&gt;%</span> </span>
<span id="cb424-41"><a href="geocentric-models.html#cb424-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb424-42"><a href="geocentric-models.html#cb424-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d2) <span class="sc">%&gt;%</span> </span>
<span id="cb424-43"><a href="geocentric-models.html#cb424-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb424-44"><a href="geocentric-models.html#cb424-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb424-45"><a href="geocentric-models.html#cb424-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span> </span>
<span id="cb424-46"><a href="geocentric-models.html#cb424-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> knot_list, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-47"><a href="geocentric-models.html#cb424-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.9</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-48"><a href="geocentric-models.html#cb424-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb424-49"><a href="geocentric-models.html#cb424-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb424-50"><a href="geocentric-models.html#cb424-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb424-51"><a href="geocentric-models.html#cb424-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>)</span></code></pre></div>
<p>Now combine the subplots with <strong>patchwork</strong> syntax and behold their glory.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="geocentric-models.html#cb425-1" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3) <span class="sc">&amp;</span></span>
<span id="cb425-2"><a href="geocentric-models.html#cb425-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">&amp;</span></span>
<span id="cb425-3"><a href="geocentric-models.html#cb425-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</span>
<span id="cb425-4"><a href="geocentric-models.html#cb425-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-135-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="smooth-functions-for-a-rough-world." class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Smooth functions for a rough world.<a href="geocentric-models.html#smooth-functions-for-a-rough-world." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The splines in the previous section are just the beginning. A entire class of models, <strong>generalized additive models</strong> (GAMs), focuses on predicting an outcome variable using smooth functions of some predictor variables. The topic is deep enough to deserve its own book. (p. 120, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>McElreath ended that block quote with a reference to his endnote #78. On page 562, we read: “A very popular and comprehensive text is Wood <span class="citation">(<a href="#ref-woodGeneralizedAdditiveModels2017" role="doc-biblioref">2017a</a>)</span>.”</p>
</div>
</div>
<div id="summary-first-bonus-smooth-functions-with-brmss" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> <del>Summary</del> First bonus: Smooth functions with <code>brms::s()</code><a href="geocentric-models.html#summary-first-bonus-smooth-functions-with-brmss" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It’s convenient for us how McElreath ended that last section with a reference to Simon Wood’s work because <strong>brms</strong> allows for a variety of non-linear models by borrowing functions from Woods’s <a href="https://CRAN.R-project.org/package=mgcv"><strong>mgcv</strong> package</a> <span class="citation">(<a href="#ref-mgcv2003" role="doc-biblioref">Wood, 2003</a>, <a href="#ref-mgcv2004" role="doc-biblioref">2004</a>, <a href="#ref-mgcv2011" role="doc-biblioref">2011</a>, <a href="#ref-mgcv2017" role="doc-biblioref">2017b</a>, <a href="#ref-R-mgcv" role="doc-biblioref">2022</a>; <a href="#ref-mgcv2016" role="doc-biblioref">Wood et al., 2016</a>)</span>. The two smooth functions <strong>brms</strong> imports from <strong>mgcv</strong> are <code>s()</code> and <code>t2()</code>. We’ll be exploring <code>s()</code>. We might use the <code>brms::get_prior()</code> function to get a sense of how to set up the priors when using <code>s()</code>.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="geocentric-models.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> d2,</span>
<span id="cb426-2"><a href="geocentric-models.html#cb426-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> gaussian,</span>
<span id="cb426-3"><a href="geocentric-models.html#cb426-3" aria-hidden="true" tabindex="-1"></a>          doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year))</span></code></pre></div>
<pre><code>##                   prior     class    coef group resp dpar nlpar lb ub       source
##                  (flat)         b                                          default
##                  (flat)         b syear_1                             (vectorized)
##  student_t(3, 105, 5.9) Intercept                                          default
##    student_t(3, 0, 5.9)       sds                                0         default
##    student_t(3, 0, 5.9)       sds s(year)                        0    (vectorized)
##    student_t(3, 0, 5.9)     sigma                                0         default</code></pre>
<p>We have an overall intercept (<code>class = Intercept</code>), a single <span class="math inline">\(\beta\)</span> parameter for <code>year</code> (<code>class = b</code>), a <span class="math inline">\(\sigma\)</span> parameter (<code>class = sigma</code>), and an unfamiliar parameter of <code>class = sds</code>. I’m not going to go into that last parameter in any detail, here. We’ll need to work our way up through <a href="models-with-memory.html#models-with-memory">Chapter 13</a> and the multilevel model to get a full picture of what it means. The important thing to note here is that the priors for our <code>s()</code>-based alternative to the B-spline models, above, are going to look a little different. Here’s how we might fit an alternative to <code>b4.8</code></p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="geocentric-models.html#cb428-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.10</span> <span class="ot">&lt;-</span></span>
<span id="cb428-2"><a href="geocentric-models.html#cb428-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb428-3"><a href="geocentric-models.html#cb428-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb428-4"><a href="geocentric-models.html#cb428-4" aria-hidden="true" tabindex="-1"></a>      doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year),</span>
<span id="cb428-5"><a href="geocentric-models.html#cb428-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb428-6"><a href="geocentric-models.html#cb428-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb428-7"><a href="geocentric-models.html#cb428-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">5.9</span>), <span class="at">class =</span> sds),</span>
<span id="cb428-8"><a href="geocentric-models.html#cb428-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb428-9"><a href="geocentric-models.html#cb428-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb428-10"><a href="geocentric-models.html#cb428-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb428-11"><a href="geocentric-models.html#cb428-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb428-12"><a href="geocentric-models.html#cb428-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.10&quot;</span>)</span></code></pre></div>
<p>Check out the model summary.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="geocentric-models.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.10</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + s(year) 
##    Data: d2 (Number of observations: 827) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Smooth Terms: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sds(syear_1)    22.42      7.38    11.68    39.69 1.00     1116     2155
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   104.54      0.21   104.14   104.95 1.00     4454     2741
## syear_1      -9.82      9.13   -27.02     8.84 1.00     3596     3136
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     6.04      0.15     5.77     6.34 1.00     4693     2770
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our intercept and <span class="math inline">\(\sigma\)</span> summaries are similar to those we got from <code>b4.8</code>. The rest looks different and maybe a little disorienting. Here’s what happens when we use <code>brms::fitted()</code> to plot the implications of the model.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="geocentric-models.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b4<span class="fl">.10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb431-2"><a href="geocentric-models.html#cb431-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb431-3"><a href="geocentric-models.html#cb431-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(d2, year, doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb431-4"><a href="geocentric-models.html#cb431-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb431-5"><a href="geocentric-models.html#cb431-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb431-6"><a href="geocentric-models.html#cb431-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.10</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb431-7"><a href="geocentric-models.html#cb431-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb431-8"><a href="geocentric-models.html#cb431-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb431-9"><a href="geocentric-models.html#cb431-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;b4.7 using s(year)&quot;</span>,</span>
<span id="cb431-10"><a href="geocentric-models.html#cb431-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-11"><a href="geocentric-models.html#cb431-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb431-12"><a href="geocentric-models.html#cb431-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>), </span>
<span id="cb431-13"><a href="geocentric-models.html#cb431-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-138-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>That smooth doesn’t look quite the same. Hopefully this isn’t terribly surprising. We used a function from a different package and ended up with a different underlying statistical model. In fact, we didn’t even use a B-spline. The default for <code>s()</code> is to use what’s called a <em>thin plate</em> regression spline. If we’d like to fit a B-spline, we have to set <code>bs = "bs"</code>. Here’s an example.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="geocentric-models.html#cb432-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.11</span> <span class="ot">&lt;-</span></span>
<span id="cb432-2"><a href="geocentric-models.html#cb432-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2,</span>
<span id="cb432-3"><a href="geocentric-models.html#cb432-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb432-4"><a href="geocentric-models.html#cb432-4" aria-hidden="true" tabindex="-1"></a>      doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">&quot;bs&quot;</span>, <span class="at">k =</span> <span class="dv">19</span>),</span>
<span id="cb432-5"><a href="geocentric-models.html#cb432-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb432-6"><a href="geocentric-models.html#cb432-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb432-7"><a href="geocentric-models.html#cb432-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">5.9</span>), <span class="at">class =</span> sds),</span>
<span id="cb432-8"><a href="geocentric-models.html#cb432-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb432-9"><a href="geocentric-models.html#cb432-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb432-10"><a href="geocentric-models.html#cb432-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb432-11"><a href="geocentric-models.html#cb432-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb432-12"><a href="geocentric-models.html#cb432-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.11&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="geocentric-models.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.11</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + s(year, bs = &quot;bs&quot;, k = 19) 
##    Data: d2 (Number of observations: 827) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Smooth Terms: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sds(syear_1)     1.29      0.62     0.50     2.87 1.01      579     1342
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   104.54      0.21   104.14   104.94 1.00     4656     2685
## syear_1      -0.08      0.32    -0.71     0.56 1.00     1773     1695
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.99      0.15     5.70     6.29 1.00     4831     2961
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now here’s the depiction of our <code>s()</code>-based B-spline model.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="geocentric-models.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b4<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb435-2"><a href="geocentric-models.html#cb435-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb435-3"><a href="geocentric-models.html#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(d2, year, doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb435-4"><a href="geocentric-models.html#cb435-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb435-5"><a href="geocentric-models.html#cb435-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb435-6"><a href="geocentric-models.html#cb435-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(b4<span class="fl">.11</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb435-7"><a href="geocentric-models.html#cb435-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb435-8"><a href="geocentric-models.html#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb435-9"><a href="geocentric-models.html#cb435-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&#39;b4.7_bs using s(year, bs = &quot;bs&quot;)&#39;</span>,</span>
<span id="cb435-10"><a href="geocentric-models.html#cb435-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb435-11"><a href="geocentric-models.html#cb435-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb435-12"><a href="geocentric-models.html#cb435-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#4f455c&quot;</span>), </span>
<span id="cb435-13"><a href="geocentric-models.html#cb435-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="04_files/figure-html/unnamed-chunk-140-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>There are still other important differences between the underlying statistical model for <code>b4.11</code> and the earlier <code>b4.8</code> that I’m just not going to go into, here.</p>
<p>For more on the B-splines and smooths, more generally, check out the blog post by the great <a href="https://twitter.com/ucfagls">Gavin Simpson</a>, <a href="https://fromthebottomoftheheap.net/2020/06/03/extrapolating-with-gams/"><em>Extrapolating with B splines and GAMs</em></a>. For a high-level introduction to the models you can fit with <strong>mgcv</strong>, check out the nice talk by <a href="https://twitter.com/noamross">Noam Ross</a>, <a href="https://youtu.be/q4_t8jXcQgc"><em>Nonlinear models in R: The wonderful world of mgcv</em></a>, or the equally-nice presentation by Simpson, <a href="https://youtu.be/sgw4cu8hrZM"><em>Introduction to generalized additive models with R and mgcv</em></a>. Ross offers a free online course covering <strong>mgcv</strong>, called <a href="https://noamross.github.io/gams-in-r-course/">GAMS in R</a>, and he maintains a GitHub repo cataloguing other GAM-related resources, called <a href="https://github.com/noamross/gam-resources"><em>Resources for learning about and using GAMs in R</em></a>. For specific examples of fitting various GAMS with <strong>brms</strong>, check out Simpson’s blog post, <a href="https://fromthebottomoftheheap.net/2018/04/21/fitting-gams-with-brms/"><strong>Fitting GAMs with brms: part 1</strong></a>. Finally, <a href="https://twitter.com/tjmahr">Tristan Mahr</a> has a nice blog post called <a href="https://www.tjmahr.com/random-effects-penalized-splines-same-thing/"><em>Random effects and penalized splines are the same thing</em></a>, where he outlined the connections between penalized smooths, such as you might fit with <strong>mgcv</strong>, with the multilevel model, which we’ll learn all about starting in <a href="models-with-memory.html#models-with-memory">Chapter 13</a>, which helps explain what’s going on with the <code>s()</code> function in our last two models, <code>b4.10</code> and <code>b4.11</code>.</p>
</div>
<div id="second-bonus-group-predictors-with-matrix-columns" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Second bonus: Group predictors with matrix columns<a href="geocentric-models.html#second-bonus-group-predictors-with-matrix-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When we fit <code>b4.8</code>, our direct <strong>brms</strong> analogue to McElreath’s <code>m4.7</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, we used a compact syntax to pass a matrix column of predictors into the <code>formula</code>. If memory serves, this is one of the only places in the text where we see this. It would be easy for the casual reader to think this was only appropriate for something like a spline model. But that’s not the case. One could use the matrix-column trick as a general approach. In this bonus section, we’ll explore how.</p>
<p>In Section 11.2.6 of their <span class="citation">(<a href="#ref-gelmanRegressionOtherStories2020" role="doc-biblioref">2020</a>)</span> text, Gelman, Hill, and Vehtari worked through an example of a multiple regression model,</p>
<p><span class="math display">\[
\begin{align*}
y_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \theta z_i + \sum_{k = 1}^K b_k x_{k, i} \\
&amp; \text{&lt;priors&gt;},
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> was some continuous variable collected across participants, <span class="math inline">\(i\)</span>. The <span class="math inline">\(\alpha\)</span> term was the intercept and the <span class="math inline">\(\theta\)</span> term was the regression slope for a binary variable <span class="math inline">\(z\)</span>–we’ll practice with binary predictors in <a href="the-many-variables-the-spurious-waffles.html#categorical-variables">Section 5.3</a>. More to our interest, the last portion of the equation is a compact way to convey there are <span class="math inline">\(K\)</span> additional predictors and their associated regression coefficients, which we might more explicitly express as <span class="math inline">\(\beta_1 x_{1, i} + \cdots + \beta_k x_{k, i}\)</span>, where <span class="math inline">\(K \geq 1\)</span>. In this particular example, <span class="math inline">\(K = 10\)</span>, meaning there were ten <span class="math inline">\(x_{k, i}\)</span> predictors, making this an example of a model with 11 total predictor variables.</p>
<p>Riffing off of Gelman and colleagues, here’s how you might simulate data of this kind.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="geocentric-models.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many cases would you like?</span></span>
<span id="cb436-2"><a href="geocentric-models.html#cb436-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb436-3"><a href="geocentric-models.html#cb436-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-4"><a href="geocentric-models.html#cb436-4" aria-hidden="true" tabindex="-1"></a><span class="co"># how many continuous x predictor variables would you like?</span></span>
<span id="cb436-5"><a href="geocentric-models.html#cb436-5" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb436-6"><a href="geocentric-models.html#cb436-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-7"><a href="geocentric-models.html#cb436-7" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a dichotomous dummy variable for z</span></span>
<span id="cb436-8"><a href="geocentric-models.html#cb436-8" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate an n by k array for X</span></span>
<span id="cb436-9"><a href="geocentric-models.html#cb436-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb436-10"><a href="geocentric-models.html#cb436-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-11"><a href="geocentric-models.html#cb436-11" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb436-12"><a href="geocentric-models.html#cb436-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">z =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> T),</span>
<span id="cb436-13"><a href="geocentric-models.html#cb436-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">X =</span> <span class="fu">array</span>(<span class="fu">runif</span>(n <span class="sc">*</span> k, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>), <span class="at">dim =</span> <span class="fu">c</span>(n, k)))</span>
<span id="cb436-14"><a href="geocentric-models.html#cb436-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-15"><a href="geocentric-models.html#cb436-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set the data-generating parameter values</span></span>
<span id="cb436-16"><a href="geocentric-models.html#cb436-16" aria-hidden="true" tabindex="-1"></a>a     <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb436-17"><a href="geocentric-models.html#cb436-17" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb436-18"><a href="geocentric-models.html#cb436-18" aria-hidden="true" tabindex="-1"></a>b     <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>k</span>
<span id="cb436-19"><a href="geocentric-models.html#cb436-19" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb436-20"><a href="geocentric-models.html#cb436-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-21"><a href="geocentric-models.html#cb436-21" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the criterion</span></span>
<span id="cb436-22"><a href="geocentric-models.html#cb436-22" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb436-23"><a href="geocentric-models.html#cb436-23" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb436-24"><a href="geocentric-models.html#cb436-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(a <span class="sc">+</span> X <span class="sc">%*%</span> b <span class="sc">+</span> theta <span class="sc">*</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)))</span>
<span id="cb436-25"><a href="geocentric-models.html#cb436-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-26"><a href="geocentric-models.html#cb436-26" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data structure</span></span>
<span id="cb436-27"><a href="geocentric-models.html#cb436-27" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb436-28"><a href="geocentric-models.html#cb436-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 100
## Columns: 3
## $ z &lt;int&gt; 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1…
## $ X &lt;dbl[,10]&gt; &lt;matrix[33 x 10]&gt;
## $ y &lt;dbl&gt; 19.51231, 26.75217, 28.92495, 20.63144, 29.18219, 43.67198, 36.98107, 36.68241, 28.…</code></pre>
<p>Although our <code>d</code> tibble has only three columns, the <code>X</code> column is a matrix column into which we’ve smuggled ten columns more. Here’s how we might access them more directly.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="geocentric-models.html#cb438-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb438-2"><a href="geocentric-models.html#cb438-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(X) <span class="sc">%&gt;%</span> </span>
<span id="cb438-3"><a href="geocentric-models.html#cb438-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>##  num [1:100, 1:10] 0.253 0.63 0.266 0.532 0.468 ...</code></pre>
<p>See? There’s an <span class="math inline">\(100 \times 10\)</span> data matrix in there. <em>Tricky</em>. Here’s how to fit the full model with <strong>brms</strong> where we use the compact matrix-column syntax in the <code>formula</code> argument.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="geocentric-models.html#cb440-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.12</span> <span class="ot">&lt;-</span></span>
<span id="cb440-2"><a href="geocentric-models.html#cb440-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb440-3"><a href="geocentric-models.html#cb440-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb440-4"><a href="geocentric-models.html#cb440-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> z <span class="sc">+</span> X,</span>
<span id="cb440-5"><a href="geocentric-models.html#cb440-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb440-6"><a href="geocentric-models.html#cb440-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb440-7"><a href="geocentric-models.html#cb440-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb440-8"><a href="geocentric-models.html#cb440-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb440-9"><a href="geocentric-models.html#cb440-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb440-10"><a href="geocentric-models.html#cb440-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b04.12&quot;</span>)</span></code></pre></div>
<p>Check the parameter summary.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="geocentric-models.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.12</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 1 + z + X 
##    Data: d (Number of observations: 100) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.94      1.18    -1.30     3.30 1.00     5606     3180
## z             4.75      0.40     3.96     5.55 1.00     5969     3210
## X1            0.56      0.74    -0.89     2.02 1.00     5815     3470
## X2            0.90      0.68    -0.40     2.25 1.00     6850     3068
## X3            3.40      0.74     1.96     4.84 1.00     5962     3220
## X4            2.81      0.74     1.37     4.28 1.00     6167     3479
## X5            5.75      0.73     4.31     7.16 1.00     6013     3306
## X6            6.39      0.73     4.97     7.79 1.00     5967     3572
## X7            8.49      0.75     7.03     9.93 1.00     6573     2826
## X8            8.39      0.72     6.97     9.78 1.00     7515     3137
## X9            8.84      0.84     7.16    10.44 1.00     6600     3352
## X10           9.33      0.69     7.96    10.70 1.00     6761     3190
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.99      0.16     1.71     2.33 1.00     5431     2997
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><strong>brms</strong> automatically numbered our <span class="math inline">\(K = 10\)</span> <code>X</code> variables as <code>X1</code> through <code>X10</code>. As far as applications go, I’m not sure where I’d use this way of storing and modeling data in real life. But maybe some of y’all work in domains where this is just the right way to approach your data needs. If so, good luck and happy modeling.</p>
</div>
<div id="session-info-3" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="geocentric-models.html#session-info-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="geocentric-models.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] splines   parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_3.0.2      brms_2.18.0          Rcpp_1.0.9           cmdstanr_0.5.3      
##  [5] rstan_2.21.8         StanHeaders_2.21.0-7 patchwork_1.1.2      forcats_0.5.1       
##  [9] stringr_1.4.1        dplyr_1.0.10         purrr_1.0.1          readr_2.1.2         
## [13] tidyr_1.2.1          tibble_3.1.8         ggplot2_3.4.0        tidyverse_1.3.2     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      plyr_1.8.7           igraph_1.3.4        
##   [5] svUnit_1.0.6         crosstalk_1.2.0      TH.data_1.1-1        rstantools_2.2.0    
##   [9] inline_0.3.19        digest_0.6.31        htmltools_0.5.3      fansi_1.0.3         
##  [13] magrittr_2.0.3       checkmate_2.1.0      googlesheets4_1.0.1  tzdb_0.3.0          
##  [17] modelr_0.1.8         RcppParallel_5.1.5   matrixStats_0.63.0   xts_0.12.1          
##  [21] sandwich_3.0-2       prettyunits_1.1.1    colorspace_2.0-3     rvest_1.0.2         
##  [25] ggdist_3.2.1         haven_2.5.1          xfun_0.35            callr_3.7.3         
##  [29] crayon_1.5.2         jsonlite_1.8.4       lme4_1.1-31          survival_3.4-0      
##  [33] zoo_1.8-10           glue_1.6.2           gtable_0.3.1         gargle_1.2.0        
##  [37] emmeans_1.8.0        distributional_0.3.1 pkgbuild_1.3.1       shape_1.4.6         
##  [41] abind_1.4-5          scales_1.2.1         mvtnorm_1.1-3        emo_0.0.0.9000      
##  [45] DBI_1.1.3            miniUI_0.1.1.1       isoband_0.2.7        viridisLite_0.4.1   
##  [49] xtable_1.8-4         HDInterval_0.2.4     stats4_4.2.2         DT_0.24             
##  [53] htmlwidgets_1.5.4    httr_1.4.4           threejs_0.3.3        arrayhelpers_1.1-0  
##  [57] posterior_1.3.1      ellipsis_0.3.2       pkgconfig_2.0.3      loo_2.5.1           
##  [61] farver_2.1.1         sass_0.4.2           dbplyr_2.2.1         utf8_1.2.2          
##  [65] tidyselect_1.2.0     labeling_0.4.2       rlang_1.0.6          reshape2_1.4.4      
##  [69] later_1.3.0          munsell_0.5.0        cellranger_1.1.0     tools_4.2.2         
##  [73] cachem_1.0.6         cli_3.6.0            generics_0.1.3       broom_1.0.2         
##  [77] evaluate_0.18        fastmap_1.1.0        processx_3.8.0       knitr_1.40          
##  [81] fs_1.5.2             nlme_3.1-160         mime_0.12            projpred_2.2.1      
##  [85] xml2_1.3.3           compiler_4.2.2       bayesplot_1.10.0     shinythemes_1.2.0   
##  [89] rstudioapi_0.13      gamm4_0.2-6          reprex_2.0.2         bslib_0.4.0         
##  [93] stringi_1.7.8        highr_0.9            ps_1.7.2             Brobdingnag_1.2-8   
##  [97] lattice_0.20-45      Matrix_1.5-1         nloptr_2.0.3         markdown_1.1        
## [101] shinyjs_2.1.0        tensorA_0.36.2       vctrs_0.5.1          pillar_1.8.1        
## [105] lifecycle_1.0.3      jquerylib_0.1.4      bridgesampling_1.1-2 estimability_1.4.1  
## [109] httpuv_1.6.5         R6_2.5.1             bookdown_0.28        promises_1.2.0.1    
## [113] gridExtra_2.3        codetools_0.2-18     boot_1.3-28          colourpicker_1.1.1  
## [117] MASS_7.3-58.1        gtools_3.9.4         assertthat_0.2.1     withr_2.5.0         
## [121] shinystan_2.6.0      multcomp_1.4-20      mgcv_1.8-41          hms_1.1.1           
## [125] grid_4.2.2           minqa_1.2.5          coda_0.19-4          rmarkdown_2.16      
## [129] googledrive_2.0.0    shiny_1.7.2          lubridate_1.8.0      base64enc_0.1-3     
## [133] dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-aonoLongTermChange2012" class="csl-entry">
Aono, Y. (2012). Long-term change in climate and floral phenophase. <em>Chikyu Kankyo (Global Environment)</em>, <em>17</em>. <a href="http://atmenv.envi.osakafu-u.ac.jp/aono/kyophenotemp4/">http://atmenv.envi.osakafu-u.ac.jp/aono/kyophenotemp4/</a>
</div>
<div id="ref-aonoPhenologicalDataSeries2008" class="csl-entry">
Aono, Y., &amp; Kazui, K. (2008). Phenological data series of cherry tree flowering in <span>Kyoto</span>, <span>Japan</span>, and its application to reconstruction of springtime temperatures since the 9th century. <em>International Journal of Climatology</em>, <em>28</em>(7), 905–914. <a href="https://doi.org/10.1002/joc.1594">https://doi.org/10.1002/joc.1594</a>
</div>
<div id="ref-aonoClarifyingSpringtimeTemperature2010" class="csl-entry">
Aono, Y., &amp; Saito, S. (2010). Clarifying springtime temperature reconstructions of the medieval period by gap-filling the cherry blossom phenological data series at <span>Kyoto</span>, <span>Japan</span>. <em>International Journal of Biometeorology</em>, <em>54</em>(2), 211–219. <a href="https://doi.org/10.1007/s00484-009-0272-x">https://doi.org/10.1007/s00484-009-0272-x</a>
</div>
<div id="ref-Bürkner2022Non_linear" class="csl-entry">
Bürkner, P.-C. (2022e). <em>Estimating non-linear models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html</a>
</div>
<div id="ref-brms2022RM" class="csl-entry">
Bürkner, P.-C. (2022i). <em><span class="nocase">brms</span> reference manual, <span>Version</span> 2.18.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a>
</div>
<div id="ref-R-posterior" class="csl-entry">
Bürkner, P.-C., Gabry, J., Kay, M., &amp; Vehtari, A. (2022). <em><span class="nocase">posterior</span>: <span>Tools</span> for working with posterior distributions</em>. <a href="https://CRAN.R-project.org/package=posterior">https://CRAN.R-project.org/package=posterior</a>
</div>
<div id="ref-gelmanRegressionOtherStories2020" class="csl-entry">
Gelman, A., Hill, J., &amp; Vehtari, A. (2020). <em>Regression and other stories</em>. <span>Cambridge University Press</span>. <a href="https://doi.org/10.1017/9781139161879">https://doi.org/10.1017/9781139161879</a>
</div>
<div id="ref-howell2001demography" class="csl-entry">
Howell, N. (2001). <em>Demography of the dobe! <span>Kung</span></em> (2nd Edition). <span>Routledge</span>. <a href="https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490">https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490</a>
</div>
<div id="ref-howell2010life" class="csl-entry">
Howell, N. (2010). <em>Life histories of the <span>Dobe</span>! <span>Kung</span>: Food, fatness, and well-being over the life span</em> (Vol. 4). <span>Univ of California Press</span>. <a href="https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung">https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-kurzDoingBayesianDataAnalysis2023" class="csl-entry">
Kurz, A. S. (2023a). <em>Doing <span>Bayesian</span> data analysis in brms and the tidyverse</em> (Version 1.1.0). <a href="https://bookdown.org/content/3686/">https://bookdown.org/content/3686/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, R. (2020a). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-R-rethinking" class="csl-entry">
McElreath, R. (2020b). <em><span class="nocase">rethinking</span> <span>R</span> package</em>. <a href="https://xcelab.net/rm/software/">https://xcelab.net/rm/software/</a>
</div>
<div id="ref-pengProgrammingDataScience2022" class="csl-entry">
Peng, R. D. (2022). <em>R programming for data science</em>. <a href="https://bookdown.org/rdpeng/rprogdatascience/">https://bookdown.org/rdpeng/rprogdatascience/</a>
</div>
<div id="ref-PivotDataWide2020" class="csl-entry">
<em>Pivot data from wide to long pivot_longer</em>. (2020). <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">https://tidyr.tidyverse.org/reference/pivot_longer.html</a>
</div>
<div id="ref-R-MASS" class="csl-entry">
Ripley, B. (2022). <em><span>MASS</span>: <span>Support</span> functions and datasets for venables and <span>Ripley</span>’s <span>MASS</span></em>. <a href="https://CRAN.R-project.org/package=MASS">https://CRAN.R-project.org/package=MASS</a>
</div>
<div id="ref-simmonsFalsepositivePsychologyUndisclosed2011" class="csl-entry">
Simmons, J. P., Nelson, L. D., &amp; Simonsohn, U. (2011). False-positive psychology: <span>Undisclosed</span> flexibility in data collection and analysis allows presenting anything as significant. <em>Psychological Science</em>, <em>22</em>(11), 1359–1366. <a href="https://doi.org/10.1177/0956797611417632">https://doi.org/10.1177/0956797611417632</a>
</div>
<div id="ref-standevelopmentteamRStanInterfaceStan2023" class="csl-entry">
Stan Development Team. (2023). <em><span>RStan</span>: <span>The R Interface</span> to <span>Stan</span></em>. <a href="https://CRAN.R-project.org/package=rstan/vignettes/rstan.html">https://CRAN.R-project.org/package=rstan/vignettes/rstan.html</a>
</div>
<div id="ref-MASS2002" class="csl-entry">
Venables, W. N., &amp; Ripley, B. D. (2002). <em>Modern applied statistics with <span>S</span></em> (Fourth Edition). <span>Springer</span>. <a href="http://www.stats.ox.ac.uk/pub/MASS4">http://www.stats.ox.ac.uk/pub/MASS4</a>
</div>
<div id="ref-woodGeneralizedAdditiveModels2017" class="csl-entry">
Wood, S. N. (2017a). <em>Generalized additive models: <span>An</span> introduction with <span>R</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331">https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331</a>
</div>
<div id="ref-mgcv2003" class="csl-entry">
Wood, S. N. (2003). Thin-plate regression splines. <em>Journal of the Royal Statistical Society (B)</em>, <em>65</em>(1), 95–114. <a href="https://doi.org/10.1111/1467-9868.00374">https://doi.org/10.1111/1467-9868.00374</a>
</div>
<div id="ref-mgcv2004" class="csl-entry">
Wood, S. N. (2004). Stable and efficient multiple smoothing parameter estimation for generalized additive models. <em>Journal of the American Statistical Association</em>, <em>99</em>(467), 673–686. <a href="https://doi.org/10.1198/016214504000000980">https://doi.org/10.1198/016214504000000980</a>
</div>
<div id="ref-mgcv2011" class="csl-entry">
Wood, S. N. (2011). Fast stable restricted maximum likelihood and marginal likelihood estimation of semiparametric generalized linear models. <em>Journal of the Royal Statistical Society (B)</em>, <em>73</em>(1), 3–36. <a href="https://doi.org/10.1111/j.1467-9868.2010.00749.x">https://doi.org/10.1111/j.1467-9868.2010.00749.x</a>
</div>
<div id="ref-mgcv2017" class="csl-entry">
Wood, S. N. (2017b). <em>Generalized additive models: <span>An</span> introduction with <span>R</span></em> (2nd ed.). <span>Chapman and Hall/CRC</span>. <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331?utm_source=crcpress.com&amp;utm_medium=referral">https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331?utm_source=crcpress.com&amp;utm_medium=referral</a>
</div>
<div id="ref-R-mgcv" class="csl-entry">
Wood, S. N. (2022). <em><span class="nocase">mgcv</span>: <span>Mixed GAM</span> computation vehicle with automatic smoothness estimation</em>. <a href="https://CRAN.R-project.org/package=mgcv">https://CRAN.R-project.org/package=mgcv</a>
</div>
<div id="ref-mgcv2016" class="csl-entry">
Wood, S. N., Pya, N., &amp; Säfken, B. (2016). Smoothing parameter and model selection for general smooth models (with discussion). <em>Journal of the American Statistical Association</em>, <em>111</em>, 1548–1575. <a href="https://doi.org/10.1080/01621459.2016.1180986">https://doi.org/10.1080/01621459.2016.1180986</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>I know. I’m sorry our model numbering diverged from the numbering in the text. The problem popped up in <a href="geocentric-models.html#polynomial-regression.">Section 4.5.1.</a> where McElreath fit a linear model with the <code>weight_s</code> predictor, but didn’t show the code in the text and, as a consequence, didn’t assign that model a number. Since we explicitly fit that linear model, we assigned it the next number in the sequence. So it goes. But yes, I am correct in comparing our <code>b4.8</code> to McElreath’s <code>m4.7</code>.<a href="geocentric-models.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sampling-the-imaginary.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-many-variables-the-spurious-waffles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
