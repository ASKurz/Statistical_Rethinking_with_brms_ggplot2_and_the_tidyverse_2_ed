<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Geocentric Models | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-06-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sampling-the-imaginary.html"/>
<link rel="next" href="the-many-variables-the-spurious-waffles.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summarybonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del>Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.1</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>9.4.2</b> Estimation.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geocentric-models" class="section level1">
<h1><span class="header-section-number">4</span> Geocentric Models</h1>
<blockquote>
<p><strong>Linear regression</strong> is the geocentric model of applied statistics. By “linear regression,” we will mean a family of simple statistical golems that attempt to learn about the mean and variance of some measurement, using an additive combination of other measurements. Like geocentrism, linear regression can usefully describe a very large variety of natural phenomena. Like geocentrism, linear regression is a descriptive model that corresponds to many different process models. If we read its structure too literally, we’re likely to make mistakes. But used wisely, these little linear golems continue to be useful. <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020">a</a>, p. 71, <strong>emphasis</strong>, in the original)</span></p>
</blockquote>
<div id="why-normal-distributions-are-normal" class="section level2">
<h2><span class="header-section-number">4.1</span> Why normal distributions are normal</h2>
<p>After laying out his soccer field coin toss shuffle premise, McElreath wrote:</p>
<blockquote>
<p>It’s hard to say where any individual person will end up, but you can say with great confidence what the collection of positions will be. The distances will be distributed in approximately normal, or Gaussian, fashion. This is true even though the underlying distribution is binomial. It does this because there are so many more possible ways to realize a sequence of left-right steps that sums to zero. There are slightly fewer ways to realize a sequence that ends up one step left or right of zero, and so on, with the number of possible sequences declining in the characteristic bell curve of the normal distribution. (p. 72)</p>
</blockquote>
<div id="normal-by-addition." class="section level3">
<h3><span class="header-section-number">4.1.1</span> Normal by addition.</h3>
<p>Here’s a way to do the simulation necessary for the plot in the top panel of Figure 4.2.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb210-2" data-line-number="2"></a>
<a class="sourceLine" id="cb210-3" data-line-number="3"><span class="co"># we set the seed to make the results of `runif()` reproducible.</span></a>
<a class="sourceLine" id="cb210-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb210-5" data-line-number="5"></a>
<a class="sourceLine" id="cb210-6" data-line-number="6">pos &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb210-7" data-line-number="7"><span class="st">  </span><span class="co"># make data with 100 people, 16 steps each with a starting point of `step == 0` (i.e., 17 rows per person)</span></a>
<a class="sourceLine" id="cb210-8" data-line-number="8"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">person =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb210-9" data-line-number="9">           <span class="dt">step   =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">16</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-10" data-line-number="10"><span class="st">  </span><span class="co"># for all steps above `step == 0` simulate a `deviation`</span></a>
<a class="sourceLine" id="cb210-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">deviation =</span> <span class="kw">map_dbl</span>(step, <span class="op">~</span><span class="kw">if_else</span>(. <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, <span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">1</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-12" data-line-number="12"><span class="st">  </span><span class="co"># after grouping by `person`, compute the cumulative sum of the deviations, then `ungroup()`</span></a>
<a class="sourceLine" id="cb210-13" data-line-number="13"><span class="st">  </span><span class="kw">group_by</span>(person) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">position =</span> <span class="kw">cumsum</span>(deviation)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-15" data-line-number="15"><span class="st">  </span><span class="kw">ungroup</span>() </a></code></pre></div>
<p>That <code>map_dbl()</code> code within the first <code>mutate()</code> line might look odd. Go <a href="https://purrr.tidyverse.org/reference/map.html">here</a> to learn more about iterating with <code>purrr::map_dbl()</code>.</p>
<p>We might <code>glimpse()</code> at the data.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1"><span class="kw">glimpse</span>(pos)</a></code></pre></div>
<pre><code>## Rows: 1,700
## Columns: 4
## $ person    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ step      &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 0, 1, 2, 3, 4, 5, 6, …
## $ deviation &lt;dbl&gt; 0.00000000, -0.98210841, -0.41252078, -0.44525008, 0.62714843, -0.47914446, 0.4…
## $ position  &lt;dbl&gt; 0.0000000, -0.9821084, -1.3946292, -1.8398793, -1.2127308, -1.6918753, -1.24306…</code></pre>
<p>Here’s the code to make the top panel of Figure 4.2.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> pos, </a>
<a class="sourceLine" id="cb213-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> step, <span class="dt">y =</span> position, <span class="dt">group =</span> person)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> person <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">alpha  =</span> person <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;skyblue4&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_alpha_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;step number&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb213-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-4-1.png" width="614.4" style="display: block; margin: auto;" /></p>
<p>Here’s the code for the bottom three plots of Figure 4.2.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1"><span class="co"># Figure 4.2.a.</span></a>
<a class="sourceLine" id="cb214-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb214-3" data-line-number="3"><span class="st">  </span>pos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> position)) <span class="op">+</span></a>
<a class="sourceLine" id="cb214-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb214-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;4 steps&quot;</span>)</a>
<a class="sourceLine" id="cb214-8" data-line-number="8"></a>
<a class="sourceLine" id="cb214-9" data-line-number="9"><span class="co"># Figure 4.2.b.</span></a>
<a class="sourceLine" id="cb214-10" data-line-number="10">p2 &lt;-</a>
<a class="sourceLine" id="cb214-11" data-line-number="11"><span class="st">  </span>pos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-12" data-line-number="12"><span class="st">  </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">8</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> position)) <span class="op">+</span></a>
<a class="sourceLine" id="cb214-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="dt">outline.type =</span> <span class="st">&quot;full&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb214-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;8 steps&quot;</span>)</a>
<a class="sourceLine" id="cb214-16" data-line-number="16"></a>
<a class="sourceLine" id="cb214-17" data-line-number="17"><span class="co"># this is an intermediary step to get an SD value</span></a>
<a class="sourceLine" id="cb214-18" data-line-number="18">pos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-19" data-line-number="19"><span class="st">  </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">16</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-20" data-line-number="20"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sd =</span> <span class="kw">sd</span>(position))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##      sd
##   &lt;dbl&gt;
## 1  2.36</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1"><span class="co"># Figure 4.2.c.</span></a>
<a class="sourceLine" id="cb216-2" data-line-number="2">p3 &lt;-</a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="st">  </span>pos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">16</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> position)) <span class="op">+</span></a>
<a class="sourceLine" id="cb216-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </a>
<a class="sourceLine" id="cb216-7" data-line-number="7">                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">2.180408</span>),</a>
<a class="sourceLine" id="cb216-8" data-line-number="8">                <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st">  </span><span class="co"># 2.180408 came from the previous code block</span></a>
<a class="sourceLine" id="cb216-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;dodgerblue3&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb216-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;16 steps&quot;</span>,</a>
<a class="sourceLine" id="cb216-11" data-line-number="11">       <span class="dt">y =</span> <span class="st">&quot;density&quot;</span>)</a>
<a class="sourceLine" id="cb216-12" data-line-number="12"></a>
<a class="sourceLine" id="cb216-13" data-line-number="13"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb216-14" data-line-number="14"></a>
<a class="sourceLine" id="cb216-15" data-line-number="15"><span class="co"># combine the ggplots</span></a>
<a class="sourceLine" id="cb216-16" data-line-number="16">(p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3) <span class="op">&amp;</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">6</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>While we were at it, we explored a few ways to express densities. The main action was with the <code>geom_line()</code>, <code>geom_density()</code>, and <code>stat_function()</code> functions, respectively.</p>
</div>
<div id="normal-by-multiplication." class="section level3">
<h3><span class="header-section-number">4.1.2</span> Normal by multiplication.</h3>
<p>Here’s McElreath’s simple random growth rate.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb217-2" data-line-number="2"></a>
<a class="sourceLine" id="cb217-3" data-line-number="3"><span class="kw">prod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))</a></code></pre></div>
<pre><code>## [1] 1.774719</code></pre>
<p>In the <code>runif()</code> part of that code, we generated 12 random draws from the uniform distribution with bounds <span class="math inline">\([0, 0.1]\)</span>. Within the <code>prod()</code> function, we first added <code>1</code> to each of those values and then computed their product. Consider a more explicit variant of the code.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb219-2" data-line-number="2"></a>
<a class="sourceLine" id="cb219-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb219-4" data-line-number="4">       <span class="dt">b =</span> <span class="kw">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">c =</span> a <span class="op">+</span><span class="st"> </span>b) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb219-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">p =</span> <span class="kw">prod</span>(c))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       p
##   &lt;dbl&gt;
## 1  1.77</code></pre>
<p>Same result. Rather than using base <strong>R</strong> <code>replicate()</code> to do this many times, let’s practice with <code>purrr::map_dbl()</code> like before.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb221-2" data-line-number="2"></a>
<a class="sourceLine" id="cb221-3" data-line-number="3">growth &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb221-4" data-line-number="4"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">growth =</span> <span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>, <span class="op">~</span><span class="st"> </span><span class="kw">prod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))))</a>
<a class="sourceLine" id="cb221-5" data-line-number="5"></a>
<a class="sourceLine" id="cb221-6" data-line-number="6"><span class="kw">ggplot</span>(<span class="dt">data =</span> growth, <span class="kw">aes</span>(<span class="dt">x =</span> growth)) <span class="op">+</span></a>
<a class="sourceLine" id="cb221-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_density</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-8-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>“The smaller the effect of each locus, the better this additive approximation will be” (p. 74). Let’s compare big and small.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1"><span class="co"># simulate</span></a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb222-3" data-line-number="3"></a>
<a class="sourceLine" id="cb222-4" data-line-number="4">samples &lt;-</a>
<a class="sourceLine" id="cb222-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">big   =</span> <span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>, <span class="op">~</span><span class="st"> </span><span class="kw">prod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))),</a>
<a class="sourceLine" id="cb222-6" data-line-number="6">         <span class="dt">small =</span> <span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>, <span class="op">~</span><span class="st"> </span><span class="kw">prod</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, <span class="fl">0.01</span>))))</a>
<a class="sourceLine" id="cb222-7" data-line-number="7"></a>
<a class="sourceLine" id="cb222-8" data-line-number="8"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb222-9" data-line-number="9">samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb222-11" data-line-number="11">               <span class="dt">values_to =</span> <span class="st">&quot;samples&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb222-13" data-line-number="13"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb222-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> samples)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) </a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Yep, the <code>small</code> samples were more Gaussian.</p>
</div>
<div id="normal-by-log-multiplication." class="section level3">
<h3><span class="header-section-number">4.1.3</span> Normal by log-multiplication.</h3>
<p>Instead of saving our tibble, we’ll just feed it directly into our plot.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_big =</span> <span class="kw">log</span>(big)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb223-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_big)) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;gray33&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-6" data-line-number="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;the log of the big&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-10-1.png" width="312" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Yet another Gaussian distribution. We get the Gaussian distribution back, because adding logs is equivalent to multiplying the original numbers. So even multiplicative interactions of large deviations can produce Gaussian distributions, once we measure the outcomes on the log scale. (p. 75)</p>
</blockquote>
</div>
<div id="using-gaussian-distributions." class="section level3">
<h3><span class="header-section-number">4.1.4</span> Using Gaussian distributions.</h3>
<p>“The justifications for using the Gaussian distribution fall into two broad categories: (1) ontological and (2) epistemological” (p. 75). I’m a fan of the justifications to follow.</p>
<div id="ontological-justification." class="section level4">
<h4><span class="header-section-number">4.1.4.1</span> Ontological justification.</h4>
<p>The Gaussian is</p>
<blockquote>
<p>a widespread pattern, appearing again and again at different scales and in different domains. Measurement errors, variations in growth, and the velocities of molecules all tend towards Gaussian distributions. These processes do this because at their heart, these processes add together fluctuations. And repeatedly adding finite fluctuations results in a distribution of sums that have shed all information about the underlying process, aside from mean and spread.</p>
<p>[However,] one consequence of this is that statistical models based on Gaussian distributions cannot reliably identify micro-process. (p. 75)</p>
</blockquote>
<p>But like Ptolemy’s circles within circles, the Gaussian can still be useful even if it sheds information.</p>
</div>
<div id="epistemological-justification." class="section level4">
<h4><span class="header-section-number">4.1.4.2</span> Epistemological justification.</h4>
<blockquote>
<p>By the epistemological justification, the Gaussian represents a particular state of ignorance. When all we know or are willing to say about a distribution of measures (measures are continuous values on the real number line) is their mean and variance, then the Gaussian distribution arises as the most consistent with our assumptions.</p>
<p>That is to say that the Gaussian distribution is the most natural expression of our state of ignorance, because if all we are willing to assume is that a measure has finite variance, the Gaussian distribution is the shape that can be realized in the largest number of ways and does not introduce any new assumptions. It is the least surprising and least informative assumption to make. In this way, the Gaussian is the distribution most consistent with our assumptions. Or rather, it is the most consistent with our golem’s assumptions. If you don’t think the distribution should be Gaussian, then that implies that you know something else that you should tell your golem about, something that would improve inference. (p. 75)</p>
</blockquote>
<p>We’ll dive deeper into why the Gaussian is such a natural expression of ignorance in these contexts when we cover maximum entropy in Chapter 7.</p>
</div>
<div id="rethinking-heavy-tails." class="section level4">
<h4><span class="header-section-number">4.1.4.3</span> Rethinking: Heavy tails.</h4>
<blockquote>
<p>The Gaussian distribution is common in nature and has some nice properties. But there are some risks in using it as a default data model. The extreme ends of a distribution are known as its tails. And the Gaussian distribution has some very thin tails–there is very little probability in them. Instead most of the mass in the Gaussian lies within one standard deviation of the mean. Many natural (and unnatural) processes have much heavier tails. (p. 76)</p>
</blockquote>
<p>You have no idea how excited I am that we’ll be covering some of these heavy-tailed alternatives!</p>
</div>
<div id="overthinking-gaussian-distribution." class="section level4">
<h4><span class="header-section-number">4.1.4.4</span> Overthinking: Gaussian distribution.</h4>
<p>In this section McElreath gave the formula for the Gaussian probability density function. Let <span class="math inline">\(y\)</span> be the criterion, <span class="math inline">\(\mu\)</span> be the mean, and <span class="math inline">\(\sigma\)</span> be the standard deviation. Then the probability density of some Gaussian value <span class="math inline">\(y\)</span> is</p>
<p><span class="math display">\[p(y|\mu, \sigma) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left (- \frac{(y - \mu)^2}{2 \sigma^2} \right)\]</span></p>
<p>McElreath’s right. “This looks monstrous” (p. 76). Why not demystify that monster with a little <strong>R</strong> code? For simplicity, we’ll compute <span class="math inline">\(p(y|\mu, \sigma)\)</span> for a series of <span class="math inline">\(y\)</span>-values ranging from -1 to 1, holding <span class="math inline">\(\mu = 0\)</span> and <span class="math inline">\(\sigma = 0.1\)</span>. Then we’ll plot.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">y     =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-1</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>),</a>
<a class="sourceLine" id="cb224-2" data-line-number="2">       <span class="dt">mu    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb224-3" data-line-number="3">       <span class="dt">sigma =</span> <span class="fl">0.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-4" data-line-number="4"><span class="st">  </span><span class="co"># compute p(y) with a hand-made Gaussian probability density function</span></a>
<a class="sourceLine" id="cb224-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> (<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>((y <span class="op">-</span><span class="st"> </span>mu)<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb224-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> y, <span class="dt">y =</span> p)) <span class="op">+</span></a>
<a class="sourceLine" id="cb224-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-9" data-line-number="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">italic</span>(p)(<span class="kw">italic</span>(<span class="st">&quot;y|&quot;</span>)<span class="op">*</span>mu<span class="op">==</span><span class="dv">0</span><span class="op">*</span><span class="st">&quot;,&quot;</span><span class="op">~</span>sigma<span class="op">==</span><span class="fl">0.1</span>)))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-11-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Notice how <span class="math inline">\(p(y|\mu, \sigma)\)</span> peaks around 4 when <span class="math inline">\(y = 0\)</span>. We can also get that value with the <code>dnorm()</code> function, which will return the <span class="math inline">\(p(y)\)</span> value for a given combination of <span class="math inline">\(y\)</span>, <span class="math inline">\(\mu\)</span>, and <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1"><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>## [1] 3.989423</code></pre>
<blockquote>
<p>The answer, about 4, is no mistake. Probability <em>density</em> is the rate of change in cumulative probability. So where cumulative probability is increasing rapidly, density can easily exceed 1. But if we calculate the area under the density function, it will never exceed 1. Such areas are also called <em>probability mass</em>. You can usually ignore these density/mass details while doing computational work. But it’s good to be aware of the distinction. (p. 76, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
</div>
<div id="a-language-for-describing-models" class="section level2">
<h2><span class="header-section-number">4.2</span> A language for describing models</h2>
<p>Our mathy ways of summarizing models will be something like</p>
<p><span class="math display">\[\begin{align*}
\text{criterion}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i  &amp; = \beta \times \text{predictor}_i \\
\beta  &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma &amp; \sim \operatorname{Exponential}(0, 1) \\
x_i    &amp; \sim \operatorname{Normal}(0, 1).
\end{align*}\]</span></p>
<p>“If that doesn’t make much sense, good. That indicates that you are holding the right textbook” (p. 77). Welcome applied statistics!</p>
<div id="re-describing-the-globe-tossing-model." class="section level3">
<h3><span class="header-section-number">4.2.1</span> Re-describing the globe tossing model.</h3>
<p>For the globe tossing model, the probability <span class="math inline">\(p\)</span> of a count of water <span class="math inline">\(w\)</span> based on <span class="math inline">\(n\)</span> trials was</p>
<p><span class="math display">\[\begin{align*}
w &amp; \sim \operatorname{Binomial}(n, p) \\
p &amp; \sim \operatorname{Uniform}(0, 1),
\end{align*}\]</span></p>
<p>where the top line indicates we’re using the Binomial likelihood function to model <span class="math inline">\(w\)</span> given unique combinations of <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span>. In our example, <span class="math inline">\(w\)</span> and <span class="math inline">\(n\)</span> were already defined in the data, so all we need to do is compute <span class="math inline">\(p\)</span>. Since <span class="math inline">\(p\)</span> is the only parameter, it’s the only element that gets a prior, which is what that second line was.</p>
<div id="overthinking-from-model-definition-to-bayes-theorem." class="section level4">
<h4><span class="header-section-number">4.2.1.1</span> Overthinking: From model definition to Bayes’ theorem.</h4>
<p>We can use grid aproximation to work through our globe tossing model.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1"><span class="co"># how many `p_grid` points would you like?</span></a>
<a class="sourceLine" id="cb227-2" data-line-number="2">n_points &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb227-3" data-line-number="3"></a>
<a class="sourceLine" id="cb227-4" data-line-number="4">d &lt;-</a>
<a class="sourceLine" id="cb227-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">p_grid =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> n_points),</a>
<a class="sourceLine" id="cb227-6" data-line-number="6">         <span class="dt">w      =</span> <span class="dv">6</span>, </a>
<a class="sourceLine" id="cb227-7" data-line-number="7">         <span class="dt">n      =</span> <span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb227-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior      =</span> <span class="kw">dunif</span>(p_grid, <span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb227-9" data-line-number="9">         <span class="dt">likelihood =</span> <span class="kw">dbinom</span>(w, n, p_grid)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb227-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> likelihood <span class="op">*</span><span class="st"> </span>prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(likelihood <span class="op">*</span><span class="st"> </span>prior))</a>
<a class="sourceLine" id="cb227-11" data-line-number="11"></a>
<a class="sourceLine" id="cb227-12" data-line-number="12"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   p_grid     w     n prior likelihood posterior
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 0          6     9     1   0.        0.      
## 2 0.0101     6     9     1   8.65e-11  8.74e-12
## 3 0.0202     6     9     1   5.37e- 9  5.43e-10
## 4 0.0303     6     9     1   5.93e- 8  5.99e- 9
## 5 0.0404     6     9     1   3.23e- 7  3.26e- 8
## 6 0.0505     6     9     1   1.19e- 6  1.21e- 7</code></pre>
<p>In case you were curious, here’s what they look like:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(prior<span class="op">:</span>posterior) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb229-3" data-line-number="3"><span class="st">  </span><span class="co"># this line allows us to dictate the order in which the panels will appear</span></a>
<a class="sourceLine" id="cb229-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;prior&quot;</span>, <span class="st">&quot;likelihood&quot;</span>, <span class="st">&quot;posterior&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb229-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb229-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p_grid, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> value, <span class="dt">fill =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_ribbon</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb229-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;purple&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The posterior is a combination of the prior and the likelihood. When the prior is flat across the parameter space, the posterior is just the likelihood re-expressed as a probability. As we go along, you’ll see we almost never use flat priors in practice.</p>
</div>
</div>
</div>
<div id="a-gaussian-model-of-height" class="section level2">
<h2><span class="header-section-number">4.3</span> A Gaussian model of height</h2>
<blockquote>
<p>There are an infinite number of possible Gaussian distributions. Some have small means. Others have large means. Some are wide, with a large <span class="math inline">\(\sigma\)</span>. Others are narrow. We want our Bayesian machine to consider every possible distribution, each defined by a combination of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, and rank them by posterior plausibility. Posterior plausibility provides a measure of the logical compatibility of each possible distribution with the data and model. (p. 79)</p>
</blockquote>
<div id="the-data." class="section level3">
<h3><span class="header-section-number">4.3.1</span> The data.</h3>
<p>Let’s load the Howell <span class="citation">(<a href="#ref-howell2001demography">2001</a>, <a href="#ref-howell2010life">2010</a>)</span> data from McElreath’s <span class="citation">(<a href="#ref-R-rethinking">2020</a><a href="#ref-R-rethinking">b</a>)</span> <a href="https://xcelab.net/rm/software/"><strong>rethinking</strong> package</a>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb230-2" data-line-number="2"><span class="kw">data</span>(Howell1)</a>
<a class="sourceLine" id="cb230-3" data-line-number="3">d &lt;-<span class="st"> </span>Howell1</a></code></pre></div>
<p>Here we open our focal statistical package, Bürkner’s <a href="https://github.com/paul-buerkner/brms"><strong>brms</strong></a>. But before we do, we’ll need to detach the <strong>rethinking</strong> package. <strong>R</strong> will not allow us to use a function from one package that shares the same name as a different function from another package if both packages are open at the same time. The <strong>rethinking</strong> and <strong>brms</strong> packages are designed for similar purposes and, unsurprisingly, overlap in some of their function names. To prevent problems, we will always make sure <strong>rethinking</strong> is detached before using <strong>brms</strong>. To learn more on the topic, see <a href="https://www.r-bloggers.com/r-and-package-masking-a-real-life-example/">this R-bloggers post</a>.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1"><span class="kw">rm</span>(Howell1)</a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Go ahead and investigate the data with <code>str()</code>, the <strong>tidyverse</strong> analogue for which is <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-2" data-line-number="2"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  4 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<p>The <strong>brms</strong> package does not have a function that works like <code>rethinking::precis()</code> for providing numeric and graphical summaries of variables, as see in McElreath’s <strong>R</strong> code 4.9. We can get some of that information with <code>summary()</code>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="st">  </span><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##      height           weight            age             male       
##  Min.   : 53.98   Min.   : 4.252   Min.   : 0.00   Min.   :0.0000  
##  1st Qu.:125.09   1st Qu.:22.008   1st Qu.:12.00   1st Qu.:0.0000  
##  Median :148.59   Median :40.058   Median :27.00   Median :0.0000  
##  Mean   :138.26   Mean   :35.611   Mean   :29.34   Mean   :0.4724  
##  3rd Qu.:157.48   3rd Qu.:47.209   3rd Qu.:43.00   3rd Qu.:1.0000  
##  Max.   :179.07   Max.   :62.993   Max.   :88.00   Max.   :1.0000</code></pre>
<p>We might make the histograms like this.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">factor</span>(name, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;male&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb236-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb236-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb236-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-19-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>If you’re curious, McElreath made those tiny histograms with help from Wickham’s <a href="https://github.com/hadley/precis/blob/master/R/histospark.R"><code>histospark()</code> function</a>. Here’s the code.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">sparks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;\u2581&quot;</span>, <span class="st">&quot;\u2582&quot;</span>, <span class="st">&quot;\u2583&quot;</span>, <span class="st">&quot;\u2585&quot;</span>, <span class="st">&quot;\u2587&quot;</span>)</a>
<a class="sourceLine" id="cb237-2" data-line-number="2"></a>
<a class="sourceLine" id="cb237-3" data-line-number="3">histospark &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">width =</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb237-4" data-line-number="4">  bins &lt;-<span class="st"> </span>graphics<span class="op">::</span><span class="kw">hist</span>(x, <span class="dt">breaks =</span> width, <span class="dt">plot =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb237-5" data-line-number="5"></a>
<a class="sourceLine" id="cb237-6" data-line-number="6">  factor &lt;-<span class="st"> </span><span class="kw">cut</span>(</a>
<a class="sourceLine" id="cb237-7" data-line-number="7">    bins<span class="op">$</span>counts <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(bins<span class="op">$</span>counts),</a>
<a class="sourceLine" id="cb237-8" data-line-number="8">    <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="kw">length</span>(sparks) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb237-9" data-line-number="9">    <span class="dt">labels =</span> sparks,</a>
<a class="sourceLine" id="cb237-10" data-line-number="10">    <span class="dt">include.lowest =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb237-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb237-12" data-line-number="12"></a>
<a class="sourceLine" id="cb237-13" data-line-number="13">  <span class="kw">paste0</span>(factor, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb237-14" data-line-number="14">}</a></code></pre></div>
<p>Here’s how it works.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1"><span class="kw">histospark</span>(d<span class="op">$</span>weight)</a></code></pre></div>
<pre><code>## [1] &quot;▁▂▃▂▂▂▂▅▇▇▃▂▁&quot;</code></pre>
<p>One of the neat things about the <code>histospark()</code> function is you can insert the output right in your R Markdown prose. For example, we can use is to casually show how left skewed the our <code>height</code> variable is: ▁▁▁▁▁▁▁▂▁▇▇▅▁. But it’s time to get back on track. You can isolate <code>height</code> values with the <code>dplyr::select()</code> function.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb240-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(height) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb240-3" data-line-number="3"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 544
## Columns: 1
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.8300, 149.2250, 168.9100, 14…</code></pre>
<p>If you want the values in a numeric vector rather than in a data fame, try <code>pull(d, height)</code>.</p>
<p>We can use the <code>dplyr::filter()</code> function to make an adults-only data frame.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">d2 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb242-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">18</span>)</a></code></pre></div>
<div id="overthinking-data-frames-and-indexes." class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> Overthinking: Data frames and indexes.</h4>
<p>For more on indexing, check out <a href="https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html">Chapter 9</a> of Peng’s <span class="citation">(<a href="#ref-pengProgrammingDataScience2019">2019</a>)</span> <em>R programming for data science</em> or even the <a href="http://r4ds.had.co.nz/vectors.html#subsetting-1">Subsetting</a> subsection from <em>R4DS</em>.</p>
<p>This probably reflects my training history, but the structure of a data frame seems natural and inherently appealing, to me. If you’re in the other camp, do check out either of these two data wrangling talks (<a href="https://www.youtube.com/watch?v=4MfUCX_KpdE&amp;t=23s&amp;frags=pl%2Cwn">here</a> and <a href="https://www.youtube.com/watch?v=GapSskrtUzU&amp;t=1249s&amp;frags=pl%2Cwn">here</a>) by the ineffable <a href="https://twitter.com/JennyBryan?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">Jenny Bryan</a>.</p>
</div>
</div>
<div id="the-model." class="section level3">
<h3><span class="header-section-number">4.3.2</span> The model.</h3>
<p>Please head McElreath’s warnings:</p>
<blockquote>
<p>be careful about choosing the Gaussian distribution only when the plotted outcome variable looks Gaussian to you. Gawking at the raw data, to try to decide how to model them, is usually not a good idea. The data could be a mixture of different Gaussian distributions, for example, and in that case you won’t be able to detect the underlying normality just by eyeballing the outcome distribution. Furthermore, as mentioned earlier in this chapter, the empirical distribution needn’t be actually Gaussian in order to justify using a Gaussian probability distribution. (p. 81)</p>
</blockquote>
<p>Anyway, the likelihood for our model is</p>
<p><span class="math display">\[\text{heights}_i \sim \operatorname{Normal}(\mu, \sigma),\]</span></p>
<p>where the <span class="math inline">\(i\)</span> subscript indexes the individual cases in the data. Our two parameters are <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, which we will estimate using Bayes’ formula. Our prior for <span class="math inline">\(\mu\)</span> will be</p>
<p><span class="math display">\[\mu \sim \operatorname{Normal}(178, 20)\]</span></p>
<p>and our prior for <span class="math inline">\(\sigma\)</span> will be</p>
<p><span class="math display">\[\sigma \sim \operatorname{Uniform}(0, 50).\]</span></p>
<p>Here’s the shape of the prior for <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\operatorname N(178, 20)\)</span>.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb243-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">100</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="fl">.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb243-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> <span class="kw">dnorm</span>(x, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd =</span> <span class="dv">20</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb243-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb243-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">100</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="dv">75</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb243-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;mu ~ dnorm(178, 20)&quot;</span>,</a>
<a class="sourceLine" id="cb243-8" data-line-number="8">       <span class="dt">y =</span> <span class="st">&quot;density&quot;</span>)</a>
<a class="sourceLine" id="cb243-9" data-line-number="9"></a>
<a class="sourceLine" id="cb243-10" data-line-number="10">p1</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-24-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>And here’s the <strong>ggplot2</strong> code for our prior for <span class="math inline">\(\sigma\)</span>, a uniform distribution with a minimum value of 0 and a maximum value of 50. We don’t really need the <span class="math inline">\(y\)</span>-axis when looking at the shapes of a density, so we’ll just remove it with <code>scale_y_continuous()</code>.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb244-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-10</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="fl">.1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> <span class="kw">dunif</span>(x, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">50</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb244-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb244-8" data-line-number="8"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;sigma ~ dunif(0, 50)&quot;</span>)</a>
<a class="sourceLine" id="cb244-9" data-line-number="9"></a>
<a class="sourceLine" id="cb244-10" data-line-number="10">p2</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-25-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We can simulate from both priors at once to get a prior probability distribution of <code>heights</code>.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="fl">1e4</span></a>
<a class="sourceLine" id="cb245-2" data-line-number="2"></a>
<a class="sourceLine" id="cb245-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb245-4" data-line-number="4"></a>
<a class="sourceLine" id="cb245-5" data-line-number="5">sim &lt;-</a>
<a class="sourceLine" id="cb245-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">sample_mu    =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd  =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb245-7" data-line-number="7">         <span class="dt">sample_sigma =</span> <span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> sample_mu, <span class="dt">sd =</span> sample_sigma))</a>
<a class="sourceLine" id="cb245-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb245-10" data-line-number="10">p3 &lt;-<span class="st"> </span>sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb245-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey33&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">73</span>, <span class="dv">178</span>, <span class="dv">283</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-15" data-line-number="15"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb245-17" data-line-number="17"></a>
<a class="sourceLine" id="cb245-18" data-line-number="18">p3</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-26-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you look at the <span class="math inline">\(x\)</span>-axis breaks on the plot in McElreath’s lower left panel in Figure 4.3, you’ll notice they’re intentional. To compute the mean and 3 standard deviations above and below, you might do this.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ll   =</span> <span class="kw">mean</span>(height) <span class="op">-</span><span class="st"> </span><span class="kw">sd</span>(height) <span class="op">*</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb246-3" data-line-number="3">            <span class="dt">mean =</span> <span class="kw">mean</span>(height),</a>
<a class="sourceLine" id="cb246-4" data-line-number="4">            <span class="dt">ul   =</span> <span class="kw">mean</span>(height) <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(height) <span class="op">*</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb246-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_all</span>(round, <span class="dt">digits =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##      ll  mean    ul
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  73.9  177.  281.</code></pre>
<p>Our values are very close to his, but are off by just a bit due to simulation variation.</p>
<p>Here’s the work to make the lower right panel of Figure 4.3. Watch out; we’re starting to get fancy.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1"><span class="co"># simulate</span></a>
<a class="sourceLine" id="cb248-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb248-3" data-line-number="3"></a>
<a class="sourceLine" id="cb248-4" data-line-number="4">sim &lt;-</a>
<a class="sourceLine" id="cb248-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">sample_mu    =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb248-6" data-line-number="6">         <span class="dt">sample_sigma =</span> <span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb248-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> sample_mu, <span class="dt">sd =</span> sample_sigma))</a>
<a class="sourceLine" id="cb248-8" data-line-number="8"></a>
<a class="sourceLine" id="cb248-9" data-line-number="9"><span class="co"># compute the values we&#39;ll use to break on our x axis</span></a>
<a class="sourceLine" id="cb248-10" data-line-number="10">breaks &lt;-</a>
<a class="sourceLine" id="cb248-11" data-line-number="11"><span class="st">  </span><span class="kw">c</span>(<span class="kw">mean</span>(sim<span class="op">$</span>height) <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(sim<span class="op">$</span>height), <span class="dv">0</span>, <span class="kw">mean</span>(sim<span class="op">$</span>height), <span class="kw">mean</span>(sim<span class="op">$</span>height) <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(sim<span class="op">$</span>height)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb248-12" data-line-number="12"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb248-13" data-line-number="13"></a>
<a class="sourceLine" id="cb248-14" data-line-number="14"><span class="co"># this is just for aesthetics</span></a>
<a class="sourceLine" id="cb248-15" data-line-number="15">text &lt;-</a>
<a class="sourceLine" id="cb248-16" data-line-number="16"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">height =</span> <span class="dv">272</span> <span class="op">-</span><span class="st"> </span><span class="dv">25</span>,</a>
<a class="sourceLine" id="cb248-17" data-line-number="17">         <span class="dt">y      =</span> <span class="fl">.0013</span>,</a>
<a class="sourceLine" id="cb248-18" data-line-number="18">         <span class="dt">label  =</span> <span class="st">&quot;tallest man&quot;</span>,</a>
<a class="sourceLine" id="cb248-19" data-line-number="19">         <span class="dt">angle  =</span> <span class="dv">90</span>)</a>
<a class="sourceLine" id="cb248-20" data-line-number="20"></a>
<a class="sourceLine" id="cb248-21" data-line-number="21"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb248-22" data-line-number="22">p4 &lt;-</a>
<a class="sourceLine" id="cb248-23" data-line-number="23"><span class="st">  </span>sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb248-24" data-line-number="24"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">272</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-28" data-line-number="28"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</a>
<a class="sourceLine" id="cb248-29" data-line-number="29">            <span class="kw">aes</span>(<span class="dt">y =</span> y, <span class="dt">label =</span> label, <span class="dt">angle =</span> angle),</a>
<a class="sourceLine" id="cb248-30" data-line-number="30">            <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-31" data-line-number="31"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-32" data-line-number="32"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-33" data-line-number="33"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;height ~ dnorm(mu, sigma)</span><span class="ch">\n</span><span class="st">mu ~ dnorm(178, 100)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-34" data-line-number="34"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb248-35" data-line-number="35"></a>
<a class="sourceLine" id="cb248-36" data-line-number="36">p4</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-28-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>You may have noticed how we were saving each of the four last plots as <code>p1</code> through <code>p4</code>. Let’s combine the four to make our version of McElreath’s Figure 4.3.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">(p1 <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;mu&quot;</span>) <span class="op">|</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;sigma&quot;</span>)) <span class="op">/</span><span class="st"> </span>(p3 <span class="op">|</span><span class="st"> </span>p4)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-29-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>On page 84, McElreath said his prior simulation indicated 4% of the heights would be below zero. Here’s how we might determe that percentage for our simulation.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(height <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb250-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   `height &lt; 0`     n percent
##   &lt;lgl&gt;        &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE         9571   95.7 
## 2 TRUE           429    4.29</code></pre>
<p>Here’s the break down compared to the tallest man on record, <a href="https://en.wikipedia.org/wiki/Robert_Wadlow">Robert Pershing Wadlow</a> (1918–1940).</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb252-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(height <span class="op">&lt;</span><span class="st"> </span><span class="dv">272</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb252-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   `height &lt; 272`     n percent
##   &lt;lgl&gt;          &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE           1761    17.6
## 2 TRUE            8239    82.4</code></pre>
<div id="rethinking-a-farewell-to-epsilon." class="section level4">
<h4><span class="header-section-number">4.3.2.1</span> Rethinking: A farewell to epsilon.</h4>
<blockquote>
<p>Some readers will have already met an alternative notation for a Gaussian linear model:</p>
<p><span class="math display">\[\begin{align*}
h_i &amp; = \mu + \epsilon_i \\
\epsilon_i &amp; \sim \operatorname{Normal}(0, \sigma)
\end{align*}\]</span></p>
<p>This is equivalent to the <span class="math inline">\(h_i \sim \operatorname{Normal}(\mu, \sigma)\)</span> form, with the <span class="math inline">\(\epsilon\)</span> standing in for the Gaussian density. But this <span class="math inline">\(\epsilon\)</span> form is poor form. The reason is that it does not usually generalize to other types of models. This means it won’t be possible to express non-Gaussian models using tricks like <span class="math inline">\(\epsilon\)</span>. Better to learn one system that does generalize. (p. 84)</p>
</blockquote>
</div>
</div>
<div id="grid-approximation-of-the-posterior-distribution." class="section level3">
<h3><span class="header-section-number">4.3.3</span> Grid approximation of the posterior distribution.</h3>
<p>As McElreath explained, you’ll never use this for practical data analysis. But I found this helped me better understanding what exactly we’re doing with Bayesian estimation. So let’s play along.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb254-2" data-line-number="2"></a>
<a class="sourceLine" id="cb254-3" data-line-number="3">d_grid &lt;-</a>
<a class="sourceLine" id="cb254-4" data-line-number="4"><span class="st">  </span><span class="co"># we&#39;ll accomplish with `tidyr::crossing()` what McElreath did with base R `expand.grid()`</span></a>
<a class="sourceLine" id="cb254-5" data-line-number="5"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">mu    =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">140</span>, <span class="dt">to =</span> <span class="dv">160</span>, <span class="dt">length.out =</span> n),</a>
<a class="sourceLine" id="cb254-6" data-line-number="6">           <span class="dt">sigma =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">4</span>, <span class="dt">to =</span> <span class="dv">9</span>, <span class="dt">length.out =</span> n))</a>
<a class="sourceLine" id="cb254-7" data-line-number="7"></a>
<a class="sourceLine" id="cb254-8" data-line-number="8"><span class="kw">glimpse</span>(d_grid)</a></code></pre></div>
<pre><code>## Rows: 40,000
## Columns: 2
## $ mu    &lt;dbl&gt; 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140, 140…
## $ sigma &lt;dbl&gt; 4.000000, 4.025126, 4.050251, 4.075377, 4.100503, 4.125628, 4.150754, 4.175879, 4.2…</code></pre>
<p><code>d_grid</code> contains every combination of <code>mu</code> and <code>sigma</code> across their specified values. Instead of base <strong>R</strong> <code>sapply()</code>, we’ll do the computations by making a custom function which we’ll then plug into <code>purrr::map2()</code>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">grid_function &lt;-<span class="st"> </span><span class="cf">function</span>(mu, sigma) {</a>
<a class="sourceLine" id="cb256-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb256-3" data-line-number="3">  <span class="kw">dnorm</span>(d2<span class="op">$</span>height, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma, <span class="dt">log =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb256-4" data-line-number="4"><span class="st">    </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb256-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb256-6" data-line-number="6">}</a></code></pre></div>
<p>Now we’re ready to complete the tibble.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">d_grid &lt;-</a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="st">  </span>d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_likelihood =</span> <span class="kw">map2</span>(mu, sigma, grid_function)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(log_likelihood) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior_mu    =</span> <span class="kw">dnorm</span>(mu,    <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd  =</span> <span class="dv">20</span>, <span class="dt">log =</span> T),</a>
<a class="sourceLine" id="cb257-6" data-line-number="6">         <span class="dt">prior_sigma =</span> <span class="kw">dunif</span>(sigma, <span class="dt">min  =</span> <span class="dv">0</span>,   <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">log =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">product =</span> log_likelihood <span class="op">+</span><span class="st"> </span>prior_mu <span class="op">+</span><span class="st"> </span>prior_sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb257-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">exp</span>(product <span class="op">-</span><span class="st"> </span><span class="kw">max</span>(product)))</a>
<a class="sourceLine" id="cb257-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb257-10" data-line-number="10"><span class="kw">head</span>(d_grid)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##      mu sigma log_likelihood prior_mu prior_sigma product probability
##   &lt;dbl&gt; &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
## 1   140  4            -3813.    -5.72       -3.91  -3822.           0
## 2   140  4.03         -3778.    -5.72       -3.91  -3787.           0
## 3   140  4.05         -3743.    -5.72       -3.91  -3753.           0
## 4   140  4.08         -3709.    -5.72       -3.91  -3719.           0
## 5   140  4.10         -3676.    -5.72       -3.91  -3686.           0
## 6   140  4.13         -3644.    -5.72       -3.91  -3653.           0</code></pre>
<p>In the final <code>d_grid</code>, the <code>probability</code> vector contains the posterior probabilities across values of <code>mu</code> and <code>sigma</code>. We can make a contour plot with <code>geom_contour()</code>.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu, <span class="dt">y =</span> sigma, <span class="dt">z =</span> probability)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_contour</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb259-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(mu),</a>
<a class="sourceLine" id="cb259-5" data-line-number="5">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma)) <span class="op">+</span></a>
<a class="sourceLine" id="cb259-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d_grid<span class="op">$</span>mu),</a>
<a class="sourceLine" id="cb259-7" data-line-number="7">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d_grid<span class="op">$</span>sigma)) <span class="op">+</span></a>
<a class="sourceLine" id="cb259-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-35-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We’ll make our heat map with <code>geom_raster()</code>.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu, <span class="dt">y =</span> sigma, <span class="dt">fill =</span> probability)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;B&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(mu),</a>
<a class="sourceLine" id="cb260-6" data-line-number="6">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma)) <span class="op">+</span></a>
<a class="sourceLine" id="cb260-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-36-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="sampling-from-the-posterior." class="section level3">
<h3><span class="header-section-number">4.3.4</span> Sampling from the posterior.</h3>
<p>We can use <code>dplyr::sample_n()</code> to sample rows, with replacement, from <code>d_grid</code>.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb261-2" data-line-number="2"></a>
<a class="sourceLine" id="cb261-3" data-line-number="3">d_grid_samples &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb261-4" data-line-number="4"><span class="st">  </span>d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-5" data-line-number="5"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="fl">1e4</span>, <span class="dt">replace =</span> T, <span class="dt">weight =</span> probability)</a>
<a class="sourceLine" id="cb261-6" data-line-number="6"></a>
<a class="sourceLine" id="cb261-7" data-line-number="7">d_grid_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu, <span class="dt">y =</span> sigma)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">.9</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">15</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb261-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb261-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(mu[samples]),</a>
<a class="sourceLine" id="cb261-12" data-line-number="12">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma[samples])) <span class="op">+</span></a>
<a class="sourceLine" id="cb261-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-37-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We can use <code>pivot_longer()</code> and then <code>facet_warp()</code> to plot the densities for both <code>mu</code> and <code>sigma</code> at once.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1">d_grid_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb262-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(mu<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb262-3" data-line-number="3"></a>
<a class="sourceLine" id="cb262-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb262-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey33&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb262-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb262-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb262-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb262-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>,</a>
<a class="sourceLine" id="cb262-10" data-line-number="10">             <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-38-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We’ll use the <strong>tidybayes</strong> package to compute their posterior modes and 95% HDIs.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb263-2" data-line-number="2"></a>
<a class="sourceLine" id="cb263-3" data-line-number="3">d_grid_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(mu<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-6" data-line-number="6"><span class="st">  </span><span class="kw">mode_hdi</span>(value)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name   value .lower .upper .width .point .interval
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 mu    155.   154.   155.     0.95 mode   hdi      
## 2 sigma   7.82   7.14   8.30   0.95 mode   hdi</code></pre>
<p>Let’s say you wanted their posterior medians and 50% quantile-based intervals, instead. Just switch out the last line for <code>median_qi(value, .width = .5)</code>.</p>
<div id="overthinking-sample-size-and-the-normality-of-sigmas-posterior." class="section level4">
<h4><span class="header-section-number">4.3.4.1</span> Overthinking: Sample size and the normality of <span class="math inline">\(\sigma\)</span>’s posterior.</h4>
<p>Since we’ll be fitting models with <strong>brms</strong> almost exclusively from here on out, this section is largely mute. But we’ll do it anyway for the sake of practice. I’m going to break the steps up like before rather than compress the code together. Here’s <code>d3</code>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb265-2" data-line-number="2">(d3 &lt;-<span class="st"> </span><span class="kw">sample</span>(d2<span class="op">$</span>height, <span class="dt">size =</span> <span class="dv">20</span>))</a></code></pre></div>
<pre><code>##  [1] 147.3200 154.9400 168.9100 156.8450 165.7350 151.7650 165.7350 156.2100 144.7800 154.9400
## [11] 151.1300 147.9550 149.8600 162.5600 161.9250 164.4650 160.9852 151.7650 163.8300 149.8600</code></pre>
<p>For our first step using <code>d3</code>, we’ll redefine <code>d_grid</code>.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2"></a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="co"># note we&#39;ve redefined the ranges of `mu` and `sigma`</span></a>
<a class="sourceLine" id="cb267-4" data-line-number="4">d_grid &lt;-</a>
<a class="sourceLine" id="cb267-5" data-line-number="5"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">mu    =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">150</span>, <span class="dt">to =</span> <span class="dv">170</span>, <span class="dt">length.out =</span> n),</a>
<a class="sourceLine" id="cb267-6" data-line-number="6">           <span class="dt">sigma =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">4</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">length.out =</span> n))</a></code></pre></div>
<p>Second, we’ll redefine our custom <code>grid_function()</code> function to operate over the <code>height</code> values of <code>d3</code>.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">grid_function &lt;-<span class="st"> </span><span class="cf">function</span>(mu, sigma) {</a>
<a class="sourceLine" id="cb268-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb268-3" data-line-number="3">  <span class="kw">dnorm</span>(d3, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma, <span class="dt">log =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb268-4" data-line-number="4"><span class="st">    </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb268-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb268-6" data-line-number="6">}</a></code></pre></div>
<p>Now we’ll use the amended <code>grid_function()</code> to make the posterior.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1">d_grid &lt;-</a>
<a class="sourceLine" id="cb269-2" data-line-number="2"><span class="st">  </span>d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb269-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_likelihood =</span> <span class="kw">map2_dbl</span>(mu, sigma, grid_function)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb269-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior_mu    =</span> <span class="kw">dnorm</span>(mu, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd  =</span> <span class="dv">20</span>, <span class="dt">log =</span> T),</a>
<a class="sourceLine" id="cb269-5" data-line-number="5">         <span class="dt">prior_sigma =</span> <span class="kw">dunif</span>(sigma, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">log =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb269-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">product =</span> log_likelihood <span class="op">+</span><span class="st"> </span>prior_mu <span class="op">+</span><span class="st"> </span>prior_sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb269-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">exp</span>(product <span class="op">-</span><span class="st"> </span><span class="kw">max</span>(product)))</a></code></pre></div>
<p>Did you catch our use of <code>purrr::map2_dbl()</code>, there, in place of <code>purrr::map2()</code>? It turns out that <code>purrr::map()</code> and <code>purrr::map2()</code> always return a list (see <a href="https://purrr.tidyverse.org/reference/map.html">here</a> and <a href="https://purrr.tidyverse.org/reference/map2.html">here</a>). But as <a href="https://twitter.com/PStrafo">Phil Straforelli</a> kindly <a href="https://twitter.com/PStrafo/status/1046853175917961217">pointed out</a>, we can add the <code>_dbl</code> suffix to those functions, which will instruct the purrr package to return a double vector (i.e., a <a href="http://r4ds.had.co.nz/vectors.html#important-types-of-atomic-vector">common kind of numeric vector</a>). The advantage of that approach is we no longer need to follow our <code>map()</code> or <code>map2()</code> lines with <code>unnest()</code>. To learn more about the ins and outs of the <code>map()</code> family, check out <a href="http://r4ds.had.co.nz/iteration.html#the-map-functions">this section</a> from <em>R4DS</em> or Jenny Bryan’s <a href="https://jennybc.github.io/purrr-tutorial/"><em>purrr tutorial</em></a>.</p>
<p>Next we’ll <code>sample_n()</code> and plot.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb270-2" data-line-number="2"></a>
<a class="sourceLine" id="cb270-3" data-line-number="3">d_grid_samples &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb270-4" data-line-number="4"><span class="st">  </span>d_grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb270-5" data-line-number="5"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="fl">1e4</span>, <span class="dt">replace =</span> T, <span class="dt">weight =</span> probability)</a>
<a class="sourceLine" id="cb270-6" data-line-number="6"></a>
<a class="sourceLine" id="cb270-7" data-line-number="7">d_grid_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb270-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu, <span class="dt">y =</span> sigma)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb270-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">.9</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">15</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb270-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb270-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(mu[samples]),</a>
<a class="sourceLine" id="cb270-12" data-line-number="12">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma[samples])) <span class="op">+</span></a>
<a class="sourceLine" id="cb270-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-44-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Behold the updated densities.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">d_grid_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(mu<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb271-3" data-line-number="3"></a>
<a class="sourceLine" id="cb271-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb271-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey33&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-45-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>That <code>labeller = label_parsed</code> bit in the <code>facet_wrap()</code> function is what converted our subplot strip labels into Greek. You can learn more about <code>labeller</code> <a href="https://ggplot2.tidyverse.org/reference/labeller.html">here</a>. Anyway, our posterior for <span class="math inline">\(\sigma\)</span> isn’t so Gaussian with that small <span class="math inline">\(n\)</span>.</p>
<p>This is the point in the project where we hop off the grid-approximation train. On the one hand, I think this is a great idea. Most of y’all reading this will never use grid approximation in a real-world applied data analysis. On the other hand, there is some pedagogical utility in practicing with it. It can help you grasp what it is we’re dong when we apply Bayes’ theorem. If you’d like more practice, check out the first several chapters in John Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">textbook</a> and the corresponding chapters in my <span class="citation">(<a href="#ref-kurzDoingBayesianData2020">2020</a><a href="#ref-kurzDoingBayesianData2020">b</a>)</span> <a href="https://bookdown.org/content/3686/">ebook</a> translating it into <strong>brms</strong> and <strong>tidyverse</strong>.</p>
</div>
</div>
<div id="finding-the-posterior-distribution-with-quap-brm." class="section level3">
<h3><span class="header-section-number">4.3.5</span> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</h3>
<p>We won’t actually use <code>rethinking::quap()</code>, but will jump straight to the primary <strong>brms</strong> modeling function, <code>brm()</code>. In the text, McElreath indexed his models with names like <code>m4.1</code>. I will largely follow that convention, but will replace the <em>m</em> with a <em>b</em> to stand for the <strong>brms</strong> package. Here’s the first model for this chapter.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1">b4<span class="fl">.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb272-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb272-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb272-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb272-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb272-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb272-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">31000</span>, <span class="dt">warmup =</span> <span class="dv">30000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb272-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb272-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.01&quot;</span>)</a></code></pre></div>
<p>McElreath’s uniform prior for <span class="math inline">\(\sigma\)</span> was rough on <strong>brms</strong>. It took an unusually-large number of warmup iterations before the chains sampled properly. As McElreath covered in Chapter 9, Hamiltonian Monte Carlo (HMC) tends to work better when you default to an exponential or half Cauchy for <span class="math inline">\(\sigma\)</span>. Here’s how to do so with the half Cauchy.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">b4<span class="fl">.1</span>_hc &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb273-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb273-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb273-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb273-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb273-6" data-line-number="6">                <span class="co"># the magic lives here</span></a>
<a class="sourceLine" id="cb273-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb273-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb273-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb273-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.01_hc&quot;</span>)</a></code></pre></div>
<p>This leads to an important point. After running a model fit with HMC, it’s a good idea to inspect the chains. As we’ll see, McElreath coverd this in Chapter 9. Here’s a typical way to do so with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1"><span class="kw">plot</span>(b4<span class="fl">.1</span>_hc)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-46-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If you want detailed diagnostics for the HMC chains, call <code>launch_shinystan(b4.1)</code>. That’ll keep you busy for a while. But anyway, the chains look good. We can reasonably trust the results. Here’s how to get the model summary of our <code>brm()</code> object.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1"><span class="kw">print</span>(b4<span class="fl">.1</span>_hc)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.61      0.41   153.81   155.40 1.00     3277     2424
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     7.74      0.29     7.21     8.34 1.00     3525     2627
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <code>summary()</code> function works in a similar way. You can also get a Stan-like summary <span class="citation">(see the <a href="https://CRAN.R-project.org/package=rstan/vignettes/rstan.html"><em>RStan: the R interface to Stan</em></a> vignette; Stan Development Team, <a href="#ref-standevelopmentteamRStanInterfaceStan2020">2020</a><a href="#ref-standevelopmentteamRStanInterfaceStan2020">a</a>)</span> with a little indexing.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">b4<span class="fl">.1</span>_hc<span class="op">$</span>fit</a></code></pre></div>
<pre><code>## Inference for Stan model: 1df58279fc244ef48da72e5429624e43.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                 mean se_mean   sd     2.5%      25%      50%      75%    97.5% n_eff Rhat
## b_Intercept   154.61    0.01 0.41   153.81   154.34   154.61   154.88   155.40  3247    1
## sigma           7.74    0.00 0.29     7.21     7.54     7.74     7.93     8.34  3500    1
## lp__        -1227.49    0.02 0.95 -1230.00 -1227.88 -1227.21 -1226.81 -1226.54  1743    1
## 
## Samples were drawn using NUTS(diag_e) at Fri May 22 14:26:33 2020.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Whereas <strong>rethinking</strong> defaults to 89% intervals, using <code>print()</code> or <code>summary()</code> with <strong>brms</strong> models defaults to 95% intervals. Unless otherwise specified, I will stick with 95% intervals throughout. However, if you really want those 89% intervals, an easy way is with the <code>prob</code> argument within <code>brms::summary()</code> or <code>brms::print()</code>.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw">summary</span>(b4<span class="fl">.1</span>_hc, <span class="dt">prob =</span> <span class="fl">.89</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
## Intercept   154.61      0.41   153.96   155.24 1.00     3277     2424
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
## sigma     7.74      0.29     7.29     8.23 1.00     3525     2627
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Anyways, here’s the very-narrow-<span class="math inline">\(\mu\)</span>-prior model.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1">b4<span class="fl">.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb281-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb281-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb281-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="fl">0.1</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb281-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb281-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">2000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb281-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb281-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.02&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="kw">plot</span>(b4<span class="fl">.2</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-50-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>I had to increase the <code>warmup</code> due to convergence issues. After doing so, everything looks to be on the up and up. The chains look great. Here’s the model <code>summary()</code>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1"><span class="kw">summary</span>(b4<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 
##    Data: d2 (Number of observations: 352) 
## Samples: 4 chains, each with iter = 3000; warmup = 2000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   177.87      0.10   177.67   178.06 1.00     3860     2504
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    24.66      0.93    22.91    26.52 1.00     1512     1443
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Subsetting the <code>summary()</code> output with <code>$fixed</code> provides a convenient way to compare the <code>Intercept</code> summaries between <code>b4.1_hc</code> and <code>b4.2</code>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1"><span class="kw">rbind</span>(<span class="kw">summary</span>(b4<span class="fl">.1</span>_hc)<span class="op">$</span>fixed,</a>
<a class="sourceLine" id="cb285-2" data-line-number="2">      <span class="kw">summary</span>(b4<span class="fl">.2</span>)<span class="op">$</span>fixed)</a></code></pre></div>
<pre><code>##           Estimate  Est.Error l-95% CI u-95% CI      Rhat Bulk_ESS Tail_ESS
## Intercept 154.6076 0.40763440 153.8064 155.3959 1.0009335     3277     2424
## Intercept 177.8665 0.09898651 177.6732 178.0592 0.9999747     3860     2504</code></pre>
</div>
<div id="sampling-from-a-quap-brm-fit." class="section level3">
<h3><span class="header-section-number">4.3.6</span> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</h3>
<p><strong>brms</strong> doesn’t seem to have a convenience function that works the way <code>vcov()</code> does for <strong>rethinking</strong>. For example:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" data-line-number="1"><span class="kw">vcov</span>(b4<span class="fl">.1</span>_hc)</a></code></pre></div>
<pre><code>##           Intercept
## Intercept 0.1661658</code></pre>
<p>This only returns the first element in the matrix it did for <strong>rethinking</strong>. That is, it appears <code>brms::vcov()</code> only returns the variance/covariance matrix for the single-level <span class="math inline">\(\beta\)</span> parameters. However, if you really wanted this information, you could get it after putting the HMC chains in a data frame. We do that with the <code>posterior_samples()</code>, which we’ll be using a lot of as we go along.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.1</span>_hc)</a>
<a class="sourceLine" id="cb289-2" data-line-number="2"></a>
<a class="sourceLine" id="cb289-3" data-line-number="3"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##   b_Intercept    sigma      lp__
## 1    154.6786 8.051124 -1227.133
## 2    155.1678 7.460777 -1227.938
## 3    154.8059 7.492012 -1226.967
## 4    154.5193 8.035891 -1227.089
## 5    154.8931 7.316433 -1227.847
## 6    155.1126 7.900020 -1227.420</code></pre>
<p>Now <code>select()</code> the columns containing the draws from the desired parameters and feed them into <code>cov()</code>.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" data-line-number="1"><span class="kw">select</span>(post, b_Intercept<span class="op">:</span>sigma) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb291-2" data-line-number="2"><span class="st">  </span><span class="kw">cov</span>()</a></code></pre></div>
<pre><code>##               b_Intercept         sigma
## b_Intercept  0.1661658018 -0.0007004767
## sigma       -0.0007004767  0.0832359724</code></pre>
<p>That was “(1) a vector of variances for the parameters and (2) a correlation matrix” for them (p. 90). Here are just the variances (i.e., the diagonal elements) and the correlation matrix.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1"><span class="co"># variances</span></a>
<a class="sourceLine" id="cb293-2" data-line-number="2"><span class="kw">select</span>(post, b_Intercept<span class="op">:</span>sigma) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-3" data-line-number="3"><span class="st">  </span><span class="kw">cov</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-4" data-line-number="4"><span class="st">  </span><span class="kw">diag</span>()</a></code></pre></div>
<pre><code>## b_Intercept       sigma 
##  0.16616580  0.08323597</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="co"># correlation</span></a>
<a class="sourceLine" id="cb295-2" data-line-number="2">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb295-3" data-line-number="3"><span class="kw">select</span>(b_Intercept, sigma) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb295-4" data-line-number="4"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##              b_Intercept        sigma
## b_Intercept  1.000000000 -0.005956173
## sigma       -0.005956173  1.000000000</code></pre>
<p>With our <code>post &lt;- posterior_samples(b4.1_hc)</code> code from a few lines above, we’ve already done the <strong>brms</strong> version of what McElreath did with <code>extract.samples()</code> on page 90. However, what happened under the hood was different. Whereas rethinking used the <code>mvnorm()</code> function from the <a href="https://cran.r-project.org/package=MASS"><strong>MASS</strong> package</a> <span class="citation">(Ripley, <a href="#ref-R-MASS">2019</a>; Venables &amp; Ripley, <a href="#ref-MASS2002">2002</a>)</span>, with <strong>brms</strong> we just extracted the iterations of the HMC chains and put them in a data frame.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1"><span class="kw">str</span>(post)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4000 obs. of  3 variables:
##  $ b_Intercept: num  155 155 155 155 155 ...
##  $ sigma      : num  8.05 7.46 7.49 8.04 7.32 ...
##  $ lp__       : num  -1227 -1228 -1227 -1227 -1228 ...</code></pre>
<p>Notice how our data frame, <code>post</code>, includes a third vector named <code>lp__</code>. That’s the log posterior. See the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(Bürkner, <a href="#ref-brms2020RM">2020</a><a href="#ref-brms2020RM">g</a>)</span> or the “The Log-Posterior (function and gradient)” section of the Stan Development Team’s <a href="https://cran.r-project.org/package=rstan/vignettes/rstan.html#the-log-posterior-function-and-gradient"><em>RStan: the R interface to Stan</em></a> for details. The log posterior will largely be outside of our focus in this project.</p>
<p>The <code>summary()</code> function doesn’t work for <strong>brms</strong> posterior data frames quite the way <code>precis()</code> does for posterior data frames from the <strong>rethinking package</strong>. Behold the results.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1"><span class="kw">summary</span>(post[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</a></code></pre></div>
<pre><code>##   b_Intercept        sigma      
##  Min.   :152.8   Min.   :6.838  
##  1st Qu.:154.3   1st Qu.:7.537  
##  Median :154.6   Median :7.738  
##  Mean   :154.6   Mean   :7.743  
##  3rd Qu.:154.9   3rd Qu.:7.932  
##  Max.   :156.1   Max.   :8.832</code></pre>
<p>Here’s one option using the transpose of a <code>quantile()</code> call nested within <code>apply()</code>, which is a very general function you can learn more about <a href="https://www.datacamp.com/community/tutorials/r-tutorial-apply-family#gs.f7fyw2s">here</a> or <a href="https://www.r-bloggers.com/r-tutorial-on-the-apply-family-of-functions/">here</a>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1"><span class="kw">t</span>(<span class="kw">apply</span>(post[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.025</span>, <span class="fl">.75</span>)))</a></code></pre></div>
<pre><code>##                    50%       2.5%        75%
## b_Intercept 154.605262 153.806385 154.881238
## sigma         7.738411   7.205024   7.931603</code></pre>
<p>The base <strong>R</strong> code is compact, but somewhat opaque. Here’s how to do something similar with more explicit <strong>tidyverse</strong> code.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb303-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb303-5" data-line-number="5">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb303-6" data-line-number="6">            <span class="st">`</span><span class="dt">2.5_percentile</span><span class="st">`</span>  =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb303-7" data-line-number="7">            <span class="st">`</span><span class="dt">97.5_percentile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   name          mean    sd `2.5_percentile` `97.5_percentile`
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
## 1 b_Intercept 155.   0.41            154.              155.  
## 2 sigma         7.74 0.290             7.21              8.34</code></pre>
<p>You can always get pretty similar information by just putting the <code>brm()</code> fit object into <code>posterior_summary()</code>.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1"><span class="kw">posterior_summary</span>(b4<span class="fl">.1</span>_hc)</a></code></pre></div>
<pre><code>##                 Estimate Est.Error         Q2.5        Q97.5
## b_Intercept   154.607579 0.4076344   153.806385   155.395943
## sigma           7.743143 0.2885065     7.205024     8.335414
## lp__        -1227.492023 0.9523241 -1230.000431 -1226.541784</code></pre>
<p>And if you’re willing to drop the posterior <span class="math inline">\(SD\)</span>s, you can use <code>tidybayes::mean_hdi()</code>, too.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb307-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb307-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb307-4" data-line-number="4"><span class="st">  </span><span class="kw">mean_qi</span>(value)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   name         value .lower .upper .width .point .interval
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_Intercept 155.   154.   155.     0.95 mean   qi       
## 2 sigma         7.74   7.21   8.34   0.95 mean   qi</code></pre>
<p>Though none of these solutions get you those sweet little histograms, you can always make those for your HMC models by inserting the desired posterior draws into <code>histospark()</code>.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" data-line-number="1"><span class="kw">rbind</span>(<span class="kw">histospark</span>(post<span class="op">$</span>b_Intercept),</a>
<a class="sourceLine" id="cb309-2" data-line-number="2">      <span class="kw">histospark</span>(post<span class="op">$</span>sigma))</a></code></pre></div>
<pre><code>##      [,1]         
## [1,] &quot;▁▁▁▅▇▂▁▁&quot;   
## [2,] &quot;▁▁▂▅▇▇▃▁▁▁▁&quot;</code></pre>
<p>Hell, you can even tack those onto the output from our verbose <strong>tidyverse</strong> code from a few blocks up.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" data-line-number="1">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb311-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb311-5" data-line-number="5">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb311-6" data-line-number="6">            <span class="st">`</span><span class="dt">2.5 %</span><span class="st">`</span>  =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb311-7" data-line-number="7">            <span class="st">`</span><span class="dt">97.5 %</span><span class="st">`</span> =<span class="st"> </span><span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dt">digits =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb311-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">histospark =</span> <span class="kw">c</span>(<span class="kw">histospark</span>(post<span class="op">$</span>b_Intercept), <span class="kw">histospark</span>(post<span class="op">$</span>sigma)))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   name          mean    sd `2.5 %` `97.5 %` histospark 
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      
## 1 b_Intercept 155.   0.41   154.     155.   ▁▁▁▅▇▂▁▁   
## 2 sigma         7.74 0.290    7.21     8.34 ▁▁▂▅▇▇▃▁▁▁▁</code></pre>
<div id="overthinking-under-the-hood-with-multivariate-sampling." class="section level4">
<h4><span class="header-section-number">4.3.6.1</span> Overthinking: Under the hood with multivariate sampling.</h4>
<p>Again, <code>brms::posterior_samples()</code> is not the same as <code>rethinking::extract.samples()</code>. Rather than use the <code>MASS::mvnorm()</code>, <strong>brms</strong> takes the draws from the HMC chains. McElreath coverd all of this in Chapter 9 and we will too. You might also look at the <strong>brms</strong> <a href="https://cran.r-project.org/package=brms/brms.pdf">reference manual</a> or <a href="https://github.com/paul-buerkner/brms">GitHub page</a> for details. To get documentation in a hurry, you could also just execute <code>?posterior_samples</code>.</p>
</div>
</div>
</div>
<div id="linear-prediction" class="section level2">
<h2><span class="header-section-number">4.4</span> Linear prediction</h2>
<p>Here’s our scatter plot of <code>weight</code> and <code>height</code>.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb313-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb313-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb313-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb313-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-65-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>There’s obviously a relationship: Knowing a person’s weight helps you predict height.</p>
<p>To make this vague observation into a more precise quantitative model that relates values of <code>weight</code> to plausible values of <code>height</code>, we need some more technology. How do we take our Gaussian model from the previous section and incorporate predictor variables? (p. 92)</p>
</blockquote>
<div id="the-linear-model-strategy." class="section level3">
<h3><span class="header-section-number">4.4.1</span> The linear model strategy.</h3>
<blockquote>
<p>The strategy is to make the parameter for the mean of a Gaussian distribution, <span class="math inline">\(\mu\)</span>, into a linear function of the predictor variable and other, new parameters that we invent. This strategy is often simply called the <strong>linear model</strong>. The linear model strategy instructs the golem to assume that the predictor variable has a constant and additive relationship to the mean of the outcome. The golem then computes the posterior distribution of this constant relationship. (p. 92, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>In our new univariable model,</p>
<p><span class="math display">\[\begin{align*}
\text{height}_i    &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i  &amp; = \alpha + \beta (\text{weight}_i - \overline{\text{weight}}) \\
\alpha &amp; \sim \operatorname{Normal}(178, 20) \\
\beta  &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma &amp; \sim \operatorname{Uniform}(0, 50).
\end{align*}\]</span></p>
<p>Do note that <span class="math inline">\((\text{weight}_i - \overline{\text{weight}})\)</span> part. As we’ll see, it’s often advantageous to mean center our predictors.</p>
<div id="probability-of-the-data" class="section level4">
<h4><span class="header-section-number">4.4.1.1</span> Probability of the data</h4>
<blockquote>
<p>Let’s begin with just the probability of the observed height, the first line of the model. This is nearly identical to before, except now there is a little index <span class="math inline">\(i\)</span> on the <span class="math inline">\(\mu\)</span> as well as the [<span class="math inline">\(\text{height}\)</span>]. You can read [<span class="math inline">\(\text{height}_i\)</span>] as “each [<span class="math inline">\(\text{height}\)</span>]” and <span class="math inline">\(\mu_i\)</span> as “each <span class="math inline">\(\mu\)</span>.” The mean <span class="math inline">\(\mu\)</span> now depends upon unique values on each row <span class="math inline">\(i\)</span>. So the little <span class="math inline">\(i\)</span> on <span class="math inline">\(\mu_i\)</span> indicates that <em>the mean depends upon the row</em>. (p. 93, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="linear-model" class="section level4">
<h4><span class="header-section-number">4.4.1.2</span> Linear model</h4>
<blockquote>
<p>The mean <span class="math inline">\(\mu\)</span> is no longer a parameter to be estimated. Rather, as seen in the second line of the model, <span class="math inline">\(\mu_i\)</span> is constructed from other parameters, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, and the observed variable [<span class="math inline">\(\text{weight}\)</span>]. This line is not a stochastic relationship—there is no <span class="math inline">\(\sim\)</span> in it, but rather an <span class="math inline">\(=\)</span> in it–because the definition of <span class="math inline">\(\mu_i\)</span> is deterministic. That is to say that, once we know <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> and [<span class="math inline">\(\text{weight}_i\)</span>], we know <span class="math inline">\(\mu_i\)</span> with certainty.</p>
<p>The value [<span class="math inline">\(\text{weight}_i\)</span>] is just the weight value on row <span class="math inline">\(i\)</span>. It refers to the same individual as the height value, [<span class="math inline">\(\text{height}_i\)</span>], on the same row. The parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are more mysterious. Where did they come from? We made them up….</p>
<p>You’ll be making up all manner of parameters as your skills improve. (p. 93)</p>
</blockquote>
<div id="rethinking-nothing-special-or-natural-about-linear-models." class="section level5">
<h5><span class="header-section-number">4.4.1.2.1</span> Rethinking: Nothing special or natural about linear models.</h5>
<blockquote>
<p>Note that there’s nothing special about the linear model, really. You can choose a different relationship between <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\mu\)</span>. For example, the following is a perfectly legitimate definition for <span class="math inline">\(\mu_i\)</span>:</p>
<p><span class="math display">\[\mu_i = \alpha \exp(- \beta x_i)\]</span></p>
<p>This does not define a linear regression, but it does define a regression model. The linear relationship we are using instead is conventional, but nothing requires that you use it. (p. 94)</p>
</blockquote>
</div>
</div>
<div id="priors" class="section level4">
<h4><span class="header-section-number">4.4.1.3</span> Priors</h4>
<blockquote>
<p>The remaining lines in the model define distributions for the unobserved variables. These variables are commonly known as parameters, and their distributions as priors. There are three parameters: <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma\)</span>. You’ve seen priors for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\sigma\)</span> before, although <span class="math inline">\(\alpha\)</span> was called <span class="math inline">\(\mu\)</span> back then.</p>
<p>The prior for <span class="math inline">\(\beta\)</span> deserves explanation. Why have a Gaussian prior with mean zero? (p. 94)</p>
</blockquote>
<p>We’ll simulate to find out. Instead of using a loop to make our data for Figure 4.5, we’ll stay within the <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb314-2" data-line-number="2"><span class="co"># how many lines would you like?</span></a>
<a class="sourceLine" id="cb314-3" data-line-number="3">n_lines &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb314-4" data-line-number="4"></a>
<a class="sourceLine" id="cb314-5" data-line-number="5">lines &lt;-</a>
<a class="sourceLine" id="cb314-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">n =</span> <span class="dv">1</span><span class="op">:</span>n_lines,</a>
<a class="sourceLine" id="cb314-7" data-line-number="7">         <span class="dt">a =</span> <span class="kw">rnorm</span>(n_lines, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb314-8" data-line-number="8">         <span class="dt">b =</span> <span class="kw">rnorm</span>(n_lines, <span class="dt">mean =</span> <span class="dv">0</span>,   <span class="dt">sd =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-9" data-line-number="9"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(n, a, b), <span class="dt">weight =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb314-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>(weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight)))</a>
<a class="sourceLine" id="cb314-11" data-line-number="11"></a>
<a class="sourceLine" id="cb314-12" data-line-number="12"><span class="kw">head</span>(lines)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##       n     a     b weight height
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1  182.  6.85   31.1   87.0
## 2     1  182.  6.85   63.0  306. 
## 3     2  167. -1.15   31.1  183. 
## 4     2  167. -1.15   63.0  146. 
## 5     3  196. -3.56   31.1  245. 
## 6     3  196. -3.56   63.0  132.</code></pre>
<p>Now we’ll plot the left panel from Figure 4.5.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" data-line-number="1">lines <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb316-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height, <span class="dt">group =</span> n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb316-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="dt">linetype =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb316-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb316-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb316-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;b ~ dnorm(0, 10)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb316-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-67-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The pattern doesn’t look like any human population at all. It essentially says that the relationship between weight and height could be absurdly positive or negative. Before we’ve even seen the data, this is a bad model. Can we do better?</p>
<p>We can do better immediately. (pp. 95–96)</p>
</blockquote>
<p>One thing we know from the outset is that the correlation between human height and weight is positive. We might not be sure of the magnitude, but it’s definitely the case that, on average, taller people heavier people. Within the univariable regression context, this implies that the regression coefficient for <code>weight</code> predicting <code>height</code> will be positive. It might be unclear how large that coefficient will be, but it will certainly be above zero. One way we might encode this information in our data is by using the lognormal distribution for our <span class="math inline">\(\beta\)</span> prior. Here’s what <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span> looks like.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb317-2" data-line-number="2"></a>
<a class="sourceLine" id="cb317-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">b =</span> <span class="kw">rlnorm</span>(<span class="fl">1e4</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb317-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b)) <span class="op">+</span></a>
<a class="sourceLine" id="cb317-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb317-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb317-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-68-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>If you’re unfamiliar with the log-normal distribution, it is the distribution whose logarithm is normally distributed. For example, here’s what happens when we compare <span class="math inline">\(\operatorname{Normal}(0, 1)\)</span> with <span class="math inline">\(\log \big ( \operatorname{Log-Normal}(0, 1) \big)\)</span>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb318-2" data-line-number="2"></a>
<a class="sourceLine" id="cb318-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">rnorm           =</span> <span class="kw">rnorm</span>(<span class="fl">1e5</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb318-4" data-line-number="4">       <span class="st">`</span><span class="dt">log(rlognorm)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">log</span>(<span class="kw">rlnorm</span>(<span class="fl">1e5</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb318-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb318-6" data-line-number="6"></a>
<a class="sourceLine" id="cb318-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb318-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb318-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb318-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb318-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-69-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>They are the same within simulation variance. Also, did you notice how we simulated those log-normal data with <code>mean = 0, sd = 1</code>? Those values are what the mean and standard deviation of the output from the <code>rlnorm()</code> function <strong>after</strong> they are log transformed. The formulas for the actual mean and standard deviation for the log-normal distribution itself are complicated (see <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">here</a>). They are</p>
<p><span class="math display">\[\begin{align*}
\text{mean}               &amp; = \exp \left (\mu + \frac{\sigma^2}{2} \right) \\
\text{standard deviation} &amp; = \sqrt{[\exp(\sigma ^{2})-1]\exp(2\mu +\sigma ^{2})}.
\end{align*}\]</span></p>
<p>If we follow those formulas through, there are the mean and standard deviation for <span class="math inline">\(\operatorname{Log-Normal}(0, 1)\)</span>.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" data-line-number="1">mu    &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb319-2" data-line-number="2">sigma &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb319-3" data-line-number="3"></a>
<a class="sourceLine" id="cb319-4" data-line-number="4"><span class="co"># mean</span></a>
<a class="sourceLine" id="cb319-5" data-line-number="5"><span class="kw">exp</span>(mu <span class="op">+</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 1.648721</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" data-line-number="1"><span class="co"># sd</span></a>
<a class="sourceLine" id="cb321-2" data-line-number="2"><span class="kw">sqrt</span>((<span class="kw">exp</span>(sigma<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>## [1] 2.161197</code></pre>
<p>Let’s confirm with simulated draws from <code>rlnorm()</code>.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb323-2" data-line-number="2"></a>
<a class="sourceLine" id="cb323-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">rlnorm</span>(<span class="fl">1e7</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb323-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(x),</a>
<a class="sourceLine" id="cb323-5" data-line-number="5">            <span class="dt">sd   =</span> <span class="kw">sd</span>(x))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    mean    sd
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  1.65  2.17</code></pre>
<p>But okay, “so what [do all these complications] earn us? Do the prior predictive simulation again, now with the Log-Normal prior:” (p. 96).</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" data-line-number="1"><span class="co"># make a tibble to annotate the plot</span></a>
<a class="sourceLine" id="cb325-2" data-line-number="2">text &lt;-</a>
<a class="sourceLine" id="cb325-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">weight =</span> <span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">43</span>),</a>
<a class="sourceLine" id="cb325-4" data-line-number="4">         <span class="dt">height =</span> <span class="kw">c</span>(<span class="dv">0</span> <span class="op">-</span><span class="st"> </span><span class="dv">25</span>, <span class="dv">272</span> <span class="op">+</span><span class="st"> </span><span class="dv">25</span>),</a>
<a class="sourceLine" id="cb325-5" data-line-number="5">         <span class="dt">label  =</span> <span class="kw">c</span>(<span class="st">&quot;Embryo&quot;</span>, <span class="st">&quot;World&#39;s tallest person (272 cm)&quot;</span>))</a>
<a class="sourceLine" id="cb325-6" data-line-number="6"></a>
<a class="sourceLine" id="cb325-7" data-line-number="7"><span class="co"># simulate</span></a>
<a class="sourceLine" id="cb325-8" data-line-number="8"><span class="kw">set.seed</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb325-9" data-line-number="9"></a>
<a class="sourceLine" id="cb325-10" data-line-number="10"><span class="kw">tibble</span>(<span class="dt">n =</span> <span class="dv">1</span><span class="op">:</span>n_lines,</a>
<a class="sourceLine" id="cb325-11" data-line-number="11">       <span class="dt">a =</span> <span class="kw">rnorm</span>(n_lines, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb325-12" data-line-number="12">       <span class="dt">b =</span> <span class="kw">rlnorm</span>(n_lines, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb325-13" data-line-number="13"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(n, a, b), <span class="dt">weight =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb325-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>(weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb325-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb325-16" data-line-number="16"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb325-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height, <span class="dt">group =</span> n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="dt">linetype =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</a>
<a class="sourceLine" id="cb325-21" data-line-number="21">            <span class="kw">aes</span>(<span class="dt">label =</span> label),</a>
<a class="sourceLine" id="cb325-22" data-line-number="22">            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-23" data-line-number="23"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-24" data-line-number="24"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;log(b) ~ dnorm(0, 1)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-25" data-line-number="25"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-71-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>“This is much more sensible. There is still a rare impossible relationship. But nearly all lines in the joint prior for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are now within human reason” (p. 96)</p>
<div id="rethinking-whats-the-correct-prior" class="section level5">
<h5><span class="header-section-number">4.4.1.3.1</span> Rethinking: What’s the correct prior?</h5>
<p>Good luck with that question. Hang around on academic Twitter long enough and you’ll see folks debating this.</p>
<blockquote>
<p>This is a mistake. There is no more a uniquely correct prior than there is a uniquely correct likelihood. Statistical models are machines for inference. Many machines will work, but some work better than others. Priors can be wrong, but only in the same sense that a kind of hammer can be wrong for building a table. (p. 96)</p>
</blockquote>
</div>
<div id="rethinking-prior-predictive-simulation-and-p-hacking" class="section level5">
<h5><span class="header-section-number">4.4.1.3.2</span> Rethinking: Prior predictive simulation and <span class="math inline">\(p\)</span>-hacking</h5>
<p>“We don’t pay any attention to <span class="math inline">\(p\)</span>-values in this book” (p. 97). Off hand, I’m not sure of the exact origin of the term <span class="math inline">\(p\)</span>-hacking. But the paper by Simmons, Nelson and Simonsohn <span class="citation">(<a href="#ref-simmonsFalsepositivePsychologyUndisclosed2011">2011</a>)</span>, <a href="https://doi.org/10.1177/0956797611417632"><em>False-positive psychology: Undisclosed flexibility in data collection and analysis allows presenting anything as significant</em></a>, is often cited as an introduction to the problem.</p>
</div>
</div>
</div>
<div id="finding-the-posterior-distribution." class="section level3">
<h3><span class="header-section-number">4.4.2</span> Finding the posterior distribution.</h3>
<p>Unlike with McElreath’s <code>quap()</code> formula syntax, I’m not aware that you can just specify something like <code>weight – xbar</code> in the <code>formula</code> argument in <code>brm()</code>. However, the alternative is easy: Just make a new variable in the data that is equivalent to <code>weight – mean(weight)</code>. We’ll call it <code>weight_c</code>.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" data-line-number="1">d2 &lt;-</a>
<a class="sourceLine" id="cb326-2" data-line-number="2"><span class="st">  </span>d2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb326-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_c =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(weight))</a></code></pre></div>
<p>The <code>brms::brm()</code> syntax doesn’t mirror the statistical notation. But here are the analogues to the exposition at the bottom of page 97:</p>
<ul>
<li><span class="math inline">\(\text{height}_i \sim \operatorname{Normal}(\mu_i, \sigma)\)</span>: <code>family = gaussian</code>,</li>
<li><span class="math inline">\(\mu_i = \alpha + \beta \text{weight}_i\)</span>: <code>height ~ 1 + weight_c</code>,</li>
<li><span class="math inline">\(\alpha \sim \operatorname{Normal}(178, 20)\)</span>: <code>prior(normal(178, 20), class = Intercept</code>,</li>
<li><span class="math inline">\(\beta \sim \operatorname{Log-Normal}(0, 1)\)</span>: <code>prior(lognormal(0, 1), class = b)</code>, and</li>
<li><span class="math inline">\(\sigma \sim \operatorname{Uniform}(0, 50)\)</span>: <code>prior(uniform(0, 50), class = sigma)</code>.</li>
</ul>
<p>Thus, to add a predictor you just the <code>+</code> operator in the model <code>formula</code>.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb327-1" data-line-number="1">b4<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb327-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2, </a>
<a class="sourceLine" id="cb327-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb327-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb327-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb327-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb327-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb327-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">28000</span>, <span class="dt">warmup =</span> <span class="dv">27000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb327-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb327-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.03&quot;</span>)</a></code></pre></div>
<p>This was another example of how using a uniform prior for <span class="math inline">\(\sigma\)</span> was a major pain. As you’ll see in later chapters, you usually only need to set <code>iter = 2000, warmup = 1000</code> when using even moderately better priors. But for now, we’ll continue to find ways to stick close to the text. Here are the trace plots.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" data-line-number="1"><span class="kw">plot</span>(b4<span class="fl">.3</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-73-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="interpreting-the-posterior-distribution." class="section level3">
<h3><span class="header-section-number">4.4.3</span> Interpreting the posterior distribution.</h3>
<p>“One trouble with statistical models is that they are hard to understand” (p. 99). Welcome to the world of applied statistics, friends. 😅</p>
<div id="rethinking-what-do-parameters-mean" class="section level5">
<h5><span class="header-section-number">4.4.3.0.1</span> Rethinking: What do parameters mean?</h5>
<blockquote>
<p>A basic issue with interpreting model-based estimates is in knowing the meaning of parameters. There is no consensus about what a parameter means, however, because different people take different philosophical stances towards models, probability, and prediction. The perspective in this book is a common Bayesian perspective: <em>Posterior probabilities of parameter values describe the relative compatibility of different states of the world with the data, according to the model</em>. (p. 99, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="tables-of-marginal-distributions." class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> Tables of marginal distributions.</h4>
<p>With a little <code>[]</code> subsetting we can exclude the log posterior from the summary.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" data-line-number="1"><span class="kw">posterior_summary</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb329-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept   154.61      0.27 154.08 155.14
## b_weight_c      0.90      0.04   0.81   0.98
## sigma           5.10      0.20   4.73   5.52</code></pre>
<p>If we put our <strong>brms</strong> fit into the <code>vcov()</code> function, we’ll get the variance/covariance matrix of the intercept and <code>weight_c</code> coefficient.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" data-line-number="1"><span class="kw">vcov</span>(b4<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb331-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>##           Intercept weight_c
## Intercept     0.072    0.000
## weight_c      0.000    0.002</code></pre>
<p>No <span class="math inline">\(\sigma\)</span>, however. To get that, we’ll have to extract the posterior draws and use the <code>cov()</code> function, instead.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1"><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-3" data-line-number="3"><span class="st">  </span><span class="kw">cov</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-4" data-line-number="4"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##             b_Intercept b_weight_c sigma
## b_Intercept       0.072      0.000  0.00
## b_weight_c        0.000      0.002  0.00
## sigma             0.000      0.000  0.04</code></pre>
<p>The <code>pairs()</code> function will work for a <strong>brms</strong> fit much like it would one from <strong>rethinking</strong>. It will show “both the marginal posteriors and the covariance” (p. 100).</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" data-line-number="1"><span class="kw">pairs</span>(b4<span class="fl">.3</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-78-1.png" width="432" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-posterior-inference-against-the-data." class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> Plotting posterior inference against the data.</h4>
<p>“It’s almost always much more useful to plot the posterior inference against the data. Not only does plotting help in interpreting the posterior, but it also provides an informal check on model assumptions” (p. 100).</p>
<p>Here is the code for Figure 4.6. Note our use of the <code>fixef()</code> function.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" data-line-number="1">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb336-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb336-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="kw">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb336-4" data-line-number="4">              <span class="dt">slope     =</span> <span class="kw">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb336-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb336-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-79-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Note how the breaks on our <span class="math inline">\(x\)</span>-axis look off. That’s because we fit the model with <code>weight_c</code> and we plotted the points in that metric, too. Since we computed <code>weight_c</code> by subtracting the mean of <code>weight</code> from the data, we can adjust the <span class="math inline">\(x\)</span>-axis break point labels by simply adding that value back.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" data-line-number="1">labels &lt;-</a>
<a class="sourceLine" id="cb337-2" data-line-number="2"><span class="st">  </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb337-3" data-line-number="3"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb337-4" data-line-number="4"></a>
<a class="sourceLine" id="cb337-5" data-line-number="5">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb337-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb337-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="kw">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb337-8" data-line-number="8">              <span class="dt">slope     =</span> <span class="kw">fixef</span>(b4<span class="fl">.3</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb337-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb337-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>,</a>
<a class="sourceLine" id="cb337-11" data-line-number="11">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb337-12" data-line-number="12">                     <span class="dt">labels =</span> labels) <span class="op">+</span></a>
<a class="sourceLine" id="cb337-13" data-line-number="13"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb337-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-80-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-uncertainty-around-the-mean." class="section level4">
<h4><span class="header-section-number">4.4.3.3</span> Adding uncertainty around the mean.</h4>
<p>Be default, we extract all the posterior iterations with <code>posterior_samples()</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>)</a>
<a class="sourceLine" id="cb338-2" data-line-number="2"></a>
<a class="sourceLine" id="cb338-3" data-line-number="3">post <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-4" data-line-number="4"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)  <span class="co"># this serves a similar function as `head()`</span></a></code></pre></div>
<pre><code>##   b_Intercept b_weight_c    sigma      lp__
## 1    154.6848  0.9005105 5.116295 -1078.789
## 2    154.6200  0.8753695 5.068664 -1078.948
## 3    154.5150  0.9009567 5.072314 -1078.775
## 4    154.7389  0.8978787 5.197296 -1079.035
## 5    154.0583  0.8978242 4.979772 -1080.962</code></pre>
<p>Here are the four models leading up to McElreath’s Figure 4.7.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1">N &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb340-2" data-line-number="2"></a>
<a class="sourceLine" id="cb340-3" data-line-number="3">b4<span class="fl">.3</span>_<span class="dv">010</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb340-4" data-line-number="4"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb340-5" data-line-number="5"><span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>N),  <span class="co"># note our tricky use of `N` and `slice()`</span></a>
<a class="sourceLine" id="cb340-6" data-line-number="6">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb340-7" data-line-number="7">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb340-8" data-line-number="8">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb340-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb340-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb340-11" data-line-number="11">      <span class="dt">iter =</span> <span class="dv">28000</span>, <span class="dt">warmup =</span> <span class="dv">27000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-12" data-line-number="12">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-13" data-line-number="13">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.03_010&quot;</span>)</a>
<a class="sourceLine" id="cb340-14" data-line-number="14"></a>
<a class="sourceLine" id="cb340-15" data-line-number="15">N &lt;-<span class="st"> </span><span class="dv">50</span></a>
<a class="sourceLine" id="cb340-16" data-line-number="16"></a>
<a class="sourceLine" id="cb340-17" data-line-number="17">b4<span class="fl">.3</span>_<span class="dv">050</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb340-18" data-line-number="18"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb340-19" data-line-number="19"><span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>N), </a>
<a class="sourceLine" id="cb340-20" data-line-number="20">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb340-21" data-line-number="21">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb340-22" data-line-number="22">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb340-23" data-line-number="23">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb340-24" data-line-number="24">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb340-25" data-line-number="25">      <span class="dt">iter =</span> <span class="dv">28000</span>, <span class="dt">warmup =</span> <span class="dv">27000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-26" data-line-number="26">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-27" data-line-number="27">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.03_050&quot;</span>)</a>
<a class="sourceLine" id="cb340-28" data-line-number="28"></a>
<a class="sourceLine" id="cb340-29" data-line-number="29">N &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb340-30" data-line-number="30"></a>
<a class="sourceLine" id="cb340-31" data-line-number="31">b4<span class="fl">.3</span>_<span class="dv">150</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb340-32" data-line-number="32"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb340-33" data-line-number="33"><span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>N), </a>
<a class="sourceLine" id="cb340-34" data-line-number="34">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb340-35" data-line-number="35">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb340-36" data-line-number="36">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb340-37" data-line-number="37">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb340-38" data-line-number="38">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb340-39" data-line-number="39">      <span class="dt">iter =</span> <span class="dv">28000</span>, <span class="dt">warmup =</span> <span class="dv">27000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-40" data-line-number="40">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-41" data-line-number="41">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.03_150&quot;</span>)</a>
<a class="sourceLine" id="cb340-42" data-line-number="42"></a>
<a class="sourceLine" id="cb340-43" data-line-number="43">N &lt;-<span class="st"> </span><span class="dv">352</span></a>
<a class="sourceLine" id="cb340-44" data-line-number="44"></a>
<a class="sourceLine" id="cb340-45" data-line-number="45">b4<span class="fl">.3</span>_<span class="dv">352</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb340-46" data-line-number="46"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb340-47" data-line-number="47"><span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>N), </a>
<a class="sourceLine" id="cb340-48" data-line-number="48">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb340-49" data-line-number="49">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb340-50" data-line-number="50">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb340-51" data-line-number="51">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb340-52" data-line-number="52">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb340-53" data-line-number="53">      <span class="dt">iter =</span> <span class="dv">28000</span>, <span class="dt">warmup =</span> <span class="dv">27000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-54" data-line-number="54">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb340-55" data-line-number="55">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.03_352&quot;</span>)</a></code></pre></div>
<p>I’m not going to clutter up the document with all the trace plots and coefficient summaries from these four models. But here’s how to get that information.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1"><span class="kw">plot</span>(b4<span class="fl">.3</span>_<span class="dv">010</span>)</a>
<a class="sourceLine" id="cb341-2" data-line-number="2"><span class="kw">print</span>(b4<span class="fl">.3</span>_<span class="dv">010</span>)</a>
<a class="sourceLine" id="cb341-3" data-line-number="3"></a>
<a class="sourceLine" id="cb341-4" data-line-number="4"><span class="kw">plot</span>(b4<span class="fl">.3</span>_<span class="dv">050</span>)</a>
<a class="sourceLine" id="cb341-5" data-line-number="5"><span class="kw">print</span>(b4<span class="fl">.3</span>_<span class="dv">050</span>)</a>
<a class="sourceLine" id="cb341-6" data-line-number="6"></a>
<a class="sourceLine" id="cb341-7" data-line-number="7"><span class="kw">plot</span>(b4<span class="fl">.3</span>_<span class="dv">150</span>)</a>
<a class="sourceLine" id="cb341-8" data-line-number="8"><span class="kw">print</span>(b4<span class="fl">.3</span>_<span class="dv">150</span>)</a>
<a class="sourceLine" id="cb341-9" data-line-number="9"></a>
<a class="sourceLine" id="cb341-10" data-line-number="10"><span class="kw">plot</span>(b4<span class="fl">.3</span>_<span class="dv">352</span>)</a>
<a class="sourceLine" id="cb341-11" data-line-number="11"><span class="kw">print</span>(b4<span class="fl">.3</span>_<span class="dv">352</span>)</a></code></pre></div>
<p>We’ll need to put the chains of each model into data frames.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" data-line-number="1">post010 &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>_<span class="dv">010</span>)</a>
<a class="sourceLine" id="cb342-2" data-line-number="2">post050 &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>_<span class="dv">050</span>)</a>
<a class="sourceLine" id="cb342-3" data-line-number="3">post150 &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>_<span class="dv">150</span>)</a>
<a class="sourceLine" id="cb342-4" data-line-number="4">post352 &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b4<span class="fl">.3</span>_<span class="dv">352</span>)</a></code></pre></div>
<p>Here is the code for the four individual plots.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" data-line-number="1">p1 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb343-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span>  d2[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span> , ], </a>
<a class="sourceLine" id="cb343-3" data-line-number="3">         <span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post010[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb343-5" data-line-number="5">              <span class="dt">slope     =</span> post010[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb343-6" data-line-number="6">              <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight_c),</a>
<a class="sourceLine" id="cb343-9" data-line-number="9">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;N = 10&quot;</span>)</a>
<a class="sourceLine" id="cb343-11" data-line-number="11"></a>
<a class="sourceLine" id="cb343-12" data-line-number="12">p2 &lt;-</a>
<a class="sourceLine" id="cb343-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span>  d2[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span> , ], </a>
<a class="sourceLine" id="cb343-14" data-line-number="14">         <span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post050[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb343-16" data-line-number="16">              <span class="dt">slope     =</span> post050[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb343-17" data-line-number="17">              <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-19" data-line-number="19"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight_c),</a>
<a class="sourceLine" id="cb343-20" data-line-number="20">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;N = 50&quot;</span>)</a>
<a class="sourceLine" id="cb343-22" data-line-number="22"></a>
<a class="sourceLine" id="cb343-23" data-line-number="23">p3 &lt;-</a>
<a class="sourceLine" id="cb343-24" data-line-number="24"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span>  d2[<span class="dv">1</span><span class="op">:</span><span class="dv">150</span> , ], </a>
<a class="sourceLine" id="cb343-25" data-line-number="25">         <span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post150[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb343-27" data-line-number="27">              <span class="dt">slope     =</span> post150[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb343-28" data-line-number="28">              <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-29" data-line-number="29"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-30" data-line-number="30"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight_c),</a>
<a class="sourceLine" id="cb343-31" data-line-number="31">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-32" data-line-number="32"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;N = 150&quot;</span>)</a>
<a class="sourceLine" id="cb343-33" data-line-number="33"></a>
<a class="sourceLine" id="cb343-34" data-line-number="34">p4 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb343-35" data-line-number="35"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span>  d2[<span class="dv">1</span><span class="op">:</span><span class="dv">352</span> , ], </a>
<a class="sourceLine" id="cb343-36" data-line-number="36">         <span class="kw">aes</span>(<span class="dt">x =</span> weight_c, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-37" data-line-number="37"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post352[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb343-38" data-line-number="38">              <span class="dt">slope     =</span> post352[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb343-39" data-line-number="39">              <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-40" data-line-number="40"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-41" data-line-number="41"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight_c),</a>
<a class="sourceLine" id="cb343-42" data-line-number="42">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-43" data-line-number="43"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;N = 352&quot;</span>)</a></code></pre></div>
<p>Note how we used the good old bracket syntax (e.g., <code>d2[1:10 , ]</code>) to index rows from our <code>d2</code> data. With <strong>tidyverse</strong>-style syntax, we could have done <code>slice(d2, 1:10)</code> or <code>d2 %&gt;% slice(1:10)</code> instead.</p>
<p>Now we can combine the ggplots with <strong>patchwork</strong> syntax to make the full version of Figure 4.7.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" data-line-number="1">(p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span>p4) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb344-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;weight&quot;</span>,</a>
<a class="sourceLine" id="cb344-3" data-line-number="3">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb344-4" data-line-number="4">                     <span class="dt">labels =</span> labels) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb344-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-85-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>“Notice that the cloud of regression lines grows more compact as the sample size increases. This is a result of the model growing more confident about the location of the mean” (p. 102).</p>
</div>
<div id="plotting-regression-intervals-and-contours." class="section level4">
<h4><span class="header-section-number">4.4.3.4</span> Plotting regression intervals and contours.</h4>
<p>Since we used <code>weight_c</code> to fit our model, we might first want to understand what exactly the mean value is for <code>weight</code>.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1"><span class="kw">mean</span>(d2<span class="op">$</span>weight)</a></code></pre></div>
<pre><code>## [1] 44.99049</code></pre>
<p>Just a hair under 45. If we’re interested in <span class="math inline">\(\mu\)</span> at <code>weight</code> = 50, that implies we’re also interested in <span class="math inline">\(\mu\)</span> at <code>weight_c</code> + 5.01.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" data-line-number="1">mu_at_<span class="dv">50</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb347-2" data-line-number="2"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb347-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">mu_at_50 =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_weight_c <span class="op">+</span><span class="st"> </span><span class="fl">5.01</span>)</a>
<a class="sourceLine" id="cb347-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb347-5" data-line-number="5"><span class="kw">head</span>(mu_at_<span class="dv">50</span>)</a></code></pre></div>
<pre><code>##   mu_at_50
## 1 160.5953
## 2 160.5054
## 3 160.4260
## 4 160.6467
## 5 159.9661
## 6 159.7895</code></pre>
<p>And here is a version McElreath’s Figure 4.8 density plot.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">mu_at_<span class="dv">50</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu_at_<span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb349-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb349-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb349-5" data-line-number="5"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(mu[<span class="st">&quot;height | weight = 50&quot;</span>])) <span class="op">+</span></a>
<a class="sourceLine" id="cb349-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-88-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We’ll use <code>mean_hdi()</code> to get both 89% and 95% HPDIs along with the mean.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1"><span class="kw">mean_hdi</span>(mu_at_<span class="dv">50</span>[, <span class="dv">1</span>], <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">89</span>, <span class="fl">.95</span>))</a></code></pre></div>
<pre><code>##          y     ymin     ymax .width .point .interval
## 1 160.5187 160.0604 160.9381   0.89   mean       hdi
## 2 160.5187 159.9934 161.0466   0.95   mean       hdi</code></pre>
<p>If you wanted to express those sweet 95% HPDIs on your density plot, you might use <code>tidybayes::geom_halfeyeh()</code>. Since <code>geom_halfeyeh()</code> also returns a point estimate, we’ll throw in the mode.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1">mu_at_<span class="dv">50</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb352-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mu_at_<span class="dv">50</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb352-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb352-4" data-line-number="4">                <span class="dt">fill =</span> <span class="st">&quot;royalblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb352-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb352-6" data-line-number="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(mu[<span class="st">&quot;height | weight = 50&quot;</span>])) <span class="op">+</span></a>
<a class="sourceLine" id="cb352-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<pre><code>## Warning: &#39;geom_halfeyeh&#39; is deprecated.
## Use &#39;stat_halfeye&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="04_files/figure-gfm/unnamed-chunk-90-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>With <strong>brms</strong>, you would use <code>fitted()</code> to do what McElreath accomplished with <code>link()</code>.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="kw">fitted</span>(b4<span class="fl">.3</span>, <span class="dt">summary =</span> F)</a>
<a class="sourceLine" id="cb354-2" data-line-number="2"></a>
<a class="sourceLine" id="cb354-3" data-line-number="3"><span class="kw">str</span>(mu)</a></code></pre></div>
<pre><code>##  num [1:4000, 1:352] 157 157 157 157 157 ...</code></pre>
<p>When you specify <code>summary = F</code>, <code>fitted()</code> returns a matrix of values with as many rows as there were post-warmup iterations across your HMC chains and as many columns as there were cases in your analysis. Because we had 4,000 post-warmup iterations and <span class="math inline">\(n = 352\)</span>, <code>fitted()</code> returned a matrix of 4,000 rows and 352 vectors. If you omitted the <code>summary = F</code> argument, the default is <code>TRUE</code> and <code>fitted()</code> will return summary information instead.</p>
<p>Much like <strong>rethinking</strong>’s <code>link()</code>, <code>brms::fitted()</code> can accommodate custom predictor values with its <code>newdata</code> argument.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" data-line-number="1">weight_seq &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb356-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">weight =</span> <span class="dv">25</span><span class="op">:</span><span class="dv">70</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb356-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_c =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight))</a>
<a class="sourceLine" id="cb356-4" data-line-number="4"></a>
<a class="sourceLine" id="cb356-5" data-line-number="5">mu &lt;-</a>
<a class="sourceLine" id="cb356-6" data-line-number="6"><span class="st">  </span><span class="kw">fitted</span>(b4<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb356-7" data-line-number="7">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb356-8" data-line-number="8">         <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb356-9" data-line-number="9"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb356-10" data-line-number="10"><span class="st">  </span><span class="co"># here we name the columns after the `weight` values from which they were computed</span></a>
<a class="sourceLine" id="cb356-11" data-line-number="11"><span class="st">  </span><span class="kw">set_names</span>(<span class="dv">25</span><span class="op">:</span><span class="dv">70</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb356-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>())</a></code></pre></div>
<p>Anticipating <strong>ggplot2</strong>, we went ahead and converted the output to a data frame. But we might do a little more data processing with the aid of <code>tidyr::pivot_longer()</code>, which will convert the data from the wide format to the long format. If you are new to the distinction between wide and long data, you can learn more from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html"><em>Pivot data from wide to long</em></a> vignette from the <strong>tidyverse</strong> team <span class="citation">(<em>Pivot Data from Wide to Long Pivot_longer</em>, <a href="#ref-PivotDataWide2020">2020</a>)</span>; Simon Ejdemyr’s blog post, <a href="https://sejdemyr.github.io/r-tutorials/basics/wide-and-long/"><em>Wide &amp; long data</em></a>; or Karen Grace-Martin’s blog post, <a href="https://www.theanalysisfactor.com/wide-and-long-data/"><em>The wide and long data format for repeated measures data</em></a>.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" data-line-number="1">mu &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb357-2" data-line-number="2"><span class="st">  </span>mu <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb357-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>iter,</a>
<a class="sourceLine" id="cb357-4" data-line-number="4">               <span class="dt">names_to =</span> <span class="st">&quot;weight&quot;</span>,</a>
<a class="sourceLine" id="cb357-5" data-line-number="5">               <span class="dt">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb357-6" data-line-number="6"><span class="st">  </span><span class="co"># we might reformat `weight` to numerals</span></a>
<a class="sourceLine" id="cb357-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight =</span> <span class="kw">as.numeric</span>(weight))</a>
<a class="sourceLine" id="cb357-8" data-line-number="8"></a>
<a class="sourceLine" id="cb357-9" data-line-number="9"><span class="kw">head</span>(mu)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##    iter weight height
##   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     25   137.
## 2     1     26   138.
## 3     1     27   138.
## 4     1     28   139.
## 5     1     29   140.
## 6     1     30   141.</code></pre>
<p>Now our data processing is done, here we reproduce McElreath’s Figure 4.9.a.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" data-line-number="1">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb359-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb359-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(iter <span class="op">&lt;</span><span class="st"> </span><span class="dv">101</span>),</a>
<a class="sourceLine" id="cb359-4" data-line-number="4">             <span class="dt">alpha =</span> <span class="fl">.1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-94-1.png" width="288" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1"><span class="co"># or prettied up a bit</span></a>
<a class="sourceLine" id="cb360-2" data-line-number="2">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb360-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb360-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(iter <span class="op">&lt;</span><span class="st"> </span><span class="dv">101</span>), </a>
<a class="sourceLine" id="cb360-5" data-line-number="5">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.05</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb360-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">65</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb360-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb360-8" data-line-number="8">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-94-2.png" width="288" style="display: block; margin: auto;" /></p>
<p>With <code>fitted()</code>, it’s quite easy to plot a regression line and its intervals. Just omit the <code>summary = T</code> argument.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">mu_summary &lt;-</a>
<a class="sourceLine" id="cb361-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(b4<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb361-3" data-line-number="3">         <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)</a>
<a class="sourceLine" id="cb361-6" data-line-number="6"></a>
<a class="sourceLine" id="cb361-7" data-line-number="7"><span class="kw">head</span>(mu_summary)</a></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5    Q97.5 weight  weight_c
## 1 136.5949 0.8888205 134.9290 138.4137     25 -19.99049
## 2 137.4960 0.8484359 135.8936 139.2215     26 -18.99049
## 3 138.3971 0.8082632 136.8699 140.0392     27 -17.99049
## 4 139.2981 0.7683357 137.8328 140.8514     28 -16.99049
## 5 140.1992 0.7286935 138.8041 141.6748     29 -15.99049
## 6 141.1003 0.6893861 139.7754 142.4988     30 -14.99049</code></pre>
<p>Here it is, our analogue to Figure 4.9.b.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb363-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb363-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mu_summary,</a>
<a class="sourceLine" id="cb363-4" data-line-number="4">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb363-5" data-line-number="5">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb363-6" data-line-number="6">              <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb363-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb363-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb363-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb363-10" data-line-number="10">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-96-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>if you wanted to use intervals other than the default 95% ones, you’d enter a <code>probs</code> argument like this: <code>fitted(b4.3, newdata = weight.seq, probs = c(.25, .75))</code>. The resulting third and fourth vectors from the <code>fitted()</code> object would be named <code>Q25</code> and <code>Q75</code> instead of the default <code>Q2.5</code> and <code>Q97.5</code>. The <a href="https://github.com/paul-buerkner/brms/issues/425"><code>Q</code> prefix</a> stands for quantile.</p>
<div id="rethinking-overconfident-intervals." class="section level5">
<h5><span class="header-section-number">4.4.3.4.1</span> Rethinking: Overconfident intervals.</h5>
<blockquote>
<p>The compatibility interval for the regression line in Figure 4.9 clings tightly to the MAP line. Thus there is very little uncertainty about the average height as a function of average weight. But you have to keep in mind that these inferences are always conditional on the model. Even a very bad model can have very tight compatibility intervals. It may help if you think of the regression line in Figure 4.9 as saying: <em>Conditional on the assumption that height and weight are related by a straight line, then this is the most plausible line, and these are its plausible bounds</em>. (p. 107, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="overthinking-how-link-fitted-works." class="section level5">
<h5><span class="header-section-number">4.4.3.4.2</span> Overthinking: How <del>link</del> <code>fitted()</code> works.</h5>
<p>Similar to <code>rethinking::link()</code>, <code>brms::fitted()</code> uses the formula from your model to compute the model expectations for a given set of predictor values. I use it a lot in this project. If you follow along, you’ll get a good handle on it. But to dive deeper, you can go <a href="https://www.rdocumentation.org/packages/brms/versions/0.6.0/topics/fitted.brmsfit">here</a> for the documentation.</p>
</div>
</div>
<div id="prediction-intervals." class="section level4">
<h4><span class="header-section-number">4.4.3.5</span> Prediction intervals.</h4>
<p>Even though our full statistical model (omitting priors for the sake of simplicity) is</p>
<p><span class="math display">\[\text{height}_i \sim \operatorname{Normal}(\mu_i = \alpha + \beta x_, \sigma),\]</span></p>
<p>we’ve only been plotting the <span class="math inline">\(\mu\)</span> part. In order to bring in the variability expressed by <span class="math inline">\(\sigma\)</span>, we’ll have to switch to the <code>predict()</code> function. Much as <code>brms::fitted()</code> was our analogue to <code>rethinking::link()</code>, <code>brms::predict()</code> is our analogue to <code>rethinking::sim()</code>.</p>
<p>We can reuse our <code>weight_seq</code> data from before. But in case you forgot, here’s that code again.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" data-line-number="1">weight_seq &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb364-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">weight =</span> <span class="dv">25</span><span class="op">:</span><span class="dv">70</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb364-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_c =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight))</a></code></pre></div>
<p>The <code>predict()</code> code looks a lot like what we used for <code>fitted()</code>.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1">pred_height &lt;-</a>
<a class="sourceLine" id="cb365-2" data-line-number="2"><span class="st">  </span><span class="kw">predict</span>(b4<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb365-3" data-line-number="3">          <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb365-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb365-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)</a>
<a class="sourceLine" id="cb365-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb365-7" data-line-number="7">pred_height <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb365-8" data-line-number="8"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a></code></pre></div>
<pre><code>##   Estimate Est.Error     Q2.5    Q97.5 weight  weight_c
## 1 136.6068  5.104287 126.6582 146.5048     25 -19.99049
## 2 137.3620  5.243447 127.0573 147.5435     26 -18.99049
## 3 138.3175  5.178013 127.8296 148.1751     27 -17.99049
## 4 139.2898  5.205640 129.1539 149.6666     28 -16.99049
## 5 140.1875  5.181564 130.1367 150.3700     29 -15.99049
## 6 141.0460  5.148812 131.0539 151.0445     30 -14.99049</code></pre>
<p>This time the summary information in our data frame is for, as McElreath put it, “simulated heights, not distributions of plausible average height, <span class="math inline">\(\mu\)</span>” (p. 108). Another way of saying that is that these simulations are the joint consequence of both <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, unlike the results of <code>fitted()</code>, which only reflect <span class="math inline">\(\mu\)</span>. Our plot for Figure 4.8:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1">d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb367-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb367-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> pred_height, </a>
<a class="sourceLine" id="cb367-4" data-line-number="4">              <span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb367-5" data-line-number="5">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb367-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mu_summary,</a>
<a class="sourceLine" id="cb367-7" data-line-number="7">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb367-8" data-line-number="8">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb367-9" data-line-number="9">              <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb367-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb367-11" data-line-number="11">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb367-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight),</a>
<a class="sourceLine" id="cb367-13" data-line-number="13">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb367-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb367-15" data-line-number="15">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-99-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Notice that the outline for the wide shaded interval is a little rough. This is the simulation variance in the tails of the sampled Gaussian values. If it really bothers you, increase the number of samples you take from the posterior distribution. (p. 109)</p>
</blockquote>
<p>With our <strong>brms</strong> model fitting approach, that would mean we’d have to refit <code>b4.3</code> after specifying a larger number of post-warmup iterations with alterations to the <code>iter</code> and <code>warmup</code> parameters.</p>
<div id="overthinking-rolling-your-own-sim-predict." class="section level5">
<h5><span class="header-section-number">4.4.3.5.1</span> Overthinking: Rolling your own <del>sim</del> <code>predict()</code>.</h5>
<p>Here we follow McElreath’s example and do our model-based predictions by hand. Instead of relying on base <strong>R</strong> <code>apply()</code> and <code>sapply()</code>, here the main action is in <code>expand()</code>, the second <code>mutate()</code> line and the <code>group_by()</code> + <code>summarise()</code> combination.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1"><span class="co"># `predict()` by hand</span></a>
<a class="sourceLine" id="cb368-2" data-line-number="2">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-3" data-line-number="3"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(b_Intercept, b_weight_c, sigma),</a>
<a class="sourceLine" id="cb368-4" data-line-number="4">         <span class="dt">weight =</span> <span class="dv">25</span><span class="op">:</span><span class="dv">70</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_c =</span> weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d2<span class="op">$</span>weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sim_height =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb368-7" data-line-number="7">                            <span class="dt">mean =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_weight_c <span class="op">*</span><span class="st"> </span>weight_c,</a>
<a class="sourceLine" id="cb368-8" data-line-number="8">                            <span class="dt">sd   =</span> sigma)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(weight) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-10" data-line-number="10"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(sim_height),</a>
<a class="sourceLine" id="cb368-11" data-line-number="11">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(sim_height, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb368-12" data-line-number="12">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(sim_height, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb368-14" data-line-number="14"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb368-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb368-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">ymin =</span> ll, <span class="dt">ymax =</span> ul),</a>
<a class="sourceLine" id="cb368-17" data-line-number="17">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb368-18" data-line-number="18">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb368-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d2,</a>
<a class="sourceLine" id="cb368-20" data-line-number="20">             <span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb368-21" data-line-number="21">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb368-22" data-line-number="22"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d2<span class="op">$</span>weight),</a>
<a class="sourceLine" id="cb368-23" data-line-number="23">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d2<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb368-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb368-25" data-line-number="25">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-100-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We specifically left out the <code>fitted()</code> intervals to make it more apparent what we were simulating. You might also note that we could have easily replaced that three-line <code>summarise()</code> code with a single line of <code>tidybayes::mean_qi(sim_height)</code>, or whatever combination of central tendency and interval type you wanted (e.g., <code>mode_hdi(sim_height, .width = .89)</code>).</p>
</div>
</div>
</div>
</div>
<div id="curves-from-lines" class="section level2">
<h2><span class="header-section-number">4.5</span> Curves from lines</h2>
<p>“The models so far all assume that a straight line describes the relationship. But there’s nothing special about straight lines, aside from their simplicity” (p. 110).</p>
<div id="polynomial-regression" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Polynomial regression</h3>
<p>Remember <code>d</code>?</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb369-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 544
## Columns: 4
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.8300, 149.2250, 168.9100, 14…
## $ weight &lt;dbl&gt; 47.82561, 36.48581, 31.86484, 53.04191, 41.27687, 62.99259, 38.24348, 55.47997, 34…
## $ age    &lt;dbl&gt; 63.0, 63.0, 65.0, 41.0, 51.0, 35.0, 32.0, 27.0, 19.0, 54.0, 47.0, 66.0, 73.0, 20.0…
## $ male   &lt;int&gt; 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0…</code></pre>
<p>McElreath suggested we plot <code>height</code> against <code>weight</code> using the full sample.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb371-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb371-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb371-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb371-5" data-line-number="5">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-102-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Those variables two appear to follow an orderly relation, but whatever it is, it’s clearly not a simple straight line. The quadratic model is probably the most commonly used polynomial regression model. It follows the generic form</p>
<p><span class="math display">\[\mu = \alpha + \beta_1 x_i + \beta_2 x_i^2.\]</span></p>
<p>McElreath warned: “Fitting these models to data is easy. Interpreting them can be hard” (p. 111). Standardizing will help <code>brm()</code> fit the model. We might standardize our <code>weight</code> variable like so.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb372-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb372-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_s  =</span> (weight <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(weight)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb372-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_s2 =</span> weight_s<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
<p>While we were at it, we just went ahead and computed the <code>weight_s2</code> variable. We can express our statistical model as</p>
<p><span class="math display">\[\begin{align*}
\text{height}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta_1 \text{weight_s}_i + \beta_2 \text{weight_s}^2_i \\
\alpha &amp; \sim \operatorname{Normal}(178, 20) \\
\beta_1 &amp; \sim \operatorname{Log-Normal}(0, 1) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 1) \\
\sigma &amp; \sim \operatorname{Uniform}(0, 50).
\end{align*}\]</span></p>
<p>Here’s how we might fit the quadratic model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1">b4<span class="fl">.5</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb373-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb373-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb373-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_s <span class="op">+</span><span class="st"> </span>weight_s2,</a>
<a class="sourceLine" id="cb373-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb373-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</a>
<a class="sourceLine" id="cb373-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</a>
<a class="sourceLine" id="cb373-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb373-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">30000</span>, <span class="dt">warmup =</span> <span class="dv">29000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb373-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb373-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.05&quot;</span>)</a></code></pre></div>
<p>Note our use of the <code>coef</code> argument within our prior statements. Since <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are both parameters of <code>class = b</code> within the brms set-up, we need to use the <code>coef</code> argument in cases when we want their priors to differ.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" data-line-number="1"><span class="kw">plot</span>(b4<span class="fl">.5</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-105-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1"><span class="kw">print</span>(b4<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + weight_s + weight_s2 
##    Data: d (Number of observations: 544) 
## Samples: 4 chains, each with iter = 30000; warmup = 29000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   146.05      0.37   145.32   146.76 1.00     1374     2170
## weight_s     21.74      0.29    21.20    22.32 1.00     1745     1966
## weight_s2    -7.80      0.27    -8.33    -7.29 1.01      815     1290
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     5.81      0.18     5.47     6.18 1.00     2916     2507
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our quadratic plot requires new <code>fitted()</code>- and <code>predict()</code>-oriented wrangling.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1">weight_seq &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb377-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">weight_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="fl">2.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb377-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_s2 =</span> weight_s<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb377-4" data-line-number="4"></a>
<a class="sourceLine" id="cb377-5" data-line-number="5">fitd_quad &lt;-</a>
<a class="sourceLine" id="cb377-6" data-line-number="6"><span class="st">  </span><span class="kw">fitted</span>(b4<span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb377-7" data-line-number="7">         <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb377-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb377-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)</a>
<a class="sourceLine" id="cb377-10" data-line-number="10"></a>
<a class="sourceLine" id="cb377-11" data-line-number="11">pred_quad &lt;-</a>
<a class="sourceLine" id="cb377-12" data-line-number="12"><span class="st">  </span><span class="kw">predict</span>(b4<span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb377-13" data-line-number="13">          <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb377-14" data-line-number="14"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb377-15" data-line-number="15"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)  </a></code></pre></div>
<p>Behold the code for our version of Figure 4.11.b.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb378-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb378-3" data-line-number="3">       <span class="kw">aes</span>(<span class="dt">x =</span> weight_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> pred_quad, </a>
<a class="sourceLine" id="cb378-5" data-line-number="5">              <span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb378-6" data-line-number="6">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> fitd_quad,</a>
<a class="sourceLine" id="cb378-8" data-line-number="8">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb378-9" data-line-number="9">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb378-10" data-line-number="10">              <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb378-12" data-line-number="12">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;quadratic&quot;</span>,</a>
<a class="sourceLine" id="cb378-14" data-line-number="14">       <span class="dt">y =</span> <span class="st">&quot;height&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>weight_s),</a>
<a class="sourceLine" id="cb378-16" data-line-number="16">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb378-18" data-line-number="18">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb378-19" data-line-number="19"></a>
<a class="sourceLine" id="cb378-20" data-line-number="20">p2</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-107-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>From a formula perspective, the cubic model is a simple extenstion of the quadratic:</p>
<p><span class="math display">\[\mu = \alpha + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3.\]</span></p>
<p>Before we fit the model, we need to wrangle the data again.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb379-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb379-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_s3 =</span> weight_s<span class="op">^</span><span class="dv">3</span>)</a></code></pre></div>
<p>Now fit the model like so.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" data-line-number="1">b4<span class="fl">.6</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb380-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb380-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb380-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_s <span class="op">+</span><span class="st"> </span>weight_s2 <span class="op">+</span><span class="st"> </span>weight_s3,</a>
<a class="sourceLine" id="cb380-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb380-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</a>
<a class="sourceLine" id="cb380-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</a>
<a class="sourceLine" id="cb380-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s3&quot;</span>),</a>
<a class="sourceLine" id="cb380-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb380-10" data-line-number="10">      <span class="dt">iter =</span> <span class="dv">40000</span>, <span class="dt">warmup =</span> <span class="dv">39000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb380-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb380-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.06&quot;</span>)</a></code></pre></div>
<p>And now we’ll fit the good old linear model.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" data-line-number="1">b4<span class="fl">.7</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb381-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb381-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb381-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>weight_s,</a>
<a class="sourceLine" id="cb381-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb381-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</a>
<a class="sourceLine" id="cb381-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb381-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">40000</span>, <span class="dt">warmup =</span> <span class="dv">39000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb381-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb381-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.07&quot;</span>)</a></code></pre></div>
<p>Here’s the <code>fitted()</code>, <code>predict()</code>, and <strong>ggplot2</strong> code for Figure 4.9.c, the cubic model.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" data-line-number="1">weight_seq &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb382-2" data-line-number="2"><span class="st">  </span>weight_seq <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb382-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_s3 =</span> weight_s<span class="op">^</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb382-4" data-line-number="4"></a>
<a class="sourceLine" id="cb382-5" data-line-number="5">fitd_cub &lt;-</a>
<a class="sourceLine" id="cb382-6" data-line-number="6"><span class="st">  </span><span class="kw">fitted</span>(b4<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb382-7" data-line-number="7">         <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-8" data-line-number="8"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)</a>
<a class="sourceLine" id="cb382-10" data-line-number="10"></a>
<a class="sourceLine" id="cb382-11" data-line-number="11">pred_cub &lt;-</a>
<a class="sourceLine" id="cb382-12" data-line-number="12"><span class="st">  </span><span class="kw">predict</span>(b4<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb382-13" data-line-number="13">          <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-14" data-line-number="14"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb382-15" data-line-number="15"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq) </a>
<a class="sourceLine" id="cb382-16" data-line-number="16"></a>
<a class="sourceLine" id="cb382-17" data-line-number="17">p3 &lt;-</a>
<a class="sourceLine" id="cb382-18" data-line-number="18"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb382-19" data-line-number="19">       <span class="kw">aes</span>(<span class="dt">x =</span> weight_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> pred_cub, </a>
<a class="sourceLine" id="cb382-21" data-line-number="21">              <span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb382-22" data-line-number="22">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> fitd_cub,</a>
<a class="sourceLine" id="cb382-24" data-line-number="24">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb382-25" data-line-number="25">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb382-26" data-line-number="26">              <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb382-28" data-line-number="28">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-29" data-line-number="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;cubic&quot;</span>,</a>
<a class="sourceLine" id="cb382-30" data-line-number="30">       <span class="dt">y =</span> <span class="st">&quot;height&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-31" data-line-number="31"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>weight_s),</a>
<a class="sourceLine" id="cb382-32" data-line-number="32">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb382-33" data-line-number="33"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb382-34" data-line-number="34">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb382-35" data-line-number="35"></a>
<a class="sourceLine" id="cb382-36" data-line-number="36">p3</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-111-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>And here’s the <code>fitted()</code>, <code>predict()</code>, and <strong>ggplot2</strong> code for Figure 4.9.a, the linear model.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" data-line-number="1">fitd_line &lt;-</a>
<a class="sourceLine" id="cb383-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(b4<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb383-3" data-line-number="3">         <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb383-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb383-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq)</a>
<a class="sourceLine" id="cb383-6" data-line-number="6"></a>
<a class="sourceLine" id="cb383-7" data-line-number="7">pred_line &lt;-</a>
<a class="sourceLine" id="cb383-8" data-line-number="8"><span class="st">  </span><span class="kw">predict</span>(b4<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb383-9" data-line-number="9">          <span class="dt">newdata =</span> weight_seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb383-10" data-line-number="10"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb383-11" data-line-number="11"><span class="st">  </span><span class="kw">bind_cols</span>(weight_seq) </a>
<a class="sourceLine" id="cb383-12" data-line-number="12"></a>
<a class="sourceLine" id="cb383-13" data-line-number="13">p1 &lt;-</a>
<a class="sourceLine" id="cb383-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb383-15" data-line-number="15">       <span class="kw">aes</span>(<span class="dt">x =</span> weight_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> pred_line, </a>
<a class="sourceLine" id="cb383-17" data-line-number="17">              <span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb383-18" data-line-number="18">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> fitd_line,</a>
<a class="sourceLine" id="cb383-20" data-line-number="20">              <span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb383-21" data-line-number="21">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb383-22" data-line-number="22">              <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb383-24" data-line-number="24">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-25" data-line-number="25"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;linear&quot;</span>,</a>
<a class="sourceLine" id="cb383-26" data-line-number="26">       <span class="dt">y =</span> <span class="st">&quot;height&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-27" data-line-number="27"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>weight_s),</a>
<a class="sourceLine" id="cb383-28" data-line-number="28">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>height)) <span class="op">+</span></a>
<a class="sourceLine" id="cb383-29" data-line-number="29"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb383-30" data-line-number="30">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb383-31" data-line-number="31"></a>
<a class="sourceLine" id="cb383-32" data-line-number="32">p1</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-112-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Did you notice how we labeled each of the past three plots as <code>p1</code>, <code>p2</code>, and <code>p3</code>? Here we use those names to plot them all together with <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" data-line-number="1">p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-113-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As fun as this all has been,</p>
<blockquote>
<p>it’s not clear that any of these models make a lot of sense. They are good geocentric descriptions of the sample, yes. But there are two problems. First, a better fit to the sample might not actually be a better model. That’s the subject of Chapter 7. Second, the model contains no biological information. We aren’t learning any causal relationship between height and weight. We’ll deal with this second problem much later, in Chapter 16. (p. 113)</p>
</blockquote>
<div id="overthinking-converting-back-to-natural-scale." class="section level5">
<h5><span class="header-section-number">4.5.1.0.1</span> Overthinking: Converting back to natural scale.</h5>
<p>You can apply McElreath’s conversion trick within the <strong>ggplot2</strong> environment, too. Here it is with the cubic model.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1">at &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb385-2" data-line-number="2"></a>
<a class="sourceLine" id="cb385-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb385-4" data-line-number="4">       <span class="kw">aes</span>(<span class="dt">x =</span> weight_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> pred_cub, </a>
<a class="sourceLine" id="cb385-6" data-line-number="6">              <span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb385-7" data-line-number="7">              <span class="dt">fill =</span> <span class="st">&quot;grey83&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> height),</a>
<a class="sourceLine" id="cb385-9" data-line-number="9">             <span class="dt">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>weight_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Times&quot;</span>),</a>
<a class="sourceLine" id="cb385-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb385-14" data-line-number="14"><span class="st">  </span><span class="co"># here it is!</span></a>
<a class="sourceLine" id="cb385-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;standardized weight converted back&quot;</span>,</a>
<a class="sourceLine" id="cb385-16" data-line-number="16">                     <span class="dt">breaks =</span> at,</a>
<a class="sourceLine" id="cb385-17" data-line-number="17">                     <span class="dt">labels =</span> <span class="kw">round</span>(at<span class="op">*</span><span class="kw">sd</span>(d<span class="op">$</span>weight) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>weight), <span class="dv">1</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-114-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="splines." class="section level3">
<h3><span class="header-section-number">4.5.2</span> Splines.</h3>
<p>Load the <code>cherry_blossoms</code> data.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb386-2" data-line-number="2"></a>
<a class="sourceLine" id="cb386-3" data-line-number="3"><span class="kw">data</span>(cherry_blossoms)</a>
<a class="sourceLine" id="cb386-4" data-line-number="4">d &lt;-<span class="st"> </span>cherry_blossoms</a>
<a class="sourceLine" id="cb386-5" data-line-number="5"><span class="kw">rm</span>(cherry_blossoms)</a></code></pre></div>
<p>Minus the mini histograms, here is ourground-up <strong>tidyverse</strong> way to summarize our new <code>d</code> data the way McElreath did with his <code>precis()</code>.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb387-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb387-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb387-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb387-5" data-line-number="5">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb387-6" data-line-number="6">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.055</span>, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb387-7" data-line-number="7">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.945</span>, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb387-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   key           mean     sd     ll      ul
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 doy         105.     6.41  94.4   115   
## 2 temp          6.14   0.66   5.15    7.29
## 3 temp_lower    5.1    0.85   3.79    6.37
## 4 temp_upper    7.19   0.99   5.9     8.9 
## 5 year       1408    351.   868.   1948.</code></pre>
<p>McElreath encouraged us to plot <code>doy</code> against <code>year</code>.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb389-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb389-3" data-line-number="3"><span class="st">  </span><span class="co"># color from here: https://www.colorhexa.com/ffb7c5</span></a>
<a class="sourceLine" id="cb389-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb389-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb389-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb389-7" data-line-number="7">        <span class="co"># color from here: https://www.colordic.org/w/, inspired by https://chichacha.netlify.com/2018/11/29/plotting-traditional-colours-of-japan/</span></a>
<a class="sourceLine" id="cb389-8" data-line-number="8">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-117-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>It looks like there are some wiggly trends, but it’s hard to tell with a scatter plot.</p>
<blockquote>
<p>Our goal is to approximate the blossom trend with a wiggly function. With B-splines, just like with polynomial regression, we do this by generating new predictor variables and using those in the linear model, <span class="math inline">\(\mu_i\)</span>. Unlike polynomial regression, B-splines do not directly transform the predictor by squaring or cubing it. Instead they invent a series of entirely new, synthetic predictor variables. Each of these synthetic variables exists only to gradually turn a specific parameter on and off within a specific range of the real predictor variable. Each of the synthetic variables is called a <strong>basis function</strong>. The linear model ends up looking very familiar:</p>
<p><span class="math display">\[\mu_i = \alpha + w_1 B_{i, 1} + w_2 B_{i, 2} + w_3 B_{i, 3} + ...\]</span></p>
<p>where <span class="math inline">\(B_{i,n}\)</span> is the <span class="math inline">\(n\)</span>-th basis function’s value on row <span class="math inline">\(i\)</span>, and the <span class="math inline">\(w\)</span> parameters are corresponding weights for each. The parameters act like slopes, adjusting the influence of each basis function on the mean <span class="math inline">\(\mu_i\)</span>. So really this is just another linear regression, but with some fancy, synthetic predictor variables.</p>
</blockquote>
<p>It turns out there are cases with missing data for the <code>doy</code> variable.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb390-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(<span class="kw">is.na</span>(doy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb390-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   `is.na(doy)`     n percent
##   &lt;lgl&gt;        &lt;int&gt;   &lt;dbl&gt;
## 1 FALSE          827    68.1
## 2 TRUE           388    31.9</code></pre>
<p>Let’s follow McElreath and make a subset of the data that excludes cases with missing data in <code>doy</code>. Within the <strong>tidyverse</strong>, we might do so with the <code>tidyr::drop_na()</code> function.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1">d2 &lt;-</a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb392-3" data-line-number="3"><span class="st">  </span><span class="kw">drop_na</span>(doy)</a></code></pre></div>
<p>In the text, McElreath indirectly explained how to make Figure 4.12 by walking through the workflow for making Figure 4.13. Here we mimic that ordering.</p>
<blockquote>
<p>First, we choose the knots. Remember, the knots are just values of year that serve as pivots for our spline. Where should the knots go? There are different ways to answer this question. You can, in principle, put the knots wherever you like. Their locations are part of the model, and you are responsible for them. Let’s do what we did in the simple example above, place the knots at different evenly-spaced quantiles of the predictor variable. This gives you more knots where there are more observations. We used only 5 knots in the first example. Now let’s go for 15: (p. 117)</p>
</blockquote>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1">num_knots &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb393-2" data-line-number="2">knot_list &lt;-<span class="st"> </span><span class="kw">quantile</span>(d2<span class="op">$</span>year, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> num_knots))</a></code></pre></div>
<p>Our <code>knot_list</code> contains 15 <code>year</code> values.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1">knot_list</a></code></pre></div>
<pre><code>##        0% 7.142857% 14.28571% 21.42857% 28.57143% 35.71429% 42.85714%       50% 57.14286% 64.28571% 
##       812      1036      1174      1269      1377      1454      1518      1583      1650      1714 
## 71.42857% 78.57143% 85.71429% 92.85714%      100% 
##      1774      1833      1893      1956      2015</code></pre>
<p>Here’s what it looks like if we use those <code>knot_list</code> values to chop up our <code>year</code>/<code>doy</code> scatter plot, from above.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb396-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb396-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb396-7" data-line-number="7">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-122-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The next choice is polynomial degree. This determines how basis functions combine,
which determines how the parameters interact to produce the spline. For degree 1, as in Figure 4.12, two basis functions combine at each point. For degree 2, three functions combine at each point. For degree 3, four combine. R already has a nice function that will build basis functions for any list of knots and degree. This code will construct the necessary basis functions for a degree 3 (cubic) spline: (p. 117)</p>
</blockquote>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1"><span class="kw">library</span>(splines)</a>
<a class="sourceLine" id="cb397-2" data-line-number="2"></a>
<a class="sourceLine" id="cb397-3" data-line-number="3">B &lt;-<span class="st"> </span><span class="kw">bs</span>(d2<span class="op">$</span>year,</a>
<a class="sourceLine" id="cb397-4" data-line-number="4">        <span class="dt">knots =</span> knot_list[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, num_knots)], </a>
<a class="sourceLine" id="cb397-5" data-line-number="5">        <span class="dt">degree =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb397-6" data-line-number="6">        <span class="dt">intercept =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Look closely at McElreath’s tricky <code>knot_list[-c(1, num_knots)]</code> code. Whereas <code>knot_list</code> contains 15 ordered <code>year</code> values, McElreath shaved off the first and last <code>year</code> values with <code>knot_list[-c(1, num_knots)]</code>, leaving 13. This is because, by default, the <code>bs()</code> function places knots at the boundaries. Since the first and 15<sup>th</sup> values in <code>knot_list</code> were boundary values for <code>year</code>, we removed them to avoid redundancies. We can confirm this with the code, below.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1">B <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  &#39;bs&#39; num [1:827, 1:17] 1 0.96 0.767 0.563 0.545 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:17] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  - attr(*, &quot;degree&quot;)= int 3
##  - attr(*, &quot;knots&quot;)= Named num [1:13] 1036 1174 1269 1377 1454 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:13] &quot;7.142857%&quot; &quot;14.28571%&quot; &quot;21.42857%&quot; &quot;28.57143%&quot; ...
##  - attr(*, &quot;Boundary.knots&quot;)= int [1:2] 812 2015
##  - attr(*, &quot;intercept&quot;)= logi TRUE</code></pre>
<p>Look at the second to last line, <code>- attr(*, &quot;Boundary.knots&quot;)= int [1:2] 812 2015</code>. Those defualt <code>&quot;Boundary.knots&quot;</code> are the same as <code>knot_list[c(1, num_knots)]</code>. Let’s confirm.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1">knot_list[<span class="kw">c</span>(<span class="dv">1</span>, num_knots)]</a></code></pre></div>
<pre><code>##   0% 100% 
##  812 2015</code></pre>
<p>By the <code>degree = 3</code> argument, we indicated we wanted a cubic spline. McElreath used <code>degree = 1</code> for Figure 4.12. For reasons I’m not prepared to get into, here, splines don’t always include intercept parameters. Indeed, the <code>bs()</code> default is <code>intercept = FALSE</code>. McElreath’s code indicated he wanted to fit a B-spline that included an intercept. Thus: <code>intercept = TRUE</code>.</p>
<p>Here’s how we might make our version of the top panel of Figure 4.13.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1"><span class="co"># wrangle a bit</span></a>
<a class="sourceLine" id="cb402-2" data-line-number="2">b &lt;-</a>
<a class="sourceLine" id="cb402-3" data-line-number="3"><span class="st">  </span>B <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb402-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb402-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="op">:</span><span class="dv">17</span>) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb402-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb402-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>year,</a>
<a class="sourceLine" id="cb402-8" data-line-number="8">               <span class="dt">names_to =</span> <span class="st">&quot;bias_function&quot;</span>,</a>
<a class="sourceLine" id="cb402-9" data-line-number="9">               <span class="dt">values_to =</span> <span class="st">&quot;bias&quot;</span>)</a>
<a class="sourceLine" id="cb402-10" data-line-number="10"></a>
<a class="sourceLine" id="cb402-11" data-line-number="11"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb402-12" data-line-number="12">b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb402-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> bias, <span class="dt">group =</span> bias_function)) <span class="op">+</span></a>
<a class="sourceLine" id="cb402-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb402-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb402-16" data-line-number="16"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;bias value&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb402-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb402-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb402-19" data-line-number="19">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-126-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In order two elucidate what’s going on in that plot, we might breaks it up with <code>facet_wrap()</code>.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1">b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb403-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bias_function =</span> <span class="kw">str_c</span>(<span class="st">&quot;bias function &quot;</span>, bias_function)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb403-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb403-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> bias)) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;bias value&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb403-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb403-10" data-line-number="10">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb403-11" data-line-number="11">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">alpha</span>(<span class="st">&quot;#ffb7c5&quot;</span>, <span class="fl">.25</span>), <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb403-12" data-line-number="12">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>bias_function, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-127-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We have come to a point in the text where we need to address a difficulty in the aim of this project. We’re trying to translate McElreath’s <strong>rethinking</strong> and base <strong>R</strong> code into a more <strong>brms</strong>/<strong>tidyverse</strong> oriented workflow. It’s usually quite feasible to switch out the data manipulation and plotting steps from base <strong>R</strong> to their <strong>tidyverse</strong> counterparts. As for the statistical modeling part, <strong>rethinking</strong> and <strong>brms</strong> both function as user-friendly interfaces with the <a href="https://mc-stan.org/">Stan probabilistic programming language</a> <span class="citation">(Carpenter et al., <a href="#ref-carpenterStanProbabilisticProgramming2017">2017</a>)</span> and they share a lot of overlap in their functionality <span class="citation">(for a somewhat outdated comparison, see Bürkner, <a href="#ref-burknerBrmsPackageBayesian2017">2017</a>)</span>. But they differ in important ways, too. For example, <strong>brms</strong> was not designed to fit models with the quadratic approximation the way McElreath can with <code>rethinking::quap()</code>. That’s why we just jumped right to using HMC. This section in the book reveals another important difference. Whereas McElreath showcased the use of B-splines with functionality based on the <strong>splines</strong> package, which <a href="https://www.rdocumentation.org/packages/splines/versions/3.6.2">is a part of base <strong>R</strong></a>, <strong>brms</strong> offers spines and other smoothing approaches using functions for the <a href="https://CRAN.R-project.org/package=mgcv"><strong>mgcv</strong> package</a> <span class="citation">(Wood, <a href="#ref-mgcv2003">2003</a>, <a href="#ref-mgcv2004">2004</a>, <a href="#ref-mgcv2011">2011</a>, <a href="#ref-mgcv2017">2017</a><a href="#ref-mgcv2017">b</a>, <a href="#ref-R-mgcv">2019</a>; Wood et al., <a href="#ref-mgcv2016">2016</a>)</span>.</p>
<p>Another important detail concerns how <strong>brms</strong> implements splines. From the “Splines” subsection of the <code>set_prior</code> section of the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(Bürkner, <a href="#ref-brms2020RM">2020</a><a href="#ref-brms2020RM">g</a>, p. 181)</span>, we read: “Splines are implemented in brms using the ‘random effects’ formulation.” As we are many chapters before McElreath introduces us to exciting world of random effects, the main point to get here is that <strong>brms</strong> does not implement splines like <strong>rethinking</strong> does. In the grand scheme of things, this is all fine. I like it that different packages afford us different options. But in the short term, this is going to break up our flow. Although we will retain our <strong>tidyverse</strong>-oriented workflow, we are going to fit the B-spline models in this section using <strong>rethinking</strong>. At the end of the chapter, we’ll fit them again with <strong>brms</strong> and talk a little bit about the differences.</p>
<blockquote>
<p>Now to get the parameter weights for each basis function, we need to actually define the model and make it run. The model is just a linear regression. The synthetic basis functions do all the work. We’ll use each column of the matrix <code>B</code> as a variable. We’ll also have an intercept to capture the average blossom day. This will make it easier to define priors on the basis weights, because then we can just conceive of each as a deviation from the intercept. (p. 117)</p>
</blockquote>
<p>That last line is another indication for why we set <code>intercept = TRUE</code>. Our model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{day in year}_i &amp; \sim \operatorname{Normal} (\mu_i, \sigma) \\
\mu_i  &amp; = \alpha + \sum_{k=1}^K w_k B_{k, i} \\
\alpha &amp; \sim \operatorname{Normal}(100, 100) \\
w_j    &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma &amp; \sim \operatorname{Exponential}(1),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the intercept, <span class="math inline">\(B_{k, i}\)</span> is the value of the <span class="math inline">\(k^\text{th}\)</span> bias function on the <span class="math inline">\(i^\text{th}\)</span> row of the data, and <span class="math inline">\(w_k\)</span> is the estimated weight for the corresponding <span class="math inline">\(k^\text{th}\)</span> bias function.</p>
<p>Throughout this chapter, I’ve griped a bit about using the uniform prior for <span class="math inline">\(\sigma\)</span>. Now that McElreath has introduced the exponential distribution as an alternative, those gripes are coming to an end. The exponential distribution is controlled by a single parameter, <span class="math inline">\(\lambda\)</span>, which is also called the rate. As it turns out, the mean of the exponential distribution is the inverse of the rate, <span class="math inline">\(1 / \lambda\)</span>. Here we use the <code>dexp()</code> function to get a sense of what that prior looks like.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">10</span>, <span class="dt">by =</span> <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb404-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d =</span> <span class="kw">dexp</span>(x, <span class="dt">rate =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb404-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb404-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;#ffb7c5&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb404-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb404-9" data-line-number="9">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-128-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>“We’ll use exponential priors for the rest of the book, in place of uniform priors. It is much more common to have a sense of the average deviation than of the maximum” (p. 119). 🎉</p>
<p>Fit the model with <code>quap()</code>.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">m4<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </a>
<a class="sourceLine" id="cb405-2" data-line-number="2">  <span class="kw">alist</span>(</a>
<a class="sourceLine" id="cb405-3" data-line-number="3">    D <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>( mu , sigma ), </a>
<a class="sourceLine" id="cb405-4" data-line-number="4">    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>B <span class="op">%*%</span><span class="st"> </span>w ,</a>
<a class="sourceLine" id="cb405-5" data-line-number="5">    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb405-6" data-line-number="6">    w <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb405-7" data-line-number="7">    sigma <span class="op">~</span><span class="st"> </span><span class="kw">dexp</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb405-8" data-line-number="8">  ), </a>
<a class="sourceLine" id="cb405-9" data-line-number="9">  <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">D =</span> d2<span class="op">$</span>doy, <span class="dt">B =</span> B), </a>
<a class="sourceLine" id="cb405-10" data-line-number="10">  <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">w =</span> <span class="kw">rep</span>(<span class="dv">0</span> , <span class="kw">ncol</span>(B)))</a>
<a class="sourceLine" id="cb405-11" data-line-number="11">)</a></code></pre></div>
<p>Here’s the summary.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" data-line-number="1"><span class="kw">precis</span>(m4<span class="fl">.7</span>, <span class="dt">depth =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##              mean        sd         5.5%       94.5%
## w[1]   -3.0223065 3.8612264  -9.19329205   3.1486791
## w[2]   -0.8295790 3.8702041  -7.01491271   5.3557547
## w[3]   -1.0551066 3.5849748  -6.78458875   4.6743756
## w[4]    4.8428591 2.8771359   0.24464025   9.4410780
## w[5]   -0.8354712 2.8743468  -5.42923252   3.7582901
## w[6]    4.3232726 2.9148726  -0.33525674   8.9818019
## w[7]   -5.3182854 2.8002253  -9.79358631  -0.8429845
## w[8]    7.8447491 2.8020891   3.36646957  12.3230287
## w[9]   -1.0004227 2.8810576  -5.60490917   3.6040638
## w[10]   3.0350274 2.9101224  -1.61591028   7.6859651
## w[11]   4.6668117 2.8917333   0.04526331   9.2883600
## w[12]  -0.1506611 2.8694256  -4.73655746   4.4352352
## w[13]   5.5622918 2.8874399   0.94760513  10.1769784
## w[14]   0.7148680 2.9993348  -4.07864826   5.5083843
## w[15]  -0.8014034 3.2935320  -6.06510371   4.4622969
## w[16]  -6.9640761 3.3758008 -12.35925786  -1.5688944
## w[17]  -7.6657809 3.2227746 -12.81639707  -2.5151647
## a     103.3479036 2.3697262  99.56062351 107.1351838
## sigma   5.8767128 0.1437594   5.64695757   6.1064680</code></pre>
<p>The weights are indexed as <code>w[1]</code> through <code>w[17]</code>. McElreath’s comments are in line with the general consensus on spline modes: the parameter estimates are very difficult to interpret directly. It’s often easier to just plot the results. First we’ll use <code>extract.samples()</code>.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">extract.samples</span>(m4<span class="fl">.7</span>)</a>
<a class="sourceLine" id="cb408-2" data-line-number="2"></a>
<a class="sourceLine" id="cb408-3" data-line-number="3"><span class="kw">glimpse</span>(post)</a></code></pre></div>
<pre><code>## List of 3
##  $ a    : num [1:10000] 103 102 102 102 105 ...
##  $ sigma: num [1:10000] 6.1 5.83 5.98 5.91 6.01 ...
##  $ w    : num [1:10000, 1:17] -7.57 -7.96 3.83 -5.08 -2.16 ...
##  - attr(*, &quot;source&quot;)= chr &quot;quap posterior: 10000 samples from m4.7&quot;</code></pre>
<p>With a little wrangling, we can use summary information from <code>post</code> to make our version of the middle panel of Figure 4.13.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" data-line-number="1"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb410-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">bias_function =</span> <span class="kw">c</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="op">:</span><span class="dv">17</span>),</a>
<a class="sourceLine" id="cb410-3" data-line-number="3">       <span class="dt">weight        =</span> <span class="kw">apply</span>(post<span class="op">$</span>w, <span class="dv">2</span>, mean)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-4" data-line-number="4"><span class="st">  </span><span class="kw">full_join</span>(b, <span class="dt">by =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb410-6" data-line-number="6"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb410-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> bias <span class="op">*</span><span class="st"> </span>weight, <span class="dt">group =</span> bias_function)) <span class="op">+</span></a>
<a class="sourceLine" id="cb410-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb410-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb410-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb410-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb410-12" data-line-number="12">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-132-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In case you missed it, the main action in the <strong>ggplot2</strong> code was <code>y = bias * weight</code>, where we defined the <span class="math inline">\(y\)</span>-axis as the produce of <code>bias</code> and <code>weight</code>. This is fulfillment of the <span class="math inline">\(w_k B_{k, i}\)</span> parts of the model. Now here’s how we might make the lower plot of Figure 4.13.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="kw">link</span>(m4<span class="fl">.7</span>)</a>
<a class="sourceLine" id="cb411-2" data-line-number="2"></a>
<a class="sourceLine" id="cb411-3" data-line-number="3"><span class="kw">apply</span>(mu, <span class="dv">2</span>, PI, <span class="fl">.95</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-4" data-line-number="4"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-6" data-line-number="6"><span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year, doy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb411-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">precis</span>(m4<span class="fl">.7</span>)[<span class="st">&quot;a&quot;</span>, <span class="st">&quot;mean&quot;</span>], <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-14" data-line-number="14"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;day in year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb411-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb411-17" data-line-number="17">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-133-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>If it wasn’t clear, the dashed horizontal line intersecting a little above 100 on the <span class="math inline">\(y\)</span>-axis is the poster mean for the <span class="math inline">\(\alpha\)</span> parameter. Here’s how to pull that value with <code>precis()</code>.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" data-line-number="1"><span class="kw">precis</span>(m4<span class="fl">.7</span>)[<span class="st">&quot;a&quot;</span>, <span class="st">&quot;mean&quot;</span>]</a></code></pre></div>
<pre><code>## [1] 103.3479</code></pre>
<p>Now let’s use our skills to remake the simpler model expressed in Figure 4.12. This model, recall, is based on 5 knots.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1">num_knots &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb414-2" data-line-number="2">knot_list &lt;-<span class="st"> </span><span class="kw">quantile</span>(d2<span class="op">$</span>year, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> num_knots))</a>
<a class="sourceLine" id="cb414-3" data-line-number="3"></a>
<a class="sourceLine" id="cb414-4" data-line-number="4">B &lt;-<span class="st"> </span><span class="kw">bs</span>(d2<span class="op">$</span>year,</a>
<a class="sourceLine" id="cb414-5" data-line-number="5">        <span class="dt">knots =</span> knot_list[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, num_knots)], </a>
<a class="sourceLine" id="cb414-6" data-line-number="6">        <span class="co"># this makes the splines liner rater than cubic</span></a>
<a class="sourceLine" id="cb414-7" data-line-number="7">        <span class="dt">degree =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb414-8" data-line-number="8">        <span class="dt">intercept =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb414-9" data-line-number="9"></a>
<a class="sourceLine" id="cb414-10" data-line-number="10">m4<span class="fl">.8</span> &lt;-<span class="st"> </span><span class="kw">quap</span>( </a>
<a class="sourceLine" id="cb414-11" data-line-number="11">  <span class="kw">alist</span>(</a>
<a class="sourceLine" id="cb414-12" data-line-number="12">    D <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>( mu , sigma ), </a>
<a class="sourceLine" id="cb414-13" data-line-number="13">    mu &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>B <span class="op">%*%</span><span class="st"> </span>w ,</a>
<a class="sourceLine" id="cb414-14" data-line-number="14">    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb414-15" data-line-number="15">    w <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb414-16" data-line-number="16">    sigma <span class="op">~</span><span class="st"> </span><span class="kw">dexp</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb414-17" data-line-number="17">  ), </a>
<a class="sourceLine" id="cb414-18" data-line-number="18">  <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">D =</span> d2<span class="op">$</span>doy, <span class="dt">B =</span> B), </a>
<a class="sourceLine" id="cb414-19" data-line-number="19">  <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">w =</span> <span class="kw">rep</span>(<span class="dv">0</span> , <span class="kw">ncol</span>(B)))</a>
<a class="sourceLine" id="cb414-20" data-line-number="20">)</a></code></pre></div>
<p>Review the new model summary.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" data-line-number="1"><span class="kw">precis</span>(m4<span class="fl">.8</span>, <span class="dt">depth =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##               mean        sd       5.5%      94.5%
## w[1]    0.05879552 4.1767912  -6.616523   6.734115
## w[2]    1.88611487 4.1285489  -4.712104   8.484333
## w[3]    1.95580292 4.1146957  -4.620275   8.531881
## w[4]    4.38040968 4.1232164  -2.209286  10.970106
## w[5]   -5.19726417 4.1415049 -11.816189   1.421661
## a     103.07263790 4.0880168  96.539198 109.606078
## sigma   6.06919262 0.1484185   5.831991   6.306394</code></pre>
<p>Here we do all the work to make and save the three subplots for Figure 4.12 in bulk.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1"><span class="co"># wrangle a bit</span></a>
<a class="sourceLine" id="cb417-2" data-line-number="2">b &lt;-</a>
<a class="sourceLine" id="cb417-3" data-line-number="3"><span class="st">  </span>B <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb417-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>year,</a>
<a class="sourceLine" id="cb417-8" data-line-number="8">               <span class="dt">names_to =</span> <span class="st">&quot;bias_function&quot;</span>,</a>
<a class="sourceLine" id="cb417-9" data-line-number="9">               <span class="dt">values_to =</span> <span class="st">&quot;bias&quot;</span>)</a>
<a class="sourceLine" id="cb417-10" data-line-number="10"></a>
<a class="sourceLine" id="cb417-11" data-line-number="11"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb417-12" data-line-number="12">p1 &lt;-</a>
<a class="sourceLine" id="cb417-13" data-line-number="13"><span class="st">  </span>b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> bias, <span class="dt">group =</span> bias_function)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-18" data-line-number="18"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;bias value&quot;</span>)</a>
<a class="sourceLine" id="cb417-19" data-line-number="19"></a>
<a class="sourceLine" id="cb417-20" data-line-number="20">post &lt;-<span class="st"> </span><span class="kw">extract.samples</span>(m4<span class="fl">.8</span>)</a>
<a class="sourceLine" id="cb417-21" data-line-number="21"></a>
<a class="sourceLine" id="cb417-22" data-line-number="22">p2 &lt;-</a>
<a class="sourceLine" id="cb417-23" data-line-number="23"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">bias_function =</span> <span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb417-24" data-line-number="24">       <span class="dt">weight        =</span> <span class="kw">apply</span>(post<span class="op">$</span>w, <span class="dv">2</span>, mean)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-25" data-line-number="25"><span class="st">  </span><span class="kw">full_join</span>(b, <span class="dt">by =</span> <span class="st">&quot;bias_function&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-26" data-line-number="26"><span class="st">  </span></a>
<a class="sourceLine" id="cb417-27" data-line-number="27"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> bias <span class="op">*</span><span class="st"> </span>weight, <span class="dt">group =</span> bias_function)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-28" data-line-number="28"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-29" data-line-number="29"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-30" data-line-number="30"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb417-31" data-line-number="31"></a>
<a class="sourceLine" id="cb417-32" data-line-number="32">p3 &lt;-</a>
<a class="sourceLine" id="cb417-33" data-line-number="33"><span class="st">  </span><span class="kw">link</span>(m4<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-34" data-line-number="34"><span class="st">  </span><span class="kw">apply</span>(<span class="dv">2</span>, PI, <span class="fl">.95</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-35" data-line-number="35"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-36" data-line-number="36"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-37" data-line-number="37"><span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;lower&quot;</span>, <span class="st">&quot;upper&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-38" data-line-number="38"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year, doy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb417-39" data-line-number="39"><span class="st">  </span></a>
<a class="sourceLine" id="cb417-40" data-line-number="40"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-41" data-line-number="41"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> knot_list, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-42" data-line-number="42"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">precis</span>(m4<span class="fl">.8</span>)[<span class="st">&quot;a&quot;</span>, <span class="st">&quot;mean&quot;</span>], <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-43" data-line-number="43"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-44" data-line-number="44"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-45" data-line-number="45"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;day in year&quot;</span>)</a></code></pre></div>
<p>Now combine the subplots with <strong>patchwork</strong> syntax and plot.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1">(p1 <span class="op">/</span><span class="st"> </span>p2 <span class="op">/</span><span class="st"> </span>p3) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb418-2" data-line-number="2"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>),</a>
<a class="sourceLine" id="cb418-4" data-line-number="4">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-138-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="smooth-functions-for-a-rough-world." class="section level3">
<h3><span class="header-section-number">4.5.3</span> Smooth functions for a rough world.</h3>
<blockquote>
<p>The splines in the previous section are just the beginning. A entire class of models, <strong>generalized additive models</strong> (GAMs), focuses on predicting an outcome variable using smooth functions of some predictor variables. The topic is deep enough to deserve its own book. (p. 120, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>McElreath ended that block quote with a reference to his endnote #78. On page 562, we read: “A very popular and comprehensive text is Wood <span class="citation">(<a href="#ref-woodGeneralizedAdditiveModels2017">2017</a><a href="#ref-woodGeneralizedAdditiveModels2017">a</a>)</span>.” Simon Wood, as it turns out, is the author/maintainer of the <strong>mgcv</strong> package.</p>
</div>
</div>
<div id="summary-b-splines-with-brms" class="section level2">
<h2><span class="header-section-number">4.6</span> <del>Summary</del> B-splines with <strong>brms</strong></h2>
<p>It’s convenient for use how McElreath ended that last section with a reference to Simon Wood’s work because <strong>brms</strong>, recall, employs his <strong>mgcv</strong> package for computing smooths, of which B-splines are a special case. The two smooth functions <strong>brms</strong> imports from <strong>mgcv</strong> are <code>s()</code> and <code>t2()</code>. We’ll be using <code>s()</code>. We might use the <code>brms::get_prior()</code> function to get a sense of how to set up the priors when using <code>s()</code>.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">data =</span> d2,</a>
<a class="sourceLine" id="cb419-2" data-line-number="2">          <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb419-3" data-line-number="3">          doy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(year))</a></code></pre></div>
<pre><code>##                    prior     class    coef group resp dpar nlpar bound
## 1                                b                                    
## 2                                b syear_1                            
## 3 student_t(3, 105, 5.9) Intercept                                    
## 4   student_t(3, 0, 5.9)       sds                                    
## 5                              sds s(year)                            
## 6   student_t(3, 0, 5.9)     sigma</code></pre>
<p>We have an overall intercept (<code>class = Intercept</code>), a single <span class="math inline">\(\beta\)</span> parameter for <code>year</code> (<code>class = b</code>), a <span class="math inline">\(\sigma\)</span> parameter (<code>class = sigma</code>), and an unfamiliar parameter of <code>class = sds</code>. I’m not going to go into that last parameter in any detail, here. We’ll need to work our way up through Chapter 13 and the multilevel model to get a full picture of what it means. The important thing to note here is that the priors for our <strong>brms</strong> version of McElreath’s <code>m4.7</code> are going to be a little different. Here’s how we might fit our <strong>brms</strong>-based <code>b4.8</code>.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1">b4<span class="fl">.8</span> &lt;-</a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2,</a>
<a class="sourceLine" id="cb421-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb421-4" data-line-number="4">      doy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(year),</a>
<a class="sourceLine" id="cb421-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb421-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb421-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sds),</a>
<a class="sourceLine" id="cb421-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb421-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb421-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb421-11" data-line-number="11">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</a>
<a class="sourceLine" id="cb421-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.08&quot;</span>)</a></code></pre></div>
<p>Check out the model summary.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1"><span class="kw">print</span>(b4<span class="fl">.8</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + s(year) 
##    Data: d2 (Number of observations: 827) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Smooth Terms: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sds(syear_1)    24.21      8.01    12.80    44.45 1.00     1127     1568
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   104.54      0.21   104.12   104.96 1.00     5568     2703
## syear_1      -9.58      9.32   -27.95     9.27 1.00     3458     2435
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     6.04      0.15     5.76     6.33 1.00     4512     2931
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our intercept and <span class="math inline">\(\sigma\)</span> summaries are similar to those we get from <code>rethinking::precis(m4.7)</code>. But the rest is a bit different. Here’s what happens when we use <code>brms::fitted()</code> to plot the implications of the model.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1"><span class="kw">fitted</span>(b4<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year, doy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb424-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">fixef</span>(b4<span class="fl">.8</span>)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;b4.7 useing s(year)&quot;</span>,</a>
<a class="sourceLine" id="cb424-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb424-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb424-13" data-line-number="13">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-141-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The smooth isn’t quite the same as when we used <strong>rethinking</strong>. Hopefully this isn’t terribly surprising. We used different packages and a different underlying statistical model. One of the reasons is we didn’t even use a B-spline. The default for <code>s()</code> is to use what’s called a thin plate regression spline. If we’d like to fit a B-spline, we have to set <code>bs = bs</code>. Here’s an example.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1">b4<span class="fl">.8</span>_bs &lt;-</a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d2,</a>
<a class="sourceLine" id="cb425-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb425-4" data-line-number="4">      doy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(year, <span class="dt">bs =</span> <span class="st">&quot;bs&quot;</span>),</a>
<a class="sourceLine" id="cb425-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb425-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb425-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sds),</a>
<a class="sourceLine" id="cb425-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb425-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb425-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb425-11" data-line-number="11">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.999</span>),</a>
<a class="sourceLine" id="cb425-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/b04.08_bs&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1"><span class="kw">print</span>(b4<span class="fl">.8</span>_bs)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: doy ~ 1 + s(year, bs = &quot;bs&quot;) 
##    Data: d2 (Number of observations: 827) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Smooth Terms: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sds(syear_1)     3.29      1.45     1.45     7.02 1.01     1001     1418
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   104.54      0.21   104.12   104.95 1.00     3552     2750
## syear_1      -1.20      1.67    -4.86     1.96 1.00     1685     1832
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     6.03      0.15     5.73     6.33 1.00     3286     2525
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now here’s the depiction of our <strong>brms</strong>-based B-spline model.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1"><span class="kw">fitted</span>(b4<span class="fl">.8</span>_bs) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb428-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb428-3" data-line-number="3"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">select</span>(d2, year, doy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb428-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb428-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> doy, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">fixef</span>(b4<span class="fl">.8</span>_bs)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;#ffb7c5&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&#39;b4.7_bs useing s(year, bs = &quot;bs&quot;)&#39;</span>,</a>
<a class="sourceLine" id="cb428-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb428-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb428-13" data-line-number="13">        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#4f455c&quot;</span>))</a></code></pre></div>
<p><img src="04_files/figure-gfm/unnamed-chunk-143-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>This model differs from both <code>m4.7</code> and <code>b4.8</code>. There are still other important differences between the underlying statistical model for <code>b4.8_bs</code> and McElreath’s <code>m4.7</code> that I’m just not going to go into, here. However, this may well change in future updates to this ebook. In the meantime, you might check out the <a href="https://discourse.mc-stan.org/t/setting-custom-knots-with-a-b-spline-bs-bs/15380">Setting custom knots with a B-spline (bs = “bs”)</a> thread on the Stan Forums or the recent blog post by the great <a href="https://twitter.com/ucfagls">Gavin Simpson</a>, <a href="https://fromthebottomoftheheap.net/2020/06/03/extrapolating-with-gams/"><em>Extrapolating with B splines and GAMs</em></a>. Also, for a nice high-level introduction to the models you can fit with <strong>mgcv</strong>, check out the nice talk by <a href="https://twitter.com/noamross">Noam Ross</a>, <a href="https://www.youtube.com/watch?v=q4_t8jXcQgc"><em>Nonlinear models in R: The wonderful world of mgcv</em></a>.</p>
</div>
<div id="session-info-3" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] splines   parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] rethinking_2.01      tidybayes_2.1.1      brms_2.13.0          Rcpp_1.0.4.6        
##  [5] dagitty_0.2-2        rstan_2.19.3         StanHeaders_2.21.0-1 patchwork_1.0.0     
##  [9] forcats_0.5.0        stringr_1.4.0        dplyr_0.8.5          purrr_0.3.4         
## [13] readr_1.3.1          tidyr_1.0.2          tibble_3.0.1         ggplot2_3.3.1       
## [17] tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] TH.data_1.0-10       colorspace_1.4-1     ellipsis_0.3.1       ggridges_0.5.2      
##   [5] rsconnect_0.8.16     estimability_1.3     markdown_1.1         base64enc_0.1-3     
##   [9] fs_1.4.1             rstudioapi_0.11      farver_2.0.3         svUnit_1.0.3        
##  [13] DT_0.13              fansi_0.4.1          mvtnorm_1.1-0        lubridate_1.7.8     
##  [17] xml2_1.3.1           codetools_0.2-16     bridgesampling_1.0-0 knitr_1.28          
##  [21] shinythemes_1.1.2    bayesplot_1.7.1      jsonlite_1.6.1       broom_0.5.5         
##  [25] dbplyr_1.4.2         ggdist_2.1.1         shiny_1.4.0.2        compiler_3.6.3      
##  [29] httr_1.4.1           emmeans_1.4.5        backports_1.1.7      assertthat_0.2.1    
##  [33] Matrix_1.2-18        fastmap_1.0.1        cli_2.0.2            later_1.0.0         
##  [37] htmltools_0.4.0      prettyunits_1.1.1    tools_3.6.3          igraph_1.2.5        
##  [41] coda_0.19-3          gtable_0.3.0         glue_1.4.1           reshape2_1.4.4      
##  [45] V8_3.0.2             cellranger_1.1.0     vctrs_0.3.1          nlme_3.1-144        
##  [49] crosstalk_1.1.0.1    xfun_0.13            ps_1.3.3             rvest_0.3.5         
##  [53] miniUI_0.1.1.1       mime_0.9             lifecycle_0.2.0      gtools_3.8.2        
##  [57] MASS_7.3-51.5        zoo_1.8-7            scales_1.1.1         colourpicker_1.0    
##  [61] hms_0.5.3            promises_1.1.0       Brobdingnag_1.2-6    sandwich_2.5-1      
##  [65] inline_0.3.15        shinystan_2.5.0      yaml_2.2.1           curl_4.3            
##  [69] gridExtra_2.3        loo_2.2.0            stringi_1.4.6        dygraphs_1.1.1.6    
##  [73] boot_1.3-24          pkgbuild_1.0.8       shape_1.4.4          rlang_0.4.6         
##  [77] pkgconfig_2.0.3      matrixStats_0.56.0   HDInterval_0.2.0     evaluate_0.14       
##  [81] lattice_0.20-38      rstantools_2.0.0     htmlwidgets_1.5.1    labeling_0.3        
##  [85] processx_3.4.2       tidyselect_1.0.0     plyr_1.8.6           magrittr_1.5        
##  [89] bookdown_0.18        R6_2.4.1             generics_0.0.2       multcomp_1.4-13     
##  [93] DBI_1.1.0            mgcv_1.8-31          pillar_1.4.4         haven_2.2.0         
##  [97] withr_2.2.0          xts_0.12-0           survival_3.1-12      abind_1.4-5         
## [101] modelr_0.1.6         crayon_1.3.4         arrayhelpers_1.1-0   utf8_1.1.4          
## [105] rmarkdown_2.1        emo_0.0.0.9000       isoband_0.2.1        grid_3.6.3          
## [109] readxl_1.3.1         callr_3.4.3          threejs_0.3.3        reprex_0.3.0        
## [113] digest_0.6.25        xtable_1.8-4         httpuv_1.5.2         stats4_3.6.3        
## [117] munsell_0.5.0        viridisLite_0.3.0    shinyjs_1.1</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-burknerBrmsPackageBayesian2017">
<p>Bürkner, P.-C. (2017). brms: An R package for Bayesian multilevel models using Stan. <em>Journal of Statistical Software</em>, <em>80</em>(1), 1–28. <a href="https://doi.org/10.18637/jss.v080.i01">https://doi.org/10.18637/jss.v080.i01</a></p>
</div>
<div id="ref-brms2020RM">
<p>Bürkner, P.-C. (2020g). <em>brms reference manual, Version 2.12.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a></p>
</div>
<div id="ref-carpenterStanProbabilisticProgramming2017">
<p>Carpenter, B., Gelman, A., Hoffman, M. D., Lee, D., Goodrich, B., Betancourt, M., Brubaker, M., Guo, J., Li, P., &amp; Riddell, A. (2017). Stan: A probabilistic programming language. <em>Journal of Statistical Software</em>, <em>76</em>(1). <a href="https://doi.org/10.18637/jss.v076.i01">https://doi.org/10.18637/jss.v076.i01</a></p>
</div>
<div id="ref-howell2001demography">
<p>Howell, N. (2001). <em>Demography of the dobe! Kung</em> (2nd Edition). Routledge. <a href="https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490">https://www.routledge.com/Demography-of-the-Dobe-Kung/Howell/p/book/9780202306490</a></p>
</div>
<div id="ref-howell2010life">
<p>Howell, N. (2010). <em>Life histories of the Dobe! Kung: Food, fatness, and well-being over the life span</em> (Vol. 4). Univ of California Press. <a href="https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung">https://www.ucpress.edu/book/9780520262348/life-histories-of-the-dobe-kung</a></p>
</div>
<div id="ref-kruschkeDoingBayesianData2015">
<p>Kruschke, J. K. (2015). <em>Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan</em>. Academic Press. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a></p>
</div>
<div id="ref-kurzDoingBayesianData2020">
<p>Kurz, A. S. (2020b). <em>Doing Bayesian data analysis in brms and the tidyverse</em> (version 0.2.0). <a href="https://bookdown.org/content/3686/">https://bookdown.org/content/3686/</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020a). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-R-rethinking">
<p>McElreath, R. (2020b). <em>rethinking R package</em>. <a href="https://xcelab.net/rm/software/">https://xcelab.net/rm/software/</a></p>
</div>
<div id="ref-pengProgrammingDataScience2019">
<p>Peng, R. D. (2019). <em>R programming for data science</em>. <a href="https://bookdown.org/rdpeng/rprogdatascience/">https://bookdown.org/rdpeng/rprogdatascience/</a></p>
</div>
<div id="ref-PivotDataWide2020">
<p><em>Pivot data from wide to long pivot_longer</em>. (2020). <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">https://tidyr.tidyverse.org/reference/pivot_longer.html</a></p>
</div>
<div id="ref-R-MASS">
<p>Ripley, B. (2019). <em>MASS: Support functions and datasets for venables and ripley’s MASS</em>. <a href="https://CRAN.R-project.org/package=MASS">https://CRAN.R-project.org/package=MASS</a></p>
</div>
<div id="ref-simmonsFalsepositivePsychologyUndisclosed2011">
<p>Simmons, J. P., Nelson, L. D., &amp; Simonsohn, U. (2011). False-positive psychology: Undisclosed flexibility in data collection and analysis allows presenting anything as significant. <em>Psychological Science</em>, <em>22</em>(11), 1359–1366. <a href="https://doi.org/10.1177/0956797611417632">https://doi.org/10.1177/0956797611417632</a></p>
</div>
<div id="ref-standevelopmentteamRStanInterfaceStan2020">
<p>Stan Development Team. (2020a). <em>RStan: The R interface to Stan</em>. <a href="https://cran.r-project.org/web/packages/rstan/vignettes/rstan.html">https://cran.r-project.org/web/packages/rstan/vignettes/rstan.html</a></p>
</div>
<div id="ref-MASS2002">
<p>Venables, W. N., &amp; Ripley, B. D. (2002). <em>Modern applied statistics with S</em> (Fourth). Springer. <a href="http://www.stats.ox.ac.uk/pub/MASS4">http://www.stats.ox.ac.uk/pub/MASS4</a></p>
</div>
<div id="ref-woodGeneralizedAdditiveModels2017">
<p>Wood, S. N. (2017a). <em>Generalized additive models: An introduction with R</em> (Second Edition). CRC Press. <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331">https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331</a></p>
</div>
<div id="ref-mgcv2003">
<p>Wood, S. N. (2003). Thin-plate regression splines. <em>Journal of the Royal Statistical Society (B)</em>, <em>65</em>(1), 95–114. <a href="https://doi.org/10.1111/1467-9868.00374">https://doi.org/10.1111/1467-9868.00374</a></p>
</div>
<div id="ref-mgcv2004">
<p>Wood, S. N. (2004). Stable and efficient multiple smoothing parameter estimation for generalized additive models. <em>Journal of the American Statistical Association</em>, <em>99</em>(467), 673–686. <a href="https://doi.org/10.1198/016214504000000980">https://doi.org/10.1198/016214504000000980</a></p>
</div>
<div id="ref-mgcv2011">
<p>Wood, S. N. (2011). Fast stable restricted maximum likelihood and marginal likelihood estimation of semiparametric generalized linear models. <em>Journal of the Royal Statistical Society (B)</em>, <em>73</em>(1), 3–36. <a href="https://doi.org/10.1111/j.1467-9868.2010.00749.x">https://doi.org/10.1111/j.1467-9868.2010.00749.x</a></p>
</div>
<div id="ref-mgcv2017">
<p>Wood, S. N. (2017b). <em>Generalized additive models: An introduction with r</em> (Second). Chapman and Hall/CRC. <a href="https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331?utm_source=crcpress.com\&amp;utm_medium=referral">https://www.routledge.com/Generalized-Additive-Models-An-Introduction-with-R-Second-Edition/Wood/p/book/9781498728331?utm_source=crcpress.com\&amp;utm_medium=referral</a></p>
</div>
<div id="ref-R-mgcv">
<p>Wood, S. N. (2019). <em>mgcv: Mixed GAM computation vehicle with automatic smoothness estimation</em>. <a href="https://CRAN.R-project.org/package=mgcv">https://CRAN.R-project.org/package=mgcv</a></p>
</div>
<div id="ref-mgcv2016">
<p>Wood, S. N., Pya, N., &amp; Säfken, B. (2016). Smoothing parameter and model selection for general smooth models (with discussion). <em>Journal of the American Statistical Association</em>, <em>111</em>, 1548–1575. <a href="https://doi.org/10.1080/01621459.2016.1180986">https://doi.org/10.1080/01621459.2016.1180986</a></p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>In the first edition of his text, McElreath started out with the uniform prior for <span class="math inline">\(\sigma\)</span> and transitioned to the half Cauchy when he introduced HMC in Chapter 8. In this edition, he largely replaced the half Cauchy with the exponential distribution. Both are fine. If you’d like to learn more about the half Cauchy, you might check out <a href="https://bookdown.org/content/3890/markov-chain-monte-carlo.html#taming-a-wild-chain.">Section 8.4.3.1</a> of my <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2020">2020</a><a href="#ref-kurzStatisticalRethinkingBrms2020">a</a>)</span> translation of his first edition.<a href="geocentric-models.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sampling-the-imaginary.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-many-variables-the-spurious-waffles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
