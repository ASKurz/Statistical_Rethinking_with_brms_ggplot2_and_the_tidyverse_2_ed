<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 The Many Variables &amp; The Spurious Waffles | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5 The Many Variables &amp; The Spurious Waffles | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 The Many Variables &amp; The Spurious Waffles | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-06-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="geocentric-models.html"/>
<link rel="next" href="the-haunted-dag-the-causal-terror.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a><ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a><ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-b-splines-with-brms"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> B-splines with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a><ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.3</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a><ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a><ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a><ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a><ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a><ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a><ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a><ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summarybonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del>Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a><ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction."><i class="fa fa-check"></i><b>8.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a><ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.1</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>9.4.2</b> Estimation.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a><ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a><ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a><ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-many-variables-the-spurious-waffles" class="section level1">
<h1><span class="header-section-number">5</span> The Many Variables &amp; The Spurious Waffles</h1>
<blockquote>
<p>Because correlation in general is not surprising. In large data sets, every pair of variables has a statistically discernible non-zero correlation. But since most correlations do not indicate causal relationships, we need tools for distinguishing mere association from evidence of causation. This is why so much effort is devoted to <strong>multiple regression</strong>, using more than one predictor variable to simultaneously model an outcome. <span class="citation">(McElreath, <a href="#ref-mcelreathStatisticalRethinkingBayesian2020">2020</a><a href="#ref-mcelreathStatisticalRethinkingBayesian2020">a</a>, p. 124, <strong>emphasis</strong> in the original)</span></p>
</blockquote>
<p>In his endnote #80 (p. 562), McElreath wrote: “See <span class="citation">Meehl (<a href="#ref-meehlWhySummariesResearch1990">1990</a>)</span>, in particular the ‘crud factor’ described on page 204.” For a fun look at some dubious correlations, check out the examples at <a href="https://www.tylervigen.com/spurious-correlations">https://www.tylervigen.com/spurious-correlations</a>.</p>
<p>But back to the text, McElreath’s listed reasons for multivaraiable regression include:</p>
<ul>
<li>statistical control for confounds</li>
<li>multiple/complex causation</li>
<li>interactions</li>
</ul>
<p>We’ll approach the first two in this chapter. Interactions are reserved for Chapter 7.</p>
<div id="rethinking-causal-inference." class="section level4">
<h4><span class="header-section-number">5.0.0.1</span> Rethinking: Causal inference.</h4>
<p>“Despite its central importance, there is no unified approach to causal inference yet in the sciences or in statistics” (p. 124). To dip into the topic, you might check out the recent blog post by Finn Lattimore and David Rohde, <a href="https://gradientinstitute.org/blog/6/"><em>Causal inference with Bayes rule</em></a>.</p>
</div>
<div id="spurious-associations" class="section level2">
<h2><span class="header-section-number">5.1</span> Spurious associations</h2>
<p>Load the <a href="https://www.snopes.com/fact-check/fema-waffle-house-index/">Waffle House</a> data.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb431-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb431-3" data-line-number="3"></a>
<a class="sourceLine" id="cb431-4" data-line-number="4"><span class="kw">data</span>(WaffleDivorce)</a>
<a class="sourceLine" id="cb431-5" data-line-number="5">d &lt;-<span class="st"> </span>WaffleDivorce</a></code></pre></div>
<p>Standardize the focal variables.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb432-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb432-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d =</span> <span class="kw">standardize</span>(Divorce),</a>
<a class="sourceLine" id="cb432-4" data-line-number="4">         <span class="dt">m =</span> <span class="kw">standardize</span>(Marriage),</a>
<a class="sourceLine" id="cb432-5" data-line-number="5">         <span class="dt">a =</span> <span class="kw">standardize</span>(MedianAgeMarriage))</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong> and, while we’re at it, the <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1"><span class="kw">rm</span>(WaffleDivorce)</a>
<a class="sourceLine" id="cb433-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb433-3" data-line-number="3"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb433-4" data-line-number="4"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>I’m not going to show the output, but you might go ahead and investigate the data with the typical functions. E.g.,</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1"><span class="kw">head</span>(d)</a>
<a class="sourceLine" id="cb434-2" data-line-number="2"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<p>Now we have our data, we can reproduce Figure 5.1. One convenient way to get the handful of sate labels into the plot was with the <code>geom_text_repel()</code> function from the <a href="https://CRAN.R-project.org/package=ggrepel"><strong>ggrepel</strong> package</a> <span class="citation">(Slowikowski, <a href="#ref-R-ggrepel">2020</a>)</span>. But first, we spent the last few chapters warming up with <strong>ggplot2</strong>. Going forward, each chapter will have its own plot theme. In this chapter, we’ll characterize the plots with <code>theme_bw() + theme(panel.grid = element_rect())</code> and coloring based off of <code>&quot;firebrick&quot;</code>.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1"><span class="co"># install.packages(&quot;ggrepel&quot;, depencencies = T)</span></a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb435-3" data-line-number="3"></a>
<a class="sourceLine" id="cb435-4" data-line-number="4">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> WaffleHouses<span class="op">/</span>Population, <span class="dt">y =</span> Divorce)) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb435-7" data-line-number="7">              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ME&quot;</span>, <span class="st">&quot;OK&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;AL&quot;</span>, <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;NJ&quot;</span>)),  </a>
<a class="sourceLine" id="cb435-10" data-line-number="10">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb435-11" data-line-number="11">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">1042</span>) <span class="op">+</span><span class="st">  </span><span class="co"># this makes it reproducible</span></a>
<a class="sourceLine" id="cb435-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Waffle Houses per million&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">55</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-13" data-line-number="13"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb435-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb435-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-6-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Since these are geographically-based data, we might plot our three major variables in a map format. The <a href="https://github.com/UrbanInstitute/urbnmapr"><strong>urbnmapr</strong> package</a> <span class="citation">(Urban Institute, <a href="#ref-R-urbnmapr">2020</a>)</span> provides latitude and longitude data for the 50 states and the <code>geom_sf()</code> function for plotting them. We’ll use the <code>left_join()</code> function to combine those data with our primary data <code>d</code>.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1"><span class="co"># devtools::install_github(&quot;UrbanInstitute/urbnmapr&quot;)</span></a>
<a class="sourceLine" id="cb436-2" data-line-number="2"><span class="kw">library</span>(urbnmapr)</a>
<a class="sourceLine" id="cb436-3" data-line-number="3"></a>
<a class="sourceLine" id="cb436-4" data-line-number="4"><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb436-5" data-line-number="5">  <span class="co"># get the map data</span></a>
<a class="sourceLine" id="cb436-6" data-line-number="6">  <span class="kw">get_urbn_map</span>(<span class="dt">map =</span> <span class="st">&quot;states&quot;</span>, <span class="dt">sf =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb436-7" data-line-number="7">  <span class="co"># add the primary data</span></a>
<a class="sourceLine" id="cb436-8" data-line-number="8">  d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb436-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">state_name =</span> Location <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb436-10" data-line-number="10"><span class="st">    </span><span class="kw">select</span>(d<span class="op">:</span>a, state_name),</a>
<a class="sourceLine" id="cb436-11" data-line-number="11">  <span class="dt">by =</span> <span class="st">&quot;state_name&quot;</span></a>
<a class="sourceLine" id="cb436-12" data-line-number="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb436-13" data-line-number="13"><span class="st">  </span><span class="co"># convert to the long format for faceting</span></a>
<a class="sourceLine" id="cb436-14" data-line-number="14"><span class="st">  </span><span class="kw">pivot_longer</span>(d<span class="op">:</span>a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb436-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb436-16" data-line-number="16"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb436-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb436-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value, <span class="dt">geometry =</span> geometry),</a>
<a class="sourceLine" id="cb436-19" data-line-number="19">          <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;#f8eaea&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb436-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb436-23" data-line-number="23">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">0</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb436-24" data-line-number="24"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>One of the advantages of this visualization method is it just became clear that Nevada is missing from the WaffleDivorce data. Execute <code>d %&gt;% distinct(Location)</code> to see for yourself and click <a href="https://github.com/rmcelreath/rethinking/issues/62">here</a> to find out why it’s missing. Those missing data should motivate the skills we’ll cover in Chapter 15. But let’s get back on track.</p>
<p>Here’s the standard deviation for <code>MedianAgeMarriage</code> in its current metric.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1"><span class="kw">sd</span>(d<span class="op">$</span>MedianAgeMarriage)</a></code></pre></div>
<pre><code>## [1] 1.24363</code></pre>
<p>Our first statistical model follows the form</p>
<p><span class="math display">\[
\begin{align*}
\text{divorce_std}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{median_age_at_marriage_std}_i \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1),
\end{align*}
\]</span></p>
<p>where the <code>_std</code> suffix indicates the variables are standardized (i.e., zero centered, with a standard deviation of one). Let’s fit the first univariable model.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1">b5<span class="fl">.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb439-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb439-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb439-4" data-line-number="4">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb439-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb439-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb439-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb439-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb439-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb439-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb439-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.01&quot;</span>)</a></code></pre></div>
<p>Did you notice the <code>sample_prior = T</code> line? This told <strong>brms</strong> to take draws from both the posterior distribution (as usual) and from the prior predictive distribution. If you look at McElreath’s <strong>R</strong> code 5.4, you’ll see he plotted 50 draws from the prior predictive distribution of his <code>m5.1</code>. For our <strong>brms</strong> workflow, our first step is the extract our prior draws with <code>prior_samples()</code>.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">prior &lt;-<span class="st"> </span><span class="kw">prior_samples</span>(b5<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb440-2" data-line-number="2"></a>
<a class="sourceLine" id="cb440-3" data-line-number="3">prior <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 4,000
## Columns: 3
## $ Intercept &lt;dbl&gt; 0.262235852, 0.435592131, -0.294742095, -0.007232040, 0.058308258, 0.050358902,…
## $ b         &lt;dbl&gt; 0.01116464, -0.18996254, 0.43071360, -0.60435682, -0.31401810, 0.22439532, -0.0…
## $ sigma     &lt;dbl&gt; 2.20380842, 0.57847121, 1.00816092, 2.94427170, 0.30736807, 0.94694471, 0.66062…</code></pre>
<p>We ended up with 4,000 draws from the prior predictive distribution, much like <code>posterior_samples()</code> would return 4,000 draws from the posterior. Next we’ll use <code>sample_n()</code> to take a ransom sample from our <code>prior</code> object. After just a little more wrangling, we’ll be in good shape to plot our version of Figure 5.3.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb442-2" data-line-number="2"></a>
<a class="sourceLine" id="cb442-3" data-line-number="3">prior <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb442-4" data-line-number="4"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb442-5" data-line-number="5"><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;draw&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb442-6" data-line-number="6"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(draw, Intercept, b),</a>
<a class="sourceLine" id="cb442-7" data-line-number="7">         <span class="dt">a =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb442-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d =</span> Intercept <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb442-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb442-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb442-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> draw),</a>
<a class="sourceLine" id="cb442-12" data-line-number="12">            <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb442-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Median age marriage (std)&quot;</span>,</a>
<a class="sourceLine" id="cb442-14" data-line-number="14">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb442-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb442-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb442-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-11-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>To get the posterior predictions from our <strong>brms</strong> model, we’ll use <code>fitted()</code> in place of <code>link()</code>.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1"><span class="co"># determine the range of `a` values we&#39;d like to feed into `fitted()`</span></a>
<a class="sourceLine" id="cb443-2" data-line-number="2">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-3</span>, <span class="dt">to =</span> <span class="fl">3.2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb443-3" data-line-number="3"></a>
<a class="sourceLine" id="cb443-4" data-line-number="4"><span class="co"># now use `fitted()` to get the model-implied trajectories</span></a>
<a class="sourceLine" id="cb443-5" data-line-number="5"><span class="kw">fitted</span>(b5<span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb443-6" data-line-number="6">       <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb443-7" data-line-number="7"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb443-8" data-line-number="8"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb443-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb443-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb443-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a)) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb443-13" data-line-number="13">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb443-14" data-line-number="14">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb443-16" data-line-number="16">             <span class="kw">aes</span>(<span class="dt">y =</span> d), </a>
<a class="sourceLine" id="cb443-17" data-line-number="17">             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Median age marriage (std)&quot;</span>,</a>
<a class="sourceLine" id="cb443-19" data-line-number="19">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>a), </a>
<a class="sourceLine" id="cb443-21" data-line-number="21">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb443-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb443-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-12-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>That’ll serve as our version of the right panel of Figure 5.2. To paraphrase McElreath, “if you inspect the [<code>print()</code>] output, you’ll see that posterior for <span class="math inline">\([\beta_\text{a}]\)</span> is reliably negative” (p. 127). Let’s see.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: d ~ 1 + a 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.10    -0.20     0.19 1.00     4142     2663
## a            -0.57      0.12    -0.80    -0.34 1.00     3659     2775
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.82      0.09     0.68     1.02 1.00     3414     2900
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>On the standardized scale, -0.57 95% CI [-0.80, -0.34] is pretty negative, indeed.</p>
<p>We’re ready to fit our second univariable model.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1">b5<span class="fl">.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb446-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb446-4" data-line-number="4">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb446-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb446-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb446-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb446-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb446-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb446-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.02&quot;</span>)</a></code></pre></div>
<p>The summary suggests <span class="math inline">\(\beta_\text{m}\)</span> is of a smaller magnitude.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: d ~ 1 + m 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.11    -0.22     0.22 1.00     4273     2828
## m             0.35      0.13     0.09     0.61 1.00     3554     2749
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.10     0.78     1.17 1.00     3881     2939
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now we’ll wangle and plot our version of the left panel in Figure 5.2.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">m =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb449-2" data-line-number="2"></a>
<a class="sourceLine" id="cb449-3" data-line-number="3"><span class="kw">fitted</span>(b5<span class="fl">.2</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb449-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb449-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb449-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb449-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> m)) <span class="op">+</span></a>
<a class="sourceLine" id="cb449-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb449-9" data-line-number="9">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb449-10" data-line-number="10">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb449-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb449-12" data-line-number="12">             <span class="kw">aes</span>(<span class="dt">y =</span> d), </a>
<a class="sourceLine" id="cb449-13" data-line-number="13">             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb449-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Marriage rate (std)&quot;</span>,</a>
<a class="sourceLine" id="cb449-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb449-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>m), </a>
<a class="sourceLine" id="cb449-17" data-line-number="17">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb449-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb449-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())                   </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-15-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>But merely comparing parameter means between different bivariate regressions is no way to decide which predictor is better. Both of these predictors could provide independent value, or they could be redundant, or one could eliminate the value of the other.</p>
<p>To make sense of this, we’re going to have to think causally. And then, only after we’ve done some thinking, a bigger regression model that includes both age at marriage and marriage rate will help us. (pp. 127–128)</p>
</blockquote>
<div id="think-before-you-regress." class="section level3">
<h3><span class="header-section-number">5.1.1</span> Think before you regress.</h3>
<blockquote>
<p>It is helpful to introduce a particular type of causal graph known as a <strong>DAG</strong>, short for <strong>directed acyclic graph</strong>. <em>Graph</em> means it is nodes and connections. <em>Directed</em> means the connections have arrows that indicate directions of causal influence. And <em>acyclic</em> means that causes do not eventually flow back on themselves. A DAG is a way of describing qualitative causal relationships among variables. It isn’t as detailed as a full model description, but it contains information that a purely statistical model does not. Unlike a statistical model, a DAG will tell you the consequences of intervening to change a variable. But only if the DAG is correct. There is no inference without assumption. (p. 128, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>If you’re interested in making directed acyclic graphs (DAG) in <strong>R</strong>, the <a href="https://CRAN.R-project.org/package=dagitty"><strong>dagitty</strong></a> <span class="citation">(Textor &amp; der Zander, <a href="#ref-R-dagitty">2016</a>)</span> and <a href="https://CRAN.R-project.org/package=ggdag"><strong>ggdag</strong></a> <span class="citation">(Barrett, <a href="#ref-R-ggdag">2020</a><a href="#ref-R-ggdag">b</a>)</span> packages are handy. Our approach will focus on <strong>ggdag</strong>.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1"><span class="co"># install.packages(&quot;dagitty&quot;, dependencies = T)</span></a>
<a class="sourceLine" id="cb450-2" data-line-number="2"><span class="co"># install.packages(&quot;ggdag&quot;, dependencies = T)</span></a>
<a class="sourceLine" id="cb450-3" data-line-number="3"><span class="co"># library(dagitty)</span></a>
<a class="sourceLine" id="cb450-4" data-line-number="4"><span class="kw">library</span>(ggdag)</a></code></pre></div>
<p>If all you want is a quick and dirty DAG for our three variables, you can execute something like this.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb451-2" data-line-number="2"></a>
<a class="sourceLine" id="cb451-3" data-line-number="3"><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb451-4" data-line-number="4">       D <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-5" data-line-number="5"><span class="st">  </span><span class="kw">ggdag</span>(<span class="dt">node_size =</span> <span class="dv">8</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-17-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We can pretty it up a little, too.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb452-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;D&quot;</span>),</a>
<a class="sourceLine" id="cb452-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb452-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb452-5" data-line-number="5"></a>
<a class="sourceLine" id="cb452-6" data-line-number="6">p1 &lt;-</a>
<a class="sourceLine" id="cb452-7" data-line-number="7"><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb452-8" data-line-number="8">       D <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M,</a>
<a class="sourceLine" id="cb452-9" data-line-number="9">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb452-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb452-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb452-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb452-19" data-line-number="19"></a>
<a class="sourceLine" id="cb452-20" data-line-number="20">p1</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-18-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We could have left out the <code>coords</code> argument and let the <code>dagify()</code> function set the layout of the nodes on its own. But since we were picky and wanted to ape McElreath, we first specified our coordinates in a tibble and then included that tibble in the <code>coords</code> argument. For more on the topic, check out the Barrett’s <span class="citation">(<a href="#ref-barrettAnIntroduction2020">2020</a><a href="#ref-barrettAnIntroduction2020">a</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=ggdag/vignettes/intro-to-ggdag.html"><em>An Introduction to ggdag</em></a>.</p>
<p>Buy anyway, our DAG</p>
<blockquote>
<p>represents a heuristic causal model. Like other models, it is an analytical assumption. The symbols <span class="math inline">\(A\)</span>, <span class="math inline">\(M\)</span>, and <span class="math inline">\(D\)</span> are our observed variables. The arrows show directions of influence. What this DAG says is:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(A\)</span> directly influences <span class="math inline">\(D\)</span></li>
<li><span class="math inline">\(M\)</span> directly influences <span class="math inline">\(D\)</span></li>
<li><span class="math inline">\(A\)</span> directly influences <span class="math inline">\(M\)</span></li>
</ol>
<p>These statements can then have further implications. In this case, age of marriage influences divorce in two ways. First it has a direct effect, <span class="math inline">\(A \rightarrow D\)</span>. Perhaps a direct effect would arise because younger people change faster than older people and are therefore more likely to grow incompatible with a partner. Second, it has an indirect effect by influencing the marriage rate, which then influences divorce, <span class="math inline">\(A \rightarrow M \rightarrow D\)</span>. If people get married earlier, then the marriage rate may rise, because there are more young people. (p. 128)</p>
</blockquote>
<p>Considering alternative models, “It could be that the association between <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span> arises entirely from <span class="math inline">\(A\)</span>’s influence on both <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span>. Like this:” (p. 129)</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb453-2" data-line-number="2"><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb453-3" data-line-number="3">         D <span class="op">~</span><span class="st"> </span>A,</a>
<a class="sourceLine" id="cb453-4" data-line-number="4">         <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb453-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb453-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb453-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb453-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a>
<a class="sourceLine" id="cb453-14" data-line-number="14"></a>
<a class="sourceLine" id="cb453-15" data-line-number="15">p2</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-19-1.png" width="288" style="display: block; margin: auto;" /></p>
<blockquote>
<p>This DAG is also consistent with the posterior distributions of models [<code>b5.1</code>] and [<code>b5.2</code>]. Why? Because both <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span> “listen” to <span class="math inline">\(A\)</span>. They have information from <span class="math inline">\(A\)</span>. So when you inspect the association between <span class="math inline">\(D\)</span> and <span class="math inline">\(M\)</span>, you pick up that common information that they both got from listening to <span class="math inline">\(A\)</span>. You’ll see a more formal way to deduce this, in the next chapter.</p>
<p>So which is it? Is there a direct effect of marriage rate, or rather is age at marriage just driving both, creating a spurious correlation between marriage rate and divorce rate? To find out, we need to consider carefully what each DAG implies. That’s what’s next. (p. 129)</p>
</blockquote>
<div id="rethinking-whats-a-cause" class="section level4">
<h4><span class="header-section-number">5.1.1.1</span> Rethinking: What’s a cause?</h4>
<blockquote>
<p>Questions of causation can become bogged down in philosophical debates. These debates are worth having. But they don’t usually intersect with statistical concerns. Knowing a cause in statistics means being able to correctly predict the consequences of an intervention. There are contexts in which even this is complicated. (p. 129)</p>
</blockquote>
</div>
</div>
<div id="testable-implications." class="section level3">
<h3><span class="header-section-number">5.1.2</span> Testable implications.</h3>
<p>So far, we have entertained two DAGs. Here we use <strong>patchwork</strong> to combine them into one plot.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb454-2" data-line-number="2"></a>
<a class="sourceLine" id="cb454-3" data-line-number="3">p1 <span class="op">|</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-20-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>McElreath encouraged us to examine the correlations among these three variables with <code>cor()</code>.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb455-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(d<span class="op">:</span>a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb455-3" data-line-number="3"><span class="st">  </span><span class="kw">cor</span>()</a></code></pre></div>
<pre><code>##            d          m          a
## d  1.0000000  0.3737314 -0.5972392
## m  0.3737314  1.0000000 -0.7210960
## a -0.5972392 -0.7210960  1.0000000</code></pre>
<p>If you just want the lower triangle, you can use the <code>lowerCor()</code> function from the <a href="https://CRAN.R-project.org/package=psych"><strong>psych</strong> package</a> <span class="citation">(Revelle, <a href="#ref-R-psych">2020</a>)</span>.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1"><span class="kw">library</span>(psych)</a>
<a class="sourceLine" id="cb457-2" data-line-number="2"></a>
<a class="sourceLine" id="cb457-3" data-line-number="3">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb457-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(d<span class="op">:</span>a) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb457-5" data-line-number="5"><span class="st">  </span><span class="kw">lowerCor</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   d      m      a     
## d  1.000              
## m  0.374  1.000       
## a -0.597 -0.721  1.000</code></pre>
<p>Our second DAG, above, suggests “that <span class="math inline">\(D\)</span> is independent of <span class="math inline">\(M\)</span>, conditional on <span class="math inline">\(A\)</span>” (p. 130). We can use the <code>dagitty::impliedConditionalIndependencies()</code> function to express that conditional independence in formal notation.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" data-line-number="1"><span class="kw">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M }&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb459-2" data-line-number="2"><span class="st">  </span><span class="kw">impliedConditionalIndependencies</span>()</a></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<p>The lack of conditional dependencies in the first DAG may be expressed this way.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" data-line-number="1"><span class="kw">dagitty</span>(<span class="st">&#39;dag{D &lt;- A -&gt; M -&gt; D}&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb461-2" data-line-number="2"><span class="st">  </span><span class="kw">impliedConditionalIndependencies</span>()</a></code></pre></div>
<p>Okay, that was a bit of a tease. “There are no conditional independencies, so there is no output to display” (p. 131). To close out this section,</p>
<blockquote>
<p>once you fit a multiple regression to predict divorce using both marriage rate and age at marriage, the model addresses the questions:</p>
<ol style="list-style-type: decimal">
<li>After I already know marriage rate, what additional value is there in also knowing age at marriage?</li>
<li>After I already know age at marriage, what additional value is there in also knowing marriage rate?</li>
</ol>
<p>The parameter estimates corresponding to each predictor are the (often opaque) answers to these questions. The questions above are descriptive, and the answers are also descriptive. It is only the derivation of the testable implications above that gives these descriptive results a causal meaning. But that meaning is still dependent upon believing the DAG. (p. 131)</p>
</blockquote>
</div>
<div id="multiple-regression-notation." class="section level3">
<h3><span class="header-section-number">5.1.3</span> Multiple regression notation.</h3>
<p>We can write the statistical formula for our first multivariable model as</p>
<p><span class="math display">\[
\begin{align*}
\text{Divorce_std}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{Marriage_std}_i + \beta_2 \text{MedianAgeMarriage_std}_i \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
</div>
<div id="approximating-the-posterior." class="section level3">
<h3><span class="header-section-number">5.1.4</span> Approximating the posterior.</h3>
<p>Much like we used the <code>+</code> operator to add single predictors to the intercept, we just use more <code>+</code> operators in the <code>formula</code> argument to add more predictors. Also notice we’re using the same prior <code>prior(normal(0, 1), class = b)</code> for both predictors. Within the <strong>brms</strong> framework, they are both of <code>class = b</code>. But if we wanted their priors to differ, we’d make two <code>prior()</code> statements and differentiate them with the <code>coef</code> argument. You’ll see examples of that later on.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1">b5<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb462-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb462-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb462-4" data-line-number="4">      d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb462-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb462-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb462-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb462-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb462-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb462-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.03&quot;</span>)</a></code></pre></div>
<p>Behold the summary.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: d ~ 1 + m + a 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.10    -0.19     0.20 1.00     3682     2454
## m            -0.06      0.16    -0.38     0.26 1.00     2641     2654
## a            -0.61      0.16    -0.93    -0.29 1.00     2798     2710
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.83      0.09     0.68     1.02 1.00     3492     2455
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <strong>brms</strong> package doesn’t have a convenience function like <code>rethinking::coeftab()</code>. However, we can make something similar with a little deft wrangling and <strong>ggplot2</strong> code.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1"><span class="co"># first, extract and rename the necessary posterior parameters</span></a>
<a class="sourceLine" id="cb465-2" data-line-number="2"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb465-3" data-line-number="3">  <span class="kw">posterior_samples</span>(b5<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-4" data-line-number="4"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.1_beta[A]</span><span class="st">`</span> =<span class="st"> </span>b_a),</a>
<a class="sourceLine" id="cb465-5" data-line-number="5">  <span class="kw">posterior_samples</span>(b5<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-6" data-line-number="6"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.2_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_m),</a>
<a class="sourceLine" id="cb465-7" data-line-number="7">  <span class="kw">posterior_samples</span>(b5<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-8" data-line-number="8"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.3_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_m,</a>
<a class="sourceLine" id="cb465-9" data-line-number="9">              <span class="st">`</span><span class="dt">b5.3_beta[A]</span><span class="st">`</span> =<span class="st"> </span>b_a)</a>
<a class="sourceLine" id="cb465-10" data-line-number="10">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-11" data-line-number="11"><span class="st">  </span><span class="co"># convert them to the long format, group, and get the posterior summaries</span></a>
<a class="sourceLine" id="cb465-12" data-line-number="12"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-13" data-line-number="13"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-14" data-line-number="14"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb465-15" data-line-number="15">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb465-16" data-line-number="16">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-17" data-line-number="17"><span class="st">  </span><span class="co"># since the `key` variable is really two variables in one, here we split them up</span></a>
<a class="sourceLine" id="cb465-18" data-line-number="18"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb465-19" data-line-number="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb465-20" data-line-number="20"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb465-21" data-line-number="21"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">xmin =</span> ll, <span class="dt">xmax =</span> ul, <span class="dt">y =</span> fit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb465-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb465-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb465-24" data-line-number="24"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb465-25" data-line-number="25"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb465-26" data-line-number="26"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb465-27" data-line-number="27">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb465-28" data-line-number="28"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-26-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Don’t worry, coefficient plots won’t always be this complicated. We’ll walk out simpler ones toward the end of the chapter.</p>
<p>The substantive interpretation of all those coefficients is: “<em>Once we know median age at marriage for a State, there is little or no additional predictive power in also knowing the rate of marriage in that State</em>” (p. 134, <em>emphasis</em> in the original). This coheres well with one of our <code>impliedConditionalIndependencies()</code> statements, from above.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1"><span class="kw">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M }&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb466-2" data-line-number="2"><span class="st">  </span><span class="kw">impliedConditionalIndependencies</span>()</a></code></pre></div>
<pre><code>## D _||_ M | A</code></pre>
<div id="overthinking-simulating-the-divorce-example." class="section level4">
<h4><span class="header-section-number">5.1.4.1</span> Overthinking: Simulating the divorce example.</h4>
<p>Okay, let’s simulate our divorce data in a <strong>tidyverse</strong> sort of way.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1"><span class="co"># how many states would you like?</span></a>
<a class="sourceLine" id="cb468-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">50</span> </a>
<a class="sourceLine" id="cb468-3" data-line-number="3"></a>
<a class="sourceLine" id="cb468-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb468-5" data-line-number="5">sim_d &lt;-</a>
<a class="sourceLine" id="cb468-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">age =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># sim A </span></a>
<a class="sourceLine" id="cb468-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mar =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="op">-</span>age, <span class="dt">sd =</span> <span class="dv">1</span>),   <span class="co"># sim A -&gt; M </span></a>
<a class="sourceLine" id="cb468-8" data-line-number="8">         <span class="dt">div =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span>  age, <span class="dt">sd =</span> <span class="dv">1</span>))   <span class="co"># sim A -&gt; D</span></a>
<a class="sourceLine" id="cb468-9" data-line-number="9"></a>
<a class="sourceLine" id="cb468-10" data-line-number="10"><span class="kw">head</span>(sim_d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##       age    mar    div
##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 -0.841   2.30  -2.84 
## 2  1.38   -1.20   2.52 
## 3 -1.26    2.28  -0.580
## 4  0.0701 -0.662  0.279
## 5  1.71   -1.82   1.65 
## 6 -0.603  -0.322  0.291</code></pre>
<p>We simulated those data based on this formulation.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1"><span class="kw">dagitty</span>(<span class="st">&#39;dag{divorce &lt;- age -&gt; marriage}&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb470-2" data-line-number="2"><span class="st">  </span><span class="kw">impliedConditionalIndependencies</span>()</a></code></pre></div>
<pre><code>## divorce _||_ marriage | age</code></pre>
<p>Here are the quick <code>pairs()</code> plots.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="kw">pairs</span>(sim_d, <span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-30-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>If we use the <code>update()</code> function, we can refit the last models in haste.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" data-line-number="1">b5<span class="fl">.1</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb473-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.1</span>, </a>
<a class="sourceLine" id="cb473-3" data-line-number="3">         <span class="dt">newdata =</span> sim_d, </a>
<a class="sourceLine" id="cb473-4" data-line-number="4">         <span class="dt">formula =</span> div <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age,</a>
<a class="sourceLine" id="cb473-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb473-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.01_sim&quot;</span>)</a>
<a class="sourceLine" id="cb473-7" data-line-number="7"></a>
<a class="sourceLine" id="cb473-8" data-line-number="8">b5<span class="fl">.2</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb473-9" data-line-number="9"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.2</span>, </a>
<a class="sourceLine" id="cb473-10" data-line-number="10">         <span class="dt">newdata =</span> sim_d, </a>
<a class="sourceLine" id="cb473-11" data-line-number="11">         <span class="dt">formula =</span> div <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mar,</a>
<a class="sourceLine" id="cb473-12" data-line-number="12">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb473-13" data-line-number="13">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.02_sim&quot;</span>)</a>
<a class="sourceLine" id="cb473-14" data-line-number="14">      </a>
<a class="sourceLine" id="cb473-15" data-line-number="15"> b5<span class="fl">.3</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb473-16" data-line-number="16"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb473-17" data-line-number="17">         <span class="dt">newdata =</span> sim_d,</a>
<a class="sourceLine" id="cb473-18" data-line-number="18">         <span class="dt">formula =</span> div <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mar <span class="op">+</span><span class="st"> </span>age,</a>
<a class="sourceLine" id="cb473-19" data-line-number="19">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb473-20" data-line-number="20">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.03_sim&quot;</span>)</a></code></pre></div>
<p>The steps for our homemade <code>coefplot()</code> plot are basically the same. Just switch out some of the names.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb474-2" data-line-number="2">  <span class="kw">posterior_samples</span>(b5<span class="fl">.1</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.1_beta[A]</span><span class="st">`</span> =<span class="st"> </span>b_age),</a>
<a class="sourceLine" id="cb474-4" data-line-number="4">  <span class="kw">posterior_samples</span>(b5<span class="fl">.2</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-5" data-line-number="5"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.2_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_mar),</a>
<a class="sourceLine" id="cb474-6" data-line-number="6">  <span class="kw">posterior_samples</span>(b5<span class="fl">.3</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-7" data-line-number="7"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.3_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_mar,</a>
<a class="sourceLine" id="cb474-8" data-line-number="8">              <span class="st">`</span><span class="dt">b5.3_beta[A]</span><span class="st">`</span> =<span class="st"> </span>b_age)</a>
<a class="sourceLine" id="cb474-9" data-line-number="9">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-11" data-line-number="11"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-12" data-line-number="12"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb474-13" data-line-number="13">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb474-14" data-line-number="14">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-15" data-line-number="15"><span class="st">  </span><span class="co"># since the `key` variable is really two variables in one, here we split them up</span></a>
<a class="sourceLine" id="cb474-16" data-line-number="16"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb474-17" data-line-number="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb474-18" data-line-number="18"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb474-19" data-line-number="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">xmin =</span> ll, <span class="dt">xmax =</span> ul, <span class="dt">y =</span> fit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb474-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb474-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb474-22" data-line-number="22"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb474-23" data-line-number="23"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb474-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb474-25" data-line-number="25">        <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb474-26" data-line-number="26"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-31-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Well, okay. This is the same basic pattern, but with the signs switched and with a little simulation variability thrown in. But you get the picture.</p>
</div>
</div>
<div id="plotting-multivariate-posteriors." class="section level3">
<h3><span class="header-section-number">5.1.5</span> Plotting multivariate posteriors.</h3>
<p>“Let’s pause for a moment, before moving on. There are a lot of moving parts here: three variables, some strange DAGs, and three models. If you feel at all confused, it is only because you are paying attention” (p. 133).</p>
<p>Preach, brother.</p>
<p>Down a little further, McElreath gave us this deflationary delight: “There is a huge literature detailing a variety of plotting techniques that all attempt to help one understand multiple linear regression. None of these techniques is suitable for all jobs, and most do not generalize beyond linear regression” (pp. 134–135). Now you’re inspired, let’s learn three:</p>
<ul>
<li>Predictor residual plots</li>
<li>Posterior prediction plots</li>
<li>Counterfactual plots</li>
</ul>
<div id="predictor-residual-plots." class="section level4">
<h4><span class="header-section-number">5.1.5.1</span> Predictor residual plots.</h4>
<p>To get ready to make our residual plots, we’ll predict <code>m</code> with <code>a</code>.</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" data-line-number="1">b5<span class="fl">.4</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb475-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb475-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb475-4" data-line-number="4">      m <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>a,</a>
<a class="sourceLine" id="cb475-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb475-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb475-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb475-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb475-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb475-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.04&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: m ~ 1 + a 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.00      0.09    -0.19     0.17 1.00     3336     2718
## a            -0.69      0.10    -0.89    -0.49 1.00     3962     2856
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.71      0.07     0.59     0.87 1.00     3657     2498
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>With <code>fitted()</code>, we compute the expected values for each state (with the exception of Nevada). Since the <code>a</code> values for each state are in the date we used to fit the model, we’ll omit the <code>newdata</code> argument.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1">f &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb478-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(b5<span class="fl">.4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb478-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb478-4" data-line-number="4"><span class="st">  </span><span class="kw">bind_cols</span>(d)</a>
<a class="sourceLine" id="cb478-5" data-line-number="5"></a>
<a class="sourceLine" id="cb478-6" data-line-number="6"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 50
## Columns: 20
## $ Estimate          &lt;dbl&gt; 0.4168429, 0.4723741, 0.1391869, 0.9721549, -0.4161251, 0.1947181, -0.8…
## $ Est.Error         &lt;dbl&gt; 0.11084576, 0.11575588, 0.09359310, 0.17181804, 0.10902234, 0.09588333,…
## $ Q2.5              &lt;dbl&gt; 0.1919818448, 0.2397930892, -0.0511494288, 0.6390384012, -0.6351883273,…
## $ Q97.5             &lt;dbl&gt; 0.63066723, 0.69604942, 0.32323792, 1.30586005, -0.20011387, 0.38252344…
## $ Location          &lt;fct&gt; Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, …
## $ Loc               &lt;fct&gt; AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY,…
## $ Population        &lt;dbl&gt; 4.78, 0.71, 6.33, 2.92, 37.25, 5.03, 3.57, 0.90, 0.60, 18.80, 9.69, 1.3…
## $ MedianAgeMarriage &lt;dbl&gt; 25.3, 25.2, 25.8, 24.3, 26.8, 25.7, 27.6, 26.6, 29.7, 26.4, 25.9, 26.9,…
## $ Marriage          &lt;dbl&gt; 20.2, 26.0, 20.3, 26.4, 19.1, 23.5, 17.1, 23.1, 17.7, 17.0, 22.1, 24.9,…
## $ Marriage.SE       &lt;dbl&gt; 1.27, 2.93, 0.98, 1.70, 0.39, 1.24, 1.06, 2.89, 2.53, 0.58, 0.81, 2.54,…
## $ Divorce           &lt;dbl&gt; 12.7, 12.5, 10.8, 13.5, 8.0, 11.6, 6.7, 8.9, 6.3, 8.5, 11.5, 8.3, 7.7, …
## $ Divorce.SE        &lt;dbl&gt; 0.79, 2.05, 0.74, 1.22, 0.24, 0.94, 0.77, 1.39, 1.89, 0.32, 0.58, 1.27,…
## $ WaffleHouses      &lt;int&gt; 128, 0, 18, 41, 0, 11, 0, 3, 0, 133, 381, 0, 0, 2, 17, 0, 6, 64, 66, 0,…
## $ South             &lt;int&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0,…
## $ Slaves1860        &lt;int&gt; 435080, 0, 0, 111115, 0, 0, 0, 1798, 0, 61745, 462198, 0, 0, 0, 0, 0, 2…
## $ Population1860    &lt;int&gt; 964201, 0, 0, 435450, 379994, 34277, 460147, 112216, 75080, 140424, 105…
## $ PropSlaves1860    &lt;dbl&gt; 4.5e-01, 0.0e+00, 0.0e+00, 2.6e-01, 0.0e+00, 0.0e+00, 0.0e+00, 1.6e-02,…
## $ d                 &lt;dbl&gt; 1.6542053, 1.5443643, 0.6107159, 2.0935693, -0.9270579, 1.0500799, -1.6…
## $ m                 &lt;dbl&gt; 0.02264406, 1.54980162, 0.04897436, 1.65512283, -0.26698927, 0.89154405…
## $ a                 &lt;dbl&gt; -0.6062895, -0.6866993, -0.2042408, -1.4103870, 0.5998567, -0.2846505, …</code></pre>
<p>After a little data processing, we can make the upper left panel of Figure 5.4.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb480-2" data-line-number="2"><span class="st">  </span>f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb480-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> m)) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> a, <span class="dt">yend =</span> Estimate), </a>
<a class="sourceLine" id="cb480-6" data-line-number="6">               <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate), </a>
<a class="sourceLine" id="cb480-8" data-line-number="8">            <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </a>
<a class="sourceLine" id="cb480-10" data-line-number="10">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb480-11" data-line-number="11">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">14</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age at marriage (std)&quot;</span>,</a>
<a class="sourceLine" id="cb480-13" data-line-number="13">       <span class="dt">y =</span> <span class="st">&quot;Marriage rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>m)) <span class="op">+</span></a>
<a class="sourceLine" id="cb480-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb480-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a>
<a class="sourceLine" id="cb480-17" data-line-number="17"></a>
<a class="sourceLine" id="cb480-18" data-line-number="18">p1</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-34-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>We get the residuals with the well-named <code>residuals()</code> function. Much like with <code>brms::fitted()</code>, <code>brms::residuals()</code> returns a four-vector matrix with the number of rows equal to the number of observations in the original data (by default, anyway). The vectors have the familiar names: <code>Estimate</code>, <code>Est.Error</code>, <code>Q2.5</code>, and <code>Q97.5</code>. See the <a href="https://CRAN.R-project.org/package=brms/brms.pdf">brms reference manual</a> <span class="citation">(Bürkner, <a href="#ref-brms2020RM">2020</a><a href="#ref-brms2020RM">g</a>)</span> for details.</p>
<p>With our residuals in hand, we just need a little more data processing to make lower left panel of Figure 5.4.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1">r &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb481-2" data-line-number="2"><span class="st">  </span><span class="kw">residuals</span>(b5<span class="fl">.4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb481-3" data-line-number="3"><span class="st">  </span><span class="co"># To use this in ggplot2, we need to make it a tibble or data frame</span></a>
<a class="sourceLine" id="cb481-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb481-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(d)</a>
<a class="sourceLine" id="cb481-6" data-line-number="6"></a>
<a class="sourceLine" id="cb481-7" data-line-number="7">p3 &lt;-</a>
<a class="sourceLine" id="cb481-8" data-line-number="8"><span class="st">  </span>r <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb481-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Estimate, <span class="dt">y =</span> d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-10" data-line-number="10"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,</a>
<a class="sourceLine" id="cb481-11" data-line-number="11">              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, </a>
<a class="sourceLine" id="cb481-12" data-line-number="12">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </a>
<a class="sourceLine" id="cb481-16" data-line-number="16">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb481-17" data-line-number="17">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-19" data-line-number="19"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(r<span class="op">$</span>Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Marriage rate residuals&quot;</span>,</a>
<a class="sourceLine" id="cb481-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb481-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb481-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb481-24" data-line-number="24"></a>
<a class="sourceLine" id="cb481-25" data-line-number="25">p3</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-35-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>To get the <code>MedianAgeMarriage_s</code> residuals, we have to fit the corresponding model first.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1">b5<span class="fl">.4</span>b &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb482-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb482-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb482-4" data-line-number="4">      a <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb482-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb482-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb482-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb482-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb482-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb482-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.04b&quot;</span>)</a></code></pre></div>
<p>With <code>b5.4b</code> in hand, we’re ready to make the upper right panel of Figure 5.4.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb483-2" data-line-number="2"><span class="st">  </span><span class="kw">fitted</span>(b5<span class="fl">.4</span>b) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb483-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb483-4" data-line-number="4"><span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb483-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb483-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> m, <span class="dt">y =</span> a)) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> m, <span class="dt">yend =</span> Estimate), </a>
<a class="sourceLine" id="cb483-9" data-line-number="9">               <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate), </a>
<a class="sourceLine" id="cb483-11" data-line-number="11">            <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>)),  </a>
<a class="sourceLine" id="cb483-13" data-line-number="13">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb483-14" data-line-number="14">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Marriage rate (std)&quot;</span>,</a>
<a class="sourceLine" id="cb483-16" data-line-number="16">       <span class="dt">y =</span> <span class="st">&quot;Age at marriage (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>a)) <span class="op">+</span></a>
<a class="sourceLine" id="cb483-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb483-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())   </a>
<a class="sourceLine" id="cb483-20" data-line-number="20"></a>
<a class="sourceLine" id="cb483-21" data-line-number="21">p2</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-36-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>And now we’ll get the new batch of residuals, do a little data processing, and make a plot corresponding to the final panel of Figure 5.4.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">r &lt;-</a>
<a class="sourceLine" id="cb484-2" data-line-number="2"><span class="st">  </span><span class="kw">residuals</span>(b5<span class="fl">.4</span>b) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb484-3" data-line-number="3"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb484-4" data-line-number="4"><span class="st">  </span><span class="kw">bind_cols</span>(d)</a>
<a class="sourceLine" id="cb484-5" data-line-number="5"></a>
<a class="sourceLine" id="cb484-6" data-line-number="6">p4 &lt;-</a>
<a class="sourceLine" id="cb484-7" data-line-number="7"><span class="st">  </span>r <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb484-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Estimate, <span class="dt">y =</span> d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-9" data-line-number="9"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,</a>
<a class="sourceLine" id="cb484-10" data-line-number="10">              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, </a>
<a class="sourceLine" id="cb484-11" data-line-number="11">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </a>
<a class="sourceLine" id="cb484-15" data-line-number="15">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb484-16" data-line-number="16">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-18" data-line-number="18"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(r<span class="op">$</span>Estimate),</a>
<a class="sourceLine" id="cb484-19" data-line-number="19">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age at marriage residuals&quot;</span>,</a>
<a class="sourceLine" id="cb484-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb484-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb484-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb484-24" data-line-number="24"></a>
<a class="sourceLine" id="cb484-25" data-line-number="25">p4</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-37-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Here we close out the section by combining our four subplots into one glorious whole with a little <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span>p4</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-38-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="rethinking-residuals-are-parameters-not-data." class="section level5">
<h5><span class="header-section-number">5.1.5.1.1</span> Rethinking: Residuals are parameters, not data.</h5>
<blockquote>
<p>There is a tradition, especially in parts of biology, of using residuals from one model as data in another model. For example, a biologist might regress brain size on body size and then use the brain size residuals as data in another model. This procedure is always a mistake. Residuals are not known. They are parameters, variables with unobserved values. Treating them as known values throws away uncertainty. (p. 137)</p>
</blockquote>
<p>Let’s hammer this point home. Recall how <code>brms::residuals()</code> returns four columns: <code>Estimate</code>, <code>Est.Error</code>, <code>Q2.5</code>, and <code>Q97.5</code>.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1">r <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb486-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 50
## Columns: 20
## $ Estimate          &lt;dbl&gt; -0.58903636, 0.38918106, -0.16873543, -0.26149791, 0.41633575, 0.334924…
## $ Est.Error         &lt;dbl&gt; 0.09007649, 0.18147491, 0.09015909, 0.19089755, 0.09437421, 0.12750315,…
## $ Q2.5              &lt;dbl&gt; -0.76631179, 0.03230000, -0.34731730, -0.63777776, 0.23116991, 0.085660…
## $ Q97.5             &lt;dbl&gt; -0.413936585, 0.741616393, 0.004905611, 0.109295277, 0.599561771, 0.578…
## $ Location          &lt;fct&gt; Alabama, Alaska, Arizona, Arkansas, California, Colorado, Connecticut, …
## $ Loc               &lt;fct&gt; AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY,…
## $ Population        &lt;dbl&gt; 4.78, 0.71, 6.33, 2.92, 37.25, 5.03, 3.57, 0.90, 0.60, 18.80, 9.69, 1.3…
## $ MedianAgeMarriage &lt;dbl&gt; 25.3, 25.2, 25.8, 24.3, 26.8, 25.7, 27.6, 26.6, 29.7, 26.4, 25.9, 26.9,…
## $ Marriage          &lt;dbl&gt; 20.2, 26.0, 20.3, 26.4, 19.1, 23.5, 17.1, 23.1, 17.7, 17.0, 22.1, 24.9,…
## $ Marriage.SE       &lt;dbl&gt; 1.27, 2.93, 0.98, 1.70, 0.39, 1.24, 1.06, 2.89, 2.53, 0.58, 0.81, 2.54,…
## $ Divorce           &lt;dbl&gt; 12.7, 12.5, 10.8, 13.5, 8.0, 11.6, 6.7, 8.9, 6.3, 8.5, 11.5, 8.3, 7.7, …
## $ Divorce.SE        &lt;dbl&gt; 0.79, 2.05, 0.74, 1.22, 0.24, 0.94, 0.77, 1.39, 1.89, 0.32, 0.58, 1.27,…
## $ WaffleHouses      &lt;int&gt; 128, 0, 18, 41, 0, 11, 0, 3, 0, 133, 381, 0, 0, 2, 17, 0, 6, 64, 66, 0,…
## $ South             &lt;int&gt; 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0,…
## $ Slaves1860        &lt;int&gt; 435080, 0, 0, 111115, 0, 0, 0, 1798, 0, 61745, 462198, 0, 0, 0, 0, 0, 2…
## $ Population1860    &lt;int&gt; 964201, 0, 0, 435450, 379994, 34277, 460147, 112216, 75080, 140424, 105…
## $ PropSlaves1860    &lt;dbl&gt; 4.5e-01, 0.0e+00, 0.0e+00, 2.6e-01, 0.0e+00, 0.0e+00, 0.0e+00, 1.6e-02,…
## $ d                 &lt;dbl&gt; 1.6542053, 1.5443643, 0.6107159, 2.0935693, -0.9270579, 1.0500799, -1.6…
## $ m                 &lt;dbl&gt; 0.02264406, 1.54980162, 0.04897436, 1.65512283, -0.26698927, 0.89154405…
## $ a                 &lt;dbl&gt; -0.6062895, -0.6866993, -0.2042408, -1.4103870, 0.5998567, -0.2846505, …</code></pre>
<p>In the residual plots from the lower two panels of Figure 5.4, we focused on the means of the residuals (i.e., <code>Estimate</code>). However, we can express the uncertainty in the residuals by including error bars for the 95% intervals. Here’s what that might look like with a slight reworking of the lower right panel of Figure 5.4.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1">r <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb488-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Estimate, <span class="dt">y =</span> d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,</a>
<a class="sourceLine" id="cb488-4" data-line-number="4">              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, </a>
<a class="sourceLine" id="cb488-5" data-line-number="5">              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-7" data-line-number="7"><span class="st">  </span><span class="co"># the only change is here</span></a>
<a class="sourceLine" id="cb488-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> Q2<span class="fl">.5</span>, <span class="dt">xmax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb488-9" data-line-number="9">                  <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </a>
<a class="sourceLine" id="cb488-11" data-line-number="11">                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb488-12" data-line-number="12">                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(r<span class="op">$</span>Estimate),</a>
<a class="sourceLine" id="cb488-15" data-line-number="15">                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>d)) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age at marriage residuals&quot;</span>,</a>
<a class="sourceLine" id="cb488-17" data-line-number="17">       <span class="dt">y =</span> <span class="st">&quot;Divorce rate (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb488-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb488-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-40-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Look at that. If you were to fit a follow-up model based on only the point estimates (posterior means) of those residuals, you’d be ignoring a lot of uncertainty.</p>
</div>
</div>
<div id="posterior-prediction-plots." class="section level4">
<h4><span class="header-section-number">5.1.5.2</span> Posterior prediction plots.</h4>
<p>“It’s important to check the model’s implied predictions against the observed data” (p. 138). For more on the topic, check out Gabry and colleagues’ <span class="citation">(<a href="#ref-gabry2019visualization">2019</a>)</span> <a href="https://arxiv.org/abs/1709.01449"><em>Visualization in Bayesian workflow</em></a> or Simpson’s related blog post, <a href="http://andrewgelman.com/2017/09/07/touch-want-feel-data/"><em>Touch me, I want to feel your data</em></a>.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1"><span class="kw">fitted</span>(b5<span class="fl">.3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb489-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb489-3" data-line-number="3"><span class="st">  </span><span class="co"># unstandardize the model predictions</span></a>
<a class="sourceLine" id="cb489-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="op">~</span>. <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>Divorce) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>Divorce)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb489-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb489-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb489-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Divorce, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb489-11" data-line-number="11">                 <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;RI&quot;</span>, <span class="st">&quot;ME&quot;</span>)),</a>
<a class="sourceLine" id="cb489-13" data-line-number="13">            <span class="kw">aes</span>(<span class="dt">label =</span> Loc), </a>
<a class="sourceLine" id="cb489-14" data-line-number="14">            <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">nudge_x =</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Observed divorce&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Predicted divorce&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb489-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb489-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-41-1.png" width="288" style="display: block; margin: auto;" /></p>
<div id="rethinking-stats-huh-yeah-what-is-it-good-for" class="section level5">
<h5><span class="header-section-number">5.1.5.2.1</span> Rethinking: Stats, huh, yeah what is it good for?</h5>
<blockquote>
<p>Often people want statistical modeling to do things that statistical modeling cannot do. For example, we’d like to know whether an effect is “real” or rather spurious. Unfortunately, modeling merely quantifies uncertainty in the precise way that the model understands the problem. Usually answers to large world questions about truth and causation depend upon information not included in the model. For example, any observed correlation between an outcome and predictor could be eliminated or reversed once another predictor is added to the model. But if we cannot think of the right variable, we might never notice. Therefore all statistical models are vulnerable to and demand critique, regardless of the precision of their estimates and apparent accuracy of their predictions. (p. 139)</p>
</blockquote>
</div>
<div id="overthinking-simulating-spurious-association." class="section level5">
<h5><span class="header-section-number">5.1.5.2.2</span> Overthinking: Simulating spurious association.</h5>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span>                             <span class="co"># number of cases</span></a>
<a class="sourceLine" id="cb490-2" data-line-number="2"></a>
<a class="sourceLine" id="cb490-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">5</span>)                          <span class="co"># setting the seed makes the results reproducible</span></a>
<a class="sourceLine" id="cb490-4" data-line-number="4">d_spur &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb490-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x_real =</span> <span class="kw">rnorm</span>(n),          <span class="co"># x_real as Gaussian with mean 0 and SD 1 (i.e., the defaults)</span></a>
<a class="sourceLine" id="cb490-6" data-line-number="6">         <span class="dt">x_spur =</span> <span class="kw">rnorm</span>(n, x_real),  <span class="co"># x_spur as Gaussian with mean = x_real</span></a>
<a class="sourceLine" id="cb490-7" data-line-number="7">         <span class="dt">y =</span>      <span class="kw">rnorm</span>(n, x_real))  <span class="co"># y as Gaussian with mean = x_real</span></a></code></pre></div>
<p>Here are the quick <code>pairs()</code> plots.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1"><span class="kw">pairs</span>(d_spur, <span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-43-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>We may as well fit and evaluate a model.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1">b5<span class="fl">.0</span>_spur &lt;-</a>
<a class="sourceLine" id="cb492-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d_spur, </a>
<a class="sourceLine" id="cb492-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb492-4" data-line-number="4">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_real <span class="op">+</span><span class="st"> </span>x_spur,</a>
<a class="sourceLine" id="cb492-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb492-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb492-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb492-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb492-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb492-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.00_spur&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1"><span class="kw">fixef</span>(b5<span class="fl">.0</span>_spur) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb493-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    -0.01      0.09 -0.18  0.16
## x_real        0.93      0.15  0.65  1.22
## x_spur        0.08      0.09 -0.10  0.26</code></pre>
<p>If we let “r” stand for <code>x_rel</code> and “s” stand for <code>x_spur</code>, here’s how we might depict that our simulation in a DAG.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb495-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;y&quot;</span>),</a>
<a class="sourceLine" id="cb495-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb495-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb495-5" data-line-number="5"></a>
<a class="sourceLine" id="cb495-6" data-line-number="6"><span class="kw">dagify</span>(s <span class="op">~</span><span class="st"> </span>r,</a>
<a class="sourceLine" id="cb495-7" data-line-number="7">       y <span class="op">~</span><span class="st"> </span>r,</a>
<a class="sourceLine" id="cb495-8" data-line-number="8">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb495-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb495-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb495-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-45-1.png" width="288" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="counterfactual-plots." class="section level4">
<h4><span class="header-section-number">5.1.5.3</span> Counterfactual plots.</h4>
<blockquote>
<p>A second sort of inferential plot displays the causal implications of the model. I call these plots <strong>counterfactual</strong>, because they can be produced for any values of the predictor variables you like, even unobserved combinations like very high median age of marriage and very high marriage rate. There are no States with this combination, but in a counterfactual plot, you can ask the model for a prediction for such a State. (p. 136, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>To simultaneously model the effects of <span class="math inline">\(A\)</span> on <span class="math inline">\(M\)</span> and <span class="math inline">\(D\)</span> AND the effects of <span class="math inline">\(A\)</span> on <span class="math inline">\(M\)</span> with <strong>brms</strong>, we’ll need to invoke the multivariate syntax. There are several ways to do this with <strong>brms</strong>, which Bürkner outlines in his <span class="citation">(<a href="#ref-Bürkner2020Multivariate">2020</a><a href="#ref-Bürkner2020Multivariate">c</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html"><em>Estimating multivariate models with brms</em></a>. At this point, it’s important to recognize we have two regression models. As a first step, we might specify each model separately in a <code>bf()</code> function and save them as objects.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1">d_model &lt;-<span class="st"> </span><span class="kw">bf</span>(d <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>m)</a>
<a class="sourceLine" id="cb496-2" data-line-number="2">m_model &lt;-<span class="st"> </span><span class="kw">bf</span>(m <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>a)</a></code></pre></div>
<p>Next we will combine our <code>bf()</code> objects with the <code>+</code> operator within the <code>brm()</code> function. For a model like this, we also specify <code>set_rescor(FALSE)</code> to prevent <strong>brms</strong> from adding a residual correlation between <code>d</code> and <code>m</code>. Also, notice how each prior statement includes a <code>resp</code> argument. This clarifies which sub-model the prior refers to.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1">b5<span class="fl">.3</span>_A &lt;-</a>
<a class="sourceLine" id="cb497-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb497-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb497-4" data-line-number="4">      d_model <span class="op">+</span><span class="st"> </span>m_model <span class="op">+</span><span class="st"> </span><span class="kw">set_rescor</span>(<span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb497-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept, <span class="dt">resp =</span> d),</a>
<a class="sourceLine" id="cb497-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b, <span class="dt">resp =</span> d),</a>
<a class="sourceLine" id="cb497-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma, <span class="dt">resp =</span> d),</a>
<a class="sourceLine" id="cb497-8" data-line-number="8">                </a>
<a class="sourceLine" id="cb497-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept, <span class="dt">resp =</span> m),</a>
<a class="sourceLine" id="cb497-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b, <span class="dt">resp =</span> m),</a>
<a class="sourceLine" id="cb497-11" data-line-number="11">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma, <span class="dt">resp =</span> m)),</a>
<a class="sourceLine" id="cb497-12" data-line-number="12">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb497-13" data-line-number="13">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb497-14" data-line-number="14">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.03_A&quot;</span>)</a></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.3</span>_A)</a></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: d ~ 1 + a + m 
##          m ~ 1 + a 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## d_Intercept     0.00      0.10    -0.20     0.20 1.00     6411     3040
## m_Intercept    -0.00      0.09    -0.18     0.18 1.00     5641     2372
## d_a            -0.60      0.16    -0.90    -0.30 1.00     3982     3181
## d_m            -0.06      0.16    -0.37     0.25 1.00     4124     3410
## m_a            -0.69      0.10    -0.89    -0.48 1.00     6963     2863
## 
## Family Specific Parameters: 
##         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_d     0.83      0.09     0.68     1.01 1.00     5385     2921
## sigma_m     0.71      0.08     0.58     0.88 1.00     5980     3089
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Note our parameters now all have either a <code>d_</code> or an <code>m_</code> prefix to help clarify which sub-model they were for. The <code>m_a</code> row shows how strongly and negatively associated <code>a</code> is to <code>m</code>. Here’s how we might use <code>predict()</code> to make our version of the counterfactual plot in the left panel of Figure 5.6.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb500-2" data-line-number="2">             <span class="dt">m =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb500-3" data-line-number="3"></a>
<a class="sourceLine" id="cb500-4" data-line-number="4">p1 &lt;-</a>
<a class="sourceLine" id="cb500-5" data-line-number="5"><span class="st">  </span><span class="kw">predict</span>(b5<span class="fl">.3</span>_A,</a>
<a class="sourceLine" id="cb500-6" data-line-number="6">          <span class="dt">resp =</span> <span class="st">&quot;d&quot;</span>,</a>
<a class="sourceLine" id="cb500-7" data-line-number="7">          <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb500-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb500-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb500-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb500-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb500-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb500-13" data-line-number="13">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb500-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Total counterfactual effect of A on D&quot;</span>,</a>
<a class="sourceLine" id="cb500-15" data-line-number="15">       <span class="dt">x =</span> <span class="st">&quot;manipulated A&quot;</span>,</a>
<a class="sourceLine" id="cb500-16" data-line-number="16">       <span class="dt">y =</span> <span class="st">&quot;counterfactual D&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb500-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb500-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb500-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a>
<a class="sourceLine" id="cb500-20" data-line-number="20"></a>
<a class="sourceLine" id="cb500-21" data-line-number="21">p1</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-48-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Because the plot is based on a multivariate model, we used the <code>resp</code> argument within <code>predict()</code> to tell <strong>brms</strong> which of our two criterion variables (<code>d</code> or <code>m</code>) we were interested in. Unlike McElreath’s <strong>R</strong> code 5.20, we included predictor values for both <code>a</code> and <code>m</code>. This is because <strong>brms</strong> requires we provide values for all predictors in a model when using <code>predict()</code>. Even though we set all the <code>m</code> values to 0 for the counterfactual, it was necessary to tell <code>predict()</code> that’s exactly what we wanted.</p>
<p>Let’s do that all again, this time making the counterfactual for <code>d</code>. While we’re at it, we’ll combine this subplot with the last one to make the full version of Figure 5.6.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb501-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb501-2" data-line-number="2"></a>
<a class="sourceLine" id="cb501-3" data-line-number="3">p2 &lt;-</a>
<a class="sourceLine" id="cb501-4" data-line-number="4"><span class="st">  </span><span class="kw">predict</span>(b5<span class="fl">.3</span>_A,</a>
<a class="sourceLine" id="cb501-5" data-line-number="5">          <span class="dt">resp =</span> <span class="st">&quot;m&quot;</span>,</a>
<a class="sourceLine" id="cb501-6" data-line-number="6">          <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb501-7" data-line-number="7"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb501-8" data-line-number="8"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb501-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb501-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb501-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb501-12" data-line-number="12">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb501-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Counterfactual effect of A on M&quot;</span>,</a>
<a class="sourceLine" id="cb501-14" data-line-number="14">       <span class="dt">x =</span> <span class="st">&quot;manipulated A&quot;</span>,</a>
<a class="sourceLine" id="cb501-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;counterfactual M&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb501-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb501-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb501-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a>
<a class="sourceLine" id="cb501-19" data-line-number="19"></a>
<a class="sourceLine" id="cb501-20" data-line-number="20">p1 <span class="op">+</span><span class="st"> </span>p2</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-49-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>With our <strong>brms</strong>**tidyverse** paradigm, we might compute “the expected causal effect of increasing median age at marriage from 20 to 30” (p. 142) like this.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1"><span class="co"># new data frame, standardized to mean 26.1 and std dev 1.24 </span></a>
<a class="sourceLine" id="cb502-2" data-line-number="2">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> (<span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">30</span>) <span class="op">-</span><span class="st"> </span><span class="fl">26.1</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1.24</span>,</a>
<a class="sourceLine" id="cb502-3" data-line-number="3">             <span class="dt">m =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb502-4" data-line-number="4"></a>
<a class="sourceLine" id="cb502-5" data-line-number="5"><span class="kw">predict</span>(b5<span class="fl">.3</span>_A,</a>
<a class="sourceLine" id="cb502-6" data-line-number="6">        <span class="dt">resp =</span> <span class="st">&quot;d&quot;</span>,</a>
<a class="sourceLine" id="cb502-7" data-line-number="7">        <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb502-8" data-line-number="8">        <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-9" data-line-number="9"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-10" data-line-number="10"><span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;a20&quot;</span>, <span class="st">&quot;a30&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> a30 <span class="op">-</span><span class="st"> </span>a20) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-12" data-line-number="12"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(difference))</a></code></pre></div>
<pre><code>##        mean
## 1 -4.862944</code></pre>
<blockquote>
<p>The trick with simulating counterfactuals is to realize that when we manipulate some variable <span class="math inline">\(X\)</span>, we break the causal influence of other variables on <span class="math inline">\(X\)</span>. This is the same as saying we modify the DAG so that no arrows enter <span class="math inline">\(X\)</span>. Suppose for example that we now simulate the effect of manipulating <span class="math inline">\(M\)</span>. (p. 143)</p>
</blockquote>
<p>Here’s how to plot that DAG.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1">dag_coords &lt;-</a>
<a class="sourceLine" id="cb504-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;D&quot;</span>),</a>
<a class="sourceLine" id="cb504-3" data-line-number="3">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb504-4" data-line-number="4">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb504-5" data-line-number="5"></a>
<a class="sourceLine" id="cb504-6" data-line-number="6"><span class="kw">dagify</span>(D <span class="op">~</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span>M,</a>
<a class="sourceLine" id="cb504-7" data-line-number="7">       <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb504-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb504-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb504-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb504-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-51-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Here’s the new counterfactual plot focusing on <span class="math inline">\(M \rightarrow D\)</span>, holding <span class="math inline">\(A = 0\)</span>, Figure 5.7.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">m =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb505-2" data-line-number="2">             <span class="dt">a =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb505-3" data-line-number="3"></a>
<a class="sourceLine" id="cb505-4" data-line-number="4"><span class="kw">predict</span>(b5<span class="fl">.3</span>_A,</a>
<a class="sourceLine" id="cb505-5" data-line-number="5">        <span class="dt">resp =</span> <span class="st">&quot;d&quot;</span>,</a>
<a class="sourceLine" id="cb505-6" data-line-number="6">        <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb505-7" data-line-number="7"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb505-8" data-line-number="8"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb505-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb505-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> m, <span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb505-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb505-12" data-line-number="12">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb505-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Total counterfactual effect of M on D&quot;</span>,</a>
<a class="sourceLine" id="cb505-14" data-line-number="14">       <span class="dt">x =</span> <span class="st">&quot;manipulated M&quot;</span>,</a>
<a class="sourceLine" id="cb505-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;counterfactual D&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb505-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb505-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb505-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-52-1.png" width="288" style="display: block; margin: auto;" /></p>
<div id="overthinking-simulating-counterfactuals." class="section level5">
<h5><span class="header-section-number">5.1.5.3.1</span> Overthinking: Simulating counterfactuals.</h5>
<p>Just like McElreath showed how to compute the counterfactuals without his <code>sim()</code> function, we can make ours without <code>brms::predict()</code>. First we’ll start out extracting the posterior draws.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" data-line-number="1">post &lt;-</a>
<a class="sourceLine" id="cb506-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(b5<span class="fl">.3</span>_A) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb506-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>())</a></code></pre></div>
<p>Here we use <code>expand()</code> elongate the output from above by a factor of thirty, each time corresponding to one of the levels of <code>a = seq(from = -2, to = 2, length.out = 30)</code>. In the two <code>mutate()</code> lines that follow, we plug the model formulas into the <code>rnorm()</code> function to take random draws from posterior predictive distribution. The rest is just wrangling and summarizing.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" data-line-number="1">post &lt;-</a>
<a class="sourceLine" id="cb507-2" data-line-number="2"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-3" data-line-number="3"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, b_m_Intercept, b_m_a, sigma_m, b_d_Intercept, b_d_a, b_d_m, sigma_d),</a>
<a class="sourceLine" id="cb507-4" data-line-number="4">         <span class="dt">a =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-2</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_sim =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), <span class="dt">mean =</span> b_m_Intercept <span class="op">+</span><span class="st"> </span>b_m_a <span class="op">*</span><span class="st"> </span>a, <span class="dt">sd =</span> sigma_m)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_sim =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), <span class="dt">mean =</span> b_d_Intercept <span class="op">+</span><span class="st"> </span>b_d_a <span class="op">*</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b_d_m <span class="op">*</span><span class="st"> </span>m_sim, <span class="dt">sd =</span> sigma_d)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">ends_with</span>(<span class="st">&quot;sim&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(a, name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb507-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb507-10" data-line-number="10">            <span class="dt">ll =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb507-11" data-line-number="11">            <span class="dt">ul =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>))</a>
<a class="sourceLine" id="cb507-12" data-line-number="12"></a>
<a class="sourceLine" id="cb507-13" data-line-number="13"><span class="co"># what did we do?</span></a>
<a class="sourceLine" id="cb507-14" data-line-number="14"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   a [3]
##       a name   mean     ll    ul
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 -2    d_sim 1.14  -0.593  2.85
## 2 -2    m_sim 1.40  -0.107  2.89
## 3 -1.86 d_sim 1.04  -0.589  2.71
## 4 -1.86 m_sim 1.30  -0.219  2.70
## 5 -1.72 d_sim 0.989 -0.709  2.75
## 6 -1.72 m_sim 1.18  -0.318  2.63</code></pre>
<p>Now we plot.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb509-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb509-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dv =</span> <span class="kw">if_else</span>(name <span class="op">==</span><span class="st"> &quot;d_sim&quot;</span>, <span class="st">&quot;predictions for D&quot;</span>, <span class="st">&quot;predictions for M&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb509-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb509-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> mean, <span class="dt">ymin =</span> ll, <span class="dt">ymax =</span> ul)) <span class="op">+</span></a>
<a class="sourceLine" id="cb509-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb509-6" data-line-number="6">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb509-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Hand-made counterfactual plots for the multivariate divorce model&quot;</span>,</a>
<a class="sourceLine" id="cb509-8" data-line-number="8">       <span class="dt">x =</span> <span class="st">&quot;manipulated A&quot;</span>,</a>
<a class="sourceLine" id="cb509-9" data-line-number="9">       <span class="dt">y =</span> <span class="st">&quot;counterfactual&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb509-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb509-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb509-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb509-13" data-line-number="13">        <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb509-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>dv)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-55-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>
<div id="masked-relationship" class="section level2">
<h2><span class="header-section-number">5.2</span> Masked relationship</h2>
<blockquote>
<p>A second reason to use more than one predictor variable is to measure the direct influences of multiple factors on an outcome, when none of those influences is apparent from bivariate relationships. This kind of problem tends to arise when there are two predictor variables that are correlated with one another. However, one of these is positively correlated with the outcome and the other is negatively correlated with it. (p. 144)</p>
</blockquote>
<p>Let’s load the <span class="citation">Hinde &amp; Milligan (<a href="#ref-hindePrimateMilkProximate2011">2011</a>)</span> milk data.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb510-2" data-line-number="2"><span class="kw">data</span>(milk)</a>
<a class="sourceLine" id="cb510-3" data-line-number="3">d &lt;-<span class="st"> </span>milk</a>
<a class="sourceLine" id="cb510-4" data-line-number="4"></a>
<a class="sourceLine" id="cb510-5" data-line-number="5"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<pre><code>## Rows: 29
## Columns: 8
## $ clade          &lt;fct&gt; Strepsirrhine, Strepsirrhine, Strepsirrhine, Strepsirrhine, Strepsirrhine,…
## $ species        &lt;fct&gt; Eulemur fulvus, E macaco, E mongoz, E rubriventer, Lemur catta, Alouatta s…
## $ kcal.per.g     &lt;dbl&gt; 0.49, 0.51, 0.46, 0.48, 0.60, 0.47, 0.56, 0.89, 0.91, 0.92, 0.80, 0.46, 0.…
## $ perc.fat       &lt;dbl&gt; 16.60, 19.27, 14.11, 14.91, 27.28, 21.22, 29.66, 53.41, 46.08, 50.58, 41.3…
## $ perc.protein   &lt;dbl&gt; 15.42, 16.91, 16.85, 13.18, 19.50, 23.58, 23.46, 15.80, 23.34, 22.33, 20.8…
## $ perc.lactose   &lt;dbl&gt; 67.98, 63.82, 69.04, 71.91, 53.22, 55.20, 46.88, 30.79, 30.58, 27.09, 37.8…
## $ mass           &lt;dbl&gt; 1.95, 2.09, 2.51, 1.62, 2.19, 5.25, 5.37, 2.51, 0.71, 0.68, 0.12, 0.47, 0.…
## $ neocortex.perc &lt;dbl&gt; 55.16, NA, NA, NA, NA, 64.54, 64.54, 67.64, NA, 68.85, 58.85, 61.69, 60.32…</code></pre>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1"><span class="kw">rm</span>(milk)</a>
<a class="sourceLine" id="cb512-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb512-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>You might inspect the primary variables in the data like this.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb513-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb513-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(kcal.per.g, mass, neocortex.perc) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb513-3" data-line-number="3"><span class="st">  </span><span class="kw">pairs</span>(<span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-58-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>By just looking at that mess, do you think you could describe the associations of <code>mass</code> and <code>neocortex.perc</code> with the criterion, <code>kcal.per.g</code>? I couldn’t. It’s a good thing we have math.</p>
<p>Let’s standardize our variables by hand.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb514-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb514-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">kcal.per.g_s     =</span> (kcal.per.g <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(kcal.per.g)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(kcal.per.g), </a>
<a class="sourceLine" id="cb514-4" data-line-number="4">         <span class="dt">log_mass_s       =</span> (<span class="kw">log</span>(mass) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(<span class="kw">log</span>(mass))) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(<span class="kw">log</span>(mass)), </a>
<a class="sourceLine" id="cb514-5" data-line-number="5">         <span class="dt">neocortex.perc_s =</span> (neocortex.perc <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(neocortex.perc, <span class="dt">na.rm =</span> T)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(neocortex.perc, <span class="dt">na.rm =</span> T))</a></code></pre></div>
<p>McElreath has us starting off our first <code>milk</code> model with more permissive priors than we’ve used in the past. Although we should note that from a historical perspective, these priors are pretty informative. Times keep changing.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" data-line-number="1">b5<span class="fl">.5</span>_draft &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb515-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb515-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb515-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>neocortex.perc_s,</a>
<a class="sourceLine" id="cb515-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb515-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb515-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb515-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb515-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb515-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb515-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.05_draft&quot;</span>)</a></code></pre></div>
<p>Similar to the <strong>rethinking</strong> example in the text, <strong>brms</strong> warned that “Rows containing NAs were excluded from the model.” This isn’t necessarily a problem; the model fit just fine. But we should be ashamed of ourselves and look eagerly forward to Chapter 14 where we’ll learn how to do better.</p>
<p>To compliment how McElreath removed cases with missing values on our variables of interest with base <strong>R</strong> <code>complete.cases()</code>, here we’ll do so with <code>tidyr::drop_na()</code> and a little help with <code>ends_with()</code>.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1">dcc &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb516-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb516-3" data-line-number="3"><span class="st">  </span><span class="kw">drop_na</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_s&quot;</span>))</a>
<a class="sourceLine" id="cb516-4" data-line-number="4"></a>
<a class="sourceLine" id="cb516-5" data-line-number="5"><span class="co"># how many rows did we drop?</span></a>
<a class="sourceLine" id="cb516-6" data-line-number="6"><span class="kw">nrow</span>(d) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(dcc)</a></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>We’ll use <code>update()</code> to refit the model with the altered data.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1">b5<span class="fl">.5</span>_draft &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb518-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.5</span>_draft,</a>
<a class="sourceLine" id="cb518-3" data-line-number="3">         <span class="dt">newdata =</span> dcc,</a>
<a class="sourceLine" id="cb518-4" data-line-number="4">         <span class="dt">seed =</span> <span class="dv">5</span>)</a></code></pre></div>
<p>“Before considering the posterior predictions, let’s consider those priors. As in many simple linear regression problems, these priors are harmless. But are they reasonable?” (p. 144). Let’s find out with our version of Figure 5.8.a.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb519-2" data-line-number="2"></a>
<a class="sourceLine" id="cb519-3" data-line-number="3"><span class="kw">prior_samples</span>(b5<span class="fl">.5</span>_draft) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb519-4" data-line-number="4"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb519-5" data-line-number="5"><span class="st">  </span><span class="kw">rownames_to_column</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb519-6" data-line-number="6"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(rowname, Intercept, b),</a>
<a class="sourceLine" id="cb519-7" data-line-number="7">         <span class="dt">neocortex.perc_s =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb519-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">kcal.per.g_s =</span> Intercept <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>neocortex.perc_s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb519-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb519-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc_s, <span class="dt">y =</span> kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb519-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> rowname),</a>
<a class="sourceLine" id="cb519-12" data-line-number="12">            <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb519-13" data-line-number="13"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb519-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;neocortex percent (std)&quot;</span>,</a>
<a class="sourceLine" id="cb519-15" data-line-number="15">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>,</a>
<a class="sourceLine" id="cb519-16" data-line-number="16">       <span class="dt">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(0, 1)</span><span class="ch">\n</span><span class="st">b ~ dnorm(0, 1)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb519-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb519-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-61-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>That’s a mess. How’d the posterior turn out?</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.5</span>_draft)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 1 + neocortex.perc_s 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.10      0.27    -0.44     0.63 1.00     3332     2518
## neocortex.perc_s     0.16      0.27    -0.40     0.71 1.00     3075     2077
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.14      0.21     0.81     1.61 1.00     2952     2747
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Let’s tighten up our priors and fit <code>b5.5</code>.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1">b5<span class="fl">.5</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb522-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dcc, </a>
<a class="sourceLine" id="cb522-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb522-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>neocortex.perc_s,</a>
<a class="sourceLine" id="cb522-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb522-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb522-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb522-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb522-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb522-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb522-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.05&quot;</span>)</a></code></pre></div>
<p>Now make our version of Figure 5.8.b.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb523-2" data-line-number="2"><span class="kw">prior_samples</span>(b5<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-3" data-line-number="3"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-4" data-line-number="4"><span class="st">  </span><span class="kw">rownames_to_column</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-5" data-line-number="5"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(rowname, Intercept, b),</a>
<a class="sourceLine" id="cb523-6" data-line-number="6">         <span class="dt">neocortex.perc_s =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">kcal.per.g_s =</span> Intercept <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>neocortex.perc_s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb523-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb523-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc_s, <span class="dt">y =</span> kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb523-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> rowname),</a>
<a class="sourceLine" id="cb523-11" data-line-number="11">            <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb523-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb523-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;neocortex percent (std)&quot;</span>,</a>
<a class="sourceLine" id="cb523-14" data-line-number="14">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>,</a>
<a class="sourceLine" id="cb523-15" data-line-number="15">       <span class="dt">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(0, 0.2)</span><span class="ch">\n</span><span class="st">b ~ dnorm(0, 0.5)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb523-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb523-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) </a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-63-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Inspect the parameter summary.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 1 + neocortex.perc_s 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.04      0.16    -0.28     0.34 1.00     3568     2651
## neocortex.perc_s     0.12      0.24    -0.36     0.58 1.00     3028     2556
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.11      0.20     0.80     1.58 1.00     2917     2283
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The results are very similar to those returned earlier from <code>print(b5.5_draft)</code>. It’s not in the text, but let’s compare the parameter estimates between the two models with another version of our homemade <code>coeftab()</code> plot.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" data-line-number="1"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb526-2" data-line-number="2"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb526-3" data-line-number="3">  <span class="kw">posterior_samples</span>(b5<span class="fl">.5</span>_draft) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(b_Intercept<span class="op">:</span>sigma),</a>
<a class="sourceLine" id="cb526-4" data-line-number="4">  <span class="kw">posterior_samples</span>(b5<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(b_Intercept<span class="op">:</span>sigma)</a>
<a class="sourceLine" id="cb526-5" data-line-number="5">  )  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;b5.5_draft&quot;</span>, <span class="st">&quot;b5.5&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>fit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(name, fit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb526-10" data-line-number="10">            <span class="dt">ll =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb526-11" data-line-number="11">            <span class="dt">ul =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> <span class="kw">factor</span>(fit, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;b5.5_draft&quot;</span>, <span class="st">&quot;b5.5&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb526-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb526-14" data-line-number="14"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb526-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">y =</span> fit, <span class="dt">xmin =</span> ll, <span class="dt">xmax =</span> ul)) <span class="op">+</span></a>
<a class="sourceLine" id="cb526-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb526-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb526-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;posterior&quot;</span>, </a>
<a class="sourceLine" id="cb526-19" data-line-number="19">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb526-20" data-line-number="20"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb526-21" data-line-number="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb526-22" data-line-number="22">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb526-23" data-line-number="23">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb526-24" data-line-number="24">        <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb526-25" data-line-number="25"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-65-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>The results were quite similar, but the estimates from <code>b5.5</code> are more precise. Let’s get back on track with the text and make the top left panel of Figure 5.9. Just for kicks, we’ll superimpose 50% intervals atop 95% intervals for the next few plots. Here’s Figure 5.9, top left.</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb527-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">neocortex.perc_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb527-2" data-line-number="2"></a>
<a class="sourceLine" id="cb527-3" data-line-number="3"><span class="kw">fitted</span>(b5<span class="fl">.5</span>, </a>
<a class="sourceLine" id="cb527-4" data-line-number="4">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb527-5" data-line-number="5">       <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>, <span class="fl">.25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb527-6" data-line-number="6"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb527-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb527-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb527-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb527-11" data-line-number="11">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),</a>
<a class="sourceLine" id="cb527-13" data-line-number="13">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb527-14" data-line-number="14">              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, </a>
<a class="sourceLine" id="cb527-16" data-line-number="16">             <span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc_s, <span class="dt">y =</span> kcal.per.g_s),</a>
<a class="sourceLine" id="cb527-17" data-line-number="17">             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-18" data-line-number="18"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>neocortex.perc_s), </a>
<a class="sourceLine" id="cb527-19" data-line-number="19">                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;neocortex percent (std)&quot;</span>,</a>
<a class="sourceLine" id="cb527-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb527-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb527-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-66-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Do note the <code>probs</code> argument in the <code>fitted()</code> code, above.</p>
<p>Now we use <code>log_mass_s</code> as the new sole predictor.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" data-line-number="1">b5<span class="fl">.6</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb528-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dcc, </a>
<a class="sourceLine" id="cb528-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb528-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_mass_s,</a>
<a class="sourceLine" id="cb528-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb528-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb528-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb528-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb528-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb528-10" data-line-number="10">      <span class="dt">sample_prior =</span> T,</a>
<a class="sourceLine" id="cb528-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.06&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb529-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.6</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 1 + log_mass_s 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept      0.05      0.16    -0.26     0.36 1.00     3320     2765
## log_mass_s    -0.28      0.21    -0.69     0.13 1.00     3284     2586
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.06      0.19     0.75     1.52 1.00     3388     2359
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Make Figure 5.9, top right.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">log_mass_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="fl">2.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb531-2" data-line-number="2"></a>
<a class="sourceLine" id="cb531-3" data-line-number="3"><span class="kw">fitted</span>(b5<span class="fl">.6</span>, </a>
<a class="sourceLine" id="cb531-4" data-line-number="4">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb531-5" data-line-number="5">       <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>, <span class="fl">.25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb531-6" data-line-number="6"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb531-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb531-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb531-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_mass_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb531-11" data-line-number="11">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),</a>
<a class="sourceLine" id="cb531-13" data-line-number="13">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb531-14" data-line-number="14">              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, </a>
<a class="sourceLine" id="cb531-16" data-line-number="16">             <span class="kw">aes</span>(<span class="dt">x =</span> log_mass_s, <span class="dt">y =</span> kcal.per.g_s),</a>
<a class="sourceLine" id="cb531-17" data-line-number="17">             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-18" data-line-number="18"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>log_mass_s), </a>
<a class="sourceLine" id="cb531-19" data-line-number="19">                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;log body mass (std)&quot;</span>,</a>
<a class="sourceLine" id="cb531-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb531-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb531-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-68-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Finally, we’re ready to fit with both predictors included in a multivariable model. The statistical formula is</p>
<p><span class="math display">\[
\begin{align*}
\text{kcal.per.g_s}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + \beta_1 \text{neocortex.perc_s}_i + \beta_2 \text{log_mass_s} \\
\alpha  &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\beta_2 &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma  &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1">b5<span class="fl">.7</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb532-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dcc, </a>
<a class="sourceLine" id="cb532-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb532-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>neocortex.perc_s <span class="op">+</span><span class="st"> </span>log_mass_s,</a>
<a class="sourceLine" id="cb532-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb532-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb532-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb532-8" data-line-number="8">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb532-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb532-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.07&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb533-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.7</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 1 + neocortex.perc_s + log_mass_s 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.06      0.15    -0.23     0.34 1.00     3249     2504
## neocortex.perc_s     0.60      0.29    -0.00     1.12 1.00     2389     2369
## log_mass_s          -0.64      0.25    -1.10    -0.10 1.00     2315     2397
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.87      0.18     0.59     1.29 1.00     2587     2564
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Once again, let’s roll out our homemade <code>coefplot()</code> plot code.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" data-line-number="1"><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb535-2" data-line-number="2">  <span class="kw">posterior_samples</span>(b5<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-3" data-line-number="3"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.5_beta[N]</span><span class="st">`</span> =<span class="st"> </span>b_neocortex.perc_s),</a>
<a class="sourceLine" id="cb535-4" data-line-number="4">  <span class="kw">posterior_samples</span>(b5<span class="fl">.6</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-5" data-line-number="5"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.6_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_log_mass_s),</a>
<a class="sourceLine" id="cb535-6" data-line-number="6">  <span class="kw">posterior_samples</span>(b5<span class="fl">.7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-7" data-line-number="7"><span class="st">    </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">b5.7_beta[N]</span><span class="st">`</span> =<span class="st"> </span>b_neocortex.perc_s,</a>
<a class="sourceLine" id="cb535-8" data-line-number="8">              <span class="st">`</span><span class="dt">b5.7_beta[M]</span><span class="st">`</span> =<span class="st"> </span>b_log_mass_s)</a>
<a class="sourceLine" id="cb535-9" data-line-number="9">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-10" data-line-number="10"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-11" data-line-number="11"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-12" data-line-number="12"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb535-13" data-line-number="13">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb535-14" data-line-number="14">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-15" data-line-number="15"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb535-16" data-line-number="16"><span class="st">  </span><span class="co"># complete(fit, parameter) %&gt;% </span></a>
<a class="sourceLine" id="cb535-17" data-line-number="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb535-18" data-line-number="18"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">y =</span> fit, <span class="dt">xmin =</span> ll, <span class="dt">xmax =</span> ul)) <span class="op">+</span></a>
<a class="sourceLine" id="cb535-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb535-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb535-21" data-line-number="21"><span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb535-22" data-line-number="22"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb535-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb535-24" data-line-number="24">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb535-25" data-line-number="25"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-70-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>McElreath suggested we look at a pairs plot to get a sense of the zero-order corrleations. We did that once with the raw data. Here it is, again, but with the transformed varaibles.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1">dcc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_s&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-3" data-line-number="3"><span class="st">  </span><span class="kw">pairs</span>(<span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-71-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>Have you noticed how un-<strong>tidyverse</strong>-like those <code>pairs()</code> plots are? I have. Within the <strong>tidyverse</strong>, you can make custom pairs plots with <a href="https://CRAN.R-project.org/package=GGally">GGally</a> <span class="citation">(Schloerke et al., <a href="#ref-R-GGally">2020</a>)</span>, which will also compute the point estimates for the bivariate correlations. Here’s a default-style plot.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" data-line-number="1"><span class="co">#install.packages(&quot;GGally&quot;, dependencies = T)</span></a>
<a class="sourceLine" id="cb537-2" data-line-number="2"><span class="kw">library</span>(GGally)</a>
<a class="sourceLine" id="cb537-3" data-line-number="3"></a>
<a class="sourceLine" id="cb537-4" data-line-number="4">dcc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb537-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_s&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb537-6" data-line-number="6"><span class="st">  </span><span class="kw">ggpairs</span>()</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-72-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>But you can customize <a href="http://ggobi.github.io/ggally/">these</a>, too. E.g.,</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1">my_diag &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb538-2" data-line-number="2">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb538-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb538-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb538-5" data-line-number="5"></a>
<a class="sourceLine" id="cb538-6" data-line-number="6">my_lower &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...) {</a>
<a class="sourceLine" id="cb538-7" data-line-number="7">  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb538-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb538-9" data-line-number="9">                <span class="dt">se =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb538-10" data-line-number="10"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.8</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb538-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb538-12" data-line-number="12"></a>
<a class="sourceLine" id="cb538-13" data-line-number="13"><span class="co"># Then plug those custom functions into `ggpairs()`</span></a>
<a class="sourceLine" id="cb538-14" data-line-number="14">dcc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb538-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_s&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb538-16" data-line-number="16"><span class="st">  </span><span class="kw">ggpairs</span>(<span class="dt">diag  =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),</a>
<a class="sourceLine" id="cb538-17" data-line-number="17">          <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb538-18" data-line-number="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb538-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb538-20" data-line-number="20">        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb538-21" data-line-number="21">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb538-22" data-line-number="22">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>))</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-73-1.png" width="336" style="display: block; margin: auto;" /></p>
<blockquote>
<p>What the regression model does is ask if species that have high neocortex percent <em>for their body mass</em> have higher milk energy. Likewise, the model asks if species with high body mass <em>for their neocortex percent</em> have higher milk energy. Bigger species, like apes, have milk with less energy. But species with more neocortex tend to have richer milk. The fact that these two variables, body size and neocortex, are correlated across species makes it hard to see these relationships, unless we statistically account for both.</p>
<p>Some DAGs will help. (p. 148, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Here are three. I’m not aware we can facet <code>dagify()</code> objects. But we can take cues from Chapter 4 to link our three DAGs like McElreath did his. first, we’ll recognize the <strong>ggplot2</strong> code will be nearly identical for each DAG. So we can just wrap the <strong>ggplot2</strong> code into a compact function, like so.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb539-1" data-line-number="1">gg_dag &lt;-<span class="st"> </span><span class="cf">function</span>(d) {</a>
<a class="sourceLine" id="cb539-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb539-3" data-line-number="3">  d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb539-4" data-line-number="4"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-9" data-line-number="9"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb539-10" data-line-number="10"><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb539-11" data-line-number="11"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a>
<a class="sourceLine" id="cb539-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb539-13" data-line-number="13">}</a></code></pre></div>
<p>Now we’ll make the three individual DAGs, saving each.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="co"># left DAG</span></a>
<a class="sourceLine" id="cb540-2" data-line-number="2">dag_coords &lt;-</a>
<a class="sourceLine" id="cb540-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;K&quot;</span>),</a>
<a class="sourceLine" id="cb540-4" data-line-number="4">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb540-5" data-line-number="5">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb540-6" data-line-number="6"></a>
<a class="sourceLine" id="cb540-7" data-line-number="7">p1 &lt;-</a>
<a class="sourceLine" id="cb540-8" data-line-number="8"><span class="st">  </span><span class="kw">dagify</span>(N <span class="op">~</span><span class="st"> </span>M,</a>
<a class="sourceLine" id="cb540-9" data-line-number="9">         K <span class="op">~</span><span class="st"> </span>M <span class="op">+</span><span class="st"> </span>N,</a>
<a class="sourceLine" id="cb540-10" data-line-number="10">         <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb540-11" data-line-number="11"><span class="st">  </span><span class="kw">gg_dag</span>()</a>
<a class="sourceLine" id="cb540-12" data-line-number="12"></a>
<a class="sourceLine" id="cb540-13" data-line-number="13"><span class="co"># middle DAG</span></a>
<a class="sourceLine" id="cb540-14" data-line-number="14">p2 &lt;-</a>
<a class="sourceLine" id="cb540-15" data-line-number="15"><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>N,</a>
<a class="sourceLine" id="cb540-16" data-line-number="16">         K <span class="op">~</span><span class="st"> </span>M <span class="op">+</span><span class="st"> </span>N,</a>
<a class="sourceLine" id="cb540-17" data-line-number="17">         <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb540-18" data-line-number="18"><span class="st">  </span><span class="kw">gg_dag</span>()</a>
<a class="sourceLine" id="cb540-19" data-line-number="19"></a>
<a class="sourceLine" id="cb540-20" data-line-number="20"><span class="co"># right DAG</span></a>
<a class="sourceLine" id="cb540-21" data-line-number="21">dag_coords &lt;-</a>
<a class="sourceLine" id="cb540-22" data-line-number="22"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;U&quot;</span>),</a>
<a class="sourceLine" id="cb540-23" data-line-number="23">         <span class="dt">x    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb540-24" data-line-number="24">         <span class="dt">y    =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb540-25" data-line-number="25">p3 &lt;-</a>
<a class="sourceLine" id="cb540-26" data-line-number="26"><span class="st">  </span><span class="kw">dagify</span>(M <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb540-27" data-line-number="27">         N <span class="op">~</span><span class="st"> </span>U,</a>
<a class="sourceLine" id="cb540-28" data-line-number="28">         K <span class="op">~</span><span class="st"> </span>M <span class="op">+</span><span class="st"> </span>N,</a>
<a class="sourceLine" id="cb540-29" data-line-number="29">         <span class="dt">coords =</span> dag_coords) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb540-30" data-line-number="30"><span class="st">  </span><span class="kw">gg_dag</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb540-31" data-line-number="31"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">x =</span> <span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb540-32" data-line-number="32">             <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">stroke =</span> <span class="fl">1.25</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>)</a></code></pre></div>
<p>Now we combine our <code>gg_dag()</code> plots together with <strong>patchwork</strong> syntax.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb541-1" data-line-number="1">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-76-1.png" width="768" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Which of these graphs is right? We can’t tell from the data alone, because these graphs imply the same set of <strong>conditional independencies</strong>. In this case, there are no conditional independencies–each DAG above implies that all pairs of variables are associated, regardless of what we condition on. A set of DAGs with the same conditional independencies is known as a <strong>Markov equivalence</strong> set. (p. 151, <strong>emphasis</strong> in the original).</p>
</blockquote>
<p>Let’s make the counterfactual plots at the bottom of Figure 5.9. Here’s the one on the left.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">neocortex.perc_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb542-2" data-line-number="2">             <span class="dt">log_mass_s =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb542-3" data-line-number="3"></a>
<a class="sourceLine" id="cb542-4" data-line-number="4">p1 &lt;-</a>
<a class="sourceLine" id="cb542-5" data-line-number="5"><span class="st">  </span><span class="kw">fitted</span>(b5<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb542-6" data-line-number="6">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb542-7" data-line-number="7">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>, <span class="fl">.25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb542-8" data-line-number="8"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb542-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb542-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb542-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb542-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb542-13" data-line-number="13">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb542-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),</a>
<a class="sourceLine" id="cb542-15" data-line-number="15">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb542-16" data-line-number="16">              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb542-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>neocortex.perc_s), </a>
<a class="sourceLine" id="cb542-18" data-line-number="18">                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb542-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Counterfactual holding M = 0&quot;</span>, </a>
<a class="sourceLine" id="cb542-20" data-line-number="20">       <span class="dt">x =</span> <span class="st">&quot;neocortex percent (std)&quot;</span>,</a>
<a class="sourceLine" id="cb542-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>)</a></code></pre></div>
<p>Now make Figure 5.8, bottom right, and combine the two.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb543-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">log_mass_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-2.5</span>, <span class="dt">to =</span> <span class="fl">2.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb543-2" data-line-number="2">             <span class="dt">neocortex.perc_s =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb543-3" data-line-number="3"></a>
<a class="sourceLine" id="cb543-4" data-line-number="4">p2 &lt;-</a>
<a class="sourceLine" id="cb543-5" data-line-number="5"><span class="st">  </span><span class="kw">fitted</span>(b5<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb543-6" data-line-number="6">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb543-7" data-line-number="7">         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">.975</span>, <span class="fl">.25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb543-8" data-line-number="8"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb543-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb543-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb543-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_mass_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span></a>
<a class="sourceLine" id="cb543-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb543-13" data-line-number="13">              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb543-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),</a>
<a class="sourceLine" id="cb543-15" data-line-number="15">              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,</a>
<a class="sourceLine" id="cb543-16" data-line-number="16">              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb543-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>log_mass_s), </a>
<a class="sourceLine" id="cb543-18" data-line-number="18">                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g_s)) <span class="op">+</span></a>
<a class="sourceLine" id="cb543-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Counterfactual holding N = 0&quot;</span>,</a>
<a class="sourceLine" id="cb543-20" data-line-number="20">       <span class="dt">x =</span> <span class="st">&quot;log body mass (std)&quot;</span>,</a>
<a class="sourceLine" id="cb543-21" data-line-number="21">       <span class="dt">y =</span> <span class="st">&quot;kilocal per g (std)&quot;</span>)</a>
<a class="sourceLine" id="cb543-22" data-line-number="22"></a>
<a class="sourceLine" id="cb543-23" data-line-number="23"><span class="co"># combine</span></a>
<a class="sourceLine" id="cb543-24" data-line-number="24">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb543-25" data-line-number="25"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Figure 5.9 [bottom row]. Milk energy and neocortex among primates.&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb543-26" data-line-number="26"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb543-27" data-line-number="27"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-78-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="overthinking-simulating-a-masking-relationship." class="section level4">
<h4><span class="header-section-number">5.2.0.1</span> Overthinking: Simulating a masking relationship.</h4>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1"><span class="co"># how many cases would you like?</span></a>
<a class="sourceLine" id="cb544-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb544-3" data-line-number="3"></a>
<a class="sourceLine" id="cb544-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb544-5" data-line-number="5">d_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb544-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">m =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb544-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> m, <span class="dt">sd =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb544-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">k =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> n <span class="op">-</span><span class="st"> </span>m, <span class="dt">sd =</span> <span class="dv">1</span>))</a></code></pre></div>
<p>Use <code>ggpairs()</code> to get a sense of what we just simulated.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb545-1" data-line-number="1">d_sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb545-2" data-line-number="2"><span class="st">  </span><span class="kw">ggpairs</span>(<span class="dt">diag  =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),</a>
<a class="sourceLine" id="cb545-3" data-line-number="3">          <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb545-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb545-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb545-6" data-line-number="6">        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb545-7" data-line-number="7">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb545-8" data-line-number="8">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>))</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-80-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Here we fit the simulation models with a little help from the <code>update()</code> function.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1">b5<span class="fl">.7</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb546-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb546-3" data-line-number="3">         <span class="dt">newdata =</span> d_sim,</a>
<a class="sourceLine" id="cb546-4" data-line-number="4">         <span class="dt">formula =</span> k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>n <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb546-5" data-line-number="5">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb546-6" data-line-number="6">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.07_sim&quot;</span>)</a>
<a class="sourceLine" id="cb546-7" data-line-number="7"></a>
<a class="sourceLine" id="cb546-8" data-line-number="8">b5<span class="fl">.5</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb546-9" data-line-number="9"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.7</span>_sim,</a>
<a class="sourceLine" id="cb546-10" data-line-number="10">         <span class="dt">formula =</span> k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>n,</a>
<a class="sourceLine" id="cb546-11" data-line-number="11">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb546-12" data-line-number="12">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.05_sim&quot;</span>)</a>
<a class="sourceLine" id="cb546-13" data-line-number="13"></a>
<a class="sourceLine" id="cb546-14" data-line-number="14">b5<span class="fl">.6</span>_sim &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb546-15" data-line-number="15"><span class="st">  </span><span class="kw">update</span>(b5<span class="fl">.7</span>_sim,</a>
<a class="sourceLine" id="cb546-16" data-line-number="16">         <span class="dt">formula =</span> k <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>m,</a>
<a class="sourceLine" id="cb546-17" data-line-number="17">         <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb546-18" data-line-number="18">         <span class="dt">file =</span> <span class="st">&quot;fits/b05.06_sim&quot;</span>)</a></code></pre></div>
<p>Compare the coefficients.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb547-1" data-line-number="1"><span class="kw">fixef</span>(b5<span class="fl">.5</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    -0.02      0.10 -0.21  0.18
## n             0.58      0.08  0.43  0.73</code></pre>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb549-1" data-line-number="1"><span class="kw">fixef</span>(b5<span class="fl">.6</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept     0.00      0.12 -0.23  0.23
## m             0.17      0.15 -0.12  0.46</code></pre>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1"><span class="kw">fixef</span>(b5<span class="fl">.7</span>_sim) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    -0.01      0.09 -0.18  0.17
## n             0.98      0.09  0.79  1.16
## m            -0.88      0.15 -1.16 -0.59</code></pre>
<p>Due to space considerations, I’m not going to show the code corresponding to the other two DAGs from the <strong>R</strong> code 5.43 block. Rather, I’ll leave that as an exercise for the interested reader.</p>
<p>Let’s do the preliminary work to making our DAGs.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1">dag5<span class="fl">.7</span> &lt;-<span class="st"> </span><span class="kw">dagitty</span>(<span class="st">&quot;dag{ M -&gt; K &lt;- N M -&gt; N }&quot;</span> )</a>
<a class="sourceLine" id="cb553-2" data-line-number="2"></a>
<a class="sourceLine" id="cb553-3" data-line-number="3"><span class="kw">coordinates</span>(dag5<span class="fl">.7</span>) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dt">M =</span> <span class="dv">0</span>, <span class="dt">K =</span> <span class="dv">1</span>, <span class="dt">N =</span> <span class="dv">2</span>), </a>
<a class="sourceLine" id="cb553-4" data-line-number="4">                            <span class="dt">y =</span> <span class="kw">c</span>(<span class="dt">M =</span> <span class="fl">0.5</span>, <span class="dt">K =</span> <span class="dv">1</span>, <span class="dt">N =</span> <span class="fl">0.5</span>)) </a></code></pre></div>
<p>If you just want a quick default plot, <code>ggdag::ggdag_equivalent_dags()</code> is the way to go.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" data-line-number="1"><span class="kw">ggdag_equivalent_dags</span>(dag5<span class="fl">.7</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-83-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>However, if you’d like to customize your DAGs, start with the <code>ggdag::node_equivalent_dags()</code> function and build from there.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" data-line-number="1">dag5<span class="fl">.7</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb555-2" data-line-number="2"><span class="st">  </span><span class="kw">node_equivalent_dags</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb555-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> xend, <span class="dt">yend =</span> yend)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb555-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_dag_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_dag_text</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_dag_edges</span>(<span class="dt">edge_color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb555-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb555-11" data-line-number="11">        <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb555-12" data-line-number="12"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>dag)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-84-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>These all demonstrate Markov equivalence. I should note that I <a href="https://github.com/malcolmbarrett/ggdag/issues/41">got help</a> from the great <a href="https://twitter.com/malco_barrett">Malcolm Barrett</a> on how to make this plot with <strong>ggdag</strong>.</p>
</div>
</div>
<div id="categorical-varaibles" class="section level2">
<h2><span class="header-section-number">5.3</span> Categorical varaibles</h2>
<blockquote>
<p>Many readers will already know that variables like this, routinely called <strong>factors</strong>, can easily be included in linear models. But what is not widely understood is how these variables are represented in a model… Knowing how the machine (golem) works both helps you interpret the posterior distribution and gives you additional power in building the model. (p. 153, <strong>emphasis</strong> in the original)</p>
</blockquote>
<div id="binary-categories." class="section level3">
<h3><span class="header-section-number">5.3.1</span> Binary categories.</h3>
<p>Reload the <code>Howell1</code> data.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb556-2" data-line-number="2"><span class="kw">data</span>(Howell1)</a>
<a class="sourceLine" id="cb556-3" data-line-number="3">d &lt;-<span class="st"> </span>Howell1</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1"><span class="kw">rm</span>(Howell1)</a>
<a class="sourceLine" id="cb557-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb557-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>If you forgot what these data were like, take a <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb558-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb558-2" data-line-number="2"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Rows: 544
## Columns: 4
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.8300, 149.2250, 168.9100, 14…
## $ weight &lt;dbl&gt; 47.82561, 36.48581, 31.86484, 53.04191, 41.27687, 62.99259, 38.24348, 55.47997, 34…
## $ age    &lt;dbl&gt; 63.0, 63.0, 65.0, 41.0, 51.0, 35.0, 32.0, 27.0, 19.0, 54.0, 47.0, 66.0, 73.0, 20.0…
## $ male   &lt;int&gt; 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0…</code></pre>
<blockquote>
<p>The <code>male</code> variable is our new predictor, an example of a <strong>indicator variable</strong>. Indicator variables—sometimes also called “dummy” variables—are devices for encoding unordered categories into quantitative models. There is no sense here in which““male” is one more than “female.” The purpose of the <code>male</code> variable is to indicate when a person in the sample is “male.” So it takes the value 1 whenever the person is male, but it takes the value 0 when the person belongs to any other category. It doesn’t matter which category is indicated by the 1. The model won’t care. But correctly interpreting the model demands that you remember, so it’s a good idea to name the variable after the category assigned the 1 value. (p. 154, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>The statistical model including a <code>male</code> dummy might follow the form</p>
<p><span class="math display">\[
\begin{align*}
\text{height}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{male}_i \\
\alpha  &amp; \sim \operatorname{Normal}(178, 20) \\
\beta_1 &amp; \sim \operatorname{Normal}(0, 10) \\
\sigma  &amp; \sim \operatorname{Exponential}(1),
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\beta_1\)</span> is the expected (i.e., average) difference between males and females for <code>height</code>. Here we simulate from our priors and <code>summarise()</code> the results.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb560-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb560-2" data-line-number="2"></a>
<a class="sourceLine" id="cb560-3" data-line-number="3">prior &lt;-</a>
<a class="sourceLine" id="cb560-4" data-line-number="4"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">mu_female =</span> <span class="kw">rnorm</span>(<span class="fl">1e4</span>, <span class="dt">mean =</span> <span class="dv">178</span>, <span class="dt">sd =</span> <span class="dv">20</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb560-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mu_male =</span> mu_female <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb560-6" data-line-number="6"></a>
<a class="sourceLine" id="cb560-7" data-line-number="7">prior <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb560-8" data-line-number="8"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb560-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb560-10" data-line-number="10"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb560-11" data-line-number="11">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb560-12" data-line-number="12">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb560-13" data-line-number="13">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">prob =</span> <span class="fl">.975</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb560-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   name       mean    sd    ll    ul
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 mu_female  178.  20.2  138.  219.
## 2 mu_male    178.  22.5  133.  222.</code></pre>
<p>We might visualize the two prior predictive distributions as overlapping densities.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" data-line-number="1">prior <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb562-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb562-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">fill =</span> name, <span class="dt">color =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="ot">NULL</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;firebrick4&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="ot">NULL</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;firebrick4&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-8" data-line-number="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;prior predictive distribution for our dummy groups&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb562-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb562-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb562-11" data-line-number="11">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">85</span>, <span class="fl">.85</span>))</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-89-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Yep, this parameterization makes <span class="math inline">\(\alpha + \beta_1\)</span> more uncertain than <span class="math inline">\(\alpha\)</span>. A nice alternative is to make an index variable. We’ll call it <code>sex</code>, for which 1 = <em>female</em> and 2 = <em>male.</em> “No order is implied. These are just labels” (p. 155).</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb563-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb563-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb563-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">ifelse</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb563-4" data-line-number="4"></a>
<a class="sourceLine" id="cb563-5" data-line-number="5"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>##    height   weight age male sex
## 1 151.765 47.82561  63    1   2
## 2 139.700 36.48581  63    0   1
## 3 136.525 31.86484  65    0   1
## 4 156.845 53.04191  41    1   2
## 5 145.415 41.27687  51    0   1
## 6 163.830 62.99259  35    1   2</code></pre>
<p>We can update our statistical model to include <code>sex</code> with the formula</p>
<p><span class="math display">\[
\begin{align*}
\text{height}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i    &amp; = \alpha_{\text{sex}[i]} \\
\alpha_j &amp; \sim \operatorname{Normal}(178, 20) &amp; \text{for } j = 1..2 \\
\sigma   &amp; \sim \operatorname{Exponential}(1),
\end{align*}
\]</span></p>
<p>where now we have rows indexed by <span class="math inline">\(i\)</span> and two levels of <code>sex</code> indexed by <span class="math inline">\(j\)</span>. For our version of this model, we will continue using the simple <span class="math inline">\(\lambda = 1\)</span> exponential prior on <span class="math inline">\(\sigma\)</span>, rather than the uniform. The exponential is just much easier on Stan than the uniform. But if you prefer to go uniform, have at it.</p>
<p>One more thing before we fit our model: Notice McElreath’s <code>a[sex]</code> notation in his <strong>R</strong> code 5.48. I’m not aware that <strong>brms</strong> will accommodate this notation. The fix is easy. Just save <code>sex</code> as a factor.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb565-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb565-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sex =</span> <span class="kw">factor</span>(sex))</a></code></pre></div>
<p>We’re ready to fit the model.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb566-1" data-line-number="1">b5<span class="fl">.8</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb566-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb566-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb566-4" data-line-number="4">      height <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>sex,</a>
<a class="sourceLine" id="cb566-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb566-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb566-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb566-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb566-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.08&quot;</span>)</a></code></pre></div>
<p>Behold the summary.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.8</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 0 + sex 
##    Data: d (Number of observations: 544) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sex1   134.88      1.56   131.85   138.00 1.00     4668     2943
## sex2   142.56      1.66   139.29   145.79 1.00     4419     3390
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    26.76      0.80    25.27    28.36 1.00     4145     2985
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Note that for us, there was no <code>depth=2</code> argument to get all the model output. When you fit a model with <strong>brms</strong> that excludes the typical intercept parameter–when you use the <code>0 + ...</code> syntax–, you’ll get a separate intercept for each of your factor variables. The <code>brm()</code> function noticed there were two levels for our <code>sex</code> factor, and therefore gave use two intercepts: <code>sex1</code> and <code>sex2</code>. Here’s how you might compute the difference score.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb569-2" data-line-number="2"></a>
<a class="sourceLine" id="cb569-3" data-line-number="3"><span class="kw">posterior_samples</span>(b5<span class="fl">.8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb569-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff_fm =</span> b_sex1 <span class="op">-</span><span class="st"> </span>b_sex2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb569-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(key, value, <span class="op">-</span><span class="st">`</span><span class="dt">lp__</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb569-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb569-7" data-line-number="7"><span class="st">  </span><span class="kw">mean_qi</span>(value, <span class="dt">.width =</span> <span class="fl">.89</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   key      value .lower .upper .width .point .interval
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_sex1  135.    132.  137.     0.89 mean   qi       
## 2 b_sex2  143.    140.  145.     0.89 mean   qi       
## 3 diff_fm  -7.68  -11.3  -4.08   0.89 mean   qi       
## 4 sigma    26.8    25.5  28.1    0.89 mean   qi</code></pre>
<p>Note how we used <code>tidybayes::mean_qi()</code> to summarize our difference variable, <code>diff_fm</code>.</p>
</div>
<div id="many-categories." class="section level3">
<h3><span class="header-section-number">5.3.2</span> Many categories.</h3>
<blockquote>
<p>Binary categories are easy, whether you use an indicator variable or instead an index variable. But when there are more than two categories, the indicator variable approach explodes. You’ll need a new indicator variable for each new category. If you have <span class="math inline">\(k\)</span> unique categories, you need <span class="math inline">\(k − 1\)</span> indicator variables. Automated tools like R’s <code>lm</code> do in fact go this route, constructing <span class="math inline">\(k − 1\)</span> indicator variables for you and returning <span class="math inline">\(k − 1\)</span> parameter estimates.</p>
<p>But we’ll instead stick with the index variable approach. It does not change at all when you add more categories. You do get more parameters, of course, just as many as in the indicator variable approach. But the model specification looks just like it does in the binary case. (p. 156)</p>
</blockquote>
<p>We’ll practice with <code>milk</code>.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb571-2" data-line-number="2"><span class="kw">data</span>(milk)</a>
<a class="sourceLine" id="cb571-3" data-line-number="3">d &lt;-<span class="st"> </span>milk</a></code></pre></div>
<p>Unload <strong>rethinking</strong> and load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" data-line-number="1"><span class="kw">rm</span>(milk)</a>
<a class="sourceLine" id="cb572-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb572-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>With the <strong>tidyverse</strong>, we can peek at <code>clade</code> with <code>distinct()</code> in the place of base <strong>R</strong> <code>unique()</code>.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb573-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(clade)</a></code></pre></div>
<pre><code>##              clade
## 1    Strepsirrhine
## 2 New World Monkey
## 3 Old World Monkey
## 4              Ape</code></pre>
<p>Rather than make the <code>clade_id</code> index variable, like McElreath did in the text, we’ll just use the <code>clade</code> factor. It will actually work easier within the <strong>brms</strong> framework. We will, however, standardize the <code>kcal.per.g</code> variable, again.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb575-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb575-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">kcal.per.g_s =</span> (kcal.per.g <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(kcal.per.g)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(kcal.per.g))</a></code></pre></div>
<p>Our statistical model follows the form</p>
<p><span class="math display">\[
\begin{align*}
\text{kcal.per.g_s}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i    &amp; = \alpha_{\text{clade}[i]} \\
\alpha_j &amp; \sim \operatorname{Normal}(0, 0.5), &amp; \text{for } j = 1..4 \\
\sigma   &amp; \sim \operatorname{Exponential}(1).
\end{align*}
\]</span></p>
<p>Now fit that model.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" data-line-number="1">b5<span class="fl">.9</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb576-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb576-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb576-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>clade,</a>
<a class="sourceLine" id="cb576-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb576-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb576-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb576-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb576-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.09&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.9</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 0 + clade 
##    Data: d (Number of observations: 29) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## cladeApe               -0.46      0.24    -0.93     0.03 1.00     4643     2351
## cladeNewWorldMonkey     0.35      0.24    -0.14     0.82 1.00     4344     2532
## cladeOldWorldMonkey     0.63      0.28     0.08     1.16 1.00     4364     2640
## cladeStrepsirrhine     -0.55      0.29    -1.11     0.05 1.00     4536     2578
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.81      0.12     0.61     1.08 1.00     3398     3161
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Up to this point, all of our coefficient plots have been of a rather complicated type. We tried to mimic McElreath’s <code>coeftab()</code> plots without the aid of the <strong>rethinking</strong> convenience function. But now the coefficient plot from McElreath’s <strong>R</strong> code 5.42 is of a much simpler type. As such, we can finally take it easy and use some of the convenience functions available to us within our framework.</p>
<p>The <code>mcmc_plot()</code> function is an easy way to get a default coefficient plot. You just put the <strong>brms</strong> fit object into the function.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1"><span class="kw">mcmc_plot</span>(b5<span class="fl">.9</span>, <span class="dt">pars =</span> <span class="st">&quot;^b_&quot;</span>)</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-99-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>There are numerous ways to make a coefficient plot. Another is with the <code>mcmc_intervals()</code> function from the <a href="https://mc-stan.org/bayesplot/"><strong>bayesplot</strong> package</a> <span class="citation">(Gabry et al., <a href="#ref-gabry2019visualization">2019</a>; Gabry &amp; Mahr, <a href="#ref-R-bayesplot">2019</a>)</span>. A nice feature of the <strong>bayesplot</strong> package is its convenient way to alter the color scheme with the <code>color_scheme_set()</code> function. Here, for example, we’ll make the theme <code>red</code>. But note how the <code>mcmc_intervals()</code> function requires you to work with the <code>posterior_samples()</code> instead of the brmsfit object.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" data-line-number="1"><span class="co"># install.packages(&quot;bayesplot&quot;, dependencies = T)</span></a>
<a class="sourceLine" id="cb580-2" data-line-number="2"><span class="kw">library</span>(bayesplot)</a>
<a class="sourceLine" id="cb580-3" data-line-number="3"></a>
<a class="sourceLine" id="cb580-4" data-line-number="4"><span class="kw">color_scheme_set</span>(<span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb580-5" data-line-number="5"></a>
<a class="sourceLine" id="cb580-6" data-line-number="6">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b5<span class="fl">.9</span>)</a>
<a class="sourceLine" id="cb580-7" data-line-number="7"></a>
<a class="sourceLine" id="cb580-8" data-line-number="8">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb580-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb580-10" data-line-number="10"><span class="st">  </span><span class="kw">mcmc_intervals</span>(<span class="dt">prob =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb580-11" data-line-number="11">                 <span class="dt">point_est =</span> <span class="st">&quot;median&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb580-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My fancy bayesplot-based coefficient plot&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb580-13" data-line-number="13"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb580-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb580-15" data-line-number="15">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb580-16" data-line-number="16">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-100-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Because <strong>bayesplot</strong> returns a <strong>ggplot2</strong> object, the plot was adjustable with familiar <strong>ggplot2</strong> syntax. For more ideas, check out Gabry’s <span class="citation">(<a href="#ref-gabryPlottingMCMCDraws2019">2019</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html"><em>Plotting MCMC draws using the bayesplot package</em></a>.</p>
<p>The <code>tidybayes::stat_pointintervalh()</code> function offers a third way, this time with a more ground-up <strong>ggplot2</strong> workflow.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb581-2" data-line-number="2"></a>
<a class="sourceLine" id="cb581-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb581-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb581-5" data-line-number="5"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">distinct</span>(d, clade) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(clade) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb581-6" data-line-number="6"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb581-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb581-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(name, value))) <span class="op">+</span><span class="st">  </span><span class="co"># note how we used `reorder()` to arrange the coefficients</span></a>
<a class="sourceLine" id="cb581-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb581-10" data-line-number="10"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.89</span>, </a>
<a class="sourceLine" id="cb581-11" data-line-number="11">                      <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb581-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My tidybayes-based coefficient plot&quot;</span>,</a>
<a class="sourceLine" id="cb581-13" data-line-number="13">       <span class="dt">x =</span> <span class="st">&quot;expected kcal (std)&quot;</span>, </a>
<a class="sourceLine" id="cb581-14" data-line-number="14">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb581-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb581-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb581-17" data-line-number="17">        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb581-18" data-line-number="18">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="05_files/figure-gfm/unnamed-chunk-101-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Okay, let’s simulate some “made up categories” (p. 158). We’ll use names rather than numeric indices.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" data-line-number="1">houses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Gryffindor&quot;</span>, <span class="st">&quot;Hufflepuff&quot;</span>, <span class="st">&quot;Ravenclaw&quot;</span>, <span class="st">&quot;Slytherin&quot;</span>)</a>
<a class="sourceLine" id="cb582-2" data-line-number="2"></a>
<a class="sourceLine" id="cb582-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">63</span>)</a>
<a class="sourceLine" id="cb582-4" data-line-number="4">d &lt;-</a>
<a class="sourceLine" id="cb582-5" data-line-number="5"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb582-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">house =</span> <span class="kw">sample</span>(<span class="kw">rep</span>(houses, <span class="dt">each =</span> <span class="dv">8</span>), <span class="dt">size =</span> <span class="kw">n</span>()))</a></code></pre></div>
<p>Here we attempt to fit the model with <strong>brms</strong> using the naïve approach. ⚠️</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1">b5<span class="fl">.10</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb583-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb583-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb583-4" data-line-number="4">      kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>clade <span class="op">+</span><span class="st"> </span>house,</a>
<a class="sourceLine" id="cb583-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb583-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb583-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb583-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb583-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.10&quot;</span>)</a></code></pre></div>
<p>Yep, the parameter summary suggests Slytherin stood out.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.10</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 0 + clade + house 
##    Data: d (Number of observations: 29) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## cladeApe               -0.36      0.26    -0.89     0.16 1.00     3220     2769
## cladeNewWorldMonkey     0.51      0.25     0.01     0.99 1.00     3893     3544
## cladeOldWorldMonkey     0.65      0.30     0.05     1.23 1.00     3820     3284
## cladeStrepsirrhine     -0.52      0.27    -1.05     0.02 1.00     5185     3225
## houseHufflepuff        -0.06      0.28    -0.60     0.49 1.00     3795     3009
## houseRavenclaw          0.14      0.28    -0.39     0.68 1.00     4345     3456
## houseSlytherin         -0.53      0.28    -1.07     0.04 1.00     3454     2673
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.75      0.11     0.56     1.00 1.00     3417     3263
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Even though that last model fit well and is a fine and valid way to examine the relevant variables, it’s a bit misleading. If you look closely at the output, you’ll see there are rows for all four of the <code>clade</code> levels, but only rows for three of the four levels of <code>house</code>. This is easy to miss because McElreath didn’t show the <code>precis()</code> output from his <code>m5.10</code>, but if you run and inspect his code for yourself you’ll see it returns all rows for all four of the <code>house</code> variable.</p>
<p>What gives?</p>
<p><strong>brms</strong> syntax is flexible in that it provided multiple ways to fit and post-process models. The <code>formula</code> syntax we use most of the type with <strong>brms</strong> is called the design formula syntax. In the first edition of his text (2015, pp. 159–161), McElreath contrasted design formula syntax, which is widely used in base <strong>R</strong> <code>lm()</code>, the <strong>lme4</strong> package, and <strong>brms</strong>, with the more explicit syntax he uses in his <strong>rethinking</strong> package.</p>
<p>I bring this all up because the <strong>rethinking</strong> package has no problem handling multiple index variables. Just use McElreath’s slick bracket code like he did with his <code>m5.10</code> (i.e., <code>mu &lt;- a[clade_id] + h[house]</code>). In such a model, there is no default intercept. That is, McElreath’s <code>m5.10</code> followed the statistical formula of</p>
<p><span class="math display">\[
\begin{align*}
\text{kcal.per.g_s}_i &amp; \sim \operatorname{Normal}(\mu_i, \sigma) \\
\mu_i    &amp; = \alpha_{\text{clade}[i]} + \alpha_{\text{house}[i]} \\
\alpha_{\text{clade}, j} &amp; \sim \operatorname{Normal}(0, 0.5), &amp;&amp; \text{for } j = 1..4 \\
\alpha_{\text{house}, k} &amp; \sim \operatorname{Normal}(0, 0.5), &amp;&amp; \text{for } k = 1..4 \\
\sigma   &amp; \sim \operatorname{Exponential}(1),
\end{align*}
\]</span></p>
<p>where there is an <span class="math inline">\(\alpha_\text{clade}\)</span> “intercept” for each of the four levels of <code>clade</code> and an <span class="math inline">\(\alpha_\text{house}\)</span> “intercept” for each of the four levels of <code>house</code>. But there is no <strong>overall</strong> intercept, <span class="math inline">\(\alpha\)</span>, that stands for the expected value when all the predictors are set to 0.</p>
<p>When we use the typical <code>formula</code> syntax with <strong>brms</strong>, we can suppress the overall intercept when for a single index variable with the <code>&lt;criterion&gt; ~ 0 + &lt;index variable&gt;</code> syntax. That’s exactly what we did with our <code>b5.9</code> model. The catch is that this approach only works with one index variable with <strong>brms</strong>. The result is even though we suppressed the default interecept with our <code>b5.10</code> formula, <code>kcal.per.g_s ~ 0 + clade + house</code>, we ended up loosing the first category of the second variable, <code>house</code>.</p>
<p>Fortunately, we have a fix. I learned about his from one of Bürkner’s <a href="https://discourse.mc-stan.org/t/indexing-approach-to-predictors/7898/9">answers</a> to <a href="https://discourse.mc-stan.org/u/paul_dong">Paul Dong</a>’s thread in the Stan Forums, <a href="https://discourse.mc-stan.org/t/indexing-approach-to-predictors/7898"><em>Indexing approach to predictors</em></a>. The solution is the use the non-linear syntax. As Bürkner detailed in his <span class="citation">(<a href="#ref-Bürkner2020Non_linear">2020</a><a href="#ref-Bürkner2020Non_linear">d</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html"><em>Estimating non-linear models with brms</em></a>, the non-linear syntax is a powerful alternative to the design formula syntax we typically use with <strong>brms</strong>. The non-linear syntax is a lot like the syntax McElreath uses in <strong>rethinking</strong> in that it typically includes both predictor and variable names in the <code>formula</code>. I’m not included to go into a full-blown explation of the non-linear syntax, here. You have Bürkner’s vignette for that and the bulk of the models we’ll fit in this project will employ the default design formula syntax. But here’s how you can use the non-linear syntax to faithfully replicate McElreath’s <code>m510</code> with <code>brms::brm()</code>. In short, we defined our two model parameters, <code>a</code> and <code>h</code>, in the first <code>bf()</code> line, connected each to a index variable in the next two lines, and closed out the <code>bf()</code> statement with <code>nl = TRUE</code> to alter <code>brm()</code> we were using the non-linear syntax.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" data-line-number="1">b5<span class="fl">.11</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb586-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb586-3" data-line-number="3">      <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb586-4" data-line-number="4">      <span class="kw">bf</span>(kcal.per.g_s <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span>h, </a>
<a class="sourceLine" id="cb586-5" data-line-number="5">         a <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>clade, </a>
<a class="sourceLine" id="cb586-6" data-line-number="6">         h <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>house,</a>
<a class="sourceLine" id="cb586-7" data-line-number="7">         <span class="dt">nl =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb586-8" data-line-number="8">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">nlpar =</span> a),</a>
<a class="sourceLine" id="cb586-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">nlpar =</span> h),</a>
<a class="sourceLine" id="cb586-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb586-11" data-line-number="11">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb586-12" data-line-number="12">      <span class="dt">seed =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb586-13" data-line-number="13">      <span class="dt">file =</span> <span class="st">&quot;fits/b05.11&quot;</span>)</a></code></pre></div>
<p>Here’s the summary of the correct model.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb587-1" data-line-number="1"><span class="kw">print</span>(b5<span class="fl">.11</span>)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g_s ~ 0 + a + h 
##          a ~ 0 + clade
##          h ~ 0 + house
##    Data: d (Number of observations: 29) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_cladeApe               -0.44      0.28    -0.96     0.12 1.00     3028     3012
## a_cladeNewWorldMonkey     0.40      0.28    -0.14     0.94 1.00     3143     2708
## a_cladeOldWorldMonkey     0.58      0.31    -0.01     1.19 1.00     3457     3340
## a_cladeStrepsirrhine     -0.63      0.33    -1.24     0.02 1.00     3930     3165
## h_houseGryffindor         0.22      0.28    -0.31     0.76 1.00     3380     3160
## h_houseHufflepuff        -0.00      0.29    -0.57     0.56 1.00     3490     3120
## h_houseRavenclaw          0.21      0.29    -0.38     0.77 1.00     3366     2875
## h_houseSlytherin         -0.46      0.30    -1.03     0.13 1.00     3480     3145
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.74      0.12     0.56     1.01 1.00     3780     3373
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Finally, here’s how we might visualize the results in a faceted coefficient plot.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" data-line-number="1"><span class="kw">posterior_samples</span>(b5<span class="fl">.11</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-4" data-line-number="4"><span class="st">           </span><span class="kw">str_remove</span>(., <span class="st">&quot;clade&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-5" data-line-number="5"><span class="st">           </span><span class="kw">str_remove</span>(., <span class="st">&quot;house&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-6" data-line-number="6"><span class="st">           </span><span class="kw">str_replace</span>(., <span class="st">&quot;World&quot;</span>, <span class="st">&quot; World &quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-7" data-line-number="7"><span class="st">  </span><span class="kw">separate</span>(name, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;level&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predictor =</span> <span class="kw">if_else</span>(predictor <span class="op">==</span><span class="st"> &quot;a&quot;</span>, <span class="st">&quot;predictor: clade&quot;</span>, <span class="st">&quot;predictor: house&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb589-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb589-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(level, value))) <span class="op">+</span><span class="st">  </span><span class="co"># note how we used `reorder()` to arrange the coefficients</span></a>
<a class="sourceLine" id="cb589-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb589-12" data-line-number="12"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.89</span>, </a>
<a class="sourceLine" id="cb589-13" data-line-number="13">                      <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb589-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;expected kcal (std)&quot;</span>, </a>
<a class="sourceLine" id="cb589-15" data-line-number="15">       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb589-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb589-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb589-18" data-line-number="18">        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb589-19" data-line-number="19">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb589-20" data-line-number="20">        <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb589-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>predictor, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: &#39;stat_pointintervalh&#39; is deprecated.
## Use &#39;stat_pointinterval&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;tidybayes-deprecated&quot;).</code></pre>
<p><img src="05_files/figure-gfm/unnamed-chunk-106-1.png" width="768" style="display: block; margin: auto;" /></p>
<div id="rethinking-differences-and-statistical-significance." class="section level4">
<h4><span class="header-section-number">5.3.2.1</span> Rethinking: Differences and statistical significance.</h4>
<blockquote>
<p>A common error in interpretation of parameter estimates is to suppose that because one parameter is sufficiently far from zero–is “significant”–and another parameter is not–is “not significant”–that the difference between the parameters is also significant. This is not necessarily so. This isn’t just an issue for non-Bayesian analysis: If you want to know the distribution of a difference, then you must compute that difference, a <strong>contrast</strong>. (p. 158, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>This reminds me of a paper by Gelman and Stern <span class="citation">(<a href="#ref-gelman2006difference">2006</a>)</span>, <a href="https://www.tandfonline.com/doi/pdf/10.1198/000313006X152649?needAccess=true"><em>The difference between “significant” and “not significant” is not itself statistically significant</em></a>.</p>
</div>
</div>
</div>
<div id="session-info-4" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bayesplot_1.7.1      tidybayes_2.1.1      GGally_1.5.0         psych_1.9.12.31     
##  [5] patchwork_1.0.0      ggdag_0.2.2          urbnmapr_0.0.0.9002  ggrepel_0.8.2       
##  [9] brms_2.13.0          Rcpp_1.0.4.6         forcats_0.5.0        stringr_1.4.0       
## [13] dplyr_0.8.5          purrr_0.3.4          readr_1.3.1          tidyr_1.0.2         
## [17] tibble_3.0.1         tidyverse_1.3.0      dagitty_0.2-2        rstan_2.19.3        
## [21] ggplot2_3.3.1        StanHeaders_2.21.0-1
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.1.7      plyr_1.8.6           igraph_1.2.5        
##   [5] svUnit_1.0.3         splines_3.6.3        crosstalk_1.1.0.1    TH.data_1.0-10      
##   [9] rstantools_2.0.0     inline_0.3.15        digest_0.6.25        htmltools_0.4.0     
##  [13] viridis_0.5.1        rsconnect_0.8.16     fansi_0.4.1          magrittr_1.5        
##  [17] graphlayouts_0.7.0   modelr_0.1.6         matrixStats_0.56.0   xts_0.12-0          
##  [21] sandwich_2.5-1       prettyunits_1.1.1    colorspace_1.4-1     rvest_0.3.5         
##  [25] ggdist_2.1.1         haven_2.2.0          xfun_0.13            callr_3.4.3         
##  [29] crayon_1.3.4         jsonlite_1.6.1       survival_3.1-12      zoo_1.8-7           
##  [33] glue_1.4.1           polyclip_1.10-0      gtable_0.3.0         emmeans_1.4.5       
##  [37] V8_3.0.2             pkgbuild_1.0.8       shape_1.4.4          abind_1.4-5         
##  [41] scales_1.1.1         mvtnorm_1.1-0        emo_0.0.0.9000       DBI_1.1.0           
##  [45] miniUI_0.1.1.1       viridisLite_0.3.0    xtable_1.8-4         HDInterval_0.2.0    
##  [49] units_0.6-6          stats4_3.6.3         DT_0.13              htmlwidgets_1.5.1   
##  [53] httr_1.4.1           threejs_0.3.3        arrayhelpers_1.1-0   RColorBrewer_1.1-2  
##  [57] ellipsis_0.3.1       reshape_0.8.8        pkgconfig_2.0.3      loo_2.2.0           
##  [61] farver_2.0.3         dbplyr_1.4.2         utf8_1.1.4           tidyselect_1.0.0    
##  [65] labeling_0.3         rlang_0.4.6          reshape2_1.4.4       later_1.0.0         
##  [69] munsell_0.5.0        cellranger_1.1.0     tools_3.6.3          cli_2.0.2           
##  [73] generics_0.0.2       broom_0.5.5          ggridges_0.5.2       evaluate_0.14       
##  [77] fastmap_1.0.1        yaml_2.2.1           processx_3.4.2       knitr_1.28          
##  [81] fs_1.4.1             tidygraph_1.2.0      ggraph_2.0.3         nlme_3.1-144        
##  [85] mime_0.9             xml2_1.3.1           compiler_3.6.3       shinythemes_1.1.2   
##  [89] rstudioapi_0.11      curl_4.3             e1071_1.7-3          reprex_0.3.0        
##  [93] tweenr_1.0.1         stringi_1.4.6        ps_1.3.3             Brobdingnag_1.2-6   
##  [97] lattice_0.20-38      Matrix_1.2-18        classInt_0.4-3       markdown_1.1        
## [101] shinyjs_1.1          vctrs_0.3.1          pillar_1.4.4         lifecycle_0.2.0     
## [105] bridgesampling_1.0-0 estimability_1.3     httpuv_1.5.2         R6_2.4.1            
## [109] bookdown_0.18        promises_1.1.0       KernSmooth_2.23-16   gridExtra_2.3       
## [113] codetools_0.2-16     boot_1.3-24          colourpicker_1.0     MASS_7.3-51.5       
## [117] gtools_3.8.2         assertthat_0.2.1     withr_2.2.0          mnormt_1.5-6        
## [121] shinystan_2.5.0      multcomp_1.4-13      mgcv_1.8-31          hms_0.5.3           
## [125] grid_3.6.3           coda_0.19-3          class_7.3-15         rmarkdown_2.1       
## [129] ggforce_0.3.1        sf_0.9-1             shiny_1.4.0.2        lubridate_1.7.8     
## [133] base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-barrettAnIntroduction2020">
<p>Barrett, M. (2020a). <em>An introduction to ggdag</em>. <a href="https://CRAN.R-project.org/package=ggdag/vignettes/intro-to-ggdag.html">https://CRAN.R-project.org/package=ggdag/vignettes/intro-to-ggdag.html</a></p>
</div>
<div id="ref-R-ggdag">
<p>Barrett, M. (2020b). <em>ggdag: Analyze and create elegant directed acyclic graphs</em>. <a href="https://CRAN.R-project.org/package=ggdag">https://CRAN.R-project.org/package=ggdag</a></p>
</div>
<div id="ref-Bürkner2020Multivariate">
<p>Bürkner, P.-C. (2020c). <em>Estimating multivariate models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html">https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html</a></p>
</div>
<div id="ref-Bürkner2020Non_linear">
<p>Bürkner, P.-C. (2020d). <em>Estimating non-linear models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html">https://CRAN.R-project.org/package=brms/vignettes/brms_nonlinear.html</a></p>
</div>
<div id="ref-brms2020RM">
<p>Bürkner, P.-C. (2020g). <em>brms reference manual, Version 2.12.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a></p>
</div>
<div id="ref-gabryPlottingMCMCDraws2019">
<p>Gabry, J. (2019). <em>Plotting MCMC draws using the bayesplot package</em>. <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html">https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html</a></p>
</div>
<div id="ref-R-bayesplot">
<p>Gabry, J., &amp; Mahr, T. (2019). <em>bayesplot: Plotting for Bayesian models</em>. <a href="https://CRAN.R-project.org/package=bayesplot">https://CRAN.R-project.org/package=bayesplot</a></p>
</div>
<div id="ref-gabry2019visualization">
<p>Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., &amp; Gelman, A. (2019). Visualization in Bayesian workflow. <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em>, <em>182</em>(2), 389–402. <a href="https://doi.org/10.1111/rssa.12378">https://doi.org/10.1111/rssa.12378</a></p>
</div>
<div id="ref-gelman2006difference">
<p>Gelman, A., &amp; Stern, H. (2006). The difference between “significant” and “not significant” is not itself statistically significant. <em>The American Statistician</em>, <em>60</em>(4), 328–331. <a href="https://doi.org/10.1198/000313006X152649">https://doi.org/10.1198/000313006X152649</a></p>
</div>
<div id="ref-hindePrimateMilkProximate2011">
<p>Hinde, K., &amp; Milligan, L. A. (2011). Primate milk: Proximate mechanisms and ultimate perspectives. <em>Evolutionary Anthropology: Issues, News, and Reviews</em>, <em>20</em>(1), 9–23. <a href="https://doi.org/10.1002/evan.20289">https://doi.org/10.1002/evan.20289</a></p>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020">
<p>McElreath, R. (2020a). <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em> (Second edition). CRC Press. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a></p>
</div>
<div id="ref-meehlWhySummariesResearch1990">
<p>Meehl, P. E. (1990). Why summaries of research on psychological theories are often uninterpretable. <em>Psychological Reports</em>, <em>66</em>(1), 195–244. <a href="https://doi.org/10.2466/pr0.1990.66.1.195">https://doi.org/10.2466/pr0.1990.66.1.195</a></p>
</div>
<div id="ref-R-psych">
<p>Revelle, W. (2020). <em>psych: Procedures for psychological, psychometric, and personality research</em>. <a href="https://CRAN.R-project.org/package=psych">https://CRAN.R-project.org/package=psych</a></p>
</div>
<div id="ref-R-GGally">
<p>Schloerke, B., Crowley, J., Di Cook, Briatte, F., Marbach, M., Thoen, E., Elberg, A., &amp; Larmarange, J. (2020). <em>GGally: Extension to ’ggplot2’</em>. <a href="https://CRAN.R-project.org/package=GGally">https://CRAN.R-project.org/package=GGally</a></p>
</div>
<div id="ref-R-ggrepel">
<p>Slowikowski, K. (2020). <em>ggrepel: Automatically position non-overlapping text labels with ’ggplot2’</em>. <a href="https://CRAN.R-project.org/package=ggrepel">https://CRAN.R-project.org/package=ggrepel</a></p>
</div>
<div id="ref-R-dagitty">
<p>Textor, J., &amp; der Zander, B. van. (2016). <em>dagitty: Graphical analysis of structural causal models</em>. <a href="https://CRAN.R-project.org/package=dagitty">https://CRAN.R-project.org/package=dagitty</a></p>
</div>
<div id="ref-R-urbnmapr">
<p>Urban Institute. (2020). <em>urbnmapr: State and county maps with Alaska and Hawaii</em>. <a href="https://github.com/UrbanInstitute/urbnmapr">https://github.com/UrbanInstitute/urbnmapr</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geocentric-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-haunted-dag-the-causal-terror.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
