<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>16 Generalized Linear Madness | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</title>
  <meta name="description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="16 Generalized Linear Madness | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="16 Generalized Linear Madness | Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This book is an attempt to re-express the code in the second edition of McElreath’s textbook, ‘Statistical rethinking.’ His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2021-03-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="missing-data-and-other-opportunities.html"/>
<link rel="next" href="horoscopes-insights.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<script src="libs/twitter-widget-0.0.1/widgets.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li><a href="index.html#r-setup"><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.1."><i class="fa fa-check"></i>Version 0.1.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#were-not-done-yet-and-i-could-use-your-help."><i class="fa fa-check"></i>We’re not done yet and I could use your help.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#combining-other-information."><i class="fa fa-check"></i><b>2.1.2</b> Combining other information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#variables."><i class="fa fa-check"></i><b>2.3.1</b> Variables.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#definitions."><i class="fa fa-check"></i><b>2.3.2</b> Definitions.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-model-is-born."><i class="fa fa-check"></i><b>2.3.3</b> A model is born.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayes-theorem."><i class="fa fa-check"></i><b>2.4.1</b> Bayes’ theorem.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#motors."><i class="fa fa-check"></i><b>2.4.2</b> Motors.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.3</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.4</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.5" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.5</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with <strong>brms</strong></a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric-models.html"><a href="geocentric-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geocentric-models.html"><a href="geocentric-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap-brm."><i class="fa fa-check"></i><b>4.3.5</b> Finding the posterior distribution with <del><code>quap</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>quap()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution.</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i><b>4.5</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression."><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression.</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines."><i class="fa fa-check"></i><b>4.5.2</b> Splines.</a></li>
<li class="chapter" data-level="4.5.3" data-path="geocentric-models.html"><a href="geocentric-models.html#smooth-functions-for-a-rough-world."><i class="fa fa-check"></i><b>4.5.3</b> Smooth functions for a rough world.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#summary-first-bonus-smooth-functions-with-brmss"><i class="fa fa-check"></i><b>4.6</b> <del>Summary</del> First bonus: Smooth functions with <code>brms::s()</code></a></li>
<li class="chapter" data-level="4.7" data-path="geocentric-models.html"><a href="geocentric-models.html#second-bonus-group-predictors-with-matrix-columns"><i class="fa fa-check"></i><b>4.7</b> Second bonus: Group predictors with matrix columns</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#think-before-you-regress."><i class="fa fa-check"></i><b>5.1.1</b> Think before you regress.</a></li>
<li class="chapter" data-level="5.1.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#testable-implications."><i class="fa fa-check"></i><b>5.1.2</b> Testable implications.</a></li>
<li class="chapter" data-level="5.1.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#multiple-regression-notation."><i class="fa fa-check"></i><b>5.1.3</b> Multiple regression notation.</a></li>
<li class="chapter" data-level="5.1.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#approximating-the-posterior."><i class="fa fa-check"></i><b>5.1.4</b> Approximating the posterior.</a></li>
<li class="chapter" data-level="5.1.5" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.5</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>5.3</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#binary-categories."><i class="fa fa-check"></i><b>5.3.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.3.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#many-categories."><i class="fa fa-check"></i><b>5.3.2</b> Many categories.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#summary-bonus-we-can-model-categorical-variables-in-more-ways-than-one"><i class="fa fa-check"></i><b>5.4</b> <del>Summary</del> Bonus: We can model categorical variables in more ways than one</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#you-can-use-a-dummy."><i class="fa fa-check"></i><b>5.4.1</b> You can use a dummy.</a></li>
<li class="chapter" data-level="5.4.2" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#consider-contrast-coding."><i class="fa fa-check"></i><b>5.4.2</b> Consider contrast coding.</a></li>
<li class="chapter" data-level="5.4.3" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#theres-always-the-multilevel-anova-approach."><i class="fa fa-check"></i><b>5.4.3</b> There’s always the multilevel ANOVA approach.</a></li>
<li class="chapter" data-level="5.4.4" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#would-you-like-to-learn-more"><i class="fa fa-check"></i><b>5.4.4</b> Would you like to learn more?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-variables-the-spurious-waffles.html"><a href="the-many-variables-the-spurious-waffles.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>6.1</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-legs."><i class="fa fa-check"></i><b>6.1.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="6.1.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#multicollinear-milk."><i class="fa fa-check"></i><b>6.1.2</b> Multicollinear <code>milk</code>.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>6.2</b> Post-treatment bias</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#a-prior-is-born."><i class="fa fa-check"></i><b>6.2.1</b> A prior is born.</a></li>
<li class="chapter" data-level="6.2.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#blocked-by-consequence."><i class="fa fa-check"></i><b>6.2.2</b> Blocked by consequence.</a></li>
<li class="chapter" data-level="6.2.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#fungus-and-d-separation."><i class="fa fa-check"></i><b>6.2.3</b> Fungus and <span class="math inline">\(d\)</span>-separation.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>6.3</b> Collider bias</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#collider-of-false-sorrow."><i class="fa fa-check"></i><b>6.3.1</b> Collider of false sorrow.</a></li>
<li class="chapter" data-level="6.3.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#the-haunted-dag."><i class="fa fa-check"></i><b>6.3.2</b> The haunted DAG.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>6.4</b> Confronting confounding</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#shutting-the-backdoor."><i class="fa fa-check"></i><b>6.4.1</b> Shutting the backdoor.</a></li>
<li class="chapter" data-level="6.4.2" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#two-roads."><i class="fa fa-check"></i><b>6.4.2</b> Two roads.</a></li>
<li class="chapter" data-level="6.4.3" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#backdoor-waffles."><i class="fa fa-check"></i><b>6.4.3</b> Backdoor waffles.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#summary-and-a-little-more-practice"><i class="fa fa-check"></i><b>6.5</b> Summary [and a little more practice]</a></li>
<li class="chapter" data-level="" data-path="the-haunted-dag-the-causal-terror.html"><a href="the-haunted-dag-the-causal-terror.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses-compass.html"><a href="ulysses-compass.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>7.1</b> The problem with parameters</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#more-parameters-almost-always-improve-fit."><i class="fa fa-check"></i><b>7.1.1</b> More parameters (almost) always improve fit.</a></li>
<li class="chapter" data-level="7.1.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>7.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>7.2</b> Entropy and accuracy</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>7.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="7.2.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-and-uncertainty."><i class="fa fa-check"></i><b>7.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="7.2.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>7.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="7.2.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#estimating-divergence."><i class="fa fa-check"></i><b>7.2.4</b> Estimating divergence.</a></li>
<li class="chapter" data-level="7.2.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#scoring-the-right-data."><i class="fa fa-check"></i><b>7.2.5</b> Scoring the right data.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ulysses-compass.html"><a href="ulysses-compass.html#golem-taming-regularization"><i class="fa fa-check"></i><b>7.3</b> Golem taming: regularization</a></li>
<li class="chapter" data-level="7.4" data-path="ulysses-compass.html"><a href="ulysses-compass.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>7.4</b> Predicting predictive accuracy</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#cross-validation."><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="ulysses-compass.html"><a href="ulysses-compass.html#information-criteria"><i class="fa fa-check"></i><b>7.5</b> Information criteria</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#comparing-cv-psis-and-waic."><i class="fa fa-check"></i><b>7.5.1</b> Comparing CV, PSIS, and WAIC.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-comparison"><i class="fa fa-check"></i><b>7.6</b> Model comparison</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="ulysses-compass.html"><a href="ulysses-compass.html#model-mis-selection."><i class="fa fa-check"></i><b>7.6.1</b> Model mis-selection.</a></li>
<li class="chapter" data-level="7.6.2" data-path="ulysses-compass.html"><a href="ulysses-compass.html#outliers-and-other-illusions."><i class="fa fa-check"></i><b>7.6.2</b> Outliers and other illusions.</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="ulysses-compass.html"><a href="ulysses-compass.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>7.7</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="ulysses-compass.html"><a href="ulysses-compass.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional-manatees.html"><a href="conditional-manatees.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#building-an-interaction"><i class="fa fa-check"></i><b>8.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#making-a-rugged-model."><i class="fa fa-check"></i><b>8.1.1</b> Making a rugged model.</a></li>
<li class="chapter" data-level="8.1.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>8.1.2</b> Adding an indicator variable isn’t enough.</a></li>
<li class="chapter" data-level="8.1.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#adding-an-interaction-does-work."><i class="fa fa-check"></i><b>8.1.3</b> Adding an interaction does work.</a></li>
<li class="chapter" data-level="8.1.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-the-interaction."><i class="fa fa-check"></i><b>8.1.4</b> Plotting the interaction.</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>8.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="8.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#continuous-interactions"><i class="fa fa-check"></i><b>8.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="conditional-manatees.html"><a href="conditional-manatees.html#a-winter-flower."><i class="fa fa-check"></i><b>8.3.1</b> A winter flower.</a></li>
<li class="chapter" data-level="8.3.2" data-path="conditional-manatees.html"><a href="conditional-manatees.html#the-models."><i class="fa fa-check"></i><b>8.3.2</b> The models.</a></li>
<li class="chapter" data-level="8.3.3" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-posterior-predictions."><i class="fa fa-check"></i><b>8.3.3</b> Plotting posterior predictions.</a></li>
<li class="chapter" data-level="8.3.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#plotting-prior-predictions."><i class="fa fa-check"></i><b>8.3.4</b> Plotting prior predictions.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="conditional-manatees.html"><a href="conditional-manatees.html#summary-bonus-conditional_effects"><i class="fa fa-check"></i><b>8.4</b> <del>Summary</del> Bonus: <code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="conditional-manatees.html"><a href="conditional-manatees.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>9.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="9.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>9.2</b> Metropolis algorithms</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>9.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="9.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#high-dimensional-problems."><i class="fa fa-check"></i><b>9.2.2</b> High-dimensional problems.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>9.3</b> Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#another-parable."><i class="fa fa-check"></i><b>9.3.1</b> Another parable.</a></li>
<li class="chapter" data-level="9.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#particles-in-space."><i class="fa fa-check"></i><b>9.3.2</b> Particles in space.</a></li>
<li class="chapter" data-level="9.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#limitations."><i class="fa fa-check"></i><b>9.3.3</b> Limitations.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-ulam-brm"><i class="fa fa-check"></i><b>9.4</b> Easy HMC: <del>ulam</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>9.4.1</b> Preparation.</a></li>
<li class="chapter" data-level="9.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-from-the-posterior.-1"><i class="fa fa-check"></i><b>9.4.2</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="9.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>9.4.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="9.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>9.4.4</b> Visualization.</a></li>
<li class="chapter" data-level="9.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>9.4.5</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>9.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>9.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="9.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>9.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="9.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>9.5.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="9.5.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>9.5.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>10.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>10.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="10.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>10.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>10.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>10.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>10.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="10.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#omitted-variable-bias-again."><i class="fa fa-check"></i><b>10.2.3</b> Omitted variable bias again.</a></li>
<li class="chapter" data-level="10.2.4" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>10.2.4</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>11.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>11.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="11.1.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer."><i class="fa fa-check"></i><b>11.1.2</b> Relative shark and absolute deer.</a></li>
<li class="chapter" data-level="11.1.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>11.1.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="11.1.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>11.1.4</b> Aggregated binomial: Graduate school admissions.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>11.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="11.2.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>11.2.2</b> Negative binomial (gamma-Poisson) models.</a></li>
<li class="chapter" data-level="11.2.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>11.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>11.3</b> Multinomial and categorical models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-outcomes."><i class="fa fa-check"></i><b>11.3.1</b> Predictors matched to outcomes.</a></li>
<li class="chapter" data-level="11.3.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#predictors-matched-to-observations."><i class="fa fa-check"></i><b>11.3.2</b> Predictors matched to observations.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#summary"><i class="fa fa-check"></i><b>11.4</b> Summary</a></li>
<li class="chapter" data-level="11.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#bonus-survival-analysis"><i class="fa fa-check"></i><b>11.5</b> Bonus: Survival analysis</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#survival-summary."><i class="fa fa-check"></i><b>11.5.1</b> Survival summary.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i><b>12.1</b> Over-dispersed counts</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>12.1.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="12.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>12.1.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="12.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>12.1.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>12.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>12.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>12.3</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>12.3.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="12.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>12.3.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="12.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>12.3.3</b> Adding predictor variables.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>12.4</b> Ordered categorical predictors</a></li>
<li class="chapter" data-level="12.5" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#summary-1"><i class="fa fa-check"></i><b>12.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models-with-memory.html"><a href="models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-with-memory.html"><a href="models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="models-with-memory.html"><a href="models-with-memory.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting/overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-model.-1"><i class="fa fa-check"></i><b>13.2.1</b> The model.</a></li>
<li class="chapter" data-level="13.2.2" data-path="models-with-memory.html"><a href="models-with-memory.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="13.2.3" data-path="models-with-memory.html"><a href="models-with-memory.html#sumulate-survivors."><i class="fa fa-check"></i><b>13.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="13.2.4" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>13.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="13.2.5" data-path="models-with-memory.html"><a href="models-with-memory.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>13.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="models-with-memory.html"><a href="models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>13.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="13.3.2" data-path="models-with-memory.html"><a href="models-with-memory.html#even-more-clusters."><i class="fa fa-check"></i><b>13.3.2</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="models-with-memory.html"><a href="models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-with-memory.html"><a href="models-with-memory.html#the-devils-funnel."><i class="fa fa-check"></i><b>13.4.1</b> The Devil’s Funnel.</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-with-memory.html"><a href="models-with-memory.html#non-centered-chimpanzees."><i class="fa fa-check"></i><b>13.4.2</b> Non-centered chimpanzees.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-with-memory.html"><a href="models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="13.5.2" data-path="models-with-memory.html"><a href="models-with-memory.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="13.5.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratification."><i class="fa fa-check"></i><b>13.5.3</b> Post-stratification.</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="models-with-memory.html"><a href="models-with-memory.html#summary-bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>13.6</b> <del>Summary</del> Bonus: Post-stratification in an example</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-with-memory.html"><a href="models-with-memory.html#meet-the-data."><i class="fa fa-check"></i><b>13.6.1</b> Meet the data.</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-with-memory.html"><a href="models-with-memory.html#settle-the-mr-part-of-mrp."><i class="fa fa-check"></i><b>13.6.2</b> Settle the MR part of MRP.</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-with-memory.html"><a href="models-with-memory.html#post-stratify-to-put-the-p-in-mrp."><i class="fa fa-check"></i><b>13.6.3</b> Post-stratify to put the P in MRP.</a></li>
<li class="chapter" data-level="13.6.4" data-path="models-with-memory.html"><a href="models-with-memory.html#wrap-this-mrp-up."><i class="fa fa-check"></i><b>13.6.4</b> Wrap this MRP up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models-with-memory.html"><a href="models-with-memory.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="14.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="14.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a></li>
<li class="chapter" data-level="14.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>14.3</b> Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#instrumental-variables."><i class="fa fa-check"></i><b>14.3.1</b> Instrumental variables.</a></li>
<li class="chapter" data-level="14.3.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-designs."><i class="fa fa-check"></i><b>14.3.2</b> Other designs.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>14.4</b> Social relations as correlated varying effects</a></li>
<li class="chapter" data-level="14.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>14.5</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>14.5.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="14.5.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-phylogenetic-distance."><i class="fa fa-check"></i><b>14.5.2</b> Example: Phylogenetic distance.</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm"><i class="fa fa-check"></i><b>14.6</b> <del>Summary</del> Bonus: Multilevel growth models and the MELSM</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#borrow-some-data."><i class="fa fa-check"></i><b>14.6.1</b> Borrow some data.</a></li>
<li class="chapter" data-level="14.6.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#conventional-multilevel-growth-model."><i class="fa fa-check"></i><b>14.6.2</b> Conventional multilevel growth model.</a></li>
<li class="chapter" data-level="14.6.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#learn-more-about-your-data-with-the-melsm."><i class="fa fa-check"></i><b>14.6.3</b> Learn more about your data with the MELSM.</a></li>
<li class="chapter" data-level="14.6.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#time-to-go-multivariate."><i class="fa fa-check"></i><b>14.6.4</b> Time to go multivariate.</a></li>
<li class="chapter" data-level="14.6.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#growth-modelmelsm-wrap-up."><i class="fa fa-check"></i><b>14.6.5</b> Growth model/MELSM wrap-up.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>15.1</b> Measurement error</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>15.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="15.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>15.1.2</b> Error on both outcome and predictor.</a></li>
<li class="chapter" data-level="15.1.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-terrors."><i class="fa fa-check"></i><b>15.1.3</b> Measurement terrors.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>15.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#dag-ate-my-homework."><i class="fa fa-check"></i><b>15.2.1</b> DAG ate my homework.</a></li>
<li class="chapter" data-level="15.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-primates."><i class="fa fa-check"></i><b>15.2.2</b> Imputing primates.</a></li>
<li class="chapter" data-level="15.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#where-is-your-god-now"><i class="fa fa-check"></i><b>15.2.3</b> Where is your god now?</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>15.3</b> Categorical errors and discrete absences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#discrete-cats."><i class="fa fa-check"></i><b>15.3.1</b> Discrete cats.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-2"><i class="fa fa-check"></i><b>15.4</b> Summary</a></li>
<li class="chapter" data-level="15.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-bayesian-meta-analysis-with-odds-ratios"><i class="fa fa-check"></i><b>15.5</b> Bonus: Bayesian meta-analysis with odds ratios</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#how-do-meta-analyses-fit-into-the-picture"><i class="fa fa-check"></i><b>15.5.1</b> How do meta-analyses fit into the picture?</a></li>
<li class="chapter" data-level="15.5.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#we-need-some-data."><i class="fa fa-check"></i><b>15.5.2</b> We need some data.</a></li>
<li class="chapter" data-level="15.5.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#our-effect-size-will-be-an-odds-ratio."><i class="fa fa-check"></i><b>15.5.3</b> Our effect size will be an odds ratio.</a></li>
<li class="chapter" data-level="15.5.4" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#log-odds-odds-ratios-and-modeling-effect-sizes."><i class="fa fa-check"></i><b>15.5.4</b> Log-odds, odds ratios, and modeling effect sizes.</a></li>
<li class="chapter" data-level="15.5.5" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#compute-the-study-specific-effect-sizes."><i class="fa fa-check"></i><b>15.5.5</b> Compute the study-specific effect sizes.</a></li>
<li class="chapter" data-level="15.5.6" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-meta-analysis."><i class="fa fa-check"></i><b>15.5.6</b> Fit the Bayesian meta-analysis.</a></li>
<li class="chapter" data-level="15.5.7" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#fit-the-bayesian-muiltilevel-alternative."><i class="fa fa-check"></i><b>15.5.7</b> Fit the Bayesian muiltilevel alternative.</a></li>
<li class="chapter" data-level="15.5.8" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#relative-to-the-muiltilevel-model-meta-analyses-have-limitations."><i class="fa fa-check"></i><b>15.5.8</b> Relative to the muiltilevel model, meta-analyses have limitations.</a></li>
<li class="chapter" data-level="15.5.9" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#parting-thoughts."><i class="fa fa-check"></i><b>15.5.9</b> Parting thoughts.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#geometric-people"><i class="fa fa-check"></i><b>16.1</b> Geometric people</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model."><i class="fa fa-check"></i><b>16.1.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.1.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model."><i class="fa fa-check"></i><b>16.1.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.1.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#glm-in-disguise."><i class="fa fa-check"></i><b>16.1.3</b> GLM in disguise.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>16.2</b> Hidden minds and observed behavior</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-1"><i class="fa fa-check"></i><b>16.2.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.2.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-1"><i class="fa fa-check"></i><b>16.2.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.2.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#coding-the-statistical-model."><i class="fa fa-check"></i><b>16.2.3</b> Coding the statistical model.</a></li>
<li class="chapter" data-level="16.2.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#state-space-models."><i class="fa fa-check"></i><b>16.2.4</b> State space models.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>16.3</b> Ordinary differential nut cracking</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#scientific-model."><i class="fa fa-check"></i><b>16.3.1</b> Scientific model.</a></li>
<li class="chapter" data-level="16.3.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#statistical-model."><i class="fa fa-check"></i><b>16.3.2</b> Statistical model.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#population-dynamics"><i class="fa fa-check"></i><b>16.4</b> Population dynamics</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-scientific-model.-2"><i class="fa fa-check"></i><b>16.4.1</b> The scientific model.</a></li>
<li class="chapter" data-level="16.4.2" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#the-statistical-model.-2"><i class="fa fa-check"></i><b>16.4.2</b> The statistical model.</a></li>
<li class="chapter" data-level="16.4.3" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#lynx-lessons-bonus-practice-with-the-autoregressive-model."><i class="fa fa-check"></i><b>16.4.3</b> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-madness.html"><a href="generalized-linear-madness.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>17</b> <del>Horoscopes</del> Insights</a>
<ul>
<li class="chapter" data-level="17.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>17.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="17.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>17.2</b> Save your model fits</a></li>
<li class="chapter" data-level="17.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>17.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="17.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>17.4</b> Look at your data</a></li>
<li class="chapter" data-level="17.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#consider-using-the-0-intercept-syntax"><i class="fa fa-check"></i><b>17.5</b> Consider using the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="17.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>17.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="17.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>17.7</b> Annotate your code</a></li>
<li class="chapter" data-level="17.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>17.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="17.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>17.9</b> Code in public</a></li>
<li class="chapter" data-level="17.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-social-media"><i class="fa fa-check"></i><b>17.10</b> Check out social media</a></li>
<li class="chapter" data-level="17.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#extra-rethinking-related-resources"><i class="fa fa-check"></i><b>17.11</b> Extra <em>Rethinking</em>-related resources</a></li>
<li class="chapter" data-level="17.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#but-like-how-do-i-do-this-for-real"><i class="fa fa-check"></i><b>17.12</b> <em>But, like, how do I do this for real?</em></a></li>
<li class="chapter" data-level="17.13" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>17.13</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse: Second edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-linear-madness" class="section level1" number="16">
<h1><span class="header-section-number">16</span> Generalized Linear Madness</h1>
<blockquote>
<p>Applied statistics has to apply to all the sciences, and so it is often much vaguer about models. Instead it focuses on average performance, regardless of the model. The generalized linear models in the preceding chapters are not credible scientific models of most natural processes. They are powerful, geocentric (<a href="geocentric-models.html#geocentric-models">Chapter 4</a>) descriptions of associations. In combination with a logic of causal inference, for example DAGs and <em>do</em>-calculus, generalized linear models can nevertheless be unreasonably powerful.</p>
<p>But there are problems with this GLMs-plus-DAGs approach. Not everything can be modeled as a GLM—a linear combination of variables mapped onto a non-linear outcome. But if it is the only approach you know, then you have to use it….</p>
<p>In this chapter, I will go <strong>beyond generalized linear madness</strong>. I’ll work through examples in which the scientific context provides a causal model that will breathe life into the statistical model. I’ve chosen examples which are individually distinct and highlight different challenges in developing and translating causal models into <em>bespoke</em> (see the Rethinking <del>box</del> [section] below) statistical models. You won’t require any specialized scientific expertise to grasp these examples. And the basic strategy is the same as it has been from the start: Define a generative model of a phenomenon and then use that model to design strategies for causal inference and statistical estimation. <span class="citation">(<a href="references.html#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020a, p. 525</a>, <em>emphasis</em> in the original)</span></p>
</blockquote>
<p>McElreath then reported he was going to work with Stan code, via <code>rstan::stan()</code>, in this chapter because of the unique demands of some of the models. Our approach will be mixed. We can fit at least a few of the models with <strong>brms</strong>, particularly with help from the non-linear syntax. However, some of the models to come are either beyond the current scope of <strong>brms</strong> or are at least beyond my current skill set. In those cases, we’ll follow McElreath’s approach and fit the models with <code>stan()</code>.</p>
<div id="rethinking-bespoken-for." class="section level4" number="16.0.0.1">
<h4><span class="header-section-number">16.0.0.1</span> Rethinking: Bespoken for.</h4>
<blockquote>
<p>Mass production has some advantages, but it also makes our clothes fit badly. Garments bought off-the-shelf are not manufactured with you in mind. They are not <em>bespoke</em> products, designed for any particular person with a particular body. Unless you are lucky to have a perfectly average body shape, you will need a tailor to get better.</p>
<p>Statistical analyses are similar. Generalized linear models are off-the-shelf products, mass produced for a consumer market of impatient researchers with diverse goals. Science asked statisticians for tools that could be used anywhere. And so they delivered. But the clothes don’t always fit. (p. 526, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="geometric-people" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Geometric people</h2>
<blockquote>
<p>Back in <a href="geocentric-models.html#geocentric-models">Chapter 4</a>, you met linear regression in the context of building a predictive model of height using weight. You even saw how to measure non-linear associations between the two variables. But nothing in that example was scientifically satisfying. The height-weight model was just a statistical device. It contains no biological information and tells us nothing about how the association between height and weight arises. Consider for example that weight obviously does not <em>cause</em> height, at least not in humans. If anything, the causal relationship is the reverse.</p>
<p>So now let’s try to do better. Why? Because when the model is scientifically inspired, rather than just statistically required, disagreements between model and data are informative of real causal relationships.</p>
<p>Suppose for example that a person is shaped like a cylinder. Of course a person isn’t exactly shaped like a cylinder. There are arms and a head. But let’s see how far this cylinder model gets us. The weight of the cylinder is a consequence of the volume of the cylinder. And the volume of the cylinder is a consequence of growth in the height and width of the cylinder. So if we can relate the height to the volume, then we’d have a model to predict weight from height. (p. 526, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="the-scientific-model." class="section level3" number="16.1.1">
<h3><span class="header-section-number">16.1.1</span> The scientific model.</h3>
<p>If we let <span class="math inline">\(V\)</span> stand for volume, <span class="math inline">\(r\)</span> stand for a radius, and <span class="math inline">\(h\)</span> stand for height, we can solve for volume by</p>
<p><span class="math display">\[V = \pi r^2 h.\]</span>
If we further presume a person’s radius is unknown, but some proportion (<span class="math inline">\(p\)</span>) of height (<span class="math inline">\(ph\)</span>), we can rewrite the formula as</p>
<p><span class="math display">\[\begin{align*}
V &amp; = \pi (ph)^2 h \\
  &amp; = \pi p^2 h^3.
\end{align*}\]</span></p>
<p>Though we’re not interested in volume per se, we might presume weight is some proportion of volume. Thus we could include a final parameter <span class="math inline">\(k\)</span> to stand for the conversion form weight to volume, leaving us with the formula</p>
<p><span class="math display">\[W = kV = k \pi p^2 h^3,\]</span></p>
<p>where <span class="math inline">\(W\)</span> denotes weight.</p>
</div>
<div id="the-statistical-model." class="section level3" number="16.1.2">
<h3><span class="header-section-number">16.1.2</span> The statistical model.</h3>
<p>For one last time, together, let’s load the <code>Howell1</code> data.</p>
<div class="sourceCode" id="cb2081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2081-1"><a href="generalized-linear-madness.html#cb2081-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2081-2"><a href="generalized-linear-madness.html#cb2081-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb2081-3"><a href="generalized-linear-madness.html#cb2081-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb2081-4"><a href="generalized-linear-madness.html#cb2081-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Howell1)</span>
<span id="cb2081-5"><a href="generalized-linear-madness.html#cb2081-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2081-6"><a href="generalized-linear-madness.html#cb2081-6" aria-hidden="true" tabindex="-1"></a><span class="co"># scale observed variables</span></span>
<span id="cb2081-7"><a href="generalized-linear-madness.html#cb2081-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb2081-8"><a href="generalized-linear-madness.html#cb2081-8" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb2081-9"><a href="generalized-linear-madness.html#cb2081-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w =</span> weight <span class="sc">/</span> <span class="fu">mean</span>(weight),</span>
<span id="cb2081-10"><a href="generalized-linear-madness.html#cb2081-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">h =</span> height <span class="sc">/</span> <span class="fu">mean</span>(height))</span></code></pre></div>
<p>McElreath’s proposed statistical model follows the form</p>
<p><span class="math display">\[\begin{align*}
\text{w}_i  &amp; \sim \operatorname{Log-Normal}(\mu_i, \sigma) \\
\exp(\mu_i) &amp; = k \pi p^2 \text{h}_i^3 \\
k      &amp; \sim \operatorname{Exponential}(0.5) \\
p      &amp; \sim \operatorname{Beta}(2, 18) \\
\sigma &amp; \sim \operatorname{Exponential}(1), &amp;&amp; \text{where} \\
\text w_i &amp; = \text{weight}_i \big / \overline{\text{weight}}, &amp;&amp; \text{and} \\
\text h_i &amp; = \text{height}_i \big / \overline{\text{height}}.
\end{align*}\]</span></p>
<p>The Log-Normal likelihood ensures the predictions for <span class="math inline">\(\text{weight}_i\)</span> will always be non-negative. Because our parameter <span class="math inline">\(p\)</span> is the ratio of radius to height, <span class="math inline">\(p = r / h\)</span>, it must be positive. Since people are typically taller than their width, it should also be less than one, and probably substantially less than that. Our next step will be taking a look at our priors.</p>
<p>For the plots in this chapter, we’ll give a nod the minimalistic plots in the authoritative text by <span class="citation"><a href="references.html#ref-gelman2013bayesian" role="doc-biblioref">Gelman et al.</a> (<a href="references.html#ref-gelman2013bayesian" role="doc-biblioref">2013</a>)</span>, <a href="https://stat.columbia.edu/~gelman/book/"><em>Bayesian data analysis: Third edition</em></a>. Just to be a little kick, we’ll set the font to <code>family = "Times"</code>. Most of the adjustments will come from <code>ggthemes::theme_base()</code>.</p>
<div class="sourceCode" id="cb2082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2082-1"><a href="generalized-linear-madness.html#cb2082-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb2082-2"><a href="generalized-linear-madness.html#cb2082-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2082-3"><a href="generalized-linear-madness.html#cb2082-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb2082-4"><a href="generalized-linear-madness.html#cb2082-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_base</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb2082-5"><a href="generalized-linear-madness.html#cb2082-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb2082-6"><a href="generalized-linear-madness.html#cb2082-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times&quot;</span>),</span>
<span id="cb2082-7"><a href="generalized-linear-madness.html#cb2082-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.25</span>),</span>
<span id="cb2082-8"><a href="generalized-linear-madness.html#cb2082-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb2082-9"><a href="generalized-linear-madness.html#cb2082-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="fl">0.1</span>),</span>
<span id="cb2082-10"><a href="generalized-linear-madness.html#cb2082-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2082-11"><a href="generalized-linear-madness.html#cb2082-11" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2082-12"><a href="generalized-linear-madness.html#cb2082-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now we have our theme, let’s get a sense of our priors.</p>
<div class="sourceCode" id="cb2083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2083-1"><a href="generalized-linear-madness.html#cb2083-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb2083-2"><a href="generalized-linear-madness.html#cb2083-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb2083-3"><a href="generalized-linear-madness.html#cb2083-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2083-4"><a href="generalized-linear-madness.html#cb2083-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">18</span>), <span class="at">nlpar =</span> p, <span class="at">coef =</span> <span class="fu">italic</span>(p)),</span>
<span id="cb2083-5"><a href="generalized-linear-madness.html#cb2083-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.5</span>), <span class="at">nlpar =</span> p, <span class="at">coef =</span> <span class="fu">italic</span>(k)),</span>
<span id="cb2083-6"><a href="generalized-linear-madness.html#cb2083-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">coef =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb2083-7"><a href="generalized-linear-madness.html#cb2083-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2083-8"><a href="generalized-linear-madness.html#cb2083-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>(prior) <span class="sc">%&gt;%</span></span>
<span id="cb2083-9"><a href="generalized-linear-madness.html#cb2083-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2083-10"><a href="generalized-linear-madness.html#cb2083-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">dist =</span> .dist, <span class="at">args =</span> .args)) <span class="sc">+</span></span>
<span id="cb2083-11"><a href="generalized-linear-madness.html#cb2083-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dist_halfeye</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p_limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.9995</span>),</span>
<span id="cb2083-12"><a href="generalized-linear-madness.html#cb2083-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n =</span> <span class="fl">2e3</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb2083-13"><a href="generalized-linear-madness.html#cb2083-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2083-14"><a href="generalized-linear-madness.html#cb2083-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(theta)) <span class="sc">+</span></span>
<span id="cb2083-15"><a href="generalized-linear-madness.html#cb2083-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> coef, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Here the points are the posterior medians and the horizontal lines the quantile-based 50% intervals. Turns out that <span class="math inline">\(\operatorname{Beta}(2, 18)\)</span> prior for <span class="math inline">\(p\)</span> pushes the bulk of the prior mass down near zero. The beta distribution also forces the parameter space for <span class="math inline">\(p\)</span> to range between 0 and 1. If we denote the two parameters of the beta distribution as <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, we can compute the mean for any beta distribution as <span class="math inline">\(\alpha / (\alpha + \beta)\)</span>. Thus the mean for our <span class="math inline">\(\operatorname{Beta}(2, 18)\)</span> prior is <span class="math inline">\(2 / (2 + 18) = 2 / 20 = 0.1\)</span>.</p>
<p>Because we computed our weight and height variables, <code>w</code> and <code>h</code>, by dividing the original variables by their respective means, each now has a mean of 1.</p>
<div class="sourceCode" id="cb2084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2084-1"><a href="generalized-linear-madness.html#cb2084-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2084-2"><a href="generalized-linear-madness.html#cb2084-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(w<span class="sc">:</span>h) <span class="sc">%&gt;%</span> </span>
<span id="cb2084-3"><a href="generalized-linear-madness.html#cb2084-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb2084-4"><a href="generalized-linear-madness.html#cb2084-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   name   mean
##   &lt;chr&gt; &lt;dbl&gt;
## 1 h         1
## 2 w         1</code></pre>
<p>Here’s their bivariate distribution in a scatter plot.</p>
<div class="sourceCode" id="cb2086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2086-1"><a href="generalized-linear-madness.html#cb2086-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2086-2"><a href="generalized-linear-madness.html#cb2086-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> h, <span class="at">y =</span> w)) <span class="sc">+</span></span>
<span id="cb2086-3"><a href="generalized-linear-madness.html#cb2086-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb2086-4"><a href="generalized-linear-madness.html#cb2086-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb2086-5"><a href="generalized-linear-madness.html#cb2086-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>With this scaling, here is the formula for an individual with average weight and height:</p>
<p><span class="math display">\[\begin{align*}
1 &amp; = k \pi p^2 1^3 \\
  &amp; = k \pi p^2.
\end{align*}\]</span></p>
<p>If you assume <span class="math inline">\(p &lt; .5\)</span>, <span class="math inline">\(k\)</span> must be greater than 1. <span class="math inline">\(k\)</span> also has to be positive. To get a sense of this, we can further work the algebra:</p>
<p><span class="math display">\[\begin{align*}
1 &amp; = k \pi p^2 \\
1/k  &amp; = \pi p^2 \\
k  &amp; = 1 / \pi p^2.
\end{align*}\]</span></p>
<p>To get a better sense of that relation, we might plot.</p>
<div class="sourceCode" id="cb2087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2087-1"><a href="generalized-linear-madness.html#cb2087-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.001</span>, <span class="at">to =</span> <span class="fl">0.499</span>, <span class="at">by =</span> <span class="fl">0.001</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2087-2"><a href="generalized-linear-madness.html#cb2087-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">k =</span> <span class="dv">1</span> <span class="sc">/</span> (pi <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2087-3"><a href="generalized-linear-madness.html#cb2087-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">y =</span> k)) <span class="sc">+</span></span>
<span id="cb2087-4"><a href="generalized-linear-madness.html#cb2087-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2087-5"><a href="generalized-linear-madness.html#cb2087-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(p)),</span>
<span id="cb2087-6"><a href="generalized-linear-madness.html#cb2087-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(k))) <span class="sc">+</span></span>
<span id="cb2087-7"><a href="generalized-linear-madness.html#cb2087-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>McElreath’s quick and dirty solution was to set <span class="math inline">\(k \sim \operatorname{Exponential}(0.5)\)</span>, which has a prior predictive mean of 2.</p>
<p>By setting up his model formula as <code>exp(mu) = ...</code>, McElreath effectively used the log link. It turns out that <strong>brms</strong> only supports the <code>identity</code> and <code>inverse</code> links for <code>family = lognormal</code>. However, we can sneak in the log link by nesting the right-hand side of the formula within <code>log()</code>.</p>
<div class="sourceCode" id="cb2088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2088-1"><a href="generalized-linear-madness.html#cb2088-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb2088-2"><a href="generalized-linear-madness.html#cb2088-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb2088-3"><a href="generalized-linear-madness.html#cb2088-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> lognormal,</span>
<span id="cb2088-4"><a href="generalized-linear-madness.html#cb2088-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(w <span class="sc">~</span> <span class="fu">log</span>(<span class="fl">3.141593</span> <span class="sc">*</span> k <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> h<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb2088-5"><a href="generalized-linear-madness.html#cb2088-5" aria-hidden="true" tabindex="-1"></a>         k <span class="sc">+</span> p <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2088-6"><a href="generalized-linear-madness.html#cb2088-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2088-7"><a href="generalized-linear-madness.html#cb2088-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">18</span>), <span class="at">nlpar =</span> p, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>),</span>
<span id="cb2088-8"><a href="generalized-linear-madness.html#cb2088-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.5</span>), <span class="at">nlpar =</span> k, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2088-9"><a href="generalized-linear-madness.html#cb2088-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb2088-10"><a href="generalized-linear-madness.html#cb2088-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2088-11"><a href="generalized-linear-madness.html#cb2088-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2088-12"><a href="generalized-linear-madness.html#cb2088-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.01&quot;</span>)</span></code></pre></div>
<p>Check the parameter summary.</p>
<div class="sourceCode" id="cb2089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2089-1"><a href="generalized-linear-madness.html#cb2089-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: lognormal 
##   Links: mu = identity; sigma = identity 
## Formula: w ~ log(3.141593 * k * p^2 * h^3) 
##          k ~ 1
##          p ~ 1
##    Data: d (Number of observations: 544) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## k_Intercept     5.79      2.72     2.16    12.49 1.00     1177     1488
## p_Intercept     0.25      0.06     0.16     0.37 1.00     1178     1459
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.21      0.01     0.19     0.22 1.00     1345     1133
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>McElreath didn’t show the parameter summary for his <code>m16.1</code> in the text. If you fit the model with both <strong>rethinking</strong> and <strong>brms</strong>, you’ll see our <code>b16.1</code> matches up quite well. To make our version of Figure 16.2, we’ll use a <code>GGally::ggpairs()</code> workflow. First we’ll save our customizes settings for the three subplot types.</p>
<div class="sourceCode" id="cb2091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2091-1"><a href="generalized-linear-madness.html#cb2091-1" aria-hidden="true" tabindex="-1"></a>my_lower <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb2091-2"><a href="generalized-linear-madness.html#cb2091-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2091-3"><a href="generalized-linear-madness.html#cb2091-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the x and y data to use the other code</span></span>
<span id="cb2091-4"><a href="generalized-linear-madness.html#cb2091-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">eval_data_col</span>(data, mapping<span class="sc">$</span>x)</span>
<span id="cb2091-5"><a href="generalized-linear-madness.html#cb2091-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">eval_data_col</span>(data, mapping<span class="sc">$</span>y)</span>
<span id="cb2091-6"><a href="generalized-linear-madness.html#cb2091-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2091-7"><a href="generalized-linear-madness.html#cb2091-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the correlations</span></span>
<span id="cb2091-8"><a href="generalized-linear-madness.html#cb2091-8" aria-hidden="true" tabindex="-1"></a>  corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">&quot;p&quot;</span>, <span class="at">use =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb2091-9"><a href="generalized-linear-madness.html#cb2091-9" aria-hidden="true" tabindex="-1"></a>  abs_corr <span class="ot">&lt;-</span> <span class="fu">abs</span>(corr)</span>
<span id="cb2091-10"><a href="generalized-linear-madness.html#cb2091-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2091-11"><a href="generalized-linear-madness.html#cb2091-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot the cor value</span></span>
<span id="cb2091-12"><a href="generalized-linear-madness.html#cb2091-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggally_text</span>(</span>
<span id="cb2091-13"><a href="generalized-linear-madness.html#cb2091-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">formatC</span>(corr, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">format =</span> <span class="st">&quot;f&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(., <span class="st">&quot;0.&quot;</span>, <span class="st">&quot;.&quot;</span>),</span>
<span id="cb2091-14"><a href="generalized-linear-madness.html#cb2091-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(),</span>
<span id="cb2091-15"><a href="generalized-linear-madness.html#cb2091-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb2091-16"><a href="generalized-linear-madness.html#cb2091-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb2091-17"><a href="generalized-linear-madness.html#cb2091-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2091-18"><a href="generalized-linear-madness.html#cb2091-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2091-19"><a href="generalized-linear-madness.html#cb2091-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>)</span>
<span id="cb2091-20"><a href="generalized-linear-madness.html#cb2091-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2091-21"><a href="generalized-linear-madness.html#cb2091-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2091-22"><a href="generalized-linear-madness.html#cb2091-22" aria-hidden="true" tabindex="-1"></a>my_diag <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb2091-23"><a href="generalized-linear-madness.html#cb2091-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb2091-24"><a href="generalized-linear-madness.html#cb2091-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb2091-25"><a href="generalized-linear-madness.html#cb2091-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2091-26"><a href="generalized-linear-madness.html#cb2091-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>)</span>
<span id="cb2091-27"><a href="generalized-linear-madness.html#cb2091-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2091-28"><a href="generalized-linear-madness.html#cb2091-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2091-29"><a href="generalized-linear-madness.html#cb2091-29" aria-hidden="true" tabindex="-1"></a>my_upper <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb2091-30"><a href="generalized-linear-madness.html#cb2091-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb2091-31"><a href="generalized-linear-madness.html#cb2091-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2091-32"><a href="generalized-linear-madness.html#cb2091-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2091-33"><a href="generalized-linear-madness.html#cb2091-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>)</span>
<span id="cb2091-34"><a href="generalized-linear-madness.html#cb2091-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we make our version of Figure 16.2.a.</p>
<div class="sourceCode" id="cb2092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2092-1"><a href="generalized-linear-madness.html#cb2092-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2092-2"><a href="generalized-linear-madness.html#cb2092-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2092-3"><a href="generalized-linear-madness.html#cb2092-3" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b16<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2092-4"><a href="generalized-linear-madness.html#cb2092-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb2092-5"><a href="generalized-linear-madness.html#cb2092-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;italic(k)&quot;</span>, <span class="st">&quot;italic(p)&quot;</span>, <span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2092-6"><a href="generalized-linear-madness.html#cb2092-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper),</span>
<span id="cb2092-7"><a href="generalized-linear-madness.html#cb2092-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb2092-8"><a href="generalized-linear-madness.html#cb2092-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_lower),</span>
<span id="cb2092-9"><a href="generalized-linear-madness.html#cb2092-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb2092-10"><a href="generalized-linear-madness.html#cb2092-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb2092-11"><a href="generalized-linear-madness.html#cb2092-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-10-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>We see the lack of identifiability of <span class="math inline">\(k\)</span> and <span class="math inline">\(p\)</span> resulted in a strong inverse relation between them. Now here’s how we might make Figure 16.2.b.</p>
<div class="sourceCode" id="cb2093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2093-1"><a href="generalized-linear-madness.html#cb2093-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> </span>
<span id="cb2093-2"><a href="generalized-linear-madness.html#cb2093-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">h =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">50</span>))</span>
<span id="cb2093-3"><a href="generalized-linear-madness.html#cb2093-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2093-4"><a href="generalized-linear-madness.html#cb2093-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span></span>
<span id="cb2093-5"><a href="generalized-linear-madness.html#cb2093-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b16<span class="fl">.1</span>,</span>
<span id="cb2093-6"><a href="generalized-linear-madness.html#cb2093-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb2093-7"><a href="generalized-linear-madness.html#cb2093-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2093-8"><a href="generalized-linear-madness.html#cb2093-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd)</span>
<span id="cb2093-9"><a href="generalized-linear-madness.html#cb2093-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2093-10"><a href="generalized-linear-madness.html#cb2093-10" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2093-11"><a href="generalized-linear-madness.html#cb2093-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> h)) <span class="sc">+</span></span>
<span id="cb2093-12"><a href="generalized-linear-madness.html#cb2093-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> p,</span>
<span id="cb2093-13"><a href="generalized-linear-madness.html#cb2093-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb2093-14"><a href="generalized-linear-madness.html#cb2093-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb2093-15"><a href="generalized-linear-madness.html#cb2093-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2093-16"><a href="generalized-linear-madness.html#cb2093-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> w),</span>
<span id="cb2093-17"><a href="generalized-linear-madness.html#cb2093-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2093-18"><a href="generalized-linear-madness.html#cb2093-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(d<span class="sc">$</span>h)),</span>
<span id="cb2093-19"><a href="generalized-linear-madness.html#cb2093-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(d<span class="sc">$</span>w))) <span class="sc">+</span></span>
<span id="cb2093-20"><a href="generalized-linear-madness.html#cb2093-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;height (scaled)&quot;</span>,</span>
<span id="cb2093-21"><a href="generalized-linear-madness.html#cb2093-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;weight (scaled)&quot;</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Overall the model did okay, but the poor fit for the cases with lower values of height and weight suggests we might be missing important differences between children and adults.</p>
</div>
<div id="glm-in-disguise." class="section level3" number="16.1.3">
<h3><span class="header-section-number">16.1.3</span> GLM in disguise.</h3>
<p>Recall that because <strong>brms</strong> does not support the log link for the Log-Normal likelihood, we recast our <code>b16.1</code> likelihood as</p>
<p><span class="math display">\[\begin{align*}
\text{w}_i &amp; \sim \operatorname{Log-Normal}(\mu_i, \sigma) \\
\mu_i      &amp; = \log(k \pi p^2 \text{h}_i^3).
\end{align*}\]</span></p>
<p>Because multiplication becomes addition on the log scale, we can also express this as</p>
<p><span class="math display">\[\begin{align*}
\text{w}_i &amp; \sim \operatorname{Log-Normal}(\mu_i, \sigma) \\
\mu_i      &amp; = \log(k) + \log(\pi) + 2 \log(p) + 3 \log(\text{h}_i),
\end{align*}\]</span></p>
<p>which means our fancy non-linear model is just linear regression on the log scale. McElreath pointed this out</p>
<blockquote>
<p>to highlight one of the reasons that generalized linear models are so powerful. Lots of natural relationships are GLM relationships, on a specific scale of measurement. At the same time, the GLM approach wants to simply estimate parameters which may be informed by a proper theory, as in this case. (p. 531)</p>
</blockquote>
</div>
</div>
<div id="hidden-minds-and-observed-behavior" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Hidden minds and observed behavior</h2>
<p>Load the <code>Boxes</code> data <span class="citation">(<a href="references.html#ref-vanleeuwenDevelopmentHumanSocial2018" role="doc-biblioref">van Leeuwen et al., 2018</a>)</span>.</p>
<div class="sourceCode" id="cb2094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2094-1"><a href="generalized-linear-madness.html#cb2094-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boxes, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb2094-2"><a href="generalized-linear-madness.html#cb2094-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Boxes</span>
<span id="cb2094-3"><a href="generalized-linear-madness.html#cb2094-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Boxes)</span>
<span id="cb2094-4"><a href="generalized-linear-madness.html#cb2094-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2094-5"><a href="generalized-linear-madness.html#cb2094-5" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">precis</span>(d)</span></code></pre></div>
<pre><code>##                     mean        sd 5.5% 94.5%      histogram
## y              2.1208267 0.7279860    1     3     ▃▁▁▁▇▁▁▁▁▅
## gender         1.5055644 0.5003669    1     2     ▇▁▁▁▁▁▁▁▁▇
## age            8.0302067 2.4979055    5    13     ▇▃▅▃▃▃▂▂▂▁
## majority_first 0.4848967 0.5001696    0     1     ▇▁▁▁▁▁▁▁▁▇
## culture        3.7519873 1.9603189    1     8 ▃▂▁▇▁▂▁▂▁▂▁▁▁▁</code></pre>
<p>The data are from 629 children.</p>
<div class="sourceCode" id="cb2096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2096-1"><a href="generalized-linear-madness.html#cb2096-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code></pre></div>
<pre><code>##     n
## 1 629</code></pre>
<p>Their ages ranged from 4 to 14 years and, as indicated by the histogram above, the bulk were on the younger end.</p>
<div class="sourceCode" id="cb2098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2098-1"><a href="generalized-linear-madness.html#cb2098-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2098-2"><a href="generalized-linear-madness.html#cb2098-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">min =</span> <span class="fu">min</span>(age),</span>
<span id="cb2098-3"><a href="generalized-linear-madness.html#cb2098-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(age))</span></code></pre></div>
<pre><code>##   min max
## 1   4  14</code></pre>
<p>Here’s a depiction of our criterion variable <code>y</code>.</p>
<div class="sourceCode" id="cb2100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2100-1"><a href="generalized-linear-madness.html#cb2100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2100-2"><a href="generalized-linear-madness.html#cb2100-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2100-3"><a href="generalized-linear-madness.html#cb2100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">factor</span>(y,</span>
<span id="cb2100-4"><a href="generalized-linear-madness.html#cb2100-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb2100-5"><a href="generalized-linear-madness.html#cb2100-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;unchosen&quot;</span>, <span class="st">&quot;majority&quot;</span>, <span class="st">&quot;minority&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb2100-6"><a href="generalized-linear-madness.html#cb2100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">str_c</span>(y, <span class="st">&quot; (&quot;</span>, color, <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2100-7"><a href="generalized-linear-madness.html#cb2100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(y) <span class="sc">%&gt;%</span> </span>
<span id="cb2100-8"><a href="generalized-linear-madness.html#cb2100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> (<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb2100-9"><a href="generalized-linear-madness.html#cb2100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(percent, <span class="at">digits =</span> <span class="dv">1</span>), <span class="st">&quot;%&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2100-10"><a href="generalized-linear-madness.html#cb2100-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2100-11"><a href="generalized-linear-madness.html#cb2100-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2100-12"><a href="generalized-linear-madness.html#cb2100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb2100-13"><a href="generalized-linear-madness.html#cb2100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span></span>
<span id="cb2100-14"><a href="generalized-linear-madness.html#cb2100-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> n <span class="sc">+</span> <span class="dv">4</span>, <span class="at">label =</span> label),</span>
<span id="cb2100-15"><a href="generalized-linear-madness.html#cb2100-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2100-16"><a href="generalized-linear-madness.html#cb2100-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(n)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>))) <span class="sc">+</span></span>
<span id="cb2100-17"><a href="generalized-linear-madness.html#cb2100-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;The criterion variable y indexes three kinds of color choices&quot;</span>,</span>
<span id="cb2100-18"><a href="generalized-linear-madness.html#cb2100-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Children tended to prefer the &#39;majority&#39; color.&quot;</span>,</span>
<span id="cb2100-19"><a href="generalized-linear-madness.html#cb2100-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2100-20"><a href="generalized-linear-madness.html#cb2100-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb2100-21"><a href="generalized-linear-madness.html#cb2100-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-15-1.png" width="600" style="display: block; margin: auto;" /></p>
<div id="the-scientific-model.-1" class="section level3" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> The scientific model.</h3>
<blockquote>
<p>The key, as always, is to think generatively. Consider for example a group of children in which half of them choose at random and the other half follow the majority. If we simulate choices for these children, we can figure out how often we might see the “2” choice, the one that indicates the majority color. (p. 532)</p>
</blockquote>
<p>Here’s an alternative way to set up McEreath’s <strong>R</strong> code 16.6.</p>
<div class="sourceCode" id="cb2101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2101-1"><a href="generalized-linear-madness.html#cb2101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2101-2"><a href="generalized-linear-madness.html#cb2101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2101-3"><a href="generalized-linear-madness.html#cb2101-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="co"># number of children</span></span>
<span id="cb2101-4"><a href="generalized-linear-madness.html#cb2101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2101-5"><a href="generalized-linear-madness.html#cb2101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name  =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;y1&quot;</span>, <span class="st">&quot;y2&quot;</span>), <span class="at">each =</span> n <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb2101-6"><a href="generalized-linear-madness.html#cb2101-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> n <span class="sc">/</span> <span class="dv">2</span>, <span class="at">replace =</span> T),</span>
<span id="cb2101-7"><a href="generalized-linear-madness.html#cb2101-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">rep</span>(<span class="dv">2</span>, n <span class="sc">/</span> <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2101-8"><a href="generalized-linear-madness.html#cb2101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">sample</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb2101-9"><a href="generalized-linear-madness.html#cb2101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">number of 2s</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(y <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">/</span> n)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   `number of 2s`
##            &lt;dbl&gt;
## 1          0.633</code></pre>
<blockquote>
<p>We’ll consider 5 different strategies children might use.</p>
<ol style="list-style-type: decimal">
<li>Follow the Majority: Copy the majority demonstrated color.</li>
<li>Follow the Minority: Copy the minority demonstrated color.</li>
<li>Maverick: Choose the color that no demonstrator chose.</li>
<li>Random: Choose a color at random, ignoring the demonstrators.</li>
<li>Follow First: Copy the color that was demonstrated first. This was either the majority color (when <code>majority_first</code> equals 1) or the minority color (when 0). (p. 533)</li>
</ol>
</blockquote>
</div>
<div id="the-statistical-model.-1" class="section level3" number="16.2.2">
<h3><span class="header-section-number">16.2.2</span> The statistical model.</h3>
<p>Our statistical will follow the form</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; \sim \operatorname{Categorical}(\theta) \\
\theta_j &amp; = \sum_{s = 1}^5 p_s \operatorname{Pr}(j | s) \;\;\; \text{for} \; j = 1, \dots, 3 \\
p &amp; \sim \operatorname{Dirichlet}(4, 4, 4, 4, 4),
\end{align*}\]</span></p>
<p>where <span class="math inline">\(s\)</span> indexes one of our five latent strategies and <span class="math inline">\(\operatorname{Pr}(j | s)\)</span> is the probability of one of the three color choices given a child is using the <span class="math inline">\(s\)</span>th strategy. The <span class="math inline">\(\sum_{s = 1}^5 p_s\)</span> portion conveys these five probabilities are treated as a simplex, which means they will sum to one. We give these probabilities a Dirichlet prior, which we learned about back in <a href="monsters-and-mixtures.html#ordered-categorical-predictors">Section 12.4</a>. Here’s what that prior looks like.</p>
<div class="sourceCode" id="cb2103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2103-1"><a href="generalized-linear-madness.html#cb2103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2103-2"><a href="generalized-linear-madness.html#cb2103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2103-3"><a href="generalized-linear-madness.html#cb2103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rdirichlet</span>(<span class="at">n =</span> <span class="fl">1e5</span>, <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="at">times =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-4"><a href="generalized-linear-madness.html#cb2103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2103-5"><a href="generalized-linear-madness.html#cb2103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-6"><a href="generalized-linear-madness.html#cb2103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-7"><a href="generalized-linear-madness.html#cb2103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name  =</span> name <span class="sc">%&gt;%</span> <span class="fu">as.double</span>(),</span>
<span id="cb2103-8"><a href="generalized-linear-madness.html#cb2103-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">str_c</span>(<span class="st">&quot;alpha[&quot;</span>, name, <span class="st">&quot;]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2103-9"><a href="generalized-linear-madness.html#cb2103-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2103-10"><a href="generalized-linear-madness.html#cb2103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">group =</span> name)) <span class="sc">+</span> </span>
<span id="cb2103-11"><a href="generalized-linear-madness.html#cb2103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">binwidth =</span> .<span class="dv">02</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb2103-12"><a href="generalized-linear-madness.html#cb2103-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p[s])), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb2103-13"><a href="generalized-linear-madness.html#cb2103-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.2&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), ) <span class="sc">+</span></span>
<span id="cb2103-14"><a href="generalized-linear-madness.html#cb2103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2103-15"><a href="generalized-linear-madness.html#cb2103-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">&quot;Dirichlet&quot;</span><span class="sc">*</span>(<span class="dv">4</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">4</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb2103-16"><a href="generalized-linear-madness.html#cb2103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> alpha, <span class="at">labeller =</span> label_parsed, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="coding-the-statistical-model." class="section level3" number="16.2.3">
<h3><span class="header-section-number">16.2.3</span> Coding the statistical model.</h3>
<p>Let’s take a look at McElreath’s Stan code.</p>
<div class="sourceCode" id="cb2104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2104-1"><a href="generalized-linear-madness.html#cb2104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb2104-2"><a href="generalized-linear-madness.html#cb2104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boxes_model) </span>
<span id="cb2104-3"><a href="generalized-linear-madness.html#cb2104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(Boxes_model)</span></code></pre></div>
<pre><code>## 
## data{
##     int N;
##     int y[N];
##     int majority_first[N];
## }
## parameters{
##     simplex[5] p;
## }
## model{
##     vector[5] phi;
##     
##     // prior
##     p ~ dirichlet( rep_vector(4,5) );
##     
##     // probability of data
##     for ( i in 1:N ) {
##         if ( y[i]==2 ) phi[1]=1; else phi[1]=0; // majority
##         if ( y[i]==3 ) phi[2]=1; else phi[2]=0; // minority
##         if ( y[i]==1 ) phi[3]=1; else phi[3]=0; // maverick
##         phi[4]=1.0/3.0;                         // random
##         if ( majority_first[i]==1 )             // follow first
##             if ( y[i]==2 ) phi[5]=1; else phi[5]=0;
##         else
##             if ( y[i]==3 ) phi[5]=1; else phi[5]=0;
##         
##         // compute log( p_s * Pr(y_i|s )
##         for ( j in 1:5 ) phi[j] = log(p[j]) + log(phi[j]);
##         // compute average log-probability of y_i
##         target += log_sum_exp( phi );
##     }
## }</code></pre>
<p>I’m not aware that one can fit this model directly with <strong>brms</strong>. My guess is that if it’s possible, it would require a custom likelihood <span class="citation">(see <a href="references.html#ref-Bürkner2021Define" role="doc-biblioref">Bürkner, 2021a</a>)</span>. If you can reproduce McElreath’s Stan code with this or some other approach in <strong>brms</strong>, please <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">share your code on GitHub</a>. In the mean time, we’re going to follow along with the text and fit the model with <code>rstan::stan()</code>.</p>
<div class="sourceCode" id="cb2106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2106-1"><a href="generalized-linear-madness.html#cb2106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prep data </span></span>
<span id="cb2106-2"><a href="generalized-linear-madness.html#cb2106-2" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2106-3"><a href="generalized-linear-madness.html#cb2106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(d),</span>
<span id="cb2106-4"><a href="generalized-linear-madness.html#cb2106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> d<span class="sc">$</span>y,</span>
<span id="cb2106-5"><a href="generalized-linear-madness.html#cb2106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">majority_first =</span> d<span class="sc">$</span>majority_first )</span>
<span id="cb2106-6"><a href="generalized-linear-madness.html#cb2106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2106-7"><a href="generalized-linear-madness.html#cb2106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># run the sampler</span></span>
<span id="cb2106-8"><a href="generalized-linear-madness.html#cb2106-8" aria-hidden="true" tabindex="-1"></a>m16<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb2106-9"><a href="generalized-linear-madness.html#cb2106-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan</span>(<span class="at">model_code =</span> Boxes_model, </span>
<span id="cb2106-10"><a href="generalized-linear-madness.html#cb2106-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> dat_list, </span>
<span id="cb2106-11"><a href="generalized-linear-madness.html#cb2106-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">chains =</span> <span class="dv">3</span>, <span class="at">cores =</span> <span class="dv">3</span>,</span>
<span id="cb2106-12"><a href="generalized-linear-madness.html#cb2106-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">16</span>)</span></code></pre></div>
<p>Here’s what it looks like if you <code>print()</code> a fit object from the <code>stan()</code> function.</p>
<div class="sourceCode" id="cb2107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2107-1"><a href="generalized-linear-madness.html#cb2107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(m16<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Inference for Stan model: 27b25f2c261c65f6230541a266cbbdbd.
## 3 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=3000.
## 
##         mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat
## p[1]    0.26    0.00 0.04    0.19    0.23    0.26    0.28    0.32   986 1.00
## p[2]    0.14    0.00 0.03    0.07    0.12    0.14    0.16    0.20  1087 1.01
## p[3]    0.15    0.00 0.03    0.09    0.13    0.15    0.17    0.20  1066 1.01
## p[4]    0.20    0.00 0.08    0.07    0.14    0.19    0.25    0.37   792 1.01
## p[5]    0.26    0.00 0.03    0.20    0.24    0.26    0.28    0.32  2559 1.00
## lp__ -667.17    0.04 1.44 -670.69 -667.91 -666.81 -666.12 -665.32  1203 1.00
## 
## Samples were drawn using NUTS(diag_e) at Sat Nov  7 14:32:59 2020.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Here’s the summary with <code>rethinking::precis()</code>.</p>
<div class="sourceCode" id="cb2109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2109-1"><a href="generalized-linear-madness.html#cb2109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m16<span class="fl">.2</span>, <span class="at">depth =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##           mean         sd       5.5%     94.5%     n_eff     Rhat4
## p[1] 0.2576792 0.03642940 0.19925939 0.3143086  985.7502 1.0042274
## p[2] 0.1390785 0.03299730 0.08584531 0.1916790 1086.6851 1.0056198
## p[3] 0.1479720 0.03021546 0.09678031 0.1942334 1066.2915 1.0066600
## p[4] 0.1961164 0.07966720 0.08178310 0.3356874  791.8116 1.0078264
## p[5] 0.2591538 0.03212438 0.20681421 0.3103560 2559.2139 0.9991496</code></pre>
<p>Here we show marginal posterior for <span class="math inline">\(p_s\)</span>.</p>
<div class="sourceCode" id="cb2111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2111-1"><a href="generalized-linear-madness.html#cb2111-1" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Majority~(italic(s)[1])&quot;</span>, </span>
<span id="cb2111-2"><a href="generalized-linear-madness.html#cb2111-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Minority~(italic(s)[2])&quot;</span>,</span>
<span id="cb2111-3"><a href="generalized-linear-madness.html#cb2111-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Maverick~(italic(s)[3])&quot;</span>, </span>
<span id="cb2111-4"><a href="generalized-linear-madness.html#cb2111-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Random~(italic(s)[4])&quot;</span>, </span>
<span id="cb2111-5"><a href="generalized-linear-madness.html#cb2111-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;Follow~First~(italic(s)[5])&quot;</span>)</span>
<span id="cb2111-6"><a href="generalized-linear-madness.html#cb2111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2111-7"><a href="generalized-linear-madness.html#cb2111-7" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m16<span class="fl">.2</span>, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2111-8"><a href="generalized-linear-madness.html#cb2111-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2111-9"><a href="generalized-linear-madness.html#cb2111-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(label, <span class="at">levels =</span> label)) <span class="sc">%&gt;%</span> </span>
<span id="cb2111-10"><a href="generalized-linear-madness.html#cb2111-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_rev</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb2111-11"><a href="generalized-linear-madness.html#cb2111-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2111-12"><a href="generalized-linear-madness.html#cb2111-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> X5.<span class="fl">5.</span>, <span class="at">xmax =</span> X94.<span class="fl">5.</span>, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb2111-13"><a href="generalized-linear-madness.html#cb2111-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2111-14"><a href="generalized-linear-madness.html#cb2111-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">fatten =</span> <span class="dv">6</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2111-15"><a href="generalized-linear-madness.html#cb2111-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p[s])), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb2111-16"><a href="generalized-linear-madness.html#cb2111-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2111-17"><a href="generalized-linear-madness.html#cb2111-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb2111-18"><a href="generalized-linear-madness.html#cb2111-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>As an alternative, this might be a good time to revisit the <code>tidybayes::stat_ccdfinterval()</code> approach (see <a href="monsters-and-mixtures.html#adding-predictor-variables.">Section 12.3.3</a>), which will depict those posteriors with a bar plot where the ends of the bars depict our uncertainty in terms of cumulative density curves.</p>
<div class="sourceCode" id="cb2112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2112-1"><a href="generalized-linear-madness.html#cb2112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(m16<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-2"><a href="generalized-linear-madness.html#cb2112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2112-3"><a href="generalized-linear-madness.html#cb2112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-4"><a href="generalized-linear-madness.html#cb2112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(label) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-5"><a href="generalized-linear-madness.html#cb2112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-6"><a href="generalized-linear-madness.html#cb2112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> label)) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-7"><a href="generalized-linear-madness.html#cb2112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_rev</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb2112-8"><a href="generalized-linear-madness.html#cb2112-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2112-9"><a href="generalized-linear-madness.html#cb2112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb2112-10"><a href="generalized-linear-madness.html#cb2112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2112-11"><a href="generalized-linear-madness.html#cb2112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ccdfinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb2112-12"><a href="generalized-linear-madness.html#cb2112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p[s])), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb2112-13"><a href="generalized-linear-madness.html#cb2112-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2112-14"><a href="generalized-linear-madness.html#cb2112-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb2112-15"><a href="generalized-linear-madness.html#cb2112-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb2112-16"><a href="generalized-linear-madness.html#cb2112-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-24-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="state-space-models." class="section level3" number="16.2.4">
<h3><span class="header-section-number">16.2.4</span> State space models.</h3>
<p>In this section of the text, McElreath mentioned state space models and hidden Markov models. Based on <a href="https://discourse.mc-stan.org/t/state-space-models-with-brms/4087">this thread</a> in the Stan forums and <a href="https://github.com/paul-buerkner/brms/issues/173">this issue</a> in the <strong>brms</strong> GitHub repo, it looks like state space models are not supported in <strong>brms</strong> at this time. As for hidden Markov models, I’m not sure whether they are supported by <strong>brms</strong>. The best I could find was <a href="https://discourse.mc-stan.org/t/modelling-with-non-binary-proportions-as-outcome/12324">this thread</a> on the Stan forums. If you know more about either of these topics, please share your knowledge <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues">on this book’s GitHub repo</a>.</p>
</div>
</div>
<div id="ordinary-differential-nut-cracking" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> Ordinary differential nut cracking</h2>
<p>Load the <code>Panda_nuts</code> data <span class="citation">(<a href="references.html#ref-boeschLearningCurvesTeaching2019" role="doc-biblioref">Boesch et al., 2019</a>)</span>.</p>
<div class="sourceCode" id="cb2113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2113-1"><a href="generalized-linear-madness.html#cb2113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Panda_nuts, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb2113-2"><a href="generalized-linear-madness.html#cb2113-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Panda_nuts</span>
<span id="cb2113-3"><a href="generalized-linear-madness.html#cb2113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Panda_nuts)</span></code></pre></div>
<p>Anticipating McElreath’s <strong>R</strong> code 16.11, we’ll wrangle a little.</p>
<div class="sourceCode" id="cb2114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2114-1"><a href="generalized-linear-madness.html#cb2114-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb2114-2"><a href="generalized-linear-madness.html#cb2114-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb2114-3"><a href="generalized-linear-madness.html#cb2114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n     =</span> nuts_opened,</span>
<span id="cb2114-4"><a href="generalized-linear-madness.html#cb2114-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_s =</span> age <span class="sc">/</span> <span class="fu">max</span>(age))</span>
<span id="cb2114-5"><a href="generalized-linear-madness.html#cb2114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2114-6"><a href="generalized-linear-madness.html#cb2114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d)</span></code></pre></div>
<pre><code>## Rows: 84
## Columns: 9
## $ chimpanzee  &lt;int&gt; 11, 11, 18, 18, 18, 11, 11, 17, 7, 1, 22, 9, 9, 9, 9, 9, 9, 9, 9, 9, 15, 7, 9, 1, 7, 13,…
## $ age         &lt;int&gt; 3, 3, 4, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6…
## $ sex         &lt;fct&gt; m, m, f, f, f, m, m, f, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m, m…
## $ hammer      &lt;fct&gt; G, G, wood, G, L, Q, Q, wood, G, L, wood, G, G, G, G, G, G, G, G, G, G, G, G, L, G, wood…
## $ nuts_opened &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 58, 4, 21, 9, 2, 30, 19, 13, 6, 11, 1, 2, 0, 1, 0, 0, 0…
## $ seconds     &lt;dbl&gt; 61.0, 37.0, 20.0, 14.0, 13.0, 24.0, 30.5, 135.0, 24.0, 13.0, 34.0, 66.5, 5.0, 24.0, 20.0…
## $ help        &lt;fct&gt; N, N, N, y, N, N, N, N, N, N, N, N, N, N, N, N, N, N, N, N, N, y, N, N, N, N, N, y, y, N…
## $ n           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 58, 4, 21, 9, 2, 30, 19, 13, 6, 11, 1, 2, 0, 1, 0, 0, 0…
## $ age_s       &lt;dbl&gt; 0.1875, 0.1875, 0.2500, 0.2500, 0.2500, 0.2500, 0.2500, 0.3125, 0.3125, 0.3125, 0.3125, …</code></pre>
<p>Our criterion is <code>n</code>, the number of <em>Panda</em> nuts opened by a chimpanzee on a given occasion. The two focal predictor variables are <code>age</code> and <code>seconds</code>. Here they are depicted in a pairs plot.</p>
<div class="sourceCode" id="cb2116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2116-1"><a href="generalized-linear-madness.html#cb2116-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb2116-2"><a href="generalized-linear-madness.html#cb2116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, age, seconds) <span class="sc">%&gt;%</span> </span>
<span id="cb2116-3"><a href="generalized-linear-madness.html#cb2116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper),</span>
<span id="cb2116-4"><a href="generalized-linear-madness.html#cb2116-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb2116-5"><a href="generalized-linear-madness.html#cb2116-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_lower)) <span class="sc">+</span></span>
<span id="cb2116-6"><a href="generalized-linear-madness.html#cb2116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">angle =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-27-1.png" width="432" style="display: block; margin: auto;" /></p>
<div id="scientific-model." class="section level3" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Scientific model.</h3>
<p>As a starting point, McElreath proposed we the strength of a chimpanzee would relate to the number of nuts they might open. We don’t have a measure of strength, but we do have <code>age</code>, which is a proxy for how close a chimp might be to their maximum body size, and we presume body size would be proportional to strength. If we let <span class="math inline">\(t\)</span> index time, <span class="math inline">\(M_\text{max}\)</span> be the maximum body size (mass), <span class="math inline">\(M_t\)</span> be the current body size, and <span class="math inline">\(k\)</span> stand for the rate of skill gain the comes with age, we can write</p>
<p><span class="math display">\[M_t = M_\text{max} [1 - \exp(-kt) ]\]</span></p>
<p>to solve for mass at a given age <span class="citation">(<a href="references.html#ref-vonbertalanffyUntersuchungenUeberGesetzlichkeit1934" role="doc-biblioref">von Bertalanffy, 1934</a>)</span>. But again, we actually care about strength, not mass. Letting <span class="math inline">\(S_t\)</span> be strength at time <span class="math inline">\(t\)</span>, we can express a proportional relation between the two as <span class="math inline">\(S_t = \beta M_t\)</span>. Now if we let <span class="math inline">\(\lambda\)</span> stand in for the number of nuts opening, <span class="math inline">\(\alpha\)</span> express the relation of strength to nut opening, we can write</p>
<p><span class="math display">\[\lambda = \alpha S_t^\theta = \alpha \big ( \beta M_\text{max} [1 - \exp(-kt) ]  \big ) ^\theta,\]</span></p>
<p>“where <span class="math inline">\(\theta\)</span> is some exponent greater than 1” (p. 538). If we rescale <span class="math inline">\(M_\text{max} = 1\)</span>, we can simplify the equation to</p>
<p><span class="math display">\[\lambda = \alpha \beta^\theta [1 - \exp(-kt) ]^\theta.\]</span></p>
<p>As “the product <span class="math inline">\(\alpha \beta^\theta\)</span> in the front just rescales strength to nuts-opened-per-second” (p. 538), we can collapse it to a single parameter, <span class="math inline">\(\phi\)</span>, which leaves us with</p>
<p><span class="math display">\[\lambda = \phi [1 - \exp(-kt) ]^\theta.\]</span></p>
<p>This is our scientific model.</p>
</div>
<div id="statistical-model." class="section level3" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Statistical model.</h3>
<p>Now if we let <span class="math inline">\(n_i\)</span> be the number of nuts opened, we can write our statistical model as</p>
<p><span class="math display">\[\begin{align*}
n_i &amp; \sim \operatorname{Poisson}(\lambda_i) \\
\lambda_i &amp; = \text{seconds}_i \, \phi [1 - \exp(-k \,\text{age}_i) ]^\theta,
\end{align*}\]</span></p>
<p>where we have replaced our time index, <span class="math inline">\(t\)</span>, with the variable <code>age</code>. By including the variable <code>seconds</code> in the equation, we have scaled the results to be nuts per second. McElreath proposed the priors:</p>
<p><span class="math display">\[\begin{align*}
\phi   &amp; \sim \operatorname{Log-Normal}(\log 1, 0.10) \\
k      &amp; \sim \operatorname{Log-Normal}(\log 2, 0.25) \\
\theta &amp; \sim \operatorname{Log-Normal}(\log 5, 0.25),
\end{align*}\]</span></p>
<p>all of which were Log-Normal to ensure the parameters were positive and continuous. To get a sense of what these priors implied, he simulated. Here’s our version of his simulations, which make up Figure 16.4.</p>
<div class="sourceCode" id="cb2117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2117-1"><a href="generalized-linear-madness.html#cb2117-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb2117-2"><a href="generalized-linear-madness.html#cb2117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-3"><a href="generalized-linear-madness.html#cb2117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the x-axis breaks</span></span>
<span id="cb2117-4"><a href="generalized-linear-madness.html#cb2117-4" aria-hidden="true" tabindex="-1"></a>at <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb2117-5"><a href="generalized-linear-madness.html#cb2117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-6"><a href="generalized-linear-madness.html#cb2117-6" aria-hidden="true" tabindex="-1"></a><span class="co"># how many prior draws would you like?</span></span>
<span id="cb2117-7"><a href="generalized-linear-madness.html#cb2117-7" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb2117-8"><a href="generalized-linear-madness.html#cb2117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-9"><a href="generalized-linear-madness.html#cb2117-9" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb2117-10"><a href="generalized-linear-madness.html#cb2117-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2117-11"><a href="generalized-linear-madness.html#cb2117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-12"><a href="generalized-linear-madness.html#cb2117-12" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span></span>
<span id="cb2117-13"><a href="generalized-linear-madness.html#cb2117-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb2117-14"><a href="generalized-linear-madness.html#cb2117-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">phi   =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">1</span>), <span class="at">sdlog =</span> <span class="fl">0.1</span>),</span>
<span id="cb2117-15"><a href="generalized-linear-madness.html#cb2117-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">k     =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">2</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>),</span>
<span id="cb2117-16"><a href="generalized-linear-madness.html#cb2117-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">5</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2117-17"><a href="generalized-linear-madness.html#cb2117-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb2117-18"><a href="generalized-linear-madness.html#cb2117-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(index, phi, k, theta),</span>
<span id="cb2117-19"><a href="generalized-linear-madness.html#cb2117-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="fl">1e2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2117-20"><a href="generalized-linear-madness.html#cb2117-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bm =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age),</span>
<span id="cb2117-21"><a href="generalized-linear-madness.html#cb2117-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">ns =</span> phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age))<span class="sc">^</span>theta) </span>
<span id="cb2117-22"><a href="generalized-linear-madness.html#cb2117-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-23"><a href="generalized-linear-madness.html#cb2117-23" aria-hidden="true" tabindex="-1"></a><span class="co"># left panel</span></span>
<span id="cb2117-24"><a href="generalized-linear-madness.html#cb2117-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2117-25"><a href="generalized-linear-madness.html#cb2117-25" aria-hidden="true" tabindex="-1"></a>  prior <span class="sc">%&gt;%</span> </span>
<span id="cb2117-26"><a href="generalized-linear-madness.html#cb2117-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> bm, <span class="at">group =</span> index)) <span class="sc">+</span></span>
<span id="cb2117-27"><a href="generalized-linear-madness.html#cb2117-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2117-28"><a href="generalized-linear-madness.html#cb2117-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> at, <span class="at">labels =</span> <span class="fu">round</span>(at <span class="sc">*</span> <span class="fu">max</span>(d<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb2117-29"><a href="generalized-linear-madness.html#cb2117-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;body mass&quot;</span>)</span>
<span id="cb2117-30"><a href="generalized-linear-madness.html#cb2117-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-31"><a href="generalized-linear-madness.html#cb2117-31" aria-hidden="true" tabindex="-1"></a><span class="co"># right panel</span></span>
<span id="cb2117-32"><a href="generalized-linear-madness.html#cb2117-32" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2117-33"><a href="generalized-linear-madness.html#cb2117-33" aria-hidden="true" tabindex="-1"></a>  prior <span class="sc">%&gt;%</span> </span>
<span id="cb2117-34"><a href="generalized-linear-madness.html#cb2117-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> ns, <span class="at">group =</span> index)) <span class="sc">+</span></span>
<span id="cb2117-35"><a href="generalized-linear-madness.html#cb2117-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2117-36"><a href="generalized-linear-madness.html#cb2117-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> at, <span class="at">labels =</span> <span class="fu">round</span>(at <span class="sc">*</span> <span class="fu">max</span>(d<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb2117-37"><a href="generalized-linear-madness.html#cb2117-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;nuts per second&quot;</span>)</span>
<span id="cb2117-38"><a href="generalized-linear-madness.html#cb2117-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-39"><a href="generalized-linear-madness.html#cb2117-39" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and plot</span></span>
<span id="cb2117-40"><a href="generalized-linear-madness.html#cb2117-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2117-41"><a href="generalized-linear-madness.html#cb2117-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2117-42"><a href="generalized-linear-madness.html#cb2117-42" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> </span>
<span id="cb2117-43"><a href="generalized-linear-madness.html#cb2117-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Prior predictive simulation for the nut opening model&quot;</span>,</span>
<span id="cb2117-44"><a href="generalized-linear-madness.html#cb2117-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Each panel shows the results from 50 prior draws.&quot;</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-28-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>McElreath suggested we inspect the distributions of these priors. Here they are in a series of histograms.</p>
<div class="sourceCode" id="cb2118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2118-1"><a href="generalized-linear-madness.html#cb2118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2118-2"><a href="generalized-linear-madness.html#cb2118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2118-3"><a href="generalized-linear-madness.html#cb2118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">phi         =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">1</span>), <span class="at">sdlog =</span> <span class="fl">0.1</span>),</span>
<span id="cb2118-4"><a href="generalized-linear-madness.html#cb2118-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">italic(k)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">2</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>),</span>
<span id="cb2118-5"><a href="generalized-linear-madness.html#cb2118-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">theta       =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">5</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2118-6"><a href="generalized-linear-madness.html#cb2118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2118-7"><a href="generalized-linear-madness.html#cb2118-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2118-8"><a href="generalized-linear-madness.html#cb2118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb2118-9"><a href="generalized-linear-madness.html#cb2118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="at">bins =</span> <span class="dv">40</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb2118-10"><a href="generalized-linear-madness.html#cb2118-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;marginal prior&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb2118-11"><a href="generalized-linear-madness.html#cb2118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2118-12"><a href="generalized-linear-madness.html#cb2118-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-29-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Happily, we can fit this model using the non-linear <strong>brms</strong> syntax.</p>
<div class="sourceCode" id="cb2119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2119-1"><a href="generalized-linear-madness.html#cb2119-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb2119-2"><a href="generalized-linear-madness.html#cb2119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb2119-3"><a href="generalized-linear-madness.html#cb2119-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> identity),</span>
<span id="cb2119-4"><a href="generalized-linear-madness.html#cb2119-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(n <span class="sc">~</span> seconds <span class="sc">*</span> phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_s))<span class="sc">^</span>theta,</span>
<span id="cb2119-5"><a href="generalized-linear-madness.html#cb2119-5" aria-hidden="true" tabindex="-1"></a>         phi <span class="sc">+</span> k <span class="sc">+</span> theta <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2119-6"><a href="generalized-linear-madness.html#cb2119-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2119-7"><a href="generalized-linear-madness.html#cb2119-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">1</span>), <span class="fl">0.1</span>), <span class="at">nlpar =</span> phi, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2119-8"><a href="generalized-linear-madness.html#cb2119-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">2</span>), <span class="fl">0.25</span>), <span class="at">nlpar =</span> k, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2119-9"><a href="generalized-linear-madness.html#cb2119-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">5</span>), <span class="fl">0.25</span>), <span class="at">nlpar =</span> theta, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb2119-10"><a href="generalized-linear-madness.html#cb2119-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2119-11"><a href="generalized-linear-madness.html#cb2119-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2119-12"><a href="generalized-linear-madness.html#cb2119-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.04&quot;</span>)</span></code></pre></div>
<p>Check the parameter summary.</p>
<div class="sourceCode" id="cb2120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2120-1"><a href="generalized-linear-madness.html#cb2120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = identity 
## Formula: n ~ seconds * phi * (1 - exp(-k * age_s))^theta 
##          phi ~ 1
##          k ~ 1
##          theta ~ 1
##    Data: d (Number of observations: 84) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## phi_Intercept       0.86      0.04     0.79     0.95 1.00     1045     1589
## k_Intercept         5.97      0.56     4.88     7.09 1.00      787     1151
## theta_Intercept     9.81      2.00     6.50    14.31 1.00      858     1276
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>No we might get a sense of what this posterior means by plotting nuts per second as a function of <code>age</code> in our version of Figure 16.5.</p>
<div class="sourceCode" id="cb2122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2122-1"><a href="generalized-linear-madness.html#cb2122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b16<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-2"><a href="generalized-linear-madness.html#cb2122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-3"><a href="generalized-linear-madness.html#cb2122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-4"><a href="generalized-linear-madness.html#cb2122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, b_phi_Intercept, b_k_Intercept, b_theta_Intercept),</span>
<span id="cb2122-5"><a href="generalized-linear-madness.html#cb2122-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="fl">1e2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-6"><a href="generalized-linear-madness.html#cb2122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns =</span> b_phi_Intercept <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>b_k_Intercept <span class="sc">*</span> age))<span class="sc">^</span>b_theta_Intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb2122-7"><a href="generalized-linear-madness.html#cb2122-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2122-8"><a href="generalized-linear-madness.html#cb2122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2122-9"><a href="generalized-linear-madness.html#cb2122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> ns, <span class="at">group =</span> iter),</span>
<span id="cb2122-10"><a href="generalized-linear-madness.html#cb2122-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2122-11"><a href="generalized-linear-madness.html#cb2122-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> d,</span>
<span id="cb2122-12"><a href="generalized-linear-madness.html#cb2122-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age_s, <span class="at">y =</span> n <span class="sc">/</span> seconds, <span class="at">size =</span> seconds),</span>
<span id="cb2122-13"><a href="generalized-linear-madness.html#cb2122-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb2122-14"><a href="generalized-linear-madness.html#cb2122-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">100</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb2122-15"><a href="generalized-linear-madness.html#cb2122-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> at, <span class="at">labels =</span> <span class="fu">round</span>(at <span class="sc">*</span> <span class="fu">max</span>(d<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb2122-16"><a href="generalized-linear-madness.html#cb2122-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Posterior predictive distribution for the</span><span class="sc">\n</span><span class="st">nut opening model&quot;</span>,</span>
<span id="cb2122-17"><a href="generalized-linear-madness.html#cb2122-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;nuts per second&quot;</span>) <span class="sc">+</span></span>
<span id="cb2122-18"><a href="generalized-linear-madness.html#cb2122-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2122-19"><a href="generalized-linear-madness.html#cb2122-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">25</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-31-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Looks like things flatten out around <code>age == 16</code>. Yet since the data drop off at that <code>age</code>, we probably shouldn’t get overconfident.</p>
</div>
</div>
<div id="population-dynamics" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Population dynamics</h2>
<p>Load the <code>Lynx_Hare</code> population dynamics data <span class="citation">(<a href="references.html#ref-hewittTheConservation1921" role="doc-biblioref">Hewitt, 1921</a>)</span>.</p>
<div class="sourceCode" id="cb2123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2123-1"><a href="generalized-linear-madness.html#cb2123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Lynx_Hare, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb2123-2"><a href="generalized-linear-madness.html#cb2123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2123-3"><a href="generalized-linear-madness.html#cb2123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(Lynx_Hare)</span></code></pre></div>
<pre><code>## Rows: 21
## Columns: 3
## $ Year &lt;int&gt; 1900, 1901, 1902, 1903, 1904, 1905, 1906, 1907, 1908, 1909, 1910, 1911, 1912, 1913, 1914, 1915,…
## $ Lynx &lt;dbl&gt; 4.0, 6.1, 9.8, 35.2, 59.4, 41.7, 19.0, 13.0, 8.3, 9.1, 7.4, 8.0, 12.3, 19.5, 45.7, 51.1, 29.7, …
## $ Hare &lt;dbl&gt; 30.0, 47.2, 70.2, 77.4, 36.3, 20.6, 18.1, 21.4, 22.0, 25.4, 27.1, 40.3, 57.0, 76.6, 52.3, 19.5,…</code></pre>
<p>As McElreath indicated in his endnote #238 (p. 570), this example is based on Stan case study by the great <a href="https://bob-carpenter.github.io/">Bob Carpenter</a>, <a href="https://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html"><em>Predator-prey population dynamics: The Lotka-Volterra model in Stan</em></a>. You might bookmark that link. It’ll come up later in this section.</p>
<p>Figure 6.6 will give us a sense of how the lynx and hare populations ebbed and flowed.</p>
<div class="sourceCode" id="cb2125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2125-1"><a href="generalized-linear-madness.html#cb2125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for annotation</span></span>
<span id="cb2125-2"><a href="generalized-linear-madness.html#cb2125-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb2125-3"><a href="generalized-linear-madness.html#cb2125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">name  =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb2125-4"><a href="generalized-linear-madness.html#cb2125-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Lepus&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb2125-5"><a href="generalized-linear-madness.html#cb2125-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year  =</span> <span class="fu">c</span>(<span class="fl">1913.5</span>, <span class="fl">1915.5</span>),</span>
<span id="cb2125-6"><a href="generalized-linear-madness.html#cb2125-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">78</span>, <span class="dv">52</span>))</span>
<span id="cb2125-7"><a href="generalized-linear-madness.html#cb2125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2125-8"><a href="generalized-linear-madness.html#cb2125-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2125-9"><a href="generalized-linear-madness.html#cb2125-9" aria-hidden="true" tabindex="-1"></a>Lynx_Hare <span class="sc">%&gt;%</span> </span>
<span id="cb2125-10"><a href="generalized-linear-madness.html#cb2125-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year) <span class="sc">%&gt;%</span> </span>
<span id="cb2125-11"><a href="generalized-linear-madness.html#cb2125-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2125-12"><a href="generalized-linear-madness.html#cb2125-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2125-13"><a href="generalized-linear-madness.html#cb2125-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb2125-14"><a href="generalized-linear-madness.html#cb2125-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> name),</span>
<span id="cb2125-15"><a href="generalized-linear-madness.html#cb2125-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2125-16"><a href="generalized-linear-madness.html#cb2125-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> name),</span>
<span id="cb2125-17"><a href="generalized-linear-madness.html#cb2125-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2125-18"><a href="generalized-linear-madness.html#cb2125-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb2125-19"><a href="generalized-linear-madness.html#cb2125-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">color =</span> name),</span>
<span id="cb2125-20"><a href="generalized-linear-madness.html#cb2125-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2125-21"><a href="generalized-linear-madness.html#cb2125-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2125-22"><a href="generalized-linear-madness.html#cb2125-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2125-23"><a href="generalized-linear-madness.html#cb2125-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">20</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb2125-24"><a href="generalized-linear-madness.html#cb2125-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-33-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Note, however, that these are numbers of pelts, not of actual animals. This will become important when we start modeling.</p>
<p>A typical way to model evenly-spaced time series data like this would be with an autoregressive model with the basic structure</p>
<p><span class="math display">\[\operatorname{E}(y_t) = \alpha + \beta_1 y_{t-1},\]</span></p>
<p>where <span class="math inline">\(t\)</span> indexes time and <span class="math inline">\(t - 1\)</span> is the time point immediately before <span class="math inline">\(t\)</span>. Models following this form are called first-order autoregressive models, AR(1), meaning that the current time point is only influenced by the previous time point, but none of the earlier ones. You can build on this format by adding other predictors. A natural way would be to use a predictor from <span class="math inline">\(t - 1\)</span> to predict <span class="math inline">\(y_t\)</span>, following the form</p>
<p><span class="math display">\[\operatorname{E}(y_t) = \alpha + \beta_1 y_{t-1} + \beta_2 x_{t-1}.\]</span></p>
<p>But that’s still a first-order model. A second-order model, AR(2), would include a term for <span class="math inline">\(y_{t - 2}\)</span>, such as</p>
<p><span class="math display">\[\operatorname{E}(y_t) = \alpha + \beta_1 y_{t-1} + \beta_2 x_{t-1} + \beta_3 y_{t-2}.\]</span></p>
<p>McElreath isn’t a huge fan of these models, particularly from the scientific modeling perspective he developed in this chapter. But <strong>brms</strong> can fit them and we’ll practice a little in a bonus section, later on. In the mean time, we’ll follow along and learn about <strong>ordinary differential equations</strong> (ODEs).</p>
<div id="the-scientific-model.-2" class="section level3" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> The scientific model.</h3>
<p>We’ll start off simple and focus first on hares. If we let <span class="math inline">\(H_t\)</span> be the number of hares at time <span class="math inline">\(t\)</span>, we can express the <strong>rate of change</strong> in the hare population as</p>
<p><span class="math display">\[\frac{\mathrm{d} H}{\mathrm{d} t} = H_t \times (\text{birth rate}) - H_t \times (\text{death rate}).\]</span></p>
<p>If we presume both birth rates and death rates (<em>mortality</em> rates) are constants, we might denote them <span class="math inline">\(b_H\)</span> and <span class="math inline">\(m_H\)</span>, respectively, and re-express the formula as</p>
<p><span class="math display">\[\frac{\mathrm{d} H}{\mathrm{d} t} = H_t b_H - H_t m_H = H_t (b_H - m_H).\]</span></p>
<p>Building, if we let <span class="math inline">\(L_t\)</span> stand for the number of lynx present at time <span class="math inline">\(t\)</span>, we can allow the mortality rate depend on that variable with the expanded formula</p>
<p><span class="math display">\[\frac{\mathrm{d} H}{\mathrm{d} t} = H_t (b_H - L_t m_H).\]</span></p>
<p>We can expand this even further to model how the number of hares at a given time influence the birth rate for lynx (<span class="math inline">\(b_L\)</span>) to help us model the rate of change in the lynx population as</p>
<p><span class="math display">\[\frac{\mathrm{d} L}{\mathrm{d} t} = L_t (H_t b_L - m_L),\]</span></p>
<p>where the lynx mortality rate (<span class="math inline">\(m_l\)</span>) is now constant. This is called the <strong>Lotka-Volterra model</strong> <span class="citation">(<a href="references.html#ref-lotkaPrinciplesOfPhysicalBiology1925" role="doc-biblioref">Lotka, 1925</a>; <a href="references.html#ref-volterraFluctuationsAbundanceSpecies1926" role="doc-biblioref">Volterra, 1926</a>)</span>. You may have noticed how the above equations shifted our focus from what were were originally interested in, <span class="math inline">\(\operatorname{E}(H_t)\)</span>, to a rate of change, <span class="math inline">\(\mathrm{d} H / \mathrm{d} t\)</span>. Happily, our equation for <span class="math inline">\(\mathrm{d} H / \mathrm{d} t\)</span>, “tells us how to update <span class="math inline">\(H\)</span> after each tiny unit of passing time <span class="math inline">\(\mathrm d t\)</span>” (p. 544). You update by</p>
<p><span class="math display">\[H_{t +\mathrm d t} = H_t + \mathrm d t \frac{\mathrm d H}{\mathrm d t} = H_t + \mathrm d t H_t (b_H - L_t m_H).\]</span>
Here we’ll use a custom function called <code>sim_lynx_hare()</code> to simulate how this can work. Our version of the function is very similar to the one McElreath displayed in his <strong>R</strong> code 16.14, but we changed it so it returns a tibble which includes a time index, <code>t</code>.</p>
<div class="sourceCode" id="cb2126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2126-1"><a href="generalized-linear-madness.html#cb2126-1" aria-hidden="true" tabindex="-1"></a>sim_lynx_hare <span class="ot">&lt;-</span> <span class="cf">function</span>(n_steps, init, theta, <span class="at">dt =</span> <span class="fl">0.002</span>) { </span>
<span id="cb2126-2"><a href="generalized-linear-madness.html#cb2126-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2126-3"><a href="generalized-linear-madness.html#cb2126-3" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb2126-4"><a href="generalized-linear-madness.html#cb2126-4" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb2126-5"><a href="generalized-linear-madness.html#cb2126-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2126-6"><a href="generalized-linear-madness.html#cb2126-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set initial values</span></span>
<span id="cb2126-7"><a href="generalized-linear-madness.html#cb2126-7" aria-hidden="true" tabindex="-1"></a>  L[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">1</span>]</span>
<span id="cb2126-8"><a href="generalized-linear-madness.html#cb2126-8" aria-hidden="true" tabindex="-1"></a>  H[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">2</span>]</span>
<span id="cb2126-9"><a href="generalized-linear-madness.html#cb2126-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2126-10"><a href="generalized-linear-madness.html#cb2126-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_steps) {</span>
<span id="cb2126-11"><a href="generalized-linear-madness.html#cb2126-11" aria-hidden="true" tabindex="-1"></a>    H[i] <span class="ot">&lt;-</span> H[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> dt <span class="sc">*</span> H[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (theta[<span class="dv">1</span>] <span class="sc">-</span> theta[<span class="dv">2</span>] <span class="sc">*</span> L[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb2126-12"><a href="generalized-linear-madness.html#cb2126-12" aria-hidden="true" tabindex="-1"></a>    L[i] <span class="ot">&lt;-</span> L[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> dt <span class="sc">*</span> L[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (theta[<span class="dv">3</span>] <span class="sc">*</span> H[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> theta[<span class="dv">4</span>])</span>
<span id="cb2126-13"><a href="generalized-linear-madness.html#cb2126-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2126-14"><a href="generalized-linear-madness.html#cb2126-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2126-15"><a href="generalized-linear-madness.html#cb2126-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return a tibble</span></span>
<span id="cb2126-16"><a href="generalized-linear-madness.html#cb2126-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n_steps,</span>
<span id="cb2126-17"><a href="generalized-linear-madness.html#cb2126-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">H =</span> H,</span>
<span id="cb2126-18"><a href="generalized-linear-madness.html#cb2126-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">L =</span> L)</span>
<span id="cb2126-19"><a href="generalized-linear-madness.html#cb2126-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2126-20"><a href="generalized-linear-madness.html#cb2126-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we simulate.</p>
<div class="sourceCode" id="cb2127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2127-1"><a href="generalized-linear-madness.html#cb2127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the four theta values</span></span>
<span id="cb2127-2"><a href="generalized-linear-madness.html#cb2127-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.05</span>, <span class="fl">0.025</span>, <span class="fl">0.5</span>)</span>
<span id="cb2127-3"><a href="generalized-linear-madness.html#cb2127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2127-4"><a href="generalized-linear-madness.html#cb2127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb2127-5"><a href="generalized-linear-madness.html#cb2127-5" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">sim_lynx_hare</span>(<span class="at">n_steps =</span> <span class="fl">1e4</span>, </span>
<span id="cb2127-6"><a href="generalized-linear-madness.html#cb2127-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">init =</span> <span class="fu">c</span>(<span class="fu">filter</span>(Lynx_Hare, Year <span class="sc">==</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;Lynx&quot;</span>), </span>
<span id="cb2127-7"><a href="generalized-linear-madness.html#cb2127-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">filter</span>(Lynx_Hare, Year <span class="sc">==</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="st">&quot;Hare&quot;</span>)), </span>
<span id="cb2127-8"><a href="generalized-linear-madness.html#cb2127-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">theta =</span> theta)</span>
<span id="cb2127-9"><a href="generalized-linear-madness.html#cb2127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2127-10"><a href="generalized-linear-madness.html#cb2127-10" aria-hidden="true" tabindex="-1"></a><span class="co"># what did we do?</span></span>
<span id="cb2127-11"><a href="generalized-linear-madness.html#cb2127-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(z)</span></code></pre></div>
<pre><code>## Rows: 10,000
## Columns: 3
## $ t &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,…
## $ H &lt;dbl&gt; 30.00000, 30.01800, 30.03600, 30.05401, 30.07203, 30.09005, 30.10807, 30.12610, 30.14413, 30.16217…
## $ L &lt;dbl&gt; 4.000000, 4.002000, 4.004005, 4.006014, 4.008028, 4.010046, 4.012069, 4.014097, 4.016129, 4.018166…</code></pre>
<p>Each row is a stand-in index for time. Here we’ll explicitly add a <code>time</code> column and them plot the results in our version of Figure 16.7.</p>
<div class="sourceCode" id="cb2129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2129-1"><a href="generalized-linear-madness.html#cb2129-1" aria-hidden="true" tabindex="-1"></a>z <span class="sc">%&gt;%</span> </span>
<span id="cb2129-2"><a href="generalized-linear-madness.html#cb2129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>t) <span class="sc">%&gt;%</span> </span>
<span id="cb2129-3"><a href="generalized-linear-madness.html#cb2129-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2129-4"><a href="generalized-linear-madness.html#cb2129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb2129-5"><a href="generalized-linear-madness.html#cb2129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2129-6"><a href="generalized-linear-madness.html#cb2129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2129-7"><a href="generalized-linear-madness.html#cb2129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(time<span class="sc">~</span>(<span class="fu">italic</span>(t))), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2129-8"><a href="generalized-linear-madness.html#cb2129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;number (thousands)&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb2129-9"><a href="generalized-linear-madness.html#cb2129-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-36-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>“This model produces cycles, similar to what we see in the data. The model behaves this way, because lynx eat hares. Once the hares are eaten, the lynx begin to die off. Then the cycle repeats (p. 545).”</p>
</div>
<div id="the-statistical-model.-2" class="section level3" number="16.4.2">
<h3><span class="header-section-number">16.4.2</span> The statistical model.</h3>
<p>If we continue to let <span class="math inline">\(H_t\)</span> and <span class="math inline">\(L_t\)</span> be the number of hares and lynx at time <span class="math inline">\(t\)</span>, we might also want to rehearse the distinction between those numbers and our observations by letting <span class="math inline">\(h_t\)</span> and <span class="math inline">\(l_t\)</span> stand for the observed numbers of hares and lynx. These observed numbers, recall, are from counts of pelts. We want a statistical model that can connect <span class="math inline">\(h_t\)</span> to <span class="math inline">\(H_t\)</span> and connect <span class="math inline">\(l_t\)</span> to <span class="math inline">\(L_t\)</span>. Part of that model would include the probability a hare was trapped on a given year, <span class="math inline">\(p_h\)</span>, and a similar probability for a lynx getting trapped, <span class="math inline">\(p_l\)</span>. To make things worse, further imagine the number of pelts for each, in a given year, was rounded to the nearest <span class="math inline">\(100\)</span> and divided by <span class="math inline">\(1{,}000\)</span>. Those are our values.</p>
<p>We practice simulating all this in Figure 16.8. Here we propose a population of <span class="math inline">\(H_t = 10^4\)</span> hares and an average trapping rate of about <span class="math inline">\(10\%\)</span>, as expressed by <span class="math inline">\(p_t \sim \operatorname{Beta}(2, 18)\)</span>. As described above, we then divide the number of observed pelts by <span class="math inline">\(1{,}000\)</span> and round the results, yielding <span class="math inline">\(h_t\)</span>.</p>
<div class="sourceCode" id="cb2130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2130-1"><a href="generalized-linear-madness.html#cb2130-1" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb2130-2"><a href="generalized-linear-madness.html#cb2130-2" aria-hidden="true" tabindex="-1"></a>Ht <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb2130-3"><a href="generalized-linear-madness.html#cb2130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2130-4"><a href="generalized-linear-madness.html#cb2130-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2130-5"><a href="generalized-linear-madness.html#cb2130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2130-6"><a href="generalized-linear-madness.html#cb2130-6" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb2130-7"><a href="generalized-linear-madness.html#cb2130-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">pt =</span> <span class="fu">rbeta</span>(n, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2130-8"><a href="generalized-linear-madness.html#cb2130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> Ht, <span class="at">prob =</span> pt)) <span class="sc">%&gt;%</span> </span>
<span id="cb2130-9"><a href="generalized-linear-madness.html#cb2130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht =</span> <span class="fu">round</span>(ht <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2130-10"><a href="generalized-linear-madness.html#cb2130-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2130-11"><a href="generalized-linear-madness.html#cb2130-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2130-12"><a href="generalized-linear-madness.html#cb2130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ht)) <span class="sc">+</span></span>
<span id="cb2130-13"><a href="generalized-linear-madness.html#cb2130-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">binwidth =</span> <span class="fl">0.1</span>,</span>
<span id="cb2130-14"><a href="generalized-linear-madness.html#cb2130-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="sc">+</span></span>
<span id="cb2130-15"><a href="generalized-linear-madness.html#cb2130-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2130-16"><a href="generalized-linear-madness.html#cb2130-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(thousand<span class="sc">~</span>of<span class="sc">~</span>pelts<span class="sc">~</span>(<span class="fu">italic</span>(h[t]))))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-37-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>On page 546, McElreath encouraged us to try the simulation with different values of <span class="math inline">\(H_t\)</span> and <span class="math inline">\(p_t\)</span>. Here we’ll do so with a <span class="math inline">\(3 \times 3\)</span> grid of <span class="math inline">\(H_t = \{5{,}000, 10{,}000, 15{,}000\}\)</span> and <span class="math inline">\(p_t \sim \{ \operatorname{Beta}(2, 18), \operatorname{Beta}(10, 10), \operatorname{Beta}(18, 2) \}\)</span>.</p>
<div class="sourceCode" id="cb2131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2131-1"><a href="generalized-linear-madness.html#cb2131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2131-2"><a href="generalized-linear-madness.html#cb2131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2131-3"><a href="generalized-linear-madness.html#cb2131-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the 3 X 3 grid</span></span>
<span id="cb2131-4"><a href="generalized-linear-madness.html#cb2131-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">shape1 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">18</span>),</span>
<span id="cb2131-5"><a href="generalized-linear-madness.html#cb2131-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">shape2 =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">10</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-6"><a href="generalized-linear-madness.html#cb2131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(shape1, shape2),</span>
<span id="cb2131-7"><a href="generalized-linear-madness.html#cb2131-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Ht =</span> <span class="fu">c</span>(<span class="fl">5e3</span>, <span class="fl">1e4</span>, <span class="fl">15e3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-8"><a href="generalized-linear-madness.html#cb2131-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate</span></span>
<span id="cb2131-9"><a href="generalized-linear-madness.html#cb2131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(shape1, shape2, <span class="sc">~</span><span class="fu">rbeta</span>(n, <span class="at">shape1 =</span> .x, <span class="at">shape2 =</span> .y))) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-10"><a href="generalized-linear-madness.html#cb2131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(Ht, pt, <span class="sc">~</span><span class="fu">rbinom</span>(n, <span class="at">size =</span> .x, <span class="at">prob =</span> .y))) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-11"><a href="generalized-linear-madness.html#cb2131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(pt, ht)) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-12"><a href="generalized-linear-madness.html#cb2131-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb2131-13"><a href="generalized-linear-madness.html#cb2131-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht    =</span> <span class="fu">round</span>(ht <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb2131-14"><a href="generalized-linear-madness.html#cb2131-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta  =</span> <span class="fu">str_c</span>(<span class="st">&quot;italic(p[t])%~%&#39;Beta &#39;(&quot;</span>, shape1, <span class="st">&quot;, &quot;</span>, shape2, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb2131-15"><a href="generalized-linear-madness.html#cb2131-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Htlab =</span> <span class="fu">str_c</span>(<span class="st">&quot;italic(H[t])==&quot;</span>, Ht)) <span class="sc">%&gt;%</span></span>
<span id="cb2131-16"><a href="generalized-linear-madness.html#cb2131-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beta  =</span> <span class="fu">factor</span>(beta,</span>
<span id="cb2131-17"><a href="generalized-linear-madness.html#cb2131-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;italic(p[t])%~%&#39;Beta &#39;(2, 18)&quot;</span>, <span class="st">&quot;italic(p[t])%~%&#39;Beta &#39;(10, 10)&quot;</span>, <span class="st">&quot;italic(p[t])%~%&#39;Beta &#39;(18, 2)&quot;</span>)),</span>
<span id="cb2131-18"><a href="generalized-linear-madness.html#cb2131-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Htlab =</span> <span class="fu">factor</span>(Htlab,</span>
<span id="cb2131-19"><a href="generalized-linear-madness.html#cb2131-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;italic(H[t])==15000&quot;</span>, <span class="st">&quot;italic(H[t])==10000&quot;</span>, <span class="st">&quot;italic(H[t])==5000&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-20"><a href="generalized-linear-madness.html#cb2131-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2131-21"><a href="generalized-linear-madness.html#cb2131-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2131-22"><a href="generalized-linear-madness.html#cb2131-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ht)) <span class="sc">+</span></span>
<span id="cb2131-23"><a href="generalized-linear-madness.html#cb2131-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> beta <span class="sc">==</span> <span class="st">&quot;italic(p[t])%~%&#39;Beta &#39;(2, 18)&quot;</span> <span class="sc">&amp;</span> Htlab <span class="sc">==</span> <span class="st">&quot;italic(H[t])==10000&quot;</span>),</span>
<span id="cb2131-24"><a href="generalized-linear-madness.html#cb2131-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">binwidth =</span> <span class="fl">0.25</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb2131-25"><a href="generalized-linear-madness.html#cb2131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> Ht <span class="sc">/</span> <span class="dv">1000</span>), </span>
<span id="cb2131-26"><a href="generalized-linear-madness.html#cb2131-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2131-27"><a href="generalized-linear-madness.html#cb2131-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> .<span class="dv">67</span>, <span class="at">end =</span> <span class="dv">0</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2131-28"><a href="generalized-linear-madness.html#cb2131-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2131-29"><a href="generalized-linear-madness.html#cb2131-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(thousand<span class="sc">~</span>of<span class="sc">~</span>pelts<span class="sc">~</span>(<span class="fu">italic</span>(h[t])))) <span class="sc">+</span></span>
<span id="cb2131-30"><a href="generalized-linear-madness.html#cb2131-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Htlab <span class="sc">~</span> beta, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The vertical dashed lines mark off the maximum values in each panel. The histogram in black is of the simulation parameters based on our version of Figure 16.8, above.</p>
<p>McElreath’s proposed model is</p>
<p><span class="math display">\[\begin{align*}
h_t &amp; \sim \operatorname{Log-Normal} \big (\log(p_H H_t), \sigma_H \big) \\
l_t &amp; \sim \operatorname{Log-Normal} \big (\log(p_L L_t), \sigma_L \big) \\
H_1 &amp; \sim \operatorname{Log-Normal}(\log 10, 1) \\
L_1 &amp; \sim \operatorname{Log-Normal}(\log 10, 1) \\
H_{T &gt;1} &amp; = H_1 + \int_1^T H_t (b_H - m_H L_t) \mathrm{d} t \\
L_{T &gt;1} &amp; = L_1 + \int_1^T L_t (b_L H_T - m_L) \mathrm{d} t \\
\sigma_H &amp; \sim \operatorname{Exponential}(1) \\
\sigma_L &amp; \sim \operatorname{Exponential}(1) \\
p_H &amp; \sim \operatorname{Beta}(\alpha_H, \beta_H) \\
p_L &amp; \sim \operatorname{Beta}(\alpha_L, \beta_L) \\
b_H &amp; \sim \operatorname{Half-Normal}(1, 0.5) \\
b_L &amp; \sim \operatorname{Half-Normal}(0.5, 0.5) \\
m_H &amp; \sim \operatorname{Half-Normal}(0.5, 0.5) \\
m_L &amp; \sim \operatorname{Half-Normal}(1, 0.5).
\end{align*}\]</span></p>
<p>It’s not immediately clear from the text, but if you look closely at the output from <code>cat(Lynx_Hare_model)</code> (see below), you’ll see <span class="math inline">\(\alpha_H = \alpha_L = 40\)</span> and <span class="math inline">\(\beta_H = \beta_L = 200\)</span>. If you’re curious, here’s a plot of what the <span class="math inline">\(\operatorname{Beta}(40, 200)\)</span> prior looks like.</p>
<div class="sourceCode" id="cb2132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2132-1"><a href="generalized-linear-madness.html#cb2132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2132-2"><a href="generalized-linear-madness.html#cb2132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2132-3"><a href="generalized-linear-madness.html#cb2132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="fl">1e6</span>, <span class="at">shape1 =</span> <span class="dv">40</span>, <span class="at">shape2 =</span> <span class="dv">200</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2132-4"><a href="generalized-linear-madness.html#cb2132-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2132-5"><a href="generalized-linear-madness.html#cb2132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb2132-6"><a href="generalized-linear-madness.html#cb2132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">binwidth =</span> <span class="fl">0.005</span>, <span class="at">boundary =</span> <span class="dv">0</span>,</span>
<span id="cb2132-7"><a href="generalized-linear-madness.html#cb2132-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="sc">+</span></span>
<span id="cb2132-8"><a href="generalized-linear-madness.html#cb2132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span>of<span class="sc">~</span><span class="fu">italic</span>(p[H])<span class="sc">~</span>and<span class="sc">~</span><span class="fu">italic</span>(p[L])), </span>
<span id="cb2132-9"><a href="generalized-linear-madness.html#cb2132-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2132-10"><a href="generalized-linear-madness.html#cb2132-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb2132-11"><a href="generalized-linear-madness.html#cb2132-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">&quot;1,000,000 draws from Beta&quot;</span><span class="sc">*</span>(<span class="dv">40</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">200</span>)))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-39-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>The <span class="math inline">\(\operatorname{Beta}(40, 200)\)</span> prior suggests an average trapping rate near 16%.</p>
<p>⚠️ The content to follow is going to diverge from the text, a bit. As you can see from the equation, above, McElreath’s statistical model is a beast. We can fit this model with <strong>brms</strong>, but the workflow is more complicated than usual. To make this material more approachable, I am going to divide the remainder of this section into two subsections. In the first subsection, we’ll fit a simplified version of McElreath’s <code>m16.5</code>, which does not contain the measurement-error portion. In the second subsection, we’ll tack on the measurement-error portion and fit the full model. ⚠️</p>
<div id="the-simple-lotka-volterra-model." class="section level4" number="16.4.2.1">
<h4><span class="header-section-number">16.4.2.1</span> The simple Lotka-Volterra model.</h4>
<p>Before we get into it, I should acknowledge that this <strong>brms</strong> approach to fitting ODE’s is a direct result of the generous contributions from <a href="https://twitter.com/MarkusGesmann">Markus Gesmann</a>. It was one of his older blog posts, <a href="https://magesblog.com/post/2018-01-30-pkpd-reserving-models/"><em>PK/PD reserving models</em></a>, that led me to believe one could fit an ODE model with <strong>brms</strong>. When I reached out to Gesmann on GitHub (see <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/issues/18">Issue #18</a>), he went so far as to write a new blog post on exactly this model: <a href="https://magesblog.com/post/2021-02-08-fitting-multivariate-ode-models-with-brms/"><em>Fitting multivariate ODE models with brms</em></a>. The workflow to follow is something of a blend of the methods in his blog post, McElreath’s model in the text, and the <a href="https://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html">original post</a> by Carpenter that started this all.</p>
<p>As far as the statistical model goes, we might express the revision of McElreath’s model omitting the measurement-error portion as</p>
<p><span class="math display">\[\begin{align*}
h_t &amp; \sim \operatorname{Log-Normal} \big (\log(H_t), \sigma_H \big) \\
l_t &amp; \sim \operatorname{Log-Normal} \big (\log(L_t), \sigma_L \big) \\
H_1 &amp; \sim \operatorname{Log-Normal}(\log 10, 1) \\
L_1 &amp; \sim \operatorname{Log-Normal}(\log 10, 1) \\
H_{T &gt;1} &amp; = H_1 + \int_1^T H_t (b_H - m_H L_t) \mathrm{d} t \\
L_{T &gt;1} &amp; = L_1 + \int_1^T L_t (b_L H_T - m_L) \mathrm{d} t \\
b_H &amp; \sim \operatorname{Half-Normal}(1, 0.5) \\
b_L &amp; \sim \operatorname{Half-Normal}(0.5, 0.5) \\
m_H &amp; \sim \operatorname{Half-Normal}(0.5, 0.5) \\
m_L &amp; \sim \operatorname{Half-Normal}(1, 0.5) \\
\sigma_H &amp; \sim \operatorname{Exponential}(1) \\
\sigma_L &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>With the exception of the priors for the <span class="math inline">\(\sigma\)</span> parameters, this is basically the same model Carpenter fit with his original Stan code. Carpenter expressed his model using a different style of notation, but the parts are all there.</p>
<p>As for our <strong>brms</strong>, the first issue we need to address is that, at the time of this writing, <strong>brms</strong> is only set up to fit a univariate ODE model. As Gesmann pointed out, the way around this is to convert the <code>Lynx_Hare</code> data into the long format where the pelt values from the <code>Lynx</code> and <code>Hare</code> columns are all listed in a <code>pelts</code> columns and the two animal populations are differentiated in a <code>population</code> column. We’ll call this long version of the data <code>Lynx_Hare_long</code>.</p>
<div class="sourceCode" id="cb2133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2133-1"><a href="generalized-linear-madness.html#cb2133-1" aria-hidden="true" tabindex="-1"></a>Lynx_Hare_long <span class="ot">&lt;-</span></span>
<span id="cb2133-2"><a href="generalized-linear-madness.html#cb2133-2" aria-hidden="true" tabindex="-1"></a>  Lynx_Hare <span class="sc">%&gt;%</span> </span>
<span id="cb2133-3"><a href="generalized-linear-madness.html#cb2133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year,</span>
<span id="cb2133-4"><a href="generalized-linear-madness.html#cb2133-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>, </span>
<span id="cb2133-5"><a href="generalized-linear-madness.html#cb2133-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;pelts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2133-6"><a href="generalized-linear-madness.html#cb2133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta =</span> <span class="fu">if_else</span>(population <span class="sc">==</span> <span class="st">&quot;Lynx&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2133-7"><a href="generalized-linear-madness.html#cb2133-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">t     =</span> Year <span class="sc">-</span> <span class="fu">min</span>(Year) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2133-8"><a href="generalized-linear-madness.html#cb2133-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta, Year)</span>
<span id="cb2133-9"><a href="generalized-linear-madness.html#cb2133-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2133-10"><a href="generalized-linear-madness.html#cb2133-10" aria-hidden="true" tabindex="-1"></a><span class="co"># what did we do?</span></span>
<span id="cb2133-11"><a href="generalized-linear-madness.html#cb2133-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Lynx_Hare_long)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##    Year population pelts delta     t
##   &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1900 Hare        30       0     1
## 2  1901 Hare        47.2     0     2
## 3  1902 Hare        70.2     0     3
## 4  1903 Hare        77.4     0     4
## 5  1904 Hare        36.3     0     5
## 6  1905 Hare        20.6     0     6</code></pre>
<p>You’ll note how we converted the information in the <code>population</code> column into a dummy variable, <code>delta</code>, which is coded 0 = hares, 1 = lynxes. It’s that dummy variable that will allow us to adjust our model formula so we express a bivariate model as if it were univariate. You’ll see. Also notice how we added a <code>t</code> index for <em>time</em>. This is because the Stan code to follow will expect us to index time in that way.</p>
<p>The next step is to write a script that will tell <strong>brms</strong> how to tell Stan how to fit a Lotka-Volterra model. In his blog, Gesmann called this <code>LotkaVolterra</code>. Our script to follow is a very minor adjustment of his.</p>
<div class="sourceCode" id="cb2135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2135-1"><a href="generalized-linear-madness.html#cb2135-1" aria-hidden="true" tabindex="-1"></a>LotkaVolterra <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb2135-2"><a href="generalized-linear-madness.html#cb2135-2" aria-hidden="true" tabindex="-1"></a><span class="st">// Sepcify dynamical system (ODEs)</span></span>
<span id="cb2135-3"><a href="generalized-linear-madness.html#cb2135-3" aria-hidden="true" tabindex="-1"></a><span class="st">real[] ode_LV(real t,         // time</span></span>
<span id="cb2135-4"><a href="generalized-linear-madness.html#cb2135-4" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] y,      // the system rate</span></span>
<span id="cb2135-5"><a href="generalized-linear-madness.html#cb2135-5" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] theta,  // the parameters (i.e., the birth and mortality rates)</span></span>
<span id="cb2135-6"><a href="generalized-linear-madness.html#cb2135-6" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] x_r,    // data constant, not used here</span></span>
<span id="cb2135-7"><a href="generalized-linear-madness.html#cb2135-7" aria-hidden="true" tabindex="-1"></a><span class="st">              int [] x_i) {   // data constant, not used here</span></span>
<span id="cb2135-8"><a href="generalized-linear-madness.html#cb2135-8" aria-hidden="true" tabindex="-1"></a><span class="st">  // the outcome</span></span>
<span id="cb2135-9"><a href="generalized-linear-madness.html#cb2135-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real dydt[2];</span></span>
<span id="cb2135-10"><a href="generalized-linear-madness.html#cb2135-10" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb2135-11"><a href="generalized-linear-madness.html#cb2135-11" aria-hidden="true" tabindex="-1"></a><span class="st">  // differential equations</span></span>
<span id="cb2135-12"><a href="generalized-linear-madness.html#cb2135-12" aria-hidden="true" tabindex="-1"></a><span class="st">  dydt[1] = (theta[1] - theta[2] * y[2]) * y[1]; // Hare process</span></span>
<span id="cb2135-13"><a href="generalized-linear-madness.html#cb2135-13" aria-hidden="true" tabindex="-1"></a><span class="st">  dydt[2] = (theta[3] * y[1] - theta[4]) * y[2]; // Lynx process</span></span>
<span id="cb2135-14"><a href="generalized-linear-madness.html#cb2135-14" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb2135-15"><a href="generalized-linear-madness.html#cb2135-15" aria-hidden="true" tabindex="-1"></a><span class="st">  return dydt;  // return a 2-element array</span></span>
<span id="cb2135-16"><a href="generalized-linear-madness.html#cb2135-16" aria-hidden="true" tabindex="-1"></a><span class="st">              }</span></span>
<span id="cb2135-17"><a href="generalized-linear-madness.html#cb2135-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2135-18"><a href="generalized-linear-madness.html#cb2135-18" aria-hidden="true" tabindex="-1"></a><span class="st">// Integrate ODEs and prepare output</span></span>
<span id="cb2135-19"><a href="generalized-linear-madness.html#cb2135-19" aria-hidden="true" tabindex="-1"></a><span class="st">real LV(real t, real Hare0, real Lynx0, </span></span>
<span id="cb2135-20"><a href="generalized-linear-madness.html#cb2135-20" aria-hidden="true" tabindex="-1"></a><span class="st">        real brHare, real mrHare, </span></span>
<span id="cb2135-21"><a href="generalized-linear-madness.html#cb2135-21" aria-hidden="true" tabindex="-1"></a><span class="st">        real brLynx, real mrLynx,</span></span>
<span id="cb2135-22"><a href="generalized-linear-madness.html#cb2135-22" aria-hidden="true" tabindex="-1"></a><span class="st">        real delta) {</span></span>
<span id="cb2135-23"><a href="generalized-linear-madness.html#cb2135-23" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb2135-24"><a href="generalized-linear-madness.html#cb2135-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real y0[2];     // Initial values</span></span>
<span id="cb2135-25"><a href="generalized-linear-madness.html#cb2135-25" aria-hidden="true" tabindex="-1"></a><span class="st">  real theta[4];  // Parameters</span></span>
<span id="cb2135-26"><a href="generalized-linear-madness.html#cb2135-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real y[1, 2];   // ODE solution</span></span>
<span id="cb2135-27"><a href="generalized-linear-madness.html#cb2135-27" aria-hidden="true" tabindex="-1"></a><span class="st">  // Set initial values</span></span>
<span id="cb2135-28"><a href="generalized-linear-madness.html#cb2135-28" aria-hidden="true" tabindex="-1"></a><span class="st">  y0[1] = Hare0; </span></span>
<span id="cb2135-29"><a href="generalized-linear-madness.html#cb2135-29" aria-hidden="true" tabindex="-1"></a><span class="st">  y0[2] = Lynx0;</span></span>
<span id="cb2135-30"><a href="generalized-linear-madness.html#cb2135-30" aria-hidden="true" tabindex="-1"></a><span class="st">  // Set parameters</span></span>
<span id="cb2135-31"><a href="generalized-linear-madness.html#cb2135-31" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[1] = brHare; </span></span>
<span id="cb2135-32"><a href="generalized-linear-madness.html#cb2135-32" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[2] = mrHare;</span></span>
<span id="cb2135-33"><a href="generalized-linear-madness.html#cb2135-33" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[3] = brLynx; </span></span>
<span id="cb2135-34"><a href="generalized-linear-madness.html#cb2135-34" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[4] = mrLynx;</span></span>
<span id="cb2135-35"><a href="generalized-linear-madness.html#cb2135-35" aria-hidden="true" tabindex="-1"></a><span class="st">  // Solve ODEs</span></span>
<span id="cb2135-36"><a href="generalized-linear-madness.html#cb2135-36" aria-hidden="true" tabindex="-1"></a><span class="st">  y = integrate_ode_rk45(ode_LV, </span></span>
<span id="cb2135-37"><a href="generalized-linear-madness.html#cb2135-37" aria-hidden="true" tabindex="-1"></a><span class="st">                         y0, 0, rep_array(t, 1), theta,</span></span>
<span id="cb2135-38"><a href="generalized-linear-madness.html#cb2135-38" aria-hidden="true" tabindex="-1"></a><span class="st">                         rep_array(0.0, 0), rep_array(1, 1),</span></span>
<span id="cb2135-39"><a href="generalized-linear-madness.html#cb2135-39" aria-hidden="true" tabindex="-1"></a><span class="st">                         0.001, 0.001, 100); // tolerances, steps</span></span>
<span id="cb2135-40"><a href="generalized-linear-madness.html#cb2135-40" aria-hidden="true" tabindex="-1"></a><span class="st">                         </span></span>
<span id="cb2135-41"><a href="generalized-linear-madness.html#cb2135-41" aria-hidden="true" tabindex="-1"></a><span class="st">  // Return relevant population values based on our dummy-variable coding method</span></span>
<span id="cb2135-42"><a href="generalized-linear-madness.html#cb2135-42" aria-hidden="true" tabindex="-1"></a><span class="st">  return (y[1, 1] * (1 - delta) + </span></span>
<span id="cb2135-43"><a href="generalized-linear-madness.html#cb2135-43" aria-hidden="true" tabindex="-1"></a><span class="st">          y[1, 2] * delta);</span></span>
<span id="cb2135-44"><a href="generalized-linear-madness.html#cb2135-44" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2135-45"><a href="generalized-linear-madness.html#cb2135-45" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<p>If you study this, you’ll see echos of Carpenter’s <a href="https://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html#coding-the-model-stan-program">original Stan code</a> and connections to McElreath’s Stan code (execute <code>cat(Lynx_Hare_model)</code> from his <strong>R</strong> code 16.17 block), too. But take special notice of the last two lines, above. Those lines use the <code>delta</code> dummy to differentiate the model results for the hare and lynx populations, respectively.</p>
<p>Next we define our <code>formula</code> input. To keep from overwhelming the <code>brm()</code> code, we’ll save it, here, as an independent object called <code>lv_formula</code>.</p>
<div class="sourceCode" id="cb2136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2136-1"><a href="generalized-linear-madness.html#cb2136-1" aria-hidden="true" tabindex="-1"></a>lv_formula <span class="ot">&lt;-</span> </span>
<span id="cb2136-2"><a href="generalized-linear-madness.html#cb2136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pelts <span class="sc">~</span> <span class="fu">log</span>(eta),</span>
<span id="cb2136-3"><a href="generalized-linear-madness.html#cb2136-3" aria-hidden="true" tabindex="-1"></a>     <span class="co"># use our LV() function from above</span></span>
<span id="cb2136-4"><a href="generalized-linear-madness.html#cb2136-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(eta <span class="sc">~</span> <span class="fu">LV</span>(t, H1, L1, bh, mh, bl, ml, delta)),</span>
<span id="cb2136-5"><a href="generalized-linear-madness.html#cb2136-5" aria-hidden="true" tabindex="-1"></a>     <span class="co"># initial population state</span></span>
<span id="cb2136-6"><a href="generalized-linear-madness.html#cb2136-6" aria-hidden="true" tabindex="-1"></a>     H1 <span class="sc">~</span> <span class="dv">1</span>, L1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2136-7"><a href="generalized-linear-madness.html#cb2136-7" aria-hidden="true" tabindex="-1"></a>     <span class="co"># hare parameters</span></span>
<span id="cb2136-8"><a href="generalized-linear-madness.html#cb2136-8" aria-hidden="true" tabindex="-1"></a>     bh <span class="sc">~</span> <span class="dv">1</span>, mh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2136-9"><a href="generalized-linear-madness.html#cb2136-9" aria-hidden="true" tabindex="-1"></a>     <span class="co"># lynx parameters</span></span>
<span id="cb2136-10"><a href="generalized-linear-madness.html#cb2136-10" aria-hidden="true" tabindex="-1"></a>     bl <span class="sc">~</span> <span class="dv">1</span>, ml <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2136-11"><a href="generalized-linear-madness.html#cb2136-11" aria-hidden="true" tabindex="-1"></a>     <span class="co"># population-based measurement errors</span></span>
<span id="cb2136-12"><a href="generalized-linear-madness.html#cb2136-12" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb2136-13"><a href="generalized-linear-madness.html#cb2136-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb2136-14"><a href="generalized-linear-madness.html#cb2136-14" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Note our use of the <code>LV()</code> function in the <code>nlf()</code> line. That’s a function defined in the <code>LotkaVolterra</code> script, above, which will allow us to connect the variables and parameters in our <code>formula</code> code to the underlying statistical model. Next we define our priors and save them as an independent object called <code>lv_priors</code>.</p>
<div class="sourceCode" id="cb2137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2137-1"><a href="generalized-linear-madness.html#cb2137-1" aria-hidden="true" tabindex="-1"></a>lv_priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2137-2"><a href="generalized-linear-madness.html#cb2137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> H1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-3"><a href="generalized-linear-madness.html#cb2137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> L1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-4"><a href="generalized-linear-madness.html#cb2137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> bh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-5"><a href="generalized-linear-madness.html#cb2137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> bl, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-6"><a href="generalized-linear-madness.html#cb2137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> mh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-7"><a href="generalized-linear-madness.html#cb2137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> ml, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2137-8"><a href="generalized-linear-madness.html#cb2137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">dpar =</span> sigma, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb2137-9"><a href="generalized-linear-madness.html#cb2137-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now whether you can fit this model in <strong>brms</strong> may depend on which version you’re using. For details, see the endnote<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. In short, just update to the <a href="https://CRAN.R-project.org/package=brms">current version</a>. Within our <code>brm()</code> code, notice our <code>stanvars</code> settings. Also, I find these models benefit from setting <code>inits = 0</code>. Happily, this model fit in just about four minutes on my 2019 MacBook Pro.</p>
<div class="sourceCode" id="cb2138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2138-1"><a href="generalized-linear-madness.html#cb2138-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.5</span>a <span class="ot">&lt;-</span> </span>
<span id="cb2138-2"><a href="generalized-linear-madness.html#cb2138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare_long, </span>
<span id="cb2138-3"><a href="generalized-linear-madness.html#cb2138-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">brmsfamily</span>(<span class="st">&quot;lognormal&quot;</span>, <span class="at">link_sigma =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb2138-4"><a href="generalized-linear-madness.html#cb2138-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> lv_formula, </span>
<span id="cb2138-5"><a href="generalized-linear-madness.html#cb2138-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> lv_priors, </span>
<span id="cb2138-6"><a href="generalized-linear-madness.html#cb2138-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2138-7"><a href="generalized-linear-madness.html#cb2138-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">inits =</span> <span class="dv">0</span>,</span>
<span id="cb2138-8"><a href="generalized-linear-madness.html#cb2138-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> LotkaVolterra, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>),</span>
<span id="cb2138-9"><a href="generalized-linear-madness.html#cb2138-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.05a&quot;</span>)</span></code></pre></div>
<p>On page 548, McElreath recommend we check the chains. Here we’ll pretty them up with help from <strong>bayesplot</strong>.</p>
<div class="sourceCode" id="cb2139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2139-1"><a href="generalized-linear-madness.html#cb2139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb2139-2"><a href="generalized-linear-madness.html#cb2139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2139-3"><a href="generalized-linear-madness.html#cb2139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(<span class="st">&quot;gray&quot;</span>)</span>
<span id="cb2139-4"><a href="generalized-linear-madness.html#cb2139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2139-5"><a href="generalized-linear-madness.html#cb2139-5" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;italic(H)[1]&quot;</span>, <span class="st">&quot;italic(L)[1]&quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;italic(&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;b[H]&quot;</span>, <span class="st">&quot;m[H]&quot;</span>, <span class="st">&quot;b[L]&quot;</span>, <span class="st">&quot;m[L]&quot;</span>), <span class="st">&quot;)&quot;</span>), </span>
<span id="cb2139-6"><a href="generalized-linear-madness.html#cb2139-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;sigma[italic(H)]&quot;</span>, <span class="st">&quot;sigma[italic(L)]&quot;</span>, <span class="st">&quot;lp__&quot;</span>, <span class="st">&quot;chain&quot;</span>, <span class="st">&quot;iter&quot;</span>)</span>
<span id="cb2139-7"><a href="generalized-linear-madness.html#cb2139-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2139-8"><a href="generalized-linear-madness.html#cb2139-8" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b16<span class="fl">.5</span>a, <span class="at">add_chain =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2139-9"><a href="generalized-linear-madness.html#cb2139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(col_names) <span class="sc">%&gt;%</span> </span>
<span id="cb2139-10"><a href="generalized-linear-madness.html#cb2139-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2139-11"><a href="generalized-linear-madness.html#cb2139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span>iter, <span class="sc">-</span>lp__),</span>
<span id="cb2139-12"><a href="generalized-linear-madness.html#cb2139-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">labeller =</span> label_parsed), </span>
<span id="cb2139-13"><a href="generalized-linear-madness.html#cb2139-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb2139-14"><a href="generalized-linear-madness.html#cb2139-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2139-15"><a href="generalized-linear-madness.html#cb2139-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">&#39;in&#39;</span>),</span>
<span id="cb2139-16"><a href="generalized-linear-madness.html#cb2139-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">97</span>, .<span class="dv">13</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-44-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>They look like a dream. Now inspect the parameter summary.</p>
<div class="sourceCode" id="cb2140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2140-1"><a href="generalized-linear-madness.html#cb2140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.5</span>a)</span></code></pre></div>
<pre><code>##  Family: lognormal 
##   Links: mu = identity; sigma = identity 
## Formula: pelts ~ log(eta) 
##          eta ~ LV(t, H1, L1, bh, mh, bl, ml, delta)
##          H1 ~ 1
##          L1 ~ 1
##          bh ~ 1
##          mh ~ 1
##          bl ~ 1
##          ml ~ 1
##          sigma ~ 0 + population
##    Data: Lynx_Hare_long (Number of observations: 42) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## H1_Intercept            23.52      2.17    19.58    28.03 1.00     2019     2274
## L1_Intercept             6.69      0.70     5.45     8.20 1.00     1826     2445
## bh_Intercept             0.55      0.07     0.43     0.69 1.00     1003     1321
## mh_Intercept             0.03      0.00     0.02     0.04 1.00     1078     1609
## bl_Intercept             0.02      0.00     0.02     0.03 1.00     1087     1498
## ml_Intercept             0.80      0.09     0.63     1.00 1.00     1016     1361
## sigma_populationHare     0.25      0.05     0.18     0.36 1.00     2895     2070
## sigma_populationLynx     0.25      0.05     0.18     0.37 1.00     2540     2384
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As Gesmann <a href="https://magesblog.com/post/2021-02-08-fitting-multivariate-ode-models-with-brms/#plot-posterior-simulations">covered in his blog</a>, we need to use the <code>brms::expose_functions()</code> function to expose Stan functions to <strong>R</strong> before we use some of our favorite post-processing functions.</p>
<div class="sourceCode" id="cb2142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2142-1"><a href="generalized-linear-madness.html#cb2142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(b16<span class="fl">.5</span>a, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Now we’re ready to plot our results like McElreath did in Figure 16.9a. Our first step will be to use <code>predict()</code>.</p>
<div class="sourceCode" id="cb2143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2143-1"><a href="generalized-linear-madness.html#cb2143-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb2143-2"><a href="generalized-linear-madness.html#cb2143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b16<span class="fl">.5</span>a, </span>
<span id="cb2143-3"><a href="generalized-linear-madness.html#cb2143-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> F, </span>
<span id="cb2143-4"><a href="generalized-linear-madness.html#cb2143-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># how many posterior predictive draws would you like?</span></span>
<span id="cb2143-5"><a href="generalized-linear-madness.html#cb2143-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">nsamples =</span> <span class="dv">21</span>)</span>
<span id="cb2143-6"><a href="generalized-linear-madness.html#cb2143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2143-7"><a href="generalized-linear-madness.html#cb2143-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(p)</span></code></pre></div>
<pre><code>##  num [1:21, 1:42] 17.8 67.2 41.8 37.4 24.4 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>We’re ready to plot!</p>
<div class="sourceCode" id="cb2145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2145-1"><a href="generalized-linear-madness.html#cb2145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for annotation</span></span>
<span id="cb2145-2"><a href="generalized-linear-madness.html#cb2145-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb2145-3"><a href="generalized-linear-madness.html#cb2145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">population =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb2145-4"><a href="generalized-linear-madness.html#cb2145-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label      =</span> <span class="fu">c</span>(<span class="st">&quot;Lepus&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb2145-5"><a href="generalized-linear-madness.html#cb2145-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year       =</span> <span class="fu">c</span>(<span class="dv">1914</span>, <span class="fl">1916.5</span>),</span>
<span id="cb2145-6"><a href="generalized-linear-madness.html#cb2145-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">value      =</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">54</span>))</span>
<span id="cb2145-7"><a href="generalized-linear-madness.html#cb2145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2145-8"><a href="generalized-linear-madness.html#cb2145-8" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2145-9"><a href="generalized-linear-madness.html#cb2145-9" aria-hidden="true" tabindex="-1"></a>p <span class="sc">%&gt;%</span> </span>
<span id="cb2145-10"><a href="generalized-linear-madness.html#cb2145-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2145-11"><a href="generalized-linear-madness.html#cb2145-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2145-12"><a href="generalized-linear-madness.html#cb2145-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2145-13"><a href="generalized-linear-madness.html#cb2145-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2145-14"><a href="generalized-linear-madness.html#cb2145-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb2145-15"><a href="generalized-linear-madness.html#cb2145-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Lynx_Hare_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">row  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb2145-16"><a href="generalized-linear-madness.html#cb2145-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2145-17"><a href="generalized-linear-madness.html#cb2145-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2145-18"><a href="generalized-linear-madness.html#cb2145-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2145-19"><a href="generalized-linear-madness.html#cb2145-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb2145-20"><a href="generalized-linear-madness.html#cb2145-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population), <span class="at">color =</span> population),</span>
<span id="cb2145-21"><a href="generalized-linear-madness.html#cb2145-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2145-22"><a href="generalized-linear-madness.html#cb2145-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb2145-23"><a href="generalized-linear-madness.html#cb2145-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">fill =</span> population),</span>
<span id="cb2145-24"><a href="generalized-linear-madness.html#cb2145-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2145-25"><a href="generalized-linear-madness.html#cb2145-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb2145-26"><a href="generalized-linear-madness.html#cb2145-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">color =</span> population),</span>
<span id="cb2145-27"><a href="generalized-linear-madness.html#cb2145-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2145-28"><a href="generalized-linear-madness.html#cb2145-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2145-29"><a href="generalized-linear-madness.html#cb2145-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2145-30"><a href="generalized-linear-madness.html#cb2145-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb2145-31"><a href="generalized-linear-madness.html#cb2145-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-48-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Since this version of the model didn’t include a measurement-error process, we don’t have a clear way to make an analogue of Figure 16.9b. We’ll contend with that in the next section.</p>
</div>
<div id="add-a-measurement-error-process-to-the-lotka-volterra-model." class="section level4" number="16.4.2.2">
<h4><span class="header-section-number">16.4.2.2</span> 16.4.2.2 Add a measurement-error process to the Lotka-Volterra model.</h4>
<p>Now we have a sense of what the current Lotka-Volterra workflow looks like for <strong>brms</strong>, we’re ready to complicate our model a bit. Happily, we won’t need to update our <code>LotkaVolterra</code> code. That’s good as it is. But we will need to make a couple minor adjustments to our model <code>formula</code> object, which we now call <code>lv_formula_error</code>. Make special note of the first <code>bf()</code> line and the last line before we set <code>nl = TRUE</code>. That’s where all the measurement-error action is at.</p>
<div class="sourceCode" id="cb2146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2146-1"><a href="generalized-linear-madness.html#cb2146-1" aria-hidden="true" tabindex="-1"></a>lv_formula_error <span class="ot">&lt;-</span> </span>
<span id="cb2146-2"><a href="generalized-linear-madness.html#cb2146-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is new</span></span>
<span id="cb2146-3"><a href="generalized-linear-madness.html#cb2146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pelts <span class="sc">~</span> <span class="fu">log</span>(eta <span class="sc">*</span> p),</span>
<span id="cb2146-4"><a href="generalized-linear-madness.html#cb2146-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(eta <span class="sc">~</span> <span class="fu">LV</span>(t, H1, L1, bh, mh, bl, ml, delta)),</span>
<span id="cb2146-5"><a href="generalized-linear-madness.html#cb2146-5" aria-hidden="true" tabindex="-1"></a>     H1 <span class="sc">~</span> <span class="dv">1</span>, L1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2146-6"><a href="generalized-linear-madness.html#cb2146-6" aria-hidden="true" tabindex="-1"></a>     bh <span class="sc">~</span> <span class="dv">1</span>, mh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2146-7"><a href="generalized-linear-madness.html#cb2146-7" aria-hidden="true" tabindex="-1"></a>     bl <span class="sc">~</span> <span class="dv">1</span>, ml <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2146-8"><a href="generalized-linear-madness.html#cb2146-8" aria-hidden="true" tabindex="-1"></a>     sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb2146-9"><a href="generalized-linear-madness.html#cb2146-9" aria-hidden="true" tabindex="-1"></a>     <span class="co"># this is new, too</span></span>
<span id="cb2146-10"><a href="generalized-linear-madness.html#cb2146-10" aria-hidden="true" tabindex="-1"></a>     p <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb2146-11"><a href="generalized-linear-madness.html#cb2146-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb2146-12"><a href="generalized-linear-madness.html#cb2146-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Update the priors and save them as <code>lv_priors_error</code>.</p>
<div class="sourceCode" id="cb2147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2147-1"><a href="generalized-linear-madness.html#cb2147-1" aria-hidden="true" tabindex="-1"></a>lv_priors_error <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2147-2"><a href="generalized-linear-madness.html#cb2147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> H1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-3"><a href="generalized-linear-madness.html#cb2147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> L1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-4"><a href="generalized-linear-madness.html#cb2147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> bh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-5"><a href="generalized-linear-madness.html#cb2147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> bl, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-6"><a href="generalized-linear-madness.html#cb2147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> mh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-7"><a href="generalized-linear-madness.html#cb2147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> ml, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-8"><a href="generalized-linear-madness.html#cb2147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">dpar =</span> sigma, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb2147-9"><a href="generalized-linear-madness.html#cb2147-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here&#39;s our new prior setting</span></span>
<span id="cb2147-10"><a href="generalized-linear-madness.html#cb2147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">40</span>, <span class="dv">200</span>), <span class="at">nlpar =</span> p, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>)</span>
<span id="cb2147-11"><a href="generalized-linear-madness.html#cb2147-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>That wasn’t all that bad, was it? Okay, fit the full <strong>brms</strong> analogue to McElreath’s <code>m16.5</code>. If you followed along closely, all should go well.</p>
<div class="sourceCode" id="cb2148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2148-1"><a href="generalized-linear-madness.html#cb2148-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.5</span>b <span class="ot">&lt;-</span> </span>
<span id="cb2148-2"><a href="generalized-linear-madness.html#cb2148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare_long, </span>
<span id="cb2148-3"><a href="generalized-linear-madness.html#cb2148-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">brmsfamily</span>(<span class="st">&quot;lognormal&quot;</span>, <span class="at">link_sigma =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb2148-4"><a href="generalized-linear-madness.html#cb2148-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> lv_formula_error, </span>
<span id="cb2148-5"><a href="generalized-linear-madness.html#cb2148-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> lv_priors_error, </span>
<span id="cb2148-6"><a href="generalized-linear-madness.html#cb2148-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2148-7"><a href="generalized-linear-madness.html#cb2148-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">inits =</span> <span class="dv">0</span>,</span>
<span id="cb2148-8"><a href="generalized-linear-madness.html#cb2148-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> LotkaVolterra, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>),</span>
<span id="cb2148-9"><a href="generalized-linear-madness.html#cb2148-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.05b&quot;</span>)</span></code></pre></div>
<p>Once again, check the quality of the chains.</p>
<div class="sourceCode" id="cb2149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2149-1"><a href="generalized-linear-madness.html#cb2149-1" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;italic(H)[1]&quot;</span>, <span class="st">&quot;italic(L)[1]&quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;italic(&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;b[H]&quot;</span>, <span class="st">&quot;m[H]&quot;</span>, <span class="st">&quot;b[L]&quot;</span>, <span class="st">&quot;m[L]&quot;</span>), <span class="st">&quot;)&quot;</span>), </span>
<span id="cb2149-2"><a href="generalized-linear-madness.html#cb2149-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;italic(p[H])&quot;</span>, <span class="st">&quot;italic(p[L])&quot;</span>, <span class="st">&quot;sigma[italic(H)]&quot;</span>, <span class="st">&quot;sigma[italic(L)]&quot;</span>, <span class="st">&quot;lp__&quot;</span>, <span class="st">&quot;chain&quot;</span>, <span class="st">&quot;iter&quot;</span>)</span>
<span id="cb2149-3"><a href="generalized-linear-madness.html#cb2149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2149-4"><a href="generalized-linear-madness.html#cb2149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b16<span class="fl">.5</span>b, <span class="at">add_chain =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2149-5"><a href="generalized-linear-madness.html#cb2149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(col_names) <span class="sc">%&gt;%</span> </span>
<span id="cb2149-6"><a href="generalized-linear-madness.html#cb2149-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2149-7"><a href="generalized-linear-madness.html#cb2149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span>iter, <span class="sc">-</span>lp__),</span>
<span id="cb2149-8"><a href="generalized-linear-madness.html#cb2149-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">labeller =</span> label_parsed), </span>
<span id="cb2149-9"><a href="generalized-linear-madness.html#cb2149-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb2149-10"><a href="generalized-linear-madness.html#cb2149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2149-11"><a href="generalized-linear-madness.html#cb2149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">&#39;in&#39;</span>),</span>
<span id="cb2149-12"><a href="generalized-linear-madness.html#cb2149-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">55</span>, .<span class="dv">13</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-51-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>They look great! Now inspect the model parameter summary.</p>
<div class="sourceCode" id="cb2150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2150-1"><a href="generalized-linear-madness.html#cb2150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.5</span>b)</span></code></pre></div>
<pre><code>##  Family: lognormal 
##   Links: mu = identity; sigma = identity 
## Formula: pelts ~ log(eta * p) 
##          eta ~ LV(t, H1, L1, bh, mh, bl, ml, delta)
##          H1 ~ 1
##          L1 ~ 1
##          bh ~ 1
##          mh ~ 1
##          bl ~ 1
##          ml ~ 1
##          sigma ~ 0 + population
##          p ~ 0 + population
##    Data: Lynx_Hare_long (Number of observations: 42) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## H1_Intercept           131.94     21.91    94.77   180.94 1.00     1963     2133
## L1_Intercept            38.69      6.69    27.31    53.56 1.00     2251     2725
## bh_Intercept             0.55      0.07     0.43     0.68 1.00     1958     1965
## mh_Intercept             0.00      0.00     0.00     0.01 1.00     1931     1922
## bl_Intercept             0.00      0.00     0.00     0.01 1.00     1757     2117
## ml_Intercept             0.80      0.09     0.64     1.00 1.00     1921     1939
## p_populationHare         0.18      0.02     0.13     0.23 1.00     1939     2156
## p_populationLynx         0.17      0.02     0.13     0.22 1.00     2033     2357
## sigma_populationHare     0.25      0.04     0.18     0.35 1.00     3424     2558
## sigma_populationLynx     0.25      0.05     0.18     0.36 1.00     3017     2365
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If you fit McElreath’s <code>m16.5</code>, you’ll see our parameter summaries are very similar to his. Okay, we’re now ready to make the real analogue of McElreath’s Figure 16.9. First we’ll make and save the plot for the top panel.</p>
<div class="sourceCode" id="cb2152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2152-1"><a href="generalized-linear-madness.html#cb2152-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2152-2"><a href="generalized-linear-madness.html#cb2152-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the posterior predictive draws</span></span>
<span id="cb2152-3"><a href="generalized-linear-madness.html#cb2152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(b16<span class="fl">.5</span>b, </span>
<span id="cb2152-4"><a href="generalized-linear-madness.html#cb2152-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary =</span> F, </span>
<span id="cb2152-5"><a href="generalized-linear-madness.html#cb2152-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># how many posterior predictive draws would you like?</span></span>
<span id="cb2152-6"><a href="generalized-linear-madness.html#cb2152-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">nsamples =</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2152-7"><a href="generalized-linear-madness.html#cb2152-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb2152-8"><a href="generalized-linear-madness.html#cb2152-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2152-9"><a href="generalized-linear-madness.html#cb2152-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2152-10"><a href="generalized-linear-madness.html#cb2152-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2152-11"><a href="generalized-linear-madness.html#cb2152-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2152-12"><a href="generalized-linear-madness.html#cb2152-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb2152-13"><a href="generalized-linear-madness.html#cb2152-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Lynx_Hare_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb2152-14"><a href="generalized-linear-madness.html#cb2152-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2152-15"><a href="generalized-linear-madness.html#cb2152-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2152-16"><a href="generalized-linear-madness.html#cb2152-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2152-17"><a href="generalized-linear-madness.html#cb2152-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb2152-18"><a href="generalized-linear-madness.html#cb2152-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population), <span class="at">color =</span> population),</span>
<span id="cb2152-19"><a href="generalized-linear-madness.html#cb2152-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2152-20"><a href="generalized-linear-madness.html#cb2152-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb2152-21"><a href="generalized-linear-madness.html#cb2152-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">fill =</span> population),</span>
<span id="cb2152-22"><a href="generalized-linear-madness.html#cb2152-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2152-23"><a href="generalized-linear-madness.html#cb2152-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb2152-24"><a href="generalized-linear-madness.html#cb2152-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">color =</span> population),</span>
<span id="cb2152-25"><a href="generalized-linear-madness.html#cb2152-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2152-26"><a href="generalized-linear-madness.html#cb2152-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2152-27"><a href="generalized-linear-madness.html#cb2152-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2152-28"><a href="generalized-linear-madness.html#cb2152-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb2152-29"><a href="generalized-linear-madness.html#cb2152-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2152-30"><a href="generalized-linear-madness.html#cb2152-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span></code></pre></div>
<p>Our workflow for the second panel will differ a bit from above and a lot from McElreath’s <strong>rethinking</strong>-based workflow. In essence, we won’t get the same kind of output McElreath got when he executed <code>post &lt;- extract.samples(m16.5)</code>. Our <code>post &lt;- posterior_samples(b16.5b)</code> call only get’s us part of the way there. So we’ll have to be tricky and supplement those results with a little <code>fitted()</code> magic.</p>
<div class="sourceCode" id="cb2153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2153-1"><a href="generalized-linear-madness.html#cb2153-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(b16<span class="fl">.5</span>b)</span>
<span id="cb2153-2"><a href="generalized-linear-madness.html#cb2153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2153-3"><a href="generalized-linear-madness.html#cb2153-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb2153-4"><a href="generalized-linear-madness.html#cb2153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(b16<span class="fl">.5</span>b,</span>
<span id="cb2153-5"><a href="generalized-linear-madness.html#cb2153-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> F)</span></code></pre></div>
<p>Now we’re ready to make our version of the bottom panel of Figure 16.9. The trick is to divide our <code>fitted()</code> based results by the appropriate posterior draws from our <span class="math inline">\(p\)</span> parameters. This is a way of hand computing the <code>post$pop</code> values McElreath showed off in his <strong>R</strong> code 16.20 block.</p>
<div class="sourceCode" id="cb2154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2154-1"><a href="generalized-linear-madness.html#cb2154-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2154-2"><a href="generalized-linear-madness.html#cb2154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(f[, <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>]  <span class="sc">/</span> post<span class="sc">$</span>b_p_populationHare,</span>
<span id="cb2154-3"><a href="generalized-linear-madness.html#cb2154-3" aria-hidden="true" tabindex="-1"></a>        f[, <span class="dv">22</span><span class="sc">:</span><span class="dv">42</span>] <span class="sc">/</span> post<span class="sc">$</span>b_p_populationLynx) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-4"><a href="generalized-linear-madness.html#cb2154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2154-5"><a href="generalized-linear-madness.html#cb2154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-6"><a href="generalized-linear-madness.html#cb2154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-7"><a href="generalized-linear-madness.html#cb2154-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-8"><a href="generalized-linear-madness.html#cb2154-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-9"><a href="generalized-linear-madness.html#cb2154-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Lynx_Hare_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb2154-10"><a href="generalized-linear-madness.html#cb2154-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb2154-11"><a href="generalized-linear-madness.html#cb2154-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iter <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2154-12"><a href="generalized-linear-madness.html#cb2154-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2154-13"><a href="generalized-linear-madness.html#cb2154-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2154-14"><a href="generalized-linear-madness.html#cb2154-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb2154-15"><a href="generalized-linear-madness.html#cb2154-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population), <span class="at">color =</span> population),</span>
<span id="cb2154-16"><a href="generalized-linear-madness.html#cb2154-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2154-17"><a href="generalized-linear-madness.html#cb2154-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2154-18"><a href="generalized-linear-madness.html#cb2154-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2154-19"><a href="generalized-linear-madness.html#cb2154-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of animals&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb2154-20"><a href="generalized-linear-madness.html#cb2154-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span></code></pre></div>
<p>Now combine the two ggplot2 with <strong>patchwork</strong> to make the full Figure 16.9 in all its glory.</p>
<div class="sourceCode" id="cb2155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2155-1"><a href="generalized-linear-madness.html#cb2155-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-56-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>Boom!</p>
</div>
</div>
<div id="lynx-lessons-bonus-practice-with-the-autoregressive-model." class="section level3" number="16.4.3">
<h3><span class="header-section-number">16.4.3</span> <del>Lynx lessons</del> Bonus: Practice with the autoregressive model.</h3>
<p>Back in <a href="generalized-linear-madness.html#population-dynamics">Section 16.4</a>, we briefly discussed how autoregressive models are a typical way to explore processes like those in lynx-hare data. In this bonus section, we’ll practice fitting a few of these. To start off, we’ll restrict ourselves to focusing on just one of the criteria, <code>Hare</code>. Our basic autoregressive model will follow the form</p>
<p><span class="math display">\[\begin{align*}
\text{Hare}_t &amp; \sim \operatorname{Normal}(\mu_t, \sigma) \\
\mu_t &amp; = \alpha + \beta_1 \text{Hare}_{t - 1} \\
\alpha  &amp; \sim \; ? \\
\beta_1 &amp; \sim \; ? \\
\sigma  &amp; \sim \operatorname{Exponential}(1),
\end{align*}\]</span></p>
<p>were <span class="math inline">\(\beta_1\)</span> is the first-order autoregressive coefficient and the question marks in the third and fourth lines indicate we’re not wedding ourselves to specific priors, at the moment. Also, note the <span class="math inline">\(t\)</span> subscripts, which denote which time period the observation is drawn from, which in these data is <span class="math inline">\(\text{Year} = 1900, 1901, \dots, 1920\)</span>. Conceptually, <span class="math inline">\(t\)</span> is <em>now</em> and <span class="math inline">\(t - 1\)</span> the time point just before now. So if we were particularly interested in <span class="math inline">\(\operatorname E (\text{Hare}_{t = 1920})\)</span>, <span class="math inline">\(\text{Hare}_{t - 1}\)</span> would be the same as <span class="math inline">\(\text{Hare}_{t = 1919}\)</span>.</p>
<p>With <strong>brms</strong>, you can fit a model like this using the <code>ar()</code> function. By default, <code>ar()</code> presumes the criterion variable (<code>Hare</code>, in this case) is ordered chronologically. If you’re unsure or just want to be on the safe side, you can enter your <em>time</em> variable in the <code>time</code> argument. Also, though the <code>ar()</code> function presumes a first-order autoregressive structure by default, it is capable of fitting models with higher-order autoregressive structures. You can manually specify this with the <code>p</code> argument. Here’s how to fit our simple AR(1) model with explicit <code>ar()</code> syntax.</p>
<div class="sourceCode" id="cb2156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2156-1"><a href="generalized-linear-madness.html#cb2156-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.6</span> <span class="ot">&lt;-</span></span>
<span id="cb2156-2"><a href="generalized-linear-madness.html#cb2156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare,</span>
<span id="cb2156-3"><a href="generalized-linear-madness.html#cb2156-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb2156-4"><a href="generalized-linear-madness.html#cb2156-4" aria-hidden="true" tabindex="-1"></a>      Hare <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">ar</span>(<span class="at">time =</span> Year, <span class="at">p =</span> <span class="dv">1</span>),</span>
<span id="cb2156-5"><a href="generalized-linear-madness.html#cb2156-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.04669846</span>), <span class="at">class =</span> sigma),</span>
<span id="cb2156-6"><a href="generalized-linear-madness.html#cb2156-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2156-7"><a href="generalized-linear-madness.html#cb2156-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2156-8"><a href="generalized-linear-madness.html#cb2156-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.06&quot;</span>)</span></code></pre></div>
<p>You may have noticed we just went with the default <strong>brms</strong> priors for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta_1\)</span>. We got the value for the exponential prior for <span class="math inline">\(\sigma\)</span> by executing the following.</p>
<div class="sourceCode" id="cb2157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2157-1"><a href="generalized-linear-madness.html#cb2157-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fu">sd</span>(Lynx_Hare<span class="sc">$</span>Hare)</span></code></pre></div>
<pre><code>## [1] 0.04669846</code></pre>
<p>Here’s the model summary.</p>
<div class="sourceCode" id="cb2159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2159-1"><a href="generalized-linear-madness.html#cb2159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Hare ~ 1 + ar(time = Year, p = 1) 
##    Data: Lynx_Hare (Number of observations: 21) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Correlation Structures:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## ar[1]     0.74      0.17     0.38     1.05 1.00     2313     1813
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    30.22      9.68     9.34    48.88 1.00     2044     1739
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    16.42      2.87    12.00    23.19 1.00     2516     1985
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our autoregressive <span class="math inline">\(\beta_1\)</span> parameter is summarized in the ‘Correlation Structures,’ in which it’s called ‘ar[1].’ Another more old-school way to fit a autoregressive model is by manually computing a lagged version of your criterion variable. In <strong>R</strong>, you can do this with the <code>lag()</code> function.</p>
<div class="sourceCode" id="cb2161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2161-1"><a href="generalized-linear-madness.html#cb2161-1" aria-hidden="true" tabindex="-1"></a>Lynx_Hare <span class="ot">&lt;-</span></span>
<span id="cb2161-2"><a href="generalized-linear-madness.html#cb2161-2" aria-hidden="true" tabindex="-1"></a>  Lynx_Hare <span class="sc">%&gt;%</span> </span>
<span id="cb2161-3"><a href="generalized-linear-madness.html#cb2161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hare_1 =</span> <span class="fu">lag</span>(Hare))</span>
<span id="cb2161-4"><a href="generalized-linear-madness.html#cb2161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2161-5"><a href="generalized-linear-madness.html#cb2161-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Lynx_Hare)</span></code></pre></div>
<pre><code>##   Year Lynx Hare Hare_1
## 1 1900  4.0 30.0     NA
## 2 1901  6.1 47.2   30.0
## 3 1902  9.8 70.2   47.2
## 4 1903 35.2 77.4   70.2
## 5 1904 59.4 36.3   77.4
## 6 1905 41.7 20.6   36.3</code></pre>
<p>Look closely at the relation between the values in the <code>Hare</code> and <code>Hare_1</code> columns. They are set up such that <span class="math inline">\(\text{Hare}_{\text{Year} = 1901} = \text{Hare_1}_{\text{Year} = 1900}\)</span>, <span class="math inline">\(\text{Hare}_{\text{Year} = 1902} = \text{Hare_1}_{\text{Year} = 1901}\)</span>, and so on. Unfortunately, this approach does produce a single missing value in the first time point for the lagged variable, <code>Hare_1</code>. Here’s how you might use such a variable to manually fit an autoregressive model with <code>brms::brm()</code>.</p>
<div class="sourceCode" id="cb2163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2163-1"><a href="generalized-linear-madness.html#cb2163-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.7</span> <span class="ot">&lt;-</span></span>
<span id="cb2163-2"><a href="generalized-linear-madness.html#cb2163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare,</span>
<span id="cb2163-3"><a href="generalized-linear-madness.html#cb2163-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb2163-4"><a href="generalized-linear-madness.html#cb2163-4" aria-hidden="true" tabindex="-1"></a>      Hare <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Hare_1,</span>
<span id="cb2163-5"><a href="generalized-linear-madness.html#cb2163-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb2163-6"><a href="generalized-linear-madness.html#cb2163-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.04669846</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb2163-7"><a href="generalized-linear-madness.html#cb2163-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2163-8"><a href="generalized-linear-madness.html#cb2163-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2163-9"><a href="generalized-linear-madness.html#cb2163-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.07&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2164-1"><a href="generalized-linear-madness.html#cb2164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Hare ~ 1 + Hare_1 
##    Data: Lynx_Hare (Number of observations: 20) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    10.17      7.36    -4.65    24.86 1.00     3244     2561
## Hare_1        0.68      0.18     0.32     1.04 1.00     3123     2681
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    16.96      2.99    12.33    23.87 1.00     2777     2193
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Did you notice how the fourth line in the output read ‘Number of observations: 20?’ That’s because we had that one missing value for <code>Hare_1</code>. One quick and dirty hack might be to use the missing data syntax we learned from <a href="missing-data-and-other-opportunities.html#missing-data-and-other-opportunities">Chapter 15</a>. Here’s how that might look like.</p>
<div class="sourceCode" id="cb2166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2166-1"><a href="generalized-linear-madness.html#cb2166-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.8</span> <span class="ot">&lt;-</span></span>
<span id="cb2166-2"><a href="generalized-linear-madness.html#cb2166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare,</span>
<span id="cb2166-3"><a href="generalized-linear-madness.html#cb2166-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb2166-4"><a href="generalized-linear-madness.html#cb2166-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(Hare <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">mi</span>(Hare_1)) <span class="sc">+</span></span>
<span id="cb2166-5"><a href="generalized-linear-madness.html#cb2166-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bf</span>(Hare_1 <span class="sc">|</span> <span class="fu">mi</span>() <span class="sc">~</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2166-6"><a href="generalized-linear-madness.html#cb2166-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb2166-7"><a href="generalized-linear-madness.html#cb2166-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb2166-8"><a href="generalized-linear-madness.html#cb2166-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.04669846</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> Hare),</span>
<span id="cb2166-9"><a href="generalized-linear-madness.html#cb2166-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.04669846</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> Hare1)),</span>
<span id="cb2166-10"><a href="generalized-linear-madness.html#cb2166-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2166-11"><a href="generalized-linear-madness.html#cb2166-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2166-12"><a href="generalized-linear-madness.html#cb2166-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.08&quot;</span>)</span></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb2167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2167-1"><a href="generalized-linear-madness.html#cb2167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: Hare ~ 1 + mi(Hare_1) 
##          Hare_1 | mi() ~ 1 
##    Data: Lynx_Hare (Number of observations: 21) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Hare_Intercept     11.90      7.06    -2.36    25.76 1.00     2430     2477
## Hare1_Intercept    34.44      5.12    24.39    44.43 1.00     3926     2758
## Hare_miHare_1       0.65      0.17     0.29     0.98 1.00     2317     2319
## 
## Family Specific Parameters: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_Hare     16.80      2.81    12.32    23.21 1.00     2660     2192
## sigma_Hare1    22.43      3.65    16.67    30.67 1.00     3394     2674
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now we have a model based on all 21 observations, again. I’m still not in love with this fix, because it presumes that value in <code>Hare_1</code> was missing at random, with no accounting for the autoregressive structure. This is why, when you can, it’s probably better to use the <code>ar()</code> syntax.</p>
<p>Anyway, here’s how we might use <code>fitted()</code> to get a sense of <span class="math inline">\(\operatorname{E}(\text{Hare}_t)\)</span> from our first autoregressive model, <code>b16.6</code>.</p>
<div class="sourceCode" id="cb2169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2169-1"><a href="generalized-linear-madness.html#cb2169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">16</span>)</span>
<span id="cb2169-2"><a href="generalized-linear-madness.html#cb2169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2169-3"><a href="generalized-linear-madness.html#cb2169-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(b16<span class="fl">.6</span>,</span>
<span id="cb2169-4"><a href="generalized-linear-madness.html#cb2169-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">summary =</span> F,</span>
<span id="cb2169-5"><a href="generalized-linear-madness.html#cb2169-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">nsamples =</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2169-6"><a href="generalized-linear-madness.html#cb2169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2169-7"><a href="generalized-linear-madness.html#cb2169-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1900</span><span class="sc">:</span><span class="dv">1920</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2169-8"><a href="generalized-linear-madness.html#cb2169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2169-9"><a href="generalized-linear-madness.html#cb2169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter) <span class="sc">%&gt;%</span> </span>
<span id="cb2169-10"><a href="generalized-linear-madness.html#cb2169-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.integer</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb2169-11"><a href="generalized-linear-madness.html#cb2169-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2169-12"><a href="generalized-linear-madness.html#cb2169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span></span>
<span id="cb2169-13"><a href="generalized-linear-madness.html#cb2169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> iter),</span>
<span id="cb2169-14"><a href="generalized-linear-madness.html#cb2169-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2169-15"><a href="generalized-linear-madness.html#cb2169-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Lynx_Hare,</span>
<span id="cb2169-16"><a href="generalized-linear-madness.html#cb2169-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> Hare),</span>
<span id="cb2169-17"><a href="generalized-linear-madness.html#cb2169-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, </span>
<span id="cb2169-18"><a href="generalized-linear-madness.html#cb2169-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2169-19"><a href="generalized-linear-madness.html#cb2169-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2169-20"><a href="generalized-linear-madness.html#cb2169-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1913.5</span>, <span class="at">y =</span> <span class="dv">85</span>,</span>
<span id="cb2169-21"><a href="generalized-linear-madness.html#cb2169-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Lepus&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2169-22"><a href="generalized-linear-madness.html#cb2169-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of hare pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-62-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>The model did a pretty good job capturing the non-linear trends in the data. But notice how the fitted lines appear to be one step off from the data. This is actually expected behavior for a simple AR(1) model. For insights on why, check out <a href="https://stats.stackexchange.com/questions/404650/why-is-arima-in-r-one-time-step-off">this thread</a> on Stack Exchange.</p>
<p>So far we’ve been fitting the autoregressive models with the Gaussian likelihood, which is a typical approach. If you look at McElreath’s practice problem 16H3, you’ll see he proposed a bivariate autoregressive model using the Log-Normal likelihood. His approach used hand-made lagged predictors and ignored the missing value problem by dropping the first case. That model followed the form</p>
<p><span class="math display">\[\begin{align*}
L_t &amp; \sim \operatorname{Log-Normal}(\log \mu_{L, t}, \sigma_L) \\
H_t &amp; \sim \operatorname{Log-Normal}(\log \mu_{H, t}, \sigma_H) \\
\mu_{L, t} &amp; = \alpha_L + \beta_{L1} L_{t - 1} + \beta_{L2} H_{t - 1} \\
\mu_{H, t} &amp; = \alpha_H + \beta_{H1} H_{t - 1} + \beta_{H2} L_{t - 1},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\beta_{L1}\)</span> and <span class="math inline">\(\beta_{H1}\)</span> are the autoregressive parameters and <span class="math inline">\(\beta_{L2}\)</span> and <span class="math inline">\(\beta_{H2}\)</span> are what are sometimes called the cross-lag parameters. McElreath left the priors up to us. I propose something like this:</p>
<p><span class="math display">\[\begin{align*}
\alpha_L &amp; \sim \operatorname{Normal}(\log 10, 1) \\
\alpha_H &amp; \sim \operatorname{Normal}(\log 10, 1) \\
\beta_{L1}, \dots, \beta_{H2} &amp; \sim \operatorname{Normal}(0, 0.5) \\
\sigma_L &amp; \sim \operatorname{Exponential}(1) \\
\sigma_H &amp; \sim \operatorname{Exponential}(1).
\end{align*}\]</span></p>
<p>Before we fit the model, we’ll need to make a lagged version of <code>Lynx</code>.</p>
<div class="sourceCode" id="cb2170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2170-1"><a href="generalized-linear-madness.html#cb2170-1" aria-hidden="true" tabindex="-1"></a>Lynx_Hare <span class="ot">&lt;-</span></span>
<span id="cb2170-2"><a href="generalized-linear-madness.html#cb2170-2" aria-hidden="true" tabindex="-1"></a>  Lynx_Hare <span class="sc">%&gt;%</span> </span>
<span id="cb2170-3"><a href="generalized-linear-madness.html#cb2170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lynx_1 =</span> <span class="fu">lag</span>(Lynx))</span></code></pre></div>
<p>Because the predictor variables are not centered at zero, we’ll want to use the <code>0 + Intercept...</code> syntax. Now fit the bivariate autoregressive model.</p>
<div class="sourceCode" id="cb2171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2171-1"><a href="generalized-linear-madness.html#cb2171-1" aria-hidden="true" tabindex="-1"></a>b16<span class="fl">.9</span> <span class="ot">&lt;-</span></span>
<span id="cb2171-2"><a href="generalized-linear-madness.html#cb2171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> Lynx_Hare,</span>
<span id="cb2171-3"><a href="generalized-linear-madness.html#cb2171-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> lognormal,</span>
<span id="cb2171-4"><a href="generalized-linear-madness.html#cb2171-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(Hare <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Hare_1 <span class="sc">+</span> Lynx_1) <span class="sc">+</span></span>
<span id="cb2171-5"><a href="generalized-linear-madness.html#cb2171-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bf</span>(Lynx <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Lynx_1 <span class="sc">+</span> Hare_1) <span class="sc">+</span></span>
<span id="cb2171-6"><a href="generalized-linear-madness.html#cb2171-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb2171-7"><a href="generalized-linear-madness.html#cb2171-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">resp =</span> Hare, <span class="at">coef =</span> Intercept),</span>
<span id="cb2171-8"><a href="generalized-linear-madness.html#cb2171-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">resp =</span> Lynx, <span class="at">coef =</span> Intercept),</span>
<span id="cb2171-9"><a href="generalized-linear-madness.html#cb2171-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> Hare),</span>
<span id="cb2171-10"><a href="generalized-linear-madness.html#cb2171-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> Lynx),</span>
<span id="cb2171-11"><a href="generalized-linear-madness.html#cb2171-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> Hare),</span>
<span id="cb2171-12"><a href="generalized-linear-madness.html#cb2171-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> Lynx)),</span>
<span id="cb2171-13"><a href="generalized-linear-madness.html#cb2171-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb2171-14"><a href="generalized-linear-madness.html#cb2171-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">16</span>,</span>
<span id="cb2171-15"><a href="generalized-linear-madness.html#cb2171-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b16.09&quot;</span>)</span></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb2172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2172-1"><a href="generalized-linear-madness.html#cb2172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b16<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>##  Family: MV(lognormal, lognormal) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: Hare ~ 0 + Intercept + Hare_1 + Lynx_1 
##          Lynx ~ 0 + Intercept + Lynx_1 + Hare_1 
##    Data: Lynx_Hare (Number of observations: 20) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Hare_Intercept     3.01      0.17     2.68     3.34 1.00     2253     2480
## Hare_Hare_1        0.02      0.00     0.02     0.03 1.00     3418     2454
## Hare_Lynx_1       -0.02      0.00    -0.03    -0.01 1.00     2884     2557
## Lynx_Intercept     1.44      0.12     1.21     1.69 1.00     2663     2450
## Lynx_Lynx_1        0.03      0.00     0.02     0.04 1.00     4299     2897
## Lynx_Hare_1        0.02      0.00     0.02     0.03 1.00     3921     2789
## 
## Family Specific Parameters: 
##            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_Hare     0.33      0.06     0.23     0.47 1.00     3030     3019
## sigma_Lynx     0.23      0.04     0.17     0.34 1.00     3151     2663
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we’ll use <code>fitted()</code> to make a variant of the posterior predictions from the top portion of Figure 16.9.</p>
<div class="sourceCode" id="cb2174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2174-1"><a href="generalized-linear-madness.html#cb2174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">fitted</span>(b16<span class="fl">.9</span>, <span class="at">resp =</span> <span class="st">&quot;Hare&quot;</span>),</span>
<span id="cb2174-2"><a href="generalized-linear-madness.html#cb2174-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fitted</span>(b16<span class="fl">.9</span>, <span class="at">resp =</span> <span class="st">&quot;Lynx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2174-3"><a href="generalized-linear-madness.html#cb2174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2174-4"><a href="generalized-linear-madness.html#cb2174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb2174-5"><a href="generalized-linear-madness.html#cb2174-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">rep</span>(<span class="dv">1901</span><span class="sc">:</span><span class="dv">1920</span>, <span class="at">times =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2174-6"><a href="generalized-linear-madness.html#cb2174-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2174-7"><a href="generalized-linear-madness.html#cb2174-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb2174-8"><a href="generalized-linear-madness.html#cb2174-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>, <span class="at">group =</span> name, <span class="at">fill =</span> name),</span>
<span id="cb2174-9"><a href="generalized-linear-madness.html#cb2174-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2174-10"><a href="generalized-linear-madness.html#cb2174-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> name, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb2174-11"><a href="generalized-linear-madness.html#cb2174-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Lynx_Hare <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(Lynx<span class="sc">:</span>Hare),</span>
<span id="cb2174-12"><a href="generalized-linear-madness.html#cb2174-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value, <span class="at">color =</span> name),</span>
<span id="cb2174-13"><a href="generalized-linear-madness.html#cb2174-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2174-14"><a href="generalized-linear-madness.html#cb2174-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2174-15"><a href="generalized-linear-madness.html#cb2174-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2174-16"><a href="generalized-linear-madness.html#cb2174-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">1920</span>)) <span class="sc">+</span></span>
<span id="cb2174-17"><a href="generalized-linear-madness.html#cb2174-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="16_files/figure-html/unnamed-chunk-65-1.png" width="624" style="display: block; margin: auto;" /></p>
<p>In the next practice problem (16H4), McElreath suggested we “adapt the autoregressive model to use a <em>two-step</em> lag variable” (p. 551, <em>emphasis</em> added). Using the verbiage from above, we might also refer to that as second-order autoregressive model, AR(2). That would be a straight generalization of the approach we just took. I’ll leave the exercise to the interested reader.</p>
<p>The kinds autoregressive models we fit in this section are special cases of what are called <strong>autoregressive moving average</strong> (ARMA) models. If you’re in the social sciences, Hamaker and Brose have a nice <span class="citation">(<a href="references.html#ref-hamakerIdiographicDataAnalysis2009" role="doc-biblioref">2009</a>)</span> chapter explaining AR, ARMA, and other related models, which you can download from ReserachGate <a href="https://www.researchgate.net/publication/226943668_Idiographic_Data_Analysis_Quantitative_Methods-From_Simple_to_Advanced">here</a>. ARMA models are available in <strong>brms</strong> with help from the <code>arma()</code> function. However, if you want to dive deep into models of this kind, you might want to check out the <a href="https://github.com/asael697/varstan"><strong>varstan</strong> package</a> <span class="citation">(<a href="references.html#ref-matamorosVarstanPackageBayesian2020" role="doc-biblioref">Matamoros &amp; Torres, 2020</a>)</span>, which is designed to fit a variety of Bayesian structured time series models.</p>
</div>
</div>
<div id="session-info-15" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb2175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2175-1"><a href="generalized-linear-madness.html#cb2175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.4 (2021-02-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bayesplot_1.8.0      patchwork_1.1.1      rethinking_2.13      rstan_2.21.2         StanHeaders_2.21.0-7
##  [6] GGally_2.1.1         brms_2.15.0          Rcpp_1.0.6           tidybayes_2.3.1      ggthemes_4.2.4      
## [11] forcats_0.5.1        stringr_1.4.0        dplyr_1.0.5          purrr_0.3.4          readr_1.4.0         
## [16] tidyr_1.1.3          tibble_3.1.0         ggplot2_3.3.3        tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.3.1         backports_1.2.1      RcppEigen_0.3.3.7.0  plyr_1.8.6           igraph_1.2.6        
##   [6] splines_4.0.4        svUnit_1.0.3         crosstalk_1.1.0.1    TH.data_1.0-10       rstantools_2.1.1    
##  [11] inline_0.3.17        digest_0.6.27        htmltools_0.5.1.1    rsconnect_0.8.16     fansi_0.4.2         
##  [16] BH_1.75.0-0          magrittr_2.0.1       modelr_0.1.8         RcppParallel_5.0.2   matrixStats_0.57.0  
##  [21] xts_0.12.1           sandwich_3.0-0       prettyunits_1.1.1    colorspace_2.0-0     rvest_0.3.6         
##  [26] ggdist_2.4.0.9000    haven_2.3.1          xfun_0.22            callr_3.5.1          crayon_1.4.1        
##  [31] jsonlite_1.7.2       lme4_1.1-25          survival_3.2-7       zoo_1.8-8            glue_1.4.2          
##  [36] gtable_0.3.0         emmeans_1.5.2-1      V8_3.4.0             distributional_0.2.2 pkgbuild_1.2.0      
##  [41] shape_1.4.5          abind_1.4-5          scales_1.1.1         mvtnorm_1.1-1        emo_0.0.0.9000      
##  [46] DBI_1.1.0            miniUI_0.1.1.1       xtable_1.8-4         stats4_4.0.4         DT_0.16             
##  [51] htmlwidgets_1.5.2    httr_1.4.2           threejs_0.3.3        RColorBrewer_1.1-2   arrayhelpers_1.1-0  
##  [56] ellipsis_0.3.1       reshape_0.8.8        pkgconfig_2.0.3      loo_2.4.1            farver_2.0.3        
##  [61] dbplyr_2.0.0         utf8_1.1.4           labeling_0.4.2       tidyselect_1.1.0     rlang_0.4.10        
##  [66] reshape2_1.4.4       later_1.1.0.1        munsell_0.5.0        cellranger_1.1.0     tools_4.0.4         
##  [71] cli_2.3.1            generics_0.1.0       broom_0.7.5          ggridges_0.5.2       evaluate_0.14       
##  [76] fastmap_1.0.1        processx_3.4.5       knitr_1.31           fs_1.5.0             nlme_3.1-152        
##  [81] mime_0.10            projpred_2.0.2       xml2_1.3.2           compiler_4.0.4       shinythemes_1.1.2   
##  [86] rstudioapi_0.13      gamm4_0.2-6          curl_4.3             reprex_0.3.0         statmod_1.4.35      
##  [91] stringi_1.5.3        highr_0.8            ps_1.6.0             Brobdingnag_1.2-6    lattice_0.20-41     
##  [96] Matrix_1.3-2         nloptr_1.2.2.2       markdown_1.1         shinyjs_2.0.0        vctrs_0.3.6         
## [101] pillar_1.5.1         lifecycle_1.0.0      bridgesampling_1.0-0 estimability_1.3     httpuv_1.5.4        
## [106] R6_2.5.0             bookdown_0.21        promises_1.1.1       gridExtra_2.3        codetools_0.2-18    
## [111] boot_1.3-26          colourpicker_1.1.0   MASS_7.3-53          gtools_3.8.2         assertthat_0.2.1    
## [116] withr_2.4.1          shinystan_2.5.0      multcomp_1.4-16      mgcv_1.8-33          hms_0.5.3           
## [121] grid_4.0.4           coda_0.19-4          minqa_1.2.4          rmarkdown_2.7        shiny_1.5.0         
## [126] lubridate_1.7.9.2    base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>We first fit this model with <strong>brms</strong> version 2.14.4. At that time, the only way to get it to run successfully was by using <code>backend = "cmdstan"</code>. I’m not really interested in tackling what that setting means, but rest assured that exciting things are happening for <strong>brms</strong> and Stan. If you’d like to learn more, check out the <span class="citation">(<a href="references.html#ref-Weber2021WithinChainParallelization" role="doc-biblioref">2021</a>)</span> vignette by Webber and Bürkner, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_threading.html"><em>Running brms models with within-chain parallelization</em></a>. But anyways, the current version of <strong>brms</strong> (2.15.0) no longer requires that <code>backend</code> setting and the complications it entails. The default works fine.<a href="generalized-linear-madness.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="missing-data-and-other-opportunities.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="horoscopes-insights.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
